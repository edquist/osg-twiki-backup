%META:TOPICINFO{author="StevenTimm" date="1195512926" format="1.1" version="1.6"}%
---+!! *<noop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

---++ Purpose
      To enable the !PBS batch scheduler to work with the !OSG software stack

---++ Word To The Wise
   * Install the !PBS server (or flavours thereof) on a different node than the !OSG gatekeeper node to avoid problems in the gatekeeper node bringing down the batch scheduler
   * You can have multiple gatekeepers talking to a single !PBS server/scheduler (eg: Production and !ITB) with different scheduling rules
   * However, Gratia accounting system and WS-GRAM both assume that the PBS master is on the same node as the gatekeeper.  To get around this, all you need to do is to NFS-export your PBS server logs and accounting logs from the PBS master to the gatekeeper.  On a cluster where the top level directory is in /var/spool/pbs, you would have to export the directories /var/spool/pbs/server_priv/accounting and /var/spool/pbs/server_logs.  

---++ !PBS Configuration
 !PBS *does not* stream stdout and stderr. It maintains stderr and stdout at the local cluster node and copies back these files at the end of the job.
   * Copy back, *by default*, is done using the =pbs_rcp= command which might not be supported or might not want to be supported on most clusters.
   * If your home directories are mounted across cluster nodes, use the =$usecp= directive to manage copy back.

&nbsp;&nbsp;&nbsp;&nbsp;Edit =/var/spool/pbs/mom_priv/config= and add
      <verbatim>
      $usecp *.my.sub.domain:/home /home
      </verbatim>

---++ Gatekeeper Configuration

 =$VDT_LOCATION/globus/lib/perl/Globus/GRAM/JobManager/pbs.pm= is the !Perl script that the preWS gatekeeper uses to translate RSL to the !PBS submit script.  The PBS script, by default, does not insert any queue, it assumes you will use the default queue.  It is possible to get PBS directives applied to all the jobs you submit by editing the pbs.pm file.


---++ Troubleshooting
   *  Oftentimes a globus-job-run will fail against a PBS cluster because it is missing an RSL statement.  There are three types of jobtype, single, multiple, and MPI.  The default is multiple.  Unless you have configured your cluster with ssh key-pairs so that all the parts of the multiple job can be launched with the gatekeeper, the job will fail and you will get this error:

<pre>

</pre>

  *  The correct syntax is =globus-job-run <hostname>/jobmanager-pbs -x '(jobtype=single)' <command>=
 *   Note that if a PBS job goes over a resource such as resources_max.mem, it will get killed
  *  Note also that if you are submitting to a PBS queue that is already full to its queue limit, the submission will fail and the job will be held with Globus error 17.



%BR%
%COMPLETE2% %BR%
%RESPONSIBLE% Main.StevenTimm - 17 Oct 2007 %BR%
%REVIEW% Main.RobGardner - 08 Nov 2007 %BR%
%REVCOM% Still need to put in the error message from jobtype=multiple and give instructions on how to make a dynamic OSG_WN_TMP

<!-- Main.StevenTimm - 01 Mar 2007 -->

%META:TOPICMOVED{by="AnneHeavey" date="1192997611" from="Integration/ITB_0_7.PBSBatchSystemHints" to="Integration/ITB_0_7.PbsBatchSystemHints"}%
