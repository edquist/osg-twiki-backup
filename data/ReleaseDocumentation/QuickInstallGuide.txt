%META:TOPICINFO{author="SuchandraThapa" date="1248819642" format="1.1" version="1.5"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%


---++ Preliminary
Before you start installing the CE, the following software and requirements must be available on your server:

   * Valid host, http, container certs (optional: service cert for rsv)
   * This guide assumes that software will be installation in /opt
   * A working pacman-%PACMAN_VERSION% installation is also assumed

   
---++ Preparing the server
   * Create the =/etc/grid-security= directory to hold the server certificates
   * Copy hostcert.pem & hostkey.pem to =/etc/grid-security/=
   * Copy httpcert.pem & httpkey.pem to =/etc/grid-security/http=
   * Make copies of the host cert and key in =/etc/grid-security/= to create the containercert cert and keys
   * Optional: copy the rsv service cert to =/etc/grid-security/= 
   * Add a user account for the RSV service if needed

---++ Data directories
For an OSG ce installation, you'll need the following locations

   * OSG_APP - to hold vo installed software
      * Must be readable and writable on CE and readable on worker nodes (should have approximately 10GB per VO, some VOs may need significantly more space) 
   * OSG_GRID - location where wn-client software is located
      * Can be shared or local on worker nodes
   * OSG_DATA - transient storage data storage between nodes 
      * Optional - condor nfslite allows this to be omitted
   * OSG_READ / OSG_WRITE 
      * Transient storage visible on all worker nodes
      * Can be shared directory or URI (for srm locations)
   * OSG_WN_TMP
      * Scratch space on worker nodes about 10GB per job slot should be sufficient

---++ Installation


---+++ Preliminaries

   * Create /opt/osg-1.2
   * cd /opt/osg-1.2
   * Source the setup.sh from the pacman installation

---+++ Installing the CE software
   * Run =export OLD_VDT_LOCATION= if you're doing an upgrade and want to preserve your settings
   * Run =export PER_JOB_HISTORY_DIR=/opt/osg-1.2/gratia/var/data= for gratia
   * If using condor, run =export VDTSETUP_CONDOR_LOCATION=/your/condor/location=
   * Run =pacman -allow trust-all-caches  -get %CACHE%:ce=
   * Run =pacman -get %CACHE%:Globus-JOBMANAGER-Setup= where JOBMANAGER is Condor, PBS, LSF, or SGE
   * Optional: Run =pacman -get %CACHE%:ManagedFork=


---+++ Configuring the CE software
   * Run =source setup.sh= 
   * Run =vdt-post-install=
   * Run =vdt-ca-manage setupCA --url SOURCE --location LOCATION=, where SOURCE is probably osg and LOCATION is the appopriate location for your certificates
   * If upgrading an installation
      * Backup =$VDT_LOCATION/osg/etc/config.ini=
      * Run =extract-config=
      * Edit =./extracted-config.ini= to fill in any missing values
      * Copy =extracted-config.ini= to =$VDT_LOCATION/osg/etc/= 
   * Edit =osg/etc/config.ini= and set options appropriately 
   * Run =configure-osg -v= to verify your settings
   * Run =configure-osg -c= to configure the system
   * Run =visudo= to add entries for ws-gram
   * Set =/etc/grid-security/gsi-authz.conf= and =/etc/grid-security/prima-authz.conf= to appropriate values (or just copy them from =$VDT_LOCATION/post-install)

---+++ Enabling systems
   * Run =vdt-control --on=

---+++ Verify the install
   * Switch to your personal account, create a grid proxy and run the site verify script from =$VDT_LOCATION/verify/site_verify.pl=

---++  Testing your installation
We will test your installation by checking to see whether it accepts grid jobs, gridftp requests, ws-gram job requests and that the rsv system checks are up and running.


----++++ Testing grid jobs
Here we will test the grid job submission system.  You can do this using the following steps, where your.ce.hostname is replaced with the hostname of your install host:
<pre class="screen">
$ globus-job-run your.ce.hostname:2119/jobmanager /usr/bin/id
</pre>

You should get the uid and gids for the user account that your DN is mapped to.  In addition, you should be able to do this using a different job manager by specifying jobmanager-condor instead of jobmanager.

---++++ Testing gridftp
Gridftp is a system for transfering files between various grid aware systems.  You can test your system by following the steps below:
 <pre class="screen">   
$ echo "test file" > test.file
$ globus-url-copy file:///$PWD/test.file gsiftp://your.ce.hostname/tmp/
</pre>
   * Once this is done, you should see a test.file in the /tmp on your ce
<pre class="screen">
$ globus-url-copy gsiftp://your.ce.hostname/tmp/test.file file:///$PWD/new.file
</pre>
   * Once this is done, you should have a file called new.file in your current directory

---++++ Testing WS-GRAM
Testing ws-gram is similar to testing the job grid submission:
<pre class="screen">
$ globusrun-ws -submit -F your.ce.hostname:9443 -s -c /usr/bin/whoami=
</pre>

You should get the uid and gids for the user account that your DN is mapped to.  In addition, you should be able to do this using a different job manager by specifying Condor instead of Fork.

---++++ Checking RSV
RSV consists of a series of probes that run at varying intervals on your system to test your system's integrity and functionality. You can see the results of these probe tests by going to [[https://your.ce.hostname:8443/rsv/][https://your.ce.hostname:8443/rsv/]].

----++++
At this point your installation should be complete and operational. 





%BR%
%COMPLETE1% %BR%
%RESPONSIBLE% Main.SuchandraThapa - 23 Jul 2009 %BR%
%REVIEW% Main.RobertEngel - 24 Jul 2009 %BR%
%REVFLAG% %X%  %BR%


---++ *Comments*
%COMMENT{type="tableappend"}%