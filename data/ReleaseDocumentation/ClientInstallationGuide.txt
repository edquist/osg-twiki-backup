%META:TOPICINFO{author="IwonaSakrejda" date="1262842468" format="1.1" version="1.47"}%
---+!! *<noop>%SPACEOUT{ "%TOPIC%" }%*
%TOC{depth="2"}%

---++ Introduction

This guide covers the installation of the OSG client.  The OSG Client contains the software necessary to submit jobs and transfer data on the Open Science Grid.  The client software includes:
   * Globus toolkit for authorization, file transfer, and small-scale job submission.
   * CA certificates and CRLs (part of the grid authentication and authorization system).
   * Condor for job submission and workflow management.
   * SRM protocol client tools for file transfer and data management.
This page does not cover the usage of this software; it does cover installation, configuration, and minimal validation.

---+++ Applicable Versions
This guide covers the installation of the OSG 1.0.x client and the latest release, *OSG-%OSG_VERSION%*.

We strongly recommend new installations us *OSG-%OSG_VERSION%*.  If you find a non-trivial issue in using the client software, you may be asked to upgrade to a newer version as the first step.

---+++ Engineering Considerations.
A heavily used (more than 2000 sustained running jobs) OSG client can use quite a few resources and may need its own node.

In order to set up any persistent service - certificate updates, CRL updates, or starting Condor at boot time - you will need to install the client as root.  If you install as root you must install in a directory accessible for all users; if root installs into a directory that is not world-readable, the install process will fail.

---+++ Help!
If a problem occurs during installation, [[SiteAdminResources][please use this page]] to get assistance.

---++ Checklist
   1 *WARNING* If you already have an OSG-Client installed, its presence might corrupt this installation attempt.  Verify that you are installing into an empty directory and the $VDT_LOCATION environment variable isn't already set; you may have to log in to a fresh shell or remove something from your shell's profile.
      * If $VDT_LOCATION is already set, you may receive indecipherable errors while attempting this install.  You may get no errors at all, but end up with an unusable software stack.
   1 This process assumes that you have already [[Documentation/CertificateGet][obtained a grid certificate]] from an OSG-recognized Certificate Authority and joined an OSG Virtual Organization. If you have not, you will not be able to easily test the resulting install.
   1 See the [[http://vdt.cs.wisc.edu/releases/2.0.0/requirements.html][supported operating systems]] (or [[http://vdt.cs.wisc.edu/releases/1.10.1][this link for OSG 1.0.x]]) for system requirements.  
      * If you do a non-root install, make sure that you own your =$HOME/.globus= directory and its permissions are 755.  
   1 Have the pacman software installed and set up in your environment.  Refer to [[PacmanInstall][Pacman install]] for installation and consult [[PacmanBestPractices][the Pacman Best practices]] if you have trouble.

%STARTOSG12% Pacman %PACMAN_VERSION% is required. Installation is likely to fail with earlier versions. %ENDOSG12%

---++ Installation Procedure
Create a directory for the client and =cd= to it, such as:

<pre class="screen">
<userinput>mkdir osg-client</userinput>
<userinput>cd osg-client/</userinput>
</pre>
From now on, we will refer to this directory as $VDT_LOCATION.  Next, run the installation command.

%STARTOSG12%
In OSG 1.2 you will use:
<pre class="screen">
<userinput>pacman -get http://software.grid.iu.edu/osg-1.2:client</userinput>
</pre>

You will need to answer "y" to the question in order to trust the software cache and continue the install.

%TWISTY{
mode="div"
showlink="Show screen output..."
hidelink="Hide screen output"
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
You will see screen output like this:

<pre>
Do you want to add [http://software.grid.iu.edu/osg-1.2] to [trusted.caches]? (y/n/yall): <userinput> yall</userinput>

Beginning VDT prerequisite checking script vdt-common/vdt-prereq-check...       

All prerequisite checks are satisfied.

========== IMPORTANT ==========
Most of the software installed by the VDT *will not work* until you install
certificates.  To complete your CA certificate installation, see the notes
in the post-install/README file.

The VDT version 2.0.0 has been installed.
                                         
The OSG Client package OSG version 1.2 has been installed.
>ls
ant           gpt           osg                      srm-client-lbnl      berkeley-db   jdk1.5        owamp                    trusted.caches
bwctl         lcg           pacman-platform-mapping  vdt       cert-scripts  licenses      pegasus                  vdt-app-data
condor        logrotate     perl                     vdt-install.log  curl          logs          post-install             voms
expat         ndt           pyglobus-url-copy        wget           fetch-crl     npad          setup.csh
glite         o..pacman..o  setup.sh        globus        openldap      srm-client-fermi
</pre>
%ENDTWISTY%
<br/>
If the installation appears to be successful, run the =setup.sh= and the =vdt-post-install= commands.
<pre class="screen">
source setup.sh
vdt-post-install
</pre>

%ENDOSG12%

For OSG 1.0.x,
<pre class="screen">
<userinput>pacman -get OSG:client</userinput>
</pre>
You will need to answer "y" to the question in order to trust the software cache / agree to licences and continue the install.

%TWISTY{
mode="div"
showlink="Show screen output..."
hidelink="Hide screen output"
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
You will see screen output like this:
<pre>
Do you want to add [http://software.grid.iu.edu/pacman/] to [trusted.caches]? (y or n): <userinput>y</userinput>
Do you want to add [http://vdt.cs.wisc.edu/vdt_1101_cache] to [trusted.caches]? (y or n): <userinput>y</userinput>
</pre>

The display will be self-overwriting of package checks, eventually in OSG 1.0 continues with:

<!-- After the installation has completed, you will also be able to... -->

<pre class="screen">
VDT 1.10.1 installs a variety of software, each with its own license.
In order to continue, you must agree to the licenses.
You can view the licenses online at:

     http://vdt.cs.wisc.edu/licenses/1.10.1

After the installation has completed, you will also be able to
view the licenses in the "licenses" directory.

Do you agree to the licenses? [y/n] <userinput>y</userinput>

</pre>

Answer =y= to continue the installation.
%ENDTWISTY%
<br/>

For OSG 1.0.x, there will be important about the configuration of CAs and runtime services during install time, documented below
%TWISTY{
mode="div"
showlink="Show additional OSG 1.0.x steps..."
hidelink="Hide additional OSG 1.0.x steps"
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
In OSG 1.0.x the following installation questions will differ depending if the installation is performed as 'root' user or not. Choose the section that applies to you. 

---+++Installing as regular user
<pre class="screen">
The VDT typically installs public certificates and signing policy files 
for the well-known public CA's. This is necessary in order for you to 
perform GSI authentication with any remote Grid services (that have 
service/host certificates signed by these CA's).

For more information please refer to the VDT documentation:
http://vdt.cs.wisc.edu/releases/1.10.1/setup_ca.html

Where would you like to install CA files?

Choices:
	l (local) - install into $VDT_LOCATION/globus/share/certificates
	n (no)    - do not install
l
</pre>

Choose =l= to have a local installation completely self-contained.

Now go to the final installation steps.

---+++Installing as root
<pre class="screen">

If you would like, we can configure the Condor batch system to
start automatically at boot time.

Configuring the Condor daemon requires changes to
- /etc/init.d (or /etc/rc.d/init.d)

Would you like to enable the Condor batch system to run automatically?

Possible Answers:
     y: Yes. I want the service to run automatically (once enabled)
     n: No. I do NOT want the service to run automatically

Note: Services are enabled with vdt-control; see 'post-install/REAME'.
<userinput>y</userinput>
</pre>

Answer =y= to enable startup of Condor.  This Condor installation is for submitting jobs to remote sites. It is not expected to be a server installation for receiving jobs. If you are submitting jobs from a machine that is also receiving jobs with Condor, answering "yes" to this will *not* overwrite the server Condor. Only your condor-g will be affected.

<pre class="screen">

The VDT typically installs public certificates and signing policy files 
for the well-known public CA's. This is necessary in order for you to 
perform GSI authentication with any remote Grid services (that have 
service/host certificates signed by these CA's).

For more information please refer to the VDT documentation:
http://vdt.cs.wisc.edu/releases/1.10.1/setup_ca.html

Where would you like to install CA files?

Choices:
        r (root)  - install into /etc/grid-security/certificates
                   (existing CA files will be preserved)
        l (local) - install into $VDT_LOCATION/globus/share/certificates
        n (no)    - do not install

<userinput>l</userinput>
</pre>

Answer =l= (lowercase "L") so that the CA files will be installed inside of your installation directory.


<pre class="screen">
Do you want to run a cron job that will update the CA certificate
revocation lists automatically? This will use the fetch-crl program
that comes with the VDT. The cron job will run at a random time
between midnight and 6:00am. We select a random time to avoid having
all VDT installations fetching CRLs at the same time.

Do you want to update the CA certification revocation lists (CRLs) automatically
? [y/n] <userinput>y</userinput>
</pre>

Often, you will need CRLs for a client installation.  You can choose "y" to enable now or enable later via ==vdt-control== as needed.
 
<pre class="screen">
Several services provided by the VDT create unbounded log files.  If you wish, we can rotate those file on a daily basis.

Would you like to setup daily rotation of VDT log files?

Possible Answers:
     y: Yes. I want the service to run automatically (once enabled)
     n: No. I do NOT want the service to run automatically

Note: Services are enabled with vdt-control; see 'post-install/REAME'.

<userinput>n</userinput>
</pre>

Often, log files associated with client services will not grow large.  You can answer "no" here and enable later via ==vdt-control== as needed.

<pre class="screen">

Do you want to automatically update your CA certificates? If so,
we will check for updates once a day via cron.

Do you want to automatically update your CA Certificates? [y/n] 
</pre>

Since the client codes do regularly require CA certificates, you should answer "yes" to this automatic update feature.

%ENDTWISTY%
<br/>
---+++ CA Certificate Configuration

<!--
This part applies to both root and regular user installation.

Before installing the packages this reminder is printed:
<pre class="screen">
========== IMPORTANT ==========
The VDT no longer installs certificate authority certificates at install time.
Most of the software installed by the VDT *will not work* until you install
certificates.  To complete your CA certificate installation, see the notes
in the post-install/README file.
</pre>

If all goes well, the client's pacman installation will complete with the following output:

<pre class="screen">
The VDT version 1.10.1v has been installed.

The OSG Client package %CACHE% version 1.0.1 has been installed.
</pre>
-->

Some last steps have to be performed to configure the CA certificates.

%STARTOSG12%
Run the =vdt-ca-manage= command.  To do this, you need to make two decisions.
Should certificates be installed to:
   * *root*: (Can only be done as root user) Install certificates system-wide into /etc/grid-security/certificates
   * *local*: Install certificates only into the local install directory
What set of CA certificates should be used?
   * *osg*: The IGTF-accredited CAs plus additional non-accredited CAs that OSG VOs may use
   * *vdt*: The IGTF-accredited CAs only.
A common usage case is given below, where the OSG certificates are place in the local installation:
<pre class="screen">
source $VDT_LOCATION/setup.sh 
vdt-ca-manage setupca --location local --url osg
</pre>
%ENDOSG12%

For OSG 1.0 only:

After sourcing the setup file, edit =$VDT_LOCATION/vdt/etc/vdt-update-certs.conf= and uncomment the following line to get the CAs from the OSG:
<pre class="screen">
cacerts_url = http://software.grid.iu.edu/pacman/cadist/ca-certs-version
</pre>

Then, run the configuration script:
<pre class="screen">
source $VDT_LOCATION/vdt-questions.sh; $VDT_LOCATION/vdt/sbin/vdt-setup-ca-certificates
</pre>

%TWISTY{
mode="div"
showlink="Show output..."
hidelink="Hide output"
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
<pre>
vdt-update-certs
  Log file: /ecache/share/osg-client090713/vdt/var/log/vdt-update-certs.log
  Updates from: http://software.grid.iu.edu/pacman/cadist/ca-certs-version

Will update CA certificates from version unknown to version 1.8.
</pre>
%ENDTWISTY%

You have now configured and installed the client.

---+++  Firewall Considerations

Some Grid job initiation and management operations require call backs to the client machine, accordingly *any* firewall on the host (or an external firewall affecting the host) can possibly break an installation.  *If you have a firewall, read this section*; otherwise, ignore it.

   * If your client host is behind a firewall and not registered in DNS, assign your client's ip-address to the =GLOBUS_HOSTNAME= variable: 
      * <pre class="screen">  export GLOBUS_HOSTNAME=<i>your-ip-address</i> </pre>
   * If your client is behind a firewall blocking ephemeral ports, an ephemeral port range should be set aside for use and opened for incoming connections.  Opening the port range may depend on your firewall implementation. If you are doing a personal non-root installation, check with your administrator to determine which ports are open for you to use.  Then, identifying the port range in the client tools is done in two places (numbers shown here are just examples):
      * Specify the GLOBUS_TCP_PORT_RANGE and GLOBUS_TCP_SOURCE_RANGE  variables (to set the inbound and outbound available port ranges, see ComputeElementFirewalls for more information) in the $VDT_LOCATION/setup.sh (and setup.csh) script: <pre class="screen">
GLOBUS_TCP_PORT_RANGE=20000,22000
export GLOBUS_TCP_PORT_RANGE
GLOBUS_TCP_SOURCE_RANGE=23000,25000 
export GLOBUS_TCP_SOURCE_RANGE
</pre>
      * Specify range in for use by Condor-g in the $CONDOR_CONFIG file ( *Note:* condor must be restarted):  <pre class="screen">
HIGHPORT = 22000 
LOWPORT  = 20000
</pre>

%STARTOSG12%
Note that in OSG 1.2 port ranges go also to $OSG_LOCATION/vdt/etc/vdt-local-setup.sh                                                                                                
and not just $OSG_LOCATION/setup.sh                                                                                                                                       
%ENDOSG12%

---+++ Simple test of the installation

Now that the OSG Client has been installed, you will have to configure it with your grid user certificate in order to start submitting jobs.  Log in as a normal user, setup your environment and get a proxy certificate:
<pre class="screen">
source <i>$VDT_LOCATION</i>/setup.(c)sh
voms-proxy-init
</pre>
Use *-help* in the proxy-init commands to find out options.  You will be prompted to enter your certificate password.

To make sure your proxy is working, pick a known node and run =globusrun=. The node shown is just an example:
<pre class="screen">
globusrun -a -r cmsosgce3.fnal.gov
</pre>
If successful, this returns:
<pre class="screen">
GRAM Authentication test successful
</pre>

---++ Service Configuration/Startup/Shutdown

This section applies only to clients installed as root.

Even though this is the client package, some services remain, such as:
   * Hourly CRL updates
   * Hourly log rotation
   * Nightly CA updates
   * Condor daemons for workflow management
The tool for starting and stopping the services is =vdt-control=.  To run these services, login as root and source the setup script:
<pre class="screen">
source <i>$VDT_LOCATION</i>/setup.[c]sh
</pre>

You can determine which services are configured by running *vdt-control --list*. (For a more detailed review of turning VDT services on and off, consult [[http://vdt.cs.wisc.edu/releases/2.0.0/man/vdt-control.html][vdt-control]] and OSG StartingServices documentation written for the Compute Element).  You should find the output looks like this:

<pre class="screen">
# vdt-control --list
Service            | Type   | Desired State
-------------------+--------+--------------
fetch-crl          | cron   | enable
vdt-rotate-logs    | cron   | do not enable
vdt-update-certs   | cron   | enable
condor             | init   | enable
globus-ws          | init   | do not enable

</pre>

For Condor-G submissions, fetch-crl, vdt-update-certs, and =condor= are needed. Never run or enable =globus-ws=; it is an legacy artifact of the VDT install process.  Turning on all enabled services is done by, ==vdt-contol --on==.

---++ Testing the Client

A series of validation tests of the client tools can be found in the ValidateClients documentation. These basic tests include querying services, submitting jobs, and transfering files.

---++ Debugging Information

If you encounter any problems, review the *vdt-install.log* file for obvious error messages; you will be asked to send that file to experts as the first step for almost any debugging.

You can view what has been installed by running ==vdt-version==.  For the OSG 1.0, the output looks like:
%TWISTY{
mode="div"
showlink="Show output..."
hidelink="Hide output"
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
<pre class="screen">
> source <i>your-osg-client-dir</i>/setup.(c)sh
> vdt-version
You have installed a subset of VDT version 1.10.1d:
    CA Certificates v36 (includes IGTF 1.21 CAs)
    Condor/Condor-G 7.0.2
    cURL 7.18.0
    Fetch CRL 2.6.6
    Globus Toolkit, pre web-services, client 4.0.7
    Globus Toolkit, web-services, client 4.0.7
    GPT 3.2autotools2004-NMI-9.0
    GSI-Enabled OpenSSH 4.3
    Java 5 SDK 1.5.0_14
    lcg-info 1.11.0-1
    lcg-infosites 2.6-2
    Logrotate 3.7
    MyProxy 4.2
    Pegasus 2.1.0
    PPDG Cert Scripts 2.6
    pyGlobus gt4.0.1-1.13
    PyGlobus URL Copy 1.1.2.11
    RLS, client 3.0.041021
    SRM Fermi Client 1.8.0-15p3
    SRM Berkeley Client 2.2.0.10
    UberFTP 1.27
    Wget 1.11
</pre>

%STARTOSG12%
The version output for OSG 1.2 is:
<pre class="screen">
> source <i>your-osg-client-dir</i>/setup.(c)sh
> vdt-version

You have installed a subset of VDT version 2.0.0p5:

Software                                                 Status              
--------                                                 ------              
Bandwidth Test Controller 1.3                            OK                  
vdt-ca-manage 1.0                                        OK                  
vdt-update-certs 2.4                                     OK                  
CA Certificates 1.8 (includes IGTF 1.30 CAs)             -                   
CGSI-gSOAP 1.2.1.2                                       OK                  
Condor/Condor-G 7.2.4                                    OK                  
cURL 7.18.2                                              OK                  
Fetch CRL 2.6.6                                          OK                  
Globus Toolkit, pre web-services, client 4.0.8           OK                  
Globus Toolkit, web-services, client 4.0.8               OK                  
GPT 3.2-4.0.8p1                                          OK                  
GSI-Enabled OpenSSH 4.6                                  OK                  
Java 5 SDK 1.5.0_18                                      OK                  
lcg-info 1.11.4-1                                        OK                  
lcg-infosites 2.6-2                                      OK                  
LCG-Utils 1.6.11-1p1 (includes GFAL 1.10.11-1) 1.6.11-1p1 OK                  
LCG File Catalog Client 1.6.11.4                         OK                  
Logrotate 3.7                                            OK                  
MyProxy Client 4.7                                       OK                  
NDT 3.5.0                                                OK                  
Network Path and Application Diagnosis Client 1.5.5      OK                  
One-Way Active Measurement Protocol (One-Way Ping) 3.1   OK                  
Pegasus 2.3.0                                            OK                  
PPDG Cert Scripts 2.7                                    OK                  
pyGlobus gt4.0.1-1.13                                    OK                  
PyGlobus URL Copy 1.1.2.11                               OK                  
SRM Fermi Client 1.9.2-4                                 OK                  
SRM Berkeley Client 2.2.1.2.i7.p1                        OK                  
UberFTP 2.4                                              OK                  
VOMS Client 1.8.8-2p1                                    OK                  
Wget 1.11.4                                              OK                  


Status legend:
OK: Software is up to date with the latest release in VDT version 2.0.0
- : Not enough information to determine if updates are available.
See man page for more information.
</pre>
%ENDOSG12%
%ENDTWISTY%

---++ Updating the Client
*WARNING*: These instructions refer *ONLY TO THE UPDATE OF THE CLIENT*.  Do not use them for other packages like CE and SE.

*NOTE*: Client installation and configuration is relatively straightforward; it may be easier and faster to remove your old install and do a fresh installation: 

To update OSG Client you must first update the VDT packages with the VDT updater, then you can use Pacman for the rest:
   * Turn off the services (in clients they are normally already off). You have to be root to use =vdt-control=; if this is a personal installation ignore the vdt-control statements <pre class="screen">cd $VDT_LOCATION                                                                                                                                           
source setup.sh
vdt-control --off
</pre>
   * Get the latest updater:<pre class="screen">
pacman -update VDT-Updater
</pre> 
   * NOTE: if you don't have the VDT-Updater, run the following command to get it:<pre class="screen">pacman -get http://vdt.cs.wisc.edu/vdt_200_cache:VDT-Updater
</pre>
   * Run the updater: <pre class="screen">vdt/update/vdt-updater      --skip-backup-check
</pre>
      * Answer yes when asked to accept the updates
      * Answer no if asked to modify the certificate management
   * Update the rest (OSG-Client):<pre class="screen">pacman -update 
</pre>
   * Finish the update: <pre class="screen">vdt-post-install   # probably it will tell you that nothing needs to be fixed
vdt-control --on  #  (if desired to restart cron jobs) probably this is not necessary
</pre>



%BR%
%COMPLETE3% %BR%
%RESPONSIBLE% Main.MarcoMambelli - 13 Jul 2009 %BR%
%REVIEW% Main.RobertEngel - 21 Jul 2009 %BR%
%REVFLAG% %X%  %BR%


---++ *Comments*
%COMMENT{type="tableappend"}%

%META:TOPICMOVED{by="ForrestChristian" date="1166046231" from="Integration.ClientInstallationGuide050" to="Integration/ITB_0_5.ClientInstallationGuide"}%
