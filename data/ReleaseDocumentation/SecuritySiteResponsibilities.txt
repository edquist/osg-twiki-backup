%META:TOPICINFO{author="DougOlson" date="1248896956" format="1.1" reprev="1.8" version="1.8"}%
%META:TOPICPARENT{name="Security.WebHome"}%
%LINKCSS%

<!-- This is the default OSG documentation template. Please modify it in -->
<!-- the sections indicated to create your topic.                        --> 

<!-- By default the title is the WikiWord used to create this topic. If  -->
<!-- you want to modify it to something more meaningful, just replace    -->
<!-- %TOPIC% below with i.e "My Topic".                                  -->

---+!! Site Responsibilities for Security
%TOC%

This describes the expectations and actions that a site administrator handles regarding security issues
as a participant in OSG.

---++ Background
It is expected that the administrative and security contacts for a resource registered with OSG (in OIM)
are capable of dealing with the normal system administration and security practices of running
a cluster of machines for scientific computing.  The security materials provided on the OSG twiki
occasionally mention examples of how basic computer security features could be handled
but that is not a replacement for for formal in-depth training on unix system administration.
We have collected some examples in a Security.BestPractices page (which you are welcome to contribute to).

---++ Site Registration
This is normally a one time occurrence and is handled by filling out the registration form
at the [[http://www.grid.iu.edu/][OSG Grid Operations Center]] and attending one of the
[[Operations.ProductionMeetingMinutes][weekly Operations meetings]] to introduce yourself and your site.

It is important to provide accurate and reliable contact information with the registration.
At large sites with active involvement with OSG the operations and security contacts for a site
are likely different people (or groups). At some small sites it is likely that the operations contact
and the security contact are the same person.  The important aspect of the security contact
is to be someone who will read and understand the security notices from OSG.
If the professional computer & network security staff at your site need to be reminded of
what OSG is every time you ask them something then the security contact for OSG should be
the person responsible for the general system administration of the grid resource.

 
---++ Know who your institutional cyber security officer is
Most institutions have someone responsible for cyber security at the institution, usually
reporting to the CIO (Chief Information Officer) of the institution.  The person responsible
may have the title of Cyber Security Officer, or Computer Protection Program Manager,
or some other title. They are typically responsible for security of the central IT systems,
network security, and security awareness training for the users at that institution.
You should know who that person is. If you don't know who that is,
consider the scenario.

%BLUE%Suppose someone has posted bootleg copies of licensed software
on one of your computers and it is available for download via a file sharing network
(bit torrent, gnutella, etc.) and it is discovered by the network security staff.
Who is going to come see you to investigate?
*Answer:* Someone from the cyber security officer's team.%ENDCOLOR%

You should introduce yourself to the cyber security officer and discuss any
institutional requirements for the operation of your grid site.

---++ Maintenance of Contact Info in OIM
You can update your contact information in the [[https://oim.grid.iu.edu/][OSG Information Management (OIM)]] system
by clicking the Profile link.
You need a [[Documentation.CertificateGet][personal X.509 certificate]] in your web browser in order to register with OIM and to
access it to update your information.  OSG will do a periodic assessment of the contact information to encourage it's
being accurate but it is expected that people will keep their own information current.


---++ Read Security Notifications from OSG
OSG sends out security notifications to all security contacts when important events occur,
like a vulnerability notice requiring a software update.  If you receive a notice you are expected to read it
and read the detailed information linked to a ticket at the GOC.
The notice looks similar to:
<verbatim>

-------- Original Message --------
Subject: OSG-SEC-NOTIFY-2009-06-20
Date: Sat, 20 Jun 2009 00:22:49 +0000 (UTC)
From: goc@OPENSCIENCEGRID.ORG
To: goc@OPENSCIENCEGRID.ORG


A new security notification has been posted.

You are receiving this message because you are listed as a security contact for an OSG resource 
or VO or support center. Assuming you are registered on OIM, and are authorized to view 
security tickets, please open the following URL for further information:
https://ticket.grid.iu.edu/goc/viewer?id=XXXXX

Please contact security@opensciencegrid.org if you have any questions or concerns.

This message is digitally signed. We encourage you to verify the digital signatures on 
OSG security announcements according to:
https://twiki.grid.iu.edu/bin/view/Security/SecureEmail

Sincerely,
OSG Security Team
</verbatim>
Any subsequent correspondence you have about a particular notice should include the
OSG-SEC-NOTIFY tag in the subject line <br/>(<tt>OSG-SEC-NOTIFY-2009-06-20</tt> in the example above).

As indicated, the notice should be digitally signed either as S/MIME with an X.509 certificate,
or using [[Security.SecureEmail][PGP with the key]] for security@opensciencegrid.org.

You will need your personal certificate that is registered with OIM in your browser in order to read the details of the
notice in the ticket.



---++ Apply security updates of VDT/OSG software
There are frequent updates to the grid software for security and functional improvements,
just like any other software.  A site is expected to apply the security updates in a timely manner.
How quickly the update should be applied is a judgment call for the site but anything
longer than a few days delay should have a very good reason.
One example notice of an update message is:
<verbatim>

-------- Original Message --------
Subject: Security updates: VDT 1.10.1x and 2.0.0p2
Date: Mon, 08 Jun 2009 20:51:23 +0000 (UTC)
From: goc@OPENSCIENCEGRID.ORG
To: goc@OPENSCIENCEGRID.ORG

The VDT team announces the immediate availability of VDT 1.10.1x and 2.0.0p2, which contain an 
important security update to Glexec.  You can read about the VDT updates and the security advisory 
on these pages:

http://vdt.cs.wisc.edu/releases/1.10.1/release-x.html
http://vdt.cs.wisc.edu/releases/2.0.0/release-p2.html
http://vdt.cs.wisc.edu/advisories/glexec-0.5.36.html

We recommend updating installations of VDT 1.10.1 and 2.0.0 right away.
Please submit problems, requests, and questions at:
https://oim.grid.iu.edu/gocticket/

Thank You,
OSG Grid Operations Center (GOC)
Submit a GOC ticket: https://oim.grid.iu.edu/gocticket
Email/Phone: goc@opensciencegrid.org, 317-278-9699
GOC Homepage: http://www.opensciencegrid.org/ops
RSS Feed: http://osggoc.blogspot.com
</verbatim>
The notice above is for a security update to the Glexec software and should be considered urgent
for sites running Glexec. If a site is not running Glexec then it is not urgent.

Another example notice is shown below, which is a more general software update
but includes a security update for Java.  Most sites use Java in one form or another
and so it should be considered important for all sites but since it was not identified
specifically as a Security Update it is not critical.
<verbatim>

-------- Original Message --------
Subject: VDT 1.10.1y released
Date: Thu, 18 Jun 2009 15:22:38 +0000 (UTC)
From: goc@OPENSCIENCEGRID.ORG
To: goc@OPENSCIENCEGRID.ORG

Hi,

The release instructions follow:

The VDT team has released an update to VDT 1.10.1.

This release includes:
- a security update for Java

Show More

- bug fix updates for Bestman, the SRM Fermi client, the Generic
Information Provider (GIP), and RSV.
- an update to the PPDG cert scripts

Further details and instructions to update the affected VDT packages
are located here:
http://vdt.cs.wisc.edu/releases/1.10.1/release-y.html

Once again, the new VDT Updater can be used to update your software.
See the URL above for more information.

After updating the VDT packages on your installation, you will need to
run:

pacman -update osg-version

in order to update your osg-version number.

Please submit problems, requests, and questions at:
https://ticket.grid.iu.edu/goc

Thank You,
OSG Grid Operations Center (GOC)
Email/Phone: goc@opensciencegrid.org, 317-278-9699
GOC Homepage: http://www.opensciencegrid.org/ops
RSS Feed: http://osggoc.blogspot.com

</verbatim>

---+++ History of VDT Advisory Notices
http://vdt.cs.wisc.edu/advisories/index.html

---++ Maintain up-to-date Trusted CA information
The Trusted CA certificates and their associated Certificate Revocation Lists (CRL) are used
for every transaction on a resource which establishes an authenticated network
connection based on the user's proxy certificate. In order for the authentication
to succeed the user's certificate that generated the proxy must have been issued
by one of the CAs in the Trusted CA directory, and the user's certificate
must not be listed in the CRL for that CA. This is handled at the certificate
validation stage even before the authorization check which will provide the mapping
of an authenticated user to a local account UID/GID.
If the information about the Trusted CAs is not kept up to date then it is possible that
all transactions with your site will start to fail.

There are two services that should be running in order to keep the CA certificate
information current, *vdt-update-certs* and *fetch-crl*.
There is a tool called *vdt-ca-manage* which has many useful features and
also is used to specify where the Trusted CA certificates are to be stored on your machine.

The example below shows the use of *vdt-ca-manage* and turning on the
*vdt-update-certs* and *fetch-crl* services for an installation of the OSG 1.2 client
package but it is similar for any package installation which requires CA certificates.

<verbatim>
OSG Client 1.2 install

# cd /opt/pacman
# wget http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-3.28.tar.gz

# tar --no-same-owner -xzvf pacman-3.28.tar.gz

# cd pacman-3.28
# . ./setup.sh
# cd /opt
# mkdir osg-client-1.2
# cd osg-client-1.2/

# pacman -get http://software.grid.iu.edu/osg-1.2:client
Do you want to add [http://software.grid.iu.edu/osg-1.2] to [trusted.caches]? (y/n/yall): y
Do you want to add [http://vdt.cs.wisc.edu/vdt_200_cache] to [trusted.caches]? (y/n/yall): y
Beginning VDT prerequisite checking script vdt-common/vdt-prereq-check...

All prerequisite checks are satisfied.



========== IMPORTANT ==========
Most of the software installed by the VDT *will not work* until you install
certificates.  To complete your CA certificate installation, see the notes
in the post-install/README file.


The VDT version 2.0.0 has been installed.


The OSG Client package OSG version 1.2.0 has been installed.

# . ./setup.sh

# vdt-ca-manage --help setupca
vdt-ca-manage setupca --location [root|local|<PATH>] --url [vdt|osg|<URL>]
  Location:
    root  - install into /etc/grid-security
    local - install into $VDT_LOCATION/globus/share
    PATH  - install into PATH (e.g. /nfs/certificates)

  URL:
    vdt - use the VDT convenience distribution
    osg - use the OSG GOC distribution
    URL - use the distribution at URL (e.g. http://your.site.edu/ca-certificates-manifest-file)


# vdt-ca-manage setupca --location local --url osg
Setting CA Certificates for VDT installation at '/opt/osg-client-1.2'

Setup completed successfully.


# vdt-control --enable vdt-update-certs
running 'vdt-register-service --name vdt-update-certs --enable'... ok
# vdt-control --on vdt-update-certs
enabling cron service vdt-update-certs... ok

## Edit vdt/etc/vdt.logrotate to change rotation frequency and retention period
## from daily - 1 week to monthly - 1 year
# diff vdt/etc/vdt.logrotate vdt/etc/vdt.logrotate.orig
2,3c2
< # daily
< monthly
---
> daily
6,8c5
< # rotate 7
< # Keep a year's worth
< rotate 12
---
> rotate 7

# vdt-control --enable vdt-rotate-logs
running 'vdt-register-service --name vdt-rotate-logs --enable'... ok
# vdt-control --on vdt-rotate-logs
enabling cron service vdt-rotate-logs... ok


# vdt-control --enable fetch-crl
running 'vdt-register-service --name fetch-crl --enable'... ok
# vdt-control --on fetch-crl
enabling cron service fetch-crl... ok

# vdt-control --list
Service                 | Type   | Desired State
------------------------+--------+--------------
fetch-crl               | cron   | enable
vdt-rotate-logs         | cron   | enable
vdt-update-certs        | cron   | enable
condor                  | init   | do not enable
globus-ws               | init   | do not enable

# crontab -l
55 * * * * /opt/osg-client-1.2/vdt/sbin/vdt-update-certs-wrapper --vdt-install /opt/osg-client-1.2 --called-from-cron
0 0 * * * /opt/osg-client-1.2/vdt/bin/vdt-rotate-logs
11 0,6,12,18 * * * /opt/osg-client-1.2/fetch-crl/share/doc/fetch-crl-2.6.6/fetch-crl.cron

# cat vdt/var/ca-certs-version
1.9
</verbatim>

Notice that the example ends with displaying the current version of the CA certificate package. You can compare
this version with the distribution point at http://software.grid.iu.edu/pacman/cadist/ to see if they are the same,
in which case you have the most recent version.

%RED%Also add example of showing log info on the fetch-crl status.%ENDCOLOR%


---++ Maintain up-to-date VO and user access information
The prefered method to maintain accurate VO and user access information is to
[[ReleaseDocumentation.InstallConfigureAndManageGUMS][install and configure GUMS]].
All of the services you install at your site which require authentication and authorization
for outside users from the various VOs on OSG should be configured to [[ReleaseDocumentation.FullPrivPreConfig][use this GUMS server]]
as the source for authorization (user mapping) information.
You need to carefully check the documentation for each service you install (CE, SE, VOMS, ...) to make sure that
it is configured to use your GUMS server.
If the grid services at your site require the use of the VOMS extended attributes (FQANs) from the users' proxy certificates then
you must use a GUMS server since the alternative described below is not capable of using these attributes.

The alternative to running a GUMS server is to 
[[ReleaseDocumentation.LocalAuthPreConfig][use the edg-mkgridmap tool]] which runs via cron to get updated
information on users from the VOMS servers and generate a grid-mapfile.
If you have grid services installed on more than one node then you will need to have multiple
copies of this grid-mapfile which can lead to confusion, opportunities for errors and reduced reliability.
This is one reason for using a GUMS server. As mentioned above, if the use of VOMS extended attributes is required
at your site then you need to use a GUMS server and not the edg-mkgridmap tool.

---++ Respond to requests from the OSG Security Officer
In many ways, the most important security requirement for running a site is that you communicate
with the OSG Security Officer and the Security Team. These people are listed [[Security.SecurityTeamMembers][here]].
When issues come up or incidents occur there is usually some manual intervention
required and this means reading email from the OSG security team or taking phone calls (in the most urgent cases).
In order to be sure that OSG can communicate with the site administrator responsible for security of a site
there is the periodic update of contact information in OIM (as described above).

If you have confidential information to provide to the OSG security team it can be sent via encrypted email
(see description below) or submitted as a [[https://ticket.grid.iu.edu/goc/security][security ticket to the GOC]]
(requires a registered X509 certificate in your browser). Of course, you can always you the telephone as well
for secure communications (call the [[http://www.grid.iu.edu/][GOC]]
or [[Security.SecurityTeamMembers][individual security team members]]).



---+++ Incident Response Drills
OSG occasionally conducts security drills (think fire drill) with some or all of the OSG sites.
Since we (thankfully, knock wood) don't have many actual incidents it is important that the
communications and response patterns needed for a real incident are exercised to make sure
they actually function. There was a rather detailed drill conducted with the Tier1 centers (BNL, FNAL)
and an expectation that there will be a drill including Tier2 centers in the future.
There is not currently (July 2009) a drill being planned including the Tier3 centers (beyond the OIM contact information update)
but it is likely some type of drill will be planned in the future.
When such a drill occurs the emails are very clearly marked as indicating a drill rather than
a real incident.

---+++ Periodic Security Controls Review
OSG has modeled its security processes along [[http://csrc.nist.gov/publications/PubsFIPS.html][guidelines developed by NIST]]
and adapted to the special circumstances of OSG.  
This includes a periodic cycle of risk analysis, security controls implementation and deployment,
and assessment of how well the controls are functioning.
This has been carried out for the core assets of OSG (VDT, GOC services, ...) and some of the RSV probes
that monitor the security configuration of the site are controls that extend out to sites.
The update of OIM contact information is another security control that touches sites.
As this process goes forward and when new risks are identified there may be additional controls
deployed.

---++ Communicate Securely - working familiarity with X.509 (SSL) and PGP (!GnuPG)
There is an [[Documentation.OsgFaq#Security_and_Certificates][FAQ on Security and Certificates]] that answers several
questions about using certificates in OSG.
In particular, note the question "My web browser does not trust the DOEGrids CA?" and answer
at the bottom of that page.
Web browsers are putting up more informative (scarier?) messages these days when you try to access
a web site that uses an SSL certificate from a CA which is not trusted by your browser.
Most of the grid CAs, including the DOEGrids CA used extensively by OSG,
are not automatically trusted in your web browser.  It is helpful to follow the instructions in the FAQ answer
and install the ESnet Root CA & DOEGrids CA certificates into your browser from the trusted
repository https://www.tacar.org/repos.

In addition to trusting server certificates, there are uses for having your personal certificate (and private key)
installed in your web browser so it can be used to authenticate to web sites, such as [[https://oim.grid.iu.edu/oim/home][OIM]] mentioned above.
If you need a personal certificate you can follow the [[Documentation.CertificateGet][instructions at this link]].

The important communications from OSG on security matters are signed using the PGP key for security@opensciencegrid.org.
Information about how to verify these messages, send encrypted messages and other details are shown
[[Security.SecureEmail][at this link]].
Using PGP for these messages rather than SMIME based on grid certificates is useful for several reasons
including the fact that the PGP trust is separate from the X.509 PKI trust basis and can still be used
if something compromises the PKI trust used for all grid computational transactions.

---++ Search log files

---++ Be familiar with the OSG Security web site
Information regarding incident handling, security best practices, awareness training, procedures, etc.
is linked from the main [[Security.WebHome][OSG Security twiki page]].  You should familiarize yourself with
this information and browse through it *before* you have a security incident.  Especially the sections
marked *URGENT* and *Security Awareness for OSG Participants*.
If you have any questions about any of the material *ASK* (see below).

---++ If you have a question, ASK
You can always ask questions of the OSG security team by sending email to <tt>security@opensciencegrid.org</tt> or
contact one of the [[Security.SecurityTeamMembers][team members]] directly. Remember, there are no stupid questions, only stupid answers.

<!-- %BOTTOMMATTER% -->

-- Main.DougOlson - 07 Jul 2009
