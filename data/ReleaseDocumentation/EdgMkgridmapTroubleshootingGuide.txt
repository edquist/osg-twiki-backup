%META:TOPICINFO{author="X509_2fDC_3dorg_2fDC_3ddoegrids_2fOU_3dPeople_2fCN_3dSuchandra_20Thapa_20757586" date="1295552145" format="1.1" reprev="1.29" version="1.29"}%
%META:TOPICPARENT{name="TroubleshootingComputeElement"}%
---+edg-mkgridmap Troubleshooting Guide

%DOC_STATUS_TABLE%
%TOC{depth="2"}%


---++ About This Document
This document aims to provide assistance in troubleshooting problems  related to creation and usage of the =edg-mkgridmap= script. The =edg-mkgridmap= script is used to maintain the CE host grid-mapfile at sites that do not relay on GUMS servers by downloading information from VOMS servers. It runs every so often on a gatekeeper, contacts the list of VOMS servers specified in the configuration file (edg/etc/edg-mkgridmap.conf), and creates a grid-mapfile.

%STARTINCLUDE%
%EDITTHIS%
---++ Common Problems
   * [[#NoMapfile][grid-mapfile not created]]
   * [[#UserNotincluded][Local users not included in the grid mapfile]]
   * [[#CodeSixtyfour][Error code 64]]
   

---++ Troubleshooting Procedure
In case of problems first of all check <tt>$VDT_LOCATION/edg/log/edg-mkgridmap.log</tt> . This file lists:
   * any errors accessing individual voms servers or any general errors
   * any mappings eliminated from the =$VDT_LOCATION/osg/etc/osg-user-vo-map.txt= and =$VDT_LOCATION/osg/etc/osg-supported-vo-list.txt= files where the unix account a user would be mapped to does not exist.  There is an =$VDT_LOCATION/osg/etc/osg-undefined-accounts.txt= file created that lists these accounts.
   * changes from the last time the script was run.

There is also a "last_checked" file in =/etc/grid-security= that tells you the last time the cron process was run successfully (the =grid-mapfile= only gets updated if there is a difference from the previous run).
<pre class="rootscreen">
%UCL_PROMPT_ROOT% /etc/grid-security
-rw-r--r--  1 root     root     1162888 Jul 12 02:14 grid-mapfile
-rw-r--r--  1 root     root           0 Jul 12 08:14 grid-mapfile.last_checked
</pre>
#NoMapfile
---+++=/etc/grid-security/grid-mapfile= not created.
   * Run =vdt-control --list= and make sure service is enabled.
   * Run =crontab -l= and verify that the script is run by cron.
   * Run the script by hand and verify that a vald mapfile got created.
#UserNotincluded
---+++Local users not included in the =/etc/grid-security/grid-mapfile=
Check  =$VDT_LOCATION/edg/etc/edg-mkgridmap.conf=. It should contain:
<pre class="file">
#### GMF_LOCAL: gmf_local grid-mapfile-local
gmf_local /etc/grid-security/grid-mapfile-local
</pre>
Then make sure the file =/etc/grid-security/grid-mapfile-local= contains the desired  DN->user mapping.

#CodeSixtyfour
---+++Error code 64
This type of error occurs when the script established contact with the VOMS server but the requested group or subgroup does not exist there.  It is really a 'not found' type error.  It is usually caused by a bad entry in the =edg-mkgridmap.conf= file.

In the example below the configuration file contains a request for the VOMS server to send a list of all members of  the uscms VO belonging to a non-existent =/uscms/production= group.

Configuration file =VDT_LOCATION/edg/etc/edg-mkgridmap.conf= entry:<br>
<pre class="file">
 group vomss://voms.fnal.gov:8443/voms/uscms/production uscms01
</pre>

Command run on CE node:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% source $VDT_LOCATION/setup.(c)sh 
%UCL_PROMPT_ROOT% cd $VDT_LOCATION/edg/sbin 
%UCL_PROMPT_ROOT% ./edg-mkgridmap
   <i>... output....
  voms search(https://voms.fnal.gov:8443/voms/uscms/production/services/VOMSAdmin?method=listMembers): /voms/uscms/production/services/VOMSAdmin

   Exit with error(s) (code=64)</i>
</pre>

On the VOMS host you are attempting to access, the following error can be seen in the =TOMCAT_LOCATION/logs/voms-admin.VO_NAME.log=

<pre class="file">
2005-05-26 15:51:04,003 INFO  [Ajp13Processor[8892][1]]  Connection from "131.225.82.73" by 
        /DC=org/DC=doegrids/OU=Services/CN=ce_host (serial 4511) -  service.InitSecurityContext
2005-05-26 15:51:04,004 INFO  [Ajp13Processor[8892][1]]  listMembers ("/uscms/production") -  admin.VOMSAdminSoapBindingImpl
2005-05-26 15:51:04,013 ERROR [Ajp13Processor[8892][1]]  org.edg.security.voms.service.NotInDatabase: 
       Not in database: group "/uscms/production" -  connection.Database
 </pre>

---++ Useful Options for edg-mkgridmap troubleshooting
   
   * [--help] 
   * [--version] 
   * [--conf=config_file]  Default configuration file is at $VDT_LOCATION/edg/etc/edg-mkgridmap.conf
   * [--output[=output_file]] 
   * [--verbose]


%STOPINCLUDE%
%BR%
---+++ Who to contact

For further assistance consult our [[ReleaseDocumentation/HelpProcedure][Help]] listing page.

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = IwonaSakrejda

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = ComputeElement

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Troubleshooting
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %NO%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%


 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = ElizabethChism
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %IN_PROGRESS%


############################################################################################################
-->



%META:TOPICMOVED{by="ForrestChristian" date="1166047098" from="Integration.EdgMkgridmapTroubleshootingGuide050" to="Integration/ITB_0_5.EdgMkgridmapTroubleshootingGuide"}%
