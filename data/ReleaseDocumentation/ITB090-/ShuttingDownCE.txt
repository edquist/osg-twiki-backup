%META:TOPICINFO{author="RobGardner" date="1192746289" format="1.1" reprev="1.24" version="1.24"}%
%META:TOPICPARENT{name="ComputeElementInstall"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

In VDT 1.6.1 and later, all services (=/etc/init.d=, =/etc/xinetd.d=, =cron=) should be turned on/off using the =$VDT_LOCATION/vdt/sbin/vdt-control= script.  This section will provide just a general overview. There is a <i>man</i> page available for the script, just type =man vdt-control=. You can also [[http://vdt.cs.wisc.edu/releases/1.6.1/man/vdt-control.html read the man page online]].

You need to be root to run this script.

---++ View "vdt-control" services
To view all services controlled by <i>vdt-control</i>:
<pre class="screen">
# <b>source $VDT_LOCATION/setup.sh </b>
# <b>vdt-control --list </b>
Service            | Type   | Desired State
-------------------+--------+--------------
fetch-crl          | cron   | enable
vdt-rotate-logs    | cron   | enable
gris               | init   | do not enable
globus-gatekeeper  | inetd  | enable
gsiftp             | inetd  | enable
mysql              | init   | enable
globus-ws          | init   | enable
edg-mkgridmap      | cron   | do not enable
gums-host-cron     | cron   | enable
MLD                | init   | enable
apache             | init   | enable
tomcat-5           | init   | enable
condor             | init   | enable
gratia-condor      | cron   | enable
</pre>

%NOTE% This is output from a fully enabled installation.
---++ Shutdown "vdt-control" services
To shutdown <em>all</em> services:

<pre class="screen">
# <b>source $VDT_LOCATION/setup.sh </b>
# <b>vdt-control --off </b>
</pre>
---++ Shutdown other services
To shutdown <b>individual</b> services:

<pre class="screen">
# <b>source $VDT_LOCATION/setup.sh </b>
# <b>vdt-control --off  Service </b>
</pre>

---+++ !!/ etc/xinetd.d services
For =/etc/xinetd.d= services, the script will be removed from the directory.  The =xinetd.d= daemon will be restarted.

---+++ !!/etc/init.d services
For =/etc/init.d= services, the script will be removed from the directory and the service will be stopped.

---+++ !!crontabs
For =root= cron entries, the entry will be removed from the crontab.

---++ Shutdown VDT 1.6.0 and earlier

Earlier versions of the VDT did not contain the ==vdt-control== script.  For these earlier versions of the VDT, it is necessary to stop the services by manually running the ==/etc/init.d== control scripts.  Some or all of the following will need to be run depending on what was installed on the system:

<pre class="screen">
# <b>service tomcat-5 stop </b>
# <b>service apache stop </b>
# <b>service MLD stop </b>
# <b>service mysql stop </b>
# <b>service edg-crl-upgraded stop </b>
# <b>service gris stop </b>
# <b>service bdii stop </b>
# <b>service globus-ws stop</b>
</pre>

=/etc/xinetd.d= services can be disabled by either removing the service configuration from the =/etc/xinetd.d= direcotry, or setting <tt>disable=yes</tt> in the service's =/etc/xinetd.d= configuration file and restarting xinetd.

Pay special attention to  [[ComputeElementInstall#CE_deprecated_components_for_thi][Deprecated components description in the new CE Install guide]] as there are some files in the /etc/rc.d/init.d/ directory left over from previous VDT versions which have to be removed manually.  Usually vdt-control will let you know if they are in the way when it comes time to do =vdt-control --on=.  For  an OSG 0.4.1 Installation please note also the old [[ReleaseDocumentation.OSGShutdownGuide][OSG 0.4.1 Shutdown Guide]]


---++ Additional considerations

---+++ !!<nop>MySql / <nop>Integration.MonALISA / Globus web services
Bear in mind that <nop>Integration.MonALISA also uses a database backend.  Here is how to find out whether [[MonALISA][Integration.MonALISA]] is running, and if so, under what user: If you are using OSG 0.4.1 or higher, <nop>Integration.MonALISA is most likely using the postgres database.  

If you have installed/activated Globus web services (<i>/etc/init.d/globus-ws</i>), it will be using a <i>MySql</i> database as it's persistent storage for the current state of the services.

<pre class="screen">
#  <b>ps -efwww | grep -i monalisa </b>
</pre>

and for the mysql or postgres daemons associated with !Integration.MonALISA, check using:

<pre class="screen">
#  <b>ps -efwww | grep -i mysql </b>
</pre>


Or:

<pre class="screen">
#  <b>ps -efwww  | grep -i post[master,gres] </b>
</pre>

If you are running a Rocks cluster, be sure to kill only the OSG-related mysql processes and avoid inadvertently stopping any cluster-related ones.  In general, pay attention if you need to kill any database-related processes explicitly; for example, look to make sure they are related to <nop>Integration.MonALISA or Globus web services, and/or are running out of your VDT installation area before stopping them.

If you are shutting down in order to prepare for a new OSG install *in a different directory*, you shouldr emove the =/etc/init.d/MLD= link if it exists, as this will link to the <i>ML_SER</i> in your old <i>$VDT_LOCATION</i>.

Also check to see whether there are any stray OSG-related processes, such as run-mis-ci.sh, globus-job-manager, and so forth still running, and kill them manually if necessary.  


<pre class="screen">
#  <b>/etc/init.d/tomcat-5 stop </b>
#  <b>/etc/init.d/apache stop </b>
#  <b>/etc/init.d/mysql stop </b>
</pre>


%STOPINCLUDE%
%BR%
%COMPLETE1% %BR%
%RESPONSIBLE% Main.RobGardner - 18 Oct 2007 %BR%
%REVIEW%

<!-- Major updates
 Main.BurtHolzman - 30 Dec 2005
 Main.NateMueller - 14 Apr 2005<br>
 Main.AlanSill - 14 Apr 2005<br>
 Main.JohnWeigand - 18 Jul 2005 - added gsiftp2 to procedures<br>
 Main.AlanSill - 12 Dec 2005 - added web services shutdown and check<br>
 Main.ChristopherBaumbauer - 08 Mar 2006 - Added steps to disable globus, shutdown globus-ws, web services running under tomcat, and redid the Integration.MonALISA shutdown instructions to go down cleaner<br>
 Main.AlanSill - 22 Mar 2006 - Slight tweaks to above.<br>
 Main.RobQ - 01 May 2006<br>
 Main.JohnWeigand - 24 Jan 2007 - for OSG 0.5.2    %BR%
-->

%META:TOPICMOVED{by="RobGardner" date="1192746289" from="Integration/ITB_0_7.OSGShutdownGuide" to="Integration/ITB_0_7.ShuttingDownCE"}%
