%META:TOPICINFO{author="AnneHeavey" date="1194988276" format="1.1" reprev="1.14" version="1.14"}%
---+ How do I get or renew a DOEGrids Digital PKI/X509 Personal Certificate using a browser?
%TOC%
---++Introduction
If you don't know what a PKI certificate is or what it is used for, see [[CertificateWhatIs][What is a certificate?]].

This document describes how to get a *personal* certificate (also called a grid user certificate), *via your browser*, from DOEGrids, a U.S. government certificate authority (CA). DOEGrids is recognized by all OSG resources. Other CAs may be used; if your virtual organization (VO) requires that you get a certificate from a different CA, [[http://www.opensciencegrid.org/Support_Centers][contact your VO Support Center]] for instructions.

To use the *script method* to obtain your personal certificate, see [[ReleaseDocumentation/UserCertificate][User Certificate]].

For instructions for getting DOEGrids *service* and *host* certificates, *you're in the wrong place*. See [[ReleaseDocumentation/GetHostCertificates][Get Host Certificates]]. 

---++ Basic requirements for DOEGrids personal certificate
<noautolink>
   * Netscape, Mozilla, or Firefox requires JavaScript support.
   * Internet Explorer requires ActiveX (at the least, in the Internet Options control panel, go to the Security Settings tab and the Advanced settings, and enable Prompt for Download signed ActiveX controls). If you're using Internet Explorer, you need the Microsoft Hotfix Q323172.
   * Macintosh users: The process does not work with Safari at this time. Use Firefox. 
</noautolink>

---++ Before you get your DOEGrids personal certificate
Before starting, determine which affiliation to choose (this corresponds to a Registration Authority, RA). See the list of RAs on the right side of the [[http://www.doegrids.org/][DOEGrids home page]].

You'll also need to list a sponsor, an individual known to the RA who has met you in person and can vouch for your identity. Your VO can help you identify the appropriate sponsor.

Think of a unique passphrase.

Note that a DOEGrids certificate is valid for one year. You will receive email notices from DOEGrids prior to certificate expiration so that you can renew it in time to avoid an interruption in service.

---++ Requesting a DOEGrids personal certificate
%NOTE% There is an [[ReleaseDocumentation/UserCertificate#Alternate_non_browser_way_to_get][alternate, non-browser method to get User Certificate]] documented in the release documentation.

Print out these instructions, or copy them somewhere so that you can access them without using a browser.

   1. Close all browser sessions. Then establish a new browser session using the same user account on the same machine and same browser (and browser version) as the one in which you plan to initially use your certificate.
   2. Go to the DOEgrids Subscriber Enrollment page [[http://pki1.doegrids.org/]].
   3. Select the Enrollment tab. (We are intentionally steering you away from the front page of the DOEGrid site.)
   3. Select New user on the left. This takes you to the DOEGrids Subscriber Enrollment page, which contains a form for you to fill out. Fill out the fields as follows:
      * Subscriber's Identity: Enter your full name as you want it to appear in the certificate. Enter your commonly used email address.
      * Contact Information: Enter the email address appropriate for the RA (affiliation) you choose. (For example, the FNAL approval process requires that this be a fnal.gov address.) Enter your office phone number at your home institution. Select your affiliation (also called "Registration Authority") from the drop-down menu.
      * Sponsor Information: Enter the name of your sponsor (your sponsor must be able to vouch for you; he or she is not responsible for approving or denying your request; approval is handled by another process). Enter the sponsor's email address (again, some affiliations require a corresponding email address). Enter the sponsor's telephone number.
      * Additional Comments: Enter as needed. ?Challenge Phrase Password (Optional): It should be required to enter a password! You will need one to export and import your certificate from/to applications, in addition to revocation. Enter and a password, and confirm it.
      * Public/Private key information: No information to enter ?Microsoft Hotfix May be Required: No information to enter 
      * Cryptographic Provider:
         * Linux or other Unix Mozilla/Firefox/Netscape users: Select 2048(High grade). 
         * Windows Mozilla/Firefox/Netscape users: Select Strong Cryptographic Provider.
         * Windows Internet Explorer users: Select Microsoft Enhanced Cryptographic Provider.
      * Click Submit. This generates your private key and stores it in the security database (password and certificate store) associated with your browser, user account, and system.
   5. In the dialog box that tells you to only allow trusted sites to request a certificate for you and asks you if you want to proceed, click Yes.
   6. Your browser should then point to a page that says "Request successfully submitted." and displays a request number. Make a note of the request number in case you need to follow up on anything.

---++ Getting your certificate and importing it into your browser

You will receive email notification from DOEGrids stating whether your request was approved or denied. The email text for an approved request will look similar to the text below. Read it carefully and follow the instructions:
<verbatim>
  Your Personal certificate request has been processed successfully. 
  SubjectDN= CN=Your Name xxxxxx,OU=People,DC=doegrids,DC=org 
  IssuerDN= CN=DOEGrids CA 1,OU=Certificate Authorities,DC=DOEGrids,DC=org 
  notAfter= Sep 30, 2007 11:45:39 AM ?  notBefore= Sep 30, 2006 11:45:39 AM 
  Serial Number= xxxxxx

To get your certificate, please follow this URL: 
https://pki1.doegrids.org:443/displayBySerial?op=displayBySerial&serialNumber=xxxx 
And then click the 'Import your certificate' button at the bottom of this page. 

Note: Some browsers import successfully without indicating this to you.
  
Attention:  You need to be running the same browser, on the same machine, logged in as the same user, 
as you were when you made the certificate  request.

After importing your certificate, export your certificate and the  private key for Grid use. 
Kindly follow the instructions on http://www.doegrids.org/pages/cert-request.html#Globus
Please contact your RA if there is any problem.
</verbatim>
Notes:

   * If you are using Mozilla or Firefox and have set a Master Password on your Software Security Device (the password and certificate database), a dialog box requesting the Master Password may appear. If so, enter the password to permit the importation of the certificate.
   * To import your certificate into another browser on the same or a different machine, you first need to export it from the initial browser into a file. For information on importing certificates into a variety of browsers, visit the [[http://lcg.web.cern.ch/LCG/users/registration/load-cert.html][LCG Users Registration page]] .

---++ Renewing a DOEGrids personal certificate
Currently, the DOEGrids site instructs you to replace your current certificate with a new one, rather than to renew it. If your old one has expired, request a new certificate according to the instructions above.

To renew a certificate, follow these steps:
   1. Go to the [[https://pki1.doegrids.org/][DOEgrids Subscriber Enrollment]] page .
   2. Select "Replacement Certificate".
   3. Read the page carefully.
   3. Select the "High Grade" key length.<!-- appropriate Cryptographic Provider:
      * Linux or other Unix Mozilla/Firefox/Netscape users: Select 2048(High grade) 
      * Windows Mozilla/Firefox/Netscape users: Select Strong Cryptographic Provider. 
      * Windows Internet Explorer users: Select Microsoft Enhanced Cryptographic Provider. -->
   4. When you submit the form, it will  say "Your cert has been imported into the browser!" 
<!-- prompt you: "This website is requesting a new certificate on your behalf. You should allow only trusted websites to request a certificate for you. Do you want to request a certificate now?" *Click Yes*. 
   5. It will prompt you to "choose a certificate". Your old DOEGrids certificate should be displayed; *select it*.
   6. Then it will prompt: "This website is adding one or more certificates to your computer. Allowing an untrusted website to update your certificates is a security risk. The website could install certificates you do not trust which could allow programs you do not trust to run on this computer and gain access to your data. Do you want this program to add the certificates now? Click Yes if you trust this web site. Otherwise, click No." *Click Yes*.
   7. Then you will see a message that your certificate has been successfully imported. *Click OK*.
   8. It will display your certificate in base 64 encoded format.
   9. Check your email. You should have received a message from DOEGrids similar to the following:
<verbatim>
Your Personal certificate request has been processed successfully.  
SubjectDN= CN=Your Name xxxxxx,OU=People,DC=doegrids,DC=org  
IssuerDN= CN=DOEGrids CA 1,OU=Certificate Authorities,DC=DOEGrids,DC=org   
notAfter= Sep 30, 2006 11:45:39 AM ?  notBefore= Sep 30, 2005 11:45:39 AM 
Serial Number= xxxxxx
To get your certificate, please follow this URL:  https://pki1.doegrids.org:443/displayBySerial? (more characters) 
And then click the 'Import your certificate' button at the bottom of this page. ?  [Note: Some browsers import 
successfully without indicating this to you.]
 
Attention:  You need to be running the same browser, on the same machine, logged   in as the same user, as you were when you made the certificate  request.

After importing your certificate, export your certificate and the  private key for Grid use. 
Kindly follow the instructions on http://www.doegrids.org/pages/cert-request.html#Globus
Please contact your RA if there is any problem.
</verbatim>
-->
Assuming you saw and responded to the set of prompts as listed above, your new certificate is already imported. The way you check for it depends on your browser. <!--If it hasn't been imported, follow the link to the URL given in the email message and click the _Import_ button, as directed in the email message. -->

---++ Exporting (Backing up) your certificate
Follow the [[http://lcg.web.cern.ch/LCG/users/registration/load-cert.html][LCG instructions for importing your certificate]] , but *select "Export"* instead of "Import". (Firefox calls it "backup".) You will need to make up a password and enter it, in order to export your private key. Remember the password!

For use on grid resources or submit machines, copy it to your =$HOME/.globus= directory on that machine, then see [[ReleaseDocumentation/UserCertificate][User Certificate]] for instructions on converting it to the proper format.


-- Main.AnneHeavey - 13 Sep 2006; update 6/25/07
