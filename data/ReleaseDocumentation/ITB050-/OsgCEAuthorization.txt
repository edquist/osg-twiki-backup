%META:TOPICINFO{author="ForrestChristian" date="1166047098" format="1.1" version="1.11"}%
%META:TOPICPARENT{name="DocumentationTable050"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->
d89 1
---+!!<nop>OSG CE Authorization
%TOC%
%STARTINCLUDE%


---++Introduction
The Authorization mode determines who can access your resources and how. A good description of the available authorization scenarios can be found on  the
<a href="http://grid.racf.bnl.gov/GUMS/guide_architecture.html#GUMS_in_the_grid_architecture">
GUMS web site</a>.  Of those discussed, OSG supports three, namely: Grid3/Local, Compatibility, and Full Privilege. All three use VOMS. Here's a brief explanation of each follows.



---+++<nop>Grid3 or local <nop>GridMap file
Authorization is performed only via the <i>grid-mapfile</i> on the Compute Element (CE) node. 

The grid-mapfile is either created manually on each CE node, or created using the <i>edg-mkgridmap</i> root cron entry based upon the configuration file <i>edg-mkgridmap.conf</i> file located in <i>$VDT_LOCATION/edg/etc</i>. This file is installed by the VO package which can be updated to add or update VO information. The OSG Operations sends update announcements to each support center.  VOMS is used; GUMS is not used. 

Synchronizing all the <i>grid-mapfiles</i> for multiple CE nodes needs to be done manually in this case.  You may prefer this configuration if:
      <UL><LI>You are a small site (one gatekeeper) and,
               <LI>You deal with a small set of fairly static VOs
               <LI>You are <b>not</b> supporting <i>role-based</i> authorizations (voms proxies with extended attributes)
       </UL>

---+++<nop>Compatibility
Authorization is performed via the grid-mapfile on the gatekeeper, and the file is created by GUMS.  

GUMS polls VOMS Admin periodically and creates/updates the grid-mapfile. If the site has only one GUMS server (one communication point to VOMS), centralized mapping is enabled. Given the GUMS configuration options, account pools (many accounts, one-to-one DN-to-account mapping) can be implemented as well as group accounts (many-to-one DN-to-account mapping).  You should consider this configuration if:
      <UL><LI>Your gatekeeper(s) or service must be configured using a grid-mapfile (i.e. you have tools or services that manipulate this file directly, without passing through globus)
                <LI>You'd rather approach with caution than jump right into running GUMS 24/7.
       </UL>

---+++Full Privilege (role-enabled) 
This scenario implements the PRIMA authorization module with GUMS and does not use the grid-mapfile.  The gatekeeper uses a callout to PRIMA upon receipt of each request, PRIMA forwards the request to the GUMS web service which performs the dynamic mapping. PRIMA can process FQAN (Fully Qualified Attribute Names), thus enabling mapping based on VO groups and roles as defined in VOMS. 
d29 2
The flowchart below will help you decide what kind of configuration you should set up.
<pre>
             |
             |
  --------------------------                  ----------------------
  | Is your site going to  |        YES!      | Refer to           |
  |  support role-based    |----------------->| <a href="#Full_Privilege_Configuration">Full privilege</a>     |
  |    authorization?      |                  | <a href="#Full_Privilege_Configuration">configuration</a>      |
  | support role-based     |----------------->| Full privilege     |
  | authorization?         |                  | configuration      |
  --------------------------                  ----------------------
             |                                           
          NO |
             |
  ------------------------------               --------------------------
  | Do you want to use account |     YES!      | Refer to compatibility |
  | pools at your site?        |-------------->| configuration          |
  ------------------------------               --------------------------
             |                                           
          NO |
             |
  ------------------------------               --------------------------
  | Would you like to use one  |     YES!      | Refer to compatibility |
  | gridmap file to control    |-------------->| configuration          |
  | all your gatekeepers?      |               --------------------------
  ------------------------------               
             |
          NO |
             |
  ----------------------- 
  | Refer to Grid3/Local|
  | configuration       |
  -----------------------
</pre>

We'll present the "how to" information in order of simplest (Grid3) to most sophisticated (full privilege) so that you can implement step-by-step and test as you go, if you like.
---++Changes effective with this release
Prior to this release, the <i>edg-mkgridmap</i> script run as a system  service and installed in <i>/etc/init.d</i>. With this release, it is being installed as a <i>root</i> crontab entry.  
If you are upgrading from a prior release, you must <i>stop</i> the <i>edg-mkgridmap</i> daemon and delete that entry from system services.
<b>Note:</b> It is not installed/configured by default.
---+++edg-mkgridmap
   $ %I% %RED% *NOTE* %ENDCOLOR%: It is not installed/configured by default.

---++ Grid3 or Local configuration
In this mode, authorization is performed only via the <i>/etc/grid-security/grid-mapfile</i> on the CE (gatekeeper) node. The <i>grid-mapfile</i> is created/maintained either:
   *  manually on each gatekeeper, 
   * or created from the VOMS Admin servers for each VO you are supporting using the <i>edg-mkgridmap</i> script.  VOMS is used; GUMS is not used. If you are supporting mutiple CE nodes for your site, synchronizing all the <i>grid-mapfiles</i> across these nodes is difficult.
Using a configuration file that identifies the VOMS servers for each VO your CE node supports, the <i>edg-mkgridmap</i> script will  pull down the VO's membership from those VOMS servers and create a new <i>grid-mapfile</i> with each invocation.

The <i>edg-mkgridmap</i> script is run as a cron entry with the times set randomly when  <i>configure_edg_make_gridmap</i> is run:
<pre>
<b>Note: It is not installed/configured by default.</b>
<pre class="programlisting">
   $ %I% %RED% *NOTE* %ENDCOLOR%: It is not installed/configured by default.
%NOTE% It is not installed/configured by default.

Before you configure your CE node to use the <i>edg-mkgridmap</i> script via cron, you should probably (all described in subsequent sections):
   * verify/determine the list of VO's you will be supporting
   * determine/setup your CE node for use of a local gridmap file
   * test the script and verify it produces the desired results


During installation, a default OSG configuration file, <i>$VDT_LOCATION/edg/etc/edg-mkgridmap.conf</i>,  is created providing access to all registered and approved OSG VOs VOMS servers. Review this configuration file:
During installation, a default OSG configuration file, =$VDT_LOCATION/edg/etc/edg-mkgridmap.conf=,  is created providing access to all registered and approved OSG VOs VOMS servers. Review this configuration file:
   * If the list is acceptable to you, then you're done with this step. 
   * If not, then you will need to edit the file and commenting out the line(s) for each VO you wish to disable.
The following is a snippet of the <i>edg-mkgridmap.conf</i> file with some brief comments related to the syntax.
<pre>
<pre class="programlisting">
#### GROUP: group URI [lcluser]
#
    <b><i>Comment line shows the VO, VO administrator, VO admin email address)</b></i>
# 1 CDF Subir Sarkar (subir.sarkar@cnaf.infn.it)
    <b><i>1st token indicates 'group' accounts are used
    2nd token - specifies the  web services address of this VO's VOMS service
    3rd token - specifies the 'group' account assigned eachj member</b></i>
group vomss://voms.cnaf.infn.it:8443/voms/cdf cdf
    <b><i>Note that for Fermilab VO the support center is used</b></i>
# 2 FermiLab -- Fermilab Grid Support Center (helpdesk-admin@fnal.gov)
group vomss://voms.fnal.gov:8443/voms/fermilab fermilab
  :
    <b><i>Some VO's may have multiple VOMS lines</b></i>
#10a USAtlas -- (usatlas-support-l@lists.bnl.gov)
group vomss://lcg-voms.cern.ch:8443/voms/atlas/ usatlas1
group vomss://lcg-voms.cern.ch:8443/voms/atlas/?/atlas/usatlas usatlas3
group vomss://lcg-voms.cern.ch:8443/voms/atlas/ usatlas4
   : 
</pre>

Comment lines start with "#" as in a shell script. This file is periodically updated by the OSG GOC and new/updated versions are issued.  For this reason, it is recommended that you do not delete entries, but comment them.  This will allow you to do a comparison of your current configuration against any new OSG version more accurately and you will be more readily aware of those VOs you omitted intentionally.

Additional information  can be found at the [[http://vdt.cs.wisc.edu/extras/edg-mkgridmap.conf.html][VDT edg-mkgridmap configuration file documentation page]].

---+++ Setting up edg-mkgridmap for local users
You can accomplish this by adding the following directive to the end of the <i>edg-mkgridmap.conf</i> file.
You can accomplish this by adding the following directive to the end of the =edg-mkgridmap.conf= file.
<pre>
<pre class="programlisting">
gmf_local   /etc/grid-security/grid-mapfile-local
</pre>
<UL><LI>In the configuration file, the location of the local grid-mapfile must contain the fully qualified path
        <LI>The location and name of the local file shown in above is just a recommendation.  You can keep it anywhere and name it anything.
        <LI>The syntax of the grid-mapfile-local is the syntax for the real <i>grid-mapfile</i>
        <LI>Any <i>gmf_local</i> directive(s) should be the last entries in the <i>edg-mkgridmap.conf</i> file.
</UL>
   * The syntax of the grid-mapfile-local is the syntax for the real <i>grid-mapfile</i>
   * Any <i>gmf_local</i> directive(s) should be the last entries in the <i>edg-mkgridmap.conf</i> file.
d158 1
   * Any <i>gmf_local</i> directive(s) should be the last entries in the =edg-mkgridmap.conf= file.


---+++ Setup and test access to each selected VOMS service
To do a "shotgun" test of them all, as <i>root</i>, run:
<pre> 
&gt;  source $VDT_LOCATION/setup.(c)sh
&gt;  cd $VDT_LOCATION/edg/sbin
&gt  ./edg-mkgridmap  --output=test.out
The <i>test.out</i> file contains all the gridmap entries for the supported VO's and any local gridmap entries, if specified.
If you see any messages when you run the command, the members of those VO's will not appear in the <i>test.out</i> file. If you look at the files created from the above test, you will notice that the script makes a backup of your current file with a '.1' suffix.  Since this was the initial running of the script, the <i>test.out.1</i> is empty.
The <i>test.out</i> file contains all the gridmap entries for the supported VO's and any local gridmap entries, if specified. If you see any messages when you run the command, the members of those VO's will not appear in the <i>test.out</i> file. If you look at the files created from the above test, you will notice that the script makes a backup of your current file with a '.1' suffix.  Since this was the initial running of the script, the <i>test.out.1</i> is empty.
&gt;  ls -l test.out*
-rw-r--r--  1 root root 611236 Oct 30 13:49 test.out
-rw-r--r--  1 root root      0 Oct 30 15:03 test.out.1
 > ls -l test.out*
  -rw-r--r--  1 root root 611236 Oct 30 13:49 test.out
If the VO administrator has not enabled world read of the VO membership, then you must contact the VO
administrator and request that your site be given access to the VOMS database. You will need to provide
the Subject and Issuer Distinguished Names (DN) for your host certificate.  The simplest thing to do is send email
to the VO administrator requesting access and including the output of the command (check that the path to the hostcert.pem is correct for you):
</pre>
If the VO administrator has not enabled world read of the VO membership, then you must contact the VO administrator and request that your site be given access to the VOMS database. You will need to provide the Subject and Issuer Distinguished Names (DN) for your host certificate.  The simplest thing to do is send email to the VO administrator requesting access and including the output of the command (check that the path to the hostcert.pem is correct for you):
<pre>
  &gt;   openssl x509 -in /etc/grid-security/hostcert.pem -subject -noout
 > openssl x509 -in /etc/grid-security/hostcert.pem -subject -noout
</pre> 
   


&gt;  cd $VDT_LOCATION
&gt;  source setup.sh
&gt;  ./vdt/setup/configure_edg_make_gridmap
<b><i>.... (no output indicates success)</b></i>
 &gt;  ./vdt/setup/configure_edg_make_gridmap
  <b><i>.... (no output indicates success)</b></i>
</pre>

Verify the resulting cron entry and times.
Refer to the [[Integration.ITB_0_5.EdgMkgridmapTroubleshootingGuide][edg-mkgridmap troubleshooting guide]] for any problems/errors.

---+++Troubleshooting edg-mkgridmap
Refer to the [[EdgMkgridmapTroubleshootingGuide][edg-mkgridmap troubleshooting guide]] for any problems/errors.
Run the 
<a href="http://osg.ivdgl.org/twiki/bin/view/ReleaseDocumentation/CEInstallGuide#Site_Verification">Site Verification</a>

---+++ Test  the Grid3/Local configuration
Run the [[http://osg.ivdgl.org/twiki/bin/view/ReleaseDocumentation/CEInstallGuide#Site_Verification][Site Verification]]
 script again locally (as a regular user) and verify that the authorization still works. 


---++ Compatibility Mode Configuration
In Compatibliity mode, authorization is still performed using the <i>grid-mapfile</i>.  The difference is in the source of the VO membership data/account assignments.  Instead of each CE node pulling independently from the VO VOMS servers.  Each CE node for your site pulls the data from your site's GUMS server.  Thus, centralized mapping is enabled.  Your site's GUMS server polls the VOs' VOMS servers much the same as the <i>edg-mkgridmap</i> process did, the difference being that all CE nodes account assignments are managed in one place, the GUMS server.  Given the GUMS configuration options, account pools (many accounts, one-to-one DN-to-account mapping) can be implemented as well as group accounts (many-to-one DN-to-account mapping).

<UL>
<LI>You will not be able to provide role based authorization in this configuration. 
<LI>You will introduce delays since each gatekeeper will have to regenerate the map before implementing the new policy or allowing new users. 
</UL>
A couple of points to be aware of regarding this configuration relative to Full Privilege:
   * You will not be able to provide role based authorization in this configuration. 
<UL>
<LI>One GUMS server per local account domain to manage the mapping from Grid identity (DN+attributes) to local username
<LI>The GUMS client program <i>gums-host</i> running via cron on your gatekeeper(s) to retrieve both the forward and inverse maps (forward is DN-to-account, inverse is user-to-VO).
</UL>
In the compatibility configuration, you will have:
   * One GUMS server per local account domain to manage the mapping from Grid identity (DN+attributes) to local username
   * The GUMS client program <i>gums-host</i> running via cron on your gatekeeper(s) to retrieve both the forward and inverse maps (forward is DN-to-account, inverse is user-to-VO).

---+++Compatibility Mode Requirements
Your site needs to install and configure a GUMS service. There needs to be one GUMS server per map of 'DN to local uid'. An institution would only need one GUMS server if there is a global uid assignment (eg. a single NIS domain).  If you will have multiple account domains, you will need a GUMS server for each domain.   Each account domain can cover  any number of CE hosts, clusters storage elements (SEs)  as long as all systems have a consistent set of POSIX Users|UIDs|Groups|GIDs. 

The CE administrator enable and configure the GUMS client software on the CE node(s), and for each CE, identify the appropriate GUMS server to point to (if more than one is available).

The GUMS-Client package  is installed as part of the OSG CE install.  The essential files are located in the <i>$VDT_LOCATION/gums</i> directory.
The GUMS-Client package  is installed as part of the OSG CE install. The essential files are located in the =$VDT_LOCATION/gums= directory.
You need to edit the <i>$VDT_LOCATION/gums/etc/gums-client.properties</i> configuration file to point to the appropriate GUMS server:  Upon installation the file contains 2 entries both populated with the hostname of the CE node you are configuring.  In this example, cmssrv09.  For, compatibility mode, only the <i>gums.location</i> need be changed to the hostname of your GUMS server. 
You need to edit the =$VDT_LOCATION/gums/etc/gums-client.properties= configuration file to point to the appropriate GUMS server:  Upon installation the file contains 2 entries both populated with the hostname of the CE node you are configuring.  In this example, cmssrv09.  For, compatibility mode, only the <i>gums.location</i> need be changed to the hostname of your GUMS server. 
<pre>
<pre class="programlisting">
   gums.location=https://cmssrv09:8443/gums/services/GUMSAdmin
   gums.authz=https://cmssrv09:8443/gums/services/GUMSAuthorizationServicePort
</pre>

The <i>gums.authz</i> entry is only used if you wish to use the <i>gums</i> client tool to test specific mappings from this host.  Documentation of this client is found in the Gums web site.  This same functionality can be executed using the GUMS web UI.
<UL>
<LI>/etc/grid-security/grid-mapfile
<LI>$VDT_LOCATION/monitoring/grid3-user-vo-map.txt  
</UL>
   * =/etc/grid-security/grid-mapfile=
More complete documentation on this command is available in the offical 
<a href="http://grid.racf.bnl.gov/GUMS/guide_commands.html"> GUMS command guide</a> and 
<a href="http://grid.racf.bnl.gov/GUMS/guide_installation.html">GUMS installation guide</a>, 
near the bottom under the heading "Installing the client tools".
   * =$VDT_LOCATION/monitoring/grid3-user-vo-map.txt=

More complete documentation on this command is available in the [[http://grid.racf.bnl.gov/GUMS/guide_commands.html][offical GUMS command guide]] and [[http://grid.racf.bnl.gov/GUMS/guide_installation.html][GUMS installation guide]], near the bottom under the heading "Installing the client tools".
---+++++grid-mapfile generation
To test the <i>grid-mapfile</i> generation, you need to run as <i>root</i>.  This uses the host certificate.
<pre>
  &gt;  source $VDT_LOCATION/setup.sh
  &gt;  cd $VDT_LOCATION/gums/bin
  &gt;  ./gums-host generateGridMapfile     <b><i>(output goes  to stdout. To get a file: either redirect stdout or use '--file file_name')</i></b>
  <i>...output  should look similar to the following dependent on your GUMS server mappings..
  <i>...output  should look similar to the following dependent on your GUMS server mappings..</i>
   #---- members of vo: osg ----#
    "/DC=org/DC=doegrids/OU=People/CN=Alexis Rodriguez 233072" osg01
   "/DC=org/DC=doegrids/OU=People/CN=Andrew Zahn 730598" osg01
   "/DC=org/DC=doegrids/OU=People/CN=Craig Phillip Prescott 50911" osg01
   #---- members of vo: Test3userGroup ----#
   "/DC=org/DC=doegrids/OU=People/CN=Anne Heavey 830711" osg01account
    <i>.... and so on</i>
</pre>
<UL>
problem is likely in the GUMS server's gums.config file:
<LI>GUMS 1.1 syntax:  your host in not in the <i>cn</i> attribute of the <i>hostGroup</i> element.
</UL>
d266 1
If it fails, an error  similar to "<i>No map was found for the host xyz.dhcp.fnal.gov</i> will occur.  Contact your GUMS administrator(s).  The problem is likely in the GUMS server's =gums.config= file:
   * GUMS 1.1 syntax:  your host in not in the <i>cn</i> attribute of the <i>hostGroup</i> element.

---+++++grid3-user-vo-map  generation
To test the <i>grid3-user-vo-map</i> generation, you need to run as <i>root</i>.  This uses the host certificate.
<pre>
  &gt;  source $VDT_LOCATION/setup.sh
  &gt;  cd $VDT_LOCATION/gums/bin
  &gt;  ./gums-host generateGrid3UserVoMap   <b><i>(output goes  to stdout. To get a file: either redirect stdout or use '--file file_name')</i></b>
  <i>...output  should look similar to the following dependent on your GUMS server mappings..
  <i>...output  should look similar to the following dependent on your GUMS server mappings..</i>
  #User-VO map
  # #comment line, format of each regular line line: account VO
  # Next 2 lines with VO names, same order, all lowercase, with case (lines starting with #voi, #VOc)
  #voi xxx test3
  #VOc OSG TEST3
  #---- accounts for vo: osg ----#
  osg01 xxx
  #---- accounts for vo: Test3userGroup ----#
  <i>  .... and so on</i>
</pre>
<UL>
 
<LI>GUMS 1.1 syntax:  your host in not in the <i>cn</i> attribute of the <i>hostGroup</i> element.
</UL>
%INCLUDE{"GumsHostCron050"}%
problem is likely in the GUMS server's gums.config file:
%INCLUDE{"Integration.ITB_0_5.GumsHostCron"}%

---++++cron file - gums-host-cron
Run the 
[[CEInstallGuide050#Site_Verification][Site Verification]]
 script again locally (as a regular user) and verify that the authorization still works. 

---+++ Retest the compatibility configuration
Run the [[CEInstallGuide#Site_Verification][Site Verification]] script again locally (as a regular user) and verify that the authorization still works. 


This scenario implements the PRIMA authorization module with GUMS and does not use the grid-mapfile.  The gatekeeper uses a callout to PRIMA. Upon receipt of each request, PRIMA forwards the request to the GUMS web service which performs the dynamic mapping of the user's certrificate to a UNIX account.   PRIMA can process FQAN (Fully Qualified Attribute Names), thus enabling mappings based on VO groups and roles as defined in VOMS.
This scenario implements the PRIMA authorization module with GUMS and does not use the grid-mapfile.  The gatekeeper uses a callout to PRIMA. Upon receipt of each request, PRIMA forwards the request to the GUMS web service which performs the dynamic mapping of the user's certrificate to a UNIX account. PRIMA can process FQAN (Fully Qualified Attribute Names), thus enabling mappings based on VO groups and roles as defined in VOMS.

In this configuration, requests to your gatekeeper(s) and gsiftp service(s) use the authorization callout to contact the  GUMS authorization service  which checks whether the requester is permitted access and, if access is permitted, returns a local user id assigned to the requester's grid credential. This removes the need for maintaining grid mapfiles on each gatekeeper and/or gridftp server. 
---+++ Full Privilege Requirements
Your site needs to install and configure GUMS service. There needs to be one GUMS server per map of 'DN to local uid'. An institution would only need one GUMS server if there is a global uid assignment (eg. a single NIS domain).  If you will have multiple account domains, you will need a GUMS server for each domain.   Each account domain can cover  any number of CE hosts, clusters storage elements (SEs)  as long as all systems have a consistent set of POSIX Users|UIDs|Groups|GIDs. 
You must establish local accounts on the CE to match those that will be assigned by the GUMS service.  Your local
GUMS administrator can identify these for you, or you can get the list from the grid3-user-vo-map.txt which
is generated in the steps below.
The CE administrator needs to install and configure the GUMS Client software on the CE(s), and for each CE, identify the appropriate GUMS server to point to (if more than one is available).

You must establish local accounts on the CE to match those that will be assigned by the GUMS service.  Your local GUMS administrator can identify these for you, or you can get the list from the grid3-user-vo-map.txt which is generated in the steps below.
The <i>gums-host-cron</i> must be configured (if not already done) to periodically update the 
<i>grid3-user-vo-map.txt</i> file.
The <i>gums-host-cron</i> must be configured (if not already done) to periodically update the <i>grid3-user-vo-map.txt</i> file.
The <i>gums-host-cron</i> must be configured (if not already done) to periodically update the =grid3-user-vo-map.txt= file.
<UL>
<LI><b>prima-authz.conf</b> - identifies the GUMS authorization service to use
<pre>
   <i>... example showing just the GUMS service line requiring modification for an install of cmssrv09 ...</i>
    # This is the identity mapping server, it performs a mapping based on the gridmap file on the service host
   imsContact https://cmssrv09.fnal.gov:8443/gums/services/GUMSAuthorizationServicePort
</pre>
<LI><b>gsi-authz.conf</b> - tells the Globus gatekeeper and gsiftp services to use PRIMA.<br>
<b>Note</b>: This file is the key to the callout being invoked.  If you remove this file (or rename it), the Globus services will revert to use of  the <i>grid-mapfile</i>.
</UL>
   $ %I% %RED% *NOTE* %ENDCOLOR%: =gsi-authz.conf= is the key to the callout being invoked.  If you remove this file (or rename it), the Globus services will revert to use of  the <i>grid-mapfile</i>.
%NOTE% =gsi-authz.conf= is the key to the callout being invoked.  If you remove this file (or rename it), the Globus services will revert to use of the <i>grid-mapfile</i>.
These files need to be copied to the <i>/etc/grid-security</i> directory and the <i>prima-authz.conf</i> modified to point to you GUMS service.
<pre>
   &gt;  cp $VDT_LOCATION/post-install/gsi-authz.conf      /etc/grid-security/.
   &gt;  cp $VDT_LOCATION/post-install/prima-authz.conf /etc/grid-security/.
 > cp $VDT_LOCATION/post-install/prima-authz.conf /etc/grid-security/.
</pre>
The <i>prima-authz.conf</i> file is preconfigured during the VDT installation to your CE node host name.  Edit this file, changing the <b>imsContact</b> attribute to point to your GUMS service.  By default, the installation has the log file verbosity set to 'debug''.  You may want to change this to 'info' (just comment and uncomment the lines shown).
<pre>
   <i>... in this example cmssrv09 was the CE node...</i>
   imsContact https://<b>cmssrv09.fnal.gov</b>:8843/gums/services/GUMSAuthorizationServicePort
The =prima-authz.conf= file is preconfigured during the VDT installation to your CE node host name.  Edit this file, changing the <b>imsContact</b> attribute to point to your GUMS service.  By default, the installation has the log file verbosity set to 'debug'.  You may want to change this to 'info' (just comment and uncomment the lines shown).
   # logging levels supported are debug, info, error, none
   logLevel    debug
  #logLevel    info
#logLevel    info
</pre>

The GUMS-Client package is installed as part of the OSG CE install.  The essential files are located in the <i>$VDT_LOCATION/gums</i> directory.
The GUMS-Client package is installed as part of the OSG CE install.  The essential files are located in the =$VDT_LOCATION/gums= directory.

You need to edit the <i>$VDT_LOCATION/gums/etc/gums-client.properties</i> configuration file to point to the appropriate GUMS server:  Upon installation the file contains 2 entries both populated with the hostname of the CE node you are configuring.  In this example, cmssrv09.   
<pre>
<pre class="programlisting">
   gums.location=https://cmssrv09:8443/gums/services/GUMSAdmin
   gums.authz=https://cmssrv09:8443/gums/services/GUMSAuthorizationServicePort
</pre>

The <i>gums.authz</i> entry is only used if you wish to use the <i>gums</i> client tool to test specific mappings from this host.  Documentation of this can be found on the GUMS web site.  This same functionality can be executed using the GUMS web UI.
---++++Full privilege test grid3-user-vo-map generation
---++++ Full privilege test grid3-user-vo-map generation
To test the <i>grid3-user-vo-map</i> generation, you need to run as <i>root</i>.  This uses the host certificate.
<pre>
  &gt;  source $VDT_LOCATION/setup.sh
  &gt;  cd $VDT_LOCATION/gums/bin
  &gt;  ./gums-host generateGrid3UserVoMap   <b><i>(output goes  to stdout. To get a file: either redirect stdout or use '--file file_name')</i></b>
  <i>...output  should look similar to the following dependent on you GUMS server mappings..
  <i>...output  should look similar to the following dependent on you GUMS server mappings..</i>
  #User-VO map
  # #comment line, format of each regular line line: account VO
  # Next 2 lines with VO names, same order, all lowercase, with case (lines starting with #voi, #VOc)
  #voi xxx test3
  #VOc OSG TEST3
  #---- accounts for vo: osg ----#
  osg01 xxx
  #---- accounts for vo: Test3userGroup ----#
  <i>.... and so on</i>
</pre>
<UL>
<LI>GUMS 1.1 syntax:  your host is not in the <i>cn</i> attribute of the <i>hostGroup</i> element.
</UL>
problem is likely in the GUMS server's gums.config file:
%INCLUDE{"GumsHostCron050"}%
   * GUMS 1.1 syntax: your host is not in the <i>cn</i> attribute of the <i>hostGroup</i> element.
%INCLUDE{"Integration.ITB_0_5.GumsHostCron"}%

---++++Full privilege mode cron - gums-host-cron
If there is any /etc/grid-security/grid-mapfile, move it to another 
file name.
Run the 
<a href="http://osg.ivdgl.org/twiki/bin/view/ReleaseDocumentation/CEInstallGuide#Site_Verification">Site Verification</a>
 script again locally (as a regular user) and verify that the authorization still works. 

If there is any /etc/grid-security/grid-mapfile, move it to another file name. Run the [[http://osg.ivdgl.org/twiki/bin/view/ReleaseDocumentation/CEInstallGuide#Site_Verification][Site Verification]] script again locally (as a regular user) and verify that the authorization still works. 
If there is any =/etc/grid-security/grid-mapfile=, move it to another file name. Run the [[ReleaseDocumentation.CEInstallGuide#Site_Verification][Site Verification]] script again locally (as a regular user) and verify that the authorization still works. 

<pre>
   &gt;  source $VDT_LOCATION/setup.(c)sh
   &gt;  grid-proxy-init
    <i>....(enter your passphrase)...</i>
Note--some sites may require VO-qualified proxies.  If so, 
replace grid-proxy-init with voms-proxy-init in the step above.
   &gt;  globus-job-run <b><i>your-gatekeeper-host</b></i>:2119/jobmanager-fork /usr/bin/id
   $ %I% %RED% *NOTE* %ENDCOLOR%: Some sites may require VO-qualified proxies.  If so, replace grid-proxy-init with voms-proxy-init in the step above.
%NOTE% Some sites may require VO-qualified proxies.  If so, replace grid-proxy-init with voms-proxy-init in the step above.
When  authorizing in full privilege mode, you will see the following extra entry in your <i>$VDT_LOCATION/globus/var/globus-gatekeeper.log</i> file when jobs are submitted:
<pre>
<pre class="programlisting">
Note--in RHEL4/SL4/Rocks 4, PRIMA requires a shared library /usr/lib/libcom_err.so.3.0.0 which is not part of most default 
Redhat-like installations.  It's provided by the rpm compat-libcom_err.
</pre>
   $ %I% %RED% *NOTE* %ENDCOLOR%: In RHEL4/SL4/Rocks 4, PRIMA requires a shared library /usr/lib/libcom_err.so.3.0.0 which is not part of most default Redhat-like installations.  It's provided by the rpm compat-libcom_err.
%NOTE% In RHEL4/SL4/Rocks 4, PRIMA requires a shared library =/usr/lib/libcom_err.so.3.0.0= which is not part of most default Redhat-like installations.  It's provided by the rpm compat-libcom_err.

%STOPINCLUDE%

*Major updates*:%BR%
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

---++!! Major updates
<!--Future editors should add their signatures beneath yours!-->
-- Main.DaneSkow - 11 May 2005<br>
-- Main.AnneHeavey - 24 May 2005<br>
-- Main.StevenTimm - 09 Mar 2006<br>
-- Main.JohnWeigand - 13 Jan 2006<br>
%INCLUDE{"WhuReferences"}%

%META:TOPICMOVED{by="ForrestChristian" date="1166055724" from="Integration.OsgCEAuthorization050" to="Integration/ITB_0_5.OsgCEAuthorization"}%
