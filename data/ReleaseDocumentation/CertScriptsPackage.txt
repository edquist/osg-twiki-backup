%META:TOPICINFO{author="DougOlson" date="1183747577" format="1.1" reprev="1.14" version="1.14"}%
%META:TOPICPARENT{name="OsgRaOperations"}%
%TOC%

---++ Certificate Scripts package
This the home page for documenting the cert-scripts package that provides a command-line
interface to the DOEGrids CA website and some additional utilities for dealing with
X509 certificates.  This package was developed originally by the PPDG project and is
now maintained by the OSG RA.

As an alternative to the web browser interface, these scripts are contributed to the DOEGrids PKI to allow a command-line interface to the certificate authority for submitting certificate requests, retrieving signed certificates, renewing certificates, directory lookup of existing certificates, and checking the remaining lifetime of certificates and certificate revocation lists. They work directly with the PEM format files used by Globus. These are perl scripts and bash shell scripts (some awk), depend upon openssl, ldapsearch and the perl LWP:: module with [[http://search.cpan.org/src/GAAS/libwww-perl-5.803/README.SSL][SSL support]]. Click on the File link below for the usage description of the script, or to download the tar file package containing the scripts. These scripts hae been tested for work with VDT 1.1.2 and 1.3.1. They are included with [[http://vdt.cs.wisc.edu][VDT]], starting with 1.3.1.

Release notes are included in the README file linked below.

---+++ Man Pages

| *File* | *Description*  |
| [[CSReadMe][README]]  | describes the package, includes release notes  |
| [[CSReadMe#cert_check_time][cert-check-time]]  | checks lifetime of certificates and revocation lists  |
| [[CSReadMe#cert_gridadmin][cert-gridadmin]]  | immediate issuance of service certificates for authorized requestors  |
| [[CSReadMe#cert_lookup][cert-lookup]]  | queries directory based on DN of certificates  |
| [[CSReadMe#cert_request][cert-request]]  | generates and submits a certificate signing request  |
| [[CSReadMe#cert_retrieve][cert-retrieve]]  | retrieves signed certificate previously requested  |
| [[CSReadMe#cert_renew][cert-renew]]  | renews existing person certificate (not host or service)  |
| [[CSReadMe#multi_cert_gridadmin][multi-cert-gridadmin]] | immediate issuance of multiple service certificates for authorized administrators (new with V2-3) |
| [[CSReadMe#InstallationNotes_txt][InstallationNotes.txt]] | extra installation requirements for multi-cert-gridadmin (new with V2-3) |

---+++ Examples
---++++ name certificate files by service/hostname
wrapper for cert-gridadmin to name generated certificate files according to the specified service/hostname.
<pre>
$ cat example-service-request.txt
#!/bin/sh
#
# example for V1-8 of cert-scripts package.
#
# Location of request script (point to your prefered local copy)
CGA=./cert-gridadmin
# Owner of certificates (add your email address)
email=
if [ $# -eq 2 ]; then
   service="-service $2"
        tag="$2"
elif [ $# -eq 1 ]; then
        tag="host"
else
    echo "usage: $0  <fully.qualified.domain.name> [ <service > ]"
    echo "    calls cert-gridadmin and generates cert/key files named"
    echo "       fully.qualified.domain.name-servicekey.pem"
    echo "       fully.qualified.domain.name-servicecert.pem"
    echo "  edit $0 for your context"
    exit
fi
$CGA -host $1 $service \ 
        -prefix "$1-$tag" \ 
        -ca test \ 
        -affiliation <your RA here> \ 
        -vo <your VO here, for OSG> \ 
        -show \ 
        -email $email
</pre>

---++++ generating many certificates

The example below shows use of the cert-gridadmin script, which requires an authentication
for each individual certificate.  See also the information on multi-cert-gridadmin.

<verbatim>
#!/bin/sh
#
# example for generating many host certificates with V1-9 of cert-scripts package. 
#
# 1. Create a file $hostfile which contains a list of host's FQDN, one per line
# 2. Run this script 
# Note: You will be prompted for your PEM passphrase for each host :(
#
#
# Some script parameters. To be filled in by user
#
CGA=$VDT_LOCATION/bin/cert-gridadmin    # Location of cert scripts
CA=doegrids                             # Name of CA to use, either 'test' or (default) 'doegrids'
Affiliation=osg                         # Name of your RA to process this request
VO=<your VO here>                       # Name of primary virtual organization, only for the OSG RA
email=your-email@address.domain         # Your email, as the owner of the requested certificate
hostfile=./hosts.txt                    # A text file with a list of hosts
#
# if you want some service shown, such as ldap then set service variable like
# service="-service ldap"

# Check whether there is a user certificates are installed in ~/.globus
if [ ! -f $HOME/.globus/userkey.pem -o ! -f $HOME/.globus/usercert.pem ]; then 
    echo "You need to have your userkey.pem and usercert.pem files in $HOME/.globus"
    echo "Exiting please try again"
    exit
fi
listohosts=`cat $hostfile`
aff=`echo $Affiliation | tr 'A-Z' 'a-z'`
vo=`echo $VO | tr 'A-Z' 'a-z'`
for i in $listohosts
do 
  $CGA -host $i $service -prefix "$i-host" ca $CA -affiliation $aff -vo $vo -show -email $email
done
</verbatim>
---+++ Source

Distributed in VDT as pacman package PPDG-Cert-Scripts. Install with

<pre>
pacman -get VDT::PPDG-Cert-Scripts
or
pacman -update VDT::PPDG-Cert-Scripts
</pre>
If you look at the [[http://vdt.cs.wisc.edu/releases/][releases]] documentation for VDT you can find which version of the scripts
are included in a particular VDT release.

Or, download [[%ATTACHURL%/cert-scripts-V2-4.rev40.tgz][cert-scripts-V2-4.rev40.tgz]] and untar into the location you want. Note that these scripts require some perl extensions that are included with VDT but not necessarily installed in other environments.  New with V2-4 is the multi-cert-gridadmin script which has additional installation requirements.
In a typical VDT or OSG installation you can manually install it from the tar file as

<pre>
$ cd $VDT_LOCATION
$ tar -zxvf cert-scripts-V2-4.rev40.tgz
</pre>

Previous release:  [[%ATTACHURL%/cert-scripts.V2-2.tar][cert-scripts.V2-2.tar]] 

---+++ FAQ
---++++ web proxy variables at BNL
These environment variables are necessary at the RCF/ACF at BNL (on 19 Mar 2007).
   * http_proxy=http://192.168.1.3:3128
   * https_proxy=http://squid.sec.bnl.local:3128


<hr>

-- Main.DougOlson - 30 Jun 2006

-- Main.DougOlson - 20 Jul 2006 - for V1-8a

-- Main.DougOlson - 20 Nov 2006 - for V2-1

-- Main.DougOlson - 20 Mar 2007 - V2-2  (time must be in UTC)

-- Main.DougOlson - 29 May 2007 - V2-3

-- Main.DougOlson - 06 Jul 2007 - V2-4

%META:FILEATTACHMENT{name="cert-scripts.V1-8a.tar" attr="" autoattached="1" comment="V1-8a. revision to V1-8, requires -name in cert-request" date="1153430985" path="cert-scripts.V1-8a.tar" size="112640" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="cert-scripts.V1-9.tar" attr="" autoattached="1" comment="V1-9 source" date="1157572831" path="cert-scripts.V1-9.tar" size="122880" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="cert-scripts.V1-8.tar" attr="" autoattached="1" comment="V1-8 source - update README" date="1152122053" path="cert-scripts.V1-8.tar" size="112640" user="DougOlson" version="1.2"}%
%META:FILEATTACHMENT{name="cert-scripts.V2-2.tar" attr="" autoattached="1" comment="V2-2 source, add http_proxy to all scripts" date="1174349327" path="cert-scripts.V2-2.tar" size="122880" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="cert-scripts-V2-3-rev22.tgz" attr="" autoattached="1" comment="V2-3, include multi-cert-gridadmin" date="1180424066" path="cert-scripts-V2-3-rev22.tgz" size="448828" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="cert-scripts.V2-0.tar" attr="" autoattached="1" comment="V2-0, now with live RA/VO information" date="1160088590" path="cert-scripts.V2-0.tar" size="122880" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="cert-scripts-V2-4.rev40.tgz" attr="" autoattached="1" comment="V2-4, matches DOEGrids RHCS7.1 released 5 July 2007" date="1183747422" path="cert-scripts-V2-4.rev40.tgz" size="432012" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="cert-scripts.V2-1.tar" attr="" autoattached="1" comment="V2-1 source, fixes for SSL_Server usage bit" date="1164057868" path="cert-scripts.V2-1.tar" size="122880" user="Main.DougOlson" version="1"}%
