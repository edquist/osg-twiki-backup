%META:TOPICINFO{author="NateMueller" date="1133382081" format="1.0" version="1.18"}%
%META:TOPICPARENT{name="OSGCEInstallGuide"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>OSG Shutdown Guide
%TOC%
%STARTINCLUDE%


---++What processes need to be stopped?

The OSG starts up several daemons.  If you try to re-install/upgrade the OSG without shutting them down, it will fail.  Run the following commands to turn off the OSG services before upgrading (see sample shutdown session below):

==/etc/init.d/edg-crl-upgraded stop==

==/etc/init.d/edg-gridmapfile-upgraded stop==

==/etc/init.d/gris stop==

==$VDT_LOCATION/MonaLisa/Service/CMD/ML_SER stop== 

This has to be done as either the monalisa or daemon user, depending on how MonALISA was configured by the VDT. Here is how to find out whether MonALISA is running, and if so, under what user:

==ps -efwww | grep -i monalisa==

and for the mysql daemon associated with MonALISA, check using:

==ps -efwww | grep -i mysql==

To avoid corruption in the MonALISA monitoring, the script as shown below should be used to shut down the associated mysqld and related services.

If you're running a personal condor from the default VDT install:

==/etc/init.d/condor stop==

==$VDT_LOCATION/MIS-CI/uninstall-misci.sh==

---++Sample Shutdown Session
Here is a sample session for doing this shutdown.
Notes:
	* In the *su* line, replace "monalisa" with "daemon" if you have no monalisa user.
	* In the setup.sh line, the path /usr/local/grid represents $VDT_LOCATION 
<pre>
 # /etc/init.d/edg-crl-upgraded stop
Stopping edg-crl-upgrade
 # /etc/init.d/edg-gridmapfile-upgraded stop
Stopping edg-gridmapfile-upgrade: 
 # /etc/init.d/gris stop
 # su -s /bin/sh - monalisa
 $ . /usr/local/grid/setup.sh
 $ $VDT_LOCATION/MonaLisa/Service/CMD/ML_SER stop
Trying to stop MonaLisa ....STOPPED
Trying to stop emysqldb...OK
</pre>

Also check to see whether there are any stray OSG-related processes, such as run-mis-ci.sh and so forth still running, and kill them manually if necessary.  You may also want to log in to the account running your MIS-CI accounting and remove its crontab by typing "crontab -r" to prevent monitoring updates while you are doing the installation.
---++If VOMS and/or GUMS is Running on Machine
If you have a VOMS and/or GUMS installation on the same machine, see the Shutdown instructions on VomsWhatToDo and/or GumsAdmins.

<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.NateMueller - 14 Apr 2005<br>
-- Main.AlanSill - 14 Apr 2005<br>
-- Main.JohnWeigand - 18 Jul 2005 - added gsiftp2 to procedures<br>

%STOPINCLUDE%

