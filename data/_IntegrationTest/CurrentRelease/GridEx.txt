%META:TOPICINFO{author="JeffWeber" date="1117229735" format="1.0" version="1.5"}%
%META:TOPICPARENT{name="ItbRel015"}%
---+!!<nop>%TOPIC%
%TOC%
%STARTINCLUDE%

<center>
*UNDER CONSTRUCTION!*
</center>

---++Introduction
The Grid Exerciser (GEx) is a grid diagnostic and monitoring tool.  The GEx is currently run by the [[http://www.cs.wisc.edu/condor/ Condor Project]] at the University of Wisconsin on [[http://www.ivdgl.org/grid3/ Grid3]] and the OSG [[http://www.ivdgl.org/osg-int/ Integration Testbed]] (ITB).  Though the GEx can be run from any site against any grid.

The GEx has these goals:

	* By providing a continuous stream of jobs for all sites on a grid, the GEx provides a continuous diagnostic capability for identifying errors, primarily when jobs don't run at all, or jobs abort with errors.

	* Second, the GEx provides a continuous _backfill_ load upon all sites in the grid.

When sites are configured correctly, GEx jobs run at the lowest priority. and directly indicate the unused computing capacity for a site.  Ideally, the GEx should accumulate a low level of successful run time at a site.  A net run time of zero indicates a problem, either with the GEx or the site.  A high run time indicates the site is either lightly loaded, or a problem prioritizing GEx jobs.

---++Site Loading Algorithm
Currently the GEx attempts to maintain a load of _N_ submitted jobs at each site, where _N_ is the minimum of the number of CPUs reported for the site by the [[http://osg-itb.ivdgl.org/gridcat/ GridCat]], or 10.  The latter is the current arbitrary limit for the maximum number of simulaneous jobs per site. The job itself is essentially a script wrapper around "sleep 900", and outputs other useful environment information to stdout and stderr.  The GEx job itself should result in little to no CPU load.

TODO: There is a pending change [below] to only submit jobs to sites that are identified as "active" in the GridCat.

---++GEx User Identity
The GEx runs from the GRIDEX VO, gridex user, with the certificate subject
<verbatim>
/DC=org/DC=doegrids/OU=People/CN=Alan De Smet 489066
</verbatim>
but will soon migrate to the new certificate
<verbatim>
/DC=org/DC=doegrids/OU=People/CN=Jeff Weber (Grid Exerciser) 365339
</verbatim>

TODO: What GEx user id(s) for sites with dynamic accounts?  How does this work with GUMs?

---++Configuring Site Policy for GEx Jobs

An
It is intended that each sites configures GEx jobs to run as backfill jobs.  This is done by configuring GEx jobs to run at the _poorest possible priority.  To accomplish this, all GEx jobs should be mapped to user ids that are _only_ associated with the GEx.  Bear in mind that [[http://grid.racf.bnl.gov/GUMS/guide_architecture.html GUMS ]] may map GEx jobs to multiple user ids.

Here are suggestions for accomplishing this for the various OSG job managers: (I'll stand by the user prioritization for Condor pools, but am requesting feedback on PBS and LSF pools.)

---+++Condor
The Condor administrator should set a high user priority factor for the local GEx Condor user id(s).  A high user priority factor should be at least an order of magnitude larger than the number of CPUs available at the site.  For example, if the GEx is uniquely associated with the _gridex_ user id:

Note: change this:
nice_user = true in job RSL
site has startd_job_exprs = ... nice_user ...
site has preemption_requirements || (MY.NiceUser == True)	||

<verbatim>
% condor_userprio -setfactor gridex 1000000
</verbatim>

Note that 
Condor will always use this user priority factor to create a large (poor) effective user priority for the GEx user(s).  Condor remembers changes to the default user priorities set by _condor_userprio_.  These changes are retained across system restarts and upgrades.

---+++PBS
_Help.  PBS feedback needed.  These notes apply to the old Grid3 config, of which I am less familiar._

Put the following in your maui.cfg file:
<verbatim>
  # use fair-share
  FSPOLICY				  ON
  # favor fair-share component of overall job priority
  FSWEIGHT		10
  # don't limit number of CPUs a user can have when there's no contention
  MAXJOBPERUSERPOLICY	OFF
</verbatim>

Put the following in your fs.cfg file:
<verbatim>
  User cmsprod	10.0
  User atlasprod 10.0
  User cmstest	1.0
</verbatim>

---+++LSF
_Help.  LSF feedback needed.  These notes apply to the old Grid3 config, of which I am less familiar._

To configure global fairshare, you must use host partition
fairshare. Use the keyword all to configure a single partition that
includes all the hosts in the cluster.

Example:
<verbatim>
  Begin HostPartition
  HPART_NAME =GlobalPartition
  HOSTS = all
  USER_SHARES = [cmsprod@, 10] [atlasprod, 10] [cmstest, 1]
  End HostPartition
</verbatim>

---++Most Recent OSG-ITB GEx Report
TBD.

---++Interpreting GEx Reports
TBD:

---++Troubleshooting
TBD

---++Links
TBD

---++Readiness Plan
TBD

---++Pending GEx Changes:
	* Update to use new certificate
	* Modify GEx to dynamically restart each TBD period, and read GridCat at the start of each run.  Currently, site list is queried by script from GridCat, GEx is (re)started by hand.
	* Add interpretation of new GridCat status bit: only submit jobs to "active" sites, but log "inactive", "unknown" sites.  Note that a latency occurs from when the site status is updated in the GridCat until the GEx responds to the new status.

	* Publish most recent OSG-ITB report online similar to latest [[http://www.cs.wisc.edu/~adesmet/ge/results.txt Grid3]] report.

	* Add verification of job stdout and stderr

	* Increase maximum number of simultaneous jobs per site.  The current limit of up to 10 simultaneous jobs per site is an arbitrary starting point.  This limit is
arguably quite small when compared to sites with hundreds or thousands of CPUs, and  hampers the GEx goal of providing a realistic backfill load upon each site.  However, this limit has still caused issues with some site.  Until these issues are all understood and remedied, the current limit will remain unchanged.


<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.RobGardner - 16 May 2005

%STOPINCLUDE%

