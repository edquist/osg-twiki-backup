%META:TOPICINFO{author="ElizabethChism" date="1466010170" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="DocumentationTable050"}%
<!-- This is the default OSG Trash/Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>%TOPIC%
%TOC%
%STARTINCLUDE%

---+CEMON Installation and Configuration Procedure

Tanya Levshina, Rohit Mathur
Initial Documentation Released: June 28, 2006 

---++Host and Server Certificates
Make sure that you have host and http service certificates on the server you are planning to install cemon: 
   * The host certificate should be installed in /etc/grid-security with ownership and permissions as:
<pre>
-rw-r--r--  root   root     hostcert.pem  
-r-------- root   root    hostkey.pem  
</pre>
   * The http certificate used by apache and tomcat. The http certificate for your system should be installed in /etc/grid-security/http with ownership and  permission as:
<pre>
-rw-r--r--  daemon daemon  httpcert.pem  
-r-------- daemon daemon httpkey.pem 
</pre>
---++Installing CEMon from VDT 1.3.11
   * Install the latest version of pacman:
<pre>
> wget http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-latest.tar.gz 
> tar xzvf pacman-[version].tar.gz
> cd pacman-[version] 
> . setup.sh 
</pre>
   * Create a directory where you want to install the vdt package if it does not already exist:
<pre>
> cd /usr/local
> mkdir vdt
</pre>
   * Change to vdt directory ($VDT_LOCATION0
   * Install CEMon from vdt
<pre>
> pacman -get http://vdt.cs.wisc.edu/vdt_1311_cache:CEMon
</pre>
(Answer "yes" to all questions)
   * Apache and Tomcat should be started at this time
   * Cemon  should be started as well (cemon log file is located $VDT_LOCATION/tomcat/v5/logs/glite-ce-monitor.log). You can verify that cemon is started by accessing it via your browser (your certificate should be imported into your browser).  Use the following url: https://<host>:8443/ce-monitor/services/CEMonitor?method=GetInfo 

*NOTE* If your DN is not in the /etc/grid-security/grid-mapfile you will get an xml error message with the following lines:

<pre>
...
&lt;faultcode&gt;soapenv:Server.generalException&lt;/faultcode&gt;
...
&lt;Description&gt; User &lt;YOUR_DN&gt; not authorized for GetInfo&lt;/Description&gt;
...
</pre>

If you add your DN to a grid-mapfile, you could get back useful information and CEMonitor
---++Install Condor
   * In $VDT_LOCATION
<pre>
> pacman -get http://vdt.cs.wisc.edu/vdt_1311_cache:Condor
</pre>
(Answer "yes" to all questions)
---++Configure GIP
<pre>
> source $VDT_LOCATION/setup.sh
> $VDT_LOCATION/vdt/setup/configure_gip --batch condor
</pre>
---++Make changes to files 
(osg-info-static-ce.ldif, osg-info-static-cluster.ldif, etc.)
In $VDT_LOCATION/lcg/var/gip/ldif. substitute the appropriate values:
<pre>
GlueCEInfoApplicationDir: Change_Me_APP
GlueCEInfoDataDir: Change_Me_DATA
...
</pre>
---++Modify CEMon Configuration to report to IG
   * In $VDT_LOCATION/glite/etc/glite-ce-monitor change the file cemonitor-config.xml, uncomment and modify the following xml fragment:
     <img src="%ATTACHURLPATH%/Picture_3.png" alt="Picture_3.png" width='536' height='431' />
   * Currently CEMON has a bug that causes a memory leak in tomcat. The !OutOfMemory may be caused by the CRL support of the client used to send notifications. The known work around is to disable CRL support. In order to do this the attribute sslCRLfiles should be deleted in the configuration file, so the service tag should look like this:
     <img src="%ATTACHURLPATH%/Picture_4.png" alt="Picture_4.png" width='465' height='88' />

%META:FILEATTACHMENT{name="Picture_4.png" attr="" autoattached="1" comment="" date="1155246659" path="Picture_4.png" size="14340" user="Main.RobQ" version="1"}%
%META:FILEATTACHMENT{name="Picture_3.png" attr="" autoattached="1" comment="" date="1155246173" path="Picture_3.png" size="74415" user="Main.RobQ" version="1"}%
