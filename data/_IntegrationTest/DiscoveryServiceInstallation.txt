%META:TOPICINFO{author="MichaelThomas" date="1117132462" format="1.0" version="1.5"}%
%META:TOPICPARENT{name="ItbRel015"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>Discovery Service Installation
%TOC%
%STARTINCLUDE%


---++Introduction

JClarens is a grid service framework for hosting and developing new grid services. The Discovery Service is one such grid service. In order to run the Discovery Service, both JClarens and the Discovery Service packages must be installed. Fortunately, the VDT installer makes this easy.

---++Basic Installation

	1. Install a service certificate and key into =/etc/grid-security/http/httpcert.pem= and =/etc/grid-security/http/httpkey.pem=. This should be done before installing the VDT.  
	1. If you haven't done so already, [[http://www.cs.wisc.edu/vdt/releases/1.3.6/installation_pacman.html][install pacman]].
	1. Install the JClarens and Discovery Service packages from the VDT cache<br/>
		=pacman -get !http://www.cs.wisc.edu/vdt/vdt_136_cache:jClarens-Discovery=
	1. During the installation, pacman will ask if you want to enable the JClarens web services framework.  Good admins (who got a service cert first) should answer =y=. Impatient admins, answer =s=.
<verbatim>
		Would you like to enable the jClarens web services framework?
		Choices: y (yes), n(no), s (skip this question) y
</verbatim>

Good admins -- you're done!  Anyone else should get a service certificate and install the Apache and Tomcat init scripts.

	* vdt/setup/configure_apache --server y
	* vdt/setup/configure_tomcat --server y --version 4
 
---++Site Configuration

The Discovery Service requires access to a [[http://monalisa.caltech.edu][MonALISA]] server that has been configured to receive [[http://monalisa.caltech.edu/dev_ap_mon.html][ApMon publications]].  This MonALISA server does not need to reside on the same host, or even at the same site as the Discovery Service.
There are three files that must be updated for the local site installation:  

---+++$VDT_LOCATION/tomcat/v4/webapps/jclarens/xmlrpc_handlers.properties
	1. Change the value of =monitor.dest= to point to the [[http://monalisa.caltech.edu][MonALISA]] server that was configured to receive [[http://monalisa.caltech.edu/dev_ap_mon.html][ApMon publications]].<br/>
		=monitor.dest=my.monalisa.host:8884=
	1. The =clarens.admin= property contains a certificate DN fragment for the user who is given full access to all services on the server.  Any user who logs in with a certificate containing this substring will bypass all access control checks.  Comment out this property to remove all adminstrator access.<br/>
		=#clarens.admin=OU=GAE=
	1. Set the =vo.name= property to the name of the virtual organization to which this server belongs.<br/>
		=vo.name=uscms=

---+++$VDT_LOCATION/tomcat/v4/webapps/jclarens/mlstore.properties
	1. Change the name of the MonALISA group to OSG-ITB<br/>
		=lia.Monitor.group = OSG-ITB=

---+++$MONALISA_HOME/Service/myFarm/myFarm.conf
	1. Set up the [[http://monalisa.caltech.edu][MonALISA]] server to accept [[http://monalisa.caltech.edu/dev_ap_mon.html][ApMon publications]] by adding the following line:<br/>
		=^monXDRUDP{ListenPort=8884,ParamTimeout=3600,NodeTimeout=3600,ClusterTimeout=3600}%5=

---++Validation
There are three validation steps that the Discovery Service is running.  The first is to use the browser interface on the local Discovery Service instance:  http://localhost:8080/jclarens/web/rendezvous/rendezvous_interface.html.  Press the 'Submit' button to see a list of services (both local and remote) that have been discovered by the registry.  At a minimum you should see an entry for the local host.  If you wait long enough (~5 minutes or less), you should start to see entries for other OSG-ITB sites as well.

The second validation test is to check the [[http://ultralight.caltech.edu:8080/jclarens/web/rendezvous/rendezvous_interface.html][Discovery Service registry hosted at Caltech]].  If your local Discovery Service has been configured correctly then you should see your site listed in this registry.

The third validation step involes publishing a service to the registry from the command line.  Command line tools are available from http://discover.gridservice.info/publish-voms-admin.tar.gz.  This package contains generic service publication scripts as well as a script for publishing voms-admin services to the registry.  The README file in the tarball contains information on how to customize and use these scripts.  Validation is successful when the publish script publishes a service with no errors and the query script returns the service that was published via the publish script.

<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.MichaelThomas - 14 Apr 2005

%STOPINCLUDE%

