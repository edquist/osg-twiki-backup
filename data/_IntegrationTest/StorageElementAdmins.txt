%META:TOPICINFO{author="NehaSharma" date="1131562167" format="1.0" version="1.2"}%
%META:TOPICPARENT{name="WebHome"}%
---+!!<nop>%TOPIC%
%TOC%
%STARTINCLUDE%


---++ Introduction
This page contains how-to guides and other necessary information for ITB Testers who are either setting up a Storage Element or testing a Storage Element Implementation.

---++ Setup of Storage Element (SE)
---+++ How to Setup SE based on SRM DRM
				  Not Complete. Current information available at Integration.SrmDrm
---+++ How to Setup SE based on SRM dCache
				  Not Available 
	
---+++ How to Setup Generic Information Provider (GIP)

		This section covers how to install and configure GIP in order to report features of your Storage Element.
		 
		Before you start, you need to know:

	* The hostname of your Storage Element

	* The base file directory

	* The interface (GridFTP and/or SRM)

---++++ Installation

First, install the Generic Information Provider using Pacman:
<verbatim>
> pacman -update Generic-Information-Provider
</verbatim>

Re-source the OSG environment to add the new binary paths.  Now, have the OSG setup the GIP for you:

<verbatim>
> $VDT_LOCATION/vdt/setup/configure_gip --batch [condor|pbs|lsf]
</verbatim>

---++++ Configuration

Edit =$VDT_LOCATION/lcg/var/gip/lcg-info-generic.conf=.  As an example, the one in use at UNL is 
available at %PUBURL%/Documentation/StorageElementAdmins/lcg-info-generic_UNL.conf  

Here are a few bullets indicating what is unique to that site:

	* =/opt/osg/osg-021= is the =$VDT_LOCATION=.
	* =alliance.unl.edu= is both a Compute Element and where the GRIS is located.
	* Both SRM and gsiftp interfaces are supported.
	* =/pnfs/unl.edu/data1= through =/pnfs/unl.edu/data5= is the base directory, depending on the VO.
	* Note that the MIS VO was explicitly added -- this is needed for !GridCat.
	* You'll have to make sure the following DN will authenticate successfully:
		* /DC=org/DC=doegrids/OU=People/CN=Leigh Grundhoefer (!GridCat) 693100
	* =/opt/osg/data= and =/opt/osg/app= correspond to $DATA_DIR and $APP_DIR on the Compute Element, respectively.
	* =thpc-1.unl.edu= is the FQDN of the Storage Element.

Once the configuration file has been written, you must run a script then restart the GRIS:

<verbatim>
> $VDT_LOCATION/lcg/sbin/lcg-info-generic-config $VDT_LOCATION/lcg/var/gip/lcg-info-generic.conf
> /etc/init.d/gris stop
> /etc/init.d/gris start
</verbatim>

Now, use the command line program =ldapsearch= to check your output:

<verbatim>
> ldapsearch -h your.fully.qualified.hostname -p 2135 -x -b mds-vo-name=local,o=grid
</verbatim>

If you would like to only see the entries relevant to the Storage Element, try the following:

<verbatim>
> ldapsearch -h your.fully.qualified.hostname -p 2135 -x -b mds-vo-name=local,o=grid "(objectClass=GlueSA)"
</verbatim>

Replace _your.fully.qualified.hostname_ with the real name of the host running GRIS.

You will get a whole bunch of text in LDIF format.  Note that all the text gets rearranged by the program, so don't expect lcg-generic-info.conf to get spit back out at you.  There's a lot of output; here's what it looks like for UNL.

At the beginning:
<verbatim>
[brian@alliance osg-021]$ ldapsearch -h alliance.unl.edu -p 2135 -x -b mds-vo-name=local,o=grid
version: 2

#
# filter: (objectclass=*)
# requesting: ALL
#

# alliance.unl.edu, local, grid
dn: Mds-Host-hn=alliance.unl.edu,Mds-Vo-name=local,o=grid
objectClass: MdsComputer
objectClass: MdsComputerTotal
objectClass: MdsFsTotal
objectClass: MdsHost
objectClass: MdsMemoryRamTotal
objectClass: MdsMemoryVmTotal
objectClass: MdsNet
objectClass: MdsNetTotal
objectClass: MdsOs
Mds-Computer-isa: athlon
Mds-Computer-platform: i686
Mds-Computer-Total-nodeCount: 1
Mds-Fs-freeMB: 1004
Mds-Fs-freeMB: 8789
Mds-Fs-freeMB: 9818
Mds-Fs-sizeMB: 1004
Mds-Fs-sizeMB: 18059
Mds-Fs-sizeMB: 8789
Mds-Fs-Total-count: 3
Mds-Fs-Total-freeMB: 19611
Mds-Fs-Total-sizeMB: 27852
Mds-Host-hn: alliance.unl.edu
Mds-keepto: 20050821212231Z
Mds-Memory-Ram-freeMB: 1242
Mds-Memory-Ram-sizeMB: 2009
Mds-Memory-Ram-Total-freeMB: 1242
Mds-Memory-Ram-Total-sizeMB: 2009
Mds-Memory-Vm-freeMB: 1015
Mds-Memory-Vm-sizeMB: 1027
Mds-Memory-Vm-Total-freeMB: 1015
Mds-Memory-Vm-Total-sizeMB: 1027
</verbatim>

Here's part from the middle, having to do with MIS:

<verbatim>
# mis, thpc-1.unl.edu, local, grid
dn: GlueSALocalID=mis,GlueSEUniqueID=thpc-1.unl.edu,Mds-Vo-name=local,o=grid
objectClass: GlueSATop
objectClass: GlueSA
objectClass: GlueSAPolicy
objectClass: GlueSAState
objectClass: GlueSAAccessControlBase
objectClass: GlueKey
objectClass: GlueSchemaVersion
GlueSARoot: mis
GlueSAPath: mis
GlueSAType: permanent
GlueSALocalID: mis
GlueSAPolicyMaxFileSize: 10000
GlueSAPolicyMinFileSize: 1
GlueSAPolicyMaxData: 100
GlueSAPolicyMaxNumFiles: 10
GlueSAPolicyMaxPinDuration: 10
GlueSAPolicyQuota: 0
GlueSAPolicyFileLifeTime: permanent
GlueSAStateAvailableSpace: 1
GlueSAStateUsedSpace: 1
GlueSAAccessControlBaseRule: mis
GlueChunkKey: GlueSEUniqueID=thpc-1.unl.edu
GlueSchemaVersionMajor: 1
GlueSchemaVersionMinor: 2
</verbatim>

Finally, here's the last lines:

<verbatim>
# local, Grid
dn: Mds-Vo-name=local,o=Grid
objectClass: GlobusStub

# search result
search: 2
result: 0 Success

# numResponses: 59
# numEntries: 58
</verbatim>

<FONT color='magenta'><B>
More information on how to configure GIP can be found from :<br/>
<a href="http://gdsuf.phys.ufl.edu:8080/cmssoft/giposg/srm-dcache.example.html" target="_blank">SRM-dCache Example (Template GIP configuration file and script)</a> </B><br/>
</FONT>
---+++ How to Register/Publish Your SE with OSG

<a href ="http://www.opensciencegrid.org/index.php?option=com_wrapper&Itemid=68&elMenu=Grid%20Support">
Go register your
Storage Element with OSG</a>.  The Grid Operations Center will add it to !GridCat.

---+++ How to Troubleshoot Storage Information in Gridcat

The !GridCat tests for an SE vary depending on storage services advertised through
the SE information provider which could have a different hostname from the SE host itself. Typically, in- and out-bound file tranfer client command execution must be carried out successfully in order for a storage service to be functional. The client command execution commands include globus-url-copy or srmcp for gsiftp and srm protocol, respectively. At the moment, these two service protocols are supported by !GridCat. !GridCat performs only very simple in- and out-bound file tranfer tests.

In order for an SE site to be cataloged to the OSG !GridCat instance, a few requirements must be met:
	1. Storage service hostname
	2. Information Provider protocol, hostname, and port number
	3. Information Provider query string 

An example SE would be 
	1. cmssrm.fnal.gov
	2. ldap://cmslcgce.fnal.gov:2170
	3. "mds-vo-name=USCMS-FNAL-WC1,o=grid"

After these three fundamental parameters are provided to the Grid Operations Center via the resource
registration forms, they will be provided to !GridCat.
As the first SE test, !GridCat will try an ldapsearch query on which services are provided (gsiftp and/or SRM).
Then, !GridCat will construct the second test command string, e.g., 
<verbatim>
srmcp -x509_user_proxy=/home/gridcat/.gridcat/mygridcat.proxy -retry_num=0 \
srm://cmssrm.fnal.gov:8443/resilient/ivdgl/gridcat.ss.test.gridcat \
file:////tmp/gridcat.ss.test.gridcat
</verbatim>
for an SRM inbound test;

<verbatim>
globus-url-copy \
gsiftp:///cmssrm.fnal.gov/resilient/ivdgl/gridcat.ss.test.gridcat \
file:////tmp/gridcat.ss.test.gridcat 
</verbatim>
for a gsiftp inbound test.

Outbound tests are performed similarly.

If the LDAP query is successful and inbound and outbound tests pass for each service provided,
the !GridCat status will become green for the SE.

In order for !GridCat to parse srm access root directory, etc, the BDII or MDS must have been configured with GIP. In the above example, the GIP is configued using the BDII service. However, since MDS comes with the OSG CE which could act as the information provider for both CE and SE or MDS can be installed on the SE directly, it is convenient for the site admin to configure the GIP.

<hr/>
<FONT color='magenta'><B>What !GridCat expects for Glue attribute values ?</B></FONT>

Since !GridCat obtains SE information from MDS with GIP which implements Glue schema, !GridCat interprets Glue schema in the following way:<br/>
For Glue 1.2

| !Glue Attribute | Typical/Example Value | Comments (what !Gridcat thinks) | 
| !GlueSchemaVersionMajor | 1 | | 
| !GlueSchemaVersionMinor | 2 |  | 
| !GlueSEName | MY_STROAGE_SITE_NAME | Sitename for !GridCat. Pick a descriptive human readable and a name that can be used for unix file name | 
| !GlueSEUniqueID | srmcms.phys.ufl.edu | SE hostname | 
| dataGridVersion | OSG-0_2_1 | !GridName-Version, Only for Glue 1.1|
| !GlueSEAccessProtocolType | srm | protocol, srm or gsiftp | 
| !GlueSEAccessProtocolPort | 8443 | port number | 
| !GlueSARoot | cms:/cms | Access root from various protocols in the form {VO}:{ACCESS_ROOT} so that test command : <br/>srmcp !file:////tmp/gridcat.ss.test.gridcat \ <br/> srm://srmcms.phys.ufl.edu:8443/cms/gridcat.ss.test.gridcat <br/> can be executed successfully for example | 
| !GlueSAAccessControlBaseRule | cms | accessible VO name  | 
| !GlueSAStateAvailableSpace | 1 | dynamic available space  | 
| !GlueSAStateUsedSpace | 1 | dynamic used space  | 
| !GlueSAPolicyFileLifeTime | Permanent | file type  | 
<hr/>

---++ How to Test SE Implementation
		Not Available 

---++ More information 

	* Integration.CMSSrmdCache : CMS SRM-dCache Readiness Plan
	* Integration.DiskResourceManager - Information about the DRM SE implementation.
	* Integration.GenericInformationProviders - Information provision on OSG.
	* Integration.GlueOSG - Glue Schema description
	* Integration.GridCat - Information about Storage Elements on the OSG
	* Integration.LocalStorageRequirements - Local storage definitions
	* Integration.SRMClientTools - SRM Client Tools in OSG
	* Provisioning.StorageServiceCheckList - Checklist for OSG 0.2 provisioning

 <!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.NehaSharma - 09 Nov 2005
-- Main.RobGardner - 26 May 2005

%STOPINCLUDE%

