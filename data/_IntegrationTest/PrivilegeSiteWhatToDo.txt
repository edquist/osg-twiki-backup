%META:TOPICINFO{author="DanYocum" date="1113578948" format="1.0" version="1.12"}%
%META:TOPICPARENT{name="SiteAdmins"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>%TOPIC%
%TOC%
%STARTINCLUDE%



---++Figure out what to do

The flowchart below will help you decide what kind of configuration you should setup.


Definitions:
	* Role based authorization: a user can get a different extended proxy from the VO VOMS server. This says, for example, that in a moment he is acting as a member of the analysis group, and the other is acting as a production coordinator. Role based authorization will allow you to map the user to a different account depending on the role.
	* Account pools: as implemented by GUMS, work as follow: GUMS will assign to each DN one account. The user will be mapped always to the same DN from then on. Accounts won't be created or recycled by GUMS. You can choose to have one or more pools (for example, a pool for VO, a pool for group in VO, a pool for role in a VO, a pool for groups accross VO, etc...)
	* Central management: it means being able to control all gatekeepers access from a single file, and not having to look/change configuration on each gatekeeper.

<verbatim>
				 |
				 |
  --------------------------						----------------------
  | Is your site going to  |		  YES!		| Refer to			  |
  | support role based	  |----------------->| Full privilege	  |
  | authorization?			|						| site configuration |
  --------------------------						----------------------
				 |														 
			 NO |
				 |
  ------------------------------					--------------------------
  | Do you want to use account |	  YES!		| Refer to compatibility |
  | pools at your site?		  |-------------->| site configuration	  |
  ------------------------------					--------------------------
				 |														 
			 NO |
				 |
  ------------------------------					------------------------
  | Would you like to manage	|	  YES!		| Refer to				 |
  | all your mapping from a	 |-------------->| compatibility		  |
  | single point?				  |					| site configuration	|
  ------------------------------					------------------------
				 |
			 NO |
				 |
  ----------------------- 
  | Refer to				|
  | Ye olde grid3		 |
  | site configuration  |
  -----------------------
</verbatim>

---+++ Full privilege site configuration
In this configuration, you will have:
	* One GUMS server per local account domain to manage the mapping from Grid identity (DN+attributes) to local uid
	* Your gatekeeper(s) configured with the PRIMA module to connect to the GUMS server for each gatekeeper request
	* Your gatekeeper(s) configured with gums-host to retrieve the accounting inverse map in a cron job
So you need to:
	* Install one GUMS at your site for the grid account domain (e.g. YP domain)
	* Configure it (if the default OSG policy is not good enough for you)
	* Configure the PRIMA module on your gatekeeper(s)
	* Install and configure gums-host on your gatekeeper(s)

---+++ Compatibility site configuration
You do not _require_ the full privilege site configuration, but it's advisable. You will not be able to provide role based authorization in this configuration. Also, you will introduce delays since each gatekeeper will have to regenerate the map before implementing the new policy or allowing new users. You should fall back to this configuration if:
	* Your gatekeeper(s) or service must be configured through grid-mapfile (i.e. you have tools or services that manipolate that file directly, without passing through globus)
	* The idea of running GUMS 24/7 scares the hell out of you, and you'd rather approach with caution.
In this configuration, you will have:
	* One GUMS server per local account domain to manage the mapping from Grid identity (DN+attributes) to local uid
	* Your gatekeeper(s) configured with gums-host to retrieve both maps in a cron job
So you need to:
	* Install GUMS at your site
	* Configure it (if the default OSG policy is not good enough for you)
	* Install and configure gums-host on your gatekeeper(s)

---+++ "Ye olde grid3" site configuration
You do not _require_ "full privilege" or "compatibility", but you still can use them if you want. You'll probably prefer this configuration if:
	* You are a small site (one gatekeeper)
In this configuration, you will have:
	* The EDG mkgridmap creating the grid-mapfile running as a cron job

---++Do it!

If you choose to install the full privilege or compatability mode, you will need to install GUMS. If
you're choosing "Ye olde grid3 mode" you're done here and can go back to the default installation.

---+++ Install GUMS
First of all, make sure no old copy of gums is installed on your system.  'ls $VDT_LOCATION/gums-server' should not exist.  You can install GUMS from VDT (since VDT 1.3.4, [now using VDT 1.3.5, DanYocum 4/15/05]). If you need more details about GUMS, look at the GUMS site:
http://grid.racf.bnl.gov/GUMS

<verbatim>
# pacman -get http://www.cs.wisc.edu/vdt/vdt_135_cache:GUMS
</verbatim>

This will install both the GUMS server and the GUMS client. To start/stop GUMS:
<verbatim>
# $VDT_LOCATION/post-install/tomcat-5 start|stop
</verbatim>

You'll want to make it so it starts/shuts down with the server:
<verbatim>
# ln -s $VDT_LOCATION/post-install/tomcat-5 /etc/init.d/tomcat-5
# chkconfig --list
# chkconfig --add tomcat-5
# chkconfig tomcat-5 on
# chkconfig --list
</verbatim>

You can also install it manually, or learn more about the installation at:
http://grid.racf.bnl.gov/GUMS/guide_howto_installation.html

---+++ Configure GUMS

Log into your host as root and run '$VDT_LOCATION/gums-service/sbin/addAdmin "your CN"' to gain admin access to your gums web interface.  A template gums.config file is installed in $VDT_LOCATION/tomcat/v5/webapps/gums/WEB-INF/classes/gums.config.  It is very bare.  To get some instant gratification, place the following into the file:

<verbatim>
		<groupMapping name='osg' accountingVo='osg' accountingDesc='OSG'>
		  <userGroup className='gov.bnl.gums.VOMSGroup'
					 url='https://grid03.uits.indiana.edu:8443/edg-voms-admin/vos/services/VOMSAdmin'
					 persistenceFactory='mysql' name='osg' voGroup="/vos/osg"
					 sslCertfile='/etc/grid-security/http/httpcert.pem'
					 sslKey='/etc/grid-security/http/httpkey.pem' ignoreFQAN="true"/>
		 <accountMapping className='gov.bnl.gums.GroupAccountMapper' 
					 groupName='osg' />
	  </groupMapping>
</verbatim>

If you have admin access to your VOMS server, you will need to allow others (i.e., your gums server) to view your groups.  Point your browser at your VOMS server (https://your-voms:8443/edg-voms-admin/your-vo/webui/Admin/global-acl/edit.  Click on "Operation -> List", then click "Add new entry."  This will allow all outside users to view your VO.

Now, go back to your gums web interface at https://your-gums-server:8443/gums, click on "Generate Grid Mapfile," enter the hostname of the gums server and click "Generate grid-mapfile."  You should get the text of a grid-mapfile formatted output.

To fully configure your gums.config file for your site, take a look at the following links.  

The gums configuration guide:
http://grid.racf.bnl.gov/GUMS/guide_howto_configuration.html
and the gums.config reference:
http://grid.racf.bnl.gov/GUMS/guide_config_gums.html
to explore more options.



NB: you do NOT need to restart GUMS when you change the configuration. It will be picked up automatically.

---+++ Configure the PRIMA module
PRIMA comes with your VDT installation, you will just need to change a couple of configuration files.

You can find documentation on how to activate the PRIMA Authorization module in VDT to query a GUMS Identity Mapping Service at: https://plone3.fnal.gov/opensciencegrid/techgroups/tg-policy/vo-privilege: Title: "Activating the PRIMA Authorization Module in VDT 1.3.1". 

Also on this site is a document with the URLs of two test GUMS Servers that may be used for evaluation: Title: "GUMS Mapping Servers for ITB 0.1.0". 

---+++ Install and configure gums-host
You can install the GUMS client from VDT:

<verbatim>
# pacman -get http://www.cs.wisc.edu/vdt/vdt_134_cache/GUMS-Client
</verbatim>

To generate the maps at 6 hour intervals:
<verbatim>
# ln -s $VDT_LOCATION/gums/bin/gums-host-cron /etc/cron.hourly/gums-host-cron
</verbatim>

For more information about the GUMS Client, look within at:
http://grid.racf.bnl.gov/GUMS/guide_howto_installation.html
They are toward the end.

---+++ Install and configure EDG mkgridmap
It will come prepackaged and preconfigured with the OSG installation. You just need to check that the deamon "edg-gridmapfile-upgraded" is running.

---++ Further information
Refer to the PrivilegeOSG page.

<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.GabrieleCarcassi - 25 Mar 2005

%STOPINCLUDE%

