%META:TOPICINFO{author="LeighGrund" date="1114100402" format="1.0" version="1.2"}%
%META:TOPICPARENT{name="ItbRel015"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>%TOPIC%
%TOC%
%STARTINCLUDE%



---+++ Introduction
 
GUMS (Grid User Management System) is a Grid Identity Mapping Service. Identity mapping is necessary when a site's resources do not use GRID credentials natively, but instead use a different mechanism to identify users, such as UNIX accounts or Kerberos principals. In these cases, the GRID credential for each incoming job must be associated with an appropriate site credential. The GUMS server performs this mapping and communicates it to the gatekeepers. The gatekeepers are charged with enforcing the site mapping established by GUMS. The GUMS client (gatekeeper) portion consists of an admin tool for querying and/or changing the state of the server. Typically, the term "GUMS" refers to the server portion.

GUMS is particularly well suited to a heterogeneous environment with multiple gatekeepers; it allows the implemenation of a single site-wide usage policy, thereby providing better control and security for access to the site's grid resources. Using GUMS, individual resource administrators are able to assign different mapping policies to different groups of users and define groups of hosts on which the mappings will be used. GUMS was designed to integrate with the site's local information services (such as HR databases or LDAP).

For the OSG ITB we will be using two senerios, "Full Privilege" and the "Compatibility" site configurations.

More Information can be obtained from the following resources:

	* OSG Plone https://plone3.fnal.gov/opensciencegrid/techgroups/tg-policy/vo-privilege
	* The Privilege project <a href="http://computing.fnal.gov/docs/products/voprivilege/">homepage</a> contains links to everything.  
	* Transition plan: http://computing.fnal.gov/docs/products/voprivilege/documents/transition-to-privilege.html


---+++ Install GUMS

First of all, make sure no old copy of gums is installed on the system you're using for the GUMS server ('ls $VDT_LOCATION/gums-service' should return fail to find the file).  You should install GUMS from VDT (VDT %OSG_ITB_VDT_VERSION% or newer). The full GUMS service description and a detailed manual is at the GUMS site:
http://grid.racf.bnl.gov/GUMS

<verbatim>
# pacman -get http://www.cs.wisc.edu/vdt/vdt_135_cache:GUMS
</verbatim>

This will install both the GUMS server and the GUMS client. To start/stop GUMS:
<verbatim>
# $VDT_LOCATION/post-install/tomcat-5 start|stop
# $VDT_LOCATION/post-install/apache start|stop
</verbatim>

You'll want to make it so it starts/shuts down with the server.  The VDT will do this for you if you answer "y" to the question "Would you like to enable the GUMS server to run automatically?".  If you answer "n", or do the install as non-root, you can set up the services with the following commands:
<verbatim>
# ln -s $VDT_LOCATION/post-install/tomcat-5 /etc/init.d/tomcat-5
# ln -s $VDT_LOCATION/post-install/apache /etc/init.d/apache
# chkconfig --list
# chkconfig --add tomcat-5
# chkconfig --add apache
# chkconfig tomcat-5 on
# chkconfig apache on
# chkconfig --list
</verbatim>

You can also install it manually, or learn more about the installation at:
http://grid.racf.bnl.gov/GUMS/guide_howto_installation.html

---+++ OSG-ITB gum.config groupmappings

<verbatim>
  <groupMappings>

		<groupMapping name='ivdgl' accountingVo='ivdgl' accountingDesc='iVDgL'>
		  <userGroup className='gov.bnl.gums.VOMSGroup'
url='https://grid03.uits.indiana.edu:8443/edg-voms-admin/vos/services/VOMSAdmin'
					  persistenceFactory='mysql' name='ivdgl' voGroup="/vos/services"
					  sslCertfile='/etc/grid-security/http/httpcert.pem'
					 sslKey='/etc/grid-security/http/httpkey.pem' ignoreFQAN="true"/>

		 <accountMapping className='gov.bnl.gums.GroupAccountMapper' 
							 groupName='ivdgl' />
		</groupMapping>

		<groupMapping name='osg' accountingVo='osg' accountingDesc='OSG'>
		  <userGroup className='gov.bnl.gums.VOMSGroup'
url='https://grid03.uits.indiana.edu:8443/edg-voms-admin/vos/services/VOMSAdmin'
					  persistenceFactory='mysql' name='osg' voGroup="/vos/osg"
					  sslCertfile='/etc/grid-security/http/httpcert.pem'
					 sslKey='/etc/grid-security/http/httpkey.pem' ignoreFQAN="true"/>
		 <accountMapping className='gov.bnl.gums.GroupAccountMapper' 
							 groupName='osg' />
		</groupMapping>

		<groupMapping name='fmri' accountingVo='fmri' accountingDesc='FMRI'>
		  <userGroup className='gov.bnl.gums.VOMSGroup'
url='https://grid03.uits.indiana.edu:8443/edg-voms-admin/vos/services/VOMSAdmin'
					  persistenceFactory='mysql' name='fmri' voGroup="/vos/fmri"
					  sslCertfile='/etc/grid-security/http/httpcert.pem'
					 sslKey='/etc/grid-security/http/httpkey.pem' ignoreFQAN="true"/>
		 <accountMapping className='gov.bnl.gums.GroupAccountMapper' 
							 groupName='fmri' />
		</groupMapping>

		<groupMapping name='usatlas' accountingVo='usatlas' 
					 accountingDesc='ATLAS'>
		  <userGroup className='gov.bnl.gums.VOMSGroup'
url='https://vo.racf.bnl.gov:8443/edg-voms-admin/atlas/services/VOMSAdmin'
					 persistenceFactory='mysql'
					 name='usatlas' voGroup="/atlas" 
					 sslCertfile='/etc/grid-security/http/httpcert.pem'
					 sslKey='/etc/grid-security/http/httpkey.pem' ignoreFQAN="true"/>
		  <accountMapping className='gov.bnl.gums.GroupAccountMapper' 
							 groupName='usatlas1' />
		</groupMapping>

		<groupMapping name='cdf' accountingVo='cdf' accountingDesc='CDF'>
			<userGroup className='gov.bnl.gums.VOMSGroup'
url='https://testbed008.cnaf.infn.it:8443/edg-voms-admin/cdf/services/VOMSAdmin'
					persistenceFactory='mysql' name='cdf' voGroup="/cdf" 
					sslCertfile='/etc/grid-security/http/httpcert.pem'
					sslKey='/etc/grid-security/http/httpkey.pem' ignoreFQAN="true"/>
		  <accountMapping className='gov.bnl.gums.GroupAccountMapper' 
							 groupName='cdf' />
		</groupMapping>
	 <groupMapping name='grase' accountingVo='grase' accountingDesc='GRASE'>
			<userGroup className='gov.bnl.gums.VOMSGroup'
url='https://dylan.ccr.buffalo.edu:8443/edg-voms-admin/GRASE/services/VOMSAdmin'
				  persistenceFactory='mysql' name='grase' voGroup="/GRASE/grid"
				  sslCertfile='/etc/grid-security/hostcert.pem'
				  sslKey='/etc/grid-security/hostkey.pem' ignoreFQAN="true"/>
		<accountMapping className='gov.bnl.gums.GroupAccountMapper'
				  groupName='grase' />	 
		</groupMapping>

  <groupMapping name='uscms' accountingVo='uscms' accountingDesc='CMS'>
		<userGroup className='gov.bnl.gums.VOMSGroup'
url='https://cmssrv17.fnal.gov:8443/edg-voms-admin/uscms/'
					 persistenceFactory='mysql'
					 name='uscms' voGroup="/uscms/gumstest"
sslCertfile='/etc/grid-security/hostcert.pem'
sslKey='/etc/grid-security/hostkey.pem' ignoreFQAN="true"/>
		<accountMapping className='gov.bnl.gums.GroupAccountMapper'
  groupName='uscms01' />
	 </groupMapping>

  <groupMapping name='sdss' accountingVo='sdss' accountingDesc='SDSS'>
		<userGroup className='gov.bnl.gums.VOMSGroup'
url='https://hotdog63.fnal.gov:8443/edg-voms-admin-sdss/'
					 persistenceFactory='mysql'
					 name='sdss' voGroup="/sdss/grid3"
sslCertfile='/etc/grid-security/hostcert.pem'
sslKey='/etc/grid-security/hostkey.pem' ignoreFQAN="true"/>
		<accountMapping className='gov.bnl.gums.GroupAccountMapper'
  groupName='sdss' />
	 </groupMapping>

  <groupMapping name='gadu' accountingVo='gadu' accountingDesc='GADU'>
		<userGroup className='gov.bnl.gums.VOMSGroup'
url='https://cmsvo.fnal.gov:8443/edg-voms-admin/gadu/'
					 persistenceFactory='mysql'
					 name='gadu' voGroup="/gadu/grid3users"
sslCertfile='/etc/grid-security/hostcert.pem'
sslKey='/etc/grid-security/hostkey.pem' ignoreFQAN="true"/>
		<accountMapping className='gov.bnl.gums.GroupAccountMapper'
  groupName='gadu' />
	 </groupMapping>

  </groupMappings>
</verbatim>

---+++ Configure GUMS

	* Add yourself to the list of gum admins.  Log into your gums host (as root), cd to $VDT_LOCATION/gums-service/sbin and run './addAdmin "your CN"' to gain admin access to your gums web interface.  
		* Note: you must run addAdmin from the sbin directory.  The VDT hopes to fix this in a future release.
	* A template gums.config file is installed in $VDT_LOCATION/tomcat/v5/webapps/gums/WEB-INF/classes/gums.config.  It is very bare.  To get some instant gratification, place the following into the file:

<verbatim>
		<groupMapping name='osg' accountingVo='osg' accountingDesc='OSG'>
		  <userGroup className='gov.bnl.gums.VOMSGroup'
					 url='https://grid03.uits.indiana.edu:8443/edg-voms-admin/vos/services/VOMSAdmin'
					 persistenceFactory='mysql' name='osg' voGroup="/vos/osg"
					 sslCertfile='/etc/grid-security/http/httpcert.pem'
					 sslKey='/etc/grid-security/http/httpkey.pem' ignoreFQAN="true"/>
		 <accountMapping className='gov.bnl.gums.GroupAccountMapper' 
					 groupName='osg' />
	  </groupMapping>
</verbatim>

	* Now, go back to your gums web interface at https://your-gums-server:8443/gums, click on "Generate Grid Mapfile," enter the hostname of the gums server and click "Generate grid-mapfile."  You should get the text of a grid-mapfile formatted output.
	* Now, connect your gums server to your VOMS server.  First you need to allow others (i.e., your gums server) to list the contents of your VO.  Point your browser at your VOMS server (https://your-voms:8443/edg-voms-admin/your-vo/webui/Admin/global-acl/edit.  Click on "Operation -> List", then click "Add new entry."  This will allow all outside users to view your VO.  
	* Add an entry for your VOMS server to your gums.config like the one above, modified accordingly.  There are lots of options that can be added to the gums.config file.  For full details see the following documents:  
	* PRIMA 0.2 (from ItbRel015) can not interface to a GUMS server that runs with a service (vs host) certificate.  If you will be using PRIMA you need to switch the certificate used by gums:
<verbatim>
		# cd /etc/grid-security/http
		# mv httpkey.pem httpkey.pem.sav
		# mv httpcert.pem httpcert.pem.sav
		# cd ..
		# cp hostkey.pem http/httpkey.pem
		# cp hostcert.pem http/httpcert.pem
		# chown -R daemon:daemon http
</verbatim>
	
The gums configuration guide:
http://grid.racf.bnl.gov/GUMS/guide_howto_configuration.html
and the gums.config reference:
http://grid.racf.bnl.gov/GUMS/guide_config_gums.html
to explore more options.

---+++ Full privilege site configuration

In this configuration, you will have:
	* One GUMS server per local account domain to manage the mapping from Grid identity (DN+attributes) to local username.  A local account domain is similar to an YP domain.
	* Your gatekeeper(s) configured with the PRIMA module to connect to the GUMS server for each gatekeeper request.
	* Your gatekeeper(s) configured with gums-host to retrieve the accounting inverse map in a cron job
So you need to:
	* Install one GUMS at your site for the grid account domain (e.g. YP domain)
	* Configure it (if the default OSG policy is not good enough for you)
	* Configure the PRIMA module on your gatekeeper(s)
	* Install and configure gums-host on your gatekeeper(s)

---+++ Compatibility site configuration

You do not _require_ the full privilege site configuration, but it's advisable. You will not be able to provide role based authorization in this configuration. Also, you will introduce delays since each gatekeeper will have to regenerate the map before implementing the new policy or allowing new users. You should fall back to this configuration if:
	* Your gatekeeper(s) or service must be configured through grid-mapfile (i.e. you have tools or services that manipolate that file directly, without passing through globus)
	* The idea of running GUMS 24/7 scares the hell out of you, and you'd rather approach with caution.
In this configuration, you will have:
	* One GUMS server per local account domain to manage the mapping from Grid identity (DN+attributes) to local username
	* Your gatekeeper(s) configured with gums-host to retrieve both maps in a cron job
So you need to:
	* Install GUMS at your site
	* Configure it (if the default OSG policy is not good enough for you)
	* Install and configure gums-host on your gatekeeper(s)

<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.LeighGrund - 19 Apr 2005

%STOPINCLUDE%

