%META:TOPICINFO{author="ElizabethChism" date="1466010179" format="1.1" version="1.6"}%
<!-- This is the default OSG Trash/Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>%TOPIC%
%TOC%
%STARTINCLUDE%
     

---++ Introduction
   The JobMon system allows users to view process status and log files interactively as the job runs. It thus provides the grid equivalent of "ls, top, tail, ..." in unix. This facilitates debugging and reduces unnecessary resource consumption due to user error.
   * See also [[http://jobmon.sourceforge.net/][JobMon SourceForge]]

---++ Readiness and Trash/Integration Plan
  We describe a service readiness and integration plan for JobMon. JobMon is integrated in to [[http://vdt.cs.wisc.edu/releases/1.3.7/release.html][VDT release 1.3.7]] together with Clarens. Since the service is already developed and "ready", the following focuses on integration aspects. 

---+++ Description of Service
There are three separate places where code is run in an individual transaction. There is the persistent Clarens web-service generally located at the execution site, called Clarens server  node. The job runs a  JobMonDaemon  process which runs the communication and executes the commands on the worker node. The  JobMonDaemon  persists for as long as the job is executing. Finally there is the client code, which a users executes when they want to interact with the remote job, this persists only until the transaction has completed. 

We provide the Clarens web-service part as a shared service between VOs that sites can optionally install.
We provide the JobMonDaemon that application developers need to integrate into their applications in order to use JobMon as an end-to-end system.
We provide an example client that VOs need to integrate into their user interfaces to make JobMon available as an end-to-end system for their users. 

---+++ Dependencies and interactions with other services
JobMon relies on [[http://clarens.sourceforge.net/][Clarens]] Grid-Enabled Web Services Framework for authentication and authorization for commands requests.

---+++ Resources required
   * Clarens + Apache + pyhthon2.2.2
   * Clarens server nodes requries static external IP connections to WAN  

---+++ Installation and Configuration
   * JobMon only requires Clarens server node installation and configuration. The JobMonDaemon code and client code and their usages are written in the next section "Test and Validation"
   * The installation below is based on the example to setup a Clarens server at clarens-1.t2.ucsd.edu and to use
TCP connection wakeup method
   * VDT installation of Clarens-JobMon 
      * Create a directory as your VDT_LOCATION. For example, /data/vdt/
      * Get pacman http://physics.bu.edu/pacman/
      <verbatim>
      click download and put tarball in VDT_LOCATION 
      tar xzvf  pacman-latest.tar.gz
      cd pacman-3.13.1
      source setup.(c)sh
      </verbatim>
      * You can't use pacman inside the pacman directory. Please change back to $VDT_LOCATION and start installation
      To check if your platform is supported run:
      <verbatim> 
      pacman -platforms
      </verbatim>
      this may complain about not knowing your platform in which case try:
      <verbatim> 
      pacman -platforms -pretend-platform redhat-7.0
      </verbatim>
      <verbatim> 
      pacman -allow unsupported-platforms
      pacman -get http://www.cs.wisc.edu/vdt/vdt_1310_cache:Clarens-JobMon
      </verbatim>


   * Put host Cert/Key file
      * At this stage, you must have Clarens and JobMon installed already
      * Put your own host cert/key into prefered path, e.g.,/etc/grid-security/http/
      * make sure the owener.group is daemon.daemon
      * If you don't have specific host cert/key file, you can use default one in normal Clarens package. However, you have to make a normal Clarens clarens servre installation first, see [[http://clarens.sourceforge.net/index.php?intro+cvs][html]]. The cert/key files are in 
    <verbatim>
    /opt/openpkg/etc/grid-security/hostcert.pem
    /opt/openpkg/etc/grid-security/hostkey.pem
    </verbatim>

   * VDT Clarens Configuration
      * Using clarens script: $VDT_LOCATION/clarens/bin/clarens-server-config
      <verbatim>
  Cert/key directory /etc/grid-security/http
  Server private key hostkey.pem
  Server certificate hostcert.pem

  [JobMon]
     Server name         clarens-1.t2.ucsd.edu         

      </verbatim>
   * VDT Apache server configuration:
      * $VDT_LOCATION/apache/conf/httpd.conf
      <verbatim>
      ServerName clarens-1.t2.ucsd.edu
      </verbatim>
      * $VDT_LOCATION/apache/conf/ssl.conf. If you want to change port number, this is where you want to look for. Make sure update all port number. The default is 8443.

   * Start Apache server     
      * $VDT_LOCATION/post-install/apache start
      * link to this webserver and make sure you see the clarens homepage

   * Start JobMonTcpServer
      * $VDT_LOCATION/clarens/bin/JobMonTcpServer_startup
      * Check log file and make sure read correct configuration
      <verbatim>
      cat /tmp/JobMon_TCPServer.log
      [timestamp] JobMon TCP server starts at clarens-1.t2.ucsd.edu:2000
      </verbatim> 
   * For more configuration details, please see [[http://jobmon.sourceforge.net/Installation.html][html]]

---+++ Testing and Validation
   * Now, you are ready to use JobMon. The  JobMonDaemon and client scripts are in 
      <verbatim>
      $VDT_LOCATION/clarens/bin/JobMon.py
      $VDT_LOCATION/clarens/bin/JobMonDaemon.py     
      </verbatim>
   * The tests below requires valid X.509 proxy. You can specify the proxy location and the example below is in /tmp/x509up_u11394 
   * First test: Query Registered Jobs
   <verbatim>
python2 JobMonDaemon.py --serverURL https://clarens-1.t2.ucsd.edu:8443/clarens --joblist
   </verbatim>
   * Second test: Start a JobMonDaemon
   <verbatim>
python2 JobMonDaemon.py --jobname testjob --serverURL https://clarens-1.t2.ucsd.edu:8443/clarens --certfile /tmp/x509up_u11394 --keyfile /tmp/x509up_u11394
   </verbatim>
   * Final test: Query "ls" command 
   <verbatim>
python2 JobMon.py --serverURL https://clarens-1.t2.ucsd.edu:8443/clarens --jobname testjob --command "ls -l"
   </verbatim>

   * To know more about client usage of JobMon [[http://jobmon.sourceforge.net/Usage.html][html]]
---++ Links to Documents
   * Design Overview [[http://jobmon.sourceforge.net/JobMonDesign.ps][ps]] [[http://jobmon.sourceforge.net/JobMonDesign.pdf][pdf]] [[http://jobmon.sourceforge.net/JobMonDesign/index.html][html]]

---++ Kown Issues
---+++ How do I know DN (subject name) defined in Clarens
   *  Using /usr/bin/openssl 
   <verbatim>
[cdfcaf@cdftest schsu]$ rpm -qf /usr/bin/openssl
openssl-0.9.7a-33.12

[cdfcaf@cdftest schsu]$ /usr/bin/openssl  x509 -subject -in /tmp/xschsu -noout
subject= /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Shih-chieh Hsu/UID=schsu
</verbatim>  

---++ [[JobMonVDTInstalationNotes][VDT Installation Notes]]

---++ Contact Information
   * [[mailto:conrad@hep.caltech.edu][Conrad Steenberg]], California Institute Technology
   * [[mailto:schsu@fnal.gov][Shih-Chieh Hsu]], University of California San Diego
   * [[mailto:lipeles@fnal.gov][Elliot Lipeles]], University of California San Diego
   * [[mailto:fkw@fnal.gov][Frank Würthwein]], University of California San Diego



<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.ShihChiehHsu - 02 Nov 2005

%STOPINCLUDE%

