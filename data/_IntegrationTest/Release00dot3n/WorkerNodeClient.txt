%META:TOPICINFO{author="StevenTimm" date="1142546272" format="1.0" version="1.12"}%
%META:TOPICPARENT{name="ItbRel031"}%
---+!!<nop>%TOPIC%
%TOC%
%STARTINCLUDE%


---++ Introduction

This is a minimal set of executables that need to be made available to the worker nodes in a Compute Element.

It may be installed on a shared filesystem, or locally on each worker node (as long as the path on each worker node is the same).  This install does not
need to be done as root.

You will be prompted for this path when running the =configure-osg.sh= script on the gatekeeper in order to set
the =$OSG_GRID= variable.

You need these client programs available from the worker node 
so that jobs which need to access grid-enabled mass storage during
the job (e.g. via globus-url-copy, VDS, or srmcp) can do so.  The worker
node also has to have either via NFS or locally a good set of 
certificate authority files with up to date certificate revocation 
lists (CRL's) for those clients to work properly.


---++ Known problems
%RED% If you answer "n" to the option to install the
CA certificate files, it will install them anyway and 
create a couple of broken symlinks.  
Also, if you answer "n" to install the edg-crl-upgraded, 
it will move any existing /etc/init.d/edg-crl-upgraded 
to edg-crl-upgraded.vdtsave and stop any existing daemons.

See below for 
suggested workaround. S. Timm 3/16/06 %ENDCOLOR%
---++ Installation
Install with <Br>
=pacman -get OSG:osg-wn-client-0.4.1=

For purposes of OSG-ITB 0.3.6, do 
=pacman -get iVDGL:wn-client-0.3.6=

The installation will first ask if you trust the pacman caches,
and then if you agree to the VDT licenses.  Then there is a question
about the edg-crl-upgraded daemon.

The question looks like this:
<pre>
Do you want the EDG CRL update daemon to be run automatically when
your computer starts up? If so, we will install one file,
edg-crl-updated, into etc/rc.d/init.d/.

It will periodically update the European DataGrid (EDG) certificate
revocation lists (CRLs) It is essential if you are collaborating with
people from the EDG, and not important if you are not.

Do you want the EDG CRL update daemon to be installed? [y/n]  
</pre>
If you are installing this worker node client on a head node
where the OSG CE will also be installed (or has already been 
installed), answer "n".  

On a worker node you should answer "y".  

It then asks for where you would like to install the CA Files.  Question looks 
like this:
<pre>
The VDT typically installs public certificates and signing policy files
for the well-known public CA's. This is necessary in order for you to
perform GSI authentication with any remote Grid services (that have
service/host certificates signed by these CA's).

For more information please refer to the VDT documentation:
http://vdt.cs.wisc.edu/setup_ca.html

Where would you like to install CA files?

Choices:
		  r (root)  - install into /etc/grid-security/certificates
				(existing CA files will be preserved)
		  l (local) - install into $VDT_LOCATION/globus/share/certificates
		  n (no)	 - do not install
</pre>

Answer "l" for local.

---++Automation
This process on many worker nodes can be automated with 
the following script so you don't have to type in the letters.


<pre>
VDTSETUP_AGREE_TO_LICENSES=y
export VDTSETUP_AGREE_TO_LICENSES
VDTSETUP_INSTALL_CERTS=l
export VDTSETUP_INSTALL_CERTS
VDTSETUP_EDG_CRL_UPDATE=y
export VDTSETUP_EDG_CRL_UPDATE
pacman -trust-all-caches -get iVDGL:wn-client-0.3.6
</pre> 

---++Post-install checks
If the OSG WN client is installed along with some other
VDT package on any given node, you should do the following steps afterwards.

Examine /etc/rc.d/init.d/edg-crl-upgraded.
Make sure that it is there, and not moved to edg-crl-upgraded.vdtsave
Make sure it is sourcing the correct location.

Example: OSG CE installed in /usr/local/vdt, OSG WN Client installed 
in /usr/local/grid

Then the line in /etc/rc.d/init.d/edg-crl-upgraded should say 
=if [ -e /usr/local/vdt/setup.sh ]; then source /usr/local/vdt/setup.sh; fi=

Make sure the daemon is started.

Look at the TRUSTED_CA link.
It should point to the real area where your certificates will live,
in this example /usr/local/vdt/globus/share/certificates.
If it doesn't, change it to that location
<pre>

[root@fgtest3 globus]# pwd
/usr/local/grid/globus
[root@fgtest3 globus]# ls -l TRUSTED_CA
lrwxrwxrwx  1 root root 41 Mar 16 15:44 TRUSTED_CA -> /usr/local/grid/globus/share/certificates
ln -s /usr/local/vdt/globus/share/certificates TRUSTED_CA

</pre>

---++Notes
Note--If you are installing this package on a head node / compute 
element where an OSG CE install will also be done afterwards,
it is recommended that you log out and log back in before continuing
with the main OSG CE Install, otherwise all the wn-client
stuff will be in your path and confuse everything.

Note--A side effect of the worker node client as currently configured,
is that $GLOBUS_LOCATION can and does wind up in a different location 
on the head node than it does on the worker node.  The environment
at the beginning of the job will give you $GLOBUS_LOCATION on 
the head node.  You have to source $OSG_GRID/setup.sh to get 
where $GLOBUS_LOCATION is available to you on the worker node.
 

---++Contents

	* http://software.grid.iu.edu/pacman/osg-wn-client-0.4.1
	* http://hep.chicago.edu/ivdgl/wn-client-0.3.6

---++References

	* For reference, the OSG cache directory: http://software.grid.iu.edu/pacman/.
	* For reference, the VDT 1.3.10 cache directory: http://vdt.cs.wisc.edu/vdt_1310_cache/.

---++Alternative Viewpoint and Approach

	* Installation of the worker node client package does imply maintenance of the certificates that it installs.  As an alternative, it is possible to simply rsync the installed full osg installation to the worker nodes, and independently of whether this option is chosen, use rsync to keep the certificates up to date.  
	* Doing anything automatically on the worker nodes requires care.  An example script that looks to see what worker nodes on a cluster using pbsnodes is attached to this page.  It can be edited or replaced with a more general version to match your specific cluster conditions.  Note that the example script does not use the batch system itself, but uses a feature of the local batch scheduler to avoid trying to push certificates to worker nodes that are down and to build a list of operating nodes to receive the update.
	* This issue deserves further discussion.


<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.RobGardner - 30 Nov 2005
-- Main.AlanSill - 02 Mar 2006

%STOPINCLUDE%

-- Main.BurtHolzman - 29 Dec 2005

%META:FILEATTACHMENT{name="wn-cert-sync-pbs" attr="" comment="This file is an example of a synchronization step that can be called in edg-crl-upgrade immediately after completion of an update" date="1141332368" path="wn-cert-sync-pbs" size="4176" user="AlanSill" version="1.1"}%
