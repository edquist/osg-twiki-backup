%META:TOPICINFO{author="JohnWeigand" date="1117813639" format="1.0" version="1.8"}%
%META:TOPICPARENT{name="ValidationPage"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>%TOPIC%
%TOC%
%STARTINCLUDE%


---++Introduction
The [[http://monalisa.caltech.edu][MonALISA]] (Monitoring Agents in A Large Integrated Services Architecture) system provides a distributed service for monitoring, control and global optimization of complex systems. It is based on an ensemble of autonomous multi-threaded, agent-based subsystems which are registered as dynamic services and are able to collaborate and cooperate in performing a wide range of monitoring and decision tasks in large scale distributed applications, and to be discovered and used by other services or clients that require such information. 


---++Configuration 

After installing [[http://monalisa.caltech.edu][MonALISA]] from VDT Repository the configuration script vdt/setup/configure_monalisa.sh must be run. Here is an example:

<verbatim>

# ./configure_monalisa.sh

Please specify user account to run [[http://monalisa.caltech.edu][MonALISA]] daemons as: [daemon]: monalisa
Please specify the farm name [citgrid3]:Caltech_OSG
Please enter your contact name (your name) [root]: Iosif Legrand
Contact email (your email) [root@citgrid3.cacr.caltech.edu]: Iosif.Legrand@cern.ch
City (server's location) []: Pasadena
Country []: US
Location latitude (-180..180) [0]: 34
Location longitude (-180..180) [0]: -118

Do you want to enable Ganglia support (y/n)? [y]y

  On which host is Ganglia Running? [localhost]:
  On which port is Ganglia running? [8649]:

Do you want to enable VO_Modules support (y/n)? [y]: y

Please review the information:

MonaLisa user: monalisa
Farm name: Caltech_OSG
Name: Iosif Legrand
Email: Iosif.Legrand@cern.ch
City: Pasadena
Country: US
Latitude: 34
Longitude: -118
Ganglia: y (localhost:8649)
VO_Modules: y

Is this information correct (y/n)? [n]: y
</verbatim>

---+++<nop>MonaLisa user
The username under which <nop>MonaLisa runs on your CE node.  In most cases it will be either daemon or monalisa.
---+++Farm Name (Unique CE name)
This is the name by which your CE (where we're using "CE" as equivalent to "site") will be seen by the world, so please choose
a name that represents your institution/site. Make sure this name is unique in the OSG-ITB  
[[http://monalisa.caltech.edu][MonALISA]] environment.

How to tell what names are already there? Go to [[http://monalisa.caltech.edu][MonALISA]], click on Repositories, then click on OSG-ITB (the name you will enter as your monitor group name, below). This brings up a map of the OSG-ITB sites. When you're done with the configuration and you start up the daemon, your site should show up here. 

---+++Monitor Group Name
For the OSG ITB, enter OSG-ITB. This specifies the group in which <nop>MonaLisa places your site/CE for monitoring.

---+++Contact Name and Email
Enter the name and email address of the person responsible for the site/CE.
---+++Geographic location (city, country, latitude, longitude)
  You can find some approximate values for your geographic location from:
http://geotags.com/ or you can search your location on Google. Use *only numbers* 
to specify the geographic location. Use "-" to specify West (longitude) or 
South (latitude). In the example above for the longitude we used -118 to specify 118W.

---+++Ganglia Integration

To enable Ganglia interaction with [[http://monalisa.caltech.edu][MonALISA]] answer "y" when asked if you want to connect to a ganglia instance. Otherwise answer "n" for no. 

If yes, then enter the hostname and the port
on which that Ganglia instance runs. To test if [[http://monalisa.caltech.edu][MonALISA]] is able to access Ganglia monitoring 
information just telnet on gmond port and check if you get an XML.

=$telnet localhost 8649=

---+++ VO_Modules Support
This refers to allowing VO modules to collect data from your batch queuing system. %RED%What's VO_modules? %ENDCOLOR%
If you answer "y" to running VO modules, then after finishing with the configure_monalisa.sh script you must edit $VDT_LOCATION/MonaLisa/Service/CMD/ml_env (see below).
 
		To have [[http://monalisa.caltech.edu][MonALISA]] interact with the local batch queuing system, the file site_env (described below) will need to specify the location of the local files.

=# cd $VDT_LOCATION/MonaLisa/Service/CMD= <br>
=# vi site_env=

		Make sure the location variable for your batch system is setup and exported, (PBS_LOCATION, LSF_LOCATION, or FBSNG_LOCATION, as appropriate.)  eg:
<pre>
		PBS_LOCATION="/usr/local/pbs"
		export PBS_LOCATION
</pre>

Additionally, at the end of the site_env file add this line to source the Grid3 environment for MonALISA  (In vdt version 1.3.5 %RED%and following?%ENDCOLOR% this is added automatically):

			=. $VDT_LOCATION/setup.sh=

			 This will allow VO modules to collect data from your batch queuing system.  
			 If the display in the summary view shows red by the name of your site for 
			 VO_JOBS and VO_IO, this can be due to a missing 
			 $VDT_LOCATION/monitoring/grid3-user-vo-map.txt.
			 If VO_JOBS shows orange, this just means that no VO_JOBS are running
			 for any VO on your cluster at the moment.

---++++[[VO_Modules Description]]
			  
---+++Auto-update feature
  %RED%I haven't looked into what this means. AH %ENDCOLOR%
---+++Automatically start daemon
 Do you want the monalisa daemon started automatically at system startup? If so, enter "y".  

To start it manually, enter:

<pre>
# /etc/init.d/MLD start 
</pre>
---++Configuration files
  
If you want more detail than we present in this section, check the [[http://monalisa.caltech.edu/documentation/ml_ser_ug.html][Service User Guide]] on [[http://monalisa.caltech.edu/][MonALISA]] web site.

---+++ml_env

The file for the global configuration is $MonaLisa_HOME/Service/CMD/ml_env. Configuration parameters in this file are:


MONALISA_USER 

 The name of the user that is running the service. It will not start from other accounts or from the root account.


JAVA_HOME 

 The path to your current JDK.


SHOULD_UPDATE

	 Whether or not MonALISA should check for updates when it is started. If this parameter is "true" when MonALISA is started, first it will check for updates and after that it will start. If set to "false" it will not check for updates. This parameter is also used to check for autoupdates when it is running. Please see [[http://monalisa.caltech.edu/documentation/ml_ser_ug.html#start-ml-service-with-autoupdate][Section 2.7, “How to start a Monitoring Service with Autoupdate”]] from the service user guide.


!MonaLisa_HOME

	 Path to your MonALISA installation directory. Environment variables can also be used. (e.g ${HOME}/MonaLisa)


FARM_HOME

	 Path to a directory where reside your farm specific files. It's better to place this directory in the Service directory. (e.g. You can use the variable !MonaLisa_HOME defined above. ${MonaLisa_HOME}/Service/MyTest. MonALISA comes with a simple example in ${MonaLisa_HOME}/Service/myFarm.


FARM_CONF_FILE

	 The file used at the startup of the services to define the clusters, nodes and the monitor modules to be used. It should be in the ${FARM_HOME} directory. (e.g FARM_CONF_FILE="${FARM_HOME}/mytest.conf").


FARM_NAME

	 The name for your farm (as entered in the configuration above). (e.g FARM_HOME="Caltech_OSG"). We would like to ask the users to use short names to describe the SITE on which they are running MonALISA.


JAVA_OPTS

	 An optional parameter to pass parameters directly to the Java Virtual Machine (e.g JAVA_OPTS="-Xmx=128m").



---+++site_env

	This file is used to configure the location for the local batch queuing system used by VO_Modules. To edit it:
<pre>
> cd $VDT_LOCATION/MonaLisa/Service/CMD
> vi site_env
</pre>
Here is an example:

<verbatim>
VDT_LOCATION=/usr/local/OSG-0.1.4
export VDT_LOCATION

. $VDT_LOCATION/setup.sh

GLOBUS_LOCATION=/usr/local/OSG-0.1.4/globus
export GLOBUS_LOCATION

CONDOR_LOCATION=/usr/local/OSG-0.1.4/condor
export CONDOR_LOCATION
</verbatim>

---+++vdtFarm.conf
  In this file are specified the modules which are used for monitoring. Here is a simple snapshot.  If the final line (*Tracepath...), is missing from yours, you'll need to add it in to have MonALISA use the Tracepath module.

<verbatim>
#
# Monitoring the Mater node
# The /proc files are used to collect data
#
*Master
>localhost
monProcLoad%30
monProcStat%30
monProcIO%30
#
# Get the monitoring information for the farm
# nodes using Ganglia.
# if the ganglia master demon is running on a
# different system that this one (where MonALISA
# is running) please change the "localhost"  with
# the appropriate system . If Ganglia demon is
# running on a different port that the default one
# please also change the port no.
#
*PN_vdt{monIGangliaTCP, localhost, 8649}%30

# the ABping module
*ABPing{monABPing, localhost, " "}
#
# the VO Jobs module
# these  modules require the VDT environment to run correctly
#
*VO_JOBS{monVoJobs,localhost}%300
#
# the VO io module
#
*VO_IO{monVOgsiftpIO, localhost, }%300
*Tracepath{monTracepath, localhost, " "}
</verbatim>

---++Start Monalisa 
Once you've completed the configuration, start the daemon manually:
<pre>
# /etc/init.d/MLD start 
</pre>
Go to [[http://monalisa.caltech.edu][MonALISA]], click on Repositories, then click on OSG-ITB and verify that your site is represented there. 

<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.RobGardner - 09 Mar 2005<br>
-- Main.IosifLegrand - 18 Mar 2005<br>
-- Main.AnneHeavey - 2 Jun 2005<br>
-- Main.JohnWeigand - 03 Jun 2005 - added [[VO_Modules Description]]  page to VO_Modules TOC<br>

%STOPINCLUDE%

