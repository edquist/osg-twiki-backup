%META:TOPICINFO{author="JohnWeigand" date="1158183068" format="1.1" reprev="1.4" version="1.4"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>OSG CE Shutdown Guide
%TOC%
%STARTINCLUDE%

---++CE Shutdown Guide
<div class="twikiSmall" style="text-align: left; font-style: italic;"><a href="%SCRIPTURLPATH%/edit%SCRIPTSUFFIX%/%WEB%/%TOPIC%">Edit this section</a></div>
---+++What processes need to be stopped?

The OSG starts up several daemons.  If you try to re-install/upgrade the OSG without shutting them down, it may fail.  Run the following commands to turn off the OSG services before upgrading (see sample shutdown session below):

<pre>
/etc/init.d/edg-gridmapfile-upgraded stop   <b><i>(if installed and activated)</i></b>
/etc/init.d/gris stop
/etc/init.d/globus-ws stop
/etc/init.d/mysql  stop
/etc/init.d/MLD stop or $VDT_LOCATION/MonaLisa/Services/CMD/MLD stop

/etc/init.d/condor stop   <b><i>(or other installed job manager)</i></b>

source $VDT_LOCATION/setup.sh
$VDT_LOCATION/MIS-CI/uninstall-misci.sh
</pre>

For the CRL update process:
<UL>
<LI> OSG 0.4.1 or prior, then:
<pre>/etc/init.d/edg-crl-upgraded stop </pre>
<LI> OSG 0.5.0 and beyond, this is a <i>root</i> cron process and you will need to turn it off by commenting it out or removing it:
<pre>
34 5 * * * /usr/local/osg-ce/fetch-crl/share/doc/fetch-crl-2.6.0/fetch-crl.cron
</pre>
</UL>

Bear in mind that !MonALISA also uses a database backend.  Here is how to find out whether [[MonALISA050][MonALISA]] is running, and if so, under what user:

=ps -efwww | grep -i monalisa=

and for the mysql or postgres daemons associated with !MonALISA, check using:

=ps -efwww | grep -i mysql=

or

=ps -efwww  | grep -i post[master,gres]=

If you are running a Rocks cluster, be sure to kill only the OSG-related mysql processes and avoid inadvertently stopping any cluster-related ones.  In general, pay attention if you need to kill any database-related processes explicitly; for example, look to make sure they are related to !MonALISA and/or are running out of your VDT installation area before stopping them.
a97 1
If you are shutting down in order to prepare for a new OSG install *in a different directory*, you should
remove the =/etc/init.d/MLD= link if it exists, as this will link to the =ML_SER= in your old =$VDT_LOCATION=.


Also check to see whether there are any stray OSG-related processes, such as run-mis-ci.sh, globus-job-manager, and so forth still running, and kill them manually if necessary.  

---+++If VOMS and/or GUMS is Running on Machine
This is not recommended.<br>
The process involves bringing down the tomcat servlet container, the included apache distribution, and mysql server.

<pre>
 # /etc/init.d/tomcat-5 stop
 # /etc/init.d/apache stop
 # /etc/init.d/mysql stop
</pre>


%STOPINCLUDE%
<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
-- Main.BurtHolzman - 30 Dec 2005
<!--Future editors should add their signatures beneath yours!-->
-- Main.NateMueller - 14 Apr 2005<br>
-- Main.AlanSill - 14 Apr 2005<br>
-- Main.JohnWeigand - 18 Jul 2005 - added gsiftp2 to procedures<br>
-- Main.AlanSill - 12 Dec 2005 - added web services shutdown and check<br>
-- Main.ChristopherBaumbauer - 08 Mar 2006 - Added steps to disable globus, shutdown globus-ws, web services running under tomcat, and redid the MonALISA shutdown instructions to go down cleaner<br>
-- Main.AlanSill - 22 Mar 2006 - Slight tweaks to above.<br>
-- Main.RobQ - 01 May 2006<br>
-- Main.JohnWeigand -  05 Oct 2006 - for OSG 0.5.1<br>

