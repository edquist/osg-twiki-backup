%META:TOPICINFO{author="StevenTimm" date="1143047090" format="1.0" version="1.202"}%
%META:TOPICPARENT{name="WebHome"}%
---+!!<nop>ITB CE 0.3.6 / OSG CE 0.4.1 Install Instructions
%TOC%
%STARTINCLUDE%

---++ Introduction

This document is intended for administrators responsible for installing and configuring:
<UL>
<LI>ITB Compute Element (CE) version 0.3.6 onto OSG Integration Resources
<LI>OSG Compute Element (CE) version 0.4.1 onto OSG Production Resources
</UL>
It is not meant as an all-inclusive guide to Grid computing or even all the options for configuring a CE. 
<!-- Instructions for installing a CE intended for the OSG version 0.2.1 Production grid can be found [[http://www.opensciencegrid.org/index.php?option=com_content&task=view&id=67&Itemid=65][here]]. 
-->

%INCLUDE{"OSGConventions"}%


---+++ Operating Systems
If you experience problems with the installation of VDT supported software or for general  system requirements,	the basic [[http://vdt.cs.wisc.edu/releases/1.3.10/requirements.html][VDT 1.3.10a System requirements page]] may be useful.  

%INCLUDE{"OSGInstallationMethod"}%


---++Known Problems

%RED% Ambiguity in instructions for Worker Node Client install. 
The Worker Node Client line item says that it must be installed.
But just below that, under "Choose an Installation Directory"
it says "This (the $VDT_LOCATION) must be exported to all the worker
nodes, otherwise additional installation of software on the worker 
nodes is required."  Need to resolve this ambiguity.  I propose
doing so by saying that Worker Node Client installation is 
required, and it can either be exported via NFS to the workers 
or installed on each one.  OSG CE directory doesn't need to be
nfs-exported to the workers under any circumstance.  S. Timm 3/16/06 %ENDCOLOR%
%RED% Table of contents is malformed, missing Configuring OSG Attributes,
Job Queuing System, Authorizing Users, S. Timm 3/16/06 %ENDCOLOR%

	* Add community support chat link room to Assistance during the installation.

---++ Assistance during the installation

If you have questions during the installation of this software the first line of support is your 
<a href="http://www.opensciencegrid.org/index.php?option=com_content&task=view&id=37&elMenu=Grid%20Support">VO Support Center</a>, as an alternative the
mailing list osg-general@opensciencegrid.org is available for you to submit
questions.  More information about the mailing lists is available at <a href="http://www.opensciencegrid.org/index.php?option=com_content&task=view&id=75&Itemid=88">OSG Mailing Lists</a>.

%INCLUDE{"CE_Software"}%
%INCLUDE{"CEPreInstallationChecklist"}%
%INCLUDE{"CESiteAdminGuide"}%

%INCLUDE{"PacmanInfo"}%


---++Installing the OSG Worker Node Client Package

This must be installed in a location visible to jobs executing on the worker node. Refer to the 
<a href="http://osg.ivdgl.org/twiki/bin/view/Integration/WorkerNodeClient">Worker Node Client Guide</a>  for additional information.

%INCLUDE{"CEInstallingServices"}%


%INCLUDE{"ManagedFork"}%

%INCLUDE{"CEConfigurePKI"}%

%INCLUDE{"ConfiguringGlobusJobs"}%

%INCLUDE{"ConfigureOSGAttributes"}%

-%INCLUDE{"CESimpleTest"}%


---++Monitoring Setup

---+++ Configure MIS-CI
The Monitoring and Information Services Core Infrastructure (MIS-CI) provides 
information on the site environment and computing resources. The OSG-CE package includes MIS-CI. 
This section describes how to configure MIS-CI if you wish to enable it.

The $VDT_LOCATION/MIS-CI/configure-misci.sh script performs the configuration. It
creates or adds a crontab for the MIS-CI information collectors. The Unix account for the MIS-CI scripts should be <b>mis</b>. By default, the script assumes the !GridCat DN is mapped to the ivdgl user.  You will need to use the <b>--choose_user</b> option to change to <b>mis</b>.
<pre>
	$  cd $VDT_LOCATION
	$  SOURCE  ./setup.sh
	$  $VDT_LOCATION/MIS-CI/configure-misci.sh --choose_user
		 Editing site configuration...
		 Creating MIS-CI.db
			  :
			<i>( a lot of information on the tables it is creating will appear before any questions are asked)</i>
				:
		 Would you like to set up MIS-CI cron now? (y/n) <b>y</b>
		 At what frequency (in minutes) would you like to run MIS-CI ? [10] <b>10</b>
		 Under which account the cron should run ? [ivdgl] <b>mis</b>
		 Frequency 10
		 User mis
		 Would you like to create MIS-CI crontab  ? (y/n) <b>y</b>
		 Updating crontab
		 Configuring MIS jobmanager
		 /storage/local/data1/osg/MIS-CI/share/misci/globus/jobmanager-mis is created

		 Your site configuration :
		 sitename ITB_INSTALL_TEST
		 dollarapp /storage/local/data1/osg/OSG.DIRS/app
		 dollardat /storage/local/data1/osg/OSG.DIRS/data
		 dollartmp /storage/local/data1/osg/OSG.DIRS/data
		 dollarwnt /storage/local/data1/osg/OSG.DIRS/wn_tmp
		 dollargrd /storage/local/data1/osg
		 batcheS condor
		 vouserS uscms01 ivdgl sdss usatlas1 cdf grase fmri gadu
		 End of your site configuration


		If you would like to add more vo users,
		you should edit /storage/local/data1/osg/MIS-CI/etc/misci/mis-ci-site-info.cfg.
		You have additional batch managers :  condor .
		If you would like to add these,
		you should edit /storage/local/data1/osg/MIS-CI/etc/misci/mis-ci-site-info.cfg.

		configure--misci Done
		Please read /storage/local/data1/osg/MIS-CI/README
</pre>


MIS-CI is collecting information using crontab as the user mis (or ivdgl if you left it as the default). Therefore, in order to stop
MIS-CI processes, crontab should be removed. The script $VDT_LOCATION/MIS-CI/uninstall-misci.sh
is provided for this purpose:
<pre>
		&gt;  cd $VDT_LOCATION
		&gt;  source setup.(c)sh
		&gt;  cd MIS-CI
		&gt;  ./uninstall-misci.sh
</pre>

After finishing configuring the MIS-CI, a few checks might be necessary:
<OL>
<LI> Verify the crontab was created for the <i>mis</i> user.
 <pre>
		&gt;  crontab -u mis -l
</pre>
<LI> If you want to force an MIS-CI table update (due to fresh install or update), then as the MIS-CI user (<i>mis</i>), execute:
<pre>
	&gt;  $VDT_LOCATION/MIS-CI/sbin/run-mis-ci.sh
</pre>
<LI>  As a non-root user, verify that at least one table is filled.<br>
			  <b>If you chose not to force an update, it might take 10 minutes or so before the tables are filled with current information.</b>
<pre>
	 &gt;	source $VDT_LOCATION/.setup.(c)sh
	 &gt;	grid-proxy-init
	  <i>(enter your password)</i>
	 &gt;  globus-job-run &lt;hostname&gt;/jobmanager-mis /bin/sh siteinfo
	  <i> (Here &lt;hostname&gt; is the CE hostname.)</i>
	 <i>...... sample output ....
		 id							  1 
		ymdt							Wed Jan 11 19:00:01 UTC 2006 
		sitename					  ITB_INSTALL_TEST 
		hostname					  localhost 
		VOname						 local:100 
		appdir						 /storage/local/data1/osg/OSG.DIRS/app 
		datadir						/storage/local/data1/osg/OSG.DIRS/data 
		tmpdir						 /storage/local/data1/osg/OSG.DIRS/data 
		wntmpdir					  /storage/local/data1/osg/OSG.DIRS/wn_tmp 
		grid3dir					  /storage/local/data1/osg 
		jobcon						  condor 
		utilcon						fork 
		locpname1					  
		locpname2					  
		ncpurunning				  0 
		ncpus						  4 </i>
</pre>
</OL>


---+++ Configure MDS (GRIS)

The Globus information system is called MDS and is pre-configured to read the osg-attributes.conf information file.	

The configuration script (<i>VDT_LOCATION/vdt/setup/configure_mds</i>) is executed automatically during the initial download with default values.

To test the GRIS:
<UL>
<LI>first you need an <a href="#Get_an_LDAP_service_certificate">LDAP service certificate</a> installed in /etc/grid-security/ldap. Both the directory and certificate files should be owned by the user daemon.
<pre>&gt;  chown -R daemon /etc/grid-security/ldap</pre>

<LI>One may (optionally) start the Globus information service daemon (GRIS) with the following command (as root):
<pre>&gt; /etc/init.d/gris start</pre> 

<LI>MDS should be configured for anonymous bind.  This  sends a test query to your local host and does no authentication on the user submitting the request .  Verify you have no proxy certificate (/tmp/x509u_(your_PID)).  If one exists,  remove it first.
<pre>
&gt;  grid-info-search -anonymous
<i>... your screen should scroll for a while showing a lot of data... 
....you can redirect the output to validate</i>
</pre>

<LI>Then, using <u>your</u> user account, create a grid proxy and run the grid-info-search request again with the following security-enabled query to output the details of all objects on the GRIS:
<pre>
&gt; source $VDT_LOCATION/setup.(c)sh
&gt; grid-proxy-init
&gt;  grid-info-search -b "mds-vo-name=local, o=grid"
<i>... your screen should scroll for a while showing a lot of data... 
....you can redirect the output to validate</i>
</pre>
</UL>



---++Activate Your Site
The !GridCat system maintains status and other information on all OSG sites as can be viewed 
<a href="http://osg-cat.grid.iu.edu/">here</a>. 

Sites added to !GridCat are presumed to be inactive if a site state bit is not set to be 1 (see below).
<UL>
<LI><b>Inactive</b> sites will have the site status dot with the grey color. 
<LI> Once the site becomes <b>active</b>, the site status dot will become either green or red, depending on the 
<a href="http://osg-cat.grid.iu.edu/">GridCat</a>.
test results.
</UL>
Since the default site state is presumed to be inactive, the CE site administrator  has to pro-actively switch the site state to be active. The activation is done by modifying the file <i>$VDT_LOCATION/MIS-CI/etc/grid-site-state-info</i>. and setting the value to 1 for the variable below:
<pre>
export grid_site_state_bit =  1
</pre>

<b>NOTE: It might take up to 2 hours for registered sites to take effect in the !GridCat display. If your site is not registered with the OSG-GOC see the instructions in the 
<a href="#OSG_Registration">OSG Registration section</a> of this document. Until your site is registered, it will not appear in 
<a href="http://osg-cat.grid.iu.edu/">GridCat</a></b>

If your site decides to become inactive for various reasons, e.g., site maintenance, the site administrator  should set the value of <i>grid_site_state_bit</i> to be other than 1. 

Example <a href="http://www.ivdgl.org/MIS-CI/grid-site-state-info">grid-site-state-info</a> file.



---++ Optional Components
---+++ MonALISA
To configure this optional component, see the 
<a href="http://osg.ivdgl.org/twiki/bin/view/Integration/MonALISA">
MonALISA</a> document in this guide.

<!--  Discovery Service  To configure this optional component, see the  <a href="http://osg.ivdgl.org/twiki/bin/view/Integration/DiscoveryServiceInstallation"> Discovery Service MDS)</a> document in this guide. -->

---+++ Generic Information Providers (GIP)
To configure this optional component, see the 
<a href="http://osg.ivdgl.org/twiki/bin/view/Integration/GenericInformationProviders">
Generic Information Providers</a> document in this guide.


---++ Site Verification
---+++site-verify
Now you're ready to run the full CE site verification test suite. All elements of this test should now pass.

Note: To run the site verify script you should not be <b>root</b> .
<pre>
&gt;	cd $VDT_LOCATION
&gt;	source ./setup.sh
&gt;	grid-proxy-init 
	  <i>....enter your passphrase</i>
&gt;	cd verify
&gt;	./site_verify.pl 
</pre>
The results will indicate the various tests that are performed with results indicating  FAILED, UNTESTED,  NOT WORKING,  NONE or  NO. conditions.

---++ Authorizing Users: Operational Configuration
The earlier test case only authorized yourself as a local user.  You should now go to 
<a href="http://osg.ivdgl.org/twiki/bin/view/Integration/OsgCEAuthorization">
Osg CE Authorization</a> document and authorize other users before performing the
<a href="#OSG Registration">OSG Registration</a> of your service (otherwise no one but you will be able to access it!).

---++ OSG Registration

To register the site with the OSG Grid Operations Center and into the Grid Catalog please use the [[http://www.opensciencegrid.org/index.php?option=com_wrapper&Itemid=68&elMenu=Grid%20Support][webform]] located under the OSG [[http://www.opensciencegrid.org/index.php?option=com_content&task=view&id=47&Itemid=65][Administrator Support page]]. If you are registering into the OSG, be sure to check the appropriate box for which grid catalog you are registering with. You should receive an email response automatically back from the GOC to the operations contact you supplied. If this response doesn't arrive within a reasonable delay, please resubmit your registration.

A minimal amount of information is needed for the OSG Grid Operations Center (GOC) to publish a site to the monitoring and operational infrastructure. This includes organization name, organization manager or designated representative name and email, security contact name and email, resource URL, support center, and form submitter. 

While this minimal information will allow the GOC to publish your information to the monitoring tools, more information is requested to make site and support center communication easier. Please take time to fill out the form completely.


%INCLUDE{"CEFirewalls"}%

---++Troubleshooting Guide
As you install, monitor the $VDT_LOCATION/vdt-install.log.  

	* If pacman tries to retrieve something from a website that's having problems, you'll get an error message that's unrelated to the real problem because pacman can't recognize 404 errors when downloading tarballs.  For example, when the PRIMA download site was down, it told us the file wasn't in the correct format:
<pre>
vdt-untar is untarring prima-0.3.x86_rh_9.tar.gz
gzip: stdin: not in gzip format 
</pre>
---++Shutdown Guide
Please see the <a href="http://osg.ivdgl.org/twiki/bin/view/Integration/OSGShutdownGuide">
OSG Shutdown Guide</a>.


<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->

%STOPINCLUDE%



-- Main.RobQ - 06 Dec 2005<br>
-- Main.JohnWeigand - 05 Jan 2006<br>
-- Main.JohnWeigand - 12 Jan 2006<br>

%META:TOPICMOVED{by="DaneSkow" date="1115753408" from="Integration.OSGCoreInstallGuide" to="Integration.OSGCEInstallGuide"}%
