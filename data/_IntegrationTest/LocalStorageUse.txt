%META:TOPICINFO{author="StevenTimm" date="1142979796" format="1.0" version="1.10"}%
%META:TOPICPARENT{name="LocalStorageRequirements"}%
<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>%TOPIC%
%TOC%
%STARTINCLUDE%


---++Introduction

This document provides some very basic descriptions of the local storage paths on a CE and how to use them.

---++Known Problems

---++Possibilities

A definition of the concepts used in this document can be found in LocalStorageRequirements, including a [[LocalStorageRequirements#Minimum_requirements][section]] describing minimal requirements and some sample configurations.

You will always be provided a =$OSG_WN_TMP= area where you will put your current working directory (possibly in a unique subdirectory to avoid conflicts with other jobs running on the same host). 

The path and URL of CE storage is provided in different ways:

---+++Environment Variables

Environment variables contain much of the necessary path information and are automatically propagated into
the worker node environment of a freshly-created job.  The
variables are found in =$VDT_LOCATION/monitoring/osg-attributes.conf=.
An excerpt is provided below from FNAL_GPFARM_TEST. 
See the OSGCEInstallGuide and LocalStorageConfiguration for more information.
Note that the SE used in the example, fndca.fnal.gov, doesn't support
all VO's at the moment.

<verbatim>
OSG_SITE_NAME="FNAL_TEST_033"
OSG_LOCATION="/export/osg/grid"
OSG_GRID="/usr/local/osg"
OSG_APP="/app"
OSG_DATA="/data"
OSG_SITE_READ="dcap://fndca.fnal.gov:24525//pnfs/fnal.gov/usr"
OSG_SITE_WRITE="srmcp://fndca.fnal.gov:8443/"
OSG_WN_TMP="$_CONDOR_SCRATCH_DIR"
OSG_DEFAULT_SE="UNAVAILABLE"
OSG_SITE_INFO="http://fermigrid.fnal.gov/gpfarm/FNAL_GPFARM_POLICY.html"
</verbatim>

Here is output from a test run of a job with the scripts configured correctly:
<verbatim>
[timm@fnpcg ~]$ globus-job-run fnpcg/jobmanager-fork /usr/bin/printenv
OSG_DATA=/data
hostname=fnpcg.fnal.gov
GRID3_TMP_WN_DIR=/local/stage1
OSG_LOCATION=/export/osg/grid
OSG_JOB_CONTACT=fnpcg.fnal.gov/jobmanager-condor
GRID3_SITE_NAME=FNAL_GPFARM_TEST
OSG_SITE_INFO=http://fermigrid.fnal.gov/gpfarm/FNAL_GPFARM_POLICY.html
GRID3_DATA_DIR=/data
OSG_DEFAULT_SE=UNAVAILABLE
OSG_GRID=/usr/local/grid
LOGNAME=fnalgrid
OSG_SITE_NAME=FNAL_GPFARM_TEST
GRID3_JOB_CONTACT=fnpcg.fnal.gov/jobmanager-condor
GRID3_USER_VO_MAP=/export/osg/grid/monitoring/grid3-user-vo-map.txt
OSG_USER_VO_MAP=/export/osg/grid/monitoring/grid3-user-vo-map.txt
OSG_WN_TMP=/local/stage1
GRID3_GRIDFTP_LOG=/export/osg/grid/globus/var/gridftp.log
OSG_UTIL_CONTACT=fnpcg.fnal.gov/jobmanager
OSG_SITE_READ=dcap://fndca.fnal.gov:24525//pnfs/usr
GRID3_SITE_INFO=http://fermigrid.fnal.gov/gpfarm/FNAL_GPFARM_POLICY.html
HOME=/home/fnalgrid
LD_LIBRARY_PATH=/export/osg/grid/MonaLisa/Service/VDTFarm/pgsql/lib:/export/osg/grid/voms/lib:/export/osg/grid/prima/lib:/export/osg/grid/expat/lib:/export/osg/grid/globus/lib:/export/osg/grid/expat/lib:/export/osg/grid/MonaLisa/Service/VDTFarm/pgsql/lib:/export/osg/grid/voms/lib:/export/osg/grid/prima/lib:/export/osg/grid/expat/lib:/export/osg/grid/MonaLisa/Service/VDTFarm/pgsql/lib:/export/osg/grid/voms/lib:/export/osg/grid/prima/lib:/export/osg/grid/expat/lib:
GRID3_TMP_DIR=/data
OSG_GRIDFTP_LOG=/export/osg/grid/globus/var/gridftp.log
OSG_APP=/app
GRID3_BASE_DIR=/export/osg/grid
GLOBUS_GRAM_JOB_CONTACT=https://fnpcg.fnal.gov:51487/10121/1134169575/
GLOBUS_LOCATION=/export/osg/grid/globus
OSG_SPONSOR=fermilab
GLOBUS_GRAM_MYJOB_CONTACT=URLx-nexus://fnpcg.fnal.gov:51488/
OSG_SITE_WRITE=srm://fndca.fnal.gov:8443/
GRID3_APP_DIR=/app
GRID3_SPONSOR=fermilab
GRID3_UTIL_CONTACT=fnpcg.fnal.gov/jobmanager
X509_USER_PROXY=/home/fnalgrid/.globus/job/fnpcg.fnal.gov/10121.1134169575/x509_up
</verbatim>

---+++Information Providers (GIP/BDII) 

		Path or URLs consistent across the CE (headnodes and WN), published using an information system (e.g. GIP and BDII).  
!GlueCEInfoApplicationDir (corresponding to =$OSG_APP=) and !GlueCEInfoDataDir (corresponding to =$OSG_DATA=).  The Worker node client directory,
(corresponding to =$OSG_GRID=), is published with !GlueLocationLocalID=OSG_GRID, !GlueLocationName=OSG_GRID, and !GlueLocationPath=
the path to the directory.  Similarly, OSG_SITE_READ and OSG_SITE_WRITE
are published with !GlueLocationLocalID's of that name.

The GLUE schema allows to configure different paths for SITE_READ and
SITE_WRITE and DEFAULT_SE for each VO if you want but some manual
editing of the schema file is required to do this.  See the section
on Generic Information Providers configuration.

To select these attributes out of the GLUE schema using ldapsearch, 
the following syntax works to get all !GlueLocationLocalID, of 
which there are several.

<pre>
timm@fngp-osg ~]$ ldapsearch -x -h fngp-osg.fnal.gov -p 2135 -b GlueClusterUniqueId=fngp-osg.fnal.gov,mds-vo-name=local,o=grid GlueLocationLocalID
version: 2

#
# filter: (objectclass=*)
# requesting: GlueLocationLocalID
#

# fngp-osg.fnal.gov, local, grid
dn: GlueClusterUniqueID=fngp-osg.fnal.gov, mds-vo-name=local,o=grid

# fngp-osg.fnal.gov, fngp-osg.fnal.gov, local, grid
dn: GlueSubClusterUniqueID=fngp-osg.fnal.gov, GlueClusterUniqueID=fngp-osg.fna
 l.gov, mds-vo-name=local,o=grid

# OSG_SITE_READ, fngp-osg.fnal.gov, fngp-osg.fnal.gov, local, grid
dn: GlueLocationLocalID=OSG_SITE_READ, GlueSubClusterUniqueID=fngp-osg.fnal.go
 v, GlueClusterUniqueID=fngp-osg.fnal.gov, mds-vo-name=local,o=grid
GlueLocationLocalID: OSG_SITE_READ

# OSG_SITE_WRITE, fngp-osg.fnal.gov, fngp-osg.fnal.gov, local, grid
dn: GlueLocationLocalID=OSG_SITE_WRITE, GlueSubClusterUniqueID=fngp-osg.fnal.g
 ov, GlueClusterUniqueID=fngp-osg.fnal.gov, mds-vo-name=local,o=grid
GlueLocationLocalID: OSG_SITE_WRITE

# OSG_GRID, fngp-osg.fnal.gov, fngp-osg.fnal.gov, local, grid
dn: GlueLocationLocalID=OSG_GRID, GlueSubClusterUniqueID=fngp-osg.fnal.gov, Gl
 ueClusterUniqueID=fngp-osg.fnal.gov, mds-vo-name=local,o=grid
GlueLocationLocalID: OSG_GRID

# search result
search: 2
result: 0 Success

# numResponses: 6
# numEntries: 5

</pre>


---++Examples
There is a PERL script below which can be used to query either the 
GRIS or the BDII, to get the OSG_GRID area.

%STOPINCLUDE%
	* [[%ATTACHURL%/bdii_query.pl.txt][bdii_query.pl.txt]]: Sample Perl script to query the bdii and/or the GRIS

%META:FILEATTACHMENT{name="bdii_query.pl.txt" attr="" comment="Sample Perl script to query the bdii and/or the GRIS" date="1142980263" path="bdii_query.pl" size="1554" user="StevenTimm" version="1.1"}%
