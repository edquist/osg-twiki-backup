%META:TOPICINFO{author="KyleGross" date="1225985974" format="1.1" version="1.5"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>Simple Test of the CE Node
%TOC%
%STARTINCLUDE%

---++ Simple Test of the CE Node (using local grid mapfile)
<div class="twikiSmall" style="text-align: left; font-style: italic;"><a href="%SCRIPTURLPATH%/edit%SCRIPTSUFFIX%/%WEB%/%TOPIC%?t=%SERVERTIME{ "$epoch" }%">Edit this section</a></div>

The first step is to configure the CE to allow access using your own Grid credentials. An FAQ on obtaining a personal certificate can be found [[CertScripts050#FAQ][here]]. Once that's done you'll be able to run local tests and verify operation of your CE locally.

Make sure you have a grid proxy for yourself. (this is based on your certificate):
<pre>
   &gt; source VDT_LOCATION/setup.(c)sh
   &gt; grid-proxy-init
    (you will be prompted for your GRID pass phrase)
 </pre>
   
Then, to get the subject (DN) of your proxy, run: 
<pre>
   &gt;  grid-proxy-info -subject
Output....
   /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Dane Skow/UID=dane
</pre>

Take the subject string and pre-pend it to the /etc/grid-security/grid-mapfile and assign it to a local user account (you can use any of the VirtualOrganizations/VOInfo accounts you've created at the beginning to test). So the grid-mapfile should have at least one entry like:
<pre>
 > cat /etc/grid-security/grid-mapfile
"/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Dane Skow/UID=dane" usatlas1
</pre>

This is enough to enable the rest of the installation testing.

---+++ Simple Test of Fork Queue
Using the grid proxy you just created, you can test the Globus gatekeeper fork queue by executing:
<pre>
     &gt;  globus-job-run $(hostname):2119/jobmanager-fork  /usr/bin/id 
Output....
     uid=9872(usatlas1) gid=9872(usatlas1) groups=9872(usatlas1)
</pre>
You should see the UNIX user account assigned  based on the <i>gridmap-file</i> you created previously..

You can also view the <i>$VDT_LOCATION/globus/var/globus-gatekeeper.log</i> file to see the authorization messages:
<pre>
  TIME: Sun Jan  8 23:12:43 2006
   PID: 29703 -- Notice: 6: Got connection 131.225.207.100 at Sun Jan  8 23:12:43 2006
  TIME: Sun Jan  8 23:12:43 2006
   PID: 29703 -- Notice: 5: Authenticated globus user:    <b>/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Dane Skow/UID=dane</b>
  TIME: Sun Jan  8 23:12:43 2006
   PID: 29703 -- Notice: 0: GRID_SECURITY_HTTP_BODY_FD=7
  TIME: Sun Jan  8 23:12:43 2006
   PID: 29703 -- Notice: 5: <b>Requested service: jobmanager-fork</b>
  TIME: Sun Jan  8 23:12:43 2006
   PID: 29703 -- Notice: 5: <b>Authorized as local user: usatlas1</b>
  TIME: Sun Jan  8 23:12:43 2006
   PID: 29703 -- Notice: 5: <b>Authorized as local uid: 9872</b>
  TIME: Sun Jan  8 23:12:43 2006
   PID: 29703 -- Notice: 5:           <b>and local gid: 9872</b>
  TIME: Sun Jan  8 23:12:43 2006
   PID: 29703 -- Notice: 0: executing /storage/local/data1/osg/globus/libexec/globus-job-manager
  TIME: Sun Jan  8 23:12:43 2006
   PID: 29703 -- Notice: 0: GATEKEEPER_JM_ID 2006-01-08.23:12:43.0000029703.0000000000 for /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Dane Skow/UID=dane on 131.225.207.100
  TIME: Sun Jan  8 23:12:43 2006
   PID: 29703 -- Notice: 0: GRID_SECURITY_CONTEXT_FD=10
  TIME: Sun Jan  8 23:12:43 2006
   PID: 29703 -- Notice: 0: Child 29808 started
</pre>

---+++ Simple Test Of The  Job Manager Queue
Now you can test the Globus gatekeeper job submissions for the job manager queue you are using. The example below is for the Condor job manager.
<pre>
     &gt;  globus-job-run $(hostname):2119/jobmanager-condor /usr/bin/id 
Output....
     uid=9872(usatlas1) gid=9872(usatlas1) groups=9872(usatlas1)
</pre>
You should see the same results as with the fork queue submission.

The <i>globus-gatekeeper.log</i> file will look identical except for the "Request service" message:
<pre>
   PID: 29703 -- Notice: 5: Requested service: jobmanager-condor
</pre>

---+++ Simple Test Of GSIFTP Services

A simple test of the gsiftp services requires creating a simple file and then copying it from one location on your machine to
the default storage element available for your CE. When you configured your OSG attributes 
([[CEInstallGuide050#Configuring_the_OSG_Attributes][Configuring the OSG Attributes]] section of this document),  
you defined a default SE as a shared storage space with read-write access for all users. We will use this as the destination directory for the file we are copying.

Create a temporary file to be copied:
<pre>
   $ echo "My test gsiftp file" > /tmp/gsiftp.test
</pre>
Copy the file to the $OSG_DATA directory:
<pre>
     &gt; source $VDT_LOCATION/monitoring/osg-attributes.conf    <i>(This is simply to get the OSG_DATA variable)</i>
     $ globus-url-copy file:/tmp/gsiftp.test gsiftp://$(hostname)${OSG_DATA}/gsiftp.test
</pre>
Verify the file was copied to the $OSG_DATA directory:
<pre>
    &gt; ls -l  $OSG_DATA/gsiftp.test
    -rw-r--r--  1 usatlas1 usatlas1  20 Jan  9 13:29 /storage/local/data1/osg/OSG.DIRS/data/gsiftp.test
</pre>
To verify the accounting information was captured, you can view the <i>$VDT_LOCATION/globus/var/log/gridftp.log</i> for the ftp copy operation you just performed.  You should see an entry similar to this for the transfer statistics collected by various systems like !MonALISA and ACDC::
<pre>
   <b>DATE=20060110211714.329666</b> HOST=cmssrv09.fnal.gov PROG=globus-gridftp-server NL.EVNT=FTP_INFO START=20060110211714.247555 <b>USER=ivdgl </b>FILE=/tmp/gridcat-gsiftp-test.gridcat.21602.remote BUFFER=0 BLOCK=262144 <b>NBYTES=28 </b>VOLUME=/ STREAMS=1 STRIPES=1 DEST=[129.79.4.64] TYPE=RETR CODE=226
</pre>
The authorization and other informational messages are captured in the <i>$VDT_LOCATION/globus/var/log/gridftp-auth.log</i>:
<pre>
   [2834] Tue Jan 10 15:21:37 2006 :: Server started in inetd mode.
   [2834] Tue Jan 10 15:21:37 2006 :: Configuration read from /storage/local/data1/osg/globus/etc/gridftp.conf
   [2834] Tue Jan 10 15:21:37 2006 :: New connection from: cmssrv09.fnal.gov:38376
   [2834] Tue Jan 10 15:21:38 2006 :: <b>User uscms112 successfully authorized</b>
   [2834] Tue Jan 10 15:21:38 2006 :: Starting to transfer "/storage/local/data1/osg/OSG.DIRS/app/weigand.jgw.sh.2707".
   [2834] Tue Jan 10 15:21:38 2006 :: Finished transferring "/storage/local/data1/osg/OSG.DIRS/app/weigand.jgw.sh.2707".
   [2834] Tue Jan 10 15:21:38 2006 :: Closed connection from cmssrv09.fnal.gov:38376
</pre>





<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

%STOPINCLUDE%


-- Main.RobQ - 01 May 2006
