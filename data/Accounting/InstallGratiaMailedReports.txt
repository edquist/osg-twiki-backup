%META:TOPICINFO{author="KarthikArun" date="1301429124" format="1.1" reprev="1.8" version="1.8"}%
-- Main.KarthikArun - 12 Jan 2011
%TOC%

---+++ Installation of mailed gratia accounting summary reports

The gratia central reports are being run at Fermilab and then emailed to the subscribers of the report. You could get more details about these reports and how to receive them at <a href=https://twiki.grid.iu.edu/bin/view/Accounting/ReportsDescription>mailed reports</a>. But if you want to run these reports locally on your own terms, then you could download and install the scripts that generate and email these reports. Instructions for the download and the configuration of the gratia summary reports as described below.

<ul>
<li>Create a directory in which you want to install/store the reporting related files.
<pre>
mkdir gratiaReports
cd gratiaReports
</pre>
Note: You could replace "gratiaReports" by any other name of your choice!
<li>Download to the gratiaReports directory, the <a href=http://gratia.svn.sf.net/viewvc/gratia/trunk/reporting/summary/?view=tar>tar file</a> containing the scripts/software for the mailed summary reports. 
<li>Untar the file: <pre>tar -zxvf gratiaReports.tar.gz</pre>
<li>Copy the configuration template file to the one that will be used by the gratia reports (gratiareports.conf is the default conig file. You could also use another file that could be specified using the --config option while running the reporting scipts): <pre>cp gratiareports.conf.template gratiareports.conf</pre>
<li>Please make sure to edit <b>gratiareports.conf</b> and fill in appropriate values. This determines the configuration of the python based reports. Please follow the instructions provided in gratiareports.conf.</li>
<li>Please make sure to edit <b>user-reports.dat</b> and fill/replace the appropriate values for the VO, Sites and Users who should receive the perl based site and VO metrics report. 
<li>Run the report configure script. This will verify the contens of the python config file (gratiareports.conf) and setup the cronjob for the mailed reports if setup so in the config file. It is assumed that the user running this script has the appropriate permissions to setup the cronjob. Please note that the configure script won't verify/validate the contents of the perl data file namely user-reports.dat. But this file still needs to be edited. 
<pre>
python configReport.py
# If you expect cronjob to be set, verify if that was the case by doing "crontab -l". 
# It should like the cron jobs in addition to whatever you already had in the crontab. 
</pre>

---+++ Examples of running summary reports
<li>Some examples of how to run the mailed gratia summary reports are given below. Please note that the default options for running the reports are fetched from the configuration file (gratiareports.conf by default). These options could be overridden by or merged with the command line options given directly when the script is invoked from command line. 
<pre>
cd &lt Directory where gratia reports have been installed&gt

sh daily_mutt.sh 
# (options in config file (gratiareports.conf by default) will be used)

sh daily_mutt.sh --mail myEmail@myDomain.edu 
# (this email will override the default choice from the config file)

sh daily_mutt.sh --production 
# (this report will be emailed to production email
# set in the config file and if not assigned in the script). 

sh daily_mutt.sh 2010/10/10
# This report will fetch the data for the date of Oct 10th 2010

</pre>
You could substitute daily_mutt.sh by range_mutt.sh in the above examples. 

<b>Examples of running perl reports:</b>

<li>OSG site metrics
<pre>
perl all-sites-oim --exclusive-mail site-admin@mysite.edu --site-name OU_OCHEP_SWT2
</pre>
        - would send reports about OU_OCHEP_SWT2 to site-admin@mysite.edu 
        
<pre>
perl all-sites-oim -m site-admin@mysite.edu  --site-name OU_OCHEP_SWT2</pre>
        - same as above

<pre>
perl all-sites-oim -m site-admin@mysite.edu  -m rajkwrites@yahoo.com -s OU_OCHEP_SWT2 -s OUHEP_OSG</pre>
        - would send reports about OU_OCHEP_SWT2 and OUHEP_OSG to site-admin@mysite.edu  and rajkwrites@yahoo.com
        
<pre>
perl all-sites-oim -m site-admin@mysite.edu </pre>
        - would send reports about all sites to site-admin@mysite.edu 
        
<pre>perl all-sites-oim --production</pre>
        - would send reports about all sites to the appropriate site admins

<pre>perl all-sites-oim --production -D user-reports.dat</pre>
        - Extract site reports for sites contained in user-reports.dat and email them to the recipients contained in user-reports.dat. 

<li> OSG VO metrics
<pre>perl all-vos-oim --production -D user-reports.dat</pre>
          - Run VO reports on VOs contained in user-reports.dat and mail them to the recipients contained in user-reports.dat

<b>For detailed help on how to run the reports do the following</b>
<pre>perl all-sites-oim --help
perl all-vos-oim --help</pre>

</ul>

