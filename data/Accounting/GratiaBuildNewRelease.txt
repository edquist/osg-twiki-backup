%META:TOPICINFO{author="JohnWeigand" date="1221839371" format="1.1" reprev="1.4" version="1.4"}%
---+ Gratia - Building a New Release For Distribution

<!--
   * Set RELEASE_TAR_REPOSITORY = /afs/fnal.gov/files/expwww/gratia/html/Files/.      
   * Set RELEASE_DATE = 5/14/08      
   * Set CURRENT_RELEASE = v0.38.3
   * Set RELEASE_TAG = v0-38-3
   * Set NEXT_DEVEL_VERSION = v0.39
   * Set BUILD_DIRECTORY = /home/gratia/gratia-releases/gratia-%CURRENT_RELEASE%      
   * Set GRATIA_RELEASES = /home/gratia/gratia-releases      
   * Set VIEWTHISTOPIC = <div class="twikiSmall"><a href="%TOPIC%">View this section</a></div> 
 -->

%TOC%

%STARTINCLUDE%

---+ Building a new release for distribution

%VIEWTHISTOPIC%

This section describes the steps for building a release of Gratia tomcat services for distribution.
---++ Verify and update Gratia for the new release

*As yourself*, make sure your build area contains all _committed_ changes:
   * cd [PATH_TO_GRATIA]/gratia 
   * cvs update 

*As yourself*, in _gratia/build-scripts/Makefile_ , change the _version_default_ to:
   * version_default = %NEXT_DEVEL_VERSION% 
   * commit the change 

---++ Tag and build the new release

*As yourself*, tag the release. This tags everything that is in your build directory and presumably tested:
   * cd [PATH_TO_GRATIA] 
   * cvs tag -R %RELEASE_TAG% gratia 

*As gratia user*, build it for the release (this insures that tar files are produced for VDT):
   * export CVSROOT=":pserver:anonymous@gratia.cvs.sourceforge.net:2401/cvsroot/gratia"
   * cd /home/gratia/gratia-releases 
   * cvs export -d gratia-%CURRENT_RELEASE% -r %RELEASE_TAG% gratia 
   * cd gratia-%CURRENT_RELEASE%/build-scripts 
   * source setup-jdk15.sh 
   * make release 

*As gratia user*, copy the tarballs for this release to a 'save' area:
   * cd /home/gratia/gratia-releases/gratia-%CURRENT_RELEASE%/target
   * cp -p gratia_reporting_%CURRENT_RELEASE%.tar   /home/gratia/gratia-releases/tarballs/.
   * cp -p gratia_services_%CURRENT_RELEASE%.tar   /home/gratia/gratia-releases/tarballs/.

---++ Make the new release available for inclusion in the VDT

*As yourself*, copy the built tar files to the VDT release area:
   * cd /home/gratia/gratia-releases/gratia-%CURRENT_RELEASE%/target 
   * scp gratia_reporting_%CURRENT_RELEASE%.tar flxi07.fnal.gov:%RELEASE_TAR_REPOSITORY% 
   * scp gratia_services_%CURRENT_RELEASE%.tar flxi07.fnal.gov:%RELEASE_TAR_REPOSITORY% 

*As yourself*,update the version number on the [[InstallationGuideVDT][services release TWiki page]]:
   * Edit and update the TWiki variable _ReleaseVersion_. 

*As yourself*, create a VDT support ticket via email so it gets prioritized with the VDT team:
   * Example: 

<table width="451" height="77" border="0"> <tbody><tr><td>To: </td><td>vdt-support@opensciencegrid.org <br /> </td></tr><tr><td> Reply-to:</td><td>gratia-operation@fnal.gov</td></tr><tr><td> Subject</td><td>Gratia %CURRENT_RELEASE% available for inclusion in next VDT release</td></tr><tr><td> Content:</td><td> </td></tr></tbody> </table>

%STOPINCLUDE%

-- Main.JohnWeigand - 18 Jul 2008

%META:TOPICMOVED{by="JohnWeigand" date="1216404989" from="Accounting.GratiaReleaseBuild" to="Accounting.GratiaBuildNewRelease"}%
