%META:TOPICINFO{author="PhilippeCanal" date="1204302204" format="1.1" version="1.5"}%
%META:TOPICPARENT{name="WebHome"}%
---+ Database Backups

---++ Stragegy

To backup and restore the MySQL database when using Innodb we have 3 possible levels depending on the uptime and recovery time requirement.

---+++ Simpliest

The database are backed up locally using mysqldump.  To simplify the backup maintenance scheduling and recovery are done via Zamanda

---+++ Higher availability.

The database is replicated to a secondary node.  The replicated database is backed up via mysql dump which can be used to recover both
the main and replicated database.

---+++ Lowest recovery time.

The database is replicated to a secondary node.  The replicated database is backed up by shutting down the DB server and doing a cold
copy of the file system.

---+++ Recovery

---++++Simple reload of one of the schema:

<pre>mysql-zrm --verbose --action restore --backup-set gratia_qcd --source-directory /test/zrm/gratia_qcd/_last_directory_ --tmpdir=/test/tmp</pre>

where /test/tmp has enough space to hold a copy of the backup files.

---++++Full reload of the database

   1 


---++ Performance

ITB Innodb schema with 3.3 millions rows (7G) on disk, backup in 13 minutes.  Resulting file is also 7G.

---++ Zamanda cheat-sheet

See Documentation at http://mysqlbackup.zmanda.com/

Location of configuration files: /etc/mysql_zrm

Performance info: mysql-zrm-reporter --show backup-performance-info --destination /test/zrm/

Backup 'now':

<pre>mysql-zrm-scheduler --now --backup-set dailyrun --backup-level 0</pre>

Restore:

<pre>mysql-zrm --verbose --action restore --backup-set itb_innodb --source-directory /test/zrm/itb_innodb/20080214144217/ --tmpdir=/test/tmp</pre>

where /test/tmp has enough space to hold a copy of the backup files.


Changes from the default zrm configuration file:
<pre>
# Request explicitly full backups
backup-level=0
# Select where to write the backup file
destination=/backup/mysqldb/zrm
# Select how many days (D) to keep the backup file
retention-policy=3D
# Request explicit compression
compress=1
# Select which schema to backup
databases=gratia_qcd
# Select the DB user
user="..."
password="...."
# Select where to send result emails
mailto="pcanal@fnal.gov"

-- Main.PhilippeCanal - 27 Feb 2008