%META:TOPICINFO{author="ChrisGreen" date="1274719953" format="1.1" reprev="1.24" version="1.24"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! Gratia Development and Test Environment

<!--
   * Set VIEWTHISTOPIC = <div class="twikiSmall"><a href="%TOPIC%">View this section</a></div>
--> 
%TOC% 
%STARTINCLUDE%

---++ Description

The document attempts to describe the development and test environment for the Gratia accounting services.

[[http://fermigrid.fnal.gov/gratia-development-organization.html][Machine allocation and usage]] is described on the [[[http://fermigrid.fnal.gov][Fermigrid]] [[http://fermigrid.fnal.gov/fermigrid-systems-services.html][Systems and Services]] pages.

---++ Software

In order to insure consistency in the development environment across multiple real/xen nodes, the software packages that are required by Gratia have been stored in the __gratia__ user's $HOME directory which is shared file file system.

*/home/gratia:*
   * mysql-rpms - !MySql client rpm only 
   * tomcat-tarballs - Tomcat tarballs 
   * jre-rpms - run time only. These should be used for all new development and test installations. 

---++ Daily Builds

Daily builds take place from HEAD, and the mechanism for same is described on the [[GratiaDailyBuilds][Gratia Daily Builds]] page.

Logs from the daily build may always be found under ~gratia/gratia-builds, along with the builds themselves.

---++ Daily installs and upgrades

Developers' integration instances are installed from a cron entry on the nightly build host [[#Daily_Builds][daily builds]] described in the previous section.

This allows developers to test committed changes on a regular basis.

The integration environment is described here: [[GratiaItbTestEnvironment][Gratia ITB Test Environment]].

The daily upgrade is performed using the *install-nightly-builds* script via *root* cron entries on the developers' build/test node as shown below.

Refer to the [[GratiaUpgradeScript][Gratia upgrade script (gratia-upgrade.sh)]] documentation for details on location of log files.  An email notification is sent upon completion (successful or failed).

<verbatim>
###################################################################
#----------------------------------
# Daily upgrade of integration collectors
#
25 0 * * * /home/gratia/cron-scripts/install-nightly-builds
###################################################################
</verbatim>

---++ Installing your own collector.

The main flexible, does-everything-you-might-want-and-more script is the [[GratiaUpgradeScript][Gratia upgrade script (gratia-upgrade.sh)]].

*However*, =gratia/build-scripts= contains a simpler wrapper, [[GratiaInstallReleaseScript][install-release]]. It handles installs on production, development and integration servers of official nightly builds, official releases or local builds; see the link for usage information.

---++ General Development
%TABLE{ tableborder="1" cellpadding="0" cellspacing="1" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF"}% 
%EDITTABLE{  header="|*Real Node*|*Xen Node*|*Type*|*Version*|*Purpose*|" format="| text, 15 | text, 15 | textarea, 3x50 | textarea, 4x100 |"  changerows="on" quietsave="on" editbutton="Edit table" }% 
| *Real Node* | *Xen Node* | *Type / Version* | *Other* |
| gratia01 | gratiax11 | | |
| | gratiax12 | | [[mailto:urish@fnal.gov][John Urish]] |
| | gratiax13 | This is ready to go at any time but is not normally on. Contact fermigrid group to arrange use. | |
| | gratiax14 | | Main.AaronThor |
| | gratiax15 | This is ready to go at any time. Contact fermigrid group to arrange use. | |

---++ Reports and Services (Collectors)
%TABLE{ tableborder="1" cellpadding="0" cellspacing="1" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF"}% 
%EDITTABLE{  header="|*Real Node*|*Xen Node*|*Type*|*Version*|*Purpose*|" format="| text, 15 | text, 15 | textarea, 3x50 | textarea, 4x100 |"  changerows="on" quietsave="on" editbutton="Edit table" }% 
| *Real Node* | *Xen Node* | *Type / Version* | *Other* |
| gratia02 | gratiax21 | Test node for Penelope. | Main.PenelopeConstanta |
| | gratiax22 | OSG CE node - see [[GratiaDevAndTestEnviron#Test_Site_Grid][Test Site Grid section]] | Main.JohnWeigand |
| | gratiax23 | Gratia Collector - see [[GratiaDevAndTestEnviron#Test_Site_Grid][Test Site Grid section]] | Main.JohnWeigand |
| | gratiax24 | Not implemented yet | |
| | gratiax25 | Not implemented yet | |

---++ Test Site Grid
 In order to provide a predictable and controlled test environment, a =test= grid site has been established. It will contain all the necessary components of an OSG grid site: 
   * The VOMS service ( =gratiax34=) has been populated with several VOs identified here: https://gratiax34.fnal.gov:8443/vomses %BR%If you are a member of the Gratia development team, you should have administrative privileges to view any data. 

   * The GUMS service ( =gratiax35=) uses the OSG =gums.config= template at this time. So it contains all OSG VOs and memberships as defined by the OSG GOC. At some point, it will be changed to use a =gums.config= file using the =gratiax34= VOMS service. 

   * several Compute Elements (CE) nodes running the various job batch queue managers (condor and pbs at this time). The authorization modes for these CE's can be established to use all three of the OSG modes: grid3, compatibility and full privilege. All will derive their membership lists for authorizations from the Gratia VOMS and GUMS servers mentioned above. For a more complete description of the OSG authorization modes, refer to the [[Trash.ReleaseDocumentationComputeElementAuthorization][OSG CE Authorization document]]. 

   * at least one Worker Node (WN) with glExec. 

%TABLE{ tableborder="1" cellpadding="0" cellspacing="1" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF"}% 
%EDITTABLE{  header="|*Real Node*|*Xen Node*|*Type*|*Version*|*Purpose*|" format="| text, 15 | text, 15 | textarea, 3x50 | textarea, 4x100 |"  changerows="on" quietsave="on" editbutton="Edit table" }%
| *Real Node* | *Xen Node* | *Type / Version* | *Other* |
| gratia03 | gratiax31 | CE OSG 0.8.0 - VDT 1.8.1k %BR%- Condor/Condor-G 6.8.8%BR%- Gratia Condor Probe 0.27.5c-1%BR%- Gratia Metric Probe 0.27.5c-1%BR% | Condor probe reporting to gratiax33%BR% Authorization mode: PRIMA using GUMS services on gratiax35 |
| | gratiax32 | CE OSG 0.6.0 - VDT 1.6.1m %BR%- Condor/Condor-G 6.8.3%BR%- Gratia Condor Probe 0.25 | Condor probe reporting to gratiax33 %BR% Authorization mode: PRIMA using GUMS services on gratiax35 %BR% Intent is for this to use a PBS probe. |
| | gratiax33 | VDT 1.10.1d%BR% - Gratia Reporting 0.34.6%BR% - Gratia Services 0.34.6%BR% Upgraded to v0.37 (nightly)%BR% Replicating to gratiax23:8880 | Access: %BR% * http://gratiax33.fnal.gov:8880/gratia-administration%BR% * http://gratiax33.fnal.gov:8880/gratia-reporting %BR% %BR% This is updated nightly (4 am) from the daily build in:%BR% * /home/gratia/gratia-builds/gratia-latest |
| | gratiax34 | VOMS / OSG 0.8.0 - VDT 1.8.1j <br />VOMS 1.7.20.1 <br />VOMS Admin 1.2.19-3-0%BR% - client 1.2.16-1%BR% - interface 1.0.5-1%BR% - server 1.2.19-3 | VOs: https://gratiax34.fnal.gov:8443/vomses |
| | gratiax35 | GUMS / OSG-0.8.0 - VDT 1.8.1h %BR% GUMS 1.2.15 | Access: https://gratiax35.fnal.gov:8443/gums %BR% Currently populated with the full OSG =gums.config= template. |
| gratia02 | gratiax22 | CE OSG 1.0 / VDT 1.10.1e%BR% - reporting to gratiax33 collector %BR% - Condor/Condor-G 7.0.2%BR% - Gratia Condor Probe 0.34.9-1%BR% - Gratia Metric Probe 0.34.9-1 | Condor probe reporting to gratiax33 %BR% Authorization mode: PRIMA using GUMS services on gratiax35 |
| | gratiax23 | VDT 1.10.99d%BR% - Gratia Reporting 0.34.9%BR% - Gratia Services 0.34.9%BR% Upgraded to v0.36 | Access: %BR% * http://gratiax23.fnal.gov:8880/gratia-administration%BR% * http://gratiax23.fnal.gov:8880/gratia-reporting |

%P% 
%INCLUDE{GratiaVomsTestdata}%

%INCLUDE{GratiaItbTestEnvironment}%

---++ Databases
%TABLE{ tableborder="1" cellpadding="0" cellspacing="1" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF"}% 
%EDITTABLE{  header="|*Real Node*|*Xen Node*|*Type*|*Version*|*Purpose*|" format="| text, 15 | text, 15 | textarea, 3x50 | textarea, 4x100 |"  changerows="on" quietsave="on" editbutton="Edit table" }% 
| *Real Node* | *Xen Node* | *Type / Version* | *Other* |
| gratia05 | gratiax51 / gratia-vm02 | Has big disk for mysql testing | |
| | gratiax52 | has big disk for mysql testing | |
| | gratiax53 | Won't be implemented,<br />not enough disk space on gratia05 | |
| | gratiax54 | Won't be implemented,<br />not enough disk space on<br />gratia05 | |
| | gratiax55 | Won't be implemented<br />not enough disk space on gratia05 | |

%STOPINCLUDE% <!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !--> *Major updates*:%BR% <!--Future editors should add their signatures beneath yours!--> -- Main.JohnWeigand - 29 Jun 2007%BR%
Main.ChrisGreen - 27 Oct 2009%BR%

%META:TOPICMOVED{by="JohnWeigand" date="1183128317" from="Accounting.DevAndTestEnviron" to="Accounting.GratiaDevAndTestEnviron"}%
