%META:TOPICINFO{author="ChrisGreen" date="1280786645" format="1.1" reprev="1.7" version="1.7"}%
%META:TOPICPARENT{name="WebHome"}%
---+ Gratia Service Operation Guide

---++ List of Services Operated by !FermiGrid.

[[http://fermigrid.fnal.gov/gratia-production-organization.html][List of services operated by !FermiGrid]].

---++ Operational Architecture Overview.

As seen in the [[http://fermigrid.fnal.gov/gratia-production-organization.html][production machine deployment description]], the OSG and FNAL-local Gratia  services each consist of a pair of machines each with 6 VMs, the "collector" machine and the "reporter" machine. The collector VMs use the collector DB and the reporter VMs the reporter DB, which is slaved from the collector DB using !MySQL replication. The Gratia services on the reporting VMs consist of the reporting services *only*: no data collection services are installed on these nodes. Similarly, under normal conditions the collector VMs do not have any reporting services. Any requests for reports directed at the collector services are redirected by tomcat to the correct reporting service.

---+++ HA operation.

The IP by which the reporting services access the reporting DB is handled by heartbeat and may be failed over to the collector DB if necessary; the converse is *not* true. Similarly, heartbeat can be used to fail an individual reporting service over to be managed by the corresponding collector service: the collector service is restarted by hibernate in a mode that serves the reports directly rather than redirecting them to the reporting VM. Again, the converse is *not* true.

---++ Installation / upgrade guide.

[[InstallationGuideFNAL][Installation Guide (FNAL Specific)]].

---++ Log file description.

%INCLUDE{"GratiaServiceLogs"  section="LogFiles"}%

---++ Monitoring Gratia.

[[Monitoring][Guide to monitoring a collector]].

---++ Incident Reporting

%INCLUDE{"GratiaServiceLogs"  section="Debugging"}%

---++ Some service-related activities (common or otherwise).

%TOC{"Operation" depth="2"}%

---++ Information on backups.

Backups are made of several different aspects of the Gratia system:

   * Daily backups of XML files from =gratia/data/= via rsync (=~gratia/gratia-ops/backup/ddback/ddback.cron=).
   * Monthly backups of XML files to Enstore via encp (=~gratia/gratia-ops/backup/gratia-archive.sh=).
   * [[InnodbBackup][Daily backups of the DB schemata]] via ZRM (=~gratia/gratia-ops/backup/gratia_backup.cron.sh=).
   * XML files are sent to =splunk= hourly (=~gratia/gratia-ops/splunk/*=).
   * Gratia Sourceforge code base is backed up nightly to =gr6x3:/data/svn-backup= (=~gratia/gratia-ops/backup/svn-backup=).

---++ Additional Information.

See also the general installation [[https://twiki.grid.iu.edu/bin/view/Accounting/WebHome#Collector_and_Reporting][notes]]

-- Main.ChrisGreen - 11 Jul 2008
