%META:TOPICINFO{author="JohnWeigand" date="1404393831" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="GratiaInterfacesApelLcg"}%
---+!! Gratia-APEL Migration To OSG

%TOC%

%STARTINCLUDE%

---+ Test vs Production APEL ssm.cfg
Note; The *ssm.cfg* changes for production and test environments have changed.%BR%
See: https://twiki.grid.iu.edu/bin/view/Accounting/ApelWlcgDevelopersCorner#SSM_Configuration_files

The table below indicates the changes necessary for test and production in the *ssm.cfg* file.
%TABLE{ tableborder="1" cellpadding="0" cellspacing="1" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF"}% 
| *Test* | [producer]     |topic: /topic/global.accounting.%BLUE%test.cpu%ENDCOLOR%.central %BR%consumer-dn: /C=UK/O=eScience/OU=CLRC/L=RAL/CN=%BLUE%raptest.esc.rl.ac.uk%ENDCOLOR% %BR%ack: /topic/global.accounting.%BLUE%test.cpu%ENDCOLOR%.client.$host.$pid |
| *Production* | [producer]     |topic: /topic/global.accounting.%BLUE%cpu%ENDCOLOR%.central %BR%consumer-dn: /C=UK/O=eScience/OU=CLRC/L=RAL/CN=%BLUE%rap.esc.rl.ac.uk%ENDCOLOR% %BR%ack: /topic/global.accounting.%BLUE%cpu%ENDCOLOR%.client.$host.$pid |

---+ Final test of installation

1. Verify setup/configurations are correct.
   * On your node, make a run against the test APEL.
   * Advise when you are doing this and I will make a run against the  test APEL on my node
   * Then we can compare results verifying  
      * http://fermicloud108.fnal.gov:8319/gratia-apel/
      * http://OSG_TEST_NODE:8319/gratia-apel


---+ Changeover for Production

1. On my node, 
   * I need to send the latest delete file up.%BR%  This will zero out all the Gratia data for June.%BR%
      This insures we don't miss one due to a timing issue of the runs.

2. Then on your node,
   * modify the /etc/gratia-apel/ssm/ssm.cfg to point to production
   * modify the cron entry adding a *--no-email* argument.  %BR%
     This insures we don't send false alarms out if there is a problem.
   * run the interface
   * reset the cron entry removing the *--no-email* argument

3. On your side,
   a. Change the url alias for *gratia-apel-wlcg.opensciencegrid.org* %BR%
      from gr13x6.fnal.gov%BR%
      to OSG_NODE

   b. Verify  these are identical:
   * http://gratia-apel-wlcg.opensciencegrid.org:8319/gratia-apel/%BR%
   * http://OSG_NODE:8319/gratia-apel


4. Verify these show the same data:
   * http://gratia-apel-wlcg.opensciencegrid.org:8319/gratia-apel
   * http://gratiaweb.grid.iu.edu/gratia/wlcg_reporting?year=2014&month=7


5. In a day or 2, verify we are close on the EGI portal by comparing%BR%
   * gratiaweb%BR% (http://gratiaweb.grid.iu.edu/gratia/jot_reporting) %BR%
   * EGI %BR% (http://accounting.egi.eu/tier2.php?SubTier2=1.35&query=njobs&startYear=2014&startMonth=6&endYear=2014&endMonth=6&yRange=TIER2&xRange=DATE&voGroup=lhc&chart=GRBAR&scale=LIN&localJobs=onlygridjobs)%BR%
      - at the bottom of the EGI page there is a date of last update which tells us what data may be there.






%STOPINCLUDE%

<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->
---+ Major updates
<!--Future editors should add their signatures beneath yours!-->
-- Main.JohnWeigand - 20 Jun 2014%BR%
