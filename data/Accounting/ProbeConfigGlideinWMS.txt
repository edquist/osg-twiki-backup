%META:TOPICINFO{author="DerekWeitzel" date="1308088292" format="1.1" reprev="1.11" version="1.11"}%
%META:TOPICPARENT{name="ProbeInstallation"}%
---+ !GlideinWMS Probe Configuration

   1. Install the Gratia Common and Gratia Condor RPM on the host that runs the =condor_schedd=.  Currently, you need a pre-release of the [[http://koji.hep.caltech.edu/public/packages/gratia-probe/1.07.02e/0.4.pre/noarch/gratia-probe-condor-1.07.02e-0.4.pre.noarch.rpm][RPM]].  This probe will read the GLIDEIN_ResourceType startd attribute.  This attribute needs to be set by the !GlideinWMS Factory (The OSG factories already have this set).  If this attribute does not exist, it will fall back to GLIDEIN_Site, and finally the !FileSystemDomain of the host.
   1. Edit the ProbeConfig located in =/opt/vdt/gratia/probe/condor/ProbeConfig=.  First, edit the =SiteName= to be a unique identifier for your !GlideinWMS Submit host.   If you haven't already, you should register your !GlideinWMS submit host in [[https://oim.grid.iu.edu/oim/home][OIM]].  Then you can use the name you used to register the resource.
   <pre class="file">
SiteName="HCC-GlideinWMW-Frontend"   </pre>
   Next, turn the probe on by editing the =EnableProbe=:
   <pre class="file">
EnableProbe="1"   </pre>
   1. Add to condor_config (or condor_config.local, or any condor configuration file):
   <pre class="file">
# GlideinWMS Gratia commands
PER_JOB_HISTORY_DIR = /opt/vdt/gratia/var/data
JOBGLIDEIN_ResourceName="$$([IfThenElse(IsUndefined(TARGET.GLIDEIN_ResourceName), IfThenElse(IsUndefined(TARGET.GLIDEIN_Site), FileSystemDomain, TARGET.GLIDEIN_Site), TARGET.GLIDEIN_ResourceName)])"
SUBMIT_EXPRS = $(SUBMIT_EXPRS) JOBGLIDEIN_ResourceName   </pre>
<!--
   1. Modify cron to periodically run the script.  You can create a file in /etc/cron.d/ to do this.
   <pre class="screen">
echo '12,27,42,57 * * * * root "/opt/vdt/gratia/probe/condor/condor_meter.cron.sh"' > /etc/cron.d/gratia-probe-condor.cron</pre>
-->

---+ Users without Certificates
If you have users that submit jobs without a certificate explicitly declared in the submit file, you will need to add =MapUnknownToGroup= to the ProbeConfig.  In the file =/opt/vdt/gratia/probe/condor/ProbeConfig=, add the value after the =EnableProbe=.

<pre class="file">
    ...
    SuppressGridLocalRecords="0"
    EnableProbe="1"
    %RED%MapUnknownToGroup="1"%ENDCOLOR%

    Title3="Tuning parameter"
    ...
</pre>

-- Main.DerekWeitzel - 19 May 2011
