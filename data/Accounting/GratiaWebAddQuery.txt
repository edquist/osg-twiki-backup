%META:TOPICINFO{author="JuanFelipeMosqueraMorales" date="1424296596" format="1.1" reprev="1.3" version="1.3"}%
---+ Guide to create a new Query in Gratia Web 
The Gratia Web queries are defined in !XML files. These files are located at in the =OSG-Measurements-Metrics= project in this path =./src/gratia/config=. If you are working in a machine with a working installation these files will be located in the =site-packages= folder of the python installation in the machine. For example in a SL5 machine with python 2.4 the path would be =/usr/lib/python2.4/site-packages/gratia/config=, or in a SL6 machine with python 2.6 it would be =/usr/lib/python2.6/site-packages/gratia/config=.

%NOTE% After modifying the XML files the server will require a restart to load the changes made to the queries.

The queries are organized in different groups. Each group has a correspondent XML file that defines the queries. These groups and the related XML files are:

   *  =GratiaStatusQueries --&gt; gratia_status_queries.xml=
   *  =GratiaEventsQueries --&gt; gratia_events_queries.xml=
   *  =GratiaDataQueries --&gt; gratia_data_queries.xml=
   *  =GratiaPieQueries --&gt; gratia_pie_queries.xml=
   *  =GratiaGlideinBarQueries --&gt; gratia_glidein_bar_queries.xml=
   *  =GratiaBarQueries --&gt; gratia_bar_queries.xml=
   *  =GratiaRTQueries --&gt; gratia_realtime_queries.xml=
   *  =GratiaTransferQueries --&gt; gratia_transfer_queries.xml=
   *  =GratiaCumulativeQueries --&gt; gratia_cumulative_queries.xml=
   *  =GridScanQueries --&gt; gridscan_queries.xml=
   *  =GIPQueries --&gt; gip_queries.xml=
   *  =RSVQueries --&gt; rsv_queries.xml=
   *  =RSVWLCGQueries --&gt; rsv_wlcg.xml=
   *  =RSVSummaryQueries --&gt; rsv_summary.xml=

This queries groups is defined in =text_queries.xml=, and can be examined on a running server on =http://ip:[port]/gratia/xml=.
<pre class="file">
&lt;graphtool-config&gt;  
  ...
  &lt;class type="XmlGenerator" name="query_xml"&gt;
    &lt;attribute name="timeout"&gt;900&lt;/attribute&gt;
    &lt;queryobj&gt; GratiaStatusQueries &lt;/queryobj&gt;
    &lt;queryobj&gt; GratiaEventsQueries &lt;/queryobj&gt;
    &lt;queryobj&gt; GratiaDataQueries &lt;/queryobj&gt;
    &lt;queryobj&gt; GratiaPieQueries &lt;/queryobj&gt;
    &lt;queryobj&gt; GratiaGlideinBarQueries &lt;/queryobj&gt;
    &lt;queryobj&gt; GratiaBarQueries &lt;/queryobj&gt;
    &lt;queryobj&gt; GratiaRTQueries &lt;/queryobj&gt;
    &lt;queryobj&gt; GratiaTransferQueries &lt;/queryobj&gt;
    &lt;queryobj&gt; GratiaCumulativeQueries &lt;/queryobj&gt;
    &lt;queryobj&gt; GridScanQueries &lt;/queryobj&gt;
    &lt;queryobj&gt; GIPQueries &lt;/queryobj&gt;
    &lt;queryobj&gt; RSVQueries &lt;/queryobj&gt;
    &lt;queryobj&gt; RSVWLCGQueries &lt;/queryobj&gt;
    &lt;queryobj&gt; RSVSummaryQueries &lt;/queryobj&gt;
  &lt;/class&gt;
  ...
&lt;/graphtool-config&gt;  
</pre>

---++ Modifying/adding queries to an existing group

Most of the queries defined in the different groups extend from queries that are defined in =generic_queries.xml=. To add a new query to a group you must go to the XML where the group is defined, and add a new =&lt;query&gt;= node to the =&lt;class type="SqlQueries" name="GROUP_NAME"&gt;= node.
<pre class="file">

&lt;graphtool-config&gt;
...
&lt;class type="SqlQueries" name="GROUP_NAME"&gt;
    ...

    <b>&lt;query name="NEW_QUERY_NAME"&gt;</b>
    ...
    <b>&lt;/query&gt;</b>
    ...
&lt;/class&gt;

&lt;/graphtool-config&gt;
</pre>
%IMPORTANT% The query name will also be the path to access the query in the URL (=http://ip:[port]/gratia/xml/<b>&lt;query_name&gt;</b>=). Do not use spaces or special characters in the query name. Do not use a query name that is already in use by other query.

The =query= node is composed of the following nodes:

---+++ Query =inputs= tag
---+++ Query =sql= tag
---+++ Query =results= tag
---+++ Query =attribute= tag





-- Main.JuanFelipeMosqueraMorales - 12 Feb 2015
