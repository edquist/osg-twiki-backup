%META:TOPICINFO{author="KyleGross" date="1225985923" format="1.1" version="1.6"}%
%META:TOPICPARENT{name="WebHome"}%
---+ Some Operational Tasks.

This pages describes the main operation tasks to be executed by a Collector administrator.

This documentation assumes that you are connected to http://yourhostname:yourport/gratia-administration.

The Gratia administration services provides several options for securing the administrative tasks. The basic system status is available to all users. All other services that allow you configure the system, turn on/off service, perform replication, etc, can be restricted to selected personnel.

The secured tasks are all shown as dimmed in the menu until you are authorized. When you attempt to access those tasks, you will be redirected to an SSL secured port requiring you to have a certificate in your browser from a trusted CA (Certificate Authority). This initiates the login process. (See the "Administration Login" link for more detail)

Note that at the bottom left of the page, you can find the version number of the installed Gratia Software and the name of the schema. Once logged-in, this also provide the db host and port.

---++ Starting and stopping the service

<pre>service TOMCAT_INITD_SERVICE start</pre> <pre>service TOMCAT_INITD_SERVICE stop</pre>

Note that the correct value of =TOMCAT_INITD_SERVICE= may be found in the [[OperatedList][list of services operated by Fermigrid]].

---++ Site Name changes

As of v0.36, the name recorded in Gratia must match the name recorded in OSG's VirtualOrganizations/VOInfoRS database (in an upcoming release, it will need to match the information in OSG's OIM database).

The name of Site sometimes need to be updated in the Gratia database. This usually happens for the following 2 reasons. If a new site mis-configures their Gratia Probe, the name recorded for the site to which the Probe belong might be incorrect entered. If a site is renamed in VirtualOrganizations/VOInfoRS.

To change the name, select the "Site Table" link. Find the old Site Name in the table, edit the name to enter the new name. Scroll to the bottom of the page and click "Apply".

---++ Change the name use for a VirtualOrganizations/VOInfo in the reports.

To change to which VirtualOrganizations/VOInfo is set of records is assign to (from a report perspective), select "VirtualOrganizations/VOInfoName Correction"

The page contains 3 columns:

   * Reported VirtualOrganizations/VOInfoName: The VirtualOrganizations/VOInfoName reported by the probe. For probe v0.34 and above this usually contains the FQAN of the certificate used to submit the job. 
   * Reported !ReportableVOName: The 'reportableVoName' reported by the probe. For probe v0.34 and above this usually contains the best guess at what the VirtualOrganizations/VOInfo name is. 
   * Actual VO: The name actually used in the reporting tool as the VirtualOrganizations/VOInfo to which the job(s) belongs. 

To change the way a pair "Reported VirtualOrganizations/VOInfoName"/"Reported !ReportableVOName" is displayed, scan the list for the proper/revelant entry and select a new "VirtualOrganizations/VOInfoName" from the drop down list. Then click on "Apply" (at the very bottom of the page).

The best guess for what is the VirtualOrganizations/VOInfo name should be, is done using the following rule:

If there's no !VirtualOrganizations/VOInfoNameCorrection entry, then if there's a leading / in VirtualOrganizations/VOInfoName the default translation is to !ReportableVOName, otherwise the default translation is to VirtualOrganizations/VOInfoName.

---++ Adding a VirtualOrganizations/VOInfo Name (very rare)

If a VirtualOrganizations/VOInfoName is not available in the list of VOs, select the "VirtualOrganizations/VOInfo Management" link. Scroll to the bottom of the page, edit one of the box with "<New VirtualOrganizations/VOInfo Name>" and click on Apply

---++ Setting up replication

Replication is setup on the sender. Select the "Replication" link to manage the replication.

See the "[[http://gratia.opensciencegrid.org:8880/gratia-administration/replication-howto.jsp][replication]]" link under the, "Documentation" heading on the [[http://gratia.opensciencegrid.org:8880/gratia-administration][service administration]] page for more details.

---++ Rolling back a release (extremely rare)

The rolling back procedure depends on whether the release involved any schema upgrade (see release notes for details)

---+++ Rolling back when no schema upgrade.

In this case, the database schema is still compatible with the previous release and rolling up back simply involved re-installing the previous release as normal.

---+++ Rolling back in the usual case

In this case, the database schema is no longer compatible with the previous release and rolling back involves restoring the previous database from backup.

The steps are
   * Wipe out database (do *not* use "rm -r" as this will leave the entire DB in an unstable state).
   * Re-install old schema from backups (this includes re-installing previous version of the Collector software)  See the [[InnodbBackup][information on backups]]
   * Make sure the gratia/data directory contains history directories and files from the point the new collector was turned off for rollback back to just before the upgrade occurred. Restore missing histories from enstore if necessary,
   * Re-play the history (see the Gratia administration page, select the System/Administration link and follow the instruction under Disaster Recovery/Replay)

---++ Installing and configuring the latest version of ZRM (extremely rare)

%INCLUDE{"InnodbBackup" section="InstallConfigureZRM"}%