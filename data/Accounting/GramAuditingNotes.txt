%META:TOPICINFO{author="JohnWeigand" date="1200930910" format="1.1" reprev="1.5" version="1.5"}%
<!--
   * Set EDITTHISTEXT = <div class="twikiSmall"><a href="%TOPIC%">edit this section</a></div>
-->

---+!! GRAM Auditing Notes

<!--
   * Set BUG5712 = [[http://bugzilla.globus.org/globus/show_bug.cgi?id=5712][Bug 5712]] - Local_job_id format variations
   * Set BUG5713 = [[http://bugzilla.globus.org/globus/show_bug.cgi?id=5713][Bug 5713]] - Failed database connection loses audit records
   * Set BUG5714 = [[http://bugzilla.globus.org/globus/show_bug.cgi?id=5714][Bug 5714]] - Additional data (FQAN) in audit records
   * Set BUG5725 = [[http://bugzilla.globus.org/globus/show_bug.cgi?id=5725][Bug 5725]] - housekeeping for the auditRecords database
   * Set BUG5776 = [[http://bugzilla.globus.org/globus/show_bug.cgi?id=5776][Bug 5776]] - Need for one INFO log message. Currently none.
   * Set BUG5777 = [[http://bugzilla.globus.org/globus/show_bug.cgi?id=5777][Bug 5777]] - Database connection times out
   * Set BUG5778 = [[http://bugzilla.globus.org/globus/show_bug.cgi?id=5778][Bug 5778]] - No error message on db update failure



-->

%TOC%

%STARTINCLUDE%

---++ Description
Gratia has a requirement to be able to report grid usage data for:
   * VOs 
   * VO subgroups
   * Individual grid users (DN)
   * Roles

All of the above information is contained within the proxy certificate when the job request is received on the CE node for a VOMS proxy.  For a VOMS proxy, the VO/Subgroup/Role information is commonly referred to as the FQAN (Fully Qualified Attribute Name).

If a user uses a grid proxy (does not have the extended attributes), only the DN is available. 

Currently (1/17/2008) the only reliable data available, in the GRAM audit log entry and batch queue systems, to Gratia is the DN of the grid user.   Gratia is currently able to determine the user's VO using the _$VDT_LOCATION/monitoring/osg-user-vo-map.txt_ file which provides a mapping of UNIX account to VO, but this file has been prone to data integrity problems at many sites.  The only reliable means of capturing this information is at the time the proxy is read during the authorization process.  This would require changes to the GRAM auditing data that is maintained.  The GRAM audit records also provide a link to the job id used in each of the batch queue systems which Gratia relies on for the accounting data.

This topic addresses:
   * The changes necessary to make the FQAN data available in the GRAM audit records.
   * Configuring a Compute Element (CE) for GRAM auditing.




---++ GRAM proposal (1/11/2008)
For general information on GRAM Auditing, refer to these Globus GRAM documents:
   * GRAM2 (pre-web services):   [[http://www-unix.globus.org/toolkit/docs/4.0/execution/prewsgram/Pre_WS_GRAM_Audit_Logging.html][http://www-unix.globus.org/toolkit/docs/4.0/execution/prewsgram/Pre_WS_GRAM_Audit_Logging.html]]
   * GRAM4 (web services): [[http://www.globus.org/toolkit/docs/4.0/execution/wsgram/WS_GRAM_Audit_Logging.html][http://www.globus.org/toolkit/docs/4.0/execution/wsgram/WS_GRAM_Audit_Logging.html]]


A conference call was held on Friday 1/11/2008 to discuss the changes necessary to make the additional data (FQAN) available in the GRAM audit record. Attendees:
   * Rachana Ananthakrishnan (ranantha@mcs.anl.gov)
   * Stuart Martin (smartin@mcs.anl.gov)
   * John Weigand  (weigand@fnal.gov)

The Globus proposal for collecting the additional data (basically FQAN) is to create a 2nd audit table which would be joined to the current one (_gram_audit_table_). The _job_grid_id_ would be the joining column and essentially make this 2nd table similar in  nature to the <nop> _JobUsageRecord_Meta_ in Gratia where it is an  just an extension of  the <nop> _JobUsageRecord_ .



---+++ Changes for GRAM4 (web services)


---+++ Changes for GRAM2 (pre-web services)



---++ Implementation Time Frame
The use of GRAM audit records in the Gratia probes is needed for OSG 1.0 and, therefore needs to be made available for integration testing in OSG 0.9.

The current VDT distribution for OSG 0.8.0 is Globus v4.0.5.

Globus v4.0.6 was released on 1/14/2008.%BR%
Globus v4.0.7 is scheduled for March 2008.


---++ GRAM Auditing Log Bugzilla Items
These are the current items entered in the Globus bugzilla system for GRAM auditing that are relevant to the Gratia requirements:
   * %BUG5712%
   * %BUG5713%
   * %BUG5714%
   * %BUG5725%
   * %BUG5776%
   * %BUG5777%
   * %BUG5778%

All of the above are deemed critical for GRAM auditing to be used by Gratia.  

The only one that Globus does not feel they can address is %BUG5725%.  It is felt this is similar in nature to housekeeping on file system type log files which are handled in a variety of different ways at sites and therefore impossible to address with a general solution.  The housekeeping would also be dependent on how non-Globus processes use the data.  Some may need to clean once they process the audit record.  Others may need to retain the data for a period.  The use of the data will dictate the housekeeping rules.

All others they agreed to address.


%INCLUDE{ConfigureGramAuditing}%



%STOPINCLUDE%




<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->
---++!! Major updates
<!--Future editors should add their signatures beneath yours!-->
-- Main.JohnWeigand - 17 Jan 2008%BR%
