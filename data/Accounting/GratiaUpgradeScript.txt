%META:TOPICINFO{author="JohnWeigand" date="1218727923" format="1.1" version="1.3"}%
%META:TOPICPARENT{name="GratiaDevAndTestEnviron"}%
---+!! <nop>Gratia Upgrade Script

<!--
   * Set VIEWTHISTOPIC = <div class="twikiSmall"><a href="%TOPIC%">View this section</a></div>
--> 
%TOC% 
%STARTINCLUDE%

---++ Gratia Upgrade Script

%VIEWTHISTOPIC%

A script ( __gratia-upgrade.sh__) is available to facillitate the upgrading and installation of production, test and development gratia instances.

In the cvs repostitory, the script resides in __./gratia/build-scripts/gratia-upgrade.sh__.

*Usage: gratia-upgrade.sh --help* 
<verbatim>
This script is intended to simplify the upgrading of a gratia instance
in development, integration and production.  

There are 2 modes:
1. Question and answer mode (no command line arguments)
     gratia-upgrade.sh 
2. No prompt mode (all arguments are required)
   Refer to the paragraph below as to the prompts for the value of the
   individual arguments.
     gratia-upgrade.sh --instance TOMCAT_INSTANCE --source SOURCE_DIR --pswd ROO
T_PSWD
          [--daily  EMAIL_ADDRESS(ES) --mysql MYSQL_FILE]

Although it does not really do much more than is already available to do, its
intent is to take some of the guesswork (memory-like) out of the upgrade
process.

A major assumption it makes is that all tomcat collectors are in /data.
If this is not true, you will have to do it the old fashion way.

 No prompt mode   Prompt mode questions
 --------------   --------------------- 
 --instance       tomcat instance (e.g, tomcat-weigand)
 --source         source directory
                    - daily builds..... /home/gratia/gratia-builds
                    - release builds... /home/gratia/gratia-releases
                    - other............ specified by you
 --pswd           mysql root password
 --daily          do you want to start the tomcat/collector service
 --mysql          DB MySql file containing the password for upgrades 
                  (required when running from cron and when used the 
                  --pswd argument is ignored)
 --force-log4j    Force overwrite of log4j config file.

If '--daily' is used, then all arguments are required and use of this argument
will automatically start the tomcat/collector and requires specifying the
email address(es).  It is intended for use ONLY when running from cron for 
the purpose of daily test installations.

The script performs the following:
 1. shutdown your tomcat instance/collector
 2. run update-gratia-local with the appropriate arguments
 3. clean your log directory saving the old logs in 
      /data/gratia_tomcat_logs_backups
 4. optionally, allow you to start your collector
    (when the --daily argument is specified, it will start the collector)

You must be root user to execute this script.

</verbatim>

%STOPINCLUDE%

-- Main.JohnWeigand - 18 Jul 2008