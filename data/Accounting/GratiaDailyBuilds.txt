%META:TOPICINFO{author="JohnWeigand" date="1219243015" format="1.1" reprev="1.1" version="1.1"}%
---+!! <nop>Gratia Daily Builds

<!--
   * Set VIEWTHISTOPIC = <div class="twikiSmall"><a href="%TOPIC%">View this section</a></div>
-->

%TOC%

%STARTINCLUDE%

---++ Gratia Daily Builds

%VIEWTHISTOPIC%

On a daily basis ( __gratia02__ cron), a script is run to bring down the HEAD node of the Gratia cvs source forge repository and perform a __'__ _make release_ __'__.

This allows developers to always have the latest Gratia build available for installation on their test instance.

Additionally, these daily builds will be used to perform daily upgrades of the Gratia instances described in the [[#Daily_installs_and_upgrades][Daily installs and upgrades]] section of this document.

In cvs, the script resides in __./gratia/build-scripts/nightly-build.sh__ .

*Cron entry:*
<verbatim>
   05 0 * * * /home/gratia/cron-scripts/nightly-build.sh
                --mail gratia-operation@fnal.gov
</verbatim>

*Usage: nightly-build.sh [--dir directory] [--mail addresses] [--files n] [--help]*
<verbatim>
This script will perform an export of the HEAD of the Gratia CVS repository
and then perform a 'make release' on the software.  

NOTE: Since it is an export, you will not be able to effect any
      commits in this area.

It will create a directory called gratia-builds in your $HOME
area unless overridden using the --dir argument. If the directory does not
exist, it will create it.

Parent source directory.. /home/gratia/gratia-builds/gratia-2008-08-14
Log file................. /home/gratia/gratia-builds/gratia-2008-08-14.log

CVS: cvs -z3 -d:pserver:anonymous@gratia.cvs.sourceforge.net:/cvsroot/gratia.

Arguments:
   --dir   - the parent directory for the gratia-builds directory
   --mail  - email address(es) to be used on completion of the build.
   --files - number of build directories to retain in /home/gratia/gratia-builds
             Since the source directory and log files are timestamped by day,
             this argument allows you to specify the number (not days) of
             builds to retain.  This is a housekeeping thing.
             It is not perfect either.  If you have too many successive days
             with failures, the symlink to the last good build will be
             invalid.
             Default: 7

Cron entry note: do not redirect stdout/stderr to /dev/null or you may be
                 oblivious to any uncaught errors.

If you run this more than once per day, the parent source directory will be
overwritten each time.  However the log file will be appended to.

On success, it will create a symbolic link to the newly built gratia source
directory called:
  /home/gratia/gratia-builds/gratia-latest

An email notification upon completion will be sent to:
  gratia-operation@fnal.gov
</verbatim>

%STOPINCLUDE%

-- Main.JohnWeigand - 20 Aug 2008
