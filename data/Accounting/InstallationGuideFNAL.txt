%META:TOPICINFO{author="ChrisGreen" date="1175893681" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="WebHome"}%
---+ FNAL-specific Gratia collector installation guide

%TOC%

---++ Obtain and install the Java Runtime v1.5

---++ Obtain and configure Tomcat
<ol>
  <li>Obtain the latest version of [[http://tomcat.apache.org/download-55.cgi][Tomcat in the 5.5 stream]] (core package only: =apache-tomcat-&lt;version&gt;.tar.gz=).</li>
  <li>Expand into the desired area:
    <pre class="code">cd &lt;dest-path&gt;
mkdir tomcat-&lt;collector-designator&gt;
tar zxvf  &lt;path&gt;/apache-tomcat-&lt;version&gt;.tar.gz -C tomcat-&lt;collector-designator&gt; --strip-path 1</pre>
  </li>
  <li>Configure the collector to listen on the desired ports in =conf/services.xml=:
    <ol>
      <li>Find the section in the default =conf/services.xml= which starts; =&lt;Service name="Catalina"&gt;=:</li>
      <li>Replace any existing =Connector= declarations with the following, replacing =&lt;HTTP-port-no&gt;=, =&lt;HTTPS-port-no&gt;= and =&lt;tomcat-top-dir&gt;= with appropriate values (port numbers can be obtained from the table below):
        <pre class="code">&lt;Connector port="&lt;HTTP-port-no&gt;" maxHttpHeaderSize="8192"
 maxThreads="150" minSpareThreads="25" maxSpareThreads="75"
 enableLookups="false" redirectPort="&lt;HTTPS-port-no&gt;" acceptCount="100"
 connectionTimeout="20000" disableUploadTimeout="true"
/&gt;
&lt;Connector port="&lt;HTTPS-port-no&gt;" maxHttpHeaderSize="8192"
 maxThreads="150" minSpareThreads="25" maxSpareThreads="75"
 enableLookups="false" disableUploadTimeout="true"
 acceptCount="100" scheme="https" secure="true"
 keystoreFile="&lt;tomcat-top-dir&gt;/gratia/keystore" keystorePass="server"
 truststoreFile="&lt;tomcat-top-dir&gt;/gratia/truststore" truststorePass="server"
 clientAuth="true" sslProtocol="TLS"
/&gt;</pre>
      </li>
    </ol>
  </li>
  <li>Configure the tomcat =users.xml= to look as below, taking passwords from their equivalent entries in =cd-psg2:/data/glr/tomcat-gratia/conf/tomcat-users.xml=:
    <pre class="code">&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;tomcat-users&gt;
  &lt;role rolename="tomcat"/&gt;
  &lt;role rolename="role1"/&gt;
  &lt;role rolename="manager"/&gt;
  &lt;role rolename="admin"/&gt;
  &lt;user username="penelope" password="&lt;password&gt;" fullName="Penelope Constanta" roles="admin,manager"/&gt;
  &lt;user username="gratia" password="&lt;password&gt;" fullName="gratia prototype user" roles="admin,manager"/&gt;
  &lt;user username="root" password="&lt;password&gt;" roles="admin,manager"/&gt;
&lt;/tomcat-users&gt;</pre>
  </li>
  <li>Obtain and customize the !SysV init script:
    <ol>
      <li>[[%ATTACHURL%/tomcat-gratia][tomcat-gratia !SysV init script]]</li>
      <li>Rename as appropriate for the desired service:</li>
      <li>Customize the main variables at the top to match the tomcat installation variables and Gratia requirements. Possible values of the =USERCONFIG_FILE_NAME= variable are currently:
        <ul>
          <li> =UserConfig_osg.xml= </li>
          <li> =UserConfig_psacct.xml= </li>
          <li> =UserConfig_osg_daily.xml= </li>
        </ul>
        Obtain port numbers from the table below.
      </li>
    </ol>
  </li>
</ol>

---++ Obtain and configure a cut of the Gratia collector packages.
<ol>
  <li></li>
  <li></li>
  <li></li>
</ol>


-- Main.ChrisGreen - 06 Apr 2007

%META:FILEATTACHMENT{name="tomcat-gratia" attachment="tomcat-gratia" attr="" comment="Template Gratia Tomcat !SysV init script" date="1175892494" path="tomcat-gratia" size="1290" stream="tomcat-gratia" user="Main.ChrisGreen" version="1"}%

