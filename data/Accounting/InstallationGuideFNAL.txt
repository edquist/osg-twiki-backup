%META:TOPICINFO{author="ChrisGreen" date="1182375186" format="1.1" reprev="1.7" version="1.7"}%
%META:TOPICPARENT{name="WebHome"}%
---+ FNAL-specific Gratia collector installation guide

%TOC%

---++ Obtain and install the Java Runtime v1.5 (=5.0)

Install the Java Runtime 5.0 from [[http://java.sun.com/javase/downloads/index_jdk5.jsp][Sun's site]] (scroll down past the SDK links).

---++ Obtain and install Tomcat
<ol>
  <li>Obtain the latest version of [[http://tomcat.apache.org/download-55.cgi][Tomcat in the 5.5 stream]] (core package only: =apache-tomcat-&lt;version&gt;.tar.gz=).</li>
  <li>Expand into the desired area:
    <pre class="code">cd &lt;dest-path&gt;
mkdir tomcat-&lt;collector-designator&gt;
tar zxvf  &lt;path&gt;/apache-tomcat-&lt;version&gt;.tar.gz -C tomcat-&lt;collector-designator&gt; --strip-path 1</pre>
  </li>
  <li>Do not configure tomcat at this time: there is a script to do this automatically -- see below.</li>
</ol>

---++ Ensure the existence of a suitable DB schema.
<ol>
  <li>Create a new empty DB if necessary with appropriate access permissions for gratia (all) and reader (SELECT and EXECUTE)</li>
  <li>Execute the following SQL as DB root:<pre>GRANT SELECT ON mysql.proc TO gratia</pre></li>
</ol>

---++ Obtain and configure a cut of the Gratia collector packages.
<ol>
  <li>Ask a developer for a sanctioned release number or a pointer to a sanctioned release area containing =.war= files and the =gratia.tar= file.</li>
  <li>If all you have is the release number:
  <ol>
    <li>Check out the sanctioned release:
    <ol>
      <li>Initialize if necessary: <pre>cvs -d:pserver:anonymous@gratia.cvs.sourceforge.net:/cvsroot/gratia login</pre></li>
      <li>Get the sanctioned version: <pre>cvs -z3 -d:pserver:anonymous@gratia.cvs.sourceforge.net:/cvsroot/gratia export -d gratia-&lt;release&gt; -r &lt;release&gt; gratia</pre></li>
    </ol>
    </li>
    <li>Build the release:
    <ol>
      <li>Ensure you have and are using (=JAVA_HOME=, =PATH=) JDK1.5 (see above).</li>
      <li> =cd gratia-&lt;release&gt;/build-scripts= </li>
      <li> =make gratia= </li>   
    </ol>
    </li>
  </ol>
  <li>Copy and/or edit =&lt;path-to-gratia-release&gt;/common/configuration/configure-collector= to have a clause for your tomcat instance in =%collector_configs=; see =%default_attributes= for possible attributes.</li>
  <li>Run the following command (see =-h= for usage):
<pre>&lt;path-to-gratia-release&gt;/update-gratia-local -c &lt;configure-script-location&gt; -S &lt;path-to-gratia-release&gt; -p &lt;dest-path&gt; -j &lt;JRE_HOME&gt; -d &lt;DB-root-pw&gt; &lt;collector-designator&gt</pre>
  </li>
</ol>

---++ Start the collector
<ul>
<li><pre>/etc/rc.d/init.d/tomcat-&lt;collector-designator&gt; start</pre></li>
</ul>

-- Main.ChrisGreen - 20 Jun 2007
