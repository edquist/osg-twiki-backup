%META:TOPICINFO{author="KarthikArun" date="1301356772" format="1.1" reprev="1.16" version="1.16"}%
%TOC%

---++Description of Accounting Reports
---+++Python reports
This page will make an attempt to describe/explain the accounting reports that are part of the gratia account reporting mechanism. Gratia accounting collects data from various grid resources and populates them into a database. This data is then used to generate reports that are sent to end users, site admins, management and stakeholders. These reports form an important part of the gratia accounting mechanism in the sense it provides a quick summary of the big picture of Grid Accounting. These reports have a significant impact in terms of understanding the accountability of resources, how efficiently these resources are being utilized, by whom, when and much more. 

All the scripts that generate and email the report are contained in the gratia trunk/reporting/summary. The main scripts are the daily and range. Also involved are the  perl reports (all-sites-oim, all-vos-oim, failure-by-vo-site, osg-users).

Given below are the description of the reports in no particular order. To give you a good idea of how the report looks like, we have tried to include a complete sample report whenever possible. The frequency of when these reports are sent out (daily, weekly or monthly) vary. Note that each of these reports have the flexibility to be generated either for a specific date or for a range of dates. 

<ol>
<li>
---++++Report from the job level Gratia db

This report provides the job level accounting information from the Gratia database. To start with, this report provides a big picture summary of the job based accounting information based on sites and then provides multiple sub reports that contain the OSG usage summary statistics for the jobs that finished for a given date or a date range. The OSG usage summary is based on different permutations and combinations of sites and VOs. 

Report invocation hierarchy: <br>
        daily_mail_cron.sh -> daily_mutt.sh -> daily<br>
        range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> range

<b>How one could receive this report:</b>

You could receive the <b>"Report from the job level Gratia db"</b> report by subscribing to the <font color=blue>osg-accounting-info@fnal.gov</font> mailing list. Note: This is a single report (consisting of multiple sub-reports as explained below) that that will be sent. <a href=https://twiki.grid.iu.edu/bin/view/Accounting/ReportFromTheJobLevelGratiaDb>Click here</a> to view a complete sample report. 

Each of the sub reports that this report contains are explained in more detail below. 
<ul>
<li>
Report name: <b>RangeSumup</b>

Report category: Site and VO reports

Report invocation hierarchy:<br>
        daily_mail_cron.sh -> daily_mutt.sh -> daily -> AccountingReports.RangeSumup<br>
        range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> range -> AccountingReports.RangeSumup

Purpose of the report:
        This report provides a big picture summary of how the different sites have (and not have) reported in regard to accounting data i.e. it provides information like how many sites reported, how many sites didn't report, how may sites had no activity, the non-reporting sites etc. It provides the name of the corresponding sites whereever appropriate. This report also provides a big picture summary of how the various VOs have reported with respect to activity.
<hr color=blue>
</li>

<li>
Report name: <b>DailySiteReport</b>

Report category: Site report

Report invocation hierarchy:<br>
        daily_mail_cron.sh -> daily_mutt.sh -> daily -> AccountingReports.DailySiteReport<br>
        range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> range -> AccountingReports.DailySiteReport

Purpose of report:
        This report provides the summary of site based utilization of grid resources. This report contains the following information:

<pre>
----------------------------------------------------------------
 Site | # of Jobs | Wall Duration | Delta jobs | Delta duration
----------------------------------------------------------------
</pre>

The following is an explanation of the various columns. This is generally
applicable for any report that contains these fields

Wall Duration is expressed in hours and rounded to the nearest hour.
Wall Duration is the duration between the instant the job start running and
the instant the job ends its execution.
The number of jobs counted here includes only the jobs directly seen by batch
system and does not include the request sent directly to a pilot job.
The Wall Duration includes the total duration of the the pilot jobs.
Deltas are the differences with the previous day.
(nr) after a VO name indicates that the VO is not registered with OSG.

<hr color=blue>
</li>
<li>

Report name: <b>DailyVOReport</b>

Report category: VO report

Report invocation hierarchy:<br>
        daily_mail_cron.sh -> daily_mutt.sh -> daily -> AccountingReports.DailyVOReport<br>
        range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> range -> AccountingReports.DailyVOReport

Purpose of report:
        This report provides the summary of VO based utilization of grid resources. This report contains the following information:

<pre>
--------------------------------------------------------------
 VO | # of Jobs | Wall Duration | Delta jobs | Delta duration
--------------------------------------------------------------
</pre>

<hr color=blue>
</li>

<li>

Report name: <b>DailySiteVOReport</b>

Report category: Site report

Report invocation hierarchy:<br>
        daily_mail_cron.sh -> daily_mutt.sh -> daily -> AccountingReports.DailySiteVOReport<br>
        range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> range -> AccountingReports.DailySiteVOReport

Purpose of report:
        This report provides the summary of Site based utilization of grid
resources, grouped by VOs. This report contains the following information:

<pre>
----------------------------------------------------------------------
 Site | VO | # of Jobs | Wall Duration | Delta jobs | Delta duration
----------------------------------------------------------------------
</pre>

<hr color=blue>
</li>
<li>

Report name: <b>DailyVOSiteReport</b>

Report category: VO report

Report invocation hierarchy:<br>
        daily_mail_cron.sh -> daily_mutt.sh -> daily -> AccountingReports.DailyVOSiteReport<br>
        range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> range -> AccountingReports.DailyVOSiteReport

Purpose of report:
        This report provides the summary of VO based utilization of grid resources, grouped by Sites. This report contains the following information:

<pre>
---------------------------------------------------------------------
 VO | Site | # of Jobs | Wall Duration | Delta jobs | Delta duration
---------------------------------------------------------------------
</pre>

<hr color=blue>
</li>
</ul>
</li>
<li>
---++++New users on OSG

This report contains information about the users whose very first job finished on a OSG site on a given date or a date range specified. Below is a sample header as contained in the report. <a href=https://twiki.grid.iu.edu/bin/view/Accounting/newUsersOnOSG>Click here</a> to view a complete sample report. 

<pre>
The following users's CN very first's job on on the OSG site finished 
between 2010-05-02 - 2010-05-03 (midnight UTC - midnight UTC):
----------------------------------------------------------------------------------------------------
   | Site Name            | VO              | Probe Name                     | User                
----------------------------------------------------------------------------------------------------
</pre>

Report invocation hierarchy:<br>
        daily_mail_cron.sh -> daily_mutt.sh -> newUsers -> AccountingReports. NewUsers

This report could be received by subscribing to the <font color=blue>osg-accounting-info@fnal.gov</font> mailing list. 
</li>
<li>
---++++Job Success Rate by Site
This report provides a summary of the job success rate by site. Shown below is part of the report header. <a href=https://twiki.grid.iu.edu/bin/view/Accounting/jobSuccessRateBySite>Click here</a> to view a complete sample report. 

<pre>
--------------------------------------------------------------------------------------------------------------------
 Site | Wall Succ Rate | Wall Success | Wall Failed | Success Rate |    Success |     Failed
--------------------------------------------------------------------------------------------------------------------
</pre>

Here are the description of the header information:

Wall Success: Wall clock hours of successfully completed jobs<br>
Wall Failed: Wall clock hours of unsuccessfully completed jobs<br>
Wall Success Rate: Wall Success / (Wall Success + Wall Failed)<br>
Success: number of successfully completed jobs<br>
Failed: Number of unsuccessfully completed jobs<br>
Success Rate: number of successfull jobs / total number of jobs<br>

Report invocation hierarchy:<br>
        daily_mail_cron.sh -> daily_mutt.sh -> dailyStatus -> AccountingReports.GenericDailyStatus

This report could be received by subscribing to the <font color=blue>osg-accounting-info@fnal.gov</font> mailing list. 

</li>
<li>
---++++Job Success Rate by VO

This report provides a summary of the job success rate by VO. Shown below is part of the report header. <a href=https://twiki.grid.iu.edu/bin/view/Accounting/jobSuccessRateByVO>Click here</a> to view a complete sample report. 

<pre>
--------------------------------------------------------------------------------------------------------------------------------
VO                     | Wall Succ Rate | Wall Success | Wall Failed | Success Rate |    Success |     Failed
--------------------------------------------------------------------------------------------------------------------------------
</pre>

Here are the description of the header information:

Wall Success: Wall clock hours of successfully completed jobs<br>
Wall Failed: Wall clock hours of unsuccessfully completed jobs<br>
Wall Success Rate: Wall Success / (Wall Success + Wall Failed)<br>
Success: number of successfully completed jobs<br>
Failed: Number of unsuccessfully completed jobs<br>
Success Rate: number of successfull jobs / total number of jobs<br>

Report invocation hierarchy:<br>
        daily_mail_cron.sh -> daily_mutt.sh -> dailyStatus -> AccountingReports.GenericDailyStatus (need to give --groupby=VO option from command line)

This report could be received by subscribing to the <font color=blue>osg-accounting-info@fnal.gov</font> mailing list. 

</li>
<li>
---++++Job Success Rate by Site and VO

This report provides a summary of the job success rate by Site and VO. Shown below is part of the report header. <a href=https://twiki.grid.iu.edu/bin/view/Accounting/jobSuccessRateBySiteAndVO>Click here</a> to view a complete sample report. 

<pre>
----------------------------------------------------------------------------------------------------------------------------------------------------------
     | Site                   | VO                     | Wall Succ Rate | Wall Success | Wall Failed | Success Rate |    Success |     Failed
----------------------------------------------------------------------------------------------------------------------------------------------------------
</pre>

Here are the description of the header information:

Wall Success: Wall clock hours of successfully completed jobs<br>
Wall Failed: Wall clock hours of unsuccessfully completed jobs<br>
Wall Success Rate: Wall Success / (Wall Success + Wall Failed)<br>
Success: number of successfully completed jobs<br>
Failed: Number of unsuccessfully completed jobs<br>
Success Rate: number of successfull jobs / total number of jobs<br>

Report invocation hierarchy:<br>
        daily_mail_cron.sh -> daily_mutt.sh -> dailyStatus -> AccountingReports.GenericDailyStatus (need to give --groupby=BOTH option from command line)

This report could be received by subscribing to the <font color=blue>osg-accounting-info@fnal.gov</font> mailing list. 

</li>
<li>
---++++Data transfer report summary by site
This report provides the OSG Data transfer summary for a given date or date range  (midnight UTC - midnight UTC)
including all data that transferred in that time period. It also provides the deltas, which are the differences with the previous period. Below is part of the header for the report. <a href=https://twiki.grid.iu.edu/bin/view/Accounting/dataTransferReportSummaryBySite>Click here</a> to view a complete sample report. 

<pre>
--------------------------------------------------------------------------------------------------------------------------
 Site     | Protocol                  |    Num transfer |  Delta transfer |     Number of MiB |         Delta MiB
--------------------------------------------------------------------------------------------------------------------------
</pre>

It also provides other information like storage resources with no activity, non reporting storage resources and more. 

Report invocation hierarchy:<br>
        daily_mail_cron.sh -> daily_mutt.sh -> transfer ->  AccountingReports.DataTransferSumup

This report could be received by subscribing to the <font color=blue>osg-accounting-info@fnal.gov</font> mailing list. 

</li>
<li>
---++++Gratia Summary for VO: engage 
This report provides the summary of the job exit status for the engage VO, (midnight to midnight central time) for a given date or a date range including all jobs that finished in that time period.
For Condor the value used is taken from 'ExitCode' and NOT from 'Exit Status'

The report provides the following information as shown in the header below. <a href=https://twiki.grid.iu.edu/bin/view/Accounting/gratiaSummaryForEngageVO>Click here</a> to view a complete sample report. 
<pre>
------------------------------------------------------------------------------------------------------------------------------
 Site                   | Wall Succ Rate | Wall Success | Wall Failed | Success Rate |    Success |     Failed 
------------------------------------------------------------------------------------------------------------------------------
</pre>

This report also provides the 
OSG usage summary for  a given date or date range (midnight UTC - midnight UTC) for the engage VO, 
including all jobs that finished in that time period as shown in the header below:

<pre>
----------------------------------------------------------------------------------------------------------------------
 VO                     | User                                | # of Jobs | Wall Duration | Delta jobs | Delta duration
----------------------------------------------------------------------------------------------------------------------
</pre>

Report invocation hierarchy:<br>
        daily_mail_cron.sh -> daily_mutt.sh -> dailyForVO -> AccountingReports.GenericDailyStatus

This report could be received by subscribing to the <font color=blue>osg-accounting-info@fnal.gov</font> mailing list. 

</li>
<li>
---++++Gratia Summary for VO: osg
This report provides the summary of the job exit status for the osg VO, (midnight to midnight central time) for a given date or a date range including all jobs that finished in that time period.
For Condor the value used is taken from 'ExitCode' and NOT from 'Exit Status'

The report provides the following information as shown in the header below. <a href=https://twiki.grid.iu.edu/bin/view/Accounting/gratiaSummaryForOsgVO>Click here</a> to view a complete sample report. 
<pre>
------------------------------------------------------------------------------------------------------------------------------
 Site                   | Wall Succ Rate | Wall Success | Wall Failed | Success Rate |    Success |     Failed 
------------------------------------------------------------------------------------------------------------------------------
</pre>

This report also provides the 
OSG usage summary for  a given date or date range (midnight UTC - midnight UTC) for the osg VO, 
including all jobs that finished in that time period as shown in the header below:

<pre>
----------------------------------------------------------------------------------------------------------------------
 VO                     | User                                | # of Jobs | Wall Duration | Delta jobs | Delta duration
----------------------------------------------------------------------------------------------------------------------
</pre>


Report invocation hierarchy:<br>
        daily_mail_cron.sh -> daily_mutt.sh -> dailyForVO -> AccountingReports.GenericDailyStatus

This report could be received by subscribing to the <font color=blue>osg-accounting-info@fnal.gov</font> mailing list. 

</li>
<li>
---++++Report of jobs longer than 7 days

This report gives a summary of long running jobs that finished on a specified date or a in given date range.

Below is the sample header contained in the report. <a href=https://twiki.grid.iu.edu/bin/view/Accounting/jobsLongerThan7Days>Click here</a> to view a complete sample report. 
 
---------------------------------------------------------------------------------------
     | Site               | VO             | # of Jobs | Avg Wall | % Cpu | Max EndTime
---------------------------------------------------------------------------------------

Wall Duration is expressed in days to the nearest days.<br>
% Cpu is the percentage of the wall duration time where the cpu was used.<br>
Only jobs that last 7 days or longer are counted in this report.<br>

Report invocation hierarchy:<br>
	range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> longjobs -> AccountingReports.LongJobs

This report could be received by subscribing to the <font
color=blue>osg-accounting-info@fnal.gov</font> mailing list. 

</li>
<li>
---++++Summary on how sites are reporting to Gratia

This report indicates which sites Gratia has heard from or have known
activity.<br>

<a href=https://twiki.grid.iu.edu/bin/view/Accounting/summaryOnHowSitesAreReportingToGratia>Click here</a> to view a complete sample report. 

Report invocation hierarchy:<br>
	range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> reporting -> AccountingReports.NonReportingSites 

This report could be received by subscribing to the <font
color=blue>osg-accounting-info@fnal.gov</font> mailing list. 

</li>
<li>
---++++Report by user

This report provides the job summary information based on users under whose DN
the jobs ran. Below is the sample header for the report. <a
href=https://twiki.grid.iu.edu/bin/view/Accounting/summaryOnHowSitesAreReportingToGratia>Click
here</a> to view a complete sample report.

----------------------------------------------------------------------------------------------------------------------
     | VO                     | User                                | # of Jobs | Wall Duration | Delta jobs | Delta duration
----------------------------------------------------------------------------------------------------------------------

Wall Duration is expressed in hours and rounded to the nearest hour. Wall Duration is the duration between the instant the job started running and the instant the job ended its execution.  Deltas are the differences with the previous period.

Report invocation hierarchy:<br>
        range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> usersreport ->  AccountingReports.RangeUserReport

This report could be received by subscribing to the <font
color=blue>osg-accounting-info@fnal.gov</font> mailing list.

</li>
<li>
---++++OSG Efficiency by VO

This report provides a summary of the efficiency of the jobs that ran for a
particular VO grouped by the number of cores that these jobs ran on. The
efficiency is calculated in terms of the ratio of the Cpu to Wall duration.

Below is a sample header for the report. <a
href=https://twiki.grid.iu.edu/bin/view/Accounting/osgEfficiencyByVO>Click
here</a> to view a complete sample report. 

-------------------------------------------------------------------------------------------------------------
  #   | VO |   Cores |     Njobs |     Delta |      Wall | #   Delta | CpuToWall |     Delta | %Effi | Delta
--------------------------------------------------------------------------------------------------------------

Wall Duration (Wall) is expressed in hours and rounded to the nearest hour.
Wall Duration is the duration between the instant the job started running
and the instant the job ended its execution.
Deltas are the differences with the previous period.

Report invocation hierarchy:<br>
        range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> voefficiency -> AccountingReports.EfficiencyRange 

This report could be received by subscribing to the <font
color=blue>osg-accounting-info@fnal.gov</font> mailing list.

</li>
<li>
---++++OSG Efficiency by VO by time period

This report provides the OSG Efficiency by VO by time period i.e. efficiency
of jobs that finished for a particular VO grouped by the number of cores on
which the jobs ran. 

Below is a sample header for the report. <a
href=https://twiki.grid.iu.edu/bin/view/Accounting/osgEfficiencyByVOByTimePeriod>Click
here</a> to view a complete sample report. 

------------------------------------------------------------------------
  #   | VO             |     Cores |    1 Days |    7 Days |   30 Days 
------------------------------------------------------------------------

Wall Duration is expressed in hours and rounded to the nearest hour. Wall
Duration is the duration between the instant the job started running
and the instant the job ended its execution.
Cpu Duration is the sum for each core that participated to the job 
of the amount of time the core participated actively to the job.

Report invocation hierarchy:<br>
        range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> gradeefficiency -> AccountingReports.EfficiencyGraded 

This report could be received by subscribing to the <font
color=blue>osg-accounting-info@fnal.gov</font> mailing list.

</li>
<li>
---++++OSG Efficiency by Site and VO

This report provides the efficiency of finished jobs based on the site, vo and
number of cores. 

Below is a sample header for the report.  <a href=https://twiki.grid.iu.edu/bin/view/Accounting/osgEfficiencyBySiteAndVO>Click
here</a> to view a complete sample report. 

--------------------------------------------------------------------------------------------------------------------------------------------
 Site                   | VO              |     Cores |     Njobs | #   Delta |      Wall |      Delta | CpuToWall | Delta | %Effi | Delta
--------------------------------------------------------------------------------------------------------------------------------------------

Wall Duration (Wall) is expressed in hours and rounded to the nearest hour.
Wall
Duration is the duration between the instant the job started running
and the instant the job ended its execution.
Deltas are the differences with the previous period.

Report invocation hierarchy:<br>
        range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> efficiency -> AccountingReports.EfficiencyRange 

This report could be received by subscribing to the <font
color=blue>osg-accounting-info@fnal.gov</font> mailing list.

</li>
<li>
---++++VO discrepancy report 

This report provides information about VO discrepancy that occurs between the
VOs registered in the OSG Information Management (OIM) system and the VOs that
are being reported to gratia. This report categorizes the discrepancies into
different types. You can view more details by <a
href=https://twiki.grid.iu.edu/bin/view/Accounting/osgEfficiencyBySiteAndVO>viewing
</a> the sample report.

Report invocation hierarchy:<br>
        range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> compareVOs.py

This report could be received by subscribing to the <font
color=blue>osg-accounting-info@fnal.gov</font> mailing list.

</li>
<li>
---++++Report by user by site

This report provides information about the # of jobs that finished for a
particular user, the wall duration based on the VO and the Site the jobs ran
on. Below is a sample header of the report. <a
href=https://twiki.grid.iu.edu/bin/view/Accounting/reportByUserBySite>Click
here</a> to view a complete sample report. 

------------------------------------------------------------------------------------------------------------------------------
     | User                                | VO             | Site | # of Jobs | Wall Duration | Delta jobs | Delta duration
-------------------------------------------------------------------------------------------------------------------------------

Wall Duration is expressed in hours and rounded to the nearest hour. Wall
Duration is the duration between the instant the job started running
and the instant the job ended its execution.
Deltas are the differences with the previous period.

Report invocation hierarchy:<br>
        range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> usersitereport ->  AccountingReports.RangeSiteUserReport

This report could be received by subscribing to the <font
color=blue>osg-accounting-info@fnal.gov</font> mailing list.

</li>
<li>
---++++OSG Installed Probe Versions

This reports list the current version of the Gratia probe(s) installed and
reporting at each site. Only sites registered in OIM are listed.
Below is a sample header for the report. <a
href=https://twiki.grid.iu.edu/bin/view/Accounting/osgInstalledProbeVersions>Click
here</a> to view a complete sample report.

------------------------------------------------------------------------------------
 Site                 | Software         | Release      | Last Contact | Probe name
------------------------------------------------------------------------------------

Report invocation hierarchy:<br>
        range_mail_cron.sh -> range_mutt.sh -> range_mutt_nightly.sh -> softwareVersions -> AccountingReports.SoftwareVersion

This report could be received by subscribing to the <font
color=blue>osg-accounting-info@fnal.gov</font> mailing list.

</li>
</li>
</ol>

---+++Perl reports
---++++All site metrics OIM report 

This report consists of 


-- Main.KarthikArun - 21 Apr 2010
