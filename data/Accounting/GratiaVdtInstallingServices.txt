%META:TOPICINFO{author="KyleGross" date="1225985922" format="1.1" version="1.5"}%
<!--
   * Set VIEWTHISTOPIC = <div class="twikiSmall"><a href="%TOPIC%">View this section</a></div>
-->


---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*

%TOC%

%STARTINCLUDE%
<!-- 
   * Set OSG_DOC_REFERENCES = Integration/ITB090
   * Set GRATIA_CACHE  = http://vdt.cs.wisc.edu/vdt/vdt_1100_cache
   * Set GRATIA_PACKAGE = Gratia-Reporting

   * Set EDITTHISTEXT = <div class="twikiSmall"><a href="%TOPIC%">edit this section</a></div>
-->
%BR%
---+ Installing Gratia services from VDT

%BR%

---++ Installation user
Must be done as root.

---++ Installation package
Pacman is the tool used for the installation.  If you are not familiar with it please refer to the [[%OSG_DOC_REFERENCES%/PacmanInstall][OSG Pacman Install Guide]]

%INCLUDE{GratiaCertificates}%

---++ Installation location
Wherever you like.  Shown below as  directory =/usr/local/gratia=.  Then set the VDT_LOCATION variable to that directory.
   * cd /usr/local
   * mkdir gratia
   * export VDT_LOCATION=/usr/local/gratia

---++ Reusing Configuration Information
If you are doing a major update (from one VDT version to another, but not a minor update, such as VDT 1.10.0a to VDT 1.10.0b), you can automatically reuse some of the configuration information from the old version in your new installation.  Instructions for this can be found in the [[%OSG_DOC_REFERENCES%/ReusingConfigurationInformation][OSG documentation topic on Reusing Configuration Information]]


---++ Installation Cache
To install Gratia:
   * cd $VDT_LOCATION
   * pacman -get  %GRATIA_CACHE%:%GRATIA_PACKAGE%


---++ Installation output/questions
Some of the questions related to 'trusted caches' and 'unrecognized platforms' may not appear depending on your host and any =pacman= variables already set in your environment.

<pre class="screen">
Do you want to add [http://software.grid.iu.edu/pacman/] to [trusted.caches]? (y or n): <b> y </b>

Do you want to add [http://vdt.cs.wisc.edu/vdt_1100_cache] to [trusted.caches]? (y or n): <b>y</b>

...


VDT 1.10.0 installs a variety of software, each with its own license.
In order to continue, you must agree to the licenses.
You can view the licenses online at:

     http://vdt.cs.wisc.edu/licenses/1.10.0

After the installation has completed, you will also be able to
view the licenses in the "licenses" directory.

Do you agree to the licenses? [y/n]  <b>y</b>
---------------------

...
Downloading [Gratia-Services-1.10.0.tar.gz] from [http://vdt.cs.wisc.edu/software/questions/1.10.0]...
Downloading [configure_gratia-1-295.tar.gz] from [http://vdt.cs.wisc.edu/software//configure_gratia/1]...
Downloading [gratia-services-0.32.1.tar.gz] from [http://vdt.cs.wisc.edu/software//gratia/gratia-services/0.32.1]...
Downloading [gratia-reporting-0.32.1.tar.gz] from [http://vdt.cs.wisc.edu/software//gratia/gratia-reporting/0.32.1]...
</pre>

The above line should be the last line of output you see.  


---++ Verify the  installation completed successfully
To verify  the VirtualOrganizations/VOInfoMS installation was successful, there should be a setup.(c)sh in the VDT_LOCATION.  Source it.
   * cd $VDT_LOCATION
   * source setup.sh

This does not necessarily indicate that everything was installed and configured successfully.  It just verifies that the =pacman= installation of Gratia completed successfully.  There is a lot of other "magic" that occurs during the process that should be validated. We'll take you through that process.

---++ Starting Gratia
To start up Gratia services and reporting:
<pre class="screen">
# cd $VDT_LOCATION
# source setup.sh
# vdt-control --on
enabling cron service fetch-crl... ok
enabling cron service vdt-rotate-logs... ok
enabling cron service vdt-update-certs... ok
enabling init service mysql5... ok
skipping init service 'mysql' -- marked as disabled
enabling init service apache... ok
enabling init service tomcat-55... ok
enabling cron service gratia-reports... ok
</pre>

---++ Verifying your Gratia reporting and administration web services
To verify your installation of the Gratia web services was good, you can access the following urls and see if they render.  Remember that, at this time, you will have no accounting data to view so keep you expectations low.  You just want to verify the installation.  Start up the Gratia services as described in the =Starting Gratia= section above.

For open access:
   * http://&lt;YOUR_HOST&gt;:8880/gratia-administration
   * http://&lt;YOUR_HOST&gt;:8880/gratia-reporting

For secure (ssl) access:
   * https://&lt;YOUR_HOST&gt;:8443/gratia-administration
   * https://&lt;YOUR_HOST&gt;:8443/gratia-reporting

---++ Shutting down Gratia
To shut down Gratia services and reporting:
<pre class="screen">
# cd $VDT_LOCATION
# source setup.sh
# vdt-control --off
disabling cron service gratia-reports... ok
disabling init service tomcat-55... ok
disabling init service apache... ok
disabling init service mysql... ok
disabling init service mysql5... ok
disabling cron service vdt-update-certs... ok
disabling cron service vdt-rotate-logs... ok
disabling cron service fetch-crl... ok
</pre>

%INCLUDE{"GratiaConfigurationGuide"}%

%STOPINCLUDE%



-- Main.JohnWeigand - 24 Apr 2008
