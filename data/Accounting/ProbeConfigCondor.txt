%META:TOPICINFO{author="ChrisGreen" date="1166479818" format="1.1" reprev="1.9" version="1.9"}%
%META:TOPICPARENT{name="ProbeInstallation"}%
---+OSG Gratia probe configuration: Condor
<OL>
<LI />[[ProbeInstallation][Install]] the software using pacman or RPM.

<UL><LI />%RED%NOTE%ENDCOLOR% Because of the complicated nature of the interaction between the jobmanagers and probe, the assumption is made that Gratia is installed directly into =$VDT_LOCATION=. If this is not the case, then you should link the gratia directory into =$VDT_LOCATION=: it is assumed by the jobmanager that interim Gratia data files it produces go in to =$VDT_LOCATION/gratia/var/data=, and the entry for =DataFolder= in the Gratia =ProbeConfig= file should reflect that fact.
</UL>

#ProbeConfig<LI />Customize the Gratia =ProbeConfig= file. The following variables (at least)
should have appropriate values:

| *Gratia Configuration Variable=&quot;Default&quot;* | *Set value information* |
| !MeterName = &quot;generic&quot; | This value will be entered in the database to indicate where the record came from.<br />We recommend a =batchsystem:FQDN= such as "condor:fermigrid1.fnal.gov". |
| !SiteName = &quot;Generic Site&quot; | This value is used in the report to refer to the site/farm/cluster to which the head node gives access. |
| !VDTSetupFile = &quot;<tt>MAGIC_VDT_LOCATION</vdt>/setup.sh&quot; |Path to the VDT =setup.sh= file. Please expand =MAGIC_VDT_LOCATION=. |

<LI />The RPM install procedure makes appropriate entries in root's crontab
for uploading accounting information to gratia at the appropriate
time. The time is appropriately randomized. 

If you have installed the Condor probe via pacman and this hasn't been done for you already, insert a suitable line into root's crontab:

<verbatim>
2-59/15 * * * * "/opt/vdt/gratia/probe/condor/condor_meter.cron.sh" > "/opt/vdt/gratia/var/logs/gratia-probe-condor.log" 2>&1
</verbatim>

#GratiaCondorGramPatch<LI>Under the directory =gratia/condor-probes/gram_mods= there are two
files that contain some required changes to the GRAM jobmanager scripts. These patches change =$VDT_LOCATION/globus/lib/perl/Globus/GRAM/JobManager/condor.pm= and =$VDT_LOCATION/globus/lib/perl/Globus/GRAM/JobManager/managedfork.pm=

The RPM installation will attempt to check for these patches if installed under =$VDT_LOCATION=: if they are not found you will be warned.

<OL>
#GratiaCondorGramPatchPacman<LI />VDT-1.3.10 (part of OSG 0.4.1) has a pacman patch Gratia-Patch(install with pacman -get Gratia-Patch); OR:

#GratiaCondorGramPatchManual<LI />You may apply the patches yourself:

<verbatim>
cd $VDT_LOCATION/globus/lib/perl/Globus/GRAM/JobManager
patch --verbose -p0 < <gratia-dir>/probe/condor/gram_mods/condor.pm.diff
patch --verbose -p0 < <gratia-dir>/probe/condor/gram_mods/managedfork.pm.diff
</verbatim>

If these commands fail it is likely to be because either the version of VDT you have or a previous RPM install has already applied the patches.
</OL>

<LI />The SOAPHost has been preconfigured to use the official OSG Gratia
collector (or the official ITB Gratia if you installed the ITB RPMs).

</OL>

-- Main.ChrisGreen - 15 Dec 2006

