%META:TOPICINFO{author="PhilippeCanal" date="1228317941" format="1.1" version="1.140"}%
<table width="100%" border="0"> <tbody><tr><td valign="top"> </td> <td valign="top">
---+!! Gratia
%TOC% </td> <td width="25%" align="right" valign="top">
%TABLE{ sort="off" dataalign="left" tableborder="0" cellpadding="1" cellspacing="3" headerbg="#F3EDE7" databg="#F3EDE7"}% </td></tr></tbody></table> 
%STARTINCLUDE%

---++ Gratia Accounting Reports for OSG and Fermilab

Reports can be viewed at several places depending on the type of data being collected:

   * [[http://gratia-osg.fnal.gov:8880/gratia-reporting/][Production OSG sites]] 
   * [[http://gratia-osg.fnal.gov:8884/gratia-reporting/][OSG daily summaries (legacy)]] 
   * [[http://gratia-osg.fnal.gov:8881/gratia-reporting/][ITB and testing]] 
   * [[http://gratia-fermi.fnal.gov:8882/gratia-reporting/][Fermilab's PS-accounting information (Fermi-specific)]] 
   * [[http://gratia-fermi.fnal.gov:8883/gratia-reporting/][Fermilab's LQCD batch system (non-OSG)]] 

These reports are implemented using the open source Business Intelligence and Reporting Tools - [[http://www.eclipse.org/birt/][BIRT]].

For a more detailed description on the type and use of the reports please refer to GratiaReportGuide

---++ Short Description

The Gratia Project (contributed as an OSG Activity) designs and deploys robust, scalable, trustable and dependable grid accounting, publishes an interface to the services and provides a reference implementation.

---++ Introduction and Overview

The Grid Accounting Activity is designing and deploying robust, scalable, trustable and dependable grid accounting services, publishing an interface to the services and providing a reference implementation.

The Gratia system consists of many probes operating on and uploading data from remote locations to a network of one or more collector-reporting systems. These data could be regarding batch jobs, grid transfers, storage allocation, site availability tests or processing acconting (at current survey).

The primary focus of the Gratia system is however to providing an accounting of [[Definition of an OSG Job][OSG jobs]].

More information on the data collection philosophy, technical details and algorithms used by the various probes, the common probe infrastructure and the collector may be found in the [[GratiaDataCollectionNotes][Data Collection Notes]] section.

---+++ Contact information and mailing lists

   * The project lead is [[mailto:pcanal@fnal.gov][Philippe Canal]]. 
%INCLUDE{"ContactUs"}%

---+++ Meetings

The Gratia team meets weekly on Wednesday at 1:30pm CST. To Join call 510-665-5437 and use the meeting ID: 2966.

See [[MeetingMinutes][Meeting Minutes]]

---+++ Metrics

See [[Metrics][the Metrics page]].

---++ Goals

The main goal of the Grid Accounting Joint Project, which is additionally being contributed as an OSG Activity, is to provide the stakeholders with a reliable and accurate set of views of the Grid resources usage.

The Grid Accounting Project:

   * has designed the schema for the accounting attributes, 
   * is ensuring the necessary collectors and sensors are in place in the resource providers, 
   * has defined and is deploying repository and access tools for the reporting and analysis of the grid wide accounting information. 

The Accounting system will properly determine a confidence level in the existing accounting information and adequately address and present erroneous or missing accounting data.

The Accounting system will adequately protect the privacy of the users and organizations involved.

The initial main goal for the accounting system will be to track VirtualOrganizations/VOInfo members' resource usage and to present that information in a consistent Grid-wide view, focusing in particular on CPU and Disk Storage utilization.

[[https://twiki.grid.iu.edu/twiki/bin/viewfile/Accounting/WebHome?filename=AccountingProjectDefinition1.doc][Full Project Definition]]

See the current [[ListOfPriorities][list of priorites]] and the current [[ListOfRequests][list of enhancement requests]]

---++ Monitoring vs Accounting
For monitoring,the goal is to have a view of the current status of the system with minimal delay. Small numerical errors, approximation and statistical estimation in the data are not fatal for monitoring. 
For example if a CPU is utilized at 82% or 85% does not matter to the monitoring system. 
For monitoring, missing informatio is not really an issue. 
For example, the measurement of the cpu load is not really affected if we are missing a few samples.

For accounting, the goal is to have an accurate view of the resource and service usage in the system. This includes linking them to the individual user request. The accounting should not loss any accounting data or record. The main focus is on the historical view and a delay in the information is acceptable. However the information need to be as accurate as possible, and include an estimate of its accuracy. The accounting system need to be able to support the development of an economic mode.

The type of information and the means of collecting this information are similar between monitoring and accounting but the choices of trade-offs are clearly different; for example timeliness vs. accuracy and completeness.

---++ Installation

---+++ Probes

Installation of probes may vary by probe, but in general should be done via VDT if available. Please see the [[ProbeInstallation][probe installation topic]] for full instructions and further notes.

---+++ Collector and Reporting
---++++ VDT Installation Instructions
 Intended for remote/local collectors that are installed from the VDT pacman cache. 
   * [[GratiaVdtInstallingServices][VDT Installation Instruction]] 

---++++ VDT Packaging and Installation Instructions
 Intended to be used only by the VDT team for packaging the Gratia services 
   * [[InstallationGuideVDT][VDT-team Gratia service installation guide]] 

---++++ Local FNAL-specific installation guide
 Intended solely for local installation here at FNAL with multiple collectors. 
   * [[InstallationGuideFNAL][Local FNAL-specific installation guide]] 

---++ Requirements

We presented a summary of the Accounting System requirement in July 2005 in Milwaukee. [[http://osg-docdb.opensciencegrid.org/cgi-bin/ShowDocument?docid=205&version=1][OSG Accounting Requirements Presentation]] We also presented a general overview of the design ([[http://osg-docdb.opensciencegrid.org/cgi-bin/ShowDocument?docid=205&version=1][See the same link]]).

---+++ Reporting Requirements

Summary of the ReportRequirements that have been outlined in the above documents.

---+++ Operational Requirements

See the discussions and documents in OperationalRequirements.

---+++ Gratia Login/Access Requirements
 Access to Gratia administration and reporting features and view are defined in the [[GratiaAccessLoginSpecification][Gratia Login/Access Specification document]].

---++ Implementation (developers' corner)

---+++ Specifications

[[https://twiki.grid.iu.edu/twiki/bin/viewfile/Accounting/WebHome?filename=PSACCTProbeDesignSpecification.doc][PSACCT Probe Design Specification]]

[[https://twiki.grid.iu.edu/twiki/bin/viewfile/Accounting/WebHome?filename=GratiaCollectorWebServiceDevelopment.doc][Gratia Collector Web Service Development, Deployment and Integration]]

[[https://twiki.grid.iu.edu/twiki/bin/viewfile/Accounting/WebHome?filename=CPUUsageAccounting.doc][CPU Usage Accounting]]

[[https://twiki.grid.iu.edu/twiki/bin/viewfile/Accounting/WebHome?filename=GratiaReportingDesignSpecification.doc][Current Gratia Reporting Design Specification]]

[[https://twiki.grid.iu.edu/twiki/bin/viewfile/Accounting/WebHome?filename=GratiaReportDevelopment.doc][Current Gratia Report Development, Deployment and Integration]]

[[https://twiki.grid.iu.edu/twiki/bin/viewfile/Accounting/WebHome?filename=GratiaReportingUpgradeImplementationPlan.doc][Proposed Gratia Reporting Infrastructure Upgrade Implementation Plan]]

---+++ Entity Relationship Diagrams (ERD)
 The ERD (Entity Relationship Diagram) for the Gratia database can be see in the formats listed below. It should be noted that it is not a "complete" picture of all the relationships. Many of the foreign key relationships were deliberately left off in order to simplify the diagram. The intent is to show the main parent/child relationships only. 
   * [[%ATTACHURL%/gratia-v100.png][Gratia v1.00 database ERD (png)]] 
   * [[%ATTACHURL%/gratia-v038.png][Gratia v0.38 database ERD (png)]] 
   * [[%ATTACHURL%/gratia-v036.png][Gratia v0.36 database ERD (png)]] 
   * [[%ATTACHURL%/gratia-v034.png][Gratia v0.34 database ERD (png)]] 
   * [[%ATTACHURL%/gratia.png][Gratia v0.30 database ERD (png)]]    

The software used to maintain the ERD diagram is called _DeZign for Databases Professional Version 4.2.0_ from Datanamic Solutions BV (http://www.datanamic.com). The source file for the various versions is in the Gratia CVS repository in _./gratia/docs/erd_ :
   * Gratia database ERD v100 source: gratia-v100.dez 
   * Gratia database ERD v038 source: gratia-v038.dez 
   * Gratia database ERD v036 source: gratia-v036.dez 
   * Gratia database ERD v034 source: gratia-v034.dez 
   * Gratia database ERD v030 source: gratia-v030.dez 
   * Gratia database ERD v028 source: gratia-v028.dez 

---+++ Development and Test Environment
 A description of the development and test environment can be found in the [[GratiaDevAndTestEnviron][Gratia Development and Test Environment]] page.

---+++ Production database conversion procedure from !MyISAM to !INNODB
 The latest version of the database conversion procedure may be found [[INNODBConversionProcedure][here]]; the original draft may be seen [[%SCRIPTURLPATH{"view"}%/Accounting/INNODBConversionProcedure?rev=1][here]].

---+++ Other internal documents

[[CaseForInnoDB][The case for InnoDB]] ( _in progress_).

---+++ [[ReqNotes042008][Notes on the OSG Requirement documents]]

---+++ WBS

A draft of the [[%ATTACHURL%/wbs-2008.pdf][WBS]] is available.

---++ Production Releases
 A [[GratiaReleaseTemplate][Gratia Release twiki template]] has been created that can be used as the basis for documenting production releases. You can cut/paste from it into a new twiki release document and add specifics for that release. Please do not change the template unless some general release changes are made that are not unique to a release. 
---+++ [[GratiaBuildNewRelease][Building a new release for distribution]]

---+++ [[GratiaUpgradeProcedure][Gratia Upgrade Procedure]] - under construction
---+++ [[GratiaReleaseV0dot28][Gratia Release v0.28 - 10/27/2007]]
---+++ [[GratiaReleaseV0dot30][Gratia Release v0.30 - 11/20/2007]]
---+++ [[GratiaReleaseV0dot32][Gratia Release v0.32 - 2/1/2008]]
---+++ [[GratiaReleaseInnodb][Gratia Release v0.32.1 InnoDB - 2/14/2008 -4/2/2008]]
---+++ [[GratiaReleaseV0dot32dot1c][Gratia Release v0.32.1c - 3/31/2008 - 4/1/2008]]
---+++ [[GratiaReleaseV0dot34][Gratia Release v0.34 / v0.34.9 - 5/10/2008 - 6/29/2008]]
---+++ [[GratiaReleaseV0dot36][Gratia Release v0.36 - 07/15/2008]]
---+++ [[GratiaReleaseV0dot38][Gratia Release v0.38 - 09/16/2008]]
---+++ [[GratiaReleaseV1dot00][Gratia Release v1.00 - 10/20/2008]]

[[GratiaReleaseV1dot02][Gratia Release v1.02 - Early 2009]]

[[GratiaReleaseV1dot04][Gratia Release v1.04 - not scheduled]]

---++ Gratia Service Operation

All information required to install and operate the official OSG Gratia services may be found through the [[GratiaServiceOperationGuide][Gratia Service Operation Guide page]].

---++ Interfaces
---+++ APEL-WLCG
 [[GratiaInterfacesApelLcg][APEL-WLCG Interface]]

[[GratiaInterfacesApelLcgNotes][Revisions APEL-WLCG Interface]] (a work-in-progress 5/1/2008)

---++ Code Documentations

   * [[ProbeDevelopement][How to write a Gratia probe.]] 
   * [[ProbeBlackOutDetection][Issue related to detecting a probe black-out (missing information).]] 

---++ Readiness Plan for OSG 0.6

See AccountingReadinessPlan

---++ References and Resources

[[http://osg-docdb.opensciencegrid.org/cgi-bin/RetrieveFile?docid=130&extension=doc][OSG Accounting Requirements]]

[[https://forge.gridforum.org/projects/ur-wg][Global Grid Forum Usage Record Working Group]]

[[http://www.psc.edu/~lfm/PSC/Grid/UR-WG][XML Usage Record definition from GGF]]

GENERAL
   * Barry Varley, Usage Accounting in Distributed Stystems, for presentation at IEE Colloquium on Network Management, 4th October 1991 
   * B. Aboba, J. Arkko, D. Harrington, Introduction to Accounting Management, RFC 2975, October 2000 

GLUE SCHEMA
   * http://glueschema.forge.cnaf.infn.it/ 

AUSTRALIAN GRID
   * Rajkumar Buyya and David Abramson and Jonathan Giddy. A Case for Economy Grid Architecture for Service Oriented Grid Computing. 10th IEEE International Heterogeneous Computing Workshop 2001 
   * A. Barmouta and R. Buyya, !GridBank: A Grid Accounting Services Architecture (GASA) for Distributed Systems Sharing and Integration, 26th Australian Computer Science Conference (ACSC2003) Adelaide, Australia Feb 2003. 

NORDUGRID & SWEGRID
   * Peter Garfjall, Accounting in Grid Environments, an architectural proposal and a prototype implementation, Master Thesis, 27 May 2004, Umea University, Sweden. 
   * T. Sandholm, P. Gardfjell, E. Elmroth, L. Johnsson, and O. Mulmo. An OGSA-Based Accounting System for Allocation Enforcement across HPC Centers. Proceedings of the 2nd International Conference on Service Oriented Computing. New York, USA, 15-19 November, 2004. http://www.icsoc.org 
   * E. Elmroth, P. Gardfjell, O. Mulmo, and T.Sandholm. An OGSA-Based Bank Service for Grid Accounting Systems. In J. Wasniewksi et. al. (eds). Applied Parallel Computing. State-of-the-art in Scientific Computing. Springer Verlag, Lecture Notes in Computer Science, 2004. http://www.imm.dtu.dk/~jw/para04/ 
   * http://www.sgas.se 

EGEE and gLITE
   * APEL 
      * http://goc.grid-support.ac.uk/gridsite/accounting/ 
   * DGAS 
      * http://server11.infn.it/workload-grid/docs/DataGrid-01-TED-0126-1_0.pdf 
      * http://www.to.infn.it/grid/accounting 

TERAGRID
   * http://www.teragrid.org/userinfo/access/usage.php 

FACILITY GROUP REVIEW REPORT
   * The OSG Facility Group is reviewing the daily reports produced by Gratia. GratiaReportReviewPage 

_Reviewed by [[Main.MarciaTeckenbrock][Marcia Teckenbrock]] - 03 Jan 2007_
   * _Add definition of Gratia_ 
   * _Meetings schedules and minutes_ 

-- Main.ChrisGreen - 19 Sep 2007

 


%META:FILEATTACHMENT{name="gratia-v034.png" attr="" autoattached="1" comment="Gratia v0.34 ERD (Entity Relationship Diagram)" date="1213131050" path="gratia-v034.png" size="239338" user="Main.JohnWeigand" version="1"}%
%META:FILEATTACHMENT{name="GratiaReportDevelopment.doc" attr="" autoattached="1" comment="Gratia Report Development, Deployment and Integration" date="1144871795" path="GratiaReportDevelopment.doc" size="79360" user="TimByrne" version="1.1"}%
%META:FILEATTACHMENT{name="gratia.png" attr="" autoattached="1" comment="Gratia database ERD (png)" date="1195675709" path="gratia.png" size="231511" user="Main.JohnWeigand" version="9"}%
%META:FILEATTACHMENT{name="BIRTReportDevelopment.doc" attr="" autoattached="1" comment="BIRT Report Development" date="1144354055" path="BIRTReportDevelopment.doc" size="65024" user="TimByrne" version="1.1"}%
%META:FILEATTACHMENT{name="GratiaCollectorWebServiceDevelopment.doc" attr="" autoattached="1" comment="Gratia Collector Web Service Development" date="1145901125" path="GratiaCollectorWebServiceDevelopment.doc" size="125440" user="TimByrne" version="1.4"}%
%META:FILEATTACHMENT{name="AccountingProjectDefinition1.doc" attr="" autoattached="1" comment="" date="1118713623" path="AccountingProjectDefinition1.doc" size="2808320" user="PhilippeCanal" version="1.1"}%
%META:FILEATTACHMENT{name="wbs-2008.pdf" attr="" autoattached="1" comment="draft wbs" date="1206274905" path="wbs-2008.pdf" size="5701108" user="Main.PhilippeCanal" version="1"}%
%META:FILEATTACHMENT{name="PSACCTProbeDesignSpecification.doc" attr="" autoattached="1" comment="PSACCT Probe Design Specification" date="1145655357" path="PSACCTProbeDesignSpecification.doc" size="185344" user="TimByrne" version="1.2"}%
%META:FILEATTACHMENT{name="CPUUsageAccounting.doc" attr="" autoattached="1" comment="CPU Usage Accounting" date="1144354036" path="CPUUsageAccounting.doc" size="242176" user="TimByrne" version="1.1"}%
%META:FILEATTACHMENT{name="AccountingOSG-EB-12-07.ppt" attr="" autoattached="1" comment="" date="1165860688" path="AccountingOSG-EB-12-07.ppt" size="39936" user="Main.PhilippeCanal" version="2"}%
%META:FILEATTACHMENT{name="GratiaReportingDesignSpecification.doc" attr="" autoattached="1" comment="Gratia Reporting Design Specification" date="1144353988" path="GratiaReportingDesignSpecification.doc" size="93184" user="TimByrne" version="1.1"}%
%META:FILEATTACHMENT{name="GratiaReportingUpgradeImplementationPlan.doc" attr="" autoattached="1" comment="Gratia Reporting Infrastructure (BIRT) Upgrade Implementation Plan - April 2007" date="1177685006" path="GratiaReportingUpgradeImplementationPlan.doc" size="54784" user="Main.PenelopeConstanta" version="1"}%
%META:FILEATTACHMENT{name="gratia-v036.png" attachment="gratia-v036.png" attr="" comment="Gratia v0.36 ERD (Entity Relationship Diagram)" date="1216653496" path="gratia-v036.png" size="246219" stream="gratia-v036.png" tmpFilename="/usr/tmp/CGItemp2757" user="JohnWeigand" version="1"}%
%META:FILEATTACHMENT{name="gratia-v038.png" attachment="gratia-v038.png" attr="" comment="Gratia v0.38 ERD (Entity Relationship Diagram)" date="1220030069" path="gratia-v038.png" size="263752" stream="gratia-v038.png" tmpFilename="/usr/tmp/CGItemp2674" user="JohnWeigand" version="1"}%
%META:FILEATTACHMENT{name="gratia-v100.png" attachment="gratia-v100.png" attr="" comment="Gratia V1.0 ERD" date="1224697669" path="gratia-v100.png" size="259552" stream="gratia-v100.png" tmpFilename="/usr/tmp/CGItemp60824" user="JohnWeigand" version="1"}%
