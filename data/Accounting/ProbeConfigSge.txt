%META:TOPICINFO{author="ChrisGreen" date="1183499519" format="1.1" version="1.4"}%
%META:TOPICPARENT{name="ProbeInstallation"}%
---+OSG Gratia probe configuration: SGE
<ol>
<li>[[ProbeInstallation][Install]] the software using pacman or RPM.</li>

#ProbeConfig<li>Customize the Gratia =ProbeConfig= file. The following variables (at least)
should have appropriate values:

| *Gratia Configuration Variable=&quot;Default&quot;* | *Set value information* |
| !MeterName = &quot;generic&quot; | This value will be entered in the database to indicate where the record came from.<br />We recommend a =batchsystem:FQDN= such as "sge:fermigrid1.fnal.gov". |
| !SiteName = &quot;Generic Site&quot; | This value is used in the report to refer to the site/farm/cluster to which the head node gives access. |
| !VDTSetupFile = &quot;<tt>MAGIC_VDT_LOCATION</tt>/setup.sh&quot; |Path to the VDT =setup.sh= file. Please expand =MAGIC_VDT_LOCATION=. |
| !UserVOMapFile = &quot;<tt>MAGIC_VDT_LOCATION<tt>/monitoring/grid3-user-vo-map.txt&quot; |Path to the VDT =grid3-user-vo-map.txt= (or =osg-user-vo-map.txt=) file. Please expand =MAGIC_VDT_LOCATION=. |
| !SGEAccountingFile = &quot;&quot; | This is the location of the SGE accounting file. If not set, the probe will look for =$SGE_ROOT/default/common/accounting=. |
| !EnableProbe = &quot;1&quot; | If present, this attribute must be set to one to enable probe reporting. |
</li>

<li>The SGE Probe assumes a single SGE accounting file for processing records.

If the accounting file needs to be moved or rotated, you will need to make sure to do
the following:
<ul>
<li>Disable the SGE Probe, if there is a chance it will run during the steps below.</li>
<li>Move or Rotate the accounting file.</li>
<li>Run sge.py against the old (moved) accounting file:
<pre>sge.py -c -a $ACCOUNTING_FILE</pre>
(Omit the =-c= if you do not use checkpointing. This will report all records to Gratia, instead of records after the last checkpoint).
</li>
<li>Delete with checkpoint file (which resets the checkpoint)
<pre>rm MAGIC_VDT_LOCATION/gratia/var/tmp/checkpoint</pre>
</li>
<li>Continue running the SGE probe as before. It will now run against the new SGE accounting file.</li>
</ul>
</li>

<li>The pacman and RPM install procedures make appropriate entries in =/etc/cron.d=
for uploading accounting information to gratia at the appropriate
time; this time is randomized.</li>

<li>The SOAPHost has been pre-configured to use the official OSG Gratia
collector (or the official ITB Gratia if you installed the ITB RPMs); please verify this configuration before enabling the probe.</li>

</ol>

-- Main.ChrisGreen - 08 Jun 2007