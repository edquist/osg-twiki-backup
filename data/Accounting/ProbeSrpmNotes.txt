%META:TOPICINFO{author="ChrisGreen" date="1227197611" format="1.1" version="1.4"}%
%META:TOPICPARENT{name="ProbeInstallation"}%
---++OSG Accounting Services - Gratia - Rebuilding from source RPM.

If you wish to re-build from the source RPM (say for a particular architecture or software environment or with a different default base prefix to obviate the need for the =--relocate= option), then:

<ol>
<li>Optionally set a non-root build area for your RPMS by building a replica tree of =/usr/src/redhat= in your own area and creating a file =~/.rpmmacros= that contains the line:
<pre>
%_topdir &lt;my-rpmbuild-dir&gt;
</pre></li>

<li>The following macro definitions may be used on the =rpmbuild= command line:
      $ <tt>--define='config_itb 1'</tt>: =ProbeConfig= files for new installs will have defaults suitable for ITB nodes.
      $ <tt>--define='vdt_loc /usr/local/vdt'</tt>: Specify a different location for the VDT install.
      $ <tt>--define='default_prefix /usr/local/vdt/gratia'</tt>: Specify a different location for the gratia installation (not necessary if <tt>default_prefix = %{vdt_loc}/gratia</tt>).
      $ <tt>--define='site_name &lt;pretty-site-name&gt;'</tt>: Specify a particular site name rather than picking from VDT configuration or leaving generic.
      $ <tt>--define='meter_name &lt;meter-name&gt;'</tt>: Specify a particular probe name rather than building from =uname -n= (most appropriate for the ps-accounting probe which needs to be installed on all worker nodes).
      $ <tt>--detine='python python'</tt>: Pick up python from the path and remove the requirement on the version number of the system's python RPM; OR
      $ <tt>--define='python /my/path/to/python'</tt>: Hard-code a python path into the RPM.
</li>
 
<li>%RED%<strong>Two</strong>%ENDCOLOR% build commands are required: one for the non-architecture-specific RPMS, and one for the local architecture. A suitable composite command could be:
<verbatim>
for arch_arg in "" "--target=noarch"; do
  rpmbuild <defines>; $arch_arg --rebuild <src-rpm>
done
</verbatim>
Note that upgrades leave existing configuration files untouched.
</li>
</ol>



-- Main.ChrisGreen - 20 Nov 2008