%META:TOPICINFO{author="JohnWeigand" date="1204044111" format="1.1" reprev="1.5" version="1.5"}%
<!--
   * Set check =  <img src="/pub/TWiki/TWikiDocGraphics/choice-yes.gif" alt="DONE" title="DONE" width="16" height="16" border="0" /> 
-->
---+!! Gratia Access/Login Specification 

%TOC%

%STARTINCLUDE%
---+ Overview
This document is intended to serve as both a requirements and design specification for limiting access and visibility into the two web service user interfaces of Gratia: 
   * administration services
   * reporting services


---+ gratia-administration
The Gratia administration is accessible as http(s)://&lt;node.domain&gt;:&lt;port&gt;/gratia-administration.  It allows for viewing the status of the collector and for maintenance of several data tables.

---++ administration access requirements
The Gratia administration web user interface login will allow access to all update service menu options, otherwise only the status (read-only) menu options will be available. 

%TABLE{ tableborder="1" cellpadding="0" cellspacing="1" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF"}%
%EDITTABLE{  header="|*Menu option*|*No login required*|*Login required*|" format="| textarea, 5x30 | textarea, 5x50 | textarea, 5x50 |"  changerows="on" quietsave="on" editbutton="Edit table" }%
|*Menu option*|*No login required*|*Login required*|
| Maintenance<br />   * Site Table<br />   * VO Management<br />   * VOName correction |  |  <img src="/pub/TWiki/TWikiDocGraphics/choice-yes.gif" alt="DONE" title="DONE" width="16" height="16" border="0" />   |
| Probes<br />   * active, inactive or all<br />   * CPU Info<br />   * Roles |  |  <img src="/pub/TWiki/TWikiDocGraphics/choice-yes.gif" alt="DONE" title="DONE" width="16" height="16" border="0" />   |
| Authentication<br />   * Certificates |  |  <img src="/pub/TWiki/TWikiDocGraphics/choice-yes.gif" alt="DONE" title="DONE" width="16" height="16" border="0" />   |
| Replication<br />   * Job Usage Replication<br />   * Metric Replicatino |  |  <img src="/pub/TWiki/TWikiDocGraphics/choice-yes.gif" alt="DONE" title="DONE" width="16" height="16" border="0" />   |
| System<br />   * System status: normal or detailed |  <img src="/pub/TWiki/TWikiDocGraphics/choice-yes.gif" alt="DONE" title="DONE" width="16" height="16" border="0" />   |  |
| System<br />   * Administration |  |  <img src="/pub/TWiki/TWikiDocGraphics/choice-yes.gif" alt="DONE" title="DONE" width="16" height="16" border="0" />   |
| Documentation<br />   * Installation<br />   * Security<br />   * Replication<br />   * Gratia Service Settings |  <img src="/pub/TWiki/TWikiDocGraphics/choice-yes.gif" alt="DONE" title="DONE" width="16" height="16" border="0" />   |  |

<p>


 List of requirements.
   1 For an instance of a Gratia collector, at least one Gratia administrator must be defined.
   1 The Gratia administrators are identified and managed by the VO
   1 A user grid certificate will be used to identify the administrator

---++ administration access design
The identity of a Gratia administrator will be defined in the _TOMCAT_HOME/gratia/service-configuration.properties_ file.  
   * For Gratia instances servicing multiple VO's, multiple entries are allowed
   * The identity of the Gratia administrator(s) will be defined by specifying the FQAN as defined by the VO.
   * In order to insure that the most current list of administrative identities is always used this file should be read each time the login service is invoked (explicitly or implicitly).
<pre>
<b>service-configuration.properties file entries:</b>
  service.admin.identity.0=/cms/uscms/Role=gratiaadmin
  service.admin.identity.1=/cms/uscms/gratiaadmin/Role=NULL
  service.admin.identity.2=/atlas/usatlas/Role=gratiaadmin

<i>(the above entries show various examples of how the 
identity of the Gratia administrators can be defined 
within a VO)</i>
</pre>

The Gratia login process will need the identity of the OSG VO VOMS servers in order to authenticate the identity of the user.          
   * This will be in the form of an OS file called _TOMCAT_HOME/gratia/voms-servers_ 
   * File permissions of 644
   * Initially, this file will be manually maintained.  In the long term, this file should be distributed by the OSG GOC.
   * In order to insure that the most current list of voms servers is always used this file should be read each time the login service is invoked (explicitly or implicitly).
<pre>
<b>./gratia/voms-servers file:</b>
  # comment line
  atlas  https://voms.cern.ch:8443/voms/atlas/services/VOMSAdmin
  cms    https://voms.cern.ch:8443/voms/cms/services/VOMSAdmin
  geant4 https://voms.cern.ch:8443/voms/geant4/services/VOMSAdmin
</pre>

The user identity requesting login access will be retrieved from a grid certificate imported in their browser. The DN (subject) of the certificate, in the following form, will be used:
<pre>
/DC=org/DC=doegrids/OU=People/CN=John Weigand 458491
</pre>



---++ adminstration access open issues
<ol>
<li>Command line shutdown of update services using _wget_ .<p>
Currently the _initd_ tomcat service, does a _wget_ to stop the _update services_ prior to stopping _tomcat_.
<pre>
  wget -O - -q 'http://gratia.opensciencegrid.org:8881/gratia-administration/systemadministration.html?action=stopDatabaseUpdateThreads'
</pre>
This will not be allowed when the login access is implemented.  An alternative is required.
</li>
<p>


<li>

</li>

</ol>
<p>


---+ gratia-reporting
The Gratia reporting is accessible as http(s)://&lt;node.domain&gt;:&lt;port&gt;/gratia-reporting.  It allows for viewing the accounting data only.  There is no maintenance/update capability.  The general intent in this area is to to allow various levels of visibility to the data:
   * public-like data viewable by anyone
   * VO level data viewable by members of a VO
   * Individual user data (DN level) for members of a VO

The detailed requirements for this capability have not been fully defined yet.

---++ reporting view requirements
This section has not been defined yet.

---++ reporting view design



%STOPINCLUDE%



<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->
---++!! Major updates
<!--Future editors should add their signatures beneath yours!-->
-- Main.JohnWeigand - 25 Feb 2008%BR%

%META:TOPICMOVED{by="JohnWeigand" date="1203954709" from="Accounting.GratiaLoginRequirements" to="Accounting.GratiaAccessLoginSpecification"}%
