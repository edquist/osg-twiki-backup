%META:TOPICINFO{author="JohnWeigand" date="1209091710" format="1.1" reprev="1.2" version="1.2"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*

<!--
   * Set EDITTHISTEXT = <div class="twikiSmall"><a href="%TOPIC%">edit this section</a></div>
-->

%TOC%

%STARTINCLUDE%

%BR%
---+ _%SPACEOUT{ "%TOPIC%" }%_
%EDITTHISTEXT%
%BR%
There are several items you may wish to configure before accepting accounting data from the Gratia probes. 
The =$VDT_LOCATION/tomcat/v55/gratia/service-configuration.properties= file contains some items you will want to consider changing.  This topic will not cover all of them as the file contains a reasonable explanation of each attribute.  It will just cover a couple you may want to look at initially.
   * Connections
   * Monitoring

Additionally, if you are installing remote installation for the purpose of capturing your local accounting data and then forwarding selected accounting data to the OSG or ITB instances of Gratia, you will be need to do 2 additional steps:
   * Change your gatekeeper probes to report to this instance of a Gratia collector
   * Set up Gratia replication to forward selective probes to the OSG or ITB Gratia collectors.

---++ Connections
You have two ports by which you can access the Gratia reporting and administration services that are     defined by these attributes in the file:
   * service.open.connection
   * service.secure.connection

These are pre-set during installation by the =$VDT_location/vdt/setup/configure_gratia= script.

---++ Monitoring
The attributes control whether or not to have Gratia post an email if it hasn't received
a job usage record from a probe within a specified amount of time.

These attributes are not set in the =configure_gratia= script and should be changed.  They are:
   * monitor.smtp.server=YOUR-SMTP-SERVER
   * monitor.smtp.authentication.required=false
   * monitor.smtp.user=EMAIL-USER-NAME
   * monitor.smtp.password=EMAIL-PASSWORD
   * monitor.from.address=FROM-EMAIL-ADDRESS
   * monitor.to.address.0=TO-EMAIL-ADDRESS
   * monitor.subject=EMAIL-SUBJECT

---++ Changing your gatekeeper probes


---++ Setting up Gratia replication
Gratia has the ability to replicate it&#8217;s database contents (actually, the <nop>JobUsageRecords) to another instance of Gratia running &#8220;out there somewhere&#8221;. This replication service can be found on the gratia-administration web service menu. 

Assuming your database is the source, and OSG/ITB database at Fermilab is the target:
   1. You must first determine whether or not the target is running secured by contacting the OSG/ITB Gratia system administrator (gratia-operation@opensciencegrid.org)
   1. Under the =Replication= menu, select either =Job Usage Replication= or =Metric Replication= depending on the accounting data you wish to forwar.
   1. On the =Replication= screen, under =Remote Host=, you will add an entry and then click on the =Update= button.
      * For ITB:   http://gratia.opensciencegrid.org:8881
      * For OSG:  http://gratia.opensciencegrid.org:8880
   1. Then, for your entry, select =Test= under the =Options= column on the far right.  
   It should indicate either success or failure.  A failure means either your entry was incorrect or the =Remote Host= is not available.  If it is not your entry, contact the Gratia administrator of the remote host or try to access it via your web browser.
       * If we at Fermi are running &#8220;secured&#8221;, you must (1) set the =Security column to =Yes= and update, (2) using the =Register= entry, register your server with us.
   1. Now you will select the probes that you want to forward.  Under the =Probe Name= column, you can specify selective probes, probes for specific VOs or All.  Press the &#8220;=update= button to add the entry to the database.
      * <b>NOTE:</b> If do not specify =All=, you will need to create a replication entry for each probe or VO you desire to forward.  This means repeating steps 3 through 6.

 

·        You can test the connection by using the &#8220;Test&#8221; link. Your server will send a dummy transaction to our machine at Fermi and let you know whether or not the connection was made. If it reports and error, you should contact the target gratia administrator for support.

·        Finally, start the replication process by using the &#8220;Start&#8221; link. Replication should start within a minute or so. You can stop the process with the &#8220;Stop&#8221; link (which will also take a minute or so).

From our testing gratia can replicate roughly 2000 records per minute for each active replication entry.









%STOPINCLUDE%

-- Main.JohnWeigand - 24 Apr 2008
