%META:TOPICINFO{author="BrianBockelman" date="1255364625" format="1.1" version="1.1"}%
%META:TOPICPARENT{name="ProbeInstallation"}%
---+OSG Gratia probe configuration: Condor Events

The Condor Events probe is a slight twist on normal accounting - it creates a usage record for each event in the Condor batch system.  This allows one to see who is consuming the most central batch system resources by viewing the submit, start, or finish events.

*NOTE*: You will probably want to configure !CondorBinaryDir and !CondorConfig in the !ProbeConfig below.

<ol>
<li>[[ProbeInstallation][Install]] the software using pacman or RPM.</li>

#ProbeConfig<li>Customize the Gratia =ProbeConfig= file. The following variables (at least)
should have appropriate values:

| *Gratia Configuration Variable=&quot;Default&quot;* | *Set value information* |
| !MeterName = &quot;generic&quot; | This value will be entered in the database to indicate where the record came from.<br />We recommend a =batchsystem:FQDN= such as "condor-events:fermigrid1.fnal.gov". |
| !SiteName = &quot;Generic Site&quot; | This value should be set to the registered RESOURCE NAME in OIM. |
| !VDTSetupFile = &quot;<tt>MAGIC_VDT_LOCATION</tt>/setup.sh&quot; |Path to the VDT =setup.sh= file. Please expand =MAGIC_VDT_LOCATION=. |
| !EnableProbe = &quot;1&quot; | If present, this attribute must be set to one to enable probe reporting. |
| !CollectorHost = "collector.example.com:80" | The location of the collector; usually set to the official OSG one. |
| !CondorBinaryDir = "/path/to/condor" | The directory that contains the condor binaries (necessary ones are condor_version and condor_config_val) |
| !CondorConfig = "/path/to/condor_config" | The location of the condor config file. |

Note that the !CondorBinaryDir and !CondorConfig may be in the PATH and CONDOR_CONFIG, respectively, of your environment.  However, when run as a cron job, more often than not, these are not set because your profile is not sourced.
</li>

<li>Set up !EventLog.  This probe uses the Condor !EventLog to parse condor events.  The following needs to be in your local condor configuration:

<verbatim>
EVENT_LOG=$(LOG)/EventLog
EVENT_LOG_USE_XML=True
EVENT_LOG_JOB_AD_INFORMATION_ATTRS=Owner,CurrentHosts,x509userproxysubject,AccountingGroup,GlobalJobId,QDate,JobStartDate,JobCurrentStartDate,JobFinishedHookDone
</verbatim>

The !EventLog does not necessarily need to be written to the file specified above, but it should be in XML format and at least have the attributes given above.
</li>

</ol>