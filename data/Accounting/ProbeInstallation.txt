%META:TOPICINFO{author="ChrisGreen" date="1175886836" format="1.1" version="1.48"}%
%META:TOPICPARENT{name="InstallationGuideVDT"}%
---++OSG Accounting Services - Gratia - Probe Installation

---+++Preliminary notes

<OL>
<LI />Select the probe(s) you wish to install from the [[#ProbeDownloadTable][table of available probes]].%BR%
         <b>Note:</b> In general, the RPMs are non-architecture-specific. <b>However</b>, the [[#ProbeDownloadPbsLsf][PBS/LSF probe RPM]] is a binary package built for a 32-bit i386 architecture. This is also true of the VDT distribution. If your platform is different, you will need to install the source RPM and follow the instructions for building it under the <i>Details</i> column in the table below.

<LI />People with VDT or OSG installations are advised to install using Pacman for those releases that provide their required probe (see the  below); if a probe you require is not available for your version or you require the latest version, please [[#RpmInstall][install from RPM]].

<LI />For all probe installations via Pacman or RPM, please read the appropriate detailed configuration notes ("Details" column in the [[#ProbeDownloadTable][probe table]]).

<LI><b>Important:</b> If, previously, you had installed the probe(s) by RPM at sites where they were not yet available via OSG/VDT and are now upgrading to an OSG/VDT version that contains the probe(s), you must remove the RPM installed probe(s).  In addition, you should check your <i>root</i> crontab entry and remove the cron entry before upgrading.  The OSG/VDT installation will create a new cron entry for the probe. 

<LI />For Pacman installs, use the standard Pacman command to install the probes you require, for instance:

<verbatim>pacman -get Gratia-Condor-Probe</verbatim>

Notes:
<UL>
<LI />Please see the [[ProbeConfigCondor#GratiaCondorGramPatch][installation notes for the condor probe]] if you install it as it requires versions of VDT prior to 1.5.1 to be patched for operation with versions of Condor prior to v6.9.0. 
<LI />The Gratia-Probe-Common package will be pulled in as a dependency for all probes, so explicit installation is not required.
</UL>

<LI />PBS and LSF Sites:  A patch to the 0.12i version of the probe is available and should be applied by all PBS and LSF sites. See
<a href="#0.12i_patch">PBS/LSF 0.12i patch notes</a> for details on upgrading.  In addition, refer to the <i>Note</i> under item 1 above.
</OL>

#ProbeDownloadTable
---+++Probe availability

<style type="text/css">
TD.cdata { text-align: center }
</style>

<table width="100%" border="1">
<thead />
<tr style="text-align: center; font-weight: bold">
<th id="probe" rowspan="2" />Probe
<th id="rpm" rowspan="2" />RPM
<th id="pname" rowspan="2" />VDT package name
<th colspan="2" scope="colgroup" />Available since
<th id="notes" rowspan="2" />Notes
<th id="details" rowspan="2" />Details
</tr>
<tr style="text-align: center; font-weight: bold">
<th id="osgver" />OSG / ITB
<th id="vdtver" />VDT
</tr>
<col width="1*" /><col width="2*" /><col width="2*" /><col width="1*" /><col width="1*" />
<col width="8*" /><col width="4*" />
<tbody />
<tr><a name="ProbeDownloadCommon">
<td headers="probe" style="font-weight: bold">ALL
<td headers="rpm" /><a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-common-%ProbeVersion%.noarch.rpm">
gratia-probe-common-%ProbeVersion%</a>
<td headers="pname" />Gratia-Probe-Common<td class="cdata"/>0.4.1<td class="cdata"/>1.3.10
<td headers="notes" />Common infrastructure, needed by all probes.
<td headers="details" />
</tr>
<tr><a name="ProbeDownloadCondor">
<td headers="probe" rowspan="2" />Condor
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-condor-%ProbeVersion%.noarch.rpm">
gratia-probe-condor-%ProbeVersion%</a>
<td headers="pname" rowspan="2" />Gratia-Condor-Probe
<td headers="osgver" class="cdata" rowspan="2" />0.4.1
<td headers="vdtver" class="cdata" rowspan="2" />1.3.10
<td headers="notes" />Condor probe (install on CE)[[#ProdReporting][1]]</sup>
<td headers="details" rowspan="2" />[[ProbeConfigCondor][Condor probe configuration notes]]
</tr>
<tr><a name="ProbeDownloadCondorItb">
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-condor-itb-%ProbeVersion%.noarch.rpm">
gratia-probe-condor-itb-%ProbeVersion%</a>
<td headers="notes" />Condor probe (install on ITB CE)[[#ItbReporting][2]]</sup>
</tr>
<tr><a name="ProbeDownloadPbsLsf">
<td headers="probe" rowspan=2 />PBS
<td headers="rpm" >

<!--   PATCH
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-%ProbeVersion%.i386.rpm">
gratia-probe-pbs-lsf-%ProbeVersion%</a>
-->
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-0.12i_patch-1.i386.rpm">
gratia-probe-pbs-lsf-0.12i_patch-1</a>

<td headers="pname" rowspan=2 />Gratia-PBS-Probe
<td headers="osgver" class="cdata" rowspan="2" />-
<td headers="vdtver" class="cdata" rowspan="2" />1.6.0
<td headers="notes" />PBS probe (install on CE)<sup>[[#ProdReporting][1]]</sup>
<td headers="details" rowspan="4" />[[ProbeConfigPbsLsf][PBS/LSF probe configuration notes]]

<p><a href="#0.12i_patch">PBS/LSF 0.12i patch notes</a>
</tr>
<tr><a name="ProbeDownloadPbsLsfItb">
<td headers="rpm" />


<!--   PATCH
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-itb-%ProbeVersion%.i386.rpm">
gratia-probe-pbs-lsf-itb-%ProbeVersion%</a>
-->
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-itb-0.12i_patch-1.i386.rpm">
gratia-probe-pbs-lsf-itb-0.12i_patch-1</a>



<td headers="notes" />PBS probe (install on ITB CE)<sup>[[#ItbReporting][2]]</sup>
</tr>
<tr>
<td headers="probe" rowspan=2 />LSF
<td headers="rpm" >


<!--  PATCH
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-%ProbeVersion%.i386.rpm">
gratia-probe-pbs-lsf-%ProbeVersion%</a>
-->
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-0.12i_patch-1.i386.rpm">
gratia-probe-pbs-lsf-0.12i_patch-1</a>



<td headers="pname" rowspan=2 />Gratia-LSF-Probe
<td headers="osgver" class="cdata" rowspan="2" />-
<td headers="vdtver" class="cdata" rowspan="2" />1.6.0
<td headers="notes" />LSF probe (install on CE)<sup>[[#ProdReporting][1]]</sup>
</tr>
<tr>
<td headers="rpm" />

<!--  PATCH
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-itb-%ProbeVersion%.i386.rpm">
gratia-probe-pbs-lsf-itb-%ProbeVersion%</a>
-->
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-itb-0.12i_patch-1.i386.rpm">
gratia-probe-pbs-lsf-itb-0.12i_patch-1</a>


<td headers="notes" />LSF probe (install on ITB CE)<sup>[[#ItbReporting][2]]</sup>
</tr>
<tr>
<td headers="probe" />SGE
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-sge-%ProbeVersion%.noarch.rpm">
gratia-probe-sge-%ProbeVersion%</a>
<td headers="pname" class="cdata"/>-
<td headers="osgver" class="cdata"/>-
<td headers="vdtver" class="cdata"/>1.6.1a
<td headers="notes" />SGE probe (install on CE)<sup>[[#ProdReporting][1]]</sup>
<td headers="details" />[[ProbeConfigSge][SGE probe configuration notes]]
</tr>
<!-- <tr>
<td headers="probe" />DCache
<td headers="rpm" />
<td headers="pname" />
<td headers="osgver" class="cdata"/>-
<td headers="vdtver" class="cdata"/>-
<td headers="notes" />
<td headers="details" />
</tr>
<tr>
<td headers="probe" />glexec
<td headers="rpm" />
<td headers="pname" />
<td headers="osgver" class="cdata"/>-
<td headers="vdtver" class="cdata"/>-
<td headers="notes" />
<td headers="details" />
</tr>
-->
<tr>
<td headers="probe" />ps-accounting
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-psacct-%ProbeVersion%.noarch.rpm">
gratia-probe-psacct-%ProbeVersion%</a>
<td headers="pname" class="cdata"/>-
<td headers="osgver" class="cdata"/>-
<td headers="vdtver" class="cdata"/>-
<td headers="notes" />If installed, install on CE _and_ all worker nodes
<td headers="details" />[[ProbeConfigPsacct][PS-accounting probe configuration notes]]
</tr>
<tr>
<td headers="probe" />SOURCE
<td headers="rpm" />
<!--   PATCH
<a href="http://gratia.fnal.gov/Files/probe/SRPMS/gratia-probe-%ProbeVersion%.src.rpm">
gratia-probe-%ProbeVersion%</a>
-->
<a href="http://gratia.fnal.gov/Files/probe/SRPMS/gratia-probe-0.12i_patch-1.src.rpm">
gratia-probe-0.12i_patch-1</a>
<td headers="pname" class="cdata"/>-
<td headers="osgver" class="cdata"/>-
<td headers="vdtver" class="cdata"/>-
<td headers="notes" />Source RPM<sup>[[#PsacctReporting][3]]</sup>.
<td headers="details" />[[ProbeSrpmNotes][Detailed notes for SRPM]]
</tr>
</table>

<!--   INSET for 0.12i_patch on LSF-PBS probes -->
<a name="0.12i_patch"/>.
<h3>Details on the gratia-probe-pbs-lsf-0.12i patch</h3>
This patch for the PBS and LSF cron scheduled probes resolves a problem when the probe script terminates prematurely and leaves a lock file behind.  This condition would cause the probe to think another instance was still running and terminate immediately.  

<b>RPM installations of 0.12i rpms:</b> %BR%
These rpms with the fix were made available on 3/16/2007.  If you currently have 0.12i installed, you should
download the new 0.12i_patch rpm from the table above and replace the previous version with this. No other RPMs have changed.

<b>VDT pacman installations:</b> %BR%
This fix was been made available in the VDT 1.6.1c cache on 3/21/2007.  If you currently have 0.12i installed you should perform the following update:
<pre>
&gt; pacman -update Gratia-PBS-Probe  
    or
&gt; pacman -update Gratia-LSF-Probe
</pre>

d228 2
#RpmInstall
---+++Installation from RPM

<UL>
<LI />If you install any probe at all, you will need the =gratia-probe-common= RPM listed below; this contains common infrastructure required by all probes.

<LI />The Gratia Condor currently requires that $VDT_LOCATION/gratia/var/data points to the same directory as the directory mentioned in the =DataFolder= variable of the Gratia Condor probe's ProbeConfig file.

<LI />Depending on your batch system, you should install the appropriate Condor or PBS/LSF probe on your CE. If you are running both batch systems, you should install both probes.

<LI />Read the configuration notes for each probe you install.

<LI />If you require the extra granularity of process accounting (unlikely except in rare circumstances), you should install the ps-accounting probe on the CE *and* every worker node. This is a re-incarnation of a legacy FNAL admin utility and as such is only likely to be of use to FNAL admins.

<LI />Note that the =gratia-probe-common= RPM contains example probes, =samplemeter.{py,pl}=. If you wish to write or customize your own probe, please take a look at the [[ProbeConfigGeneral][general configuration notes]]. For specific probes, see the appropriate notes for that probe as listed in the table below.

<LI />Install the appropriate RPMS. Note that the main install prefix may be changed with this addition to the =rpm= command line: =--relocate&nbsp;/opt/vdt/gratia=/desired/path=. It is recommended to use, for example:

<UL>
#CondorProbeQuickStart<LI />Condor:

<verbatim>rpm -Uvh --relocate /opt/vdt/gratia=$VDT_LOCATION/gratia \
http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-common-%ProbeVersion%.noarch.rpm \
http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-condor-%ProbeVersion%.noarch.rpm
</verbatim>

#PbsLsfProbeQuickStart<LI />PBS/LSF:
<verbatim>rpm -Uvh --relocate /opt/vdt/gratia=$VDT_LOCATION/gratia \
http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-common-%ProbeVersion%.noarch.rpm \
http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-%ProbeVersion%.i386.rpm
</verbatim>
</UL>

</UL>

------
---++++++Footnotes
<small>
<OL>
#ProdReporting<LI />The default configuration files are configured to send data to the official [[http://gratia-osg.fnal.gov:8880/gratia-reporting][OSG Gratia server]]
#ItbReporting<LI />The default configuration files are configured to send data to the [[http://gratia-osg.fnal.gov:8881/gratia-reporting][OSG Gratia ITB server]]
#PsacctReporting<LI />This probe uses the Linux processing accounting facility and reporting is daily. The default configuration files are configured to send data to the [[http://gratia-fermi.fnal.gov:8882/gratia-reporting][OSG Gratia psacct server]]. Note that unlike the other probes, the psacct probe must be installed on every worker node.
</OL>
</small>

-- Main.PenelopeConstanta - 30 Aug 2006

-- Main.ChrisGreen - 22 Feb 2007

-- Main.JohnWeigand - 16 Mar 2007 - Added 0.12i_patch rpms for LSF and PBS probes for the changes to pbs-lsf_meter.cron.sh to resolve the lock file problems

-- Main.ChrisGreen - 18 May 2007 - New version renders patch text obsolete.

%META:TOPICMOVED{by="ChrisGreen" date="1158007224" from="Accounting.ProbeConfiguration" to="Accounting.ProbeInstallation"}%
%META:PREFERENCE{name="ProbeVersion" title="ProbeVersion" type="Set" value="0.12i-1"}%
