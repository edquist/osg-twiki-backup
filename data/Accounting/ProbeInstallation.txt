%META:TOPICINFO{author="ChrisGreen" date="1226003676" format="1.1" version="1.89"}%
%META:TOPICPARENT{name="InstallationGuideVDT"}%
---++OSG Accounting Services - Gratia - Probe Installation

<!-- Set probe version in one place for use in the rest of the page.
   * Set ProbeVersion = 1.00.3-1
-->

---+++Preliminary notes

%RED%<b>IMPORTANT NOTE!</b>%ENDCOLOR% If you have been notified that your site is not reporting correctly in some way, please see these %RED%<b>[[TroubleShootingInstructions][troubleshooting instructions]].</b>%ENDCOLOR%

<OL>
<LI />Select the probe(s) you wish to install from the [[#ProbeDownloadTable][table of available probes]].%BR%
         <b>Note:</b> In general, the RPMs are non-architecture-specific. <b>However</b>, the [[#ProbeDownloadPbsLsf][PBS/LSF probe RPM]] is a binary package built for a 32-bit i386 architecture. This is also true of the VDT distribution. If your platform is different, you will need to install the source RPM and follow the instructions for building it under the <i>Details</i> column in the table below.

<LI />People with VDT or OSG installations are advised to install using Pacman for those releases that provide their required probe (see the  below); if a probe you require is not available for your version or you require the latest version, please [[#RpmInstall][install from RPM]].

<LI />For %RED% *all probe installations* %ENDCOLOR% via Pacman or RPM, please read the appropriate detailed configuration notes ("Details" column in the [[#ProbeDownloadTable][probe table]]). *At a minimum*, please ensure correct values for =MeterName=, =SiteName=, =SOAPHost= and =EnableProbe= (if present).

<LI><b>Important:</b> If, previously, you had installed the probe(s) by RPM at sites where they were not yet available via OSG/VDT and are now upgrading to an OSG/VDT version that contains the probe(s), you must remove the RPM installed probe(s).  In addition, you should check your <i>root</i> crontab entry and remove the cron entry before upgrading.  The OSG/VDT installation will create a new cron entry for the probe. 

<LI />For Pacman installs, use the standard Pacman command to install the probes you require, for instance:

<verbatim>pacman -get Gratia-Condor-Probe</verbatim>

Notes:
<UL>
<LI />Please see the [[ProbeConfigCondor#GratiaCondorGramPatch][installation notes for the condor probe]] if you install it as it requires versions of VDT prior to 1.5.1 to be patched for operation with versions of Condor prior to v6.9.0. 
<LI />The Gratia-Probe-Common package will be pulled in as a dependency for all probes, so explicit installation is not required.
</UL>

</OL>

#ProbeDownloadTable
---+++Probe availability

<style type="text/css">
TD.cdata { text-align: center }
</style>

<table width="100%" border="1">
<thead />
<tr style="text-align: center; font-weight: bold">
<th id="probe" rowspan="2" />Probe
<th id="rpm" rowspan="2" />RPM
<th id="pname" rowspan="2" />VDT package name
<th colspan="2" scope="colgroup" />Available since
<th id="notes" rowspan="2" />Notes
<th id="details" rowspan="2" />Details
</tr>
<tr style="text-align: center; font-weight: bold">
<th id="osgver" />OSG / ITB
<th id="vdtver" />VDT
</tr>
<col width="1*" /><col width="2*" /><col width="2*" /><col width="1*" /><col width="1*" />
<col width="8*" /><col width="4*" />
<tbody />
<tr><a name="ProbeDownloadCommon" />
<td headers="probe" style="font-weight: bold">ALL
<td headers="rpm" /><a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-common-%ProbeVersion%.noarch.rpm">
gratia-probe-common-%ProbeVersion%</a>
<td headers="pname" />Gratia-Probe-Common<td class="cdata"/>0.4.1<td class="cdata"/>1.3.10
<td headers="notes" />Common infrastructure, needed by all probes.
<td headers="details" />
</tr>
<tr><a name="ProbeDownloadCondor" />
<td headers="probe" rowspan="2" />Condor
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-condor-%ProbeVersion%.noarch.rpm">
gratia-probe-condor-%ProbeVersion%</a>
<td headers="pname" rowspan="2" />Gratia-Condor-Probe
<td headers="osgver" class="cdata" rowspan="2" />0.4.1
<td headers="vdtver" class="cdata" rowspan="2" />1.3.10
<td headers="notes" />Condor probe (install on CE)[[#ProdReporting][1]]</sup>
<td headers="details" rowspan="2" />[[ProbeConfigCondor][Condor probe configuration notes]]
</tr>
<tr><a name="ProbeDownloadCondorItb" />
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-condor-itb-%ProbeVersion%.noarch.rpm">
gratia-probe-condor-itb-%ProbeVersion%</a>
<td headers="notes" />Condor probe (install on ITB CE)[[#ItbReporting][2]]</sup>
</tr>
<tr><a name="ProbeDownloadPbsLsf" />
<td headers="probe" rowspan=2 />PBS
<td headers="rpm" >

<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-%ProbeVersion%.i386.rpm">
gratia-probe-pbs-lsf-%ProbeVersion%</a>

<td headers="pname" rowspan=2 />Gratia-PBS-Probe
<td headers="osgver" class="cdata" rowspan="2" />0.6.0
<td headers="vdtver" class="cdata" rowspan="2" />1.6.0
<td headers="notes" />PBS probe (install on CE)<sup>[[#ProdReporting][1]]</sup>
<td headers="details" rowspan="4" />[[ProbeConfigPbsLsf][PBS/LSF probe configuration notes]]
</tr>
<tr><a name="ProbeDownloadPbsLsfItb" />
<td headers="rpm" />

<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-itb-%ProbeVersion%.i386.rpm">
gratia-probe-pbs-lsf-itb-%ProbeVersion%</a>

<td headers="notes" />PBS probe (install on ITB CE)<sup>[[#ItbReporting][2]]</sup>
</tr>
<tr>
<td headers="probe" rowspan=2 />LSF
<td headers="rpm" >

<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-%ProbeVersion%.i386.rpm">
gratia-probe-pbs-lsf-%ProbeVersion%</a>

<td headers="pname" rowspan=2 />Gratia-LSF-Probe
<td headers="osgver" class="cdata" rowspan="2" />0.6.0
<td headers="vdtver" class="cdata" rowspan="2" />1.6.0
<td headers="notes" />LSF probe (install on CE)<sup>[[#ProdReporting][1]]</sup>
</tr>
<tr>
<td headers="rpm" />

<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-itb-%ProbeVersion%.i386.rpm">
gratia-probe-pbs-lsf-itb-%ProbeVersion%</a>

<td headers="notes" />LSF probe (install on ITB CE)<sup>[[#ItbReporting][2]]</sup>
</tr>
<tr><a name="ProbeDownloadSGE" />
<td headers="probe" rowspan="2" />SGE
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-sge-%ProbeVersion%.noarch.rpm">
gratia-probe-sge-%ProbeVersion%</a>
<td headers="pname" rowspan="2" />Gratia-SGE-Probe
<td headers="osgver" rowspan="2" class="cdata"/>0.6.0
<td headers="vdtver" rowspan="2" class="cdata"/>1.6.1a
<td headers="notes" />SGE probe (install on CE)<sup>[[#ProdReporting][1]]</sup>
<td headers="details" rowspan="2" />[[ProbeConfigSge][SGE probe configuration notes]]
</tr>
<tr><a name="ProbeDownloadSGEITB">
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-sge-itb-%ProbeVersion%.noarch.rpm">
gratia-probe-sge-itb-%ProbeVersion%</a>
<td headers="notes" />SGE probe (install on ITB CE)[[#ItbReporting][2]]</sup>
</tr>
<!-- <tr>
<td headers="probe" />DCache
<td headers="rpm" />
<td headers="pname" />
<td headers="osgver" class="cdata"/>-
<td headers="vdtver" class="cdata"/>-
<td headers="notes" />
<td headers="details" />
</tr>
-->
<tr><a name="ProbeDownloadgLexec">
<td headers="probe" rowspan="2" />gLexec
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-glexec-%ProbeVersion%.noarch.rpm">
gratia-probe-glexec-%ProbeVersion%</a>
<td headers="pname" rowspan="2" />Gratia-Glexec-Probe
<td headers="osgver" class="cdata" rowspan="2" />0.8.0
<td headers="vdtver" class="cdata" rowspan="2" />1.7.1
<td headers="notes" />gLexec probe (install on worker nodes)[[#ProdReporting][1]]</sup>
<td headers="details" rowspan="2" />[[ProbeConfiggLexec][gLexec probe configuration notes]]
</tr>
<tr><a name="ProbeDownloadgLexecITB">
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-glexec-itb-%ProbeVersion%.noarch.rpm">
gratia-probe-glexec-itb-%ProbeVersion%</a>
<td headers="notes" />gLexec probe (install on ITB worker nodes)[[#ItbReporting][2]]</sup>
</tr>
<tr>
<td headers="probe" />ps-accounting
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-psacct-%ProbeVersion%.noarch.rpm">
gratia-probe-psacct-%ProbeVersion%</a>
<td headers="pname" class="cdata"/>-
<td headers="osgver" class="cdata"/>-
<td headers="vdtver" class="cdata"/>-
<td headers="notes" />If installed, install on CE _and_ all worker nodes<sup>[[#PsacctReporting][3]]</sup>.
<td headers="details" />[[ProbeConfigPsacct][PS-accounting probe configuration notes]]
</tr>
<tr><a name="ProbeDownloadMetric">
<td headers="probe" rowspan="2" />metric
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-metric-%ProbeVersion%.noarch.rpm">
gratia-probe-metric-%ProbeVersion%</a>
<td headers="pname" rowspan="2" />Gratia-Metric-Probe
<td headers="osgver" class="cdata" rowspan="2" />0.8.0
<td headers="vdtver" class="cdata" rowspan="2" />1.7.1b
<td headers="notes" />Metric probe (install on worker nodes)[[#ProdReporting][1]]</sup>
<td headers="details" rowspan="2" />[[ProbeConfigMetric][Metric probe configuration notes]]
</tr>
<tr><a name="ProbeDownloadMetricITB">
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-metric-itb-%ProbeVersion%.noarch.rpm">
gratia-probe-metric-itb-%ProbeVersion%</a>
<td headers="notes" />Metric probe (install on ITB worker nodes)[[#ItbReporting][2]]</sup>
</tr>
<tr>
<td headers="probe" />SOURCE
<td headers="rpm" />
<a href="http://gratia.fnal.gov/Files/probe/SRPMS/gratia-probe-%ProbeVersion%.src.rpm">
gratia-probe-%ProbeVersion%</a>
<td headers="pname" class="cdata"/>-
<td headers="osgver" class="cdata"/>-
<td headers="vdtver" class="cdata"/>-
<td headers="notes" />Source RPM.
<td headers="details" />[[ProbeSrpmNotes][Detailed notes for SRPM]]
</tr>
</table>

#RpmInstall
---+++Installation from RPM

<UL>
<LI />If you install any probe at all, you will need the =gratia-probe-common= RPM listed below; this contains common infrastructure required by all probes.

<LI />The Gratia Condor currently requires that $VDT_LOCATION/gratia/var/data points to the same directory as the directory mentioned in the =DataFolder= variable of the Gratia Condor probe's ProbeConfig file.

<LI />Depending on your batch system, you should install the appropriate Condor or PBS/LSF probe on your CE. If you are running both batch systems, you should install both probes.

<LI />Read the configuration notes for each probe you install.

<LI />If you require the extra granularity of process accounting (unlikely except in rare circumstances), you should install the ps-accounting probe on the CE *and* every worker node. This is a re-incarnation of a legacy FNAL admin utility and as such is only likely to be of use to FNAL admins.

<LI />Note that the =gratia-probe-common= RPM contains example probes, =samplemeter.{py,pl}=. If you wish to write or customize your own probe, please take a look at the [[ProbeConfigGeneral][general configuration notes]]. For specific probes, see the appropriate notes for that probe as listed in the table below.

<LI />Install the appropriate RPMS. Note that the main install prefix may be changed with this addition to the =rpm= command line: =--relocate&nbsp;/opt/vdt/gratia=/desired/path=. It is recommended to use, for example:

<UL>
#CondorProbeQuickStart<LI />Condor:
<verbatim>rpm -Uvh --relocate /opt/vdt/gratia=$VDT_LOCATION/gratia \
http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-common-%ProbeVersion%.noarch.rpm \
http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-condor-%ProbeVersion%.noarch.rpm
</verbatim>

#PbsLsfProbeQuickStart<LI />PBS/LSF:
<verbatim>rpm -Uvh --relocate /opt/vdt/gratia=$VDT_LOCATION/gratia \
http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-common-%ProbeVersion%.noarch.rpm \
http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-%ProbeVersion%.i386.rpm
</verbatim>
</UL>

</UL>

------
---++++++Footnotes
<small>
<OL>
#ProdReporting<LI />The default configuration files are configured to send data to the official [[http://gratia-osg.fnal.gov:8880/gratia-reporting][OSG Gratia server]]
#ItbReporting<LI />The default configuration files are configured to send data to the [[http://gratia-osg.fnal.gov:8881/gratia-reporting][OSG Gratia ITB server]]
#PsacctReporting<LI />This probe uses the Linux processing accounting facility and reporting is daily. The default configuration files are configured to send data to the [[http://gratia-fermi.fnal.gov:8882/gratia-reporting][OSG Gratia psacct server]]. Note that unlike the other probes, the psacct probe must be installed on every worker node.
</OL>
</small>

---

-- Main.ChrisGreen - 16 Oct 2007 - Updated to 0.27.5c for release to VDT.

-- Main.ChrisGreen - 11 Sep 2007 - Updated to 0.27.3 for release to VDT.

-- Main.ChrisGreen - 14 Jun 2007 - 0.24 synced with (still) imminent services release.

-- Main.ChrisGreen - 13 Jun 2007 - 0.23 synced with imminent services release.

-- Main.ChrisGreen - 08 Jun 2007 - Added gLexec section.

-- Main.ChrisGreen - 18 May 2007 - New version renders patch text obsolete.

-- Main.JohnWeigand - 16 Mar 2007 - Added 0.12i_patch rpms for LSF and PBS probes for the changes to pbs-lsf_meter.cron.sh to resolve the lock file problems

-- Main.ChrisGreen - 22 Feb 2007

-- Main.PenelopeConstanta - 30 Aug 2006

%META:TOPICMOVED{by="ChrisGreen" date="1158007224" from="Accounting.ProbeConfiguration" to="Accounting.ProbeInstallation"}%
