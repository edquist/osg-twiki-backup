%META:TOPICINFO{author="PhilippeCanal" date="1166477898" format="1.1" reprev="1.29" version="1.29"}%
%META:TOPICPARENT{name="InstallationGuide"}%
---++OSG Accounting Services - Gratia - Probe Installation

---+++OSG ITB Installation

The following are the _short_ instructions on how to install the Gratia probes for test on the OSG ITB.
More detailed instructions and explanation follow.

   1. Download and install the Gratia Probe common rpm:<verbatim>rpm -Uvh --relocate /opt/vdt/gratia=$VDT_LOCATION/gratia \
http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-common-0.11f-2.noarch.rpm</verbatim>
   1. Download and install the Gratia Condor Probe rpm if you have a condor farm<verbatim>rpm -Uvh --relocate /opt/vdt/gratia=$VDT_LOCATION/gratia \
http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-condor-itb-0.11f-2.noarch.rpm</verbatim>
   1. If recommended by the rpm post-install message, patch Globus' condor.pm and managedfork.pm
   1. Download and install the Gratia PBS-LSF Probe rpm if you a PBS (or LSF) farm<verbatim>rpm -Uvh --relocate /opt/vdt/gratia=$VDT_LOCATION/gratia \
http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-itb-0.11f-2.i386.rpm</verbatim>
   1. Customize the probe by modifying the $VDT_LOCATION/gratia/probe/condor/ProbeConfig and the $VDT_LOCATION/gratia/probe/pbs-lsf/ProbeConfig. The following variables (at least) should have appropriate values:
| *Gratia Configuration Variable=&quot;Default&quot;* | *Set value information* |
| !MeterName = &quot;generic&quot; | This value will be entered in the database to indicate where the record came from.<br />We recommend a =batchsystem:FQDN= such as "condor:fermigrid1.fnal.gov". |
| !SiteName = &quot;Generic Site&quot; | This value is used in the report to refer to the site/farm/cluster to which the head node gives access. |
| !VDTSetupFile = &quot;<tt>MAGIC_VDT_LOCATION</vdt>/setup.sh&quot; |Path to the VDT =setup.sh= file. Please expand =MAGIC_VDT_LOCATION=. |

 
---+++Installation using pacman

The Gratia condor probe in particular is available from VDT using pacman:

<verbatim>pacman -get Gratia-Condor-Probe</verbatim>

%RED%*HOWEVER*%ENDCOLOR%: this package may not be available for your version of VDT. Gratia probes for the condor, PBS and LSF batch systems may be installed via RPMS as described below. Please see the [[ProbeConfigCondor#GratiaCondorGramPatch][installation notes for the condor probe]] though, as it requires versions of VDT prior to 1.5.1 to be patched for operation with versions of Condor prior to v6.9.0. 

---+++Installation from RPM

---++++Preliminary notes

   * If you install any probe at all, you will need the =gratia-probe-common= RPM listed below; this contains common infrastructure required by all probes.

   * The Gratia Condor currently requires that $VDT_LOCATION/gratia/var/data points to the same directory as the directory mentioned in the DataFolder variable of the Gratia Condor probe's ProbeConfig file.

   * Depending on your batch system, you should install the appropriate Condor or PBS/LSF probe on your CE. If you are running both batch systems, you should install both probes.

   * Read the configuration notes for each probe you install.

   * If you require the extra granularity of process accounting (unlikely except in rare circumstances), you should install the ps-accounting probe on the CE *and* every worker node. This is a re-incarnation of a legacy FNAL admin utility and as such is only likely to be of use to FNAL admins.

   * Note that the =gratia-probe-common= RPM contains example probes, =samplemeter.{py,pl}=. If you wish to write or customize your own probe, please take a look at the [[ProbeConfigGeneral][general configuration notes]]. For specific probes, see the appropriate notes for that probe as listed in the table below.

#ProbeDownloadTable
| *RPM* | *Comments* | Detailed notes |
| <a name="ProbeDownloadCommon"></a>[[http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-common-0.11f-2.noarch.rpm][gratia-probe-common-0.11f-2]] | Common infrastructure, needed by all probes. | 
| <a name="ProbeDownloadCondor"></a>[[http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-condor-0.11f-2.noarch.rpm][gratia-probe-condor-0.11f-2]] | Condor probe (install on CE)<sup>[[#ProdReporting][1]]</sup>. | [[ProbeConfigCondor][Condor probe configuration notes]] |
| <a name="ProbeDownloadCondorItb"></a>[[http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-condor-itb-0.11f-2.noarch.rpm][gratia-probe-condor-itb-0.11f-2]] | Condor probe (install on ITB CE)<sup>[[#ItbReporting][2]]</sup>. | [[ProbeConfigCondor][Condor probe configuration notes]] |
| <a name="ProbeDownloadPbsLsf"></a>[[http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-0.11f-2.i386.rpm][gratia-probe-pbs-lsf-0.11f-2]] | Probe for PBS / LSF-based production CEs<sup>[[#ProdReporting][1]]</sup>. | [[ProbeConfigPbsLsf][PBS/LSF probe configuration notes]] |
| <a name="ProbeDownloadPbsLsfItb"></a>[[http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-pbs-lsf-itb-0.11f-2.i386.rpm][gratia-probe-pbs-lsf-itb-0.11f-2]] | PBS / LSF configuration for ITB CEs<sup>[[#ItbReporting][2]]</sup>. | [[ProbeConfigPbsLsf][PBS/LSF probe configuration notes]] |
| <a name="ProbeDownloadPsacct"></a>[[http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-psacct-0.11f-2.noarch.rpm][gratia-probe-psacct-0.11f-2]] | Basic process-based (not job based) process information.<br /> If installed, install on CE _and_ all worker nodes (see configuration notes)<sup>[[#PsacctReporting][3]]</sup>. | [[ProbeConfigPsacct][PS-accounting probe configuration notes]] |
| <a name="ProbeDownloadSrpm"></a>[[http://gratia.fnal.gov/Files/probe/SRPMS/gratia-probe-0.11f-2.src.rpm][gratia-probe-0.11f-2]] | Source RPM. | [[ProbeSrpmNotes][Detailed notes for SRPM]] |

Then, install the RPMS. Note that the main install prefix may be changed with this addition to the =rpm= command line: =--relocate&nbsp;/opt/vdt/gratia=/desired/path=. It is recommended to use (eg)
d193 1
<verbatim>rpm -Uvh --relocate /opt/vdt/gratia=$VDT_LOCATION/gratia \
http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-common-0.11f-2.noarch.rpm \
http://gratia.fnal.gov/Files/probe/RPMS/gratia-probe-condor-0.11f-2.noarch.rpm
</verbatim>


------
---++++++Footnotes
<small>
<OL>
#ProdReporting<LI />The default configuration files are configured to send data to the official [[http://gratia-osg.fnal.gov:8880/gratia-reporting][OSG Gratia server]]
#ItbReporting<LI />The default configuration files are configured to send data to the [[http://gratia-osg.fnal.gov:8881/gratia-reporting][OSG Gratia ITB server]]
#PsacctReporting<LI />This probe uses the Linux processing accounting facility and reporting is daily. The default configuration files are configured to send data to the [[http://gratia-fermi.fnal.gov:8882/gratia-reporting][OSG Gratia psacct server]]. Note that unlike the other probes, the psacct probe must be installed on every worker node.
</OL>
</small>

-- Main.PenelopeConstanta - 30 Aug 2006
-- Main.ChrisGreen - 15 Dec 2006
-- Main.ChrisGreen - 05 Jan 2007

%META:PREFERENCE{name="ProbeVersion" title="ProbeVersion" type="Set" value="0.12f-1"}%
%META:TOPICMOVED{by="ChrisGreen" date="1158007224" from="Accounting.ProbeConfiguration" to="Accounting.ProbeInstallation"}%
%META:PREFERENCE{name="ProbeVersion" title="ProbeVersion" type="Set" value="0.12i-1"}%
