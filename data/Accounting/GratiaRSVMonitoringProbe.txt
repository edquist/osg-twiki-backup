%META:TOPICINFO{author="ChrisGreen" date="1260820292" format="1.1" reprev="1.6" version="1.6"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! Gratia RSV Monitoring Probe

This is a probe written for RSV that examines the Gratia probes on the system and ascertains whether they are reporting properly and can provide some diagnostics if problems are found.

---++ Probe Operation

Under normal circumstances this probe is packaged with the RSV system and is installed on a CE along with all the other RSV probes. It will be executed regularly and its results posted along with those of other probes. It may also be invoked manually and can give better diagnostics if run as root.

%TABLE{ tableborder="1" cellpadding="2" cellspacing="5" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF" headeralign="center, center, center, center" dataalign="left, center, left, center"}% 
|  *Test Description*  |  *Probe*  |  *Possible results*  |  *Root required?* |
| Check crontab entry. | ALL | CRITICAL<br/>UNKNOWN (if non-root) | Y |
| Check =Enabled= attribute in =ProbeConfig=. | ALL | CRITICAL | N |
| Check for generic =MeterName= in =ProbeConfig=. | ALL | CRITICAL | N |
| Check permissions on =DataFolder= (should be =04177= for batch probes) | PBS, LSF, Condor, SGE | CRITICAL | N |
| Check for missing or multiple `:' in =MeterName=. | ALL | WARNING | N |
| Check for generic =SiteName= in =ProbeConfig=. | ALL | WARNING | N |
| Verify condor_config has =PER_JOB_HISTORY_DIR= set correctly. | Condor | WARNING<br/>UNKNOWN (can't run condor_config_val) | N |
| Can urCollector config module be loaded? | PBS, LSF | CRITICAL | N |
| Can urCollector configuration file be loaded? | PBS, LSF | CRITICAL | N |
| Check LRMS type setting in =urCollector.conf= is recognized. | PBS, LSF | CRITICAL | N |
| Check LRMS type stetting matches probe type. | PBS, LSF | CRITICAL | N |
| Check PBS log directory exists. | PBS | CRITICAL<br/>WARNING (if no entries for current day) | Y |
| Check LSF log directory and =lsb.events= file exists. | LSF | CRITICAL<br/>WARNING (if no lsb.events file) | Y |
| Check files waiting to be sent from =&lt;workdir&gt;/urCollector=. | PBS, LSF | WARNING (if > 2000 files) | Y |
| Check files waiting to be re-sent from =&lt;workdir&gt;/gratiafiles= after communication problem with collector. | ALL | WARNING (if > 1000 records <br/>including those archived in files; or if at least <br/>1 file is >7d old) | N |
| Check files in top level =&lt;datadir&gt;=. | ALL | WARNING (if > 10000 files) | N |
| Check probe has contacted configured collector. | ALL | CRITICAL (never seen, not seen for >24h)<br/>UNKNOWN (can't contact collector)<br/>WARNING (not seen for >1h) | N |
| Check collector's probe -> site name translation matches local configuration. | ALL | WARNING | N |

---+++ Manual invocation

To invoke manually:

<pre>$VDT_LOCATION/osg-rsv/bin/probes/worker-scripts/gratia-config-probe-helper -p &lt;probe&gt; -X</pre>

The =-X= option produces human-readable output instead of the default XML. Invoke as root for more diagnostics.

-- Main.ChrisGreen - 14 Dec 2009
