%META:TOPICINFO{author="ChrisGreen" date="1280262321" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! Collector build and release-cutting procedure

---++ Build

<verbatim>
cd <release-top>/build-scripts
make release
</verbatim>

---++ Install and test collector

<ul>
<li>Create / edit a suitable collector configuration file. See =gratia/common/configuration/collector-dev.dat= or =gratia/common/configuration/collector-nbuild.dat= for examples.</li>
<li>Install with =gratia/build-scripts/install-release=. Example install from local:%BR%<verbatim>
VERSION_OPT="-L"
VERSION_ARG=~greenc/gratia-BIGINT
INSTALL_SCRIPT=~greenc/gratia-BIGINT/build-scripts/install-release
CONFIG_DIR=~greenc/gratia-BIGINT/common/configuration
MAILTO=MAILME@fnal.gov
INSTANCE=greenc_test
service=dev
${INSTALL_SCRIPT} -t -p -a \
                  $VERSION_OPT $VERSION_ARG \
                  -C ${CONFIG_DIR}/collector-$service.dat \
                  -c $INSTANCE -m $MAILTO
</verbatim>
Invoke =install-release --help= for an explanation of all the options.</li>
<li>Test as appropriate.</li>
</ul>

---++ Ensure all desired code is committed

<verbatim>
svn status
svn commit -m <message> <files> ...
</verbatim>

See this [[https://twiki.grid.iu.edu/bin/view/Accounting/SvnPrimer][SVN primer]] for more details on SVN use.

---++ Port desired changes to branch

If the current release stream is taking place on a branch, port desired changes from HEAD into the specified branch. For example:
<verbatim>
svn checkout https://gratia.svn.sourceforge.net/svnroot/gratia/branches/v1-06
svn merge -r<version-range> https://gratia.svn.sourceforge.net/svnroot/gratia/trunk .
svn commit -m<message> .
</verbatim>

Checking in changes to the whole tree is important because the directory attributes are all updated to reflect which revisions have been merged in from HEAD. This will make future merges simpler and less error-prone.

Then, perform a [[#Build][build]] and [[#Install_and_test_collector][test install]] of the merged code.

See this [[https://twiki.grid.iu.edu/bin/view/Accounting/SvnPrimer][SVN primer]] for more details on SVN use.

---++ Cut a developer tag

For example:
<verbatim>
svn copy https://gratia.svn.sourceforge.net/svnroot/gratia/{branches/v1-06,development-tags/v1-06-18-rc1}
</verbatim>

---++ Export to Gratia releases area and build

<verbatim>
ssh gratia@gr6x1.fnal.gov
cd ~/gratia-releases/
RELEASE=v1.06.18-rc1
svn export http://gratia.svn.sourceforge.net/svnroot/gratia/development-tags/${RELEASE//./-} gratia-${RELEASE}
cd gratia-${RELEASE}/build-scripts
make release
</verbatim>

---++ Perform install on nightly build machines

<ol>
<li>If desired, disable the nightly install command in gratia's crontab on the [[http://fermigrid.fnal.gov/gratia-development-organization.html][remote install host]]:
<pre>
%RED%#%ENDCOLOR%05 0 * * *  /home/gratia/cron-scripts/nightly-build.sh --mail gratia-builds@fnal.gov
</pre>
-- Main.ChrisGreen - 27 Jul 2010