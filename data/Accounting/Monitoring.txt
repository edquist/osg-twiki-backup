%META:TOPICINFO{author="PhilippeCanal" date="1234813787" format="1.1" reprev="1.4" version="1.4"}%
%META:TOPICPARENT{name="WebHome"}%
---+Monitoring tools

To monitor the health of a collector you have the following options:

---++Probes to Collector connection

To test the probe to collector connection, execute the script _GratiaPing.py_

This script will return the exit code 0 in case of successful connection to the server.

This script can be found in the probe/common directory.  You will need to execute it in a directory with a ProbeConfig pointing to your collector.

---++Collector record processing.

The collector can be setup to send mail if no record has been processed in a given time period.   To setup up this emails and its frequency, you need to edit the monitor/monitoring section in the Gratia service-configuration.properties (located in $tomcat_topdir/gratia )

<verbatim>
gratia-fermi.fnal.gov:8884 tomcat-conversion Potential listener problem

The MonitorListenerThread has detected a possible problem. There have been
no input records processed in the past 60 minutes. Please check the service.
</verbatim>

---++Collector Metrics

System status information can be found in the administration page http://yourhost:youport/gratia-administration.

The _normal_ status page shows the number of messages in the queue.  This messages have been received by the collector but not yet processed.  Those messages includes both the regular job level record, as well as handshake records and (possibly) duplication messages.  Each duplication message may contain more than one job level records.

It also shows the number of individual records and of duplicates records processed in each of the last 6 hours, the last day, the last week and forever.

The detailed page also include the number of error seen during the record processing (each error represent one record that was not processed).

---++Automated Status Monitoring

---+++General Health
Automated Status Monitoring can be done via the page:

http://gratiacollector:port/gratia-administration/monitor-status.html 

which issues things like:<verbatim>record-count-hour=15413|record-count-24hour=357661|queuesize0=40|</verbatim>

As of release v1.02/02, a xml version is also available:

http://gratiacollector:port/gratia-administration/monitor-status.html?xml=yes

<verbatim><record-count-hour>0</record-count-hour><record-count-24hour>0</record-count-24hour><queuesize thread=0>0</queuesize></verbatim>


---+++Site Specific

To get reporting information about all currently reporting sites, use http://gratiacollector:port/gratia-administration/monitor-status.html?allsites which gives Site Name, Probe Name, Last  Reporting Time:
<verbatim>
site=FNAL_CDFOSG_4|probename=condor:fcdfosg4.fnal.gov|last-contact=2009-02-10 19:07:20|
site=FNAL_DZEROOSG_1|probename=pbs:d0cabosg1.fnal.gov|last-contact=2009-02-10 19:07:18|
</verbatim>

To get the xml version use: http://gratiacollector:port/gratia-administration/monitor-status.html?allsites&xml=yes

<verbatim>
<site>FNAL_CDFOSG_4</site><probename>condor:fcdfosg4.fnal.gov</probename><last-contact>2009-02-10 19:07:20</last-contact>
<site>FNAL_DZEROOSG_1</site><probename>pbs:d0cabosg1.fnal.gov</probename><last-contact>2009-02-10 19:07:18</last-contact>
</verbatim>

Version prior to v1.02/02 issues text in the following format:<verbatim>AGLT2|condor:gate02.grid.umich.edu|2009-02-13 16:44:28
BNL_ATLAS_1|condor:gridgk01.racf.bnl.gov|2009-02-13 16:43:28
</verbatim>

In order to verify that your site is now reporting correctly, please wait until the relevant probe is no longer running (some probes may churn through a large local backlog before uploading records) before visiting the status page for your site: http://gratiacollector:port/gratia-administration/monitor-status.html?sitename=mySiteName. which gives ProbeName and Last reporting time
<verbatim>probename=glexec:fcdfosg3.fnal.gov|last-contact=2009-02-10 19:07:21|
probename=condor:fcdfosg3.fnal.gov|last-contact=2009-02-10 19:07:19|
</verbatim>or in xml http://gratiacollector:port/gratia-administration/monitor-status.html?sitename=mySiteName&xml=yes
<verbatim><probename>glexec:fcdfosg3.fnal.gov</probename><last-contact>2009-02-10 19:07:21</last-contact>
<probename>condor:fcdfosg3.fnal.gov</probename><last-contact>2009-02-10 19:07:19</last-contact>
</verbatim>

Prior to version v1.02/02 the output looked like:

<verbatim>condor:gate02.grid.umich.edu: last-contact=2009-02-13 16:44:28
condor:gate01.aglt2.org: last-contact=2009-02-13 16:44:27</verbatim>

---+++Probe Specific.

To see information about a single probe use http://gratiacollector:port/gratia-administration/monitor-status.html?probename=MyProbeName which gives: <verbatim>last-contact=2009-02-13 16:44:28|</verbatim>or in xml
ttp://gratiacollector:port/gratia-administration/monitor-status.html?probename=MyProbeName&xml=yes<verbatim><last-contact>2009-02-10 19:07:21</last-contact></verbatim>

---+++Host specifc information

To see information about a single host use http://gratiacollector:port/gratia-administration/monitor-status.html?host=MyHostName: <verbatim>last-contact=2009-02-13 16:44:28|</verbatim>
or in xml
ttp://gratiacollector:port/gratia-administration/monitor-status.html?host=MyHostName&xml=yes<verbatim><last-contact>2009-02-10 19:07:21</last-contact></verbatim>

-- Main.PhilippeCanal - 02 Jul 2008
