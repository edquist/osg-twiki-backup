%META:TOPICINFO{author="KyleGross" date="1225985965" format="1.1" version="1.16"}%
%META:TOPICPARENT{name="IncidentInformation2008"}%
*OSG PROTECTED INFORMATION - DO NOT DISTRIBUTE*

%TOC%


---+ Debian !OpenSSL Bug DSA-1571, 13May2008

http://www.debian.org/security/2008/dsa-1571

http://www.ubuntu.com/usn/usn-612-1 

http://www.ciac.org/ciac/bulletins/s-293.shtml

http://wiki.debian.org/SSLkeys

http://metasploit.com/users/hdm/tools/debian-openssl/

This vulnerability means that someone can take a public certificate that happens to have one
of the weak keys and in a matter of hours find the corresponding private key value and then use that
public certificate for whatever purposes it was authorized.  This is just the same as if the private key was
stolen.  

OSG perceives this as a small risk because the VDT versions up to 1.9 always links against the Globus's openSSL libraries, which are NOT affected by this vulnerability. This means even on a flawed Debian machine, if you requested a certificate by using VDT command line tools, your certificates would not be exposed to this vulnerability.  

the VDT version 1.9 directly links against the system openSSL. However, this version has ONLY been used by ITB (Integration Test Bed) folks. So none of the OSG users except ITB people must be exposed to this vulnerability. (As a side note, one of our ITB folks reported that he generated certificates on a flawed Debian machine with VDT 1.9, but his certificate was not weak. We think the reason may be because the VDT cert-request scripts introduces some additional randomness into the process. Nevertheless, we recommend strongly to apply patches to all Debian systems.) 

As a precaution, we contacted the IGTF and asked a response from all OSG-recognized CAs. The CAs are asked whether any of the user's certificates were vulnerable (generated with Debian libraries). The following section shows the responses from the CAs. As you notice below some CAs caught weak user certificates and revoked them. This may be because the user generated certificates without using the VDT, directly via openSSL, or the user may be used another software such as gLite (the European software for grid computing -- we do not know which library gLite links against).  

As of May 23, all IGFT CAs have reviewed the currently valid certificates for all subscribers and have revoked certificates based on weak key material.
See the [[http://www.eugridpma.org/newsletter/eugridpma-newsletter-20080523.txt][IGTF Announcement]] for details.

---++ OSG Distributed CAs Status
The OSG distributes a package of CAs (CA-Certificates), listed in the table below for the release
on May 17 for IGTF 1.21.
The status of checking the valid certificates issued by those CAs for weak keys caused by the
Debian openssl vulnerability is indicated in the first column.
Verified = %Y% means that the certificates have been checked and no valid
certificates have the weak keys subject to this vulnerability.  The "+" sign next to the %Y% means that the CA checked for all affected certificates and the found weak certificates have been revoked. No entry in the first column ("verified" column) means we either have
no information or possibly some certificates with weak keys have been found.

The 5th column, "EE certs in OSG" indicates whether or not that CA was found to have
issued certificates that are listed in the authorized VirtualOrganizations/VOInfoMS servers accepted by OSG.

|Verified|Hash|Source|More Information| EE certs in OSG@ |
|%Y%+|03aa0ecb|Belgium - BeGrid|https://gridra.belnet.be/pub/| no |
|%Y%|0a12b607|UGrid - Ukraine|https://ca.ugrid.org/| no |
|%Y%|0a2bac92|Brazil - BrGrid|https://brgridca.ic.uff.br/| yes |
|%Y%|1149214e|Germany - DFN-GridGermany-Root|http://www.pca.dfn.de/| no |
|%Y%|11b4a5a2|Portugal - LIPCA|http://ca.lip.pt/| yes |
|%Y%|12a1d8c2|France - GRID-FR|http://igc.services.cnrs.fr/GRID-FR/| yes |
|%Y%|1691b9ba|Turkey - TRGrid|http://www.grid.org.tr/ca/| yes |
|%Y%|16da7552|The Netherlands - NIKHEF|http://certificate.nikhef.nl/| yes |
|%Y%|1c3f2ca8|USA - DOE Grids|http://www.doegrids.org/| no |
|%Y%|1d879c6c|CERN-TCA|http://www.cern.ch/ca| yes |
|%Y%+|1e12d831|APAC|http://www.vpac.org/twiki/bin/view/APACgrid/CaInterface| yes |
|%Y%|1e43b9cc|Ireland - Grid-Ireland|http://www.cs.tcd.ie/grid-ireland/gi-ca/| no |
|%Y%|1f0e8352|Nordic countries - NorduGrid|http://hep.nbi.dk/CA/| yes |
|%Y%+|1f3834d0|RomanianGRID - Romania|http://www.romaniangrid.ro| yes |
|%Y%|2418a3f3|BG-ACAD (Bulgarian Academic CA)|http://www.ca.acad.bg/| yes |
|%Y%|24c3ccde|UNAM Grid - Mexico|http://ca.unamgrid.unam.mx/| yes |
|%Y%|28a58577|Greece - HellasGrid (Root 2006)|http://www.grid.auth.gr/pki/hellasgrid-root-ca-2006/| no |
|%Y%|290a3b29|USA - PSC Kerberos CA|http://www.psc.edu/ca/| no |
|%Y%|295adc19|Chile - REUNA CA|http://reuna-ca.reuna.cl/| yes |
|%Y%|2a237f16|Baltic States - Baltic Grid CA|http://ca.balticgrid.org/| no |
||2ca73e82|USA - USC|http://www.usc.edu/its/services/authx/CA/| no |
|%Y%+|2f3fadf6|INFN|http://security.fi.infn.it/CA/| yes |
|%Y%|304cf809|SWITCHslcs|http://www.switch.ch/pki/grid| yes |
|%Y%|34a509c3|France - CNRS-Projets|http://igc.services.cnrs.fr/| yes |
|%Y%|34f8e29c|Germany - DFN-GridGermany-User|http://www.pca.dfn.de/| no |
|%Y%|367b75c3|UK eScience CA 2007|http://www.grid-support.ac.uk/ca/| no |
|%Y%|393f7863|Serbia - AEGIS|http://aegis-ca.rcub.bg.ac.yu/| yes |
|%Y%|3d5be7bc|Slovenia - SiGNET CA|http://signet-ca.ijs.si/| yes |
|%Y%|3deda549|San Diego Supercomputing Center|http://www.sdsc.edu/CA/| no |
|%Y%|468d15b3|Balkans - SeeGrid|http://www.grid.auth.gr/pki/seegrid-ca/| yes |
|%Y%|47d3d1a0|SWITCH-Personal-2007|http://swisssign.net| no |
| %Y% |4a6cd8b1|USA - NCSA|http://security.ncsa.uiuc.edu/CA/| no |
|%Y%+|55994d72|Russia - RDIG|http://ca.grid.kiae.ru/RDIG/| yes |
|%Y%|566bf40f|Estonia - Estonian Grid|http://grid.eenet.ee/| no |
|%Y%|5e5501f3|Hungary - KFKI RMKI|http://pki.kfki.hu/| yes |
|%Y%|617ff41b|Japan - KEK|https://gridca.kek.jp/| no |
|%Y%|67e8acfa|Purdue TeraGrid RA|http://tg-ca.purdue.teragrid.org:8080/ejbca/| yes |
|%Y%|6e3b436b|Austria - AustrianGrid|https://ca.austriangridca.at/| yes |
|%Y%|6fee79b0|Israel - IUCC|http://certificate.iucc.ac.il/| yes |
|%Y%|722e5071|Korea - KISTI 2007|http://ca.gridcenter.or.kr/| no |
|%Y%|7b2d086c|Switzerland - SwissSign (Root)|http://swisssign.net/| no |
|%Y%|7b54708e|Morocco: MAGrid CA|http://www.magrid.ma/ca| no |
|%Y%|7d0d064a|MARGI - Macedonia|http://www.margi-ca.marnet.net.mk| no |
|%Y%|8175c1cd|United Kingdom-UK e-Science (Root)|http://www.grid-support.ac.uk/ca/| no |
|%Y%|82b36fca|Greece - HellasGrid (2006)|http://www.grid.auth.gr/pki/hellasgrid-root-ca-2006/| yes |
|%Y%|8a047de1|NECTEC GOC|http://gridca.hpcc.nectec.or.th/| no |
|%Y%|8a661490|Poland - PolishGrid|http://www.man.poznan.pl/plgrid-ca/| yes |
|%Y%|95009ddc|Purdue CA|http://tg-ca.purdue.teragrid.org:8080/ejbca/| no |
|%Y%|98ef0ee5|UK eScience Root CA 2007|http://www.grid-support.ac.uk/ca/| no |
|%Y%|9a1da9f9|TACC|http://www.tacc.utexas.edu/CA/| no |
|%Y%+|9b59ecad|Czech Republic - CESNET|http://www.cesnet.cz/pki/| yes |
|%Y%|9b88e95b|USA - PSC Root CA|http://www.psc.edu/ca/| no |
|%Y%|9b95bbf2|USA - NCSA MICS|http://security.ncsa.uiuc.edu/CA/| no |
|%Y%|9cd75e87|Academia Sinica Grid CA 2007|http://ca.grid.sinica.edu.tw/| yes |
|%Y%|9dd23746|pkIRISGRID|http://www.irisgrid.es/pki/| yes |
|%Y%|a317c467|Japan - AIST|https://www.apgrid.org/CA/AIST/Production/| no |
|%Y%|a692434d|Taiwan - ASGCCA|http://ca.grid.sinica.edu.tw/| yes |
|%Y%|a87d9192|Japan - NAREGI|https://www.naregi.org/ca/| no |
|%Y%|a9082267|Latin American and Caribbean Catch|-all Grid CA http://lacgridca.ic.uff.br/| no |
|%Y%|acc06fda|USA - PSC Hosts CA|http://www.psc.edu/ca/| no |
|%Y%|adcbc9ef|United Kingdom - UK e-Science (CA)|http://www.grid-support.ac.uk/ca/| yes |
|%Y%+|afe55e66|Cyprus - CyGrid|http://grid.ucy.ac.cy/CyGridCA/| yes |
|%Y%|b2771d44|China - CNIC Grid CA|http://ca.grid.cn/en/| no |
|%Y%|b7bcb7b2|Argentina - UNPL Grid CA|https://www.pkigrid.unlp.edu.ar/| no |
|%Y%|b89793e4|NPACI|http://www.npaci.edu/CA/| no |
|%Y%|ba2f39ca|China - IHEP|https://gridca.ihep.ac.cn/| yes |
|%Y%|bffbd7d0|GridCanada|http://www.gridcanada.ca/ca| yes |
|%Y%|c4435d12|Switzerland - SwissSign (SWITCH)|http://swisssign.net/| no |
|%Y%|c48c63f3|China - CNIC SDG CA|http://ca.sdg.grid.cn/en/| no |
|%Y%|cc800af0|Hungary - NIIF|http://www.ca.niif.hu/| no |
|%Y%|cf4ba8c8|France - CNRS (EDG Catch-all CA)|http://igc.services.cnrs.fr/| no |
|%Y%|d0c2a341|Armenia - ArmeSFo|http://www.escience.am/ca/| no |
|%Y%|d0b701c0|SWITCHGrid Root|http://www.switch.ch/pki/grid| no |
|%Y%|d1b603c3|US - ESnet Root|http://www.doegrids.org/| no |
|%Y%|d254cc30|CERN-ROOT|http://www.cern.ch/ca| no |
|%Y%|d2a353a5|Pakistan - PK Grid CA|http://www.ncp.edu.pk/pk-grid-ca/| no |
|%Y%|dd4b34ea|Germany - GermanGrid|http://grid.fzk.de/| yes |
|%Y%+|e13e0fcf|Slovakia - SlovakGrid|http://ups.savba.sk/ca/| yes |
|%Y%|e1fce4e9|Fermilab KCA CA|https://computing.fnal.gov/security/pki/| yes |
|%Y%|e36e7a72|Switzerland - SwissSign (Bronze)|http://swisssign.net/| no |
|%Y%|e9d08b40|Switzerland - SwissSign (Silver)|http://swisssign.net/| no |
|%Y%|eebc7717|SWITCH-Server-2007|http://swisssign.net/| no |
|%Y%|f2e89fe3|USA - NCSA SLCS|http://security.ncsa.uiuc.edu/CA/| no |
|%Y%|f5ead794|PK-Grid-2007|http://www.ncp.edu.pk/pk-grid-ca/| no |
|%Y%|fe102e03|Germany - DFN-GridGermany-Server|http://www.pca.dfn.de/| no |
|%Y%+|ff94d436|Croatia - SRCE|http://ra.srce.hr/| no |

+ Certificates have been checked by the CA and the affected certificates have been revoked.

@ Note that Root CAs and other CAs above those issuing end entity (EE) certificates
are necessary for validating certificate authentication but do not show up as having EE certs on OSG.


---++ Possible remedial action for site security

The Trusted CAs are located in the directory $VDT_LOCATION/globus/TRUSTED_CA.
To temporarily remove CAs from being accepted as trusted you can move them
to a different directory and later move them back.  For example:
<pre>
$ cd $VDT_LOCATION/globus/TRUSTED_CA
$ mkdir suspend
$ mv HHHHHHHH.* suspend
</pre>
where <tt>HHHHHHHH</tt> is the hash value for a particular CA. This will move all the associated files for that CA
to a subdirectory called suspend.  To later restore that CA as  trusted, enter the suspend subdirectory and move them back,
i.e., <br><tt>$ mv HHHHHHHH.* ..</tt>.

However, first ensure that the Trusted CAs are not being automatically maintained (via =vdt-update-certs= or =yum-cron=) or your manual changes may be lost.
See http://vdt.cs.wisc.edu/releases/1.8.1/certificate_authorities.html for details.
To check if you are using vdt-update-certs do
<pre>
$ source $VDT_LOCATION/setup.sh
$ vdt-control --list
</pre>
If you see <tt>vdt-update-certs   | cron   | enable</tt> then you can turn off this service by doing<br>
<tt>$ vdt_control --off vdt-update-certs</tt><br>
%RED%However, if you do this you must remember to eventually turn the vdt-update-certs back on or you will not get
important updates to the CA certificates.! %ENDCOLOR%

---++UK E-Science CA Issues

The UK E-Science Root CA has been updated as a result of this issue.
See the [[http://www.eugridpma.org/newsletter/eugridpma-newsletter-20080516.txt][IGTF Announcement]].
This update is available in the latest [[http://vdt.cs.wisc.edu/certificate_authorities.html][VDT CA Certificates]] release.
Run =vdt-update-certs= or =yum-cron= according to the [[http://vdt.cs.wisc.edu/certificate_authorities.html][VDT CA Certificates documentation]] to update your CA certificates.

To check if you are running =vdt-update-certs= automatically, do
<pre>
$ source $VDT_LOCATION/setup.sh
$ vdt-control --list
</pre>
If you see <tt>vdt-update-certs   | cron   | enable</tt> then you should already have up-to-date CA certificates.

Good fingerprints of the updated certificates are:

<pre>
$ openssl x509 -subject -fingerprint -sha1 -noout -in $VDT_LOCATION/globus/TRUSTED_CA/98ef0ee5.0
subject= /C=UK/O=eScienceRoot/OU=Authority/CN=UK e-Science Root
SHA1   = A1:39:B0:F3:04:6C:0B:F9:F5:0A:1B:33:00:06:4F:83:6B:7D:4F:3E

$ openssl x509 -subject -fingerprint -sha1 -noout -in $VDT_LOCATION/globus/TRUSTED_CA/367b75c3.0
subject= /C=UK/O=eScienceCA/OU=Authority/CN=UK e-Science CA
SHA1   = CA:1C:B6:6C:A9:E3:27:4D:F7:3E:A9:EB:6A:33:3F:C1:A2:B1:B8:D7
</pre>

whereas the weak certificates are:

<pre>
subject= /C=UK/O=eScienceRoot/OU=Authority/CN=UK e-Science Root
SHA1   = B1:77:5E:BB:11:13:B4:B5:0E:40:57:F1:E0:6A:BE:B9:4E:44:B7:45

subject= /C=UK/O=eScienceCA/OU=Authority/CN=UK e-Science CA
SHA1   = 31:C1:93:3D:E8:9C:C4:B7:8A:02:B5:2D:56:D5:6B:43:56:0B:9F:CA
</pre>

*Because the keys of the UK e-Science root CA changed but not the keys of the subordinate issuing CA, UK e-Science certificate holders do not need to replace their certificates.*

Please ensure that your CRL files for the UK e-Science CAs (98ef0ee5.r0 and 367b75c3.r0) are up-to-date.  This is the common cause for UK e-Science certificates failing to be accepted since the change.  You can verify your CRL files with the following commands:

<pre>
$ openssl crl -noout -CAfile $VDT_LOCATION/globus/TRUSTED_CA/98ef0ee5.0 < $VDT_LOCATION/globus/TRUSTED_CA/98ef0ee5.r0
verify OK
$ openssl crl -noout -CAfile $VDT_LOCATION/globus/TRUSTED_CA/367b75c3.0 < $VDT_LOCATION/globus/TRUSTED_CA/367b75c3.r0
verify OK 
</pre>

You should see <pre>verify OK</pre> in the output as shown above.

If your CRL files are not up-to-date, please use [[http://vdt.cs.wisc.edu/components/fetch-crl.html][fetch-crl]].

-------------------
   * Set ALLOWTOPICVIEW = Main.GridGroup
   * Set ALLOWTOPICCHANGE = Main.DougOlson, Main.SecurityTeamGroup
   * Set DENYTOPICVIEW = Main.TwikiGuest

-- Main.DougOlson - 19 May 2008