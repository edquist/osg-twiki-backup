%META:TOPICINFO{author="MarkoSlyz" date="1312574751" format="1.1" version="1.4"}%
%META:TOPICPARENT{name="OsgRaOperations"}%
<blockquote>
%GREEN%
We are in the process of reorganizing the documentation on user
certificates. Please go to the [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/CertificateGet][How do I get a DOEGrids PKI/X509 Personal Certificate?]] 
page for more up-to-date information.
 %ENDCOLOR%
</blockquote>


%DOC_STATUS_TABLE%

%TOC%

---+ !FireFox web browser

---++ FF Version 3.0.12
---+++ Install the ESnet Root and DOEGrids CA Certificates
The Terena organization maintains a secure repository of CA certificates for
European NRENs and the IGTF.
Go to https://www.tacar.org/repos and click on the *install* button next to
the *ESnet Root CA*.

<img src="%ATTACHURLPATH%/sel-esnet.png" alt="sel-esnet.png" width='600' height='420' /> 

Check the boxes to *Trust this CA* on the pop-up window and click *OK*.

<img src="%ATTACHURLPATH%/trust-esnet.png" alt="trust-esnet.png" width='600' height='320' />

To verify that the certificate was installed select *Edit/Preferences* then *Advanced* and
the *Encryption* tab.

<img src="%ATTACHURLPATH%/adv-prefs.png" alt="adv-prefs.png" width='571' height='556' />

Then click on *View Certificates* and select the *Authorities* tab, and scroll down to show *ESnet*.

<img src="%ATTACHURLPATH%/cm-esnet.png" alt="cm-esnet.png" width='600' height='420' />

---+++ Set a master password to encrypt keys and passwords
You should set a master password for Firefox so that private keys and other web passwords
that Firefox remembers will be encrypted.
Select *Edit/Preferences*, check the box for *Use a master password* and click the
*Change Master Password* button.

<img src="%ATTACHURLPATH%/firefox-masterpass.png" alt="firefox-masterpass.png" width='571' height='556' />   

---+++ Request a personal certificate from DOEGrids
After installing the ESnet Root CA in your browser as a trusted CA (see above), go to
https://pki1.doegrids.org.
 <img src="%ATTACHURLPATH%/pki1.png" alt="pki1.png" width='600' height='420' /> 

Enter the requested information in the form
   1. your name, email and phone
   1. select your registration authority (OSG)
   1. select your VO
   1. your sponsor's name, email and phone
<img src="%ATTACHURLPATH%/preq.png" alt="preq.png" width='600' height='620' />

Enter a short description of why you need a certificate in the comment box,
make sure the Key Length shows High Grade, and click *Submit*.
Note that for other browsers there will be a different description and choices
than "Key Length and High Grade".
<img src="%ATTACHURLPATH%/preq2.png" alt="preq2.png" width='600' height='620' />

You should get a prompt to enter the master password for the Software Security Device so
that the private key being generated will be encrypted. Enter your password and click *OK*.

 <img src="%ATTACHURLPATH%/cm-mp.png" alt="cm-mp.png" width='521' height='166' /> 

You should get a page that shows *Request Successfully Submitted* and your *request ID* number.
It is helpful to remember the request ID number and include that in any email or questions you
have about your certificate request.  It can also be used later to check the status of your
request or download your certificate, after clicking on the Retrieval tab.

 <img src="%ATTACHURLPATH%/psubmitted.png" alt="psubmitted.png" width='600' height='620' />  

---+++ Download and install your requested certificate
When your certificate request has been processed and a certificate issued you will receive an email
containing some instructions and a link to follow in order to download and install your certificate
into your web browser. 

 <img src="%ATTACHURLPATH%/cert-email.png" alt="cert-email.png" width='600' height='500' />

Click the link in the email, or copy the URL into your web browser to display the certificate.
The private key is generated in your web browser when you submit
the request and you must download the certificate with that same browser or you won't
have a private key matching the certificate and installing the certificate will fail.


<img src="%ATTACHURLPATH%/display-cert.png" alt="display-cert.png" width='600' height='620' />

Scroll down to the bottom of the page and click on *Import Your Certificate*.  

<img src="%ATTACHURLPATH%/display-cert2.png" alt="display-cert2.png" width='600' height='620' />

You should get a prompt
for the master password so that the private key can be accessed to match with the new certificate.
Enter your password and click *OK*.

 <img src="%ATTACHURLPATH%/cm-mp.png" alt="cm-mp.png" width='521' height='166' /> 

To verify that the certificate was installed select *Edit/Preferences*, then *Advanced* and click on
*View Certificates* and select the *Your Certificates* tab. You should see your new certificate
listed under the DOEGrids CA 1.

<img src="%ATTACHURLPATH%/cm-pcert.png" alt="cm-pcert.png" width='600' height='420' />   

If you don't see your new certificate then click on the *People* tab and see if it appears there.
If it does it means that the private key for that certificate was not in your browser
and you probably did not use this browser for making the original request.

---+++ Export your personal certificate from Firefox
In order to use your certificate for grid tools or in your email client you need to
export it from Firefox to a file that you can access with the other tools.
Open the Firefox Certificate Manager, *Edit/Preferences* then *Advanced*, *Encryption*, and *View Certificates* and
select the *Your Certificates* tab.

<img src="%ATTACHURLPATH%/cm-pcert.png" alt="cm-pcert.png" width='600' height='420' />  

Select your certificate and click the *Backup...* button.  You should get a dialog box for the filename
for the exported certificate.  The file will be stored in PKCS12 format so give the filename a .p12 extension.

<img src="%ATTACHURLPATH%/pcert-backup.png" alt="pcert-backup.png" width='509' height='212' />

You should then get a prompt for the master password for the Software Security Device. Enter the
password and click *OK*.

 <img src="%ATTACHURLPATH%/cm-mp.png" alt="cm-mp.png" width='521' height='166' /> 

Next you should get a prompt to *Choose a Certificate backup Password* that is used to encrypt
the file.  Enter a good password that you will remember and click *OK*.

<img src="%ATTACHURLPATH%/backup-pw.png" alt="backup-pw.png" width='600' height='320' />

You should keep this file stored securely where only you can access it, and you should remember the password
used to encrypt it.  This file can be used to load your certificate into your email client for sending SMIME digitally signed email
or for extracting the PEM format certificate and private key files for use with grid tools.

---++ FF Version 2.0.0.4

---+++ View Certificates
Click on %ORANGE% Tools / Options ... / Advanced Tab / View Certificates %ENDCOLOR% button.

    <img src="%ATTACHURLPATH%/my-certificates.jpg" alt="my-certificates.jpg" width='662' height='370' />

The set of certificates which belong to you (for which you have private keys in your browser) are shown
under the %ORANGE% Your Certificates %ENDCOLOR% tab.
If you import your certificate but to not have the private key stored in your browser then it
will show up under the %ORANGE% Other People's %ENDCOLOR% tab.

---+++ Edit CA Certificate trust settings
Click on %ORANGE% Tools / Options ... / Advanced Tab / View Certificates %ENDCOLOR% button.

Then click on %ORANGE% Authorities %ENDCOLOR% and scroll down to the CA certificate
you want to edit.  Example, DOEGrids CA 1
     <img src="%ATTACHURLPATH%/cm-doegrids.jpg" alt="cm-doegrids.jpg" width='662' height='370' />

Click the Edit button.

    <img src="%ATTACHURLPATH%/edit-ca-untrusted.jpg" alt="edit-ca-untrusted.jpg" width='355' height='197' />

The image above shows the untrusted settings for the DOEGrids CA.
Select the check boxes to Trust this CA, as shown below, and then click OK.

     <img src="%ATTACHURLPATH%/edit-ca-trusted.jpg" alt="edit-ca-trusted.jpg" width='355' height='197' />

Repeat this for the ESnet Root CA to ensure it is also trusted.

-- Main.DougOlson - 13 Jun 2007
 
-- Main.DougOlson - 30 Jul 2009

<!-- CONTENT MANAGEMENT PROJECT

   DEAR DOCUMENT OWNER
   ===================

   Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER          = JamesBarlow

   Please define the document area, choose one of the defined areas from the next line
   DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = Security

   define the primary role the document serves, choose one of the defined roles from the next line
   DOC_ROLE = (Scientist|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

   Please define the document type, choose one of the defined types from the next line
   DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Knowledge
   
   Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

   Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

   change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

   change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %NO%

   change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


   DEAR DOCUMENT REVIEWER
   ======================

   Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = MineAltunay
  
   Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %NO%


   DEAR DOCUMENT TESTER
   ====================

   Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = AnandPadmanabhan
  
   Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %IN_PROGRESS%
 
-->

%META:FILEATTACHMENT{name="edit-ca-trusted.jpg" attr="" autoattached="1" comment="Edit CA, trusted settings" date="1181776087" path="edit-ca-trusted.jpg" size="17440" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="my-certificates.jpg" attr="" autoattached="1" comment="Viewing Your Certificates" date="1181776439" path="my-certificates.jpg" size="54149" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="edit-ca-untrusted.jpg" attr="" autoattached="1" comment="Edit CA, untrusted settings" date="1181775911" path="edit-ca-untrusted.jpg" size="17304" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="cm-doegrids.jpg" attr="" autoattached="1" comment="FireFox Certificate Manager" date="1181775786" path="cm-doegrids.jpg" size="47455" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="sel-esnet.png" attachment="sel-esnet.png" attr="" comment="TACAR ESnet screen" date="1248995601" path="sel-esnet.png" size="96500" stream="sel-esnet.png" tmpFilename="/usr/tmp/CGItemp64455" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="trust-esnet.png" attachment="trust-esnet.png" attr="" comment="Trust ESnet CA" date="1248995790" path="trust-esnet.png" size="28640" stream="trust-esnet.png" tmpFilename="/usr/tmp/CGItemp64426" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="adv-prefs.png" attachment="adv-prefs.png" attr="" comment="Advanced Preferences" date="1248996017" path="adv-prefs.png" size="36161" stream="adv-prefs.png" tmpFilename="/usr/tmp/CGItemp64313" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="cm-esnet.png" attachment="cm-esnet.png" attr="" comment="Cert Manager - ESnet" date="1248996155" path="cm-esnet.png" size="45138" stream="cm-esnet.png" tmpFilename="/usr/tmp/CGItemp64407" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="pki1.png" attachment="pki1.png" attr="" comment="pki1" date="1248996287" path="pki1.png" size="91696" stream="pki1.png" tmpFilename="/usr/tmp/CGItemp64405" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="preq.png" attachment="preq.png" attr="" comment="Personal certificate request" date="1248996517" path="preq.png" size="81033" stream="preq.png" tmpFilename="/usr/tmp/CGItemp64372" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="preq2.png" attachment="preq2.png" attr="" comment="Submit request" date="1248996845" path="preq2.png" size="77566" stream="preq2.png" tmpFilename="/usr/tmp/CGItemp64427" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="psubmitted.png" attachment="psubmitted.png" attr="" comment="Request Submitted" date="1248997175" path="psubmitted.png" size="58334" stream="psubmitted.png" tmpFilename="/usr/tmp/CGItemp64426" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="firefox-masterpass.png" attachment="firefox-masterpass.png" attr="" comment="FF master password" date="1248997861" path="firefox-masterpass.png" size="44242" stream="firefox-masterpass.png" tmpFilename="/usr/tmp/CGItemp64394" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="cert-email.png" attachment="cert-email.png" attr="" comment="Certificate issued email" date="1248998139" path="cert-email.png" size="60244" stream="cert-email.png" tmpFilename="/usr/tmp/CGItemp64383" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="display-cert.png" attachment="display-cert.png" attr="" comment="Display certificate" date="1248998477" path="display-cert.png" size="85378" stream="display-cert.png" tmpFilename="/usr/tmp/CGItemp64089" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="display-cert2.png" attachment="display-cert2.png" attr="" comment="Import your certificate" date="1248998719" path="display-cert2.png" size="108242" stream="display-cert2.png" tmpFilename="/usr/tmp/CGItemp64350" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="cm-mp.png" attachment="cm-mp.png" attr="" comment="FF master password prompt" date="1248999085" path="cm-mp.png" size="12104" stream="cm-mp.png" tmpFilename="/usr/tmp/CGItemp64322" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="cm-pcert.png" attachment="cm-pcert.png" attr="" comment="Show your certificate in CM" date="1248999495" path="cm-pcert.png" size="25517" stream="cm-pcert.png" tmpFilename="/usr/tmp/CGItemp64349" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="pcert-backup.png" attachment="pcert-backup.png" attr="" comment="Backup personal certificate" date="1249002613" path="pcert-backup.png" size="13407" stream="pcert-backup.png" tmpFilename="/usr/tmp/CGItemp64340" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="backup-pw.png" attachment="backup-pw.png" attr="" comment="Backup password" date="1249002883" path="backup-pw.png" size="26141" stream="backup-pw.png" tmpFilename="/usr/tmp/CGItemp64413" user="DougOlson" version="1"}%
