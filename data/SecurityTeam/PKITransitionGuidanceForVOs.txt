%META:TOPICINFO{author="KyleGross" date="1481047952" format="1.1" version="1.9"}%
%TOC%

---++OSG PKI Transition Guidance for VOs

---+++ Overview
This document provides the overall guidance for VOs regarding the OSG PKI Transition. It describes the tasks that a VO should perform for a smooth transition. Although OSG provides documentation for end users and system administrators, some tasks are specific for a VO and should be decided and documented by the VO management. This document lists such VO-specific tasks and provides guidance for VOs on their planning and execution.

---+++ Recommendations
   * Assign a VO PKI Transition Coordinator
      * We recommend you assign a person to coordinate the PKI transition activities within your VO. This person should make sure that system administrators and end users can perform their tasks and make sure they get any help needed (when things go wrong and/or instructions and/or forms are not clear).        
   * Prepare documentation for End Users and System Administrators
      * We strongly recommend that VOs prepare documentation for their end users and system administrators tailored to their specific situation based on the VO-specific tasks.
   * Make a Support Plan
      * Although we plan for a smooth transition period, unanticipated issues may occur.  VOs should alert their system administrators that they may need to help users troubleshoot transition related problems. 
      * The VO PKI Transition Coordinator should provide end-users with  instructions on how to report problems, and  help system administrators handle such issues. 
   
---+++Who is impacted by the transition?

    All systems and end users with certificates from DOEGrids CA. 

In particular:
   * A service or an end user with a service certificate (e.g. rsv/myce.fnal.gov) issued by the DOEGrids CA. 
   * A service that authorizes end users based on user certificates must be tested to make sure it can accept certificates issued by the !DigiCert CA.  Note that, even though the service may not itself be identified through a certificate from DOEGrids CA  (for example the services cert is from INFN) the service it is still impacted and must be modified to allow access to end users based on their new certificates from the OSG.  

---+++What is the impact of the transition?

   * On January 30, 2012 the DOEGrids CA will start encouraging users to use other CAs, in particular the OSG PKI.
   * After March 23rd 2013, the DOEGrids CA will stop issuing or renewing certificates.
   * System administrators should follow the steps to obtain their new certificates from the OSG. 
   * System and service administrators should configure their systems and services to trust the  DigiCert Root CA certificates. 
   * End users should obtain new certificates and register these certificates with any services that require such registration (e.g. DocDB)


For example:

   * If a certificate is set to expire in February 2013. The certificate owner can choose to either renew the certificate with DOEGrids or to get a new certificate from OSG CA. If the  certificate is renewed with DOEGrids CA it will then expire in February 2014 and before or at that time the certificate owner will need to get a new certificate from OSG CA.
   * If a certificate from DOEGrids CA is set to expire in August 2013,  the existing certificate will work fine until this  date. However, before it expires in August 2013, the certificate owner  needs to to follow the steps below to get a new certificate from OSG.
  


---+++ VO-Specific Tasks 

---++++ General Planning Tasks

   1 Identify a VO PKI Transition Coordinator who will coordinate the transition tasks within  and for the VO. 
   2 Make sure the OSG PKI Transition team and the VO PKI Transition Coordinator communicate frequently  and keep each other up to date with their plans and issues. 
   3. Make a Support Plan  to deal with problems and errors reported by users and admins. If the OSG ticketing system will be used, make sure the GOC, VO system administrators and end users are aware of how to use this system.
   4 Create documentation tailored specifically for the VO, detailing the tasks (described below) to be done.. 

---++++ Tasks Related to Services/Hosts
 
   1 Identify any services that have a service and/or host certificate from DOEGrids CA. 
   2 Make a list of the expiration dates for the host/service certificates. 
      * Remind the service operators to check the list monthly,  as each month more certificates will expire. 
      * It is very important that the service operators obtain new host/service certificates from OSG CA before the expiration date. 
      * We recommend that replacement certificates from OSG CA should be obtained a month before the expiration date of the current certificates. 
   3 Identify any  services that authorize end users based on their end user certificates. 
      * These services new to register the new user certificate for each user that obtains their new certificate from OSG CA. 
      * For example, the CMS VO has a list of VOMS, GGUS ticketing system, pilot based submission servers, CERN twikis and indico service, and various other services that all use certificates to authorize users. 
      * It is the VO's responsibility to identify all such services and write the necessary documentation in support of the users. 
   4 Encourage service operators to first build a test instance of the services that they run and perform the changes in the test instance.
   5 Direct service operators to OSG documentation on how to obtain [[https://confluence.grid.iu.edu/display/CENTRAL/User+Guide][host/service certificates]].  
      * OSG has a web-based request form for making certificate requests. If you prefer commandline tools to request and retrieve your certificates, follow the instructions on https://twiki.grid.iu.edu/bin/view/Operations/OSGPKICommandlineClients.
   6 Distribute the new service/host certificates to third parties if needed for service-service handshakes. 
      * For a VOMS server, the new VOMS host certificate should be distributed to all GUMS services. The vomses file distributed by OSG contains the certificate information for each VOMS server. 
      * When your certificate change, notify the OSG GOC via a ticket so that your new certificate can be included in the vomses file. 
   7 The service operators should also update the list of trusted root Certificate Authorities. 
      * This step will allow the service to accept and trust the DigiCert trust roots, DigiCert root and intermediate Certificate Authorities. 
      * For a grid resource, simply do a *yum update osg-ca-certs* or *yum update osg-ca-certs-compat* depending on your system's openssl version. This will update your /etc/grid-security/certificates directory with the latest CA files form OSG. If you do not use rpms, get the CA tarballs by following instructions at https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallCertAuth
      * If this is not a grid resource, e.g. a web service, then download the trust roots from http://digicert-grid.com/. Find the instructions specific to your service to add the CA certificates.
   8. On each grid resource update the vomses file. 
      * Each vomses file has a list of all VOMS servers and their certificate DNs. As VOMS servers change their own certificates from DOEGrids CA to OSG CA, vomses file will be updated. 
      * The OSG Grid Operation Center updates and distributes the most recent vomses file at http://software.grid.iu.edu/pacman/tarballs/vo-package/vomses 
   9. End User Authorization. 
      * Document the steps necessary for the services (identified in #3) to register the new user certificates. Consider whether a service can and should register multiple certificates for a single user. Some services simply do not have the capability to do so. You can visit [[https://twiki.grid.iu.edu/bin/view/Security/DOEGrids2DigiCertDNTransition][this link]] for more information on this topic.
      * In particular, we strongly recommend that VOMS+VOMRS server should not try to register multiple certificates for a single user account. Instead, the VOMS Admin should create a separate VOMS user account for each user certificate. This is because the GUMS server version installed at most OSG sites cannot handle multiple certificates downloaded from the VOMS servers. (We will provide additional instructions on how to achieve this). 
      * As a result of having separate VOMS accounts for each user certificate, each user certificate will be treated as a separate user at a grid site. In other words, each certificate will be mapped into a separate local unix account at a grid site. Consider if this is suitable for your VO operations. If it is necessary for your users to link to such accounts, please notify the OSG PKI team and we will help you work with sites. Sites can also manually change user mappings to make sure all user certificates are mapped into the same unix account.  
      * Grid resources (CE/SE) will receive the new user certificate DNs directly from the VOMS servers. The system admins will not have to do anything.
      * Non-grid services need to be updated manually by the system admin. If you have services such as twiki, ticketing systems, etc, provide documentation for your service operators on how they should register new user certificates. 
   10. Encourage service operators to test their services with the new OSG CA certificates.
   11. If everything works well, apply the changes to production servers.

---++++End User Transition Tasks

   1 Alert end users that they should apply to OSG CA for a certificate. We recommend that users should apply for new certificates a month before their current certificates expire. 
      * The instructions on how to obtain new certificates are available at https://confluence.grid.iu.edu/display/CENTRAL/User+Guide. 
   1 After obtaining the certificate, the users should import it into their browsers and the file system. This step is the same as it was for the DOEGrids CA.
   1 Users should extract the certificate Distinguished Name and  should register their new certificates with those VO services that authorize users based on user certificates. 
      * The VO should provide documentation on how end users do this registration their new certificates with VO services.
   1 If users have client-side tools installed on their personal machines, they should update the trust roots on their client side tools. 
      1 Users can do a *yum update osg-ca-certs* or *yum update osg-ca-certs-compat* depending on their system's openssl version. This will update the /etc/grid-security/certificates directory with the latest CA files form OSG. If they do not use rpms, they can get the CA tarballs by following instructions at https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallCertAuth
      2 The DigiCert CA certificates are available at http://digicert-grid.com/. 
   1 Users should test accessing VO services with their new certificates
   1 The VO should provide users with instructions on how to report problems. For example, document who the user should contact first if they lose access to a service after switching certificates. 







-- Main.MineAltunay - 07 Nov 2012
