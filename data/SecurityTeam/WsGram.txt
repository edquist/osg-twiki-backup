%META:TOPICINFO{author="AnandPadmanabhan" date="1350318810" format="1.1" version="1.4"}%
%META:TOPICPARENT{name="WebHome"}%
%TOC%

---+ Globus Gatekeeper Network Scan Reports Weak Cipher 
---++ Scan Report 
A routine network scan reported a weak cipher in the Globus Gatekeeper Service. 

---++ Problem - As reported by the scan

At one of the OSG sites, flagged port 2119, the Globus Gateway service on our CE as having a potential vulnerability, during a regular network scan. The reported the following.

<pre>

THREAT:
The Secure Socket Layer (SSL) protocol allows for secure communication between a client and a server.

The client-server communication is general encrypted using a symmetric cipher like RC2, RC4, DES or 3DES. However, some SSL ciphers allow communication without encryption. 
This vulnerability allows anyone who can sniff the traffic between the client and the server to see the communication.

Please note that this detection only checks for weak cipher support at the SSL layer. Some servers may implement additional protection at the data layer. 
For example, some SSL servers and SSL proxies (such as SSL accelerators) allow cipher negotiation to complete but send back an error message and abort further communication on the secure channel. 
This vulnerability may not be exploitable for such configurations.

Typically, for Apache/mod_ssl, httpd.conf or ssl.conf should have the following lines:
SSLProtocol -ALL +SSLv3 +TLSv1
SSLCipherSuite ALL:!ADH:!aNULL:!eNULL:!LOW:!EXP:RC4+RSA:+HIGH:+MEDIUM
For Apache/apache_ssl include the following line in the configuration file (httpsd.conf):
SSLRequireCipher ALL:!aNULL:!ADH:!eNULL:!LOW:!EXP:RC4+RSA:+HIGH:+MEDIUM
How to Control the Ciphers for SSL and TLS on IIS (http://support.microsoft.com/kb/245030)

COMPLIANCE:
Not Applicable

EXPLOITABILITY:
There is no exploitability information for this vulnerability.

ASSOCIATED MALWARE:
There is no malware information for this vulnerability.

RESULTS:
CIPHER KEY-EXCHANGE AUTHENTICATION MAC ENCRYPTION(KEY-STRENGTH) GRADE
SSLv3 SUPPORTS CIPHERS WITH NO
ENCRYPTION
</pre>

---++ Assessment 

Brain indicated the security scan is complaining that the globus-gatekeeper process allows the null cipher in SSL.

A cryptographic protocol like SSL can offer three things:
   1. encryption - can someone else read the message?
   2. integrity - has the message been tampered with?
   3. authentication - who is on the other side?

In general, for SSL, (1) and (3) are optional.  For GRAM, we require (3), but (1) is still optional.  If you run a bank website, (1) is probably required but (3) is optional (as you can use username/password instead of client certificates). So, the security scan is basically flagging something which is acceptable for our use case.  

---+++ Details about SSL in GSI

GSI is using one of the null encryption cipher suites (depending on the openssl version), typically something like NULL-SHA. The SSL handshake is done normally, using the client's (proxy) certificate and the host certificate for authentication and establishment of the session. The handshake is encrypted using the certificates' public keys to verify that the peers know the private keys associated with them. Once the ChangeCipherSpec is completed, the messages are merely integrity checked via the message sequence and hash of the payload. 

   1. Encryption: There is no encryption. 
   2. Integrity: The hashes of the payload include some secret information which is negotiated during the handshake, so integrity is maintained. The heavy details about HMAC computation used is described in https://tools.ietf.org/html/rfc2104.
   3. Authentication: Mutual authentication through the user of user proxy and host certificates 

---+++ Globus Assessment 
(from Joseph Bester)
<pre>
I agree with your assessment.

As the code stands now, both the client and gatekeeper propose the NULL cipher. 
Changing either to use message protection would eliminate this issue, but would require a different client or a minor code change to implement.

If OSG thinks this is an important issue, we can make this change rather easily. 
There's also some code in the GRAM client motivated by compatibility with GT 4.0.8 (which VDT widely distributed) that forces SSLv3 over TLSv1 that we'd like to remove at some point as well.
</pre>

---+ WS-GRAM Scan at BNL Reports Weak Cipher

A routine scan at BNL reported a weak cipher in the WS-GRAM Service. 

---++ Scan Results

<pre>
[Time of Last Scan: 2007-06-13 13:04:26]:


**************************************************
[1] Service: unknown (9443/tcp), Risk: LOW
**************************************************

Synopsis :

The remote service supports the use of weak SSL ciphers.

Description :

The remote host supports the use of SSL ciphers that
offer either weak encryption or no encryption at all.

See also :

http://www.openssl.org/docs/apps/ciphers.html

Solution :

Reconfigure the affected application if possible to avoid use of
weak ciphers.

Risk factor :

Low / CVSS Base Score : 2
(AV:R/AC:L/Au:NR/C:P/A:N/I:N/B:N)

Plugin output :

Here is a list of the SSL ciphers supported by the remote server :

Null Ciphers (no encryption)
SSLv3
NULL-MD5 Kx=RSA Au=RSA
Enc=None Mac=MD5

Medium Strength Ciphers (>= 56-bit and < 112-bit key)
SSLv3
DES-CBC-SHA Kx=RSA Au=RSA
Enc=DES(56) Mac=SHA1

High Strength Ciphers (>= 112-bit key)
SSLv3
DES-CBC3-SHA Kx=RSA Au=RSA
Enc=3DES(168) Mac=SHA1
RC4-MD5 Kx=RSA Au=RSA
Enc=RC4(128) Mac=MD5
RC4-SHA Kx=RSA Au=RSA
Enc=RC4(128) Mac=SHA1

The fields above are :

{OpenSSL ciphername}
Kx={key exchange}
Au={authentication}
Enc={symmetric encryption method}
Mac={message authentication code}
{export flag}
</pre>

---++ OSG and Globus Responses

---+++Globus and VDT

It is using weak ciphers, and it doesn't matter at all.

Here is a response from Globus. It was drafted by Von Welch. I edited it slightly to be more formal, and he approved my edits.

------------------------------
It is not a concern that the Globus web container allows weak
ciphers because the Globus Toolkit has modes of operation that do
not encrypt sessions. In some cases, this is for performance
reasons. Unlike standard web sites, none of the Globus Toolkit
security relies on encrypted network connections--i.e. no secrets
(passwords, private keys) go over the wire. Integrity protection of
network traffic is important, but not encryption/privacy.

Therefore, if Nessus reports a low security risk from the Globus
container due to the use of weak ciphers, you may ignore it: there
is no security risk from the use of weak ciphers.
-------------------------------

Thanks,
-alain

---+++ OSG Security Officer

From: 	  petravick@FNAL.GOV
Subject: 	Re: [SECTY-DISCUSS-OSG_LIMITED_DISTR] Weak SSL Cipers in  WS-GRAM Reported
Date: 	June 21, 2007 6:51:20 PM EDT
To: 	  SECURITY-DISCUSS-L@OPENSCIENCEGRID.ORG
Reply-To: 	  petravick@FNAL.GOV

Dear GOC,

Please pass the following information onto BNL.  Our opinion is that
detailed examination of the application shows that service in question is
secure.

-- Don Petravick

-- OSG Security officer.

-- Main.RobQ - 22 Jun 2007