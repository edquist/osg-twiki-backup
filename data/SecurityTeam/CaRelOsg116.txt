%META:TOPICINFO{author="DougOlson" date="1285723944" format="1.1" reprev="1.3" version="1.3"}%
%META:TOPICPARENT{name="CreatingCADistributions"}%
---+!! CA package OSG 1.16 Release Notes
%TOC%

Build log based on instructions at Security.CreatingCADistributions.

---++ IGTF 1.37 announcement
<verbatim>
from	David Groep <davidg@nikhef.nl>
reply-to	info@eugridpma.org
to	EUGridPMA Announcements <announce@eugridpma.org>
cc	All IGTF Members <igtf-general@gridpma.org>
date	Tue, Sep 28, 2010 at 3:49 AM
subject	[igtf-general] Updated IGTF distribution 1.37 and format change announcement
mailing list	<dg-eur-ca.services.cnrs.fr> Filter messages from this mailing list
unsubscribe	Unsubscribe from this mailing-list
hide details 3:49 AM (8 hours ago) 

Dear CAs, Relying Parties, Users, and all others interested,

In this announcement of the IGTF:

   1. Updated IGTF distribution version 1.37 available
   2. Distribution format changes in the wake of OpenSSL version 1

=========================================================================
1. Updated IGTF distribution version 1.37 available
=========================================================================

A new distribution of Accredited Authorities by the EUGridPMA, based
on the IGTF Common Source, is now available. It includes the newly
accredited Authorities by all IGTF Members and retires expiring CA
certificates. This is version 1.37, release 1, and it is now available for
download from the Repository (and mirrors) at

   https://dist.eugridpma.info/distribution/igtf/current/
   (traditional format)

   https://dist.eugridpma.info/distribution/igtf/current-new/
   (new format)

*** note that the default format will change in the next release 1.38 ***

Changes from 1.36 to 1.37
-------------------------
(27 September 2010)

* Added accredited classic TERENA eScience SSL CA and hierarchy (EU)
* Discontinued NGO-Netrust CA (SG)
* The OpenSSL1 compliant format no longer adds symlinks for info metadata
 (such references would result in multiple downloads of the same CRL data
 when used with FetchCRL3)
* Corrected typo errors in namespaces file for AAACertificateServices (EU)
* Added CILogon CAs in experimental area (US)

This 1.38 release has been built with RPM version 4.4.2.3 and Java 1.6.

If you part of a coordinated-deployment project (such as a national
grid initiative, EGI, OSG, PRACE, DEISA, NAREGI or others) you may want to
await your project announcement before installing this release.
The download repository is also mirrored by the APGridPMA at
   https://www.apgridpma.org/distribution/igtf/

Next Release
------------
The next release of the distribution is expected in November 2010.


=========================================================================
2. Distribution format changes in the wake of OpenSSL version 1
=========================================================================

IMPORTANT NOTICE
----------------

 This 1.37 distribution comes in two (2) formats. The primary format
 for this 1.37 release is the 'current' one, which has no material
 changes. The upcoming format is also available at:
   https://dist.eugridpma.info/distribution/igtf/current-new/
 and supports also OpenSSL v1 and is designed to be backwards compatible
 with the current distribution format.

 *** YOU ARE INVITED TO EVALUATE THIS NEW DISTRIBUTION FORMAT NOW ***

 In the next release (1.38), the 'default' distribution will change to
 the new format and the current format will be depricated and only
 available via a special URL. The default download location
   https://dist.eugridpma.org/distribution/igtf/current/
 will then point to the new-format distribution.

 Releases after 1.39 (Early 2011) may withdraw this then-depricated
 format and from then on only the 'new' format will be distributed.


For more information, please refer to the February 15th newsletter:
 https://www.eugridpma.org/newsletter/eugridpma-newsletter-20100215.txt



=========================================================================
REPEATED NOTICES
=========================================================================

This newsletter carries IGTF information intended for relying parties.
For more information about this newsletter and how to subscribe,
refer to the EUGridPMA web site at https://www.eugridpma.org/

+-----------------------------------------------------------------------+
| For information on the IGTF Distribution, how to use it and what is   |
| contains, please read the information at                              |
|   https://dist.eugridpma.info/distribution/igtf/README.txt            |
|                                                                       |
| This file containes important information for new users and should be |
| read before installing this Distribution.                             |
+-----------------------------------------------------------------------+

If you have suggestions or improvements for the distribution format,
to have it better suit your needs, please contact the EUGridPMA PMA at
<info@eugridpma.org> or your Regional Policy Management Authority. See
the IGTF web site (www.igtf.net) for further information.
</verbatim>

---++ Deployment plan
In this release the default format is still the old (current) format and
the one with symlinks is still in the "new" category.
So I think the way to publish this is to make a distribution in
the current format that goes to ITB and then quickly to production.
Follow this one rather quickly with another distribution in the "new" format
that goes to the ITB, and we will put CILogon Basic in this second one.

---++ Build log
On Doug's vm10:

---+++ Setup Step 12
Note that this build node is already configured.

export OSGSECKEYID=7FD42669 

<verbatim>
$ gpg --list-keys
/home/olson/.gnupg/pubring.gpg
------------------------------
pub   1024D/7FD42669 2010-01-28
uid                  Open Science Grid Security <security@opensciencegrid.org>
sub   2048g/22223D8F 2010-01-28

pub   1024D/3CDBBC71 2005-07-12
uid                  EUGridPMA Distribution Signing Key 3 <info@eugridpma.org>
</verbatim>

---+++ Update Steps 1-8
<verbatim>
$ pwd
/home/olson/igtf/1.37
$ export CAWORKDIR=`pwd`
$ export IGTF_CERTS_VERSION=1.37
$ pushd ~/gocsvn/cadist/trunk/CA-Certificates-Base/
~/gocsvn/cadist/trunk/CA-Certificates-Base ~/igtf/1.37
$ svn update
Passphrase for '/home/olson/.globus/olson-ra-doegrids-xb016.p12':
At revision 140.
$ export OUR_CERTS_VERSION=1.16
$ cd $CABASEDIR
$ mkdir $OUR_CERTS_VERSION
$ mkdir $OUR_CERTS_VERSION/certificates
$ export CADIST=$CABASEDIR/$OUR_CERTS_VERSION/certificates
$ pushd $CAWORKDIR
$ wget http://dist.eugridpma.info/distribution/igtf/current/igtf-policy-installation-bundle-1.37.tar.gz
$ wget http://dist.eugridpma.info/distribution/igtf/current/igtf-policy-installation-bundle-1.37.tar.gz.asc
$ gpg --verify igtf-policy-installation-bundle-$IGTF_CERTS_VERSION.tar.gz.asc
gpg: Signature made Mon 27 Sep 2010 05:03:34 AM PDT using DSA key ID 3CDBBC71
gpg: Good signature from "EUGridPMA Distribution Signing Key 3 <info@eugridpma.org>"
$ tar xzf igtf-policy-installation-bundle-$IGTF_CERTS_VERSION.tar.gz
</verbatim>

---+++ Update Step 9

<verbatim>
$ pwd
/home/olson/igtf/1.37/igtf-policy-installation-bundle-1.37
$ more src/experimental/*.info
::::::::::::::
src/experimental/10718cba.info
::::::::::::::
alias = cilogon-silver
url = http://ca.cilogon.org/
ca_url = https://cilogon.org/cilogon-silver.pem
crl_url = http://crl.cilogon.org/cilogon-silver.crl;http://crl.doegrids.org/cilogon-silver.crl
email = ca@cilogon.org
status = experimental
version = 1.37
sha1fp.0 = 39:1C:E0:48:9A:BB:B1:0A:DA:DF:DD:A6:7C:C2:96:87:1A:83:6F:92
::::::::::::::
src/experimental/28776852.info
::::::::::::::
alias = cilogon-basic
url = http://ca.cilogon.org/
ca_url = https://cilogon.org/cilogon-basic.pem
crl_url = http://crl.cilogon.org/cilogon-basic.crl;http://crl.doegrids.org/cilogon-basic.crl
email = ca@cilogon.org
status = experimental
version = 1.37
sha1fp.0 = 21:D6:E3:AE:1E:D0:A7:02:77:67:B3:6B:A9:6D:69:70:60:07:F9:B1
::::::::::::::
src/experimental/3d863bc5.info
::::::::::::::
alias = cilogon-openid
url = http://ca.cilogon.org/
ca_url = https://cilogon.org/cilogon-openid.pem
crl_url = http://crl.cilogon.org/cilogon-openid.crl;http://crl.doegrids.org/cilogon-openid.crl
email = ca@cilogon.org
status = experimental
version = 1.37
sha1fp.0 = 3C:D3:32:8E:A9:02:D8:FD:E8:BA:44:5C:40:46:4C:09:03:26:F5:4C


$ ./configure --prefix=$CADIST --with-profile=classic --with-profile=mics --with-profile=slcs --with-authority=cilogon-silver
.
.
.
install src/accredited/ff783690.0 /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/accredited/ff783690.crl_url /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/accredited/ff783690.info /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/accredited/ff783690.namespaces /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/accredited/ff783690.signing_policy /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/accredited/9dd23746.0 /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/accredited/9dd23746.crl_url /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/accredited/9dd23746.info /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/accredited/9dd23746.namespaces /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/accredited/9dd23746.signing_policy /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
Installing CAs for profile accredited:classic
install policy-igtf-classic.info /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/experimental/10718cba.0 /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/experimental/10718cba.crl_url /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/experimental/10718cba.info /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/experimental/10718cba.namespaces /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/
install src/experimental/10718cba.signing_policy /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates/


</verbatim>
*Note* that CILogon Silver CA is added to the distribution.

---+++ Update Step 10
Updated install scripts to enable old and new formats.



<verbatim>
$ pushd
~/gocsvn/cadist/trunk/CA-Certificates-Base ~/igtf/1.37/igtf-policy-installation-bundle-1.37 ~/igtf/1.37
$ cd non-igtf-certificates/
$ ./PurdueCA.install $CADIST $OUR_CERTS_VERSION old
Installing PurdueCA 95009ddc to /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates
$ ./PurdueTeragridRA.install $CADIST $OUR_CERTS_VERSION old
Installing PurdueTeragridRA 67e8acfa to /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/certificates


$ ls -ltr ../1.16/certificates
.
.
.
-rwxr-xr-x 1 olson olson   41 Sep 28 16:01 9dd23746.crl_url
-rwxr-xr-x 1 olson olson 1996 Sep 28 16:01 9dd23746.0
-rwxr-xr-x 1 olson olson  164 Sep 28 16:01 10718cba.signing_policy
-rwxr-xr-x 1 olson olson  459 Sep 28 16:01 10718cba.namespaces
-rwxr-xr-x 1 olson olson  326 Sep 28 16:01 10718cba.info
-rwxr-xr-x 1 olson olson   85 Sep 28 16:01 10718cba.crl_url
-rwxr-xr-x 1 olson olson 1391 Sep 28 16:01 10718cba.0
-rw-rw-r-- 1 olson olson  225 Sep 28 16:19 67e8acfa.signing_policy
-rw-rw-r-- 1 olson olson  324 Sep 28 16:19 67e8acfa.info
-rw-rw-r-- 1 olson olson   50 Sep 28 16:19 67e8acfa.crl_url
-rw-rw-r-- 1 olson olson 1371 Sep 28 16:19 67e8acfa.0
-rw-rw-r-- 1 olson olson  196 Sep 28 16:29 95009ddc.signing_policy
-rw-rw-r-- 1 olson olson  308 Sep 28 16:29 95009ddc.info
-rw-rw-r-- 1 olson olson   50 Sep 28 16:29 95009ddc.crl_url
-rw-rw-r-- 1 olson olson 1322 Sep 28 16:29 95009ddc.0

</verbatim>

---+++Update Step 11
<verbatim>
$ cd $CADIST
$ for ca in * ; do echo $ca; diff $ca $CABASEDIR/1.15a/certificates; done

$ for ca in $CABASEDIR/previous/certificates/* ; do echo $ca; diff $ca . ; done
</verbatim>
Added in 1.16 relative to 1.15a
   * 10718cba - cilogon-silver (not accredited)
   * 20ce830e - TERENA-eScience-SSL-CA
   * 3c58f906 - !AddTrust-External-CA-Root
   * ff783690 - UTN-USERFirst-Hardware

Removed in 1.16 relative to 1.15a
   * d1737728 - NGO-Netrust

Minor changes in some metadata files.

---+++ Update Step 12-15
<verbatim>
cd $CABASEDIR
$ ./mk-index.pl --version $OUR_CERTS_VERSION --dir $CADIST --out $CADIST/INDEX --style old
...
Index of 91 CAs

$ ls $CADIST/*.0 | wc
     91      91    7462
$ ( cd $CADIST; md5sum *.0  ) > cacerts_md5sum.txt
$ cp cacerts_md5sum.txt $CADIST
$ cp $CABASEDIR/1.15a/certificates/CHANGES $CADIST
</verbatim>
And edit $CADIST/CHANGES
<verbatim>
$ diff CHANGES /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.15a/certificates/
10,24d9
< ===== Version 1.16 =================
< Built 28 Sep 2010
< IGTF 1.37 - current hash format (openssl 0.9x)
< Added in 1.16 relative to 1.15a
<   10718cba - cilogon-silver (not accredited)
<   20ce830e - TERENA-eScience-SSL-CA
<   3c58f906 - AddTrust-External-CA-Root
<   ff783690 - UTN-USERFirst-Hardware
<
< Removed in 1.16 relative to 1.15a
<   d1737728 - NGO-Netrust
<
< Updated relative to 1.15a:
<   Minor changes in some metadata files.
<
</verbatim>

---+++ Update Step 16
<verbatim>
$ cd $CADIST
$ chmod 644 *
$ rm *~
$ cd $CABASEDIR
$ svn add $OUR_CERTS_VERSION
$ svn commit -m "Updated to IGTF version $IGTF_CERTS_VERSION, OSG version $OUR_CERTS_VERSION"

Committed revision 141.
</verbatim>

---+++ Check CAs/CRLs
<verbatim>
$ . /opt/osg-client/setup.sh
$ pushd $CADIST
$ $VDT_LOCATION/fetch-crl/sbin/fetch-crl --loc `pwd` --out `pwd`
 Completed CRL retrieval process at 20100928T175812-0700
$ $CABASEDIR/check-crl-expiry.pl *.r0
0a2bac92.r0 will expire in 3.0 days (out of 30.0).
$ $CABASEDIR/check-ca-expiry.pl *.0
$ rm *.r0
$ popd
</verbatim>

---+++ Make tarball
<verbatim>
$ cd $CABASEDIR
$ svn status
$ svn copy https://osg-svn.rtinfo.indiana.edu/cadist/trunk \
https://osg-svn.rtinfo.indiana.edu/cadist/tags/osg-certificates-$OUR_CERTS_VERSION-igtf-$IGTF_CERTS_VERSION \
-m "Tagging OSG certificates distribution $OUR_CERTS_VERSION containing IGTF version $IGTF_CERTS_VERSION"
Passphrase for '/home/olson/.globus/olson-ra-doegrids-xb016.p12':

Committed revision 142.

$ cd $CABASEDIR/$OUR_CERTS_VERSION
$ tar cvfz osg-certificates-$OUR_CERTS_VERSION.tar.gz --exclude .svn certificates
$ gpg --default-key $OSGSECKEYID -b osg-certificates-$OUR_CERTS_VERSION.tar.gz
$ gpg --default-key $OSGSECKEYID -b osg-certificates-$OUR_CERTS_VERSION.tar.gz

You need a passphrase to unlock the secret key for
user: "Open Science Grid Security <security@opensciencegrid.org>"
1024-bit DSA key, ID 7FD42669, created 2010-01-28

$ ../make-manifest
Making manifest of osg-certificates-1.16.tar.gz...
    Manifest: ./ca-certs-version
$ more ca-certs-version
dataversion=1             # The version of data in this file
timestamp=20100929T010555 # Time of creation of this file
certsversion=1.16         # Version of the certificates
versiondesc=1.16 (includes IGTF 1.37 CAs)
tarball=http://software.grid.iu.edu/pacman/cadist/1.16/osg-certificates-1.16.tar.gz
tarball_md5sum=587bf9b181aa410cfc33c946960112de
</verbatim>
Notice that manifest file points to production publication point, but we want to make one
for ITB, without the ITB versioning since it's going to production soon without changing the tarball.

Fix make-manifest.
<verbatim>
$ ../make-manifest --itb
Making manifest of osg-certificates-1.16.tar.gz...
    Manifest: ./ca-certs-version
$ cat ca-certs-version
dataversion=1             # The version of data in this file
timestamp=20100929T011621 # Time of creation of this file
certsversion=1.16         # Version of the certificates
versiondesc=1.16 (includes IGTF 1.37 CAs)
tarball=http://software-itb.grid.iu.edu/pacman/cadist/1.16/osg-certificates-1.16.tar.gz
tarball_md5sum=587bf9b181aa410cfc33c946960112de
</verbatim>

---+++ Make RPM
<verbatim>
$ echo $OUR_CERTS_VERSION $IGTF_CERTS_VERSION
1.16 1.37
$ which rpmbuild
/usr/bin/rpmbuild
$ cd $CABASEDIR/$OUR_CERTS_VERSION
$ ../make-rpm
Making RPM of /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/osg-certificates-1.16.tar.gz:
Certificates version: 1
Certificates release: 16
Making working directories...
Unpackaging certificate tarball...
Writing spec file...
Making RPM...
Enter pass phrase for keyid 7FD42669 when prompted...
Enter pass phrase:
Success.
Copying RPM to /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16...
</verbatim>

---+++ Make DEB
<verbatim>
$ . ~/bin/setup.sh
$ ../make-deb
Making DEB of /home/olson/gocsvn/cadist/trunk/CA-Certificates-Base/1.16/osg-certificates-1.16.tar.gz:
Certificates version: 1
Certificates release: 163
Making working directories...
Unpackaging certificate tarball...
Writing DEB file...
Making DEB...
Enter pass phrase for keyid 7FD42669 when prompted...
Success.

You need a passphrase to unlock the secret key for
user: "Open Science Grid Security <security@opensciencegrid.org>"
1024-bit DSA key, ID 7FD42669, created 2010-01-28

Success.
</verbatim>

---++ Publish for ITB release
<verbatim>
$ export SVNDIR=$CABASEDIR/../../release-itb
$ cd $CABASEDIR/$OUR_CERTS_VERSION
$ cp osg-certificates-$OUR_CERTS_VERSION.tar.gz osg-certificates-$OUR_CERTS_VERSION.tar.gz.sig \
osg-ca-certs-$OUR_CERTS_VERSION-0.noarch.rpm osg-ca-certs-$OUR_CERTS_VERSION-0.deb \
ca-certs-version cacerts_md5sum.txt $SVNDIR
$ cd $SVNDIR
$ svn add osg-certificates-$OUR_CERTS_VERSION.tar.gz osg-certificates-$OUR_CERTS_VERSION.tar.gz.sig \
> osg-ca-certs-$OUR_CERTS_VERSION-0.noarch.rpm osg-ca-certs-$OUR_CERTS_VERSION-0.deb;
A  (bin)  osg-certificates-1.16.tar.gz
A  (bin)  osg-certificates-1.16.tar.gz.sig
A  (bin)  osg-ca-certs-1.16-0.noarch.rpm
A  (bin)  osg-ca-certs-1.16-0.deb
[olson@vm10 release-itb]$ svn commit -m "OSG certificates distribution $OUR_CERTS_VERSION"
Passphrase for '/home/olson/.globus/olson-ra-doegrids-xb016.p12':
Sending        release-itb/ca-certs-version
Sending        release-itb/cacerts_md5sum.txt
Adding  (bin)  release-itb/osg-ca-certs-1.16-0.deb
Adding  (bin)  release-itb/osg-ca-certs-1.16-0.noarch.rpm
Adding  (bin)  release-itb/osg-certificates-1.16.tar.gz
Adding  (bin)  release-itb/osg-certificates-1.16.tar.gz.sig
Transmitting file data ......
Committed revision 143.
</verbatim>

---+++ Check with ITB
<verbatim>
from	Douglas Olson <dlolson@lbl.gov>
to	OSG ITB Mailing List <osg-int@opensciencegrid.org>
cc	Douglas Olson <dlolson@lbl.gov>
date	Tue, Sep 28, 2010 at 6:31 PM
subject	ready to publish new CA package to ITB
mailed-by	lbl.gov
hide details 6:31 PM (0 minutes ago)
I have a new CA package (1.16) for the newly released IGTF 1.37.
This package is still in the old layout and has nothing dramatic in it
but I want to run it though the ITB before the production release.
Is there any reason not to publish it to ITB immediately?
Thanks,
Doug
</verbatim>

<!-- require login to read.
   * Set ALLOWTOPICVIEW = Main.GridGroup

   * Set DENYTOPICVIEW = Main.TwikiGuest
-->

-- Main.DougOlson - 28 Sep 2010
