%META:TOPICINFO{author="VonWelch" date="1363207200" format="1.1" reprev="1.2" version="1.2"}%
%TOC%

---++OSG PKI Transition Guidance for Sites

This document provides the overall guidance for OSG Sites regarding the OSG PKI Transition. It describes the tasks that a site should perform for a smooth transition. Although OSG provides documentation for end users and system administrators, there are still some tasks that are specific for a site and should be decided and documented by the sitemanagement. This document lists such site-specific tasks and guides sites to plan for such tasks.
   * We recommend that the big sites, with large number of services/CE/SE, should assign a person to coordinate the PKI transition activities within the site. This person(s) can make sure that system administrators and end users can perform their tasks and they receive help when things go wrong.        
   * We strongly recommend that sites prepare documentations for the end users and system administrators tailored for their specific situation based on the following tasks.
   * Although we plan for a smooth transition period, there may be some problems discovered along the way. Sites should alert their system administrators that there may be a number of cases where the administrators will need to help users troubleshoot transition related problems. Sites should provide some instructions for end users regarding how to report problems, and sites should help system administrators handle such issues. 
   
---+++Who is impacted by the transition?

    All systems and end users that have certificates from DOEGrids CA. In particular:
   * A service or an end user who has a service certificate (e.g. rsv/myce.fnal.gov) issued by the DOEGrids CA. 
   * The services that authorizes end users based on user certificates are impacted. For example, the service has a service certificate from a different CA (e.g. from INFN CA). Therefore, this service never obtained a certificate from DOEGrids CA and will not need to obtain a service cert from OSG CA. However it is still impacted if the service allows access to end users based on end users' certificates.  

---+++What is the impact of the transition?

   * After March 2013, DOEGrids CA will stop issuing or renewing certificates.
   * System admis should follow the steps outlined below to obtain certificates. System admins should configure their systems to trust the new DigiCert Root CA certificates. 
   * End users should obtain new certificates and register these certificates with services that they need access to. 

For example:

   * Let's say a certificate from DOEGrids CA is set to expire in August 2013. The certificate will work fine until its expiration date. However, once it expires in August 2013, the certificate owner (end user or a sys admin if this is a host cert) will have to follow the steps below to get a new certificate.
   * Let's say a certificate is set to expire in February 2013. The certificate owner can renew the certificate with DOEGrids following the regular DOEGrids renewal processes, or the owner can get a new certificate from OSG CA. This certificate renewed with DOEGrids CA will set to expire in February 2014. Therefore, in February 2014, the certificate owner will have to get a new certificate from OSG CA since the DOEgrids will no longer provide certificates.


---+++ Site-Specific Tasks 

---++++ General Planning Tasks

   1 Identify a person who will coordinate the transition tasks in the VO. 
   2 Make sure OSG PKI Transition team and Site transition lead communicate with one another and up to date in terms of their plans. 
   3. Make a plan for how to deal with problems/errors reported by users and admins. If OSG ticketing system will be used, make sure GOC and VO system administrators and end users are aware of using this system and have access to it. 
   4 Create documentation for end users and system administrators based on the tasks described below tailored specifically for your situation. 

---++++ Tasks Related to Services/Hosts
 
   1 Identify the services that has a service and host certificate from DOEGrids CA. 
   2 Make a list of the expiration dates for the host/service certificates. Remind the service operators to keep an eye on the list. We strongly recommend checking the list monthly as each month more certificates will expire. It is very important that the service operators should obtain new host/service certificates from OSG CA before the expiraton date. We suggest that replacement certificates from OSG CA should be obtained a month before the expiration date of the current certificates. 
   3 Identify the services that authorizes end users based on end users' certificates. These services will have to register new user certificates as the users obtain new certificates from OSG CA. Otherwise users will not be able to access the services with their new certs. The list may include web-based applications, twikis,  pilot based submission servers, indico service, and etc. 
   4 Encourage service operators to first build a test instance of the services that they run and perform the changes in the test instance.
   5 Direct service operators to OSG documentation on how to obtain [[https://confluence.grid.iu.edu/display/CENTRAL/User+Guide][host/service certificates]].  OSG has a web-based request form that you can make certificate requests at. If you prefer commandline tools to request and retrieve your certificates, follow the instructions on https://twiki.grid.iu.edu/bin/view/Operations/OSGPKICommandlineClients.
   6 Distribute the new service/host certificates to third parties if needed for service-service handshakes. For example, the new VOMS host certificate should be distributed to all GUMS services. The vomses file distributed by OSG contains the certificate information for each VOMS server certificates. When your certificate change, notify the OSG GOC via a ticket so that your new VOMS certificate can be included in the updated vomses file. 
   6 The service operators should update the list of trusted root Certificate Authorities. This step will allow the service to accept and trust the DigiCert trust roots, DigiCert root and intermediate Certificate Authorities. 
      1 For a grid resource, simply do a *yum update osg-ca-certs* or *yum update osg-ca-certs-compat* depending on your system's openssl version. This will update your /etc/grid-security/certificates directory with the latest CA files form OSG. If you do not use rpms, get the CA tarballs by following instructions at https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallCertAuth
      2 If this is not a grid resource, e.g. a web service, then download the trust roots from http://digicert-grid.com/. Find the instructions specific to your service to add the CA certificates.
   7 On grid resources, update the vomses files. Vomses file has a list of all VOMS servers and their certificate DNs. As VOMS servers will change their own certificates from DOEGrids CA to OSG CA, vomses file will be updated. The OSG Grid Operation Center updates and distributes the most recent vomses file at http://software.grid.iu.edu/pacman/tarballs/vo-package/vomses 
   8. End User Authorization. Document the steps necessary for the services (identified in #3) to register the new user certificates. Consider whether a service can and should register multiple certificates for a single user. Some services simply do not have the capability to do so. You can visit [[https://twiki.grid.iu.edu/bin/view/Security/DOEGrids2DigiCertDNTransition][this link]] for more information on this topic.
      1 In particular, we strongly recommend that VOMS+VOMRS server should not try to register multiple certificates for a single user account. Instead, the VOMS Admin should create a separate VOMS user account for each user certificate. This is because the GUMS server version installed at most OSG sites cannot handle multiple certificates downloaded from the VOMS servers. We will provide additional instructions on how to achieve this. 
      2 As a result of having separate VOMS accounts for each user certificate, each user certificate will be treated as a separate user at a grid site. In other words, each certificate will be mapped into a separate local unix account at a grid site. Consider if this is suitable for your VO operations. If it is necessary for your users to link such accounts, please notify OSG PKI team and we will help you work with sites. Sites can manually change user mappings to make sure all user certificates are mapped into the same unix account.  
      3 Grid resources (CE/SE) will receive the new user certificate DNs directly from the VOMS servers. The system admins will not have to do anything specifically
      4 Non-grid services need to be updated manually by the system admin. If you have services such as twiki, ticketing systems, etc, provide documentation for your service operators on how they should register new user certificates. 
   9 Encourage service operators to test their services with new OSG CA certificates
   10 If everything works well, apply the changes to production servers.

---+++ GUMS version requirements:

   1 To use a OSG PKI/DigiCert certificate with GUMS an RPM version (as opposed to older Pacman version) is required.

   2 If you want to use the a pilot proxy to authenticate to GUMS (as opposed to a host certificate), you will need a configuration item in GUMS that allows glexec to lookup any mapping within the group.  We believe this setting absolute latest released version of GUMS.




-- Main.MineAltunay - 09 Nov 2012
