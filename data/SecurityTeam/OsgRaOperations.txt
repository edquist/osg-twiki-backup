%META:TOPICINFO{author="KyleGross" date="1480625574" format="1.1" version="1.65"}%
---+!! OSG Registration Authority Information (DOEGrids) 
---+!! %RED% *This is obsolete!!!  OSG has transitioned from DOEGrids to the New OSG PKI.* %ENDCOLOR%

---++  New OSG PKI version of this document can be found [[NewOSGPKI][here]].

%TOC%


The primary URL for contacting the OSG RA is http://www.opensciencegrid.org/ra.

An overview of the request workflow for personal certificates is shown [[PersonCertReqWorkFlow][here]].

%GRAY% [[OsgRaInstructions][General instructions page]] under development. %ENDCOLOR%

---++ Instructions for Agents

---+++ Processing OU=People certificate requests
   1 Email notification received by agents has name of VO in the subject line. 
      * E.g., *[doesg-ra] DOEGrids CA - OSG CMS Certificate Request in Queue (request id: NNNNN)* 
      * identifies OSG as the RA and CMS as the VO.
      * For a complete list of VOs see http://myosg.grid.iu.edu/vosummary?datasource=summary&all_vos=on&active_value=1. 
   1 An agent for the identified VO should follow the link in the email notice to see complete information about the request within one business day, and click the "assign to me" link to take ownership of the request when they have determined it is a request that the agent can process. %BLUE% Each request should be claimed by an agent in 2 business days at most%ENDCOLOR%
   1 Using the additional information provided in the request the agent should determine who are acceptable sponsors that can validate the request. This may or may not be the same as the sponsor shown in the request. 
   1 Agent should contact the sponsor by email or telephone to confirm the request. 
      * Agent can accept confirmation by telephone directly, if using previously validated telephone number for the sponsor. 
      * If sponsor responds by email it must be digitally signed to verify the sponsors identity. 
      * %BLUE%Email sent to Sponsor should be cc'ed to person requesting certificate, so they will see the progress of their request, and can check with the Sponsor if something is taking too long.%ENDCOLOR%
      * %BLUE% An agent can ask for an alternative Sponsor in case the first Sponsor cannot confirm the request. When an alternative sponsor is emailed, agent copies the requestor to his email. %ENDCOLOR%.  
   1 If the requestor's previous certificate has expired, and the agent or sponsor can confirm that the requestor is indeed the holder of the previous certificate, the agent may edit the DN in the request to match the previous certificate's DN, so that it is not necessary to update the requestor's DN in VOMS.
   1 %BLUE%If a sponsor is not responsive after 3 business days, 
      * the Agent should send a reminder email that is also copied to the Requestor.
      * After business 5 days, Agent should email an alternative Sponsor, if one exists. The Agent should copy the Requestor to this second email so that the Requestor can follow the process. 
      * An agent can contact the OSG RA or VO Manager if a particular request or sponsor takes longer than usual, a week or 10 days at most. %ENDCOLOR% 
   1 If sponsor confirms the certificate requestor by an acceptable means, the agent can issue the certificate. 
      * If the sponsor denies the requestor then the agent should reject the request. 
   1 %BLUE%Agent must record a summary of the verification (or rejection) of the request and send it to osg-ra-log@opensciencegrid.org.%ENDCOLOR% The recorded information should include 
      * Request identifier (for certification requests) 
      * Description of action take (approve, reject, cancel, revoke, etc.) 
      * Name and/or individual email address of Agent who processed the request. 
      * Name of Sponsor who confirmed the request (in some cases the Agent is also the Sponsor). 
      * For certification requests, statement of why the requestor qualifies to receive certificate, i.e., membership in a particular VO, or association with a science program participating with OSG. 
      * Certificate serial number 
      * Certificate subject name, i.e., DN 

---+++ Processing OU=Services certificate requests
   1 OU=Services requests will have the domain name of the host for which the certificate is requested in the subject line of the notification email. 
      * E.g., *[doesg-ra] DOEGrids CA - OSG hep.olemiss.edu Certificate Request in Queue (request id: NNNNN)* 
      * shows OSG as the RA and hep.olemiss.edu as the domain name for a request with 
         * DN = CN=sam/umiss000.hep.olemiss.edu,OU=Services,DC=doegrids,DC=org 
   1 An agent with responsibility for the domain should click on the link in the email notice to check the complete information for the request within one business day of receiving the notice. 
   1 If the agent is able to process the request agent should click the "assign to me" link to take ownership of the request. 
   1 If the requestor has a valid DOEGrids personal certificate the agent should get a digitally signed email from the requestor in order to issue the certificate. 
   1 If the requestor does not have a valid DOEGrids personal certificate then they need to be authenticated as described for a personal certificate request above before issuing the new certificate. 
   1 %BLUE%Agent must record a summary of the verification (or rejection) of the request and send it to osg-ra-log@opensciencegrid.org.%ENDCOLOR% The recorded information should include 
      * Request identifier (for certification requests) 
      * Description of action take (approve, reject, cancel, revoke, etc.) 
      * Name and/or individual email address of Agent who processed the request. 
      * Name of Sponsor who confirmed the request (in some cases the Agent is also the Sponsor). Not needed if requestor has a valid personal certificate. 
      * For certification requests, statement of why the requestor qualifies to receive certificate, i.e., membership in a particular VO, or association with a science program participating with OSG. 
      * Certificate serial number 
      * Certificate subject name, i.e., DN 

---+++ %BLUE%Audits of Agent activities%ENDCOLOR%
%BLUE%Auditing the registration process is an important part of maintaining the integrity of the whole identify certification system. 
At times there will be sampling audits of individual certificate requests and Agents may be contacted regarding those requests
if the information in the osg-ra-log@opensciencegrid.org archive is insufficient.%ENDCOLOR%

---+++ Becoming an Agent with the OSG RA
 *Step 1.* To become an Agent with the OSG RA so that you are able to process certificate requests for the purpose of issuing certificate for your community you should first communicate the interest and needs for certificates with the OSG RA Point of Contact , <a href="mailto:osg-ra@opensciencegrid.org">osg-ra@opensciencegrid.org</a> 

*Step 2.* If appropriate, the OSG RA POC will invite you (informally) to become an agent for your VO.

*Step 3.* You then send the email message described below.

*Step 4.* The OSG RA POC confirms your request for Agent privilege with DOEGrids.

*Step 5.* The DOEGrids CA managers grant Agent privilege based on your personal certificate and you start receiving email notifications of all new certificate requests. You process the requests from your VO according to the instructions above.

*Step 6.* If you don't get a response in 3 business days please send a reminder email asking about the status of your request.

---++++ Letter requesting agent access
 Agents for DOEGrids (OSG, and all other RAs) are required to send an email letter requesting authorization for agent access at least once per year (i.e., whenever they get a new certificate), digitally signed with the certificate that will be authorized for access (i.e. agent's personal certificate). The RA must also send a confirmation letter to approve the request for agent access. Below is the example letter for agents (from Appendix A of the [[http://www.doegrids.org/Docs/CP-CPS.pdf][CP/CPS]]) with the OSG RA. In this letter you should specify which VOs registered with OSG you will handle certificate requests for. See the [[http://vors.grid.iu.edu/cgi-bin/index.cgi?region=0&VO=0&res=0&grid=1][OSG VORS]] for a list of the VOs registered with OSG.

%GREEN% To: doegrids-ca-1@doegrids.org

Cc: osg-ra@opensciencegrid.org

Dear DOEGrids Operations:

I %ENDCOLOR% %RED% [your name] %ENDCOLOR% %GREEN% request to be as an Agent of the Registration Authority for OSG. I have been authorized by OSG and the following VOs (%ENDCOLOR% %RED% list your VOs here %ENDCOLOR% %GREEN% ) to represent them for the purposes of approving/revoking DOEGrids certificates in our community. I have read and agree to the following clauses:

   1 In acting as the Agent of the RA for OSG I have read, understood and accept the responsibilities and tasks assigned to an Agent as laid out in the DOEGrids CP/CPS. http://www.doegrids.org/Docs/CP-CPS.pdf. 
   1 I understand that DOEGrids Certification Service will notify me by email of changes to CP/CPS and I will immediately notify the DOEGrids PMA if I am no longer willing to act as an Agent for my RA under any new CP/CPS. 
   1 I understand that failure to fulfill my responsibilities and tasks under this agreement may result in the termination of my appointment as a Agent for OSG. 
   1 I agree only to act on enrollment requests associated with the OSG. 
   1 I understand that I am responsible for the revocation of certificates that are suspected of being compromised or issued in violation of the DOEGrids CP/CPS policies. 
   1 I understand that I am responsible for customer support for the OSG VOs shown above, related to DOEGrids certificate issuance, revocation and information. 

%ENDCOLOR%


---+++ Allowable Requests

From Section 1.3.3 of the DOEGrids CP/CPS:<br /> 
%GREEN% DOE GRIDS PKI issues Person, Host and Service certificates to scientists, engineers, graduate students, and others working on Department of Energy Scientific Research programs as allowed in the ESnet AUP ([[http://es.net/hypertext/esnet-aup.html][http://es.net/hypertext/esnet-aup.html]]), or as allowed by the DOE Office of Science in support of DOE collaborations with other agencies and institutions. The person requesting and responsible for a certificate's private key is the subscriber. 
%ENDCOLOR%

This includes members of or persons affiliated with all VOs registered with Open Science Grid, with some exceptions ([[#Not_Allowable_Requests][see below]]). One a case by case basis, the OSG RA may issue certificates to persons not affiliated with a VO registered with OSG but who qualifies under the general DOEGrids policy shown above.

If an agent is in doubt about whether or not a particular request is allowed (s)he should contact the OSG RA (osg-ra@opensciencegrid.org) for clarification.

---+++ Not Allowable Requests for OSG RA agents

Members of VOs that are participants in the LCG and are employed in European countries are generally required to get their certificates for use in LCG from one of the European CAs. In order to accommodate this efficiently, Agents should normally process _OU=People_ requests only for email addresses that end in *.gov* or *.edu*, and _OU=Services_ requests with hostnames that end in *.gov* or *.edu*. All other requests should be referred to osg-ra@opensciencegrid.org. 

Handling of special circumstances, such as SAM service certificates for CDF or DZero, will be worked out with the individual Agents processing those requests.

Employees and guests at certain DOE laboratories that have their own RA with DOEGrids require that those persons get certificates via their own RA's. This includes Argonne National Lab and Oakridge National Lab.

Requests from persons who are residents or citizens of the U.S. State Department T-6 countries (Cuba, Iran, Libya, North Korea, Sudan, Syria) possibly do not qualify to receive a DOEGrids certificate. All requests for persons from these countries should be forwarded to the OSG RA (osg-ra@opensciencegrid.org) for processing.

The exceptions above are not an exhaustive list of cases where subscribers do not qualify to receive a certificate. If an agent is in doubt about whether or not a particular request is allowed (s)he should contact the OSG RA (osg-ra@opensciencegrid.org) for clarification.

---+++ Certificate Revocation
When a certificate is revoked it is included in the Certificate Revocation List and it can no longer be used for authentication.
There are several conditions that are grounds to revoke a certificate.  These are:
   * the private key is suspected of being compromised (out of control of the owner)
   * the certificate is no longer in use
   * the information in the certificate is no longer accurate (name, hostname, email address)
   * the owner no longer has a valid reason to have the certificate (no longer working on a project of interest to DOE or OSG)
If the certificate owner or some other responsible party notifies an Agent that any of these conditions is true
then the Agent should revoke the certificate.  If in doubt, contact osg-ra@opensciencegrid.org for clarification. The revocation should be recorded by sending an email describing the action to osg-ra-log@opensciencegrid.org.


---+++ Other Agent Actions
 The main URL at the CA for actions authorized for Agents is https://pki1.doegrids.org:8100/ca/. The most frequently used actions are searching for certificates, and revocation. Any action causing changes (revocation, issuing certificates, granting privileges, etc.) should be recorded by sending an email describing the action to osg-ra-log@opensciencegrid.org.

---+++ Termination of Agent or Grid Admin privileges
 When you wish to terminate any Agent or Grid Admin privileges you have, due to change of job or responsibilities you should send an email (preferably with digital signature) to osg-ra@opensciencegrid.org stating that you are ending your responsibilities and privileges. You should state who, if anyone, is taking over for your Agent or Grid Admin responsibilities. When Agents terminate their privileges there need to be arrangements made to transfer the log of Agent actions to another Agent or to the OSG RA. If the Agent has logged all actions to the osg-ra-log@opensciencegrid.org email archive then no additional transfer is necessary.

---++ Instructions for !GridAdmin
 The !GridAdmin interface to the DOEGrids CA allows site administrators to be authorized to submit service certificate requests, authenticated with their personal certificate, and have the signed service certificate issued immediately. !GridAdmin is available both as a [[http://www.doegrids.org/Library/gridAdmin/gridAdminUser.html][web interface]] and from the cert-gridadmin [[Documentation.Release3.InstallCertScripts][script]].  (For Pre-Release3 see [[ReleaseDocumentation.CertScriptsPackage][script]].)

---+++ Letter requesting !GridAdmin privilege
To request this privilege, you should familiarize yourself with the Subscriber Obligations (Section 1.3.3) and Grid Admins (Section A.3.4) of the [[http://www.doegrids.org/Docs/CP-CPS.pdf][DOEGrids CP/CPS]]. Then you should send the following letter as email, digitally signed with your personal certificate to the OSG RA. You will need to send this email whenever you get a new certificate to have that certificate authorized with the !GridAdmin privilege.

%GREEN% To: osg-ra@opensciencegrid.org

Dear OSG RA,

I %ENDCOLOR% %RED% [your name] %ENDCOLOR% %GREEN% would like to be a Grid admin for OSG (%ENDCOLOR% %RED% list your VOs here %ENDCOLOR% %GREEN% ). I would like to be authorized to request and approve DOEGrids Service certificates for the following name space(s):

   1 FQDN 1 or range of addresses for a particular domain<br /> b. FQDN 2<br /> c. others

   1 As the Grid Admin for OSG I have read and understand the responsibilities and tasks assigned to a Grid Admin as laid out in the DOEGrids CP/CPS. http://www.doegrids.org/Docs/CP-CPS.pdf. 
   1 I agree that as Grid Admin I will only submit and approve Service certificates for the FQDNs listed above. 
   1 I understand that I am responsible for the revocation of certificates that are suspected of being compromised or issued in violation of the DOEGrids CP/CPS policies. 

%ENDCOLOR%

You should receive a response within three business days and if not you should send another email asking about the status of your request.

---+++ Obtaining host or service certificates

!GridAdmins are authorized to request and automatically issue service and host certificates for the machines under their assigned domains. First, a !GridAdmin should generate a certificate request by [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/GetHostServiceCertificates][following these instructions]]. The certificate request scripts will generate a request file in pkcs10 format. As a second step, !GridAdmins can go to the [[https://pki1.doegrids.org/ca/][DOEGrids CA web site]], and then click on the !GridAdmin Interface button. !GridAdmins should copy and paste the contents of the cert request file (in pkcs10 format) to the web form on this page. Once the request is submitted, a host or service certificate will be automatically issued. 

RA Agents and !GridAdmins may use the [[https://www.racf.bnl.gov/experiments/usatlas/griddev/certify][certify]] tool to obtain large numbers of host and service certificates (for large clusters, for example).
---

---++ Instructions for Sponsors
 A _Sponsor_ for a certificate request is a person who can confirm that a _subscriber_ has made a certificate request based on reliable personal knowledge, such as face-to-face or telephone discussion with the subscriber who is personally known to the Sponsor. 
   * A sponsor should have an X509 personal certificate issued by one of the [[http://www.gridpma.org/][IGTF]] accredited CAs. 
   * DIgitally signed email is the prefered method of communication between agent and sponsor. 

---++ Instructions for Users

The [[ReleaseDocumentation/CertificateGet][How do I get a DOEGrids PKI/X509 Personal Certificate?]]
page has information about getting personal certificates.

---+++ Digitally signed email
 Most modern email clients can handle SMIME (digitally signed) email messages without difficulty once your certificate is loaded into the certificate store for the email client.
Instructions for Mozilla Thunderbird and some other browsers are [[SecurityTeam.ThunderbirdSmime][here]] and [[Trash/Trash/Trash/Trash/OSGRA/SettingUpSMIME][here]].

However, it is also possible to digitally sign messages from a command-line using openssl and your grid certificate .pem files (typically ~/.globus/user{cert|key}.pem).

Example 1: sending signed email via command line mail:
<verbatim>
$ openssl smime -sign -signer ~/.globus/usercert.pem -inkey ~/.globus/userkey.pem            
         -in message.txt | mail -s "email subject" person@example.com
</verbatim>
Example 2: sign a text file to send as an attachment:
<verbatim>
$ openssl smime -sign -signer ~/.globus/usercert.pem -inkey ~/.globus/userkey.pem            
         -in message.txt -out signed-message.txt
</verbatim>

   * message.txt - body of the email message before signing
   * signed-message.txt - text file of signed message which you can send as an attachment with your usual email client program
   * ~/.globus/usercert.pem, userkey.pem - your personal grid certificate 
   * person@example.com - address where email is to be sent 

It generally works better to send the signed file as an attachment rather than copying it into the body of
the message because various email clients and particularly web interfaces to email often
modify the message body and therefore break the digital signature.

Example verifying signed message:
<verbatim>
$ openssl smime -verify -in message.txt  -CApath $X509_CERT_DIR
</verbatim>

   * message.txt - body of email message received. 
      * note that the line beginning "Content-Type" and including 'boundary="---' must be a single line and not get broken or wrapped. 
   * note that there is an openssl smime option ( -noverify ) which avoids the need for specifying the trusted CA directory path, but this should only be used if you have a good reason to believe that the senders certificate is still valid. 

Example verifying signed message and examining the signer's certificate:
<verbatim>
$ openssl smime -verify -in signed-message.txt -CApath $X509_CERT_DIR -signer sendercert.pem
$ openssl x509 -in sendercert.pem -noout -subject -email -serial -dates
</verbatim>

   * signed-message.txt - signed message received, either as attachment or in body of email
   * sendercert.pem - the certificate used by the sender to sign the message, is extracted with the openssl smime command 
   * openssl x509 command above will display the subject, email address, serial number and validity dates of the signer's certificate 

---++ Work Plan
 Information on the issues, action items and planned changes or upgrades of the OSG RA service is managed [[OsgRaPlanning][here]].

---++ Internal information for the RA.

Internal information for the RA, such as list of agents, unpublished email address, etc. is shown [[OsgRaAgents][here]] with restricted viewing.

-- Main.DougOlson - 27 Jun 2006
