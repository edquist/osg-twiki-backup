%META:TOPICINFO{author="KyleGross" date="1481047951" format="1.1" version="1.4"}%
%META:TOPICPARENT{name="IncidentInformation2009"}%
%TOC%

---++ Notification Email 

<verbatim>
** PLEASE DO NOT REDISTRIBUTE **  CERNCERT-20080805

** This message is sent to the CSIRTs of affected grid infrastructures and sites and must NOT be publicly archived **

Dear CSIRTs,

The information below was kindly provided by the DFN CERT (NREN in Germany), 
the SWITCH CERT (NREN in Switzerland), the EGEE Operational Security Coordination Team, 
the OSG security team, CfA Harvard, ISI University of South California, CERN security team 
and several CSIRTs from various sites.

*******************************************************
* What's new since the last update                            *
*******************************************************

- Further attacks discovered
- New suspicious IP addresses
- New compromised SSH keys
- New version of the rootkit (now phalanx 2.3d)

******************************
* Further attacks discovered *
******************************

Several sites reported additional compromised accounts and root compromised hosts 
(mostly in the April timeframe).

It is believed the attacker is still actively using an exploit for CVE-2009-1185/CVE-2009-1186 (udev):
https://rhn.redhat.com/errata/RHSA-2009-0427.html
http://listserv.fnal.gov/scripts/wa.exe?A2=ind0904&L=scientific-linux-errata&T=0&P=1842

Note that RHEL4/SL4/SLC4 are not affected by this vulnerability.

************************************
* New suspicious IP addresses  *
************************************

It is believed that the attacker used compromised accounts or logged in from :

- 157.88.66.5
- 91.138.122.217

The known list of suspicious IP addresses is now:

- 130.88.197.197 (bluu.cs.man.ac.uk)
- 131.142.42.17 (?)
- 132.239.95.85  (npc.ucsd.edu)
- 134.58.117.136
- 136.159.55.31
- 137.248.152.49 (pc15854.Chemie.Uni-Marburg.de)
- 141.20.77.34 (mix34.chemie.hu-berlin.de)
- 169.244.3.2 (fw.lincoln-academy.pvt.k12.me.us)
- 189.6.137.174
- 190.81.35.90
- 193.0.73.34 (193-0-73-034.dsk.uw.edu.pl))
- 202.51.211.2
- 207.206.202.54
- 207.206.215.122
- 207.224.103.198
- 207.224.215.94
- 207.225.167.150
- 207.225.248.150
- 208.112.17.204  (s21.remote-learner.net)
- 208.35.255.106
- 208.42.23.94 (v-208-42-23-94.mn.visi.com)
- 209.160.40.14
- 209.181.122.222
- 209.181.131.209
- 209.181.138.229
- 209.181.189.198
- 209.181.242.70
- 216.184.13.238
- 216.186.49.132
- 217.12.85.178
- 217.219.106.14
- 64.27.17.70 (vpn2.pcwerk.com)
- 64.72.120.48
- 66.230.230.230
- 67.148.94.172 (einstein.jyxent.com)
- 69.128.147.2
- 69.128.147.4
- 69.128.147.5
- 69.128.147.6
- 69.128.147.7
- 69.128.171.92
- 69.128.189.10
- 69.128.189.12
- 69.128.189.13
- 69.128.189.14
- 69.128.189.15
- 69.129.125.219
- 69.129.17.24
- 69.129.193.99
- 69.130.104.157
- 69.130.104.49
- 69.130.130.117
- 69.130.136.116
- 69.130.182.213
- 69.130.80.36
- 69.244.3.2
- 69.37.246.4
- 69.49.172.31
- 75.60.89.233
- 80.13.126.239
- 80.13.99.104
- 80.174.245.228
- 80.188.106.73
- 80.25.42.199
- 82.128.207.37
- 82.145.72.17 (theta.wi.tuniv.szczecin.pl)
- 82.248.2.245
- 83.134.152.127
- 85.232.26.144
- 85.232.26.4
- 85.232.26.8
- 85.232.27.189
- 87.100.29.38
- 87.107.109.46
- 87.109.12.120
- 87.109.179.29
- 87.109.43.204
- 87.114.0.130
- 87.114.149.157
- 87.119.238.53
- 87.123.6.85
- 87.194.141.240
- 87.228.52.153
- 87.232.132.234
- 87.236.255.18
- 87.249.175.177
- 87.80.216.89
- 87.80.42.130
- 87.81.42.32
- 87.81.71.129
- 87.91.245.246
- 93.148.9.221
- 99.236.185.205
- 99.237.220.123

Note that there are now several IP addresses in the 69.128, 69.129 and 69.130 network blocks. 
Any connection from these locations should be treated as suspicious and verified with the
appropriate user(s). Note however that at least one connection from 69.129 has been 
confirmed to be legitimate.

* Update on the rootkit *

In many cases, the attacker gains root access by exploiting known vulnerabilities, 
it is therefore essential to ensure Linux hosts are kept up-to-date with security patches.

Recent kernels should prevent Phalanx (and similar rootkits) to be injected via /dev/mem 
modifications (both RHEL 4 and RHEL5 have released kernels to implement this). 
Beware however that a new version "2.3d" of the Phalanx rootkit has been seen 
in the wild, which first tries to inject the malware via /dev/mem, but in case it does 
not succeed, it tries to load the malware as a standard Linux Kernel Module (LKM).

As per the last updates, while the attacker has mostly been concentrating on 
SSH keys, it seems that standard passwords are being sniffed and reused also.

It has also been discovered that connections to the backdoor can produce 
the following syslog message (usually in /var/log/secure, /var/log/message):

---------------8<------------------
sshd[XXXX]: Disconnecting: Bad packet length 1883783500.
---------------8<------------------
(where XXXX is the PID of sshd)

Although the rootkit hides in different locations (ex: /usr/lib/heahu.p2/, /usr/lib/huuuh.p2, /usr/lib/zupzz.p2, etc.), 
the backdoor does not support some characters and should segfault using this command:

(echo SSH-2.0-OpenSSH_3.8.1p1; sleep 1; echo 'pHALANX2!'kill_phalanx2'+++++++++++++++'| cut -c 1-31; sleep 1; echo 'test'; cat)|nc <POSSIBLY_INFECTED_HOSTNAME> 22

(<POSSIBLY_INFECTED_HOSTNAME> is the hostname that is checked for signs of the rootkit)

The resulting syslog message on <POSSIBLY_INFECTED_HOSTNAME> would look like:
<DATE> <POSSIBLY_INFECTED_HOSTNAME> kernel: <malicious_kernel_thread>:
segfault at 0000000000000000 rip 0000000000418900 rsp 0000007fbfff8698 error 4

Once the host has been probed, the existence of such a syslog message is a very strong 
indication it has been infected by the rootkit.

*************************************************
* Suspicious SSH key and rootkit detecting tool *
*************************************************

It is possible to use suspicious SSH keys and rootkit detecting tool provided by the community. 
The tools on the page below are kindly provided by their authors and do not come with any
guarantee whatsoever, use it at your own risk!

https://cern.ch/osct/7e0564aeabe51c2b1c69570c8d931bf2

Please report any suspicious activity to enable other sites to search for the patterns 
you may have detected. This is essential to prevent the attack from spreading further in the community.

Regards,

Romain Wartel on behalf of the EGEE Operational Security Coordination Team.
--
Romain Wartel						Romain.Wartel@cern.ch
EGEE Operational Security Coordination Team
C.E.R.N.								http://www.cern.ch/LCG
Information Technology Division		http://www.eu-egee.org/security
Bat.28-R-016						http://cern.ch/security
CH-1211 Geneva 23, Switzerland 








</verbatim>

---++ Access Control

_Uncomment the appropriate access control policy for this incident page. Logout of the twiki and try to access the page to ensure it is not publicly accessible. Do not attach files, as they will not be protected (see  [[http://twiki.org/cgi-bin/view/TWiki/TWikiAccessControl#Controlling_access_to_Attachment][http://twiki.org/cgi-bin/view/TWiki/TWikiAccessControl#Controlling_access_to_Attachment]])._

Incident information accessible by Security Team members and GOC only:
   * #Set ALLOWTOPICVIEW = Main.SecurityTeamGroup, Main.GocGroup
   * #Set ALLOWTOPICCHANGE = Main.SecurityTeamGroup, Main.GocGroup

Incident information accessible by all authenticated twiki users:
   * Set ALLOWTOPICVIEW = Main.GridGroup, Main.RomainWartel
   * Set ALLOWTOPICCHANGE = Main.GridGroup, Main.RomainWartel


-- Main.AashishSharma - 19 May 2009

-- Main.DougOlson - 20 May 2009 - format adjustment