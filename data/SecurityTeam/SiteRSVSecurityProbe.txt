%META:TOPICINFO{author="AnandPadmanabhan" date="1240288156" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="SecurityTeamWorkingArea"}%
---+ Site level RSV Security Probes 
%TOC%

The local RSV probes are designed to run on each site.


---++ Probe to test freshness of the CRLs 

*Probe Name*:  crl-freshness-probe <br>
                         crl-freshness-wlcg-probe <br>
*Metrics*:  org.osg.local.crl.freshness <br>
                 org.osg.local.crl.wlcg.freshness <br>
*Parameters* :--cacerts-dir \<directory\> --warning-hours \<hour\>, --error-hours \<hours\> <br>
    =--cacerts-dir=:      Location of CA certificate files <br>
    =--error-hours=:  Number hours since the failing downloads before an error is issued <br>
    =--warning-hours=:  Number hours since the failing downloads before a warning is issued <br>
   (Default Values:  $VDT_LOCATION'/globus/TRUSTED_CA, 3 days and 9 hrs respectively). <br>

---+++!! Description
This probe checks the last time when the CRLs were successfully downloaded. If any of the CRLs have not been updated for 9 hrs (warning-hours) the probe will issue a warning. This will be escalated to a critical error if a CRL has not updated for 72 Hrs (error-hours). This probe is intended to capture cases where the for any reason the CRLs of any CA were not updated or any of the CRLs are missing.

---+++ !!Results
The probe will produce: 
   * *critical error*: If any CRL files in CA directory have not been updated for 72 (error-hours) hours or if any CRLs are missing.
   * *warning*: If any CRL files in CA directory have not been updated for 9 (warning-hours) hours
   * *ok*: All other cases

---+++!! wlcg version of probe
 This version of the probe differs from the OSG version in that only CRLs from IGTF CAs are checked.


---++ Probe to test if CA certificates are up to date

*Probe Name*: cacert-verify-local-probe <br>
                        cacert-verify-wlcg-local-probe <br>
*Metrics*: org.osg.local.certificates.verify <br>
                org.osg.local.certificates.wlcg.verify <br>
*Parameters* :--cacerts-dir \<directory\>, --error-hours \<hour\> <br>
    =--cacerts-dir=:      Location of CA certificate files <br>
    =--error-hours=:   Number hours before an error is issued when the md5sums of local install does not match the md5sums at the GOC central location <br>
   (Default Values:  $VDT_LOCATION'/globus/TRUSTED_CA and 3 days respectively). <br>

---+++!! Description
This is a local probe that verifies if the CA distribution at the site is upto date. This probe downloads a file contains a list of md5sum from a central location at the GOC. This list is compared against the md5sum of the files in the local repository. 

---+++ !!Results
The probe will produce: 
   * *critical error*: If warning state has persisted for 72 (error-hours) hours
   * *warning*: If the md5sums of the local CA do not match the GOC distribution. In case of wlcg probe the test also verifies if all the IGTF CAs are installed.
  * *unknown*: If the file containing the md5sums cannot be downloaded successfully from the GOC
   * *ok*: All other cases

---+++!! wlcg version of probe
The wlcg version of the probe checks if all IGTF CAs are installed at the site. (This is a requirement of WLCG)


---++ Probe to test if CA certificates are up to date

*Probe Name*: cacert-verify-supported-vo-local-probe <br>
*Metrics*:  org.osg.local.certificate.supportedvo.verify<br>
*Parameters* :--cacerts-dir \<directory\>, -- url-vo-ca \<URL\>,  --supported-vo-file \<FILE\><br>
    =--cacerts-dir=:      Location of CA certificate files  (Default Values:  $VDT_LOCATION'/globus/TRUSTED_CA)<br>
    =--supported-vo=:  Location of the file that lists the VOs the site intends to support <br>
    =--url-vo-ca=:         Location of the central list which records all the CAs needed by any OSG VO <br>

---+++!! Description
This is a local probe that checks the supported VO list at the site and verifies if all the CAs needed by the VOs in that list are present at the site. The list of CAs needed by a VO is obtained from a central location at the GOC, the supported VO list is obtained from the $VDT_LOCATION/monitoring/ directory (can be changed by passing parameter). If any CAs needed by a VO listed in the osg-supported-vo-list.txt is missing the probe fails with a critical error.

---+++ !!Results
The probe will produce: 
   * *critical error*: If a CA needed by a VO supported at the site is missing.
  * *unknown*: If the file containing the VO to CA mapping cannot be downloaded successfully from the GOC
   * *ok*: All other cases


---++ Probe to test if the VOMS handshake is being conducted.

*Probe Name*: voms-handshake-verify-probe <br>
*Metrics*:  <br>
*Parameters* :--cacerts-dir \<directory\>, -- url-vo-ca \<URL\>,  --supported-vo-file \<FILE\><br>
    =--error-hours=:  Number of hours elapsed since the last run of edg-mkgridmap before an error is issued <br>
    =--warning-hours=:  Number of hours elapsed since the last run of edg-mkgridmap before a warning is issued <br>
   (Default Values:  3 days and 1 day respectively). <br>

---+++!! Description
This is a local probe that checks when edg-mkgridmap was last run. This probe reads the edg-mkgridmap.log file and looks for the timestamp associated with last entry identifying a completion of an edg-mkgridmap run. If the edg-mkgridmap has not run for a for over 1 day (warning-hours) a warning is issued which gets escalated to a critical error if the last run is over 3 days (error-hours) old.

---+++ !!Results
The probe will produce: 
   * *critical error*: If the last completion entry in the edg-mkgridmap log is over 3 days old.
   * *warning*: If the last completion entry in the edg-mkgridmap log is over 1 day old or if the log file is missing.
   * *ok*: All other cases

---+++ !! TO DO
This probe currently checks voms handshake of only edg-mkgridmap deployment. Once the corresponding functionality for testing VOMS handshake is available for GUMS site then this probe will be modified to work with both edg and GUMS deployment. 

---++ Links
   * Installed instance of the  RSV probes [[https://osg-rsv.ncsa.uiuc.edu:8443/rsv/]] 




-- Main.AnandPadmanabhan - 21 Apr 2009
