%META:TOPICINFO{author="VonWelch" date="1375376334" format="1.1" version="1.9"}%
---++ NOTE

This plan was implemented but is now known to be flawed, per [[https://jira.opensciencegrid.org/browse/OSGPKI-387][OSGPKI-387]], and a reimplemenation is in progress. See the forementioned JIRA issue for details and to track the re-implementation.

---++ Introduction

This document describes OSG PKI plans for certificate renewal, that is a user obtain a new certificate for the same DN and key pair, but with a refreshed expiration date.

It is current a draft and comments to vwelch@indiana.edu are welcome.

---++ Supported Modes of Renewal

   * Users may request renewal of their own user certificate via either a new CLI script or the web (OIM).
      * RAs may not request renewal of a user's certificate.
   * User must have valid certificate and be registered with OIM.
      * No guest/un-authenticated renewal.
   * If renewal cannot be accomplished for any reason, the user must re-request and be vetted.
   * Renewal can only be done if the vetting is less than 5-years old.
   * The user's current email address in OIM must match the email address in their certificate.
      * To comply with policy on unchanged attributes.

---++ Not to be Supported

   * Host certificate renewal. Host certificates, as with the DOE Grids PKI, will be requested each time.
      * A email notification about expiring host certificates will be generated and sent. One email will be sent for each group of host certificates from a bulk request.

---++ Certificate Lifecycle

   * 0-6 months: Certificate cannot be renewed.
      * To prevent multiple accidential renewals.
      * Note that OIM-ITB will not enforce this restriction to allow for testing.
   * 7-12 months: Certificate can be renewed.
   * 12-13 months:
      * Weekly email notifications are sent to certificate owner reminding them of renewal.
         * Once renewed, notifications will stop.
      * A single email notification is sent to the original requestor of host certificates.
   * 13 months: Certificate expires, cannot be renewed.

Note that, by policy, user vetting is required every 5 years and renewal is only possible if user has been vetting in past 5 years.

---++ Notification

   * Starting one month from expiration, weekly reminders are sent to the user.
      * Or to the requestor if for a host certificate.       
   * On renewal, an email is sent to the user and relevant RAs/GAs notifying them of the renewal and asking them to contact the GOC if the renewal is unauthorized.
      * Required by policy.
      * An example of an unauthorized renewal would be a user who has left a VO.

---++ Implementation Decisions

   * We will re-use the CSR from the original request.
      * Makes it very easy for the web interface.

---++ OIM API Overview

   * user_cert_renew
      * This API *starts* renewing certificate, will not wait until it's issued. This API will return immediately after successful start of renewing process)
      * Inputs: DN and serial number of certificate to be renewed
         * It is expected that the DN will be ignored today, but we send it in case it's useful for debugging.
      * Output: request_id to be renewed

   * user_cert_retrieve
      * CLI will call this repeatedly until certificate is issued by DigiCert
      * Inputs: request_id to retrieve certificate or request status.
      * Output: pkcs7, and pem encoded certificate/intermediate certificates

---++ Relevant Policies

Policy with regards to renewal follows. In short, a certificate can be automatically renewed if not expired, nothing has changed, it hasn't been compromised and it has been less than 5 years since manual RA vetting.

Note the last bit, we should send email to the user on renewal.

Relevant portions of Section 4.6 of the [[https://twiki.grid.iu.edu/twiki/pub/Operations/OSGPKIAgreements/OSG_RPS.pdf][RPS]]:

The OSG Operator may renew a certificate if:

   1.    the associated public key has not reached the end of its validity period,
   2.    the Subscriber name and attributes are unchanged,
   3.    the associated private key remains un compromised, and
   4.    re-verification of the Subscriber’s identity is not required under Section 3.3.1.

Section 3.3.1 says: "OSG certificates have a validity period of 13 months. OSG may rekey/renew certificates prior to their expiration date for additional 13 month periods up to a maximum of five years. OSG or a Trusted Agent revalidates the certificate information at least once every five years."

No additional verification is required if the certificate subject information has not changed and less than five years have passed since the certificate’s information was verified. A Trusted Agent must represent that the renewal request is authorized.

The OSG Operator shall use contact information provided by the Subscriber to notify the Subscriber of the certificate’s issuance.

---++ Relevant JIRAs

   * https://jira.opensciencegrid.org/browse/OSGPKI-202
   * https://jira.opensciencegrid.org/browse/OSGPKI-242
   * https://jira.opensciencegrid.org/browse/OSGPKI-307


-- Main.VonWelch - 29 Jan 2013
