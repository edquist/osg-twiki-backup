%META:TOPICINFO{author="KyleGross" date="1480625574" format="1.1" version="1.5"}%
%META:TOPICPARENT{name="IncidentInformation2009"}%
%TOC%


---++ [UPDATE 15] SecurityTeam incident - GRID-SEC-001
<verbatim>

**  GRID-SEC-001 **

This information can be shared with trusted security teams on a need to know basis, 
but must not be redistributed further without prior approval.

(GRID-SEC-001 is directly connected to CERNCERT-20080805, which has become a 
deprecated identifier for the current incident.)

** This message is sent to the CSIRTs of affected grid infrastructures and sites and 
must NOT be publicly archived **

Dear CSIRTs,

The information below was kindly provided by GRID-SEC (http://cern.ch/grid-sec) and collaborating CSIRTs.

*******************************************************
* What's new since the last update                    *
*******************************************************

- Further attacks discovered
- New suspicious IP addresses
- New version of the rootkit discovered (phalanx 2.4a)
- New compromised SSH keys

******************************
* Further attacks discovered *
******************************

While many attacks near the end of April 2009 have been discovered, one site detected a 
malicious connection attempts to the rootkit backdoor as recently as May 30th from the 
IP address 85.10.140.155. During an attack on 1st June, a site reported malicious 
connections from 147.32.200.177 (pcK332-6.feld.cvut.cz) and a new version of the 
phalanx rootkit was discovered (phalanx 2.4a).

************************************
* New suspicious IP addresses  *
************************************

Since the last update, the following IP addresses have been added to the list, along with an 
estimate of their initial suspected involvement date:

147.32.200.177     "1 Jun 2009"
85.10.140.155     "31 May 2009"
193.226.18.67     "27 May 2009"
147.251.27.5     "30 Apr 2009"
207.189.195.198     "27 Apr 2009"
207.189.199.121     "27 Apr 2009"
207.206.206.27     "27 Apr 2009"
209.181.109.146     "27 Apr 2009"
209.181.115.238     "27 Apr 2009"
209.181.149.46     "27 Apr 2009"
207.188.161.89     "26 Apr 2009"
207.189.196.243     "26 Apr 2009"
207.202.159.124     "26 Apr 2009"
207.206.199.46     "26 Apr 2009"
207.206.202.134     "26 Apr 2009"
207.206.205.66     "26 Apr 2009"
207.206.206.11     "26 Apr 2009"
207.206.206.27     "26 Apr 2009"
207.206.206.9     "26 Apr 2009"
207.206.215.10     "26 Apr 2009"
207.206.215.11     "26 Apr 2009"
207.206.215.114     "26 Apr 2009"
207.206.215.114     "26 Apr 2009"
207.206.215.142     "26 Apr 2009"
207.206.215.150     "26 Apr 2009"
207.206.215.202     "26 Apr 2009"
207.206.215.8     "26 Apr 2009"
207.206.215.9     "26 Apr 2009"
207.206.217.134     "26 Apr 2009"
207.206.219.41     "26 Apr 2009"
207.206.222.64     "26 Apr 2009"
207.206.222.82     "26 Apr 2009"
207.207.79.225     "26 Apr 2009"
207.224.103.190     "26 Apr 2009"
207.224.103.197     "26 Apr 2009"
207.224.103.49     "26 Apr 2009"
207.224.103.78     "26 Apr 2009"
207.224.103.94     "26 Apr 2009"
207.224.105.246     "26 Apr 2009"
207.224.109.30     "26 Apr 2009"
207.224.110.243     "26 Apr 2009"
207.224.110.86     "26 Apr 2009"
207.224.111.190     "26 Apr 2009"
207.224.112.166     "26 Apr 2009"
207.224.112.182     "26 Apr 2009"
207.224.113.134     "26 Apr 2009"
207.224.119.198     "26 Apr 2009"
207.224.119.246     "26 Apr 2009"
207.224.126.13     "26 Apr 2009"
207.224.126.86     "26 Apr 2009"
207.224.127.88     "26 Apr 2009"
207.224.13.19     "26 Apr 2009"
207.224.147.86     "26 Apr 2009"
207.224.160.150     "26 Apr 2009"
207.224.203.20     "26 Apr 2009"
207.224.214.123     "26 Apr 2009"
207.224.24.206     "26 Apr 2009"
207.224.24.6     "26 Apr 2009"
207.224.25.110     "26 Apr 2009"
207.224.25.174     "26 Apr 2009"
207.224.26.119     "26 Apr 2009"
207.224.31.246     "26 Apr 2009"
207.224.31.86     "26 Apr 2009"
207.224.36.110     "26 Apr 2009"
207.224.36.246     "26 Apr 2009"
207.224.37.222     "26 Apr 2009"
207.224.39.222     "26 Apr 2009"
207.224.39.94     "26 Apr 2009"
207.224.49.109     "26 Apr 2009"
207.224.51.85     "26 Apr 2009"
207.224.62.228     "26 Apr 2009"
207.224.79.173     "26 Apr 2009"
207.224.9.249     "26 Apr 2009"
207.224.99.142     "26 Apr 2009"
207.225.109.157     "26 Apr 2009"
207.225.110.248     "26 Apr 2009"
207.225.143.230     "26 Apr 2009"
207.225.143.73     "26 Apr 2009"
207.225.144.142     "26 Apr 2009"
207.225.144.150     "26 Apr 2009"
207.225.144.22     "26 Apr 2009"
207.225.144.6     "26 Apr 2009"
207.225.167.78     "26 Apr 2009"
207.225.168.14     "26 Apr 2009"
207.225.168.249     "26 Apr 2009"
207.225.206.62     "26 Apr 2009"
207.225.208.174     "26 Apr 2009"
207.225.223.86     "26 Apr 2009"
207.225.250.102     "26 Apr 2009"
207.225.250.94     "26 Apr 2009"
207.225.26.70     "26 Apr 2009"
207.225.39.118     "26 Apr 2009"
207.225.48.155     "26 Apr 2009"
207.225.79.16     "26 Apr 2009"
209.181.115.197     "26 Apr 2009"
209.181.115.198     "26 Apr 2009"
209.181.122.158     "26 Apr 2009"
209.181.129.198     "26 Apr 2009"
209.181.254.118     "26 Apr 2009"
209.188.120.24     "26 Apr 2009"
209.188.121.129     "26 Apr 2009"
209.188.99.25     "26 Apr 2009"
69.10.193.189     "26 Apr 2009"
69.11.178.186     "26 Apr 2009"
69.49.165.210     "26 Apr 2009"
141.20.77.10     "22 Apr 2009"
195.113.29.13     "22 Apr 2009"
217.23.20.104     "21 Apr 2009"
158.130.67.216     "17 Apr 2009"
158.130.69.89     "17 Apr 2009"
138.232.146.52     "16 Apr 2009"
69.129.195.180     "12 Dec 2008"
219.209.160.40     "8 Dec 2008"
206.12.24.201     "4 Dec 2008"
67.228.177.47     "3 Dec 2008"
69.129.203.54     "5 Oct 2008"
65.107.69.198     "30 Sep 2008"
130.237.208.250     "3 Sep 2008"
130.237.208.76     "3 Sep 2008"
209.181.133.34     "8 Aug 2008"
168.7.16.22     "24 Jul 2008"
128.9.208.113     "7 Jul 2008"
158.130.52.142     "1 Apr 2008"
192.251.226.205     "7 Mar 2008"

As a result, it is highly recommended to carefully monitor and report connections from 
these IP addresses:


IP address        "Initial suspected involvement"

147.32.200.177     "1 Jun 2009"
85.10.140.155     "31 May 2009"
193.226.18.67     "27 May 2009"
147.251.27.5     "30 Apr 2009"
87.109.12.120     "28 Apr 2009"
87.109.179.29     "28 Apr 2009"
87.109.43.204     "28 Apr 2009"
87.91.245.246     "28 Apr 2009"
217.12.85.178     "28 Apr 2009"
93.148.9.221     "28 Apr 2009"
80.13.99.104     "28 Apr 2009"
80.13.126.239     "28 Apr 2009"
82.248.2.245     "28 Apr 2009"
87.236.255.18     "28 Apr 2009"
87.228.52.153     "28 Apr 2009"
87.123.6.85     "28 Apr 2009"
69.128.189.10     "28 Apr 2009"
69.128.147.2     "28 Apr 2009"
87.107.109.46     "28 Apr 2009"
157.88.66.5     "28 Apr 2009"
217.219.106.14     "28 Apr 2009"
87.232.132.234     "28 Apr 2009"
134.58.117.136     "28 Apr 2009"
87.81.71.129     "28 Apr 2009"
87.81.42.32     "28 Apr 2009"
87.80.42.130     "28 Apr 2009"
87.80.216.89     "28 Apr 2009"
69.37.246.4     "28 Apr 2009"
87.114.149.157     "28 Apr 2009"
87.114.0.130     "28 Apr 2009"
87.249.175.177     "28 Apr 2009"
87.194.141.240     "28 Apr 2009"
87.119.238.53     "28 Apr 2009"
85.232.27.189     "28 Apr 2009"
85.232.26.8     "28 Apr 2009"
85.232.26.4     "28 Apr 2009"
85.232.26.144     "28 Apr 2009"
82.128.207.37     "28 Apr 2009"
80.174.245.228     "28 Apr 2009"
80.188.106.73     "28 Apr 2009"
87.100.29.38     "28 Apr 2009"
80.25.42.199     "28 Apr 2009"
209.181.109.146     "27 Apr 2009"
209.181.115.238     "27 Apr 2009"
209.181.122.222     "27 Apr 2009"
209.181.149.46     "27 Apr 2009"
207.189.195.198     "27 Apr 2009"
207.206.206.27     "27 Apr 2009"
207.189.199.121     "27 Apr 2009"
207.206.215.11     "26 Apr 2009"
207.206.215.114     "26 Apr 2009"
207.206.215.122     "26 Apr 2009"
207.206.215.142     "26 Apr 2009"
207.206.215.150     "26 Apr 2009"
207.206.215.202     "26 Apr 2009"
207.206.215.8     "26 Apr 2009"
207.206.215.9     "26 Apr 2009"
207.224.103.190     "26 Apr 2009"
207.224.103.197     "26 Apr 2009"
207.224.103.49     "26 Apr 2009"
207.224.103.78     "26 Apr 2009"
207.224.103.94     "26 Apr 2009"
207.224.105.246     "26 Apr 2009"
207.224.110.243     "26 Apr 2009"
207.224.110.86     "26 Apr 2009"
207.224.111.190     "26 Apr 2009"
207.224.112.166     "26 Apr 2009"
207.224.112.182     "26 Apr 2009"
207.224.113.134     "26 Apr 2009"
207.224.119.198     "26 Apr 2009"
207.224.119.246     "26 Apr 2009"
207.224.126.13     "26 Apr 2009"
207.224.126.86     "26 Apr 2009"
207.224.127.88     "26 Apr 2009"
207.224.147.86     "26 Apr 2009"
207.224.160.150     "26 Apr 2009"
207.224.214.123     "26 Apr 2009"
207.224.215.94     "26 Apr 2009"
207.224.24.206     "26 Apr 2009"
207.224.24.6     "26 Apr 2009"
207.224.25.110     "26 Apr 2009"
207.224.25.174     "26 Apr 2009"
207.224.31.246     "26 Apr 2009"
207.224.31.86     "26 Apr 2009"
207.224.36.110     "26 Apr 2009"
207.224.36.246     "26 Apr 2009"
207.224.37.222     "26 Apr 2009"
207.224.39.222     "26 Apr 2009"
207.224.39.94     "26 Apr 2009"
207.224.49.109     "26 Apr 2009"
207.224.51.85     "26 Apr 2009"
207.224.99.142     "26 Apr 2009"
207.225.109.157     "26 Apr 2009"
207.225.143.230     "26 Apr 2009"
207.225.143.73     "26 Apr 2009"
207.225.144.150     "26 Apr 2009"
207.225.144.22     "26 Apr 2009"
207.225.144.6     "26 Apr 2009"
207.225.206.62     "26 Apr 2009"
207.225.208.174     "26 Apr 2009"
207.225.223.86     "26 Apr 2009"
207.225.248.150     "26 Apr 2009"
207.225.250.102     "26 Apr 2009"
207.225.250.94     "26 Apr 2009"
207.225.26.70     "26 Apr 2009"
207.225.48.155     "26 Apr 2009"
209.181.115.198     "26 Apr 2009"
209.181.122.158     "26 Apr 2009"
209.181.129.198     "26 Apr 2009"
209.181.254.118     "26 Apr 2009"
207.225.144.142     "26 Apr 2009"
207.206.205.66     "26 Apr 2009"
209.181.115.197     "26 Apr 2009"
207.225.168.14     "26 Apr 2009"
207.206.199.46     "26 Apr 2009"
207.206.206.9     "26 Apr 2009"
207.206.222.82     "26 Apr 2009"
207.206.222.64     "26 Apr 2009"
207.206.202.54     "26 Apr 2009"
207.206.219.41     "26 Apr 2009"
207.206.206.27     "26 Apr 2009"
207.206.217.134     "26 Apr 2009"
207.206.202.134     "26 Apr 2009"
207.202.159.124     "26 Apr 2009"
207.206.206.11     "26 Apr 2009"
69.11.178.186     "26 Apr 2009"
209.188.99.25     "26 Apr 2009"
207.206.215.10     "26 Apr 2009"
207.225.110.248     "26 Apr 2009"
207.188.161.89     "26 Apr 2009"
69.49.165.210     "26 Apr 2009"
69.10.193.189     "26 Apr 2009"
207.189.196.243     "26 Apr 2009"
209.188.121.129     "26 Apr 2009"
209.188.120.24     "26 Apr 2009"
207.225.79.16     "26 Apr 2009"
207.225.39.118     "26 Apr 2009"
207.225.168.249     "26 Apr 2009"
207.225.167.78     "26 Apr 2009"
207.225.167.150     "26 Apr 2009"
207.224.9.249     "26 Apr 2009"
207.224.79.173     "26 Apr 2009"
207.224.62.228     "26 Apr 2009"
207.224.26.119     "26 Apr 2009"
207.224.203.20     "26 Apr 2009"
207.224.13.19     "26 Apr 2009"
207.224.109.30     "26 Apr 2009"
207.207.79.225     "26 Apr 2009"
141.20.77.10     "22 Apr 2009"
91.138.122.217     "22 Apr 2009"
195.113.29.13     "22 Apr 2009"
217.23.20.104     "21 Apr 2009"
169.244.3.2     "18 Apr 2009"
158.130.67.216     "17 Apr 2009"
158.130.69.89     "17 Apr 2009"
138.232.146.52     "16 Apr 2009"
82.145.72.17     "22 Mar 2009"
130.88.197.197     "22 Mar 2009"
69.129.193.99     "13 Mar 2009"
69.128.189.15     "13 Mar 2009"
69.128.189.14     "13 Mar 2009"
69.128.189.13     "13 Mar 2009"
69.128.189.12     "13 Mar 2009"
69.128.189.10     "13 Mar 2009"
69.128.171.92     "13 Mar 2009"
69.128.147.7     "13 Mar 2009"
69.128.147.6     "13 Mar 2009"
69.128.147.5     "13 Mar 2009"
69.128.147.4     "13 Mar 2009"
69.128.147.2     "13 Mar 2009"
69.129.125.219     "4 Jan 2009"
208.112.17.204     "19 Dec 2008"
69.129.195.180     "12 Dec 2008"
219.209.160.40     "8 Dec 2008"
67.148.94.172     "4 Dec 2008"
64.72.120.48     "4 Dec 2008"
206.12.24.201     "4 Dec 2008"
67.228.177.47     "3 Dec 2008"
141.20.77.34     "1 Dec 2008"
207.224.103.198     "30 Nov 2008"
209.181.189.198     "30 Nov 2008"
69.49.172.31     "30 Nov 2008"
209.160.40.14     "29 Nov 2008"
69.128.147.2     "19 Nov 2008"
193.0.73.34     "1 Nov 2008"
69.130.130.117     "17 Oct 2008"
69.129.203.54     "5 Oct 2008"
132.239.95.85     "30 Sep 2008"
65.107.69.198     "30 Sep 2008"
69.129.17.242     "21 Sep 2008"
137.248.152.49     "21 Sep 2008"
202.51.211.2     "16 Sep 2008"
64.27.17.70     "9 Sep 2008"
69.130.80.36     "9 Sep 2008"
69.130.182.213     "9 Sep 2008"
69.130.136.116     "9 Sep 2008"
69.130.104.49     "9 Sep 2008"
69.130.104.157     "8 Sep 2008"
208.35.255.106     "3 Sep 2008"
130.237.208.76     "3 Sep 2008"
130.237.208.250     "3 Sep 2008"
99.237.220.123     "14 Aug 2008"
209.181.133.34     "8 Aug 2008"
208.42.23.94     "28 Jul 2008"
190.81.35.90     "28 Jul 2008"
207.206.202.54     "28 Jul 2008"
189.6.137.174     "28 Jul 2008"
75.60.89.233     "26 Jul 2008"
216.186.49.132     "25 Jul 2008"
131.142.42.17     "25 Jul 2008"
207.225.248.150     "24 Jul 2008"
209.181.122.222     "24 Jul 2008"
209.181.138.229     "24 Jul 2008"
168.7.16.22     "24 Jul 2008"
207.206.215.122     "22 Jul 2008"
136.159.55.31     "22 Jul 2008"
209.181.131.209     "14 Jul 2008"
207.224.215.94     "10 Jul 2008"
128.9.208.113     "7 Jul 2008"
216.184.13.238     "6 Jul 2008"
209.181.242.70     "13 Jun 2008"
99.236.185.205     "25 May 2008"
66.230.230.230     "23 May 2008"
83.134.152.127     "15 May 2008"
158.130.52.142     "1 Apr 2008"
192.251.226.205     "7 Mar 2008"


Note that there are now several IP addresses in the 69.128, 69.129, 69.130, 
207.206, 207.224 and 207.225 network blocks. Any connection from these 
locations should be treated as suspicious and verified with the appropriate user(s). 
Note however that at least one connection from 69.129 has been confirmed to be legitimate.

* Update on the rootkit *

In many cases, the attacker gains root access by exploiting known vulnerabilities, 
it is therefore essential to ensure Linux hosts are kept up-to-date with security patches.

Recent kernels should prevent Phalanx (and similar rootkits) to be injected via 
/dev/mem modifications (both RHEL 4 and RHEL5 have released kernels to implement this). 
Beware however that a new version "2.4a" of the Phalanx rootkit has been seen in the wild, 
which first tries to inject the malware via /dev/mem, but in case it does not succeed, 
it tries to load the malware as a standard Linux Kernel Module (LKM).

As per the last updates, while the attacker has mostly been concentrating on SSH keys, 
it seems that standard passwords are being sniffed and reused also.

It has also been discovered that connections to the backdoor can produce the following 
syslog message (usually in /var/log/secure, /var/log/message):

---------------8<------------------
sshd[XXXX]: Disconnecting: Bad packet length 1883783500.
---------------8<------------------
(where XXXX is the PID of sshd)


For phalanx < 2.4a:
Although the rootkit hides in different locations (ex: /usr/lib/heahu.p2/, /usr/lib/huuuh.p2, 
/usr/lib/zupzz.p2, etc.), the backdoor does not support some characters and should 
segfault using this command:

(echo SSH-2.0-OpenSSH_3.8.1p1; sleep 1; echo 'pHALANX2!'kill_phalanx2'+++++++++++++++'| cut -c 1-31; sleep 1; echo 'test'; cat)|nc <POSSIBLY_INFECTED_HOSTNAME> 22

(<POSSIBLY_INFECTED_HOSTNAME> is the hostname that is checked for signs of the rootkit)

The resulting syslog message on <POSSIBLY_INFECTED_HOSTNAME> would look like:
<DATE> <POSSIBLY_INFECTED_HOSTNAME> kernel: <malicious_kernel_thread>:
segfault at 0000000000000000 rip 0000000000418900 rsp 0000007fbfff8698 error 4

Once the host has been probed, the existence of such a syslog message is a very strong indication 
it has been infected by the rootkit. Note that this test does not work with Phalanx 2.4a, which is also 
implementing randomized paths.

However, for all versions for the rootkit, it is possible that a malicious cron job has been 
configured to inject the rootkit, which would leave entries in syslog. Ex:

"/usr/share/FKIPzLXRAvaL.p2/.p-2.4ai & > /dev/null"

*************************************************
* Suspicious SSH key and rootkit detecting tool *
*************************************************

It is possible to use suspicious SSH keys and rootkit detecting tool provided by the community. 
The tools on the page below are kindly provided by their authors and do not come with any 
guarantee whatsoever, use it at your own risk!

https://cern.ch/osct/7e0564aeabe51c2b1c69570c8d931bf2

Please report any suspicious activity to enable other sites to search for the patterns you may have detected. 
This is essential to prevent the attack from spreading further in the community.

Regards,

Romain Wartel on behalf of GRID-SEC. 

</verbatim>

---++ OSG-SEC-NOTIFY-2009-06-05
<verbatim>
*DO NOT distribute without explicit permission from the OSG Security Team*

OSG Security Contacts,

Note that the primary identifier for this ongoing incident has
changed from CERNCERT-20080805 to GRID-SEC-001 with this notice.

The OSG Security Team wants you to be aware of new information regarding
ongoing attacks via ssh credential stealing. Please note that these
attacks are different from regular bruteforce ssh attempts you see
on daily basis.  In these incidents, miscreants are stealing users
credentials and attempt local root escalation exploits to obtain root
within your network.

Above information is complied by cumulative efforts of multiple sites who
have been monitoring this activity.

Any login from the IP address in this report should be considered malicious
and be reported to security team. We can further help you to determine if
your site indeed has a problem.

Please see the following url for more details:

https://twiki.grid.iu.edu/bin/view/Security/OSG-SEC-NOTIFY-2009-06-05


FAQ:

1) How do I access the above URL ?

Access to the above URL requires an OSG TWiki account. If you don't
already have an account, please see the registration instructions at:

https://twiki.grid.iu.edu/bin/view/TWiki/TWikiRegistration

2) Why do you put this information on Twiki and not in email ?

We are distributing this information via the OSG TWiki in an attempt
to avoid leaks. Please do not redistribute this information. Please
take care that it does not appear in public email list archives.

3) What do I do if I see any positive hits or issues mentioned in
the above notice ?

Please promptly report security incidents involving OSG resources
according to:

https://twiki.grid.iu.edu/bin/view/Security/IncidentDiscoveryReporting

4) What can I do to prevent my site for such attacks ?

Please implement recommended security practices to protect your
systems from attack:

https://twiki.grid.iu.edu/bin/view/Security/BestPractices

Please contact security@opensciencegrid.org if you have any questions
or concerns.

This message is digitally signed. We encourage you to verify the
digital signatures on OSG security announcements according to:

https://twiki.grid.iu.edu/bin/view/Security/SecureEmail

Sincerely,
Doug Olson
on behalf of the OSG Security Team
</verbatim>

---++ Access Control

_Uncomment the appropriate access control policy for this incident page. Logout of the twiki and try to access the page to ensure it is not publicly accessible. Do not attach files, as they will not be protected (see  [[http://twiki.org/cgi-bin/view/TWiki/TWikiAccessControl#Controlling_access_to_Attachment][http://twiki.org/cgi-bin/view/TWiki/TWikiAccessControl#Controlling_access_to_Attachment]])._

Incident information accessible by SecurityTeam Team members and GOC only:
   * #Set ALLOWTOPICVIEW = Main.SecurityTeamTeamGroup, Main.GocGroup
   * #Set ALLOWTOPICCHANGE = Main.SecurityTeamTeamGroup, Main.GocGroup

Incident information accessible by all authenticated twiki users:
   * Set ALLOWTOPICVIEW = Main.GridGroup, Main.RomainWartel
   * Set ALLOWTOPICCHANGE = Main.GridGroup, Main.RomainWartel



-- Main.DougOlson - 05 Jun 2009