%META:TOPICINFO{author="MineAltunay" date="1226518631" format="1.1" reprev="1.3" version="1.3"}%
%META:TOPICPARENT{name="SecurityTeamWorkingArea"}%
---+ RSV security Probes Phase 3 v2
%TOC%

---++Centralized Probes

The Centralized RSV probes will be run by GOC and will monitor the status of the CAs being distributed by both OSG and VDT and the corresponding CRLs.

---++++Distribution Availability Probes
*High-level Goal*: check OSG provided CA distribution mechanisms are available 
We have at least four separate distribution mechanisms provided by OSG: pacman caches at VDT and GOC and yum repositories at GOC and VDT. These services are critical for OSG operations. We will check if these services are up and running and provide the CA content. 

---++++Distribution Content Probes
*High-level Goal*: check if the CAs included in a distribution service complies with OSG requirements. For each distribution service, we have a list of CAs to be included. For example, VDT must include IGTF latest distribution + Fermi KCA. GOC must include IGTF latest distribution+ FNAL KCA+ TeraGrid CAs. I expect this probe to check if the distribution service has the latest version of IGTF distribution and includes all other necessary CAs. The security team is responsible for detecting a new IGTF distribution and creating a new CA package to be distributed. Having said that this is done very ad-hoc manner: it is likely Jim may be on vacation and I miss email from IGTF on new distribution. To prevent this situation, I like to automate this process. I am ready to list the expected content of CAs in each distribution service we have.   
  
---++++CA Probe 
*High-level Goal*: check if CAs contained in a distribution service are up-to-date. Check if any of the certificates are expired or about to expire. This probe must be applied to all distribution services that passed the availability and content probes successfully. Any distribution service who failed the availability and content probes will be examined first. 
 
The CA probes will just check the validity/expiry of the certificates using openssl commands against a particular directory. We will require the deployment to be done against each of the distribution service. Additionally we will require the CRLs to be kept in a different location than the CAs, so as to make sure that the expiry of a CRLs does not impact the result of the CA probe. 

---++++CRL distribution-availability probe
*High-level Goal*: Check if our central retrieval mechanism for downloading CRLs is available and working. 

---++++CRL Probe
*High-level Goal*: Check if CRL files of CAs included in a distribution service is up-to-date. This probe downloads the CRLs directly from the CA web site and checks whether the current CRL has expired or not.  If the CRLs are expired, the CA name will be outputted. Additionally the probes will produce warnings if the CRLs are set to expire within 3 days. 


*Implementation Considerations:*
This probe (or the corresponding distribution availability probe) will pass out any error information from fetch-crl. Additionally the probe will also check the timestamps associated with the files and produce an error if the file has not been updated over the last X runs, because this could indicate a problem with the crl_url distributing the crl files. 
*M. Altunay* : how frequently does  CA have to produce a new CRL, if there is no revocation? Why X runs? 

*Arvind's Comments*: Arvind has similar comment for the CRL probe as CA probe, he wanted to keep the fetch-crl process separate from the probe. 

*Anand's Comments*: Keeping the probe and the fetch-crl process separate could be good from a design perspective, but could again cause the probes to miss potential errors being reported by fetch-crl. Another aspect to consider is the interaction between the CAs and CRLs. If we use the same directory to downloaded cas and crls, if one of them expires then other probe could also report problem 

*M. Altunay:* I do not care how we fetch the CRLs. Given we encourage OSG sites to use fetch-crl, I would like to use the same method as our users do. Since we do not have another mechanism ready for fetching the CRLs, I do not see why not using it? 



---++Site (Local) Probes

These probes are meant to run locally on a site machine

---++++CA probe (availability)
*High-level Goal*: Check if a site has up-to-date CA distribution package provided by OSG. Note I did NOT say if a site has up-to-date certificates. This is on purpose: certificates are provided by OSG distribution services and OSG is responsible for content, availability and freshness of these distribution services. Sites are NOT expected to individually download a CA certificate directly from that CA’s website. However, we do expect sites to have the latest versions of our distribution services. I want this probe to return a success as long as a site has downloaded the latest version of OSG CA distribution services. 


*Address to Arvind's comment*: Arvind claimed if a site uses RPM distribution service, the above method may not work. ? I think we can check which version of RPMs have been installed from YUM repository and as long as it matches the latest version, we return a success status. 

*Having said this*, I do realize that we expect OSG sites to use one of OSG distribution services. If we agree that  there could be sites who never uses our distribution services, but get their certs from other places themselves for example directly downloading from IGTF website
, Then I agree to check each cert locally via openssl and then comparing it with CA's own website, if it expired. Then again, the problem would be if OSG has no clue about what this CA is, how do we even find the CA's web site to check its currency.   

One might argue if a site went out of its way to install certificates from unknown distributions and then let it expire, oh well, we will return a failure message for that site even if it is the CA's fault. 

Again I think almost all sites especially WLCG sites uses one of OSG distribution services, let's not make this any more complicated than necessary. 


---++++CRL probe
*High-level Goal:* Check if a site has filestamps for the CRL files that are within the last 6 hours. Note I am NOT saying site has to have up-to-date CRLs. I do not need to bring any complexity to this. WLCG requirement only asks about filestamp to be within last 6 hour. 

---++Additional local probes that are CURRENTLY NOT reported to WLCG, and only used by OSG for our own purposes

---++++CRL expiry-dates probe
*High-level goal*: Check if a site has up-to-date CRL files for all CAs installed on the machine. This probe checks if the CRLs are expired or not and sends GOC a list of expired CRLs

---++++CRL update-mechanism probe 
*High-level Goal:* This probe checks if the site has enabled fetch-crl mechanism to run every 6 hours. 

---++++CA supported-VO probe
*High-level Goal:* Check if a site has CAs installed that are necessary to support the VOs that site has agreed to support. This probe will check if site has installed all of the CAs that supported VOs has advertised. I expect this probe will become the availability probe in future. I do not expect the siet to manually go download the CA certificates. They should have dimply keep up-to-date versions of OSG distribution services. This probe will make sure that none of the required CAs are excluded from the installation. (This may require checking the vdt-cert-update.config file. The sites that uses RPMs will install the entire CA stack from the yum repository anyway. So those sites would be good as long as they have the latest version of yum repository.) Important Note: All of the CAs that are used by OSG VOs will be included in OSG CA distribution services. 

---++++CRL supported-VO probe
*High-level Goal:* Check if the site has an up-to-date version of CRLs for supported VO CAs. check the filestamp on the CRL files to determine if site has updated the CRLs in the last 6 hours. 
*As long this probe is reported to WLCG, I will keep it identical to EGEE implementation.* 

---++++HostCert probe
*High-level Goal*: checks if the local machine's (that we run RSV probe on) certificate has been expired or not. 

---++++GUMS availability probe
*High-level Goal*: Check if GUMS service is up and running. (This could be problematic as GUMS only accepts connections form the gatekeeper. The probe must be run by gatekeeper). 

---++++GUMS version probe
*High-level Goal*: Check which version of GUMS is installed and which version of GUMS template is installed. 

---++++Supported-VO probe
*High-level Goal*: Check which VOs are supported by this site. Note I did not refer to GUMS because I would like this information to come from edg-mkgridmapfile OR from GUMS whichever one is installed and used by the gatekeeper. 

---++++VOHandshake frequency probe
*high-level Goal*: Check how frequently site is downloading VOMS membership information from VOs. In other words, check GUMS or edg-mkgridmapfile conifguration for download frequency

---++++VOMS availability probe
*High-level Goal*: Check if a VOMS server is up and running. try downloading member users. 

---++++VOMS version probe
*High-level Goal*: Check the version of a VOMS server. 

 








-- Main.MineAltunay - 11 Nov 2008
