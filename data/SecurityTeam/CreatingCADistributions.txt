%META:TOPICINFO{author="JimBasney" date="1220476693" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="SecurityTeamWorkingArea"}%
%TOC%
---+ Creating CA Distributions
 This page documents the OSG Security Team process for creating new Certificate Authority packages for distribution to OSG sites.

---++ Setup
   1 Get a user certificate+key in pkcs12 format from the DOEGrids CA or another trusted CA. 
   1 Ask goc@opensciencegrid.org to add permissions for your certificate subject to access the https://osg-svn.rtinfo.indiana.edu/cadist svn repository. 
   1 Install an svn client. Version 1.4.x is strongly recommended. Don't use a version 1.5.x client. 
   1 Configure svn to use your pkcs12 certificate+key for authentication by adding the following to ~/.subversion/servers, changing the path to your pkcs12 file as appropriate:<br />[groups]<br />iu = *.indiana.edu<br />[iu]<br />ssl-client-cert-file = /home/username/.globus/usercred.p12 
   1 Checkout a copy of the https://osg-svn.rtinfo.indiana.edu/cadist svn repository:<br />$ svn co https://osg-svn.rtinfo.indiana.edu/cadist 
---++ Updating to a new IGTF distribution
   1 Change to an empty working directory and set $CAWORKDIR to the path:<br />$ cd /tmp/osg-certs-20080903<br />$ export CAWORKDIR=`pwd` 
   1 Download the new IGTF distribution tarball from http://www.eugridpma.org/distribution/igtf/current/accredited/:<br />$ wget http://dist.eugridpma.info/distribution/igtf/current/accredited/igtf-policy-installation-bundle-1.24.tar.gz 
   1 Set $IGTFVERSION and unpack the certificates:<br />$ export IGTFVERSION=1.24<br />$ tar xzf igtf-policy-installation-bundle-$IGTFVERSION.tar.gz 
   1 Make an installation directory:<br />$ mkdir made-igtf-$IGTFVERSION 
   1 Configure the installation. We want all of the accredited CAs plus the Fermilab KCA certificate:<br />$ cd igtf-policy-installation-bundle-$IGTFVERSION<br />$ ./configure --prefix=../made-igtf-$IGTFVERSION --with-profile=classic --with-profile=slcs --with-profile=mics --with-authority=FNAL_KCA 
   1 Install the certificates into your temporary directory:<br />$ make install 
   1 Go to a checkout of the https://osg-svn.rtinfo.indiana.edu/cadist svn repository and make sure it's up-to-date:<br />$ cd ~/svn/osg/cadist/trunk/CA-Certificates-Base<br />$ svn update 
   1 Run the process-igtf-distribution.pl script:<br />$ ./process-igtf-distribution.pl $CAWORKDIR/made-igtf-$IGTFVERSION ./certificates > igtf-$IGTFVERSION-update.log 
   1 Review igtf-$IGTFVERSION-update.log, igtf-$IGTFVERSION-update-diffs.log, and igtf-$IGTFVERSION-update-script.sh. Be sure to understand the differences, even though most of them are CVS related or are simple version string changes. Be particularly careful about hashes in the output that have &ldquo;files not in IGTF&rdquo; next to them--they will be deleted! Re-run the process-igtf-distribution.pl script as needed. 
   1 Run the update script:<br />$ ./igtf-$IGTFVERSION-update-script.sh 
   1 Verify changes:<br />$ svn diff > /tmp/diffs 
   1 Update the certificates/INDEX.txt file. Don't miss the version number at the bottom of the page. 
   1 Update the certificates/CHANGES file. 
   1 Commit all changes:<br />$ svn commit 
---++ Updating to a new !TeraGrid CA distribution
---++ Other updates
---++ Make the CA tarball
---++ Make the manifest
---++ Make the RPM and update the YUM repository
---++ Update the web site
---++ Announce the new distribution
---++ References
   * [[http://vdt.cs.wisc.edu/internal/igtf-updates.html][VDT Distribution Process]] 
   * [[http://svnbook.red-bean.com/en/1.4/][Subversion Manual]] and [[http://svnbook.red-bean.com/en/1.4/svn.ref.html][Subversion Reference]] 
   * [[https://rt-svn.uits.indiana.edu/svn-web/osg/][OSG WebSVN]] 
   * [[http://dist.eugridpma.info/distribution/igtf/current/][IGTF Distribution]] 
   * [[http://security.teragrid.org/TG-CAs.html][TeraGrid CAs]] 
   * [[http://www.tacar.org/][TERENA Academic CA Repository]]
