%META:TOPICINFO{author="AnandPadmanabhan" date="1348689646" format="1.1" reprev="1.14" version="1.14"}%
%META:TOPICPARENT{name="SecurityTeamWorkingArea"}%
<!--
   * Set NOT_STARTED = Not Started
   * Set NOT_RELEASED = Not Released
   * Set ON_TRACK = <div style="background-color: #3366FF; color:white">&nbsp;On Track&nbsp;</div>
   * Set BEHIND = <div style="background-color: #CCFF00;">&nbsp;Behind&nbsp;</div>
   * Set AT_RISK = <div style="background-color: #CC0000; color:white">&nbsp;At risk&nbsp;</div>
   * Set ACHIEVED = <div style="background-color: #00FF66;">&nbsp;Achieved&nbsp;</div>
   * Set RELEASED = <div style="background-color: #00FF66;">&nbsp;Released&nbsp;</div>
   * Set TWISTY_OPTS_DETAILS = mode="div" showlink="Details" hidelink="Hide" showimgleft="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" hideimgleft="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" remember="on" start="hide" 
-->

---++ Project plan to phase out old layout CA bundle
---+++ Problem Statement
The OSG CA certificates are currently released in two different layout/formats. The difference between these format is that the old layout has hashes that are only compatible with openssl 0.9.x, while the new layout has hashes (using symlinks) that are compatible with both openssl 0.9.x. and 1.0.x. The new layout has been in production in OSG for over an year and is the default in the RPM releases. IGTF want to stop supporting the old format and are keeping it in their release just for OSG. The OSG security team would like to phase out and stop distributing the CA release using old layout. 

---+++ Goal
   * Phase out and stop distributing the CA release using old layout. 

---+++ Project Team
   * Security Team: Anand  (Lead), Mine
   * Participants: Alain (VDT), GOC

---+++ Deliverable from the project:
   * Instructions for sites to do the transition
   * Update CA release process documentation
   * Update OSG documentation 

---+++ Schedule
   * Effort: 4 FTE week
   * Project start : July 1, 2012
   * Project End Date: Nov 30, 2012
      * Development Phase ends: Sep 30, 2012
      * Deprecation of GOC service: Nov 30, 2012

---+++Project implementation Plan (Steps for deprecating CA certs RPMs from GOC's Yum repository)
%TABLE{ sort="off" valign="top" }%
| *Task* | *State* | *Owner* | *Target Start* | *Target Finish* | *Actual Finish* | *Notes* |
| Identify sites that are using old layout and downloading tarballs | %ON_TRACK% | Anand/Scott | 01Jul2012 | 30Jul2012 | -  | We are looking at the access logs for old layout tarballs from GOC production repository |
| Identify sites that have installed the *-compat CA rpms from osg RPM repository | %ON_TRACK% | Anand/Scott | 01Jul2012 | 30Jul2012 | - | We are reviewing the access log of rpm site for one month |
| Develop a Transition Plan for deprecating old CA layout | %ON_TRACK% | Anand | 15Jul2012 | 15Aug2012 | - | - |
| Identify OSG software if any that will be affected by the change | %NOT_STARTED% | Anand/Alain | 01Aug2012 | 31Aug2012 | - | - |
| Contact OSG VOs and see if the transition affects their S/W  | %ON_TRACK% | Anand/Alain | 01Aug2012 | 31Aug2012 | - | - |
| Broadly announce of Change to OSG community (specifically target sites, VOs and software contributors)  | %ON_TRACK% | Anand | 01Aug2012 | 30Aug2012 | - | A broad email to all the VOs was sent out on Aug 3. Anand sent an email to the VOs that were running old version of voms-admin server on Aug 24. |
| Develop instruction as needed to facilitate transition  | %NOT_STARTED% | Anand | 01Sep2012 | 30Sep2012 | - | - |
| Update the CA release process documentation on twiki  | %NOT_STARTED% | Anand | 15Sep2012 | 30Sep2012 | - | - |
| Update OSG documentation on twiki/software.grid.iu.edu  | %NOT_STARTED% | Scott | 15Sep2012 | 30Sep2012 | - | - |
| Continue release updates of CA packages in old layout  | %NOT_STARTED% | Anand | - | 30Nov2012 | - | - |
| Deprecate the old layout CA releases  | %NOT_STARTED% | Anand/Scott | - | 30Nov2012 | - | - |

---+++ Dependencies/ Risks
   * One of the big concerns is that we are switching the CA bundle layout from old to new is due to the fact that CA certificates are integral part of our security infrastructure.  We were concerned that a site which uses the old layout might have legacy software which could stop working after a switch to new layout. The new layout had no problems with vdt software stack except for the old legacy versions of VOMS servers. The new layout has been available in the software repo (and via Koji) for a while. 

---+++ Transition Plan 
The OSG security team releases the CAs in three flavors (tarball, rpm and deb) and we will outline the plan for each of these flavors
   * The tarballs are downloaded by a osg-ca-manage/osg-update-certs that rely on a metadata (ca-versions) file that is hosted on the GOC webserver at a well known URL and is updated with every release. Both the old and new layout have their own metadata files and locations. From the users point of view, the plan will transparently update the layout. This will be done by updating the metadata file associated with the old layout to have the same content as the new layout. Doing so will cause osg-ca-certs to automatically download the new layout on all sites.
      * Since there has been extensive testing of the new layout and it is the default CA layout for the OSG 3, we do not anticipate problems with making the switch transparently. However, as a backup, we plan to have the old layout available for a short time even after it is deprecated, by making the metadata file available at a new (not widely advertised) GOC location. If any sites or VOs encounter unexpected problems due to the transition there will be directed to this alternative url to continue getting the old layout. This will ensure that any problems encountered will have minimal impact on production while it is investigated and resolved.
   * For RPMs the new layout already have higher priority. We will work with RPM expert to correctly deprecate and supersede the old layout with new layout rpm. This should be achievable through changes in  the rpm build spec file.
   * For Debian release we will also work with expert to transparently deprecate and supersede the old layout with new layout.

---+++ Affected Parties
   * This change will affect anyone (primarily OSG resource and VO admins) using CA  packages, this is typically all S/W components that rely on our PKI infrastructure  for authentication 
   * All affected parties will be notified.
---+++ Updates
   * Tarball: Scott sent Anand limited log files from software.grid.iu.edu. Anand looked through the logs that Scott sent us and found that only a few sites (FNAL, SMU, An European site) are using the new format CA package. This is not a surprise since old format is default in pacman. 
   * Anand is still waiting for  the logs of rpm usage from Scott, and the list of VOMS server versions that are deployed by OSG VOs. 
      * On the rpm side we expect most sites to be using the new format since that is the recommended approach. 
      * Do you have an alternative site we might be able to get the VOMS version information, if Scott is not able to provide it.
      * Kevin compiled a list of Voms Admin versions for servers I was able to access via web browser at VomsAdminVersion.
   * Anand has an idea on how we could do this transition if we do not have problems with VOMS servers.
   * Anand has reviewed the RPM access logs and made the following discoveries
      *  18 unique machines are downloading the osg-ca-certs-compat RPM bundles 
      *  19 unique machines are downloading the igtf-ca-certs-compat RPM bundles 
      *  211 unique machines are downloading the osg-ca-certs RPM bundles 
      *  8 unique machines are downloading the igtf-ca-certs RPM bundles 
   * Anand sent out a notification emails to VO security contacts regarding this update on August 3, 2012
   * Anand went through the list of VOMS  server and identified the voms-admin-server versions. The following VOs have an older version that would be impacted by the deprecation of the old layouts.
      * STAR - Voms-Admin version 2.0.18 
      * LIGO - Voms-Admin version 2.0.14 
      * DOSAR - Voms-Admin version 2.0.15
      * nwicg - Voms-Admin version 2.0.15
      * gpn - VOMS server is unreachable during test -- OIM says inactive VO.
      * compbiogrid - VOMS server is unreachable during test
      * NYSGRID - Voms-Admin version 2.0.15 
      * SBGrid - Voms-Admin version 2.0.14 
      * NEBioGrid - Voms-Admin version 2.0.14 
      * Gluex - Voms-Admin version 2.0.14 
      * DayaBay - Voms-Admin version 2.0.15 
      * SURAGrid - Voms-Admin version 2.0.15 
      * GCVO - Voms-Admin version 2.0.15 
      * GCEDU - Voms-Admin version 2.0.15 
      * DREAM - Voms-Admin version 2.0.15 
   * Anand sent an email to the VOs that were running old version of voms-admin server (see list above) on Aug 24, 2012 The draft of the email sent is as follows.
<pre class="file">
Hello VO security contacts,

This is an important email, so please read carefully and take action!!

 * Why are we contacting you?
   Your VO is depending on an old VOMS-admin server and we need you to upgrade it.

 * We have not seen any problems with the VOMS-admin server, why should we upgrade it?
   The OSG security team will make some changes to our security infrastructure. If your VO is running a pre VOMS-Admin server 2.6 this change will impact you. 
    Furthermore, old versions of Voms-admin are also susceptible to known security vulnerabilities.

 * What are the specific changes being made to OSG security infrastructure?
   The changes that are planned affect the CA certificate packages being distributed by OSG. 
   CA package using the 'new layout', which works with both openssl 0.9.x and openssl 1.0.x, has been available from IGTF for a significant time now and is designed to accommodate openssl 1.0. 
   The package with the 'new layout' has also been in production in OSG for over a year, and in fact is the default recommended option in OSG 3. 
   Till now we have continued to provide the 'old layout' (which works with only openssl 0.9.x) even though it has been deprecated by IGTF for a long time. 
   However, moving forward OSG security team will stop making the CA distribution with the 'old layout'. 

 * How does this change affect OSG software?
   Most software have been tested and are unaffected by these changes. 
   Furthermore the 'new layout' has been deployed in production by a number of CEs, SEs and VOMS and is working without any issues.  
   However, we know that a bug in the old versions of VOMS-admin server causes it to fail with the 'new layout'. 
   The bug affected VOMS-Admin server 2.x, and was fixed in VOMS-Admin server 2.6. (More details on this bug can be found at: https://savannah.cern.ch/bugs/index.php?78349).

 * What actions am I expected to take?
   You are expected to upgrade your voms and voms-admin servers to use the version in OSG 3.x release. (See: https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallVoms). 
   The version of voms and voms-admin servers in OSG 3.x has been tested and used in production by a number of OSG VOs. 
   The OSG software team has expertise and is willing to help VOs make this transition. 
    If your VO has a large number of users and would like to migrate users from your old database this can also be done. 
   You are also expected to send the OSG security team (osg-security-team@OPENSCIENCEGRID.ORG) your upgrade plans. 
   If you have VO specific software, not distributed through OSG/VDT software, you might want to test them out with the 'new layout' CA package. 
   Details on how to get the 'new layout' CAs can be found at https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallCertAuth.

 * What would happen if I do not take any action?
   Once OSG security team retires the 'old layout' by transparently switching to the 'new layout' your VOMS-admin server will stop work and likely impact your VOs production runs. 

Should you have any questions, concerns or  suggestions please send them to the security team. Please acknowledge the receipt of this email.

Best
Anand
</pre>

%TABLE{ valign="top" }%
| *VO Name* | *Contact* | *Response Received* | *Upgrade Date* | *Notes* |
| GlueX |  Richard Jones | Yes (9/3/12) | Not Specified | Will get back to you within a couple of weeks |
| SBGrid, NEBioGrid | Ian Levesque, Mick Timony  | Yes (8/31/12) | Not Specified | Ian Stokes-Rees should no longer be VO security contact. Same VOMS server is used by SBGrid and NEBioGrid |                                                                                                                                                                                                                                         
| Dosar | Horst Severini, Michael S. Bryant  | Yes (8/31/12) | 9/6/12 | |
| LIGO | Brian Moe, Kent Blackburn | Yes (8/31/12) | | Plan to upgrade the week of 9/3/12 |
| NYSGRID | Steve Gallo | Yes (8/31/12) | | Plan to upgrade late in the week of 9/3/12 | 
| SURAgrid, DREAM | Alan Sill  | Yes (8/24/12) | <div style="background-color: #00FF66;"> Upgraded Done (9/25/12) </div> | Alan understands what to do to upgrade their VOMS server. Update (9/10) (from Alan):   "We did in fact put up an instance on a different computer of the rpm-based VOMS installation and tried to move our contents.  We ran into significant difficulties in following the (admittedly draft) instructions but puzzled it out to the point that we do have a  running test instance of the new VOMS with three VOs.  We ran into problems wight he imported contents, and Tanya was going to help us with a script to improve th transfer of VO information to the new server. Once this is sorted out, we should be able to shut it down, change the machine name and certificates, and start up (assume ing we are able to resolve the problems). | 
| DayaBay | Craig, Keith Beattie | Yes (9/4/12) | | Doug Olsen is no longer the contact for Dayabay VO. Doug provided contact for Craig  |
| NWICG | Kevin | Yes (9/5/12) | | Reminder sent. Plan to retire the VO. |
| GC, GCEDU | Diego Alberto Rincon Yanez | Yes (9/5/12) | Not Specified | Reminder sent. The plan to upgrade GCVO_PUJ_CE, GCVO_UC_CE, GCVO VO, GCEDU VO. Asked them to inform us as soon as they are done with upgrade. |
| CompBioGrid| Jeff Dutton | NO | | Reminder sent. |


-- Main.AnandPadmanabhan - 04 Jun 2012
