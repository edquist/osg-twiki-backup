%META:TOPICINFO{author="KyleGross" date="1258486271" format="1.1" reprev="1.11" version="1.11"}%
%META:TOPICPARENT{name="WebHome"}%
---++++ %RED%THIS TOPIC IS NO LONGER RELEVANT.%ENDCOLOR%

<table width="100%">
<tr><td valign="top">
</td>
<td valign="top">
---+!!OSG Site VO Support 
%TOC%
</td>
<td valign="top" align="right" width="25%">
%TABLE{ sort="off" dataalign="left" tableborder="0" cellpadding="1" cellspacing="3" headerbg="#F3EDE7" databg="#F3EDE7"}%
</td></tr></table>
%STARTINCLUDE%

---++Introduction

An issue of current interest within the production OSG is the question of
if a particular VO is supported by an OSG site. This topic is not new the VO support 
architecture has been brought forward from the Grid2003 enviroment with few
modifications in the current OSG version 0.4.1. The basis of VO support by a site begins
with connecting to an OSG Registered VOMS to pull down a list of Distinguished Names (DN's) 
the second step is to map these DN's to a local account. Once this is done a site is said 
to support a VO and people from that VO are able to submit jobs to the OSG site.

The current (OSG 0.4.1) components involved in supporting VO's at a site include:

   *  The edg-mkgridmap, Globus Authorization callout (PRIMA), and gums-host 
      utilities on the CE.
   *  The Grid User Managment Service (GUMS)
   *  The distribution of an at most weekly updated pacman package called, the "VO package",
      which updates files for the edg-mkgridmap and provides a template update for GUMS.
      The "VO package" has both a CE component and a client component to allow updates
      to OSG Client installations.

When an OSG site is installed the most recent version of the VO package is also
installed. New versions of the VO package are announced by email to the support centers and with the  [[http://www.grid.iu.edu/news/][Ops RSS News Feed.]] 
It is distributed as described in the [[http://osg.ivdgl.org/twiki/bin/view/Operations/SOPVoRegistration-v3][Standard Operating Procedure]] 
The way in which an OSG site decided to handle CE authorization determines the way in which 
sites publish the VO which they support, [[http://osg.ivdgl.org/twiki/bin/view/ReleaseDocumentation/OsgCEAuthorization][OSG CE Authorization]]

---++ Current (OSG 0.4.1) procedures

---+++ Sites not using GUMS

   For OSG sites that are using the edg-mkgridmap utilities to connect to each VO VOMS and retrieve
   the list of VO members, the VO members are mapped to local accounts and stored in the
   Globus file "/etc/grid-security/grid-mapfile", when a new VO package is installed the configuration 
   package for edg-mkgridmap is updated by adding a new VOMS. Also the file "grid3-user-vo-map.txt" is udpated
   to indicate to the monitoring infrastructure and to other OSG services that the VO is supported.


---+++ Sites using GUMS

   OSG sites that are using GUMS, depend on the Globus authorization callout, PRIMA, to determine both if a
   DN's is allowed and which local account the DN will be mapped to. The gums-host utility is used to create
   the "grid3-user-vo-map.txt" file and the gums-host-cron crontab entry is used to periodically update
   the files based upon the current GUMS configuration.

   The VO package contines to be installed for reference, but the update which adds the new VO is done
   with an edit of the gums.config file, using the VO package distributed, gums.template, file as a 
   guide to the update. The file "grid3-user-vo-map.txt" is generated by a query to the GUMS, this
   is configured during installation. Again this file indicates to the monitoring infrastructure and to 
   other OSG services that the VO is supported.
   
---++ Future (OSG 0.6.0) procedures

   
---+++ Sites not using GUMS

   The OSG site which is using the edg-mkgridmap utilities will be extended to provide local caching in case
   of VOMS or network outages, the "grid3-user-vo-map.txt" file will be renamed "osg-user-vo-map.txt" and this 
   file will be programmatically generated each time the grid-mapfile is created. There will be two 
   additional checks added when this utility is executed which will verify that there at least one VO 
   member mapped in the grid-mapfile and that the local account which is referenced exists on the local host.


---+++ Sites using GUMS

   The OSG site is uses GUMS, depends on the Globus authorization callout, PRIMA, to determine both if a
   DN's is allowed and which local account the DN will be mapped. The gums-host utility is used to create
   the now "osg-user-vo-map.txt" file and the gums-host-cron crontab entry is used to periodically update
   the files based upon the current GUMS configuration. The gums-host command will be extended to ensure that 
   the local account on the local host.

---++ Deciding if a OSG site supports your VO

---+++ Using Virtual Organization Resource Selector (VORS)

   VORS is a utility which collects the information provided by the grid3-user-vo-map.txt or osg-user-vo-map.txt
   file for each OSG site and then makes a graphical display of that information.

   [[http://vors-dev2.grid.iu.edu/cgi-bin/index.cgi][VORS Deveploment link]] 
   
    Using the drop down menus choose a VO, the map will refresh with the current selection of 
    OSG sites which are currently available and which publish support of the choosen VO. Below
    the map is a list if each resource. The map can be zoomed by clicking on a region of interest.

    Additionally, a summary table which displays each OSG site and the VO's which they publish
    support is provided at this [[http://vors-dev2.grid.iu.edu/vo-support-prod.html][VORS page.]]

---+++ Error Conditions on OSG Sites which publish support of your VO
  
    If you have verified that an OSG publishes support of your VO there may
    be serveral conditions which cause failures. There are serveral types of 
    errors and it is difficult to determine from the job submission returned 
    error the exact error condintion. 

---++++  Failure to authenticate ( Globus error 7, 12, 79 )

   These are the most commonly seen errors. There are several underlying 
   causes.

   * Network connection failed to OSG site
   * OSG site down for scheduled or unscheduled outage
   * OSG site GUMS currently down
   * OSG site GUMS misconfigured
   * OSG site edg-mkgridmap configureation file misconfigured
      * Due to error in the configuration
      * Due to an error in retrieving VO members from the VOMS
   * OSG site list of published VO's inaccurate
   * and probably a few more...

---++++ Failures regarding the transfer of data or local home directory ( Globus errors 10, 73, 74,136 )

   * Globus error 136: the scratch directory could not be created      
   * Globus error 10: data transfer to the server failed                 
   * Globus error 73: the job manager failed to open stdout               
   * Globus error 74: the job manager failed to open stderr  

---++++ General middleware failues ( ...?)

   * Globus error 126: it is unknown if the job was submitted             
   * Globus error 47: the gatekeeper failed to run the job manager   
   * Globus error 22: the job manager failed to create an internal script argument file               
   * Globus error 17: the job failed when the job manager attempted to run it      

---++ Conclusions
 
     
*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->

-- Main.LeighGrund - 02 Dec 2006


%STOPINCLUDE%
