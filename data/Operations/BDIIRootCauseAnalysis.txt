%META:TOPICINFO{author="RobQ" date="1247519733" format="1.1" reprev="1.3" version="1.3"}%
%META:TOPICPARENT{name="WebHome"}%
---+Root Cause Analysis of BDII Update on July 8th, 2009

%TOC%

---++ Situation

On July 8th, the GOC updated the IP address on the Bloomington BDII server to facilitate an upcoming physical move of the IU machine room. The IP switch went smoothly and service was restored on the new IP in less than 10 minutes. During the process DNS round-robining was used to steer traffic to the Indianapolis BDII service. After the end of the maintenance window CMS reported OSG BDII information not getting published to the top level BDII at CERN. This affected normal CMS workflow. 

After investigation it was noticed that the BDII at CERN was trying to contact the old BDII IP and when not finding the address dropping the OSG BDII information. This was due to the DNS change not being propagated. 

---++ Fix

The fix at the GOC required a separate ethernet card on the BDII machine to be brought up and listen on the old IP address. 

---++ Best Practices

Suggested Future Best Practices with BDII Maintenace

   1 Preform maintenance in the morning to coordinate with CERN and the 5/6 hour time difference. This also gives us time to rollback with IU DNS if necessary, though this can only happen hourly.
   2 Coordinate more closely with CMS. We did formally notify them of the change, and were in contact with them informally via IM, but we should have a post-change testing period where they can actively search for issues and confirm things are working as expected at the end of the maintenance window. 
   3 Update the DNS TTL at IU to 10 minutes. This will force connecting services to refresh the address mapping every 10 minutes. (%RED%Note: This was put in place by IU DNS admins this morning for BDII, we have asked them to do this on all of our services.%ENDCOLOR%)

---++ Notification Schedule

   1 Operations Meeting July 6th [[https://twiki.grid.iu.edu/bin/view/Operations/Minutes2009July06][Link]]
   2 Email Notification and RSS Post July 6th [[http://osggoc.blogspot.com/2009/07/july-8-maintenance-on-myosg-and.html][Link]]
   3 Email Notification and RSS Post of Completion July 8th [[http://osggoc.blogspot.com/2009/07/completed-july-8-maintenance-on-myosg.html][Link]]

---++ Other Notes

Burt mentioned on the Ops call today that we did function within the SLA for the BDII service. However he'd like to make sure the Change Management and Testing are refined to make sure a similar situation does not occur in the future.

-- Main.RobQ - 09 Jul 2009
