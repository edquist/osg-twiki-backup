%META:TOPICINFO{author="KyleGross" date="1225985950" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="JohnWeigand"}%
%LINKCSS%
---+!!<nop>Gratia Queries (from Ruth)
%TOC%
%STARTINCLUDE%

---+ Job Success Rates
See http://gratia-osg.fnal.gov:8880/gratia-reporting for more information

Summary of the job exit status (midnight to midnight central time) for 2007-05-06
including all jobs that finished in that time period.

For Condor the value used is taken from 'ExitCode' and NOT from 'Exit Status'
<pre class="screen">
---------------------------------------------------------------------------------------
     | Site                   | Success Rate |    Success |     Failed |      Total 
---------------------------------------------------------------------------------------
  1  | AGLT2                  |         99 % |        959 |          4 |        963 
  2  | ASGC_OSG               |        100 % |         22 |          0 |         22 
</pre>

__Philippe's current queries:__

These reports are currently generated by a cron job on gratia06 (still on myi
account) with use the library gratia/summary/PSACCTReport.py

The queries are:
<pre class="screen">
 SELECT CETable.facility_name, J.Status,count(*)  
 from gratia.CETable,
      gratia.CEProbes, 
      gratia.JobUsageRecord J  
where CEProbes.facility_id = CETable.facility_id 
  and J.ProbeName = CEProbes.probename 
  and "2007-05-07 07:00:00"<"2007-05-08 07:00:00" 
  and J.StatusDescription != "Condor Exit Status"
group by CETable.facility_name,
         J.Status  
order by CETable.facility_name 

and

 SELECT CETable.facility_name, R.Value,count(*)  
 from gratia.CETable, 
      gratia.CEProbes, 
      gratia.JobUsageRecord J, 
      gratia.Resource R  
 where CEProbes.facility_id = CETable.facility_id 
 and J.ProbeName = CEProbes.probename 
 and "2007-05-07 07:00:00"<"2007-05-08 07:00:00" 
 and J.dbid = R.dbid 
 and R.Description = "ExitCode"  
 group by CETable.facility_name,R.Value  
order by CETable.facility_name
</pre>

which gives the number of jobs per exit code.  The python code post process 
the data to sum the number of jobs on both queries and in 2 categories 
(0 and non zero).



---+ PANDA Users - 5/8/07

I had a discussion with Jim Shank about the ATLAS/US ATLAS usage as recorded in Gratia 
and that recorded by PANDA.

I am interested in a .csv file from which I can make a chart of total PANDA CPUhours  
per week for the last 6 months and a chart of US ATLAS OSG CPUHours/week over the last six months.

Then we will of course want the same thing by site.

Of course -- when I get a Gratia plot of total CPU usage over the past six months I don't get 
the panda information included -- we need this as a button on the gratia page. 

And on this report we are getting non OSG sites again -- that is CERN etc. 

We are going to have to have a site white list/black list and a VirtualOrganizations/VOInfo white list/black list for 
the Gratia OSG web reports...



---+Monthly CPU Usage - 5/8/07

   *  Monthly email with the CPUUsage by site of OSG VirtualOrganizations/VOInfo Users by DN.
   * Monthly email of the number of times each DN has done a voms-proxy-init (maybe Keith can give that)
   * All users must use voms-proxy-init not grid-proxy-init. Presumed it can do that on the Fermilab site? 



---+Daily error codes by VirtualOrganizations/VOInfo/Site - 05/14/07

   * An "error codes" daily report the list of non-success return codes by each VirtualOrganizations/VOInfo and Site. 


%STOPINCLUDE%

%INCLUDE{"Integration.WhuReferences"}%

-- Main.JohnWeigand - 22 May 2007