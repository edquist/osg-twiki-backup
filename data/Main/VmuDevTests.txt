%META:TOPICINFO{author="BrianLin" date="1422049830" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="BrianLin"}%
---+ Supporting Developer Tests in VMU

---++ About This Document

This is the design document for supporting the OSG [[SoftwareTeam/SoftwareDevelopmentProcess#TestingProcedures][developer tests]] in our [[SoftwareTeam/TestRunsAsVMs][VM universe test suite]] as outlined in ticket [[https://jira.opensciencegrid.org/browse/SOFTWARE-1733?filter=12359][SOFTWARE-1733]]. The requirements are as follows:

   * Add the ability to specify a package or list of packages and the repositories that they should come from for installation and upgrade tests.
   * *ONLY* install the specified packages out of the corresponding repositories. All other packages that need to be installed and/or upgraded will be pulled from the repositories that are enabled by default: osg-release, EPEL and the OS.
   * Add ability to specify a source RPM for which all of its binary RPMs will be installed and/or upgraded

The proposed solution is to allow the user to specify hashes of repositories and their corresponding packages in the =packages= lists of =test-parameters,yaml=. Additionally, they will be allowed to prefix package names with an =@= to mark them as source RPMs. This solution will only mean changes to the VMU test infrastructure in =vmu-reporter= to handle the new =test-parameters.yaml= formatting and =generate.dag= to create the osg-test configuration and new yum repo files .

---++ User Interface

Currently, the user can specify repositories and packages in the following way:

<pre class="file">
sources:
  - 3.1; osg			# Perform installation with osg-release enabled
  - 3.1; osg-testing            # Perform installation with osg-testing enabled in addition to osg-release
  - 3.1; osg > osg-testing	# Perform installation with osg-release enabled then upgrade with osg-testing and osg-release enabled

packages:
  - [osg-tested-internal]
  - [condor.x86_64, osg-ce-condor, rsv]
</pre>

The VMU infrastructure then runs osg-test against all the different combinations of sources, packages and platforms (not shown here). So for the HTCondor upgrade case, =osg-test= will perform the following yum commands to prepare the tests:

<pre class="rootscreen">
%UCL_PROMPT_ROOT% yum install -y condor.x86_64
%UCL_PROMPT_ROOT% yum install -y osg-ce-condor
%UCL_PROMPT_ROOT% yum install -y rsv
%UCL_PROMPT_ROOT% yum update -y --enablerepo=osg-testing
</pre>



-- Main.BrianLin - 23 Jan 2015