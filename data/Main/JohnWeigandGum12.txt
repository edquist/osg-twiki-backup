%META:TOPICINFO{author="KyleGross" date="1229445235" format="1.1" version="1.5"}%
%META:TOPICPARENT{name="JohnWeigand"}%
---+!!<nop>GUMS 1.2 userGroup attributes affecting VO membership and authorization policy

%TOC%

%STARTINCLUDE%
---+ gums.config userGroup element attributes

The following fields in the <nop>VomsUserGroup element in _gums.config_ that require a little clarification:
<verbatim>
    acceptProxyWithoutFQAN = yes | no
    matchFQAN = ignore | vo | group | exact
    voGroup
    voRole
</verbatim>

---++ Attributes affecting membership lists (voGroup / voRole)
The _voGroup_ and _voRole_ attributes affect the set of members retrieved from VOMS:
%TABLE{ tableborder="1" cellpadding="0" cellspacing="1" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF"}%
%EDITTABLE{ header="|  |  |  | " format="| textarea, 1x10 | textarea, 1x10 | textarea |  " changerows="on" quietsave="on" editbutton="Edit table" }%
|*voGroup*|*voRole*|*Membership retrieved*|
| not specified | not specified | all members of the VO |
| /cms/uscms | not specified | all members of the specified group in the VO |
| /cms/uscms | cmsprod | all members of the specified group with the specified role in the VO |
| not specified | cmsprod | *INVALID specification* - no members retrieved |

<b>Note: </b> _acceptProxyWithoutFQAN_ and _matchFQAN_ attributes have no affect on member retrieval.

---+++ Comments
%COMMENT{ type="threadmode" }%

---++ Attributes defining authorization policy (acceptProxyWithoutFQAN / matchFQAN)
The _acceptProxyWithoutFQAN_ and _matchFQAN_ attributes affect the authorization policy for that set of members (_userGroup_):
%TABLE{ tableborder="1" cellpadding="0" cellspacing="1" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF"}%
%EDITTABLE{ header="|  |  |" format="| textarea, 1x10 | textarea, 1x10|  " changerows="on" quietsave="on" editbutton="Edit table" }%
|  *acceptProxyWithoutFQAN*  |*Policy description*|
|   yes   | Allows authorization with a grid proxy (one without an FQAN).<br />Therefore, the requestor (based on DN) only has to be a member of a particular _userGroup_ |
|   no   | Only authorizes requests using a voms proxy (one with an FQAN)<br />Therefore, the _matchFQAN_ attribute defines the authorization policy |


%TABLE{ tableborder="1" cellpadding="0" cellspacing="1" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF"}%
%EDITTABLE{ header="|  |  | " format="| textarea, 1x25 | textarea, 1x40 |  " changerows="on" quietsave="on" editbutton="Edit table" }%
|*matchFQAN*|*Policy description*|
|  exact  | Authorizes if the user's DN *and* FQAN is found in the database |
|  group  | Authorizes if the user's DN *and* FQAN (only the voGroup portion) portion is found in the database. |
|  vo  | Authorizes if the user's DN *and* FQAN (only the top level of the voGroup portion - (before 1st and 2nd slash) is found in the database. |
|  ignore  | Authorizes if the user's DN is found in database.  The user's FQAN is ignored. |

---+++ Comments

%COMMENT{ type="threadmode" }%

---++ Some Subtleties
There may be some subtle problems with this logic.

For example, it may be problematic if a _VomsUserGroup_ element is created that specifies:
%TABLE{ tableborder="1" cellpadding="0" cellspacing="1" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF"}%
%EDITTABLE{ header="|  |  | " format="| textarea, 1x25 | textarea, 1x40 |  " changerows="on" quietsave="on" editbutton="Edit table" }%
|  *Attribute*  |  *Value*  |
|  matchFQAN  |  ignore   |
|  voGroup  |  /atlas/usatlas  |
|  voRole  |  production  |


An authorization request from a PEP (e.g, CE node) for a voms proxy with the following settings:
%TABLE{ tableborder="1" cellpadding="0" cellspacing="1" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF"}%
%EDITTABLE{ header="|  |  | " format="| textarea, 1x25 | textarea, 1x40 |  " changerows="on" quietsave="on" editbutton="Edit table" }%
|  *DN*  |  *FQAN*  |
|  /DC=org/DC=doegrids/OU=People/CN=John Smith 12345  |  Group=/atlas/usaltas/Role=software  |


This users DN will never get retrieved from VOMS and will thus never be matched for membership even though you might expect him to be since _matchFQAN_ was set to ignore.  
   * Should this be disallowed?%BR%That is, should it not be allowed to use _matchFQAN=ignore_ with setting voGroup and voRole?  
   * Or this a valid case to allow for?

---+++ Comments

%COMMENT{ type="threadmode" }%

%STOPINCLUDE%

%INCLUDE{ "Documentation.ToolsBottomMatter" }%
-- Main.JohnWeigand - 16 Apr 2007