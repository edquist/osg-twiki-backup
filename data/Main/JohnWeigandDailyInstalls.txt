%META:TOPICINFO{author="JohnWeigand" date="1259787306" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="JohnWeigandSandbox"}%
---+ Daily Installs

<!--

   * Set VIEWTHISTOPIC = <div class="twikiSmall"><a href="%TOPIC%">View this section</a></div> 
 -->

%TOC%

%STARTINCLUDE%

---++ Background
The intent of these processes is to perform a full automated installation of an OSG CE,VOMS and GUMS cache on a regular, generally daily, basis in order to verify the integrity of the installation process and to catch any problems ina timely manner.  It is a combination of shell and expect scripts using a set of environmental variables set in the osg-install.env script for the various responses required during the installation process.  The expect scripts provide the capability of interacting with the various question/answer prompts that occur during the installation process using these variables for the replies.

The scripts are based on the OSG CE Installation instructions found at:  http://osg.ivdgl.org/twiki/bin/view/Documentation/OsgCEInstallGuide as of 8/18/05.

All these process/programs must be run as root.  There is a verification step in most that will error the process if root is required.

The osg-install.env file sets a number of environmental variables used during the installation process.  The OIV_LOGDIR variable defines a directory where a log of the osg-install.sh execution is kept along with copies of the site_verify output and a file containing the versions of the installed software.

The script currently supports:
   * OSG 0.2.1 - scripts are in ./bin and ./CE
   * 0SG 0.4.0 - scripts are in ./ITB-030/bin and ./ITB030/CE

Note: Some scripts are common to both.  The PATH variable is set such that if a script has changed in the OSG 0.4.0, the PATH variable will force it to be picked up first.  You have to do nothing to effect this.  This is noted so when you are trouble shooting problems you will know where to look first.



---++ Caveat
You DO have to know what you're doing and understand the OSG CE envirnonment to a fair degree in order to set the environmental variables correctly.



---++ Disclaimers
Since this script is intended for validation of the OSG installation, it is NOT intended as a fully automated OSG CE installation.  There are several shortcuts taken to facillitate daily cleanup and setup:

   1 The user work directories $APP, $DATA, $TMP and $TMP_WN are created as  normal directories (not seperate file systems with any minimum space requirements defined) in the OSG installation directory (VDT_LOCATION)  under a directory called OSG.DIRS.

   1 Condor is the selected job manager and is setup with only the CE node functional.

   1 Ganglia (or any equilvalent) is not installed.  So the MonALISA line in the vdtFarm.conf file is not activated for ganglia.

   1 Site registration must be performed manually based on the instructions in the OSG CE installation guide.  The site is automatically set to active in the last step of the installation if successfull, but this is for naught if you have not registered the site so GridCat polls it. (If you don't care about GridCat, you do not need to register.)

   1 All certificates must be obtained before starting the installation. They should be stored in a separate directory from this source and the normal /etc/grid-security location. They should be protected from accidental deletion by using 'chattr' command to make them immutable. mkdir YOUR_PATH/certificates
   * chattr -R +i YOUR_PATH/certificates

    The install-certificates.sh script will copy them into the appropriate
    areas during the installation process.

Once installed, this process relies on the site_verify.pl process to validate the installation.  The site_verify process does not really test
everything at this time, but just looks for the existence of some data. The expect script (site-verify.exp) does not do a 100% validation of that output at this time.

This process, at this time anyway, is more focussed on the automation of the download and it's conformance to the posted instructions.


---++ CVS Repository
To get the package from CVS and installed in your HOME directory:
   * export CVSROOT=cvsuser@cdcvs.fnal.gov:/cvs/cd
   * cd $HOME
   * cvs co osg-installation-validation

---++ Tarball
wget http://home.fnal.gov/~weigand/downloads/osg-installation-validation.tgz


--- ++ Cron process
There is cron file that should  be installed to allow you to run this on a regular basis.  The cron file (if you decide to use it) is the only file that should have to be modified as it must have the full path to the cron-script.sh program.

This file (./osg-installation-validatation/crontab/root) will be reinstalled at the end of the installation process.  So, if you have an existing root cron defined, you should append those entries to this file.  This will insure a clean, consistent environment.

WARNING: If executing from the command line, do not 'su' to become root.  Use ssh/rlogin/telnet to become root.  The 'su' does not give you  a completely clean root environment necessarily.

If you are executing from the command line, use the cron entry as the example of how to do it.


---++ How do I run this since the documentation is not complete
Using cron is the intended method for executing the installation as it insures a clean environment.

You will need to make changes to some of the variables defined in the osg-install.env file for your site.  The critical ones are:

  1. Make sure the files defined by this variable are clean of any  vdt/osg produced data as the installation process will copy them
     into the OIV_BACKUP_LOCATION directory (it will create it I hope) OIV_BACKUP_FILES

  2. Verify that none of the services defined by these variables already exist or have any vdt/osg related changes to them.
       OIV_XINETD_SERVICES
       OIV_INITD_PROCESSES

  3. Make sure you have your host and ldap certificate in the directory defined by this variable:
       OIV_CERTIFICATE_LOCATION

  4. This variables should be changed for your particular installation:
       OIV_MAIL_RECIPIENTS
       OIV_ROOT
       SITE_NAME
       VO_SPONSOR
       POLICY_URL
       ML_MONITOR_GROUP
       ML_CONTACT_NAME
       ML_SERVER_LOCATION
       ML_SERVER_COUNTRY
       ML_SERVER_LATITUDE
       ML_SERVER_LONGITUDE
       OIV_GUMS_SERVICE

   5. Verify these the accounts defined by this variable do not exist (you can change them if you like):
       OIV_TEST_USER
       OIV_MISCI_USER

   6. Append any root cron entries to the ./crontab/root cron.  Uncomment the release you wish to install and set the time.
      Effect the cron.
      Pray :-)







-- Main.JohnWeigand - 02 Dec 2009
