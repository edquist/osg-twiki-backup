%META:TOPICINFO{author="JohnWeigand" date="1165513477" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="JohnWeigand"}%
---+!!<nop>Publishing Supported VOs for a Compute Element (CE)
%TOC%
%STARTINCLUDE%

---++Introduction
In the OSG environment, it is necessary to identify the set of VOs that a Compute Element (CE) supports, resource availability data about those nodes  and to collect accounting data for those nodes.

The VO identity is used in the following OSG systems:
   *  [[Integration.MonALISA050][MonALISA]] to capture Compute Element/Worker Node resource usage for each VO. 
   *  GIP ([[Integration.GenericInformationProvider][Generic Information Provider]]) to publish supported VO resource and availability data.
   * VORS
   * VOMS Monitor
   * Gratia
   * GridCat

In addition, the VO name is also used in the following:
   * DOE certification site

Unfortunately there is little consistency as the the value used to identify the VO.  The purpose of this document is to identity the known problems and provide a resolution.


---++Historical Background.
At this time a little background and explanation of the file is needed to better understand the problem.
d34 1
The <i>grid3-user-vo-map.txt</i> file was originally used only by <nop>MonALISA in the collection of user job metrics.  Since the user data was captured by UNIX account, this file was established to perform the conversion.  
<pre>
#voi  <b>List of identifiers that the UNIX account is initially translated to on the uncommented line</b>
#VOc  <b>List of the VOs that the #voi entries are translated to.  There is a 1 for 1 mapping to #voi.</b>
UNIX_account   #voi_entry <b>Maps the UNIX account to #voi indentifier</b>
</pre>
The translation from UNIX account to reportable VO is actually a double translation:
   * first the UNIX account is translated to the #voi entry on based on the uncommented line entry
   * first the UNIX account is translated tot he #voi entry on based on the uncommented line entry
   * then the #voi identifier is converted to the reportable VO name using the #voi and #VOc entries (these must be paired lists).
In the example below, UNIX accounts uscms001, uscms002 and uscmsadmin will all have their metrics reported as the USCMS VO.  The metrics collected for ivdgl001 and ivdgl002 users will have their metrics reported as iVDGL.
<pre>
#voi  uscms cms ivdgl            
#VOc USCMS USCMS iVDGL    
uscms001 uscms
uscms002 uscms
   :
uscmsadmin cms
  :
ivdgl001 ivdgl
ivdgl002 ivdgl
</pre>

---++The Problem(s)
There are 2 main problems with the use of the <i>grid3-user-vo-map.txt</i> file:
   * Integrity of the data
   * (Mis-)use of the data

---+++Integrity of the data
For those sites using the <i>edg-mkgridmap</i> cron script to update their <i>grid-mapfile</i>, the <i>grid3-user-vo-map.txt</i> file had to be manually maintained.  In many cases, this was not being done.  Keeping this file accurate on a manual basis is pretty much an impossible task as there are no tools to detect changes in the many VO's memberships.

For those sites using GUMS, the <i>grid3-user-vo-map.txt</i> is mechanically updated using the <i>gums-host-cron</i> cron script.  No direct manual maintanence is required.

In both cases, it is possible to have a <i>grid-mapfile</i> entry or an account mapping from GUMS for a UNIX account that does not exist and the user, while authorized, will not be capable of running a job.  If this condition exists for all members of a particular VO, then that VO is obviously not being supported by that site.

---+++(Mis-)use of the data
With the execption of <nop>MonALISA, all the middleware that uses the <i>grid3-user-vo-map.txt</i> appears to be using:
   * either the #voi entry associated with the uncommented UNIX-to-#voi line.
   * or mapping correctly to the #VOc entry, but converting it to lower case before using it.

       


---++osg-user-vo-map.txt (grid3-user-vo-map.txt)
The main component, irrespective of the authorization mode used, is the <i>$VDT_LOCATION/monitoring/grid3-user-vo-map.txt</i>.  This file provides a mapping of the local unix user accounts, used for OSG authorizations, to the OSG VOs. 
This file is currently used by:
   *  [[Integration.MonALISA050][MonALISA]] to capture Compute Element/Worker Node resource usage for each VO. 
   *  GIP ([[Integration.GenericInformationProvider][Generic Information Provider]]) to publish supported VO resource and availability data.
   * VORS
   * VOMS Monitor
   * Gratia
   * DOE certifcation site
   * GridCat


A static file is distributed with the VO package which also distributes the gums.template file and the edg-mkgridmap.conf file.

If a site is using the GUMS service then a cron entry is added which dynmically creates the grid3-user-vo-map.txt file. More inforamtion at the URL below.



Problems to resolve





%STOPINCLUDE%

<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->
*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.JohnWeigand - 13 Nov 2006<br>



%INCLUDE{"Integration.WhuReferences"}%

%META:TOPICMOVED{by="JohnWeigand" date="1163436532" from="Main.OSGUserVoMap" to="Main.SupportedVODataForCENode"}%
