%META:TOPICINFO{author="RobertEngel" date="1281723750" format="1.1" reprev="1.5" version="1.5"}%
%META:TOPICPARENT{name="TWikiUsers"}%
%TOC%

---++ My Links

   * %TWIKIWEB%.ATasteOfTWiki - view a short introductory presentation on TWiki for beginners
   * %TWIKIWEB%.WelcomeGuest - starting points on TWiki
   * %TWIKIWEB%.TWikiUsersGuide - complete TWiki documentation, Quick Start to Reference
   * Sandbox.%HOMETOPIC% - try out TWiki on your own
   * Sandbox.%TOPIC%Sandbox - just for me

---++ My Personal Data

Note: if personal data is being stored using a secret database, then it is only visible to the user and to administrators.

| E-mail | %USERINFO{"%TOPIC%" format="$emails"}% |

---++ My Personal Preferences

Uncomment preferences variables to activate them (remove the #-sign). Help and details on preferences variables are available in %TWIKIWEB%.%WIKIPREFSTOPIC%.

   * Show tool-tip topic info on mouse-over of %TWIKIWEB%.WikiWord links, on or off:
      * #Set LINKTOOLTIPINFO = off
   * Horizontal size of text edit box:
      * #Set EDITBOXWIDTH = 70
   * Vertical size of text edit box:
      * #Set EDITBOXHEIGHT = 22
   * Style of text edit box. =width: 99%= for full window width (default), =width: auto= to disable.
      * #Set EDITBOXSTYLE = width: 99%
   * Write protect your home page: (set it to your %TWIKIWEB%.WikiName)
      * #Set ALLOWTOPICCHANGE = Main.BrittaDaudert

---++ Related Topics

   * %TWIKIWEB%.ChangePassword for changing your password
   * %TWIKIWEB%.ChangeEmailAddress for changing your email address
   * %MAINWEB%.%WIKIUSERSTOPIC% has a list of other TWiki users
   * %TWIKIWEB%.UserDocumentationCategory is a list of TWiki user documentation
   * %TWIKIWEB%.UserToolsCategory lists all TWiki user tools

---++ Binary Inspiral Workflow

<!-- some useful variable definitions
   * Local LINK_LIGO = [[http://www.ligo.caltech.edu/][LIGO]]
   * Local LINK_LIGO_DG = [[https://www.lsc-group.phys.uwm.edu/lscdatagrid/][LIGO Data Grid]]
   * Local LINK_RLS = [[http://www.globus.org/toolkit/data/rls/][RLS]]
   * Local LINK_PEGASUS = [[http://pegasus.isi.edu/][Pegasus]]
   * Local LINK_MD5SUM = [[http://en.wikipedia.org/wiki/Md5sum][md5sum]]
   * Local LDF_GPS_START = 940000000
   * Local LDF_GPS_END = 940100000
   * Local LDF_GPS_OUT = var/gsiftp.loc
   * Local SCRIPT_MD5_OUT = var/gsiftp.md5
   * Local SUBMISSION_HOST = osg-job
   * Local SUBMISSION_HOST_FQDN = osg-job
   * Local SUBMISSION_USER = ligo
   * Local SUBMISSION_HOME = /home/%SUBMISSION_USER%
   * Local LDG_HOST = ldas-grid
   * Local LDG_HOST_FQDN = ldas-grid.ligo.caltech.edu
   * Local LDG_USER = user
   * Local LDG_HOME = /home/%LDG_USER%
-->

---+++ About this Document

This document is written for %LINK_LIGO% users of the %LINK_OSG%. It contains instructions to transfer _gravitational wave files_ from the %LINK_LIGO_DG% to the Open Science Grid. 

---+++ Introduction

Data collected by the Gravitational Wave Observatories is partitioned into files of 16 MByte each. The files are hosted on the %LINK_LIGO_DG% and need to be transferred to the Open Science Grid for analysis. A %LINK_GLOSSARY_SE% provided by the Open Science Grid will be the destination for the transferred files.

The integrity of the transferred data files is assured by comparing the %LINK_MD5SUM% of each file after the transfer completed with _its_ md5sum on the LIGO Data Grid. The new  address of the file is stored into the %LINK_RLS% catalog at Caltech after each successful transfer. The purpose of the RLS catalog is to serve the storage location of gravitational wave files on the Open Science Grid to the %LINK_PEGASUS% work flow once they are required.

---+++ Requirements

Before you proceed make sure to meet following requirements:

   * possession of a [[ReleaseDocumentation/GetGridCertificates][Grid Certificate]] and a valid %LINK_GLOSSARY_VOMS_PROXY% on a _submission host_ of your choice
   * ability to login via _gsissh_ to the %LINK_LIGO_DG%, such as =ldas-grid.ligo.caltech.edu= from the _submission host_
   * =svn= to checkout the required software
   * =python= to run the executables

To check if you are authorized to login to the LIGO Data Grid, execute on your submission host:

<pre class="screen">
[%SUBMISSION_USER%@%SUBMISSION_HOST% ~]$ gsissh -p 22 %LDG_HOST_FQDN%
Last login: Wed Aug 11 09:13:03 2010 from osg-job.ligo.caltech.edu
Welcome to LIGO Caltech
[%LDG_USER%@%LDG_HOST% ~]$
</pre>

---+++ Software Installation

The required software is provided by a subversion repository at Caltech. Please follow the steps below to checkout the software on your submission host and the %LINK_LIGO_DG%.

<pre class="screen"">
[%LDG_USER%@%LDG_HOST% ~]$ svn co --username=anonymous --password="" svn://osg-vtb.ligo.caltech.edu/home/subversion/repos/BinaryInspiral/trunk BinaryInspiral
Checked out revision 3550.
</pre>

%TWISTY{%TWISTY_OPTS_OUTPUT%}%
<pre class="screen"">
[%LDG_USER%@%LDG_HOST% ~]$ svn co --username=anonymous --password="" svn://osg-vtb.ligo.caltech.edu/home/subversion/repos/BinaryInspiral/trunk BinaryInspiral
A    BinaryInspiral/python-scripts
A    BinaryInspiral/python-scripts/file-transfer-dax-generator.py
A    BinaryInspiral/python-scripts/populate-RLS.py
A    BinaryInspiral/bin
A    BinaryInspiral/bin/GUC-transfer.sh
A    BinaryInspiral/bin/MD5SUM-check.sh
A    BinaryInspiral/etc
A    BinaryInspiral/etc/pegasus.properties
A    BinaryInspiral/etc/site-local.xml
A    BinaryInspiral/etc/site_dir_list
A    BinaryInspiral/shell-scripts
Checked out revision 3553.
</pre>
%ENDTWISTY%


---+++ File Transfer Instructions

This section requires that you completed the [[Main/BrittaDaudert#Software_Installation][software installation]] on the %LINK_LIGO_DG% and your submission host. The transfer process consists of three consecutive parts:

   1 Generation of the input file for the %LINK_PEGASUS% work flow.
   1 Transfer of the gravitational wave files from the %LINK_LIGO_DG% to the %LINK_OSG%.
   1 Population of the %LINK_RLS% catalog with the new storage location for the files on the Open Science Grid.

---++++ Instructions for the LIGO Data Grid

Every instruction listed in this section has to be carried out on the %LINK_LIGO_DG%.

---+++++ Generate the Input File

The %LINK_PEGASUS% work flow requires several input files:

   * a list of the storage locations for required gravitational wave files on a %LINK_GLOSSARY_GRIDFTP% server
   * a list of %LINK_MD5SUM%s for each gravitational wave file

First, we will use the =ligo-data-find= command on the %LINK_LIGO_DG% to create a list of storage locations for gravitational wave files. The =ligo-data-find= command requires the name of the _observatory_ where the data was taken and a _range of [[http://en.wikipedia.org/wiki/International_Atomic_Time][GPS times]]_. For example:

<pre class="screen">
[%LDG_USER%@%LDG_HOST% BinaryInspiral]$ ligo_data_find --server 10.14.20.73:80 --observatory %RED%H%ENDCOLOR% --type %RED%H1_LDAS_C02_L2%ENDCOLOR% --gps-start-time 940000000 --gps-end-time 940000200 --url-type gsiftp --match archive
gsiftp://ldas-cit.ligo.caltech.edu:15000/archive/frames/S6/LDAShoftC02/LHO/H-H1_LDAS_C02_L2-9400/H-H1_LDAS_C02_L2-940000000-128.gwf
gsiftp://ldas-cit.ligo.caltech.edu:15000/archive/frames/S6/LDAShoftC02/LHO/H-H1_LDAS_C02_L2-9400/H-H1_LDAS_C02_L2-940000128-128.gwf
</pre>

The =--show-observatories= command line option will print a list of available observatories. A _realistic_ analysis will require a larger GPS time range. We will first create a file for the *H* observatory:

<pre class="screen">
[%LDG_USER%@%LDG_HOST% BinaryInspiral]$ ligo_data_find --server 10.14.20.73:80 --observatory %RED%H%ENDCOLOR% --type %RED%H1_LDAS_C02_L2%ENDCOLOR% --gps-start-time %LDF_GPS_START% --gps-end-time %LDF_GPS_END% --url-type gsiftp --match archive > %LDF_GPS_OUT%
</pre>

In the next step we will _append_ the results for the *L* and *V* observatories:

<pre class="screen">
[%LDG_USER%@%LDG_HOST% BinaryInspiral]$ ligo_data_find --server 10.14.20.73:80 --observatory %RED%L%ENDCOLOR% --type %RED%L1_LDAS_C02_L2%ENDCOLOR% --gps-start-time %LDF_GPS_START% --gps-end-time %LDF_GPS_END% --url-type gsiftp --match archive >> %LDF_GPS_OUT%

[%LDG_USER%@%LDG_HOST% BinaryInspiral]$ ligo_data_find --server 10.14.20.73:80 --observatory %RED%V%ENDCOLOR% --type %RED%HrecOnline%ENDCOLOR% --gps-start-time %LDF_GPS_START% --gps-end-time %LDF_GPS_END% --url-type gsiftp --match archive >> %LDF_GPS_OUT%
</pre>

%WARNING% The execution of the command may consume a considerable amount of time, because some of the files lay be located on a tape which will be provided by the tape robot before they can be read! 

The resulting file =%LDF_GPS_OUT%= should be roughly 20MByte in size depending on the GPS range specified:

<pre class="screen">
[%LDG_USER%@%LDG_HOST% BinaryInspiral]$ ls -alh %LDF_GPS_OUT%
-rw-rw-r-- 1 %LDG_USER% %LDG_USER% 20M Aug 11 10:55 %LDF_GPS_OUT%
</pre>

---+++++ Compute MD5 Sums

In order to assure data integrity during the file transfers, we will compute the %LINK_MD5SUM% for each file listed in =%LDF_GPS_OUT%=.

%RED%Instructions how to do that will appear here soon!%ENDCOLOR%

The result will be stored =%SCRIPT_MD5_OUT%=.

---+++++ Transfer Input Files

Transfer the file =%SCRIPT_MD5_OUT%=  containing the %LINK_GLOSSARY_GRIDFTP% locations and corresponding %LINK_MD5% sums to your _submission host_ using %HELP_GLOBUS_URL_COPY%:

<pre class="screen">
[%SUBMISSION_USER%@%SUBMISSION_HOST% BinaryInspiral]$ globus-url-copy gsiftp://%LDG_HOST_FQDN%%LDG_HOME%/BinaryInspiral/var/gsiftp.md5 file://%SUBMISSION_HOME%/BinaryInspiral/var/gsiftp.md5
</pre>
</pre>

---++++ Instructions for the Submission Host

Every instruction listed in this section has to be carried out on your submission host.

---+++++ Generate the DAX

The %LINK_PEGASUS% work flow to be executed on the %LINK_OSG% is represented by a <b>D</b>irected <b>A</b>cyclic <b>G</b>raph or short *DAX*. In this section we will create a DAX requesting Pegasus to transfer the gravitational wave files from the %LINK_LIGO_DG% to the %LINK_OSG%. Hereby we will use the =file-transfer-dax-generator.py= Python script:

 

%META:FORM{name="%25MAINWEB%25.UserForm"}%
%META:FIELD{name="FirstName" attributes="" title="<nop>FirstName" value="Britta"}%
%META:FIELD{name="LastName" attributes="" title="<nop>LastName" value="Daudert"}%
%META:FIELD{name="OrganisationName" attributes="" title="<nop>OrganisationName" value="LIGO-CalTech"}%
%META:FIELD{name="OrganisationURL" attributes="" title="<nop>OrganisationURL" value="http://www.ligo.caltech.edu/"}%
%META:FIELD{name="Profession" attributes="" title="Profession" value=""}%
%META:FIELD{name="Country" attributes="" title="Country" value=""}%
%META:FIELD{name="State" attributes="" title="State" value=""}%
%META:FIELD{name="Address" attributes="" title="Address" value=""}%
%META:FIELD{name="Location" attributes="" title="Location" value=""}%
%META:FIELD{name="Telephone" attributes="" title="Telephone" value="626-395-8514"}%
%META:FIELD{name="VoIP" attributes="" title="<nop>VoIP" value=""}%
%META:FIELD{name="InstantMessagingIM" attributes="" title="<nop>InstantMessaging (IM)" value=""}%
%META:FIELD{name="Email" attributes="" title="Email" value="bdaudert@ligo.caltech.edu"}%
%META:FIELD{name="HomePage" attributes="" title="<nop>HomePage" value=""}%
%META:FIELD{name="Comment" attributes="" title="Comment" value=""}%
%META:PREFERENCE{name="VIEW_TEMPLATE" title="VIEW_TEMPLATE" type="Local" value="UserView"}%
