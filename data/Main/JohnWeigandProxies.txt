%META:TOPICINFO{author="JohnWeigand" date="1349813518" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="JohnWeigand"}%
<nop>Proxies and glexec

%STARTINCLUDE%

---+ General Description
Condor version 7.8.4

These tests had the same results for both settings below in the condor config for the gatekeeper CE:
   * DELEGATE_JOB_GSI_CREDENTIALS = False
   * DELEGATE_JOB_GSI_CREDENTIALS = True

The columns for the __grid/voms-proxy-info__ are shown for the client proxy and the CE proxy ( __X509_USER_PROXY__ ) used to test glexec.

The job run was a __globus-job-run__ of a script that executed the following commands:
<blockquote>
export GLEXEC_CLIENT_CERT=$X509_USER_PROXY%BR%
$OSG_GLEXEC_LOCATION /usr/bin/id;
</blockquote>
Both variables are contained in the user environment of the job.

These are the errors that were detected:
   1. __glexec error__
<blockquote>
 __In /var/log/messages__: <br />
lcmaps: Error: grid_verifyPathLenConstraints: Proxy Path Length Constraint exceeded on depth 0 of 5 for certificate <br/>
"/DC=org/DC=doegrids/OU=People/CN=John Weigand 458491/CN=872623406/CN=671910884". <br/>
No Proxy certifcates were expected at this stage. <br />
lcmaps: Error: Verifying certificate chain: certificate rejected 
</blockquote>

   2. __gatekeeper error__
<blockquote>
glexec never invoked.  gatekeeper failure. <br />
1. __Authorized user against GUMS__ <br />
2. __Then, no error, just this in /var/log/messages__ <br />
"Attempt to use limited proxy for service" <br />
3. __Client gets an error code 7__: <br />
GRAM Job submission failed because authentication with the remote server failed (error code 7) 
</blockquote>

   3. __globus-job-run _error__
<blockquote>
globus-job-run output:<br/>
GRAM Job submission failed because an authentication operation failed <br />
globus_gsi_gssapi: Unable to verify remote side's credentials <br />
globus_gsi_gssapi: Unable to verify remote side's credentials: Couldn't verify the remote certificate <br />
OpenSSL Error: s3_pkt.c:1086: in library: SSL routines, function SSL3_READ_BYTES: sslv3 alert bad certificate SSL alert number 42 <br /> 
(error code 7) <br />
<br/>
In  __/var/log/messages:__ <br />
Oct  9 11:44:05 fermicloud003 GRAM-gatekeeper[22741]: Got connection ::ffff:131.225.154.60 at Tue Oct  9 11:44:05 2012 <br />
Oct  9 11:44:05 fermicloud003 GRAM-gatekeeper[22741]: GSS failed Major:000a0000 Minor:0000000c Token:00000000 
</blockquote>

---+ RPM Client / RPM CE

%TABLE{ tableborder="1" cellpadding="0" cellspacing="1" headerrows="2" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF"}%
%EDITTABLE{ header="|  | | | | |  |  |"  format="| textarea, 1x15 | textarea, 1x6 | textarea, 1x6 | textarea, 1x20 | textarea, 1x20 | textarea, 1x20 | textarea, 1x20 | textarea, 1x60 |" changerows="on" quietsave="on" editbutton="Edit table" }%
| *  * | *  *  |  *  * |  *client*  |  *client*  |  *CE*  |  *CE*  |  *  *  |
| *Command* | *arguments* | *glexec status* | *grid-proxy-info* | *voms-proxy-info* | *grid-proxy-info* | *voms-proxy-info* | *Notes* |
| grid-proxy-init | | OK | RFC 3820 compliant impersonation proxy | RFC compliant proxy | RFC 3820 compliant limited proxy | RFC compliant proxy | |
| ^ | -old | OK | full legacy globus proxy | proxy | limited legacy globus proxy | limited proxy | |
| ^ | -draft | FAILED | Proxy draft (pre-RFC) compliant impersonation proxy | GT3-style proxy | Proxy draft (pre-RFC) compliant limited proxy | GT3-style proxy | See __glexec error__ |
| ^ | -rfc | OK | RFC 3820 compliant impersonation proxy | RFC compliant proxy | RFC 3820 compliant limited proxy | RFC compliant proxy | |
| ^ | -independent | OK | RFC 3820 compliant independent proxy | RFC compliant proxy | RFC 3820 compliant limited proxy | RFC compliant proxy | |
| ^ | -limited | Gatekeeper failure | RFC 3820 compliant limited proxy | RFC compliant proxy | | | See __gatekeeper error__ |
| | | | | | | | |
| voms-proxy-init | | OK | full legacy globus proxy | proxy | limited legacy globus proxy | limited proxy | |
| ^ | -old <br />-proxyver 2 | OK | full legacy globus proxy | proxy | limited legacy globus proxy | limited proxy | |
| ^ | -rfc <br />-proxyver 4 | OK | RFC 3820 compliant impersonation proxy | RFC compliant proxy | RFC 3820 compliant limited proxy | RFC compliant proxy | |
| ^ | -proxyver 3 | client error | end entity credential | GT3-style proxy | | |  See __globus-job-run error__  |


---+ Pacman Client / RPM CE


%TABLE{ tableborder="1" cellpadding="0" cellspacing="1" headerrows="2" headerbg="#99CCCC" databg="#FFFFCC, #FFFFFF"}%
%EDITTABLE{ header="|  | | | | |  |  |"  format="| textarea, 1x15 | textarea, 1x6 | textarea, 1x6 | textarea, 1x20 | textarea, 1x20 | textarea, 1x20 | textarea, 1x20 | textarea, 1x60 |" changerows="on" quietsave="on" editbutton="Edit table" }%
| *  * | *  *  |  *  * |  *client*  |  *client*  |  *CE*  |  *CE*  |  *  *  |
| *Command* | *arguments* | *glexec status* | *grid-proxy-info* | *voms-proxy-info* | *grid-proxy-info* | *voms-proxy-info* | *Notes* |
| grid-proxy-init | | FAILED | Proxy draft (pre-RFC) compliant impersonation proxy | GT3-style proxy | Proxy draft (pre-RFC) compliant limited proxy | GT3-style proxy | See __glexec error__ |
| ^ | -old | OK | full legacy globus proxy | proxy | limited legacy globus proxy | limited proxy | |
| ^ | -draft | OK | full legacy globus proxy | proxy | limited legacy globus proxy | limited proxy | |
| ^ | -rfc | OK | RFC 3820 compliant impersonation proxy | RFC compliant proxy | RFC 3820 compliant limited proxy | RFC compliant proxy | |
| ^ | -independent | FAILED | Proxy draft (pre-RFC) compliant independent proxy | GT3-style proxy | Proxy draft (pre-RFC) compliant limited proxy | GT3-style proxy | See __glexec error__ |
| ^ | -limited | Gatekeeper failure | Proxy draft (pre-RFC) compliant limited proxy | GT3-style proxy | | | See __gatekeeper error__ |
| | | | | | | | |
| voms-proxy-init | | OK | full legacy globus proxy | proxy | limited legacy globus proxy | limited proxy | |
| ^ | -old <br />-proxyver 2 | OK | full legacy globus proxy | proxy | limited legacy globus proxy | limited proxy | |
| ^ | -rfc <br />-proxyver 4 | OK | RFC 3820 compliant impersonation proxy | RFC compliant proxy | RFC 3820 compliant limited proxy | RFC compliant proxy | |
| ^ | -proxyver 3 | FAILED | Proxy draft (pre-RFC) compliant impersonation proxy | GT3-style proxy | Proxy draft (pre-RFC) compliant limited proxy | GT3-style proxy | See __glexec error__ |



%STOPINCLUDE%
