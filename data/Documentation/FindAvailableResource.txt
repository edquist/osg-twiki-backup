%META:TOPICINFO{author="BrianBockelman" date="1270133082" format="1.1" version="1.10"}%
%META:TOPICPARENT{name="UsingTheGrid"}%
%LINKCSS%

---+!! Find an available resource
%DOC_STATUS_TABLE%
%TOC%

%STARTINCLUDE%

This section will discuss first how to find sites by hand and how to find sites in a machine-readable format.  The point is to first get a "human grasp" on what's available, then slowly introduce the machine-readable formats.

---++++ Finding resources in your browser
All OSG sites are registered in a central database called OIM and presented via a webpage called [[http://myosg.grid.iu.edu][MyOSG]]. OIM maintains information on every site in a DB, and verifies this information regularly. Resources that fail basic functionality tests are marked in red, resources that pass all basic tests are green.

[[https://myosg.grid.iu.edu/rgsummary/index?datasource=summary&summary_attrs_showdesc=on&summary_attrs_showhierarchy=on&summary_attrs_showservice=on&summary_attrs_showrsvstatus=on&summary_attrs_showfqdn=on&summary_attrs_showvoownership=on&summary_attrs_showcontact=on&all_resources=on&gridtype=on&gridtype_1=on&service_1=on&service_5=on&service_2=on&service_3=on&active=on&active_value=1&disable_value=1][Here is a direct link to the MyOSG resource summary page.]]

Each endpoint is called a "resource", and each resource provides resources such as "CE" or "SRMv2".  The right-hand column allows you to filter by facility, current status, or the VO which owns the resource.  Notice there is some necessary information missing:
   1 The full contact information for the resource (port used, URL, etc)
   1 Whether the service will support your VO.

---++++ Finding resource in the command line
!MyOSG allows you to explore the resources, but it is not meant to match jobs to resources.  There are two servers - !ReSS and BDII - that provide very detailed data for using the endpoints.  The BDII provides data in the LDIF format while !ReSS provides data in a Condor ClassAd format.  Both formats express the information in a schema called "GLUE".

We will give a few examples, but suggest that you use try these queries once, then use pre-built tools such as OSG-MM.  We will be using the results you receive later for some of the job management examples.   If you find yourself programming BDII queries into your code, ask for help - you might be approaching something wrong.

To get a list of contact string for sites that support your VO, you can query the BDII server.  Try the following query directly:

<pre class="screen">
<userinput>ldapsearch -LLL -h is.grid.iu.edu -p 2170 -x -b 'o=grid' '(&(objectClass=GlueCE)(GlueCEAccessControlBaseRule=VO:cms))' GlueCEInfoHostName GlueCEInfoGatekeeperPort GlueCEInfoJobManager</userinput>
</pre>

This queries the BDII for all CEs which support the CMS VO (replace "cms" with your VO name).  One example result is:

<pre class="screen">
dn: GlueCEUniqueID=cit-gatekeeper.ultralight.org:2119/jobmanager-condor-cms_us
 er,Mds-Vo-name=CIT_CMS_T2,Mds-Vo-name=local,o=grid
GlueCEInfoHostName: cit-gatekeeper.ultralight.org
GlueCEInfoGatekeeperPort: 2119
GlueCEInfoJobManager: condor
</pre>

We can use the information found here to build a query to a tool like Condor-G or globus-job-run.  The format for a Globus resource is "host:port/jobmanager-<batch system>".  From the above example, the corresponding contact is "cit-gatekeeper.ultralight.org:2119/jobmanager-condor".

If you have condor_status installed on your system, you can do more advanced formatting:

<pre class="screen">
<userinput>condor_status -pool osg-ress-1.fnal.gov -const 'stringListIMember("VO:cms", GlueCEAccessControlBaseRule)' -format '%s:' GlueCEInfoHostName -format '%i' GlueCEInfoGatekeeperPort -format '/jobmanager-%s\n' GlueCEInfoJobManager | sort | uniq</userinput>
</pre>
Like before, replace "cms" with the appropriate name for your VO.
<br/>
%TWISTY{
mode="div"
showlink="Show results from sample query..."
hidelink="Hide results"
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
<pre class="screen">
antaeus.hpcc.ttu.edu:2119/jobmanager-sge
belhaven-1.renci.org:2119/jobmanager-condor
ce01.cmsaf.mit.edu:2119/jobmanager-condor
cit-gatekeeper2.ultralight.org:2119/jobmanager-condor
cit-gatekeeper.ultralight.org:2119/jobmanager-condor
cms-0.mps.ohio-state.edu:2119/jobmanager-condor
cmsgrid01.hep.wisc.edu:2119/jobmanager-condor
cmsgrid02.hep.wisc.edu:2119/jobmanager-condor
cmsosgce2.fnal.gov:2119/jobmanager-condor
cmsosgce4.fnal.gov:2119/jobmanager-condor
cmsosgce.fnal.gov:2119/jobmanager-condor
cms.tier3.ucdavis.edu:2119/jobmanager-condor
cms-xen19.fnal.gov:2119/jobmanager-condor
cms-xen2.fnal.gov:2119/jobmanager-condor
condor.crc.nd.edu:2119/jobmanager-condor
d0cabosg1.fnal.gov:2119/jobmanager-pbs
d0cabosg2.fnal.gov:2119/jobmanager-pbs
fermigridosg1.fnal.gov:2119/jobmanager-condor
ff-grid2.unl.edu:2119/jobmanager-pbs
ff-grid3.unl.edu:2119/jobmanager-pbs
ff-grid.unl.edu:2119/jobmanager-pbs
fnpcosg1.fnal.gov:2119/jobmanager-condor
gluskap.phys.uconn.edu:2119/jobmanager-condor
gpn-husker.unl.edu:2119/jobmanager-condor
gridgk01.racf.bnl.gov:2119/jobmanager-condor
gridgk02.racf.bnl.gov:2119/jobmanager-condor
hepcms-0.umd.edu:2119/jobmanager-condor
heposg01.colorado.edu:2119/jobmanager-condor
iogw1.hpc.ufl.edu:2119/jobmanager-pbs
lepton.rcac.purdue.edu:2119/jobmanager-pbs
nwicg.crc.nd.edu:2119/jobmanager-condor
nys1.cac.cornell.edu:2119/jobmanager-pbs
osgce64.hepgrid.uerj.br:2119/jobmanager-condor
osg-ce.sprace.org.br:2119/jobmanager-condor
osg.crc.nd.edu:2119/jobmanager-sge
osg-east.hms.harvard.edu:2119/jobmanager-condor
osg-nemo-ce.phys.uwm.edu:2119/jobmanager-condor
osg.rcac.purdue.edu:2119/jobmanager-condor
osgserv01.slac.stanford.edu:2119/jobmanager-lsf
ouhep00.nhn.ou.edu:2119/jobmanager-condor
ouhep0.nhn.ou.edu:2119/jobmanager-condor
ouhep1.nhn.ou.edu:2119/jobmanager-condor
pf-grid.unl.edu:2119/jobmanager-condor
pg.ihepa.ufl.edu:2119/jobmanager-condor
proton.fis.cinvestav.mx:2119/jobmanager-pbs
red.unl.edu:2119/jobmanager-condor
smufarm.physics.smu.edu:2119/jobmanager-condor
tier2-01.ochep.ou.edu:2119/jobmanager-condor
tier2-02.ochep.ou.edu:2119/jobmanager-condor
tier2-03.ochep.ou.edu:2119/jobmanager-condor
top.ucr.edu:2119/jobmanager-condor
tuscany.med.harvard.edu:2119/jobmanager-condor
u2-grid.ccr.buffalo.edu:2119/jobmanager-pbs
uscms1.fltech-grid3.fit.edu:2119/jobmanager-condor
vampire.accre.vanderbilt.edu:2119/jobmanager-pbs
</pre>
%ENDTWISTY%
<br/>
We don't expect you to understand the command you just ran - the important knowledge here is that you can use Condor to query information about the site and to get the list of sites you can run at for the purposes of test jobs.

%STOPINCLUDE%

---++ *Comments*
%COMMENT{type="tableappend"}%

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = BrianBockelman

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = User

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = EndUser

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Training
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %NO%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = TimCartwright
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %IN_PROGRESS%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = TimCartwright
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %IN_PROGRESS%
############################################################################################################
-->