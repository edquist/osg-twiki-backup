%META:TOPICINFO{author="AlainDeximo" date="1377871037" format="1.1" reprev="1.43" version="1.43"}%
%META:TOPICPARENT{name="CertificateUserGet"}%
---+!! Getting a User Certificate via Web interface

%DOC_STATUS_TABLE%
%TOC%

Please send feedback on the documentation or ask questions about the process to the [[mailto:goc@opensciencegrid.org][Grid Operations Center]].


---+ About This Document

This document contains some general instructions on how a scientist can obtain an electronic credentials that allow
the use of the [[Documentation.WhatIsOSG][Open Science Grid]] (OSG). Getting these credentials
is part of the process of [[Documentation.UsingTheGrid][becoming a new grid user]].
The steps are:
   1. Getting what's called a [[Documentation.CertificateWhatIs][certificate]] [[https://oim.grid.iu.edu/oim/certificaterequestuser][here]]. 
   1. Registering this certificate with a type of organization known as a [[https://twiki.grid.iu.edu/bin/view/Documentation/WhatIsOSG#Virtual_Organizations][VO]] that is authorized to use computers on the grid.

These instructions are mainly for users who do not have credentials.
If you already have a certificate, you probably want to
instead [[MiscellaneousCertificateTasks][renew or replace it]].


---+ Requirements

You first need to know the VO you should join. If you're not sure,
[[http://myosg.grid.iu.edu/vosummary?all_vos=on&active=on&active_value=1&datasource=summary][this list]] may help, or please email the [[mailto:goc@opensciencegrid.org][Grid Operations Center]].

 From your VO you should find out
   1. Whether to use these instructions or some
      VO specific ones instead;
   1. Who to use as your sponsor for the certificate;
   1. The URL for applying for VO membership, the
      sponsor to use, and what group, if any, to request; and
   1. What machine you can use to submit jobs to
      OSG. The VO may need to make you an account on that machine.

These instructions were written for Firefox although
the basic steps are similar for other browsers. 
  
---+ Setting the Master Password (Optional)

To help protect the certificate, it's best to set
Firefox's [[http://kb.mozillazine.org/Master_password][master password]]. First, go to the Security
submenu under Options/Preferences, which [[http://kb.mozillazine.org/Menu_differences_in_Windows,_Linux,_and_Mac][is reachable under]] 
*Tools -> Options* for Windows, 
*Firefox -> Preferences* for Macs, and 
*Edit -> Preferences* for Linux. 
Then click on the "Use a master password" button
and set a password when prompted.
%TWISTY{
showlink="Screenshot"
hidelink="Hide"
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
%BR%
%ATTACHURL%/set_master_password1.png
%ENDTWISTY{}%
The browser will later ask you for this password
when you use your certificate.

There is more information about protecting grid
credentials [[Documentation.SecurityUserResponsibilities][here]].

#DownloadingCaCert
---+ Downloading CA certificate files for new OSG !DigiCert-based certificates
[[http://www.digicert-grid.com/][Here]] you will find the location from which you can download the Digicert root and intermediate CA certs that are needed to add to the OS X Keychain (for example) or to the trusted issuer stores in the various browsers.

The following is a sample of the page and file needed to be downloaded and imported.

       %ATTACHURL%/DigiCert_Repository_root_cert_b.png  %BR%

---+ Installing into a Web Browser

To import the CA certificates into your browser, download both the [[http://www.digicert-grid.com/DigiCertGridRootCA.cer][Root]] and [[http://www.digicert-grid.com/DigiCertGridCA-1.cer][CA-1]] PEM format files and then go into the Certificate Manager of your browser and use the Import function.  Make sure your import these certificates as Authorities.

---+ Requesting a New User Certificate
    
   1. Start your browser and go to
     https://oim.grid.iu.edu/oim/certificaterequestuser.
   1. Select the appropriate VO from the drop down menu.
       <p> %ATTACHURL%/VO_selection.png </p>
   1. After having read through the OSG Policy Agreement, check the "I AGREE" box and click on Submit.
      <p> %ATTACHURL%/OSG_policy_agreement.png  </p>
    
---+ SHA-2 Certificates

[[http://www.digicert.com/sha-2-ssl-certificates.htm][SHA-2 Certificate Solutions DigiCert SHA-256 SSL]]

HA-2 certificate is currently only available in OIM-ITB (http://oim-itb.grid.iu.edu/oim/certificate).  The process in which to obtain a SHA-2 certificate is the exact same process as 
previously outlined.  The change from SHA-1 to SHA-2 certificate is transparent.

The following are a few methods to verifying that your newly downloaded user certificate is SHA-2  certificate.

*Mac user:*
   1. Open up your "Keychain Access"
   2. Locate and highlight the Digicert certificate that you have imported into your Keychain 
       <p> %ATTACHURL%/Keychain.png  </p>
   3. Right click the certificate and select "Get Info"
   4. Scroll down to "Signature Algorithm" and it should say something similar to "SHA-256 with RSA Encryption ( 1 2 840 113549 1 1 11 )" 
       <p> %ATTACHURL%/Keychain_2.png  </p>

*Firfox:*
   1. Open up your Firefox browser
   2. Drill down on the "Firefox" menu and select "Preferences…"
   3. Select the "Certificates" tab and click on "View Certificates"
       <p> %ATTACHURL%/FF_browser_3.png  </p>
   4. Locate and highlight the Digicert certificate that you have imported into your browser
       <p> %ATTACHURL%/FF_browser_2.png  </p>
   5. Click on the "View…" button and another window will come up containing the certificate's information
   6. Click on the "Details" tab and scroll down the "Certificates Fields" section to "Certificate Signature Algorithm"
   7. In the "Field Value" sections you should see "PKCS #1 SHA-256 With RSA Encryption"
       <p> %ATTACHURL%/FF_browser.png  </p>

*Command-line:*
   1. Convert your .p12 file to a .pem file
       <p> %ATTACHURL%/CL_p12-pem.png  </p>
   2. Execute openssl to obtain details of your certificate
       <p> %ATTACHURL%/CL_output.png  </p>
     

---+ VO Registration

  In most cases, you will have to separately apply for
  VO membership. Depending on your VO, you will most
  likely use either a [[Documentation.GlossaryOfTerms#DefsVomrs][VOMRS server]] or a [[Documentation.GlossaryOfTerms#DefsVomsAdmin][VOMS-Admin server]]. Both require that you have your certificate
  before applying.

  Find out the URL of your VO's VOMRS or VOMS-Admin
  server either from your VO administrator, or the [[http://myosg.grid.iu.edu/vosummary?all_vos=on&active=on&active_value=1&datasource=summary][list at MyOSG]].

---++ Registration Using a VOMRS Server

   1. Go to the VOMRS URL. When the browser asks for
     a certificate, select the one we just got.
     The bottom left corner of the page should have
     some red text that says "You are logged in as
     ...", with your name after "CN=".
     %TWISTY{
     showlink="Screenshot"
     hidelink="Hide"
     showimgleft="%ICONURLPATH{toggleopen-small}%"
     hideimgleft="%ICONURLPATH{toggleclose-small}%"
     }%
     %BR% 
     %ATTACHURL%/initial_vomrs_registration_page.png
     %ENDTWISTY{}%
   1. Click on "Registration (Phase I)" in the left-hand
     menu bar, and follow the directions there. For
     "Application", write the program that you plan to
     use most often. You should probably contact the
     representative to let them know about this
     request.
   1. When you get an email from the server, click on
     the enclosed URL and then wait for the
     representative to approve you.

 %TWISTY{
     showlink="Verification"
     hidelink="Hide"
     showimgleft="%ICONURLPATH{toggleopen-small}%"
     hideimgleft="%ICONURLPATH{toggleclose-small}%"
     }%
     %BR% 
  To confirm this step, return to the VOMRS server,
  select your new certificate when prompted, and you
  should see a page like this:%BR%
  %ATTACHURL%/VO_verification1.png %BR%
  The certificate information shown in red at the
  bottom of the page should correspond to the
  certificate that you registered. Also, the "[+]
  Member Info" line in the menu at the top left of the
  page should be present.%BR%
  Next click on the "[+] Member Info" line, click on
  all the check boxes in the page that comes up, and
  click "Search". This should bring up all the
  information that the VO has about you.
  %ENDTWISTY{}%

---++ Registration Using a VOMS-Admin Server
  
   1. Go to the voms-admin URL for your VO. Make sure
      that the DN listed is the one for the certificate
      that you just got, then fill out the form and
      click "register". If you should belong to a particular group,
      either send an email to the VO administrator or, if there is a
      comments box on the page, mention that there.
     %TWISTY{
     showlink="Screenshot"
     hidelink="Hide"
     showimgleft="%ICONURLPATH{toggleopen-small}%"
     hideimgleft="%ICONURLPATH{toggleclose-small}%"
     }%
     %BR%
     %ATTACHURL%/vomsadmin_initialB.png
     %ENDTWISTY{}%
   1. Wait for the email from the VOMS-Admin server, and
      click on the URL in it to complete the request.
     %TWISTY{
     showlink="Screenshot"
     hidelink="Hide"
     showimgleft="%ICONURLPATH{toggleopen-small}%"
     hideimgleft="%ICONURLPATH{toggleclose-small}%"
     }%
     %BR%
     %ATTACHURL%/vomsadmin_request_confirmedB.png
     %ENDTWISTY{}%
   1. Wait for an email triggered by a human, the VO
      administrator, saying that you are approved.

  %TWISTY{
     showlink="Verification"
     hidelink="Hide"
     showimgleft="%ICONURLPATH{toggleopen-small}%"
     hideimgleft="%ICONURLPATH{toggleclose-small}%"
     }%
     %BR%
   To confirm this step, visit the
   VOMS-Admin server again and check that you get a
   page like this:%BR%
   %ATTACHURL%/vomsadmin_doneB.png
  %ENDTWISTY{}%

---+ Exporting the Certificate to Disk

To export your certificate,

   1. Open the certificate manager:
     [[http://kb.mozillazine.org/Menu_differences_in_Windows,_Linux,_and_Mac][Options/Preferences]] -> Advanced -> Encryption -> View Certificates.
   Select the certificate that you would like to export, and press
   "Backup".%BR%
   %ATTACHURL%/cert_manager_selected.png
   1. When prompted, type in the name of the file to hold
   the new certificate. If you name it "usercred.p12"
   then grid programs can automatically recognize it.
   1. When prompted, set a password for the
   certificate. You'll need this to be able to use the
   certificate later.
   1. After pressing OK, you should see:%BR%
   %ATTACHURL%/cert_export_acknowledgement.png

---+ Transferring the Certificate to the Submit Host

You next need to transfer your certificate to the
machine from which you'll be submitting jobs, the
_submit host_. 

   1. Find out from your VO the name of a submit host.
   1. One way to do the transfer is with the /scp/ program.
   <pre class="screen">
   $ scp -p usercred.p12 %RED%YOUR_USERNAME@SUBMIT_HOSTNAME:%ENDCOLOR%
   usercred.p12                                   100% 5084     5.0KB/s   00:00</pre>
   Here you should replace YOUR_USERNAME with your user
   id on the submit host, and SUBMIT_HOSTNAME with the
   name of the submit host. The "@" and ":" symbols are
   important.
     Another way to do the transfer is with [[http://www.thegeekstuff.com/2011/06/windows-sftp-scp-clients/][a GUI scp/sftp client]].
   1. Log into the remote host:
   <pre class="screen">
   $ ssh %RED%YOUR_USERNAME@SUBMIT_HOSTNAME %ENDCOLOR%</pre>
   1. Generate .pem files needed by globus
   <pre class="screen">
  openssl pkcs12 -in usercred.p12 -clcerts -nokeys -out $HOME/.globus/usercert.pem
  openssl pkcs12 -in usercred.p12 -nocerts -out $HOME/.globus/userkey.pem</pre>
   1. Make sure that the permissions are correct:
   <pre class="screen">
   $ chmod 400 usercred.p12</pre>
   1. Make a directory called ".globus", and move the
   certificate into that directory:
   <pre class="screen">
   $ mkdir .globus 
   $ mv usercred.p12 .globus/</pre>

---+ Next Steps

The next steps are to [[Documentation.UserTestingResource][run a test job]],
and then [[Documentation.UsingTheGrid#Running_Jobs][real jobs]].


<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
   DEAR DOCUMENT OWNER
   ===================

   Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER          = AlainDeximo

   Please define the document area, choose one of the defined areas from the next line
   DOC_AREA = (ComputeElement|General|Integration|Monitoring|Operations|Security|Storage|Tier3|User|VO)
   * Local DOC_AREA       = User

   define the primary role the document serves, choose one of the defined roles from the next line
   DOC_ROLE = (Developer|Documenter|Scientist|Student|SysAdmin|VOManager)
   * Local DOC_ROLE       = Scientist

   Please define the document type, choose one of the defined types from the next line
   DOC_TYPE = (HowTo|Installation|Knowledge|Navigation|Planning|Training|Troubleshooting)
   * Local DOC_TYPE       = HowTo
   
   Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

   Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

   change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

   change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %YES%

   change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %YES%


   DEAR DOCUMENT REVIEWER
   ======================

   Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = MarcoMambelli
  
   Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %YES%


   DEAR DOCUMENT TESTER
   ====================

   Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = JamesWeichel
  
   Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %YES%
############################################################################################################
-->

%META:FILEATTACHMENT{name="cert_export_acknowledgement.png" attachment="cert_export_acknowledgement.png" attr="h" comment="" date="1318461444" path="cert_export_acknowledgement.png" size="16873" stream="cert_export_acknowledgement.png" tmpFilename="/usr/tmp/CGItemp27564" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="cert_manager_selected.png" attachment="cert_manager_selected.png" attr="h" comment="" date="1318461463" path="cert_manager_selected.png" size="51199" stream="cert_manager_selected.png" tmpFilename="/usr/tmp/CGItemp27458" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="Certificate_has_been_installed.png" attachment="Certificate_has_been_installed.png" attr="h" comment="" date="1318461585" path="Certificate_has_been_installed.png" size="23366" stream="Certificate_has_been_installed.png" tmpFilename="/usr/tmp/CGItemp27370" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="certificate_install_failure.png" attachment="certificate_install_failure.png" attr="h" comment="" date="1318461603" path="certificate_install_failure.png" size="25997" stream="certificate_install_failure.png" tmpFilename="/usr/tmp/CGItemp27325" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="import_your_certificateB.png" attachment="import_your_certificateB.png" attr="h" comment="" date="1318461701" path="import_your_certificateB.png" size="90569" stream="import_your_certificateB.png" tmpFilename="/usr/tmp/CGItemp27538" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="initial_vomrs_registration_page.png" attachment="initial_vomrs_registration_page.png" attr="h" comment="" date="1318461750" path="initial_vomrs_registration_page.png" size="181977" stream="initial_vomrs_registration_page.png" tmpFilename="/usr/tmp/CGItemp27596" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="installing_DOEgrids_cert_1.png" attachment="installing_DOEgrids_cert_1.png" attr="h" comment="" date="1318461773" path="installing_DOEgrids_cert_1.png" size="53782" stream="installing_DOEgrids_cert_1.png" tmpFilename="/usr/tmp/CGItemp27304" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="seeing_the_new_certificateB.png" attachment="seeing_the_new_certificateB.png" attr="h" comment="" date="1318461799" path="seeing_the_new_certificateB.png" size="45264" stream="seeing_the_new_certificateB.png" tmpFilename="/usr/tmp/CGItemp27404" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="set_master_password1.png" attachment="set_master_password1.png" attr="h" comment="" date="1318461821" path="set_master_password1.png" size="72293" stream="set_master_password1.png" tmpFilename="/usr/tmp/CGItemp27366" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="verify_CA_certificates.png" attachment="verify_CA_certificates.png" attr="h" comment="" date="1318461895" path="verify_CA_certificates.png" size="89219" stream="verify_CA_certificates.png" tmpFilename="/usr/tmp/CGItemp27522" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="VO_verification1.png" attachment="VO_verification1.png" attr="h" comment="" date="1318461921" path="VO_verification1.png" size="179574" stream="VO_verification1.png" tmpFilename="/usr/tmp/CGItemp27520" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="vomsadmin_doneB.png" attachment="vomsadmin_doneB.png" attr="h" comment="" date="1318461949" path="vomsadmin_doneB.png" size="49886" stream="vomsadmin_doneB.png" tmpFilename="/usr/tmp/CGItemp27453" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="vomsadmin_initialB.png" attachment="vomsadmin_initialB.png" attr="h" comment="" date="1318462016" path="vomsadmin_initialB.png" size="154488" stream="vomsadmin_initialB.png" tmpFilename="/usr/tmp/CGItemp27418" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="vomsadmin_request_confirmedB.png" attachment="vomsadmin_request_confirmedB.png" attr="h" comment="" date="1318462037" path="vomsadmin_request_confirmedB.png" size="43481" stream="vomsadmin_request_confirmedB.png" tmpFilename="/usr/tmp/CGItemp27475" user="MarkoSlyz" version="1"}%
%META:FILEATTACHMENT{name="VO_selection.png" attachment="VO_selection.png" attr="h" comment="" date="1352381509" path="VO_selection.png" size="86913" stream="VO_selection.png" tmpFilename="/usr/tmp/CGItemp6748" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="OSG_policy_agreement.png" attachment="OSG_policy_agreement.png" attr="h" comment="" date="1352381860" path="OSG_policy_agreement.png" size="112603" stream="OSG_policy_agreement.png" tmpFilename="/usr/tmp/CGItemp6940" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="DigiCert_Repository_root_cert.png" attachment="DigiCert_Repository_root_cert.png" attr="h" comment="" date="1361385736" path="DigiCert Repository root cert.png" size="198557" stream="DigiCert Repository root cert.png" tmpFilename="/usr/tmp/CGItemp45596" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="DigiCert_Repository_root_cert_b.png" attachment="DigiCert_Repository_root_cert_b.png" attr="h" comment="" date="1361386867" path="DigiCert Repository root cert b.png" size="180487" stream="DigiCert Repository root cert b.png" tmpFilename="/usr/tmp/CGItemp45684" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="Keychain.png" attachment="Keychain.png" attr="h" comment="" date="1377863627" path="Keychain.png" size="58122" stream="Keychain.png" tmpFilename="/usr/tmp/CGItemp57931" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="Keychain_2.png" attachment="Keychain_2.png" attr="h" comment="" date="1377863714" path="Keychain_2.png" size="74653" stream="Keychain_2.png" tmpFilename="/usr/tmp/CGItemp58246" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="FF_browser_2.png" attachment="FF_browser_2.png" attr="h" comment="" date="1377864227" path="FF_browser_2.png" size="29015" stream="FF_browser_2.png" tmpFilename="/usr/tmp/CGItemp58182" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="FF_browser_3.png" attachment="FF_browser_3.png" attr="h" comment="" date="1377864330" path="FF_browser_3.png" size="55163" stream="FF_browser_3.png" tmpFilename="/usr/tmp/CGItemp58314" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="FF_browser.png" attachment="FF_browser.png" attr="h" comment="" date="1377864401" path="FF_browser.png" size="62110" stream="FF_browser.png" tmpFilename="/usr/tmp/CGItemp58348" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="CL_p12-pem.png" attachment="CL_p12-pem.png" attr="h" comment="" date="1377864718" path="CL_p12-pem.png" size="12424" stream="CL_p12-pem.png" tmpFilename="/usr/tmp/CGItemp58417" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="CL_output.png" attachment="CL_output.png" attr="h" comment="" date="1377864752" path="CL_output.png" size="34756" stream="CL_output.png" tmpFilename="/usr/tmp/CGItemp58282" user="AlainDeximo" version="1"}%
%META:TOPICMOVED{by="MarcoMambelli" date="1318279748" from="ReleaseDocumentation.CertificateGetWeb" to="Documentation.CertificateGetWeb"}%
