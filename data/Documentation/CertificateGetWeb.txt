%META:TOPICINFO{author="JamesBarlow" date="1272050811" format="1.1" version="1.4"}%
%META:TOPICPARENT{name="CertificateGet"}%

%LINKCSS%

<!-- This is the default OSG documentation template. Please modify it in -->
<!-- the sections indicated to create your topic.                        --> 

<!-- By default the title is the WikiWord used to create this topic. If  -->
<!-- you want to modify it to something more meaningful, just replace    -->
<!-- %TOPIC% below with i.e "My Topic".                                  -->

---+ Getting a certificate using a web browser

%DOC_STATUS_TABLE%

---++ Requirements
 <noautolink> 
   * Netscape, Mozilla, or Firefox requires JavaScript support. 
   * Internet Explorer requires ActiveX (at the least, in the Internet Options control panel, go to the Security Settings tab and the Advanced settings, and enable Prompt for Download signed ActiveX controls). There have been difficulties reported for using IE7 on Windows Vista. 
   * Macintosh users: The process does not work with Safari at this time. Use Firefox. <br />%BLUE%If you find it works with Safari please send a descriptive note about that to osg-ra@opensciencegrid.org, thanks.%ENDCOLOR% </noautolink> 

---++ Obtain a certificate via web browser

Print out these instructions, or copy them somewhere so that you can access them without using a browser.

   1 Close all browser sessions. Then establish a new browser session using the same user account on the same machine and same browser (and browser version) as the one in which you plan to initially use your certificate. 
   1 Go to the DOEgrids Subscriber Enrollment page [[http://pki1.doegrids.org/]]. 
   1 Select the Enrollment tab. (We are intentionally steering you away from the front page of the DOEGrid site.) 
   1 Select New user on the left. This takes you to the DOEGrids Subscriber Enrollment page, which contains a form for you to fill out. Fill out the fields as follows: 
      * Subscriber's Identity: Enter your full name as you want it to appear in the certificate. Enter your commonly used email address. 
      * Contact Information: Enter the email address appropriate for the RA (affiliation) you choose. (For example, the FNAL approval process requires that this be a fnal.gov address.) Enter your office phone number at your home institution. Select your affiliation (also called "Registration Authority") from the drop-down menu. 
      * Sponsor Information: Enter the name of your sponsor (your sponsor must be able to vouch for you; he or she is not responsible for approving or denying your request; approval is handled by another process). Enter the sponsor's email address (again, some affiliations require a corresponding email address). Enter the sponsor's telephone number. 
      * Additional Comments: Enter as needed. ?Challenge Phrase Password (Optional): It should be required to enter a password! You will need one to export and import your certificate from/to applications, in addition to revocation. Enter and a password, and confirm it. 
      * Public/Private key information: No information to enter ?Microsoft Hotfix May be Required: No information to enter 
      * Cryptographic Provider: 
         * Linux or other Unix Mozilla/Firefox/Netscape users: Select 2048(High grade). 
         * Windows Mozilla/Firefox/Netscape users: Select Strong Cryptographic Provider. 
         * Windows Internet Explorer users: Select Microsoft Enhanced Cryptographic Provider. 
      * Click Submit. This generates your private key and stores it in the security database (password and certificate store) associated with your browser, user account, and system. 
   1 In the dialog box that tells you to only allow trusted sites to request a certificate for you and asks you if you want to proceed, click Yes. 
   1 Your browser should then point to a page that says "Request successfully submitted." and displays a request number. Make a note of the request number in case you need to follow up on anything. 

---++ Get your certificate and import it into your browser

You will receive email notification from DOEGrids stating whether your request was approved or denied. The email text for an approved request will look similar to the text below. Read it carefully and follow the instructions:
<verbatim>
  Your Personal certificate request has been processed successfully. 
  SubjectDN= CN=Your Name xxxxxx,OU=People,DC=doegrids,DC=org 
  IssuerDN= CN=DOEGrids CA 1,OU=Certificate Authorities,DC=DOEGrids,DC=org 
  notAfter= Sep 30, 2007 11:45:39 AM ?  notBefore= Sep 30, 2006 11:45:39 AM 
  Serial Number= xxxxxx

To get your certificate, please follow this URL: 
https://pki1.doegrids.org:443/displayBySerial?op=displayBySerial&serialNumber=xxxx 
And then click the 'Import your certificate' button at the bottom of this page. 

Note: Some browsers import successfully without indicating this to you.
  
Attention:  You need to be running the same browser, on the same machine, logged in as the same user, 
as you were when you made the certificate  request.

After importing your certificate, export your certificate and the  private key for Grid use. 
Kindly follow the instructions on http://www.doegrids.org/pages/cert-request.html#Globus
Please contact your RA if there is any problem.
</verbatim> Notes:

   * If you are using Mozilla or Firefox and have set a Master Password on your Software Security Device (the password and certificate database), a dialog box requesting the Master Password may appear. If so, enter the password to permit the importation of the certificate. 
   * To import your certificate into another browser on the same or a different machine, you first need to export it from the initial browser into a file. For information on importing certificates into a variety of browsers, visit the [[http://lcg.web.cern.ch/LCG/users/registration/load-cert.html][LCG Users Registration page]] . 

---++ Export (Back up) your certificate
 Follow the [[http://lcg.web.cern.ch/LCG/users/registration/load-cert.html][LCG instructions for importing your certificate]] , but *select "Export"* instead of "Import". (Firefox calls it "backup".) You will need to make up a password and enter it, in order to export your private key. Remember the password!

Refer to [[SecurityUserResponsibilities][What are users' responsibilities regarding security on OSG?]] for information on how to protect your certificate.

---++  Copy your certificate  for grid use (And optionally convert format)
 For use on grid resources or submit machines, copy it to =$HOME/.globus/usercred.p12= (usercred.p12 fie in $HOME/.globus/ directory)  on that machine. And change its permission: 
<verbatim>> chmod 400 $HOME/.globus/usercred.p12 </verbatim>

User commands currently support both =p12= and =pem= certificates. There is no need to convert your =p12= certificate, anyway if you like to have also the certificate in =.pem= format, then run the following commands. The first one extracts your public key, the second extracts your private key. 

<verbatim>> openssl pkcs12 -in $HOME/.globus/usercred.p12 -clcerts -nokeys -out $HOME/.globus/usercert.pem  
> openssl pkcs12 -in $HOME/.globus/usercred.p12 -nocerts -out $HOME/.globus/userkey.pem  </verbatim>

You must set the protections on your two new =.pem= files correctly, otherwise =grid-proxy-init= will not use them.
<verbatim>> chmod go-rw ~/.globus/userkey.pem 
> chmod go-w ~/.globus/usercert.pem  </verbatim>

<!-- CONTENT MANAGEMENT PROJECT

   DEAR DOCUMENT OWNER
   ===================

   Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER          = JamesBarlow

   Please define the document area, choose one of the defined areas from the next line
   DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = Security

   define the primary role the document serves, choose one of the defined roles from the next line
   DOC_ROLE = (Scientist|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

   Please define the document type, choose one of the defined types from the next line
   DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Knowledge
   
   Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

   Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

   change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

   change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %YES%

   change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


   DEAR DOCUMENT REVIEWER
   ======================

   Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = MineAltunay
  
   Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %NO%


   DEAR DOCUMENT TESTER
   ====================

   Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = AnandPadmanabhan
  
   Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %IN_PROGRESS%
 
-->