%META:TOPICINFO{author="KyleGross" date="1329339548" format="1.1" version="1.19"}%
%META:TOPICPARENT{name="Documentation.WebHome"}%
%DOC_STATUS_TABLE%

---+!! Overview of !GridFTP in the Open Science Grid

%TOC%
-------------------------------------

!GridFTP is an extension to well known file transfer protocol (FTP). [[http://www.globus.org/toolkit/data/gridftp][Globus Alliance describes !GridFTP]] as a high-performance, secure, reliable data transfer protocol optimized for high-bandwidth wide-area networks. It is based upon the Internet FTP protocol, and it implements extensions for high-performance operation that were either already specified in the FTP specification but not commonly implemented or that were proposed as extensions by our team. The current !GridFTP protocol specification is now a 'proposed recommendation' document in the Global Grid Forum (GFD-R-P.020).


!GridFTP extends the FTP standard with:
   * Strong authentication, encryption via Globus GSI on both control (command) and data channels
   * Multiple data channels for parallel transfers
   * Third-party transfers: C can initiate a transfer from A to B.
   * Partial file transfers
   * Reusable data channels
   * Tunable network & I/O parameters
   * Server side processing
   * Command pipelining

!GridFTP is the _protocol_. A server or client that implements the !GridFTP protocol is _GridFTP-enabled_ or _Grid-enabled_. Although you will hear about "GridFTP servers", the correct term is "GridFTP-enabled servers". Groups other than Globus can release !GridFTP-enabled clients & servers (e.g., [[http://dims.ncsa.uiuc.edu/set/uberftp/index.html][UberFTP]], which is included with the OSG release, see also [[https://twiki.grid.iu.edu/bin/view/Documentation/StorageUberFtp][uberFTP how to]]).


<a name="SampleGridFTP"></a>
---++ Simple File Transfer through !GridFTP
In a basic file transfer, we would move a source file from Site A to Site B, perhaps so that we could do some operation on it on Site B's computers.


<div style="text-align: center;"> [[%ATTACHURLPATH%/SimpleFileTransfer.png][<img src="%ATTACHURLPATH%/SimpleFileTransfer.png" alt="Simple file transfer" style="width: 50%; height:50%; align: center;" />]] %BR%%BR% *[[%ATTACHURLPATH%/SimpleFileTransfer.png][Figure 1: Simple file transfer]]* </div>


!GridFTP works slightly differently than simple FTP. In Figure 2, Site A, which holds archived data we want to use, runs a !GridFTP-enabled server. Site B, where we want to run our job, runs a !GridFTP-enabled client. We will want to move the file from Site A to Site B.


<div style="text-align: center;"> [[%ATTACHURLPATH%/GridFTP_Simple.png][<img src="%ATTACHURLPATH%/GridFTP_Simple.png" alt="Basic GridFTP Transfer" style="width: 50%; height:50%; align: center;" />]] %BR%%BR% *[[%ATTACHURLPATH%/GridFTP_Simple.png][Figure 2: Basic !GridFTP transfer]]* </div>


The _data channel_ is the communication link(s) over which the data of interest (in this case, the file we wish to move) flows from one place to another. This high-bandwidth link is authenticated by default, with the option of providing encryption and integrity protection.

The control channel is a low-bandwidth TCP link over which commands and responses flow, and is encrypted and integrity-protected by default. 


---++ Direction of Control
In !GridFTP, control can go either way, depending upon which site is initiating the transfer. Control channel can go either way. Site A can initiate the transfer to Site B, or Site B can initiate the transfer to Site A. The direction of control depends on which is acting as the !GridFTP-enabled client and which the !GridFTP-enabled server. Figure 3 shows how the control 


<div style="text-align: center'"> [[%ATTACHURLPATH%/GridFTP_ControlChannel.png][<img src="%ATTACHURLPATH%/GridFTP_ControlChannel.png" alt="GridFTP showing control channel" style="width: 50%; height:50%; align: center;" />]] %BR%%BR% *[[%ATTACHURLPATH%/GridFTP_ControlChannel.png][Figure 3: !GridFTP transfer showing control channels]]* </div>


Even though Site A initiates the transfer, meaning that Site B is acting as the "server", the data channel is still in the same direction as in Figure 2. 


---++ Third party transfer
!GridFTP also allows for the Controller to be at a separate location from both the source and destination locations. This _third-party transfer_ lets a researcher at a remote site initiate a data transfer from Site A to Site B, where he has access to computing facilities.


<div style="text-align: center'">[[%ATTACHURLPATH%/GridFTP_3rdPartyTransfer.png][<img src="%ATTACHURLPATH%/GridFTP_3rdPartyTransfer.png" alt="GridFTP third-party transfer" style="width: 50%; height:50%; align: center;" />]] %BR%%BR% *[[%ATTACHURLPATH%/GridFTP_3rdPartyTransfer.png][Figure 4: !GridFTP third-party transfer]]* </div>




---++ Speeding Up !GridFTP
There are several ways to increase !GridFTP transfer speeds. However, speeds are always affected by factors that you can't control, such as the _network weather_.


---+++ Parallel Streams
Where supported by the installations, !GridFTP supports using _parallel streams_ to transfer data. Instead of a single data channel, it uses several at once, as limited by the installation and its connections.


<div style="text-align: center'">[[%ATTACHURLPATH%/GridFTP_ParallelStreams.png][<img src="%ATTACHURLPATH%/GridFTP_ParallelStreams.png" alt="GridFTP using parallel streams" style="width: 50%; height:50%; align: center;" />]] %BR%%BR% *[[%ATTACHURLPATH%/GridFTP_ParallelStreams.png][Figure 5: !GridFTP transfer using parallel streams]]* </div>


---+++ Striped Transfers
!GridFTP also supports _striped transfers_ of data, where both the source and destination use multiple servers all with separate !GridFTP data channels. 


<div style="text-align: center'">[[%ATTACHURLPATH%/GridFTP_StripedTransfer.png][<img src="%ATTACHURLPATH%/GridFTP_StripedTransfer.png" alt="GridFTP striped transfers" style="width: 50%; height:50%; align: center;"' />]] %BR%%BR% *[[%ATTACHURLPATH%/GridFTP_StripedTransfer.png][Figure 6: !GridFTP striped transfer]]* </div>

%BR%

<div style="text-align: center'">[[%ATTACHURLPATH%/GridFTP_StripedTransfer2.png][<img src="%ATTACHURLPATH%/GridFTP_StripedTransfer2.png" alt="striped transfers"  tyle="width: 50%; height:50%; align: center;"' />]] %BR%%BR% *[[%ATTACHURLPATH%/GridFTP_StripedTransfer2.png][Figure 7: Striped transfer diagram]]* </div>


Of course, for truly speedy transfers, use parallel streams with striped transfers.

---+++ Use large TCP windows
<pre class="screen">
$ <userinput>globus-url-copy -vb -p 4 -tcp-bs 1048576  / gsiftp://ldas-cit.ligo.caltech.edu:15000/usr1/grid/largefile file:/tmp/largefile</userinput>
    514392064 bytes      6609.67 KB/sec avg      8639.71 KB/sec inst
</pre>

---+++ Use large memory buffers
<pre class="screen">
$ <userinput>globus-url-copy -vb -p 4 -bs 1048576 -tcp-bs 1048576 gsiftp://ldas-cit.ligo.caltech.edu:15000/usr1/grid/largefile file:/tmp/largefile</userinput>
    523304960 bytes      7300.56 KB/sec avg      9311.99 KB/sec inst
</pre>

---++ Debugging
Use =&#8211;dbg= to see control channel communication.

---++ Hints for Experts
To make !GridFTP go really fast
   * Use fast disks and filesystems: your filesystem should read & write >30 MB/s
   * [[http://www-didc.lbl.gov/TCP-tuning/][Configure TCP for performance]]
   * Patch your Linux kernel with the [[http://www.web100.org][web100 patch]], as this has an important work-around for Linux 
   * Understand your network path


--------

_Based on "[[SummerGridWorkshop.SummerGridSyllabus2006#Lecture_4_Tuesday_AM_Grid_data_m][Lecture 4: Grid Data Management]]" (July 2005: OSG Summer School) by Ben Clifford (UChi) from work by Bill Allcock (ANL), Jaime Frey (UWisc) & Scott Koranda (UWMilw)_


-- Main.ForrestChristian - 17 Nov 2006 %BR%

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = DouglasStrain

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = Storage

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Knowledge

  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %NO%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %NO%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %YES%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = TanyaLevshina
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %YES%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = 
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %NO%
############################################################################################################
-->

%META:FILEATTACHMENT{name="GridFTP_StripedTransfer2.png" attr="" autoattached="1" comment="Striped transfer diagram" date="1163790298" path="GridFTP_StripedTransfer2.png" size="32908" user="Main.ForrestChristian" version="1"}%
%META:FILEATTACHMENT{name="GridFTP_3rdPartyTransfer.png" attr="" autoattached="1" comment="!GridFTP third-party transfer" date="1163790222" path="GridFTP_3rdPartyTransfer.png" size="47792" user="Main.ForrestChristian" version="1"}%
%META:FILEATTACHMENT{name="GridFTP_ParallelStreams.png" attr="" autoattached="1" comment="!GridFTP transfer using parallel streams" date="1163790244" path="GridFTP_ParallelStreams.png" size="35531" user="Main.ForrestChristian" version="1"}%
%META:FILEATTACHMENT{name="SimpleFileTransfer.png" attr="" autoattached="1" comment="Simple file transfer" date="1163790124" path="SimpleFileTransfer.png" size="28417" user="Main.ForrestChristian" version="1"}%
%META:FILEATTACHMENT{name="GridFTP_ControlChannel.png" attr="" autoattached="1" comment="!GridFTP transfer showing control channels" date="1163790173" path="GridFTP_ControlChannel.png" size="35017" user="Main.ForrestChristian" version="1"}%
%META:FILEATTACHMENT{name="GridFTP_StripedTransfer.png" attr="" autoattached="1" comment="!GridFTP striped transfer" date="1163790275" path="GridFTP_StripedTransfer.png" size="45880" user="Main.ForrestChristian" version="1"}%
%META:FILEATTACHMENT{name="GridFTP_Simple.png" attr="" autoattached="1" comment="Basic !GridFTP transfer" date="1163793095" path="GridFTP_Simple.png" size="35111" user="Main.ForrestChristian" version="1"}%
%META:TOPICMOVED{by="JamesWeichel" date="1318456703" from="Storage.StorageGridFTP" to="Documentation.StorageGridFTP"}%
