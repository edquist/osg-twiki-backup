%META:TOPICINFO{author="BrianBockelman" date="1267145616" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="UsingTheGrid"}%
%LINKCSS%

---+!! The Basic of Using SRM

%STARTINCLUDE%

---++ Introduction
In the OSG, the most common protocol for interfacing with storage is called SRM ("Storage Resource Management").  This is a webservice based protocol that has three major goals:
   1 Unix-like metadata operations (rm, mkdir, ls)
   1 File movement (copy between two storage elements (SE) or copy between the storage element and the local node) using a variety of protocols.  The most common transfer protocol initiated by SRM clients is !GridFTP.
   1 Generic management of backend storage.  Many the large SEs have a tape backend or multiple pools of disk server, each with a different purpose.  SRM allows one to direct files into different pools through the use of space tokens and reservations.

Storage management can be quite complex, and is not uniformly implemented.  We will not cover it in this document.

In this document, we will interact with the SRM endpoints using the =lcg-utils= clients.  This is one of three clients packaged with the OSG Client and OSG wn-client; the others behave in a similar manner.  Each client has different advantages; =lcg-utils= was selected for its simplicity and usability.

---++ File Movement with SRM

Since SRM is a webservice protocol (it operates over HTTP), it is not designed for high-throughput file transfers.  Instead, it redirects users to a different endpoint that implements a transfer protocol (such as !GridFTP).  By simply redirecting the client to another server, the SRM endpoint can effectively load-balance transfers over multiple nodes, allowing transfers to scale.

---++++ Copying files with SRM

We will be using =lcg-cp=, which has the following syntax:
<pre class="screen">
lcg-cp -D srmv2 -b <SRC URL> <DEST URL>
</pre>

Common protocols are =file://=, =srm://=, or =gsiftp://=.  Example URLs are below.
*Local file*:
<pre>
file:/path/to/local/file
</pre>
*SRM server*:
<pre>
srm://srm.example.com:8443/srm/v2/server?SFN=/path/to/remote/file
</pre>
Note the SRM URL requires 4 parts:
   1 Host name
   1 Port (must be given; will fail without it)
   1 Endpoint path.  This can be different for different servers; common endpoints are =srm/v2/server= or =srm/managerv2=.
   1 File path.  This is the file you want to transfer to/from the remote system.

*!GridFTP server* (we do not recommend using !GridFTP):
<pre>
gsiftp://ftp.example.com:2811/path/to/remote/file
</pre>

Here are some examples of using =lcg-cp= using one of the [[Documentation/FindStorageResources][endpoints found previously]]:

<pre class="screen">
echo "hello_world" > /tmp/hello_world
lcg-cp -D srmv2 -b file:/tmp/hello_world srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/public/gpn
lcg-cp -D srmv2 -b srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/public/gpn/hello_world file:/tmp/hello_world2
diff -u /tmp/hello_world /tmp/hello_world2
lcg-cp -D srmv2 -b srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/public/gpn/hello_world srm://srm.example.com:8443/srm/v2/server?SFN=/mnt/hadoop/foo/hello_world
</pre>
The last command shows you can copy between two servers.

Some notes about =lcg-cp=:
   1 You cannot copy directories recursively.
   1 =lcg-cp= automatically creates directories if they do not already exist.

---++ Metadata operations with SRM
SRM has equivalents to many of the traditional Unix commands:

*Delete*
<pre>
lcg-del -D srmv2 -b <URL to delete>
</pre>

*List directory*
<pre>
lcg-ls -D srmv2 -b <URL to list>
</pre>

%STOPINCLUDE%