%META:TOPICINFO{author="KyleGross" date="1329339538" format="1.1" version="1.30"}%
%META:TOPICPARENT{name="UsingTheGrid"}%
%DOC_STATUS_TABLE%

---+!! *Submitting a Single Job Using Condor-G*
%TOC{depth="3"}%

---+ About this Document
In this guide, we will send a single "hello world" Condor-G job to a remote CE.  This will demonstrate the basics of using Condor-G: writing a job submit file, submitting it, and checking its status.

More complex examples in follow-up documents show how to [[CondorSubmittingMultipleJobs][submit multiple jobs]] and [[CondorSubmittingMultipleComplexJobs][submit multiple complex jobs]] (including IO transfer).

---+ Requirements
In order to complete this document, you will need:
   * A DOE Grid [[Documentation.CertificateUserGet][User Certificate]]
   * Membership in a [[Documentation.WhatIsVO][Virtual Organization]]
   * Access to a machine with the [[Documentation.Release3.InstallOSGClient][OSG-Client]] (or [[ReleaseDocumentation.ClientInstallationGuide][OSG-Client 1.2, Pacman version]]) installed. Remember to install also Condor-G if optional and to setup the environment if needed.
   * Know the endpoint you are submitting to, as covered in the [[FindAvailableResource][finding available resources]] document.

%STARTINCLUDE%

---+ Procedure

---++"Hello World" Condor Job

<!-- Using HTML because Twiki lists would have been too complex given the level of nesting -->
<ol>
  <li>Before you submit a job to condor, you need to write a simple script to execute!  We provide one below that will print out a few environment variables, setup the worker node client, and sleep for a bit:
<br/>
%TWISTY{
mode="div"
showlink="Show simple script file..."
hidelink="Hide simple script file"
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
<pre class="file">
#!/bin/sh
echo "Hello from `hostname`"
echo "Going to source the file $OSG_GRID/setup.sh"
source $OSG_GRID/setup.sh
echo "Resulting environment:"
printenv
echo "Output of lcg-cp --help (lcg-cp is a commonly used SRM client):"
lcg-cp --help
echo 'Directories in \$OSG_APP'
ls $OSG_APP
date
sleep 120
date
</pre>
%ENDTWISTY%
<br/>
Name this script =mytest.sh= and set it executable with =chmod +x mytest.sh=.
  </li>
  <li>Create a file named =condorg_test.submit= that contains the following (we will cover this line-by-line below):
<br/>
%TWISTY{
mode="div"
showlink="Show condor submit file..."
hidelink="Hide condor submit file"
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
<pre class="file">
Universe        = grid
grid_resource = gt2 red.unl.edu:/jobmanager-condor
Executable      = mytest.sh
Output          = job_test.output
Error           = job_test.error
Log             = job_test.log
queue
</pre>
%ENDTWISTY%
Replace the endpoint =red.unl.edu:/jobmanager-condor= with the endpoint you selected from the [[FindAvailableResource][finding available resources guide]].
   </li>
   <li>Create a proxy that indicates which VO you are part of:
 <pre class="screen">
%UCL_PROMPT% voms-proxy-init --voms cms:/cms
</pre>
Replace =cms:/cms= as appropriate for your VO.
   </li>
   <li>Submit the =condorg_test.submit= job:
<pre class="screen">
%UCL_PROMPT% condor_submit condorg_test.submit
</pre>
   </li>
   <li>Give yourself some time. Grid middleware can add a latency of about a minute on top of the amount of time your job spends in the batch system queue (if any time).  While you're waiting, read on through the rest of the guide for an explanation of the Condor submit file.
   </li>
   <li>Use =condor_q= to display information about your jobs:
<pre class="screen">
%UCL_PROMPT% condor_q -globus
</pre>
You should expect to see the jobs idle for a minute or two, go into the running state for a minute or two, and then end.  You can also follow along in the log file job_test.log which Condor should create in your working directory.

Here is sample output from =condor_q -globus=:
<br/>
%TWISTY{
mode="div"
showlink="Show condor output..."
hidelink="Hide condor output"
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
<pre class="screen">
%UCL_PROMPT% condor_q -globus


-- Submitter: hcc-grid.unl.edu : <129.93.229.131:50400> : hcc-grid.unl.edu
 ID      OWNER          STATUS  MANAGER  HOST                EXECUTABLE        
7709.62  %UCL_USER%      ACTIVE  fork     condor.crc.nd.edu  /opt/osg/osg-120/o
7709.802 %UCL_USER%      ACTIVE  fork     condor.crc.nd.edu  /opt/osg/osg-120/o
7709.816 %UCL_USER%      ACTIVE  fork     tuscany.med.harvar  /opt/osg/osg-120/o
7990.0   %UCL_USER%      PENDING condor   condor.crc.nd.edu   /opt/osg/osg-120/o
8078.0   %UCL_USER%      PENDING condor   gridgk02.racf.bnl.  /opt/osg/osg-120/o
8079.0   %UCL_USER%      PENDING pbs      condor.crc.nd.edu  /opt/osg/osg-120/o
8064.0   %UCL_USER%      PENDING condor   condor.oscer.ou.ed  /opt/osg/osg-120/o
8073.0   osgmm         PENDING sge      antaeus.hpcc.ttu.e  /opt/osg/osg-120/o
</pre>
%ENDTWISTY%
    </li>
</ol>


---++ Condor-G submit files
In this section, we will cover different essential lines in the simple Condor-G submit file used above.
<pre class="file">
universe=grid
grid_resource = gt2 red.unl.edu:/jobmanager-condor
</pre>
Setting the Condor universe to grid enables the Condor-G mode for this job.  In the grid universe, we always must specify what resource to submit to.  The two important parts of this line are "gt2" (referring to the GRAM protocol; you will always use this for OSG sites. "gt2" is actually the default protocol, so you can omit that from the line) plus the GRAM endpoint of the remote host, including the jobmanager name.  Note that we are manually steering this job to a specific cluster - no matchmaking will be done.

Next, we specify what executable to run, where to place the stdout/stderr when the job is done, and where to write the condor log file:
<pre class="file">
Executable      = mytest.sh
Output          = job_test.output
Error           = job_test.error
Log             = job_test.log
</pre>
The output and error are only copied over by Condor-G when the job ends - the output is not streamed back to your submit host as it runs.  The log file will be updated by Condor whenever the job state changes.  The =mytest.sh= script is also copied over to the remote worker node by Condor.

%STOPINCLUDE%

---+ Conclusions

Once this job has completed, congratulations!  You have run your first Condor-G job.  This tutorial covered running a single job, consisting of a single script, no input, and only the stdout/stderr returned.  The job demonstrates using Condor-G, but does "nothing interesting".

We will continue on with more complex examples which include:
   * Submitting many unique jobs from a single submit file
   * Transferring input and output files with Condor-G
   * Passing arguments to the script
   * Running workflows where the jobs have dependencies on each other.
   * Understanding and using the OSG worker node user environment.

---+ Relerences

   * Tutorial about [[CondorSubmittingMultipleJobs][submitting multiple jobs]].
   * Tutorial about [[CondorSubmittingMultipleComplexJobs][submitting multiple complex jobs]] (including IO transfer).
   * [[http://www.cs.wisc.edu/condor/condorg/][Condor-G documentation]].

---+!! *Comments*
%COMMENT{type="tableappend"}%

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = BrianBockelman

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = User

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = Scientist

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Training
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %YES%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %YES%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = AshuGuru
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %YES%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = MarcoMambelli
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %YES%
############################################################################################################
-->