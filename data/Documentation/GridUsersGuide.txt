%META:TOPICINFO{author="ForrestChristian" date="1169079175" format="1.1" reprev="1.19" version="1.19"}%
<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!! %SPACEOUT{ "%TOPIC%" }%
%TOC%
%STARTINCLUDE%


<!--  * Set ALLOWTOPICCHANGE = Main.DocEditGroup !-->
d19 3
---++Introduction

This TWiki page serves as entry point for documentation on how to use the OSG. As the OSG support model assumes the end-user scientists to be supported by large "Virtual Organisations" (VO)
that provide the actual user interfaces and user support, the primary target audience here are
the VO user support teams, rather than the actual scientists as end-users.

---++Getting Access to computing resources via OSG

Getting access to computing resources via the OSG involves the following steps:

   1. Acquire an X.509 certificate from one of the [[http://vdt.cs.wisc.edu/releases/1.3.10/certificate_authorities.html][supported CAs]]. As an example, you might follow [[http://www.grid.iu.edu/osg-ra/PersonalRequest.php][these instructions for obtaining a doesciencegrid certificate]].
   1. [[Documentation.JoinToUseResources][Register with your VO.]] Each VO maintains a <span class="firstterm">virtual organization membership service</span> (<span class="arconym">VOMS</span>) that often has a form for end-user scientists to register. The VO may [[http://osg-docdb.opensciencegrid.org/cgi-bin/ShowDocument?docid=153][implement policies]] using [[http://osg-docdb.opensciencegrid.org/cgi-bin/ShowDocument?docid=154][groups and roles]] and extended proxies in order to differentiate access rights and priorities for different end-users. Every VO is expected to maintain its own [[https://goc.grid.iu.edu/othertools/registration/osgweb/pullvo.php][VO-specific instructions on membership, usage, etc. and general information for users]].
   1. [[ReleaseDocumentation.ClientInstallationGuide][Install the OSG client software]] on your desktop.
   1. Acquire an X.509 certificate from one of the [[http://vdt.cs.wisc.edu/releases/1.3.10/certificate_authorities.html][supported CAs]]. As an example, you might follow [[http://www.grid.iu.edu/osg-ra/PersonalRequest.php][these instructions]] for obtaining a doesciencegrid certificate.
   2. [[Documentation.JoinToUseResources][Register with your VO.]] Each VO maintains a <span class="firstterm">virtual organization membership service</span> (<span class="arconym">VOMS</span>) that often has a form for end-user scientists to register. The VO may [[http://osg-docdb.opensciencegrid.org/cgi-bin/ShowDocument?docid=153][implement policies]] using [[http://osg-docdb.opensciencegrid.org/cgi-bin/ShowDocument?docid=154][groups and roles]] and extended proxies in order to differentiate access rights and priorities for different end-users. Every VO is expected to maintain its own [[https://goc.grid.iu.edu/othertools/registration/osgweb/pullvo.php][VO-specific instructions]] on membership, usage, etc. and [[https://goc.grid.iu.edu/othertools/registration/osgweb/pullvo.php][general information for users]].
   3. Install the [[ReleaseDocumentation.ClientInstallationGuide][OSG client software]] on your desktop.

----+++A word on Policies for resource usage

The OSG does not allocate resources as none of the resources available via the grid are "owned" by the OSG. The owners &#8212; generally large VOs and IT organisations, including national labs &#8212; fully control usage policies on their resources. 

Some VOs allow you to use resources beyond The most common policy for resource utilisation beyond the resources that your VO owns is "opportunistic use". The interpretation of what this means varies greatly. Some sites allow access to all their "spare" resources to anybody registered with a VO on OSG, others only to a small subset of resources and/or VOs. Some sites interpret "spare" to mean "until a more privileged user arrives", others guarantee a minimum wall clock time for your job once it starts.
   $ *%RED% WARNING %ENDCOLOR%*: A cluster is a large error amplifier!
Currently, OSG has not defined a policy schema so you can't query a database to determine a site's specific policies. Check the site's policy web page linked in via gridcat. The only reliable way to find out policy is to try to run a job.

%WARNING% A cluster is a large error amplifier!

---++Finding the list of available sites

All OSG sites are registered with [[http://osg-cat.grid.iu.edu/][GridCat]]. !GridCat maintains information on every site in a DB, and verifies this information regularly. Sites that fail basic functionality tests are red, sites that pass all basic tests are green, and inactive sites are grey. 
<verbatim>
ldapsearch -LLL -h cit-gatekeeper.ultralight.org -p 2135 -x -b mds-vo-name=CIT_CMS_T2,o=grid "(GlueHostNetworkAdapterOutboundIP=*)" GlueHostNetworkAdapterOutboundIP
</verbatim>
$ <b>ldapsearch -LLL -h cit-gatekeeper.ultralight.org -p 2135 -x -b mds-vo-name=CIT_CMS_T2,o=grid "(GlueHostNetworkAdapterOutboundIP=*)" GlueHostNetworkAdapterOutboundIP</b>
which returns =GlueHostNetworkAdapterOutboundIP: TRUE=
GlueHostNetworkAdapterOutboundIP: TRUE
</pre>


---+++ Does This Site Support My VO?
If you want to find out whether or not a specific site supports your VO, check  [[http://vors.grid.iu.edu/cgi-bin/index.cgi?region=0&VO=0&res=0&grid=1][VORS]]. 
<verbatim>
ldapsearch -LLL -h cit-gatekeeper.ultralight.org -p 2135 -x -b mds-vo-name=CIT_CMS_T2,o=grid "GlueCEName=cdf"
</verbatim>
<pre class="screen">
> <b>ldapsearch -LLL -h cit-gatekeeper.ultralight.org -p 2135 -x -b mds-vo-name=CIT_CMS_T2,o=grid "GlueCEName=cdf"</b>
</pre>

If supported, it will return a series of entires. If not, it returns an empty string.

---++Using the Computing Resources

OSG release 0.4.1 provides access to compute resources via =condor-g= and to storage resources via either gridFTP or SRM. In the following we provide simple examples for how to use these interfaces to consume resources.

---+++Consuming CPU power

The OSG 0.4.1 release provides the pre-WS GRAM as the interface at each compute site. We refer to this interface as the _Compute Element_ (CE). In principle, both =globus-job-run= and =condor-g= can be used to submit jobs to the CE. However, as a matter of policy we require use of the condor-g gridmonitor for scalability reasons. You should expect to lose your submission privileges at OSG sites if you do not use condor-g and gridmonitor for submission of anything more than a couple of jobs to a site. ([[http://www.cs.wisc.edu/condor/manual/v6.6/5_3Condor_G.html][More info on condor-g]])

There's a [[http://www.cs.wisc.edu/condor/condorg/goldenrules.html][golden rule]] and a [[http://www.cs.wisc.edu/condor/condorg/linux_scalability.html][linux scalability]] document that you might find useful in order to successfully submit a large number of jobs.

---++++Simple Example Script for submission to OSG

%INCLUDE{ "SampleOsgScript" }%

---++++Submitting single job using =condor-g=

%INCLUDE{"CondorSubmittingSingleJob" }%

---++++Submitting multiple jobs using condor-g

%INCLUDE{ "CondorSubmittingMultipleJobs" }%

---+++ Usage of !GlobusRSL

The Globus <span class="firstterm">Resource Specification Language</span> (RSL) provides a uniform way to communicate with various batch schedulers. Here is a list of RSL attributes for Condor and PBS from Jaime Frey:

---++++ Condor
|  *Attribute*  |  *Description*  | 
| condorsubmit | Allow the client to specify abitrary additional attributes to be included in the Condor submit description file. |

---++++ PBS

%INCLUDE{ "GlobusRlsPbsAttributes" }%

---++++ Example: Submitting Job to Purdue
<verbatim>
For example, to submit a job to the [[http://www.purdue.teragrid.org/content/view/11/25/][Purdue site]], one might want to use the following syntax in the Condor submit script:
</verbatim>
<pre class="programlisting">
globusrsl = (project=TG-XYZ12345)( condorsubmit = (Requirements 'HasCTSS == TRUE && CanReachInternet == TRUE') )
</pre>

---++++Golden Rules for power users

%INCLUDE{ "GoldenRulesForPowerUsers" }%

---+++Consuming storage

There are a variety of different [[http://osg.ivdgl.org/twiki/bin/view/ReleaseDocumentation/LocalStorageUse][storage areas in OSG]]. As a general rule, you should keep the size of the files you transfer using condor-g to an absolute minimum. In fact, ideal is a script no larger than a few tens or hundred lines or so. The bulk of what you need for running your jobs should be staged in (e.g. as part of a <span class="acronym">DAG</span>) before the job submission via pre-WS GRAM. Similarly, output files, and any significant logfiles should be staged out, e.g. as part of a DAQ, after the job completes using !GridFTP or SRM. If you have a choice, always prefer SRM over !GridFTP because SRM queues up transfers to avoid overloads, distributes the load across multiple gftp servers and retries after failures.

At present, there is no "one-stop shopping" for getting access to SRM. To try out SRM one a reference platform, send email to =tg-storage at opensciencegrid.org=. They can help you get started, and coordinate getting access to the SRMs across OSG.
d165 1
Examples of srmcp usage are available from =srmcp -help=.

---++++ SRM put
<verbatim>  srmcp file:////bin/sh srm://myhost.mydomain.edu/dir1/dir2/sh-copy </verbatim>

---++++ SRM get
<verbatim>  srmcp srm://myhost.mydomain.edu/dir1/dir2/sh-copy file:///localdir/sh </verbatim>

---++++ SRM copy (SRM to SRM):
<verbatim>  srmcp srm://myhost.mydomain.edu/dir1/dir2/sh-copy srm://anotherhost.org/newdir/sh-copy </verbatim>

---++++ SRM copy (gsiFTP to SRM):
<verbatim>  srmcp gsiftp://ftphost.org//path/file srm://myhost.mydomain.edu/dir1/dir2/file </verbatim>
---+++ globus-url-copy syntax
<span class="command">globus-url-copy</span> uses similar syntax but can only communicate with gsiftp servers

<verbatim>
globus-url-copy file:////bin/sh gsiftp://myhost.mydomain.edu/dir1/dir2/sh-copy
globus-url-copy gsiftp://myhost.mydomain.edu/dir1/dir2/file file:///$OSG_WN_TMP/local-copy
</verbatim>

---+++Condor Hold (_error_) Codes

Sometimes, jobs that you submit actually run, and sometimes they don't. When they don't, exit error codes may be useful. Condor doesn't have error codes _per se_ but does have _hold codes_ that serve the purpose. Unfortunately, the condor teams have not consistently documented them. Here is a list kindly extracted by Jaime Frey from 6.7 Condor code:
Sometimes jobs that you submit run, and sometimes they don't. When they don't, exit error codes may be useful. Condor doesn't have error codes _per se_ but does have _hold codes_ that serve the purpose. Unfortunately, the condor teams have not consistently documented them. Here is a list kindly extracted by Jaime Frey from 6.7 Condor code:

See [[Troubleshooting.CondorErrors]] for more details.
---++ Troubleshooting

In this section we try to provide some hints about when and to whom you should report errors, and which errors you can solve yourself.

You should report OSG-related errors to your [[http://www.opensciencegrid.org/index.php?option=com_content&task=view&id=37&elMenu=Grid%20Support"][VO support center]], who will then triage your problems, and forward your problems to the <span class="firstterm">Grid Operations Center</span> )(<span class="acronym">GOC</span>), if warranted. 

As some of you may actually be also the support center people of your VO, here are some pointers.

---+++Clear cut reasons for generating a trouble ticket

   1. Submitting to the site used to work but now doesn't. Check if the site has gone red on gridcat. If it hasn't, complain so that a trouble ticket gets generated for that site.
   1. A standard script like the examples on this page works when submitted to =jobmanager-fork= but fails on the worker node.
   1. You arrive at the worker node but have no grid proxy, are missing srmcp in your path, or are missing some other client tools that should be part of the OSG WN client installation.
   1. You arrive on the worker node and findthe  OS, network architecture, or some other characteristics that does not agree with the site's characteristics that were advertised via the GIP. 
   1. If a site doesn't have a functioning LDAP service, then it deserves a ticket.

---+++Ambiguous situations that may not warrant a trouble ticket

---++++ You can't authenticate at Site X. 
Unfortunately, OSG rules do not require you to have access to any site in particular. It's up to the site to support you and your VO. Some sites support some VOs without supporting all of their users. 

At present, the only way to understand the intentions of a site is to query its LDAP and see if your VO shows up. The best way to understand if authentication should work for you personally is to check the VO support matrix, and look for your DN among the DNs supported at the site. 

If you find that an unreasonable number of sites don't let you in, send the list of sites where you failed to osg-users at =opensciencegrid.org=. Maybe we can help you gain access to more sites.


&nbsp;

%BOTTOMMATTER%
-- Main.LeighGrund - 16 Jun 2005<br>
-- Main.FkW - 06 May 2006<br>
-- Main.FkW - 14 May 2006<br>
-- Main.FkW - 23 May 2006<br>
-- Main.ForrestChristian - 2007 Feb %BR%

