%META:TOPICINFO{author="MarcoMambelli" date="1326485119" format="1.1" version="1.36"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! Installing OSG Client
%DOC_STATUS_TABLE%
%TOC%

---+ About This Document
%ICON{hand}% This document is for grid users and system administrators. It covers the installation of the OSG Client Tools Package. This package is required on every host used by grid users to submit jobs, transfer data, or interact otherwise with the OSG. Note there is also a [[InstallWNClient][Worker Node Client]] that is not a valid substitute for this package.  Likewise the OSG Client cannot replace the Worker Node Client in the batch jobs environment on %LINK_GLOSSARY_WN% and %LINK_GLOSSARY_CE%.  

The OSG Cient Tools Package includes:
   * the %LINK_GLOBUS_TOOLKIT% providing client tools for authorization, data transfer and job submission.
   * a list of [[Documentation/GlossaryC#DefsCA][CA]] [[Documentation/GlossaryC#DefsCertificate][Certificates]] trusted by the OSG (installed separately).
   * the [[Documentation/GlossaryC#DefsCRL][Certificate Revocation List]] and tools to keep it current.
   * %LINK_GLOSSARY_CONDOR% client tools for job submission and workflow management.
   * client tools to access a %LINK_GLOSSARY_SRM% provided by a %LINK_GLOSSARY_SE%.

%NOTE% This document does not cover the usage of the client tools. An introduction how to use the OSG can be found [[Documentation.UsingTheGrid][here]]. A more detailed description how to interact with a %LINK_GLOSSARY_CE% is located [[ReleaseDocumentation.UserCESimpleTest][here]].

%INCLUDE{"Documentation/DocumentationTeam/DocConventions" section="Header"}%
%INCLUDE{"Documentation/DocumentationTeam/DocConventions" section="CommandLine"}%

---+ Engineering Considerations

The OSG Client Tools Package is required on hosts used to submit jobs to the Open Science Grid. We recommend to install the OSG Client Tools on a _dedicated_ job submission host for large scale job submissions to production resources on the OSG. We recommend to use a [[#PublicIpAddress][public IP address and a fully qualified domain name]] for shared job submission hosts. 


---+ Requirements
---++ Host and OS
   1 A host to install the OSG Client (pristine node). No grid host certificate is required.
   1 OS is %SUPPORTED_OS%.  Currently most of our testing has been done on Scientific Linux 5.
   1 Root access

---++ Certificates
   1 To test and use the installation a valid [[Documentation.CertificateUserGet][grid user certificate]] is required.

---++ Networking
%INCLUDE{"FirewallInformation" section="FirewallTable" lines="portrange,portsource,condor"}%

You'll find more client specific details also in the [[#Firewall_Considerations][Firewall section]] of this document.

---+ Installation and Configuration Procedure

%INCLUDE{"YumRepositories" section="OSGRepoBrief" TOC_SHIFT="+"}%

%INCLUDE{"InstallCertAuth" section="OSGBriefCaCerts" TOC_SHIFT="+"}%

%STARTSECTION{"InstallOSGClientRPMs"}%
---++ Install the Client
   1. Install the osg-client meta package, which will pull in all dependencies. <pre class="rootscreen">
%UCL_PROMPT_ROOT% yum install osg-client   </pre>
%ENDSECTION{"InstallOSGClientRPMs"}%

The client requires no special configuration. 
To configure =fetch-crl=, e.g. to use a proxy, check the [[InstallCertAuth#Managing_Certificate_Revocation][CRL documentation]].

---++ Install Condor-G
Optionally, you may want to install Condor-G, too. Condor-G is needed to submit jobs directly to the OSG sites.<br>
*Note:* Most users don't need this.

   1. Install the osg-client-condor meta package, which will pull in all dependencies. <pre class="rootscreen">
%UCL_PROMPT_ROOT% yum install osg-client-condor   </pre>


---+ Services
The client is a collection of client programs that do not require service startup or shutdown. The only services are fetch-crl that keeps uptodate the CRLs and the optional Condor-G, only if you installed it.
%NOTE% Avoid to interfere with the system Condor. The commands below may start/stop/... also a Condor installed outside of the client installation. Be aware of which one you are controlling.

---++ Starting and Enabling Services
To start the services:
   1. %INCLUDE{"InstallCertAuth" section="OSGBriefFetchCrlStart"}%
   1. Optionally, to start Condor you can use the service command, e.g.: <pre class="rootscreen">
%UCL_PROMPT_ROOT% /sbin/service condor start
</pre>

You should also enable the appropriate services so that they are automatically started when your system is powered on: 
   * %INCLUDE{"InstallCertAuth" section="OSGBriefFetchCrlEnable"}%
   * Optionally, to enable Condor by default on the node: <pre class="rootscreen">
%UCL_PROMPT_ROOT% /sbin/chkconfig condor on
</pre>

---++ Stopping and Disabling Services
To stop the services:
   1. %INCLUDE{"InstallCertAuth" section="OSGBriefFetchCrlStop"}%
   1. Optionally, to stop Condor you can use: <pre class="rootscreen">
%UCL_PROMPT_ROOT% /sbin/service condor stop
</pre>

In addition, you can disable services by running the following commands.  However, you don't need to do this normally.
   * %INCLUDE{"InstallCertAuth" section="OSGBriefFetchCrlDisable"}%
   * Optionally, to disable Condor: <pre class="rootscreen">
%UCL_PROMPT_ROOT% /sbin/chkconfig condor on
</pre>

---+  Firewall Considerations

The %LINK_GLOBUS_TOOLKIT% and %LINK_GLOSSARY_CONDOR% require the client host to _allow_ inbound and outbound network connections. This section describes what additional configuration steps have to be taken if the client host is located behind a firewall. For a more detailed description on firewalls consult [[FirewallInformation][this]] document.

The ranges that you choose below in the Globus and Condor configuration must be consistent with the firewall configuration. If the Globus and Condor ranges overlap there won't be port collisions but you will need a bigger range.

#PublicIpAddress
---++ Public IP Address and DNS
If you use the the client host as Condor-G submit host for long running jobs, it needs to be reached by remote resources. The easier option is to use a _public_ IP address and not be be located within a private network. For other options check below. To make sure that the client host uses a public IP address and is assigned a fully qualified domain name, use:

<pre class="screen">
%UCL_PROMPT% hostname -f
%RED%%UCL_HOST_FQDN%%ENDCOLOR%
%UCL_PROMPT% nslookup %UCL_HOST_FQDN%
Server:		131.215.125.1
Address:	131.215.125.1#53

Name:           %RED%%UCL_HOST_FQDN%%ENDCOLOR%
Address:        %RED%131.215.114.49%ENDCOLOR%
</pre>

If the client host is not assigned a fully qualified domain name, you can assign the _public IP address_ to the =GLOBUS_HOSTNAME= environment variable:

<pre class="rootscreen">
%UCL_PROMPT_ROOT% cat << CFG >> /etc/profile.d/globus_hostname.sh
export GLOBUS_HOSTNAME=%RED%131.215.114.49%ENDCOLOR%
CFG
%UCL_PROMPT_ROOT% cat << CFG >> /etc/profile.d/globus_hostname.csh
setenv GLOBUS_HOSTNAME %RED%131.215.114.49%ENDCOLOR%
CFG
</pre> 


---++ Configuring the firewall and NAT
If the client host is on a private network with NAT or anyway behind a firewall, even a host firewall, the firewall and eventual NAT must be configured correctly.

Assuming you use iptables and chose the port range 20k-25k, you must

Insert the following rules <pre class="file">
-A RH-Firewall-1-INPUT  -m state --state NEW -p tcp -m tcp --dport 20000:24999 -j ACCEPT
-A RH-Firewall-1-INPUT  -m state --state NEW -p udp -m udp --dport 20000:24999 -j ACCEPT
</pre>    
into =/etc/sysconfig/iptables= and <br>
Restart iptables with <pre class="rootscreen">
%UCL_PROMPT_ROOT% service iptables restart
</pre>

%NOTE% It is possible to use a client host that is located inside a private network using Network Address Translation. In this case the gatekeeper must be configured to forward incoming connections to the client host. The =$GLOBUS_HOSTNAME= environment variable must be set to the gatekeeper address. This procedure is currently not documented.

---++ Globus Port Range

%LINK_GLOSSARY_GRAM% can be configured to only use a specified range of TCP ports on the client host for inbound (=$GLOBUS_TCP_PORT_RANGE=) and outbound (=$GLOBUS_TCP_SOURCE_RANGE=) connections. More information can be found in the [[http://dev.globus.org/wiki/FirewallHowTo][Globus firewall HowTo]].
<pre class="rootscreen">
%UCL_PROMPT_ROOT% cat << CFG >> /etc/profile.d/globus_firewall.sh
export GLOBUS_TCP_PORT_RANGE=20000,24999
export GLOBUS_TCP_SOURCE_RANGE=20000,24999
CFG
%UCL_PROMPT_ROOT% cat << CFG >> /etc/profile.d/globus_firewall.csh
setenv GLOBUS_TCP_PORT_RANGE 20000,24999
setenv GLOBUS_TCP_SOURCE_RANGE 20000,24999
CFG
</pre>


---++ Condor Port Range
Condor-G requires a set of ports open in order to talk to OSG CEs.
If you are running a restrictive firewall, you will need to open O(1k) ports in the firewall and tell Condor what port range you opened.

%LINK_GLOSSARY_CONDOR% will only use a specified range of TCP ports for inbound and outbound connections on the client host. This range requires both inbound and outbound connectivity (there are not 2 separate ranges like in the Globus configuration). You can select this range by defining LOWPORT and HIGHPORT in the configuration:

Create  =/etc/condor/config.d/10firewall_condor.config= and add <pre class="file">
LOWPORT=20000
HIGHPORT=24999
</pre> to the file and <br>
Restart Condor with <pre class="rootscreen">
%UCL_PROMPT_ROOT% service condor restart
</pre>


---+ Test the Client

This document does not cover the usage of the client tools. An introduction how to use the OSG can be found [[Documentation.UsingTheGrid][here]]. A more detailed description how to interact with a %LINK_GLOSSARY_CE% is located [[TestOSGClient][here]].

To simply test the functionality of your installation:
   * make sure your [[CertificateUserGet][grid user certificate]] is installed on the client host
   * make sure all services, including Condor-G if you are using it in the tests, are active (see above) 
   * create a [[TestOSGClient#Authentication_using_a_Grid_Prox][grid-proxy]] to test that your certificate is valid
   * create a [[TestOSGClient#Authentication_using_a_VOMS_Prox][voms-proxy]]
   * test to [[TestOSGClient#Mapping_Test][authenticate]] with a %LINK_GLOSSARY_CE%
   * test to [[TestOSGClient#Job_Submission_using_GRAM][submit a job]] using %LINK_GLOSSARY_GRAM%
   * test to [[TestOSGClient#Data_Transfer_Test][transfer data]] using %LINK_GLOSSARY_GRIDFTP%
   * test Condor-G with a [[TestOSGClient#CondorTest][simple job submission]] or follow [[Documentation.CondorSubmittingSingleJob][this tutorial]]

---+ How to get Help?
To get assistance please use this [[HelpProcedure][Help Procedure]].

---+ References
The OSG Client includes also a set of tools that are part of the [[NetworkPerformanceToolkit][Internet2 Network Performance Toolkit]]

---+ Comments

%COMMENT{type="tableappend"}%


<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = MarcoMambelli

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|General|Integration|Monitoring|Operations|Security|Storage|Tier3|User|VO)
   * Local DOC_AREA       = General

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (Developer|Documenter|Scientist|Student|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (HowTo|Installation|Knowledge|Navigation|Planning|Training|Troubleshooting)
   * Local DOC_TYPE       = Installation
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %YES%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %YES%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = JamesWeichel
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %YES%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = JamesWeichel
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %YES%
############################################################################################################
-->

%META:TOPICMOVED{by="JamesWeichel" date="1317239924" from="Documentation.InstallOSGClient" to="Documentation/Release3.InstallOSGClient"}%
