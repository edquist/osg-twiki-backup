%META:TOPICINFO{author="TimCartwright" date="1411063276" format="1.1" reprev="1.2" version="1.2"}%
%TOC{depth="3"}%

---+ Troubleshooting HTCondor CE

Other HTCondor CE pages:
   * HTCondor CE overview and architecture (coming soon)
   * [[InstallHTCondorCE][Installing HTCondor CE]]
   * [[HTCondorCERoutes][Configuring HTCondor CE job routes]]

---++ HTCondor CE Troubleshooting Data

---+++ Job Router Log

The HTCondor CE job router log is the only log file produced by the job router itself. It contains valuable information when trying to troubleshoot issues with job routing.

*Location:*
<pre>/var/log/condor-ce/JobRouterLog</pre>

*Key contents:*
   * Every attempt to route a job
   * Routing success and failure messages
   * Job attribute changes (based on chosen route)
   * Job router process warnings and errors

*What to look for:*

   * Job is considered for routing:\
      <pre class="file">09/17/14 15:00:56 JobRouter (src=86.0,route=Local_LSF): <span style="background-color: yellow;">found candidate job</span></pre>\
      <p>In parentheses are the original HTCondor CE job ID (e.g., =86.0=) and the route (e.g., =Local_LSF=).</p>
   * Job is successfully routed:\
      <pre class="file">09/17/14 15:00:57 JobRouter (src=86.0,route=Local_LSF): <span style="background-color: yellow;">claimed job</span></pre>

---++ HTCondor CE Troubleshooting Tools

are there any yet? osg-system-profiler?

---++ General Troubleshooting Steps

---+++ Making Sure Packages Are Up-To-Date

HTCondor CE is still changing often, and so it is important to make sure that the relevant RPMs are up-to-date.

   1. Determine packages to check on your system\
       <p>How?</p>
   1. Update packages\
       <pre class="screen">yum update <em>packages</em></pre>\
       <p>If you just want to see the packages to update, but do not want to perform the update now, answer <code>N</code> at the prompt.</p>

---++ HTCondor CE Troubleshooting Items

---+++ Jobs Stay Idle Forever

Jobs stay idle in queue forever. Example:

<pre class="screen"></pre>

%NOTE% Jobs may take a while to match and run.

Check the following subsections in order.

---++++ Make sure the underlying batch system can run jobs

[Brief description of troubleshooting step or issue, if needed.]

*Procedure*
   1. Manually create and submit a simple job (e.g., =sleep=)
   1. Check for errors in the submission itself
   1. Watch the job in the batch system queue (e.g., using =condor_q=)
   1. If the job runs, check for errors

*Next actions*

If the underlying batch system does not run a simple manual job, it will probably not run a job coming from HTCondor CE. Once you can run simple manual jobs on your batch system, then try HTCondor CE again.

---++++ Is the Job Router handling incoming jobs at all?

Is it the routes/JobRouter? Are they getting picked up by the job_router? Search for src=<job id> in /var/log/condor-ce/JobRouterLog. You should find some strings that say it's being claimed by route=<route name>. If they don't match a route, they'll go on hold after 30 min (I think?). If they're matching the WRONG route, routes are matched in a 'round robin' type way so routes should be designed to be exclusive.

---++++ Verify correct operation within the BLAHP

Are there any errors in GridmanagerLog.<job owner>? blahp/gahp output gets dumped here.

---++++ Verify ability to change permissions on key files

[Brief description of troubleshooting step or issue, if needed.]

*Sample failure*

<pre class="file">09/17/14 14:45:42 Error: Unable to chown '/var/lib/condor-ce/spool/1/0/cluster1.proc0.subproc0/env' from 12345 to 54321</pre>

*Next actions*

   1. As root, try to change ownership on a file
   1. If using a shared file system, verify that root squash is turned off\
       <pre class="screen">do stuff here</pre>

---+++ Jobs Go on Hold

---++++ Symptoms

Jobs go on hold.

<pre class="screen"></pre>

---++ Further Help with HTCondor CE

---+++ Something

---+++ Requesting Help From OSG

Blah.

   1. <p>Gather basic HTCondor CE and related information</p>
   1. <p>Gather basic system information</p>\
       <pre class="screen">osg-system-profiler &gt; ~/osg-system-profiler-<span style="background-color: yellow;">YYYYMMDD</span>.txt</pre>
   1. <p>Send email to goc@opensciencegrid.org</p>
      * Describe issue and expected or desired behavior
      * Include basic HTCondor CE and related information
      * Attach osg-system-profiler output
