%META:TOPICINFO{author="AlainRoy" date="1334865077" format="1.1" reprev="1.7" version="1.7"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! GUMS Service Install
%DOC_STATUS_TABLE%
%TOC%

---# Introduction
This document is intended to guide system administrators through the process of installing and configuring the GUMS service.
%IMPORTANT% This is an unreleased version of GUMS.  The current released, supported version installation is [[ReleaseDocumentation.GumsClientInstall][here]]. Please note that it still packaged with Pacman, not RPM.
%WARNING% This describes a prototype packaging of an unreleased version of GUMS.  It is meant for testers, %RED%not for deployment%ENDCOLOR%.

---# About This Document

%ICON{hand}% This document is intended for testers that are migrating a GUMS server from a pacman install to an RPM install.  It assumes that you have a pre-existing =gums.config= file.

---# Requirements

---## Host and OS
   * A computer to install GUMS. We strongly recommend that this is a separate computer from your CE, though technically it can be the same one. But really, do you want to run your authorization service on the same computer where your users can run jobs?
   * OS is %SUPPORTED_OS%. 
   * Root access for installation.

---## Users
The GUMS installation will create one unless it already exists.

| *User* | *Comment* |
| =tomcat= | Needed to run Tomcat, which is the process that runs GUMS. |

---## Certificates
| *Certificate* | *User that owns certificate* | *Path to certificate* |
| Tomcat service certificate | =tomcat= | =/etc/grid-security/http/httpcert.pem= <br> =/etc/grid-security/http/httpkey.pem= |

---## Networking
%STARTSECTION{"Firewalls"}%
%INCLUDE{"Documentation/Release3.FirewallInformation" section="FirewallTable" lines="gums"}%
%ENDSECTION{"Firewalls"}%

---# Install Instructions
%INCLUDE{"YumRepositories" section="OSGRepoBrief" TOC_SHIFT="+"}%

GUMS requires CA certificates
%INCLUDE{"InstallCertAuth" section="OSGBriefCaCerts" TOC_SHIFT="+"}%

---## Install and Configure GUMS
   1. Install the GUMS Service <pre class="rootscreen">
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install gums-service </pre>
   1. Configure Tomcat to use GSI <pre class="rootscreen">
%UCL_PROMPT_ROOT% /var/lib/trustmanager-tomcat/configure.sh </pre>  Note this will overwrite your =/etc/tomcat5/server.xml=; if you are using tomcat on this node for non-grid purposes, you may want to consider a hand configuration.
   1. If this is a fresh !MySQL install, we recommend running !RedHat's =mysql_secure_installation= script to apply reasonable security settings. (Start your !MySQL server first by running =service mysqld start=).
   1. If migrating from another GUMS installation, dump the GUMS_1_3 database to a text file from the old server, and load it into the new !MySQL server.
   1. If not migrating from another GUMS installation, run =/usr/bin/gums-setup-mysql-database --user gums --host `hostname`:3306 --password <em>PASSWORD</em>= (pick a password that you don't mind having in plaintext in =/etc/gums/gums.config= -- gums.config should only be readable by the =tomcat= user, but that only gets you so far).
   1. Copy an appropriate =gums.config= into =/etc/gums/gums.config=.  Update it to reflect the new username and password for the mysql server.  We *highly recommend* having GUMS authenticate with !MySQL using =localhost= instead of the actual hostname; this will cause !MySQL to use a local Unix socket instead of listening on the network, which is more secure.

---## Starting and Enabling Services

To start GUMS, you must start the following services:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% /sbin/service fetch-crl-cron start
%UCL_PROMPT_ROOT% /sbin/service fetch-crl-boot start
%UCL_PROMPT_ROOT% /sbin/service mysqld start
%UCL_PROMPT_ROOT% /sbin/service tomcat5 start
</pre>

You should also enable the appropriate services so that they are automatically started when your system is powered on:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% /sbin/chkconfig fetch-crl-cron on
%UCL_PROMPT_ROOT% /sbin/chkconfig fetch-crl-boot on
%UCL_PROMPT_ROOT% /sbin/chkconfig mysqld on
%UCL_PROMPT_ROOT% /sbin/chkconfig tomcat5 on
</pre>

---## Stopping and Disabling Services

To stop GUMS, you should shutdown the services in the opposite order that you started them:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% /sbin/service tomcat5 stop
%UCL_PROMPT_ROOT% /sbin/service mysqld stop
%UCL_PROMPT_ROOT% /sbin/service fetch-crl-boot stop
%UCL_PROMPT_ROOT% /sbin/service fetch-crl-cron stop
</pre>

In addition, you can stop the service from starting up when you computer starts up:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% /sbin/chkconfig fetch-crl-cron off
%UCL_PROMPT_ROOT% /sbin/chkconfig fetch-crl-boot off
%UCL_PROMPT_ROOT% /sbin/chkconfig mysqld off
%UCL_PROMPT_ROOT% /sbin/chkconfig tomcat5 off
</pre>

---## Web interface

You can connect to =https://<em>HOSTNAME</em>:8443/gums/= to use your GUMS instance.
In order to add yourself as an administrator, you should run =gums-add-mysql-admin '<em>YOUR DN</em>'= as root on the machine running the service. You'll be prompted for the password of the gums user.

---# Validating GUMS

%RED%TBD: Basic description of how to make sure GUMS is working correctly%ENDCOLOR%

---# Updating the GUMS configuration

Periodically, the OSG Grid Operations Center will release an updated template for the GUMS configuration that updates information about an existing VO or adds a new VO. 

%RED%TBD: Describe what to do.%ENDCOLOR%

---# Troubleshooting

---## Useful Configuration and Log Files

Configuration Files
| *Service or Process* | *Configuration File* | *Description* |
| !MySQL | =/etc/my.cnf= | !MySQL configuration, e.g. server port |
| tomcat (EL5) | =/etc/tomcat5/= | Tomcat configuration files |
| tomcat (EL5) | =/etc/tomcat6/= | Tomcat configuration files |

Log files
| *Service or Process* | *Log File* | *Description* |
| tomcat (EL5) | =/var/log/tomcat5/catalina.out= | This is the Tomcat log file. Problems (and a lot of noise) are reported here. |
| | =/var/log/tomcat5/trustmanager.log= | The trustmanager handles things related to authentication. Useful errors are sometimes here. |
| tomcat (EL6) | =/var/log/tomcat6/catalina.out= | This is the Tomcat log file. Problems (and a lot of noise) are reported here. |
| | =/var/log/tomcat6/trustmanager.log= | The trustmanager handles things related to authentication. Useful errors are sometimes here. |

---# How to get Help?
To get assistance please use [[HelpProcedure][Help Procedure]].

---# Comments
%COMMENT{type="tableappend"}%

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = JohnHover

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = VO

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Installation
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %NO%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %NO%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %NO%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = AlainRoy
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %NO%


############################################################################################################
-->
