%META:TOPICINFO{author="ScotKronenfeld" date="1326317945" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="WebHome"}%
THIS PAGE NEEDS TO BE UPDATED FOR OSG 3.0!

---+!! VDT Maintenance 
%TOC{}%

---+ About this Document
<!-- useful variable definitions
   * Local UCL_HOST = ce
   * Local UCL_CWD = /opt/osg-%VERSION%
   * Local UCL_SERVICE = vdt-cleanup
-->

%ICON{"hand"}% This Document is for System Administrators. It introduces the usage of cleanup scripts provided by the %LINK_VDT% to perform maintenance on a %LINK_GLOSSARY_CE%.

---+ About the Cleanup Procedure

The cleanup script located at =$VDT_LOCATION/vdt/cleanup-scripts/vdt-cleanup= is run by the =cron= daemon on the user's behalf and cleans up following files and directories:

   * Globus TMP directory: =$VDT_LOCATION/globus/tmp=
   * user gass cache =&lt;user home&gt;/.globus/.gass_cache=
   * user Globus job directory =&lt;user home&gt;/.globus/job=
   * user GRAM job manager logs =&lt;user home&gt;/gram_job_mgr_&lt;integer&gt;.log=
   * user GRAM scratch directories =&lt;user home&gt;/gram_scratch_&lt;random string&gt;=

---+ Installation

The cleanup scripts are installed as part of the [[ReleaseDocumentation/ComputeElementInstall][Compute Element Installation]].

The following configuration settings can be found in =/etc/osg/config.d/10-misc.ini=

<pre class="file">
; The OSG cleanup scripts are provided to help remove Globus files that                         
; build up over time on your system.  For more information see the Twiki:                       
;  https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallCleanupScripts              

; The age in days after which files that have not been accessed should be                       
; deleted. Jobs that run longer than this number of days may be killed because                  
; necessary files may be removed.  If this is a problem for you do not run the                  
; osg-cleanup scripts and email vdt-support@opensciencegrid.org                                 
; Default = 14                                                                                  
;cleanup_age_in_days = 14                                                                       

; The user's home directories that should be cleaned up.  The default value                     
; is @vo-file.  This will open osg-user-vo-map.txt and try to get the list                      
; of users from this file.  Alternatively you can specify a whitespace                          
; separated list of users.                                                                      
;cleanup_users_list = @vo-file                                                                  

; The cron time at which the cleanup script will run.  By default it will run                   
; once a day during the night.                                                                  
;cleanup_cron_time = 15 1 * * *                                    
</pre>

%IMPORTANT% If you set the age to 14 days, jobs that run for longer than 14 days may be killed because necessary files are cleaned up.  You should set this value to a number of days higher than you expect your long running jobs to take to complete.  If this is a problem for you then do not use the =osg-cleanup= script.

%INCLUDE{"ReleaseDocumentation/StartingServices" section="EnableService" INPUT_SCREEN="rootscreen" TOC_SHIFT=""}%
%INCLUDE{"ReleaseDocumentation/StartingServices" section="Activate" INPUT_SCREEN="rootscreen" TOC_SHIFT=""}%

---+ Advanced Topic: Adding Custom Cleanup Scripts

The cron job automatically executes all scripts found in =$VDT_LOCATION/vdt/cleanup-scripts= directory that are:

   * owned by _root_
   * permissions set to _0700_

Following environment variables will be present during the execution of the scripts:

| *Variable* | *Comment* |
| $VDT_LOCATION | Location of the VDT installation. |
| $VDT_CLEANUP_AGE | Age in days after which files will be deleted. |
| $VDT_CLEANUP_USER_FILE | Path to a file containing a list of user accounts and home directories to clean up.  The format is: &lt;user&gt; &lt;user home&gt; |

---+ Validation of Service Operation

   1 Verify that the log file =/var/log/osg/osg-cleanup.log= has been created and inspect its contents.
   1 Run the cleanup script =/usr/sbin/osg-cleanup= with the =--dry-run= option and inspect the output
<pre class="rootscreen">/usr/sbin/osg-cleanup --dry-run</pre>

---+ Known Issues

Currently none.

---+ *Comments*
%COMMENT{type="tableappend"}%
