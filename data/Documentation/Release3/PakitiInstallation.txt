%META:TOPICINFO{author="KevinHill" date="1354726978" format="1.1" reprev="1.7" version="1.7"}%
%META:TOPICPARENT{name="SecurityTeamWorkingArea"}%
---+ *Pakiti Installation*

   * [[http://pakiti.sourceforge.net/#Documentation][Original Pakiti documentation site]]

---++ Client Installation
---+++ Install rpm
---+++ Edit /etc/pakiti-client.conf

---++ Server Installation
---+++ Install OSG repo and certificate packages as appropriate
   * Documentation.Release3.InstallCertAuth

---+++ Install pakiti-server package
<pre class="rootscreen">
%UCL_PROMPT_ROOT% yum install pakiti-server
</pre>

If some other dependency are needed, yum should find them automatically.

---+++ Configure the !MySQL server
   * Configure !MySQL to start at boot
<pre class="rootscreen">
%UCL_PROMPT_ROOT% chkconfig mysqld on
</pre>
   * Start the mysqld service
<pre class="rootscreen">
%UCL_PROMPT_ROOT% /etc/init.d/mysqld start
</pre>
   * Change the !MySQL root password
<pre class="rootscreen">
%UCL_PROMPT_ROOT% /usr/bin/mysql mysql
~ update mysql.user set Password=PASSWORD('strong_root_password') where User='root' and Host='localhost';
~ flush privileges;
~ quit;
</pre>
   * Create the pakiti database
<pre class="rootscreen">
%UCL_PROMPT_ROOT% mysqladmin -u root -p create pakiti2
</pre>
   * Fill the tables
<pre class="rootscreen">
%UCL_PROMPT_ROOT% /usr/bin/mysql -u root -p pakiti2 < /usr/share/doc/pakiti-server-*/pakiti2.sql
</pre>
   * Create a Pakiti user
<pre class="rootscreen">
%UCL_PROMPT_ROOT% /usr/bin/mysql -u root -p mysql
~ GRANT LOCK TABLES, SELECT,INSERT,UPDATE,DELETE ON pakiti2.* TO  'mysql_user'@'localhost' IDENTIFIED BY 'mysql_password';
~ flush privileges;
~ quit;
</pre>
Of course, 'mysql_user' and 'mysql_password' are up to you.
---+++ Configure Apache
It is *strongly* recommended to use HTTPS and client authentication. One way of doing this is to create a /etc/httpd/conf.d/pakiti.conf containing:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% cp /usr/share/doc/pakiti-server-2.1.4/pakiti2.apache2 /etc/httpd/conf.d/pakiti.conf
%UCL_PROMPT_ROOT% cat /etc/httpd/conf.d/pakiti.conf

<VirtualHost *:443>

        SSLEngine on
        SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP
        SSLVerifyClient optional
        SSLVerifyDepth 2
        SSLOptions +StdEnvVars

        SSLCertificateKeyFile "/etc/grid-security/http/httpkey.pem"
        SSLCertificateFile "/etc/grid-security/http/httpcert.pem" 
        SSLCACertificatePath "/etc/grid-security/certificates/"

        # Configure servername and admin contact here if not already in httpd.conf
        #ServerName pakiti.server.com:443
        #ServerAdmin admin@admin.com

        DocumentRoot /var/lib/pakiti2/www/pakiti
        Alias /pakiti /var/lib/pakiti2/www/pakiti

        # Uncomment to have seperate log files for pakiti
        #ErrorLog /var/log/apache2/pakiti-error
        #CustomLog /var/log/apache2/pakiti-access common
        #CustomLog /var/log/apache2/ssl_request_pakiti_log ssl_combined

        Alias /feed "/var/lib/pakiti2/www/feed"
        <Directory "/var/lib/pakiti2/www/feed">
                SSLRequireSSL
                Options +FollowSymLinks
                AllowOverride None
                Order allow,deny
                Allow from all
                DirectoryIndex index.php
        </Directory>

        Alias /link "/var/lib/pakiti2/www/link"
        <Directory "/var/lib/pakiti2/www/link">
                SSLRequireSSL
                Options +FollowSymLinks
                AllowOverride None
                Order allow,deny
                Allow from all
                DirectoryIndex index.php
        </Directory>

        <Directory "/var/lib/pakiti2/www/pakiti">
# Restrict access to this directory by your own auth mech
                SSLRequireSSL
                Options +FollowSymLinks
                AllowOverride None
                Order allow,deny
                Allow from all
                DirectoryIndex index.php
        </Directory>

</VirtualHost>

</pre>

---+++ Configure the Pakiti Server
The top level configuration of the Pakiti server can be changed in /etc/pakiti2/pakiti2-server.conf
<pre class="rootscreen">
%UCL_PROMPT_ROOT% cat /etc/pakiti2/pakiti2-server.conf
# Configuration file for the Pakiti webinterface.

# Set the parameters for connecting to
# the Pakiti database.

[mysql]
hostname = localhost
dbname   = pakiti2
username = mysql_user
password = mysql_password

[webinterface]
# URL of your local Pakiti server
url = https://pakiti.server.com
title = My_Organization
</pre>

Edit the file /var/lib/pakiti2/config/config.php and add administrators' DN's to admin_dn's array

<pre class="rootscreen">
%UCL_PROMPT_ROOT% vi /var/lib/pakiti2/config/config.php
$admin_dns = array( "/DC=org/DC=doegrids/OU=People/CN=Kevin Hill 629678" )
</pre>

---+++ Configure via web browser
Connect to your server via a web browser

Settings are devided into three sections:

---++++ !RedHat OVAL Definitions

Provide URLs to the OVAL definitions. Then you can select which one will be checked once a day for the updates. 
   * Add all OVAL definitions, including current year.
   * Manually run /var/lib/pakiti2/scripts/process_oval_rh.php to fill Pakiti database with information from all OVAL definitions
   * Afterwards you can uncheck "Check this source for updates" for prior year OVAL definitions.

---++++ Os Group Definitions

This section can be configured after all of your host (or the majority of them) report to the Pakiti server. Each host will report its OS name to the Pakiti server and in this section you can define OS groups. OS groups are used for repository definitions. Groups contain both standard repos as well as security update repos, add-on repos, etc.

 
---++++ Repositories Definitions

On the bottom of the page, there is a from with fields:

Repository Name: Put some name here, e.g. SL58.
Architecture, select for which the repository is defined. Usually there will be i686 and x86_64.
URL: Put the full path to the file which contains the list of packages provided by the repository, e.g.: http://linuxsoft.cern.ch/cern/slc54/x86_64/yum/os/repodata/primary.xml.gz
Check "Contains Security Updates", if the repository contains security updates.
Select previously created Os group for which the repository is provided.
Above the form you can see the list of Oses which does not have assigned any repository. You should create corresponding Os groups and add to them these Oses, then you can add repositories for that Os groups.


<!--
   * Set ALLOWTOPICVIEW = Main.GridGroup    
   * Set ALLOWTOPICCHANGE = Main.SecurityTeamGroup    
   * Set DENYTOPICVIEW = Main.TwikiGuest
-->



-- Main.KevinHill - 04 Oct 2012
