%META:TOPICINFO{author="JoseCaballero" date="1467653493" format="1.1" reprev="1.2" version="1.2"}%
*WARNING: THIS DOCUMENTATION IS WORK IN PROGRESS!!!*

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;width:100%}
.tg td{font-family:Arial, sans-serif;font-size:12px;padding:5px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:12px;font-weight:normal;padding:5px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-raw31s1{font-weight:bold;color:#0055ff;text-align:left;width:20%}
.tg .tg-raw32s1{text-align:left}
.tg .tg-raw33s1{text-align:left;width:30%}
.tg .tg-header{font-weight:bold;background-color:#c0c0c0;text-align:center}
.tg .tg-splitheader{font-weight:bold;background-color:#e0e0e0;text-align:center}
</style>


<!-- some useful definitions  (need 3 white spaces before * to enable it)
   * Set VERSION = 1.0.3
IMPORTANT NOTE=  The version is actually set in the "Applicable versions" section. It is hardcoded there so it can be copied by other pages.
-->

---+!! !AutoPyFactory Tools
<!--
%DOC_STATUS_TABLE%
-->
%TOC{depth="3"}%

---# About this Document

This document describes the !AutoPyFactory Tools, a set of utilities around AutoPyFactory
.
%INCLUDE{"Documentation/DocumentationTeam/DocConventions" section="Header"}%
%INCLUDE{"Documentation/DocumentationTeam/DocConventions" section="CommandLine"}%


%STARTSECTION{"Version"}%
---# Applicable versions

As the Tools evolve in a different path that !AutoPyFactory, the package has a different version number than !APF. <br>
The current version of !AutoPyFactory Tools is 1.0.3
%ENDSECTION{"Version"}%

---# Description

These Tools is a set of utilities related to !AutoPyFactory. 
Therefore, they don't perform any useful action on any host that does not have a factory instance set.
They are not, extrictly speaking, needed to run the factory, but they provide for ancillary useful commands. 

---# Deployment using RPM

These instructions assume Red Hat /
Enterprise Linux 6.x (and derivates) and the system Python 2.6.x. Other distros and higher 
Python versions should work with some extra work. 

Also, it is assumed that !AutoPyFactory has been installed.

We distribute now !AutoPyFactory Tools RPMs using the Open Science Grid (OSG) yum infrastructure. 
Install the OSG yum repo files:

<pre class="rootscreen">
%UCL_PROMPT_ROOT% rpm -Uhv  http://repo.grid.iu.edu/osg/3.3/osg-3.3-el6-release-latest.rpm
Retrieving http://repo.grid.iu.edu/osg/3.3/osg-3.3-el6-release-latest.rpm
Preparing...                ########################################### [100%]
   1:osg-release            ########################################### [100%]
</pre>

More extensive documentation on how to install the OSG yum files can be found [[https://twiki.grid.iu.edu/bin/view/Documentation/Release3/YumRepositories][here]].
                                                  
*IMPORTANT*: it may happen that a new version of !AutoPyFactory Tools is not available in the release repo, but it is in the development repo. This will happen, for example, when a bug needs to be fixed, and the new RPM is not available yet "officially" until next OSG cycle. 
Therefore, for this type of cases, you may want to enable the development repo as well, as it is disabled by default, by setting ==enabled=1== in the file =/etc/yum.repos.d/osg-el6-development.repo= :

<pre class="file">
[osg-development]
name=OSG Software for Enterprise Linux 6 - Development - $basearch
#baseurl=http://repo.grid.iu.edu/osg/3.3/el6/development/$basearch
mirrorlist=http://repo.grid.iu.edu/mirror/osg/3.3/el6/development/$basearch
failovermethod=priority
priority=98
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OSG
consider_as_osg=yes

[osg-development-source]
name=OSG Software for Enterprise Linux 6 - Development - $basearch - Source
baseurl=http://repo.grid.iu.edu/osg/3.3/el6/development/source/SRPMS
failovermethod=priority
priority=98
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OSG

[osg-development-debuginfo]
name=OSG Software for Enterprise Linux 6 - Development - $basearch - Debug
baseurl=http://repo.grid.iu.edu/osg/3.3/el6/development/$basearch/debug
failovermethod=priority
priority=98
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OSG

</pre>

To install:

<pre class="rootscreen">
%UCL_PROMPT_ROOT% yum install autopyfactory-tools
</pre>  

---# Tools

---## apf-condor-q

---## apf-condor-status

---## apf-queue-status

---## apf-simulate-scheds

---## apf-reverse-logstree

This tool creates, using links, a reverse tree structure of the factory logs directories. 
From an initial tree like this

<pre class="file">
/home/autopyfactory/factory/logs/2055-03-22/
          /ANALY_FOO/
          /FOO_PROD/
          /FOO_MCORE/
/home/autopyfactory/factory/logs/2055-03-23/
          /ANALY_FOO/
          /FOO_PROD/
          /FOO_MCORE/
/home/autopyfactory/factory/logs/2055-03-24/
          /ANALY_FOO/
          /FOO_PROD/
          /FOO_MCORE/
</pre>

it creates a simlinks structure like this:

<pre class="file">
          .../ANALY_FOO/
                  /2055-03-22/
                  /2055-03-24/
                  /2055-03-25/
          .../FOO_PROD/
                  /2055-03-22/
                  /2055-03-24/
                  /2055-03-25/
          .../FOO_MCORE/
                  /2055-03-22/
                  /2055-03-24/
                  /2055-03-25/
</pre>

Input options:

<table class="tg">
  <tr>
    <th class="tg-header">variable</th>
    <th class="tg-header">description</th>
    <th class="tg-header">comment</th>
  </tr>
<tr>
    <td class="tg-raw31s1">--basedir=&lt;dir&gt; </td>
    <td class="tg-raw32s1"> The root path to the tree with logs files.</td>
    <td class="tg-raw33s1">Optional<br> Default value is =/home/autopyfactory/factory/logs/= </td>
  </tr>
<tr>
    <td class="tg-raw31s1">--newdir=&lt;dir&gt;</td>
    <td class="tg-raw32s1"> Location where the new tree, made out of symlinks, will be created.</td>
    <td class="tg-raw33s1"> Optional <br> Default value is =/tmp/apf-reverse-logstree= </td>
  </tr>
</table>


-- Main.JoseCaballero - 03 Jul 2016
