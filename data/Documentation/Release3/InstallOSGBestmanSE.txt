%META:TOPICINFO{author="DouglasStrain" date="1318967721" format="1.1" version="1.5"}%
%META:TOPICPARENT{name="InstallBestPractices"}%
%LINKCSS%
---+!! Install !BeStMan SE 
%DOC_STATUS_TABLE%
%TOC%

---+ Installing the !BeStMan Storage Element from RPMs

This page explains how to install the stand-alone !BeStMan Storage Element server.

---++ Requirements
A RHEL5 (or !CentOS 5, SL5) machine with [[http://fedoraproject.org/wiki/EPEL][EPEL]] repos enabled.

---++ Install Instructions

%INCLUDE{"Documentation.InstallVDTRepo" headingoffset="1"}%

!GridFTP requires a certificate package to run.  If you require a specific certificate package, follow the Documentation/Release3.InstallCACerts instructions to install it.  
If you do not install a grid certificate package first, the install procedure will install one for you as part of its dependencies.  (usually osg-ca-certs).

First, you will need to install the !BeStMan Storage element meta-package.

<pre class="rootscreen">
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install osg-se-bestman
</pre> 

---+++ Configuring !GridFTP GUMS support

%INCLUDE{"InstallOSGGridFTP" section="Gums" }%

For more information on !GridFTP settings and configuration, see InstallOSGGridFTP.

---++Edit Bestman Settings

%STARTSECTION{"Settings"}%

Bestman settings and environment variables are stored in =/etc/bestman2/conf/bestman2.rc=.
You should review these settings to make sure all of them comply with your environment.
In particular, you will likely need to modify the following settings:
<pre class="file">
BESTMAN_GUMSCERTPATH=/etc/grid-security/http/httpcert.pem
BESTMAN_GUMSKEYPATH=/etc/grid-security/http/httpkey.pem
...
localPathListAllowed=/tmp
CertFileName=/etc/grid-security/http/httpcert.pem
KeyFileName=/etc/grid-security/http/httpkey.pem
GUMSserviceURL=https://GUMS_HOST:8443/gums/services/GUMSAuthorizationServicePort
</pre>

!BeStMan requires two sets of certificate pairs.  One is for host services.  When clients connect to !BeStMan,
they will receive this certificate (*CertFileName*, *KeyFileName*) as proof of the server's identity.  The second
certificate pair (*BESTMAN_GUMSCERTPATH* and *BESTMAN_GUMSKEYPATH*) 
is used to communicate with Gums when verifying identity information.  Note: these two can 
(and usually will be) the same files, but can be split if your Gums setup requires a specific identity.

*localPathListAllowed* determines which paths users will be able to access via SRM.

Modify *GUMSserviceURL* to use your local Gums installation.

%ENDSECTION{"Settings"}%

---+++ Modify =/etc/sudoers=

%STARTSECTION{"Sudoers"}%

!BeStman requires the "sudo" command in order to write information as the proper user.
You will need to give the bestman user the proper permissions to run these commands.

Modify =/etc/sudoers= and comment the following line.
<pre class="file">
#Defaults    requiretty
</pre>

Then add the following lines at the end of the =/etc/sudoers= file.
<pre class="file">
Cmnd_Alias SRM_CMD = /bin/rm, /bin/mkdir, /bin/rmdir, /bin/mv, /bin/cp, /bin/ls
Runas_Alias SRM_USR = ALL, !root
bestman   ALL=(SRM_USR) NOPASSWD: SRM_CMD
</pre>

%ENDSECTION{"Sudoers"}%


---+++ (Optional) Copying certificates to a bestman location


%STARTSECTION{"Certificate"}%

!BeStMan requires a certificate pair to function.  In order to use lcg-utils, this must be a host
certificate (rather than a service certificate).  The following shows how to copy your certificates
<pre class="rootscreen">
cp /etc/grid-security/hostkey.pem /etc/grid-security/bestman/bestmankey.pem
cp /etc/grid-security/hostcert.pem /etc/grid-security/bestman/bestmancert.pem
chown -R bestman:bestman /etc/grid-security/bestman/
</pre> 
Then modify *CertFileName*, *KeyFileName* in =/etc/bestman2/conf/bestman2.rc=.

%ENDSECTION{"Certificate"}%

---++ Starting and Stopping Services

---+++ Starting and Stopping !GridFTP

%INCLUDE{"InstallOSGGridFTP" section="Starting" }%

---+++ Starting and Stopping !BeStMan

Starting !BeStMan:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% service bestman2 start
</pre> 

Stopping !BeStMan:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% service bestman2 stop
</pre> 

---++ Screen Dump of Install Procedure 

%TWISTY{
mode="div"
showlink="Click here for a full installation example."
hidelink="Hide the example"
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
<pre class="screen">

</pre>

%ENDTWISTY% 






<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = DouglasStrain

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = Storage

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Installation
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %YES%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = NehaSharma
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %NO%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = NehaSharma
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %NO%
############################################################################################################
-->



-- Main.DouglasStrain - 29 Aug 2011

%META:TOPICMOVED{by="JamesWeichel" date="1317239617" from="Documentation.InstallOSGBestmanSE" to="Documentation/Release3.InstallOSGBestmanSE"}%
