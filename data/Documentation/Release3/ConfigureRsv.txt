%META:TOPICINFO{author="MarcoMambelli" date="1321548859" format="1.1" reprev="1.4" version="1.4"}%
%META:TOPICPARENT{name="NavTechRSV"}%
---+!! Advanced !RSV Configuration
%DOC_STATUS_TABLE%
%TOC%

<!-- conventions used in this document
   * Local GLOSSARY_RSV = [[Documentation.GlossaryR#DefsRsv][Resource and Service Validation (RSV)]]
   * Local UCL_HOST = %URLPARAM{"INPUT_HOST" encode="quote" default="rsv"}%
   * Local UCL_USER = %URLPARAM{"INPUT_USER" encode="quote" default="user"}%
   * Local UCL_DOMAIN = %URLPARAM{"INPUT_DOMAIN" encode="quote" default="opensciencegrid.org"}%
   * Set TWISTY_OPTS_DETAILED = mode="div" showlink="Show Detailed Output" hidelink="Hide" showimgleft="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" hideimgleft="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" remember="on" start="hide" 
-->

---+ About This Document
Most site administrators will be able to configure RSV by editing =/etc/osg/config.d/30-rsv.ini= and running osg-configure as described in [[InstallRSV#Configuration][the RSV installation document]].

However, if you need to do configuration beyond what osg-configure is able to do, read on...

<!-- --+ Advanced !RSV configuration -->


<!-- ---+!! Enable or disable metrics -->
%INCLUDE{"RsvControl" section="RsvEnableDisable"}%

See the [[RsvControl][rsv-control documentation]] for more options.


---+ Configure metrics

If you need to change the behavior of a metric you can edit the metric configuration files.  These replace the spec files from previous versions of RSV.
   * =/etc/rsv/metrics= - changes made to conf file in this directory named after a metric will affect the metric when run against all hosts
   * =/etc/rsv/metrics/&lt;HOST&gt;= - changes made to conf files in this directory (named as the host FQDN) will affect the metric when run against the specific host
The configuration files are in INI format and have two sections:
   * a first one named after the metric with execution options
   * a second one with the name including the "args" keyword, including parameters sent to the probe at invokation

---++ Change the times a metric runs

To change the time a metric runs set the =cron-interval= setting in the metric's conf file. Use =man 5 crontab= for a description of the format.  For example, to change the org.osg.general.ping-host to run at a different time: <pre class="file">
[org.osg.general.ping-host]
cron-interval = 45 * * * *

[org.osg.general.ping-host args]
#ping-count =
#ping-timeout =
</pre>

%NOTE% Be sure to put the =cron-interval= setting in the [org.osg.general.ping-host] section, and not the [org.osg.general.ping-host args] section!  The purpose of the "args" section is described below.

After modifying the cron time of a metric you must restart RSV for the change to take effect.

To see what times each of the metrics is running you can use rsv-control, e.g.: <pre class="screen"># rsv-control -l --cron-times

Metrics enabled for host: osg-edu.cs.wisc.edu:10443       | Cron times         
----------------------------------------------------------+--------------------
org.osg.srm.srmcp-readwrite                               | 28 * * * *         
org.osg.srm.srmping                                       | 13,33,53 * * * *   
...
</pre>


---++ Pass extra parameters to a metric

Any key=value pairs in the 'args' section of the metric's _conf_ file will be turned into command line parameters to the probe.  For example, for this file: <pre class="file">
[org.osg.certificates.cacert-expiry args]
warning-hours = 6
error-hours = 12
</pre>
This would convert to =--warning-hours 6 --error-hours 12=

---+ Configure consumers:
=/etc/rsv/consumers.conf= is a file in INI format and possible entries are:
| *Setting* | *Values* | *Details* |
| enabled | &lt;consumers&gt; | Comma-separated list of consumers to be enabled |
| timestamp | local | If this is set to local, a record with a local timestamp will be supplied to the consumer.  If this is set to any other value, or is not set, a record with the GMT will be created. |

---+ Options in rsv.conf:
=/etc/rsv/rsv.conf=  is a file in INI format and possible entries are:
| *Setting* | *Values* | *Details* |
| user | &lt;username&gt; | The UNIX username that owns RSV.  This is mandatory |
| service-cert | &lt;path&gt; | Absolute path to the service certificate file.  If this is set service-key and service-proxy must also be set. |
| service-key | &lt;path&gt; | Absolute path to the service key file.  This must be used with service-cert. |
| service-proxy | &lt;path&gt; | Absolute path where the service proxy will be generated.  This must be used with service-cert. |
| proxy-file | &lt;path&gt; | Alternative to service-cert.  The absolute path where the user proxy file is located.  This will not be auto-regenerated. |
| details-data-trim-length | &lt;integer&gt; | The number of bytes to trim the detailsData section to.  If set to 0 no trimming will occur. |
| job-timeout | &lt;integer&gt; | Time in seconds before a metric is killed.  A metric that times out will return a CRITICAL status. |
| extra-globus-rsl | &lt;string&gt; | Extra RSL to pass to globus-job-run commands. %BR% For example, this would add an RSVJob attribute to a Condor classad (include the quotes): "&(condorsubmit=('+RSVJob' 'True'))" |
| use-condor-g | True or False | Defaults to True.  If this is true, Condor-G will be used to run grid metrics.  If this is False, globus-job-run will be used to run grid metrics. |

---+ References
RSV documents
   * A [[NavTechRSV][Introduction to RSV]]
   * The [[RsvArchitecture][RSV architecture]]
   * InstallRSV

---+ Comments
%COMMENT{type="tableappend"}%


<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = ScotKronenfeld

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|General|Integration|Monitoring|Operations|Security|Storage|Tier3|User|VO)
   * Local DOC_AREA       = General

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (Developer|Documenter|Scientist|Student|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (HowTo|Installation|Knowledge|Navigation|Planning|Training|Troubleshooting)
   * Local DOC_TYPE       = Installation
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %NO%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %NO%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = MarcoMambelli
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %IN_PROGRESS%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = MarcoMambelli
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %IN_PROGRESS%
############################################################################################################
-->

-- Main.ScotKronenfeld - 03 Sep 2010

%META:TOPICMOVED{by="MarcoMambelli" date="1321404495" from="Documentation/Release3.ConfigureRSV" to="Documentation/Release3.ConfigureRsv"}%
