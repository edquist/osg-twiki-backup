%META:TOPICINFO{author="BrianLin" date="1489023689" format="1.1" reprev="1.11" version="1.11"}%
<style type="text/css">
code em, pre em { color: red; font-weight: normal; font-style: normal; }
</style>

---+ Configuring a Site to Use the Worker Node Client Software From OASIS
%TOC%

---++ About This Guide

The _OSG Worker Node Client_ is a collection of software components that is expected to be added to every worker node that can run OSG jobs. It provides a common environment and a minimal set of common tools that all OSG jobs can expect to use. See the [[#ReferenceSection][reference section]] below for contents of the Worker Node Client.

It is possible to install the Worker Node Client software in a variety of ways, depending on what works best for distributing and managing software at your site:

   * Use the Worker Node Client software from OASIS (this guide) - useful when [[NavTechOASIS][OASIS]] is already mounted on your worker nodes
   * [[InstallWNClient][Install using RPMs and Yum]] - useful when managing your worker nodes with a tool (e.g., Puppet, Chef) that can automate RPM installs
   * [[InstallWNClientTarball][Install using a tarball]] - useful when installing onto a shared filesystem for distribution to worker nodes

This document is intended to guide system administrators through the process of configuring a site to make the Worker Node Client software available from OASIS.

---++ Before Starting

As with all OSG software installations, there are some one-time (per host) steps to prepare in advance:

   * Ensure the host has [[SupportedOperatingSystems][a supported operating system]]

Also note that, once configured to use OASIS, each use of Worker Node Client software will cause that software and its associated files to be downloaded from a CVMFS server or your local cache thereof. This may result in extra network activity, especially if Worker Node Client tools are used heavily.

---++ Configuring Your Site to Use the Worker Node Client From OASIS

Below are the one-time steps that you must perform to configure your site to use the Worker Node Client software from OASIS.

<ol>
  <li><p>On every worker node, [[InstallCvmfs][install and configure OASIS]] </p></li>
  <li>
    <p>Determine the OASIS path to the Worker Node Client software for your worker nodes:</p>
%TABLE{sort="off"}%
| *Worker Node OS* | *Use&hellip;* |
| EL&nbsp;6 (32-bit) | =/cvmfs/oasis.opensciencegrid.org/osg-software/osg-wn-client/3.3/current/el6-i386= |
| EL&nbsp;6 (64-bit) | =/cvmfs/oasis.opensciencegrid.org/osg-software/osg-wn-client/3.3/current/el6-x86_64= |
| EL&nbsp;7 (64-bit) | =/cvmfs/oasis.opensciencegrid.org/osg-software/osg-wn-client/3.3/current/el7-x86_64= |
  </li>
  <li>
    <p>On the CE, in the =/etc/osg/config.d/10-storage.ini= file, set the =grid_dir= configuration setting to the path from the previous step</p>
    <p>For more information, see the [[EnvironmentVariables][OSG environment variables reference page]] and the [[IniConfigurationOptions#Storage][CE configuration instructions]].</p>
  </li>
  <li>
    <p>Once you finish making changes to configuration files on your CE, validate, fix, and apply the configuration:</p>
    <pre class="rootscreen">%UCL_PROMPT_ROOT% osg-configure -v
%UCL_PROMPT_ROOT% osg-configure -c</pre>
  </li>
</ol>

---++ Validating the Worker Node Client

To verify functionality of the worker node client, you will need to submit a test job against your CE and verify the job's output.

   1. Submit a job that executes the =env= command (e.g. Run [[TroubleshootingHTCondorCE#condor_ce_trace][condor_ce_trace]] with the =-d= flag from your HTCondor CE)
   1. Verify that the value of =OSG_GRID= is set to the directory of your WN Client installation

---+++ Manually Using the Worker Node Client From OASIS

If you must log onto a worker node and use the Worker Node Client software directly during your login session, consult the following table for the command to set up your environment:

%TABLE{sort="off"}%
| *Worker Node OS* | *Run the following command&hellip;* |
| EL&nbsp;6 (32-bit) | =source /cvmfs/oasis.opensciencegrid.org/osg-software/osg-wn-client/3.3/current/el6-i386/setup.sh= |
| EL&nbsp;6 (64-bit) | =source /cvmfs/oasis.opensciencegrid.org/osg-software/osg-wn-client/3.3/current/el6-x86_64/setup.sh= |
| EL&nbsp;7 (64-bit) | =source /cvmfs/oasis.opensciencegrid.org/osg-software/osg-wn-client/3.3/current/el7-x86_64/setup.sh= |

---++ Troubleshooting

Some possible issues that may come up:

   * A missing softlink to the CA certs directory. To check this, run:\
      <pre class="screen">ls -l /cvmfs/oasis.opensciencegrid.org/mis/osg-wn-client/3.3/current/el6-x86_64/etc/grid-security/</pre>\
      <p>and check that =certificates= is linked to somewhere. The fix is to yum update the =oasis-config= package to version 4 or higher. A known workaround is to run:</p>\
      <pre class="screen">export X509_CERT_DIR=/cvmfs/oasis.opensciencegrid.org/mis/certificates</pre>\
      <p>before any commands.</p>

---++ How to get Help?
To get assistance please use this [[HelpProcedure][Help Procedure]].

#ReferenceSection
---++ Reference

Please see the documentation on using [[Documentation/Release3.YumRpmBasics][yum and RPM]], [[Documentation/Release3.InstallBestPractices][the best practices]] for using yum to install software, and using [[Documentation/Release3.YumRepositories][yum repositories]].

#WnContents
---+++ Worker node contents
%INCLUDE{"Documentation/Release3/InstallWNClient" section="WnContents"}%

