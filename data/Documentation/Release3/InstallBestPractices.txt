%META:TOPICINFO{author="JamesWeichel" date="1317239852" format="1.1" version="1.6"}%
---+!! *Installation Best Practices*
%DOC_STATUS_TABLE%
%TOC%

---++ About This Document
This document covers best practices to be used in installing software packages or security certificates on large numbers of hosts.  It assumes you understand [[Documentation/Release3.YumRpmBasics][YUM/RPM Basics]] and [[Documentation/Release3.YumRepositories][YUM Repositories]].

---++ Repository Mirrors

A local yum mirror allows you to reduce the amount of external bandwidth used when updating or installing packages.

Add the following to a file in =/etc/cron.d=:

<pre class="screen">
%RED%RANDOM%ENDCOLOR% * * * * root rsync -art rsync://repo.grid.iu.edu::osg-development/osg-development /var/www/html/osg-development/
</pre>

Replace %RED%RANDOM%ENDCOLOR% with a number between 0 and 59.  Replace the 

On your worker node, you can replace the =baseurl= line of =/etc/yum.repos.d/osg.repo= with the appropriate URL for your mirror.

If you are interested in having your mirror be part of the OSG's default set of mirrors, [[https://ticket.grid.iu.edu/][please file a GOC ticket]].

---++ Considerations for Large Sites

While =yum= is a wonderful tool for installing software on a single server, it's a poor tool to install the same version of the software on many hosts.  We *strongly* recommend a cluster management tool; as far as we know, all cluster management tools provide a mechanism to create a local yum repository and have all your worker nodes use that.

If you have more than 20 worker nodes, we have the following advice:
   * Do *not* use one of the OSG repositories directly for worker node installations; build a local mirror instead.
   * Distribute CRLs to the worker nodes using an HTTP proxy.
Both items are covered in this document.

In the future, we will be providing a mechanism for distributing CAs and CRLs via a shared file system; this is not quite finished.  If you choose to do this, remember that your security infrastructure will only be as safe and reliable as the shared filesystem!

---++ CA Certificate Installation Considerations

CAs are distributed in two ways:
   * As an RPM that contains the set of CAs.  There are several such RPMs corresponding to different sets of CAs.
   * Through direct downloads from GOC with the =osg-update-certs= tool (provided by the =osg-ca-scripts= RPM).

As long as you use one of these two mechanisms, the OSG software will install successfully.

---++ Certificate Revocation List (CRL) Installation/Update

CRLs are not distributed via =yum=.  Instead, we provide the =fetch-crl= tool that downloads CRLs to the CA directory.

By default, =fetch-crl= connects directly to the remote CA; it is inefficient and potentially harmful if done simultaneously by many worker nodes.  We recommend you provide a HTTP proxy the worker nodes can connect to.  To configure fetch-crl to use an HTTP proxy server, create the file  =/etc/sysconfig/fetch-crl= and add the following line:

<pre class="file">
export http_proxy=http://your.squid.fqdn
</pre>
Adjust the URL appropriately for your proxy server.

---++ Removing Large numbers of RPMs

Note that, in general, there is no mechanism to reverse a =yum install= command in RHEL5.  Plan accordingly.

We have prepared a [[RemoveOSGComponents][special yum plugin]], =yum-remove-osg=, to assist in removing OSG RPMs.

To re-iterate: just because it removes most/all of the OSG RPMs, =yum remove= is not guaranteed to be a perfect reversal of =yum install= (things like post-scripts have side-effects that must be taken into account; these are not in general reversible).  On the upside, removal of the RPMs will be "good enough" for many sites.

If you need a bit-for-bit, exact replica of your system prior to the upgrade, you'll want to use a backup strategy and restore from backup.

---++ Comments
%COMMENT{type="tableappend"}%

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = BrianBockelman

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = ComputeElement

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Installation
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %NO%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %NO%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank you for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = SuchandraThapa
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %NO%


 DEAR DOCUMENT TESTER
 ======================

 Thank you for testing this document! Please fill in your FirstLast name here:
   * Local TESTER       = FirstLast
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED  = %NO%

############################################################################################################
-->
-- Main.JamesWeichel - 29 Aug 2011

%META:TOPICMOVED{by="JamesWeichel" date="1314720243" from="Documentation.Rel3InstallBestPractices" to="Documentation/Release3.InstallBestPractices"}%
