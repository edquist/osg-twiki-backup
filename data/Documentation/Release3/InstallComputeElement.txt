%META:TOPICINFO{author="NehaSharma" date="1319748430" format="1.1" reprev="1.25" version="1.25"}%
%META:TOPICPARENT{name="InstallBestPractices"}%
%DOC_STATUS_TABLE%

---+!! Installing the Compute Element
%TOC%

---+ Requirements
A RHEL5 (or !CentOS 5, SL5) machine with [[http://fedoraproject.org/wiki/EPEL][EPEL]] repos enabled.

%INCLUDE{"YumRepositories" section="OSGRepoBrief" TOC_SHIFT="+"}%
%INCLUDE{"InstallCertAuth" section="OSGBriefCaCerts" TOC_SHIFT="+"}%

---+ Install the CE
   1 Install the CE RPM.  Do *ONE* of the following installation lines, depending on your batch system  <pre class="rootscreen">
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install osg-ce-condor 
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install osg-ce-pbs 
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install osg-ce-lsf 
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install osg-ce-sge
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install osg-ce</pre>
The last one configures Globus to use the fork job manager.
To install managedfork, do the following:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install globus-gram-job-manager-managedfork
</pre>

#ConfigureCE
---+ Configuration Instructions

---++ Run =osg-configure=

Edit the files in =/etc/osg/config.d=, then run this command to check that your configuration looks good

<pre class="rootscreen">
%UCL_PROMPT_ROOT% osg-configure -v
</pre>

Then run this command to configure your CE.

<pre class="rootscreen">
%UCL_PROMPT_ROOT% osg-configure -c 
</pre>

More documentation will go here soon, including hints on how to use your old config.ini file if you like. 

---++ Globus Gatekeeper

Installing the above packages will result in the Globus gatekeeper being installed and enabled as well as the appropriate jobmanager being installed and configured. To turn on the Globus gatekeeper:

<pre class="rootscreen">
%UCL_PROMPT_ROOT% /sbin/service globus-gatekeeper start
Started globus-gatekeeper                                  [  %GREEN%OK%ENDCOLOR%  ]
</pre>

---++ Condor-specific notes

   * The Condor jobmanager is configured to not use a shared file system.  There are some rare use cases where this break; if you think this is causing issues, set =isNFSLite=0= in =/etc/globus/globus-condor.conf=.
   * You can control the mapping of jobs to Condor accounting groups using the files =/etc/osg/extattr_table.txt= and =/etc/osg/uid_table.txt=.  See the OSG's documentation on group accounting for more information.

---++ Authorization

---+++ Authorization Option #1: GUMS

   * Edit =/etc/lcmaps.db= (modify value passed to argument "--endpoint") and =/etc/gums/gums-client.properties= (change both gums.location and gums.authz entries) to reflect your GUMS server
   * Uncomment the single line in =/etc/grid-security/gsi-authz.conf=

---+++ Authorization Option #2: edg-mkgridmap

   * Edit =/etc/edg-mkgridmap.conf=
   * <pre class="rootscreen">%UCL_PROMPT_ROOT% /sbin/service edg-mkgridmap start</pre>

edg-mkgridmap is a cron job, but you control whether it runs or not using an init script, as shown above. 

---++ Gratia

   * Edit /etc/gratia/[jobmanger-you-are-using]/ProbeConfig, configuring it like an existing CE.  Make sure you set !EnableProbe="1", otherwise the probe will never run.
   * This will be performed by a near-future configure-osg.

---++ CEMon

Make sure =/etc/grid-security/grid-mapfile= exists, even if it is empty (i.e. =touch /etc/grid-security/grid-mapfile=).

You can either use the httpcert/httpkey or hostcert/hostkey. However, make sure the "tomcat" user has access to whichever cert/key pair you decide to use. 
You can use the hostcert/key as follows

<pre class="rootscreen">
mkdir /etc/grid-security/http
cp /etc/grid-security/hostkey.pem /etc/grid-security/http
cp /etc/grid-security/hostcert.pem /etc/grid-security/http
chown -R tomcat:tomcat /etc/grid-security/http
chmod 0400 /etc/grid-security/http/hostkey.pem
</pre>

Make a directory for the GIP to use:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% mkdir /var/gip
%UCL_PROMPT_ROOT% mkdir /var/gip/tmp
</pre>

---++ Other

Run =gums-host-cron= by hand once:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% gums-host-cron
</pre>

---+ Start Services

<pre class="rootscreen">
%UCL_PROMPT_ROOT% /sbin/service fetch-crl-cron start
%UCL_PROMPT_ROOT% /sbin/service fetch-crl-boot start
%UCL_PROMPT_ROOT% /sbin/service condor start # Replace with batch system of your choice
%UCL_PROMPT_ROOT% /sbin/service globus-gatekeeper start
%UCL_PROMPT_ROOT% /sbin/service globus-gridftp-server start
%UCL_PROMPT_ROOT% /sbin/service tomcat5 start  # Tomcat is used for CEMon
%UCL_PROMPT_ROOT% /sbin/service gums-client-cron start
</pre>

Run 'chkconfig <service-name> on' command for any services that you want to start automatically after system reboot.

---+ Stop Services

Run following commands, only if you need to stop any services.

<pre class="rootscreen">
%UCL_PROMPT_ROOT% /sbin/service fetch-crl-cron stop
%UCL_PROMPT_ROOT% /sbin/service fetch-crl-boot stop
%UCL_PROMPT_ROOT% /sbin/service condor stop # Replace with batch system of your choice
%UCL_PROMPT_ROOT% /sbin/service globus-gatekeeper stop
%UCL_PROMPT_ROOT% /sbin/service globus-gridftp-server stop
%UCL_PROMPT_ROOT% /sbin/service tomcat5 stop  # Tomcat is used for CEMon
%UCL_PROMPT_ROOT% /sbin/service gums-client-cron stop
</pre>
---+ References

---+ Comments
%COMMENT{type="tableappend"}%

%META:TOPICMOVED{by="MarcoMambelli" date="1318875735" from="Documentation/Release3.InstallCE" to="Documentation/Release3.InstallComputeElement"}%
