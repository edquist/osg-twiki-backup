%META:TOPICINFO{author="MatyasSelmeci" date="1316737501" format="1.1" reprev="1.12" version="1.12"}%
%META:TOPICPARENT{name="RPMTempDocuments"}%
%LINKCSS%

---+ Installing the CE from RPMs

---++ Requirements
A RHEL5 (or !CentOS 5, SL5) machine with [[http://fedoraproject.org/wiki/EPEL][EPEL]] repos enabled.

---++ Install Instructions

%INCLUDE{"InstallVDTRepo" headingoffset="1"}%
%INCLUDE{"InstallCACerts" headingoffset="1"}%
   1 Install the Sun/Oracle JDK. This step must be done manually, since the JDK RPMs are not signed and so GPG checking must be disabled for their installation. <pre class="rootscreen">
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing --nogpgcheck install jdk</pre>
   1 Install the CE RPM.  Do *ONE* of the following installation lines, depending on your batch system  <pre class="rootscreen">
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install osg-ce-condor 
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install osg-ce-pbs 
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install osg-ce-lsf 
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install osg-ce-sge
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install osg-ce</pre>
The last one configures Globus to use the fork job manager.
To install managedfork, do the following:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install globus-gram-job-manager-managedfork
</pre>

---++ Configuration Instructions

As =configure-osg= is made to understand the new RPM structure, the number of manual steps will decrease. 

---+++ Config.ini

Generate an appropriate =config.ini=, based on the pacman docs.

---+++ Globus Gatekeeper

Installing one of the globus-gram-job-manager packages will automatically configure the gatekeeper to use that jobmanager. For reference, to manually turn on a default jobmanager, do the following:

Traditionally in the OSG, the default jobmanager is fork:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% globus-gatekeeper-admin -e jobmanager-fork -n jobmanager
</pre>

If you want to use managed-fork, do the following:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% globus-gatekeeper-admin -d jobmanager-fork
%UCL_PROMPT_ROOT% globus-gatekeeper-admin -e jobmanager-managedfork -n jobmanager
%UCL_PROMPT_ROOT% globus-gatekeeper-admin -e jobmanager-managedfork -n jobmanager-fork
</pre>
This should still be execute prior to the batch-system-specific service addition.

---+++ Condor-specific notes

   * The Condor jobmanager is configured to not use a shared file system.  There are some rare use cases where this break; if you think this is causing issues, set =isNFSLite=0= in =/etc/globus-condor/jobmanager.conf=.
   * You can control the mapping of jobs to Condor accounting groups using the files =/etc/osg/extattr_table.txt= and =/etc/osg/uid_table.txt=.  See the OSG's documentation on group accounting for more information.

---+++ Authorization

---++++ Authorization Option #1: GUMS

   * Edit =/etc/lcmaps.db= and =/etc/gums/gums-client.properties= to reflect your GUMS server
   * Uncomment the single line in =/etc/grid-security/gsi-authz.conf=.

---++++ Authorization Option #2: edg-mkgridmap

   * Edit /etc/edg-mkgridmap.conf
   * <pre class="rootscreen">%UCL_PROMPT_ROOT% /sbin/service edg-mkgridmap start</pre>

edg-mkgridmap is a cron job, but you control whether it runs or not using an init script, as shown above. 

---+++ Gratia

   * Add ProbeConfig, configuring it like an existing CE.  Make sure you set EnableProbe="1"
   * This will be performed by a near-future configure-osg.

---+++ Other

Run =gums-host-cron= by hand once:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% gums-host-cron
</pre>

---++ Services to enable

<pre class="rootscreen">
%UCL_PROMPT_ROOT% service fetch-crl-cron start
%UCL_PROMPT_ROOT% service fetch-crl-boot start
%UCL_PROMPT_ROOT% service condor start # Replace with batch system of your choice
%UCL_PROMPT_ROOT% service globus-gatekeeper start
%UCL_PROMPT_ROOT% service osg-info-services start
</pre>

Do the relevant =chkconfig=, of course.

---++ Things left undocumented

   * =gums-host-cron= should be init based like the other cron jobs.  There is an open ticket for this.
