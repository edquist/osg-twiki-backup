%META:TOPICINFO{author="LincolnBryant" date="1436472608" format="1.1" reprev="1.1" version="1.1"}%
<style type="text/css">
code em, pre em { color: red; font-weight: normal; font-style: normal; }
</style>

---+ Installing !StashCache

%TOC{depth="3"}%

---++ About This Guide

[fill me in]

---++ Before Starting

Before starting the installation process, consider the following points (consulting [[#ReferenceSection][the Reference section below]] as needed):

   * *User IDs:* If they do not exist already, the installation will create the Linux user IDs =condor= and =xrootd=
   * *Service certificate:* The !StashCache service uses a host certificate at =/etc/grid-security/host*.pem=
   * *Network ports:* The !StashCache service must talk to the central collector on port 9619 (TCP) and !XRootD services on port 1094 (TCP)
   * *Hardware requirements:* We recommend that a !StashCache server has at least 10Gbps connectivity, 1TB of disk space, and 8GB of RAM.

As with all OSG software installations, there are some one-time steps to prepare in advance:

   * Ensure the host has [[SupportedOperatingSystems][a supported operating system]]
   * Obtain root access to the host
   * Prepare [[YumRepositories][the required Yum repositories]]
   * Install [[InstallCertAuth][CA certificates]]


---++ Installing the !StashCache daemon

The !StashCache daemon consists of an !XRootD server and an HTCondor-based service for collecting and reporting statistics about the cache. To simplify installation, OSG provides convenience RPMs that install all required software with a single command.

<ol>
%INCLUDE{"Documentation/Release3/OSGReleaseSeries" section="Update"}%
  <li>
    <p>Install the !StashCache metapackage:</p>
    <pre class="rootscreen">%UCL_PROMPT_ROOT% yum install stashcache-daemon stashcache-cache-server</pre>
  </li>
</ol>

---++ Configuring !StashCache

---+++ Modifying the !XRootD configuration
This document assumes you will be configuring a !StashCache server to cache files locally, rather than serving files to the federation. It is additionally assumed that the cache directory is mounted at =/stash=

Files in !StashCache are served by the !XRootD daemon. First, you will need to modify the !XRootD system configuration such that it points to the configuration file provided by the =stashcache-cache-server= package. Edit =/etc/sysconfig/xrootd= and change the line 

<pre class="file">
XROOTD_DEFAULT_OPTIONS="-l /var/log/xrootd/xrootd.log -c /etc/xrootd/xrootd-clustered.cfg -k fifo"
</pre>

with the following:

<pre class="file">
XROOTD_DEFAULT_OPTIONS="-l /var/log/xrootd/xrootd.log -c /etc/xrootd/xrootd-stashcache-cache-server.cfg -k fifo"
</pre>

---+++ Enable services
Ensure that your =/stash= disk is mounted, and then start the =xrootd= and =condor= services:

<pre class="rootscreen">%UCL_PROMPT_ROOT% chkconfig xrootd on; chkconfig condor on</pre>
<pre class="rootscreen">%UCL_PROMPT_ROOT% service xrootd start; service condor start</pre>
  

---++ Optional configuration
---+++ Adjust disk utilization
You may want to adjust the disk utilization of your !StashCache cache. To do so, modify the following line in =/etc/xrootd/xrootd-stashcache-cache-server.cfg=:
<pre class="file">
pfc.diskusage 0.98 .99
</pre>

The two values define the low and high watermarks, respectively. The !XRootD service will automatically purge cache objects down to the low watermark. 


---++ Validating !StashCache


---++ Troubleshooting !StashCache

---++ Getting Help

To get assistance, please use the [[Documentation.HelpProcedure][this page]].


#ReferenceSection
---++ Reference

Here are some other !StashCache documents that might be helpful:

---+++ Configuration

The following directories contain the configuration for !StashCache.

---+++ Users

---+++ Certificates

---+++ Networking


-- Main.LincolnBryant - 09 Jul 2015
