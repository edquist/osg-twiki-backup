%META:TOPICINFO{author="TimCartwright" date="1472756861" format="1.1" reprev="1.2" version="1.2"}%
*TODO:*
   * Does rsv-gwms-tester require glideinwms-userschedd at runtime? condor-cron?
   * Write useful comments in /etc/rsv/metrics/org.osg.local-gfactory-site-querying-local.conf
   * Example of glidecondor_addDN command?
   * How often will the probes run?
   * How to view results?
   * What to do if results are not perfect?



<style type="text/css">
code strong, pre strong { color: red; font-weight: normal; font-style: normal; }
pre[class="rootscreen"] em { background-color: #FFFF00; font-weight: normal; font-style: normal; }
pre[class="file"] em { background-color: #FFCCFF; font-weight: normal; font-style: normal; }
</style>


---+ Installing and Using the RSV !GlideinWMS Tester

%TOC{depth="3"}%


---++ About This Guide

The RSV !GlideinWMS Tester (or _Tester_, in this document) is a tool that a VO front-end administrator can use to test remote sites for the ability to run the VO&rsquo;s jobs. It is particularly useful when setting up a VO for the first time or when changing the sites at which a VO&rsquo;s jobs can run. For a site to pass the test, it must successfully run a simple test job via the normal !GlideinWMS mechanisms, in much the same way as a real VO job.

Use this page to learn how to install, configure, and use the Tester for your VO front-end.


---++ Before Starting

Before starting the installation process, consider the following points (consulting [[#ReferenceSection][the Reference section below]] as needed):

   * *Software:* You must have [[InstallGlideinWMSFrontend][a GlideinWMS Front-end]] installed
   * *Configuration:* The !GlideinWMS Front-end must be configured to have at least one group that matches pilots to sites using DESIRED_SITES, and to support the is_itb user job attribute
   * *Host choice:* The Tester should be installed on the same host as your !GlideinWMS Front-end
   * *Service certificate:* The Tester requires a host certificate at =/etc/grid-security/host*.pem=
   * *Network ports:* Test jobs must be able to contact HTCondor on ports 9615 (TCP), and you must be able to contact a web server on port 80 (TCP) to view test results

As with all OSG software installations, there are some one-time (per host) steps to prepare in advance:

   * Ensure the host has [[SupportedOperatingSystems][a supported operating system]]
   * Obtain root access to the host
   * Prepare [[YumRepositories][the required Yum repositories]]
   * Install [[InstallCertAuth][CA certificates]]


---++ Installing the Tester

The Tester software takes advantage of several other OSG software components, so the installation will add OSG&rsquo;s site validation system (RSV) and the !GlideinWMS pilot submission software if not present already.

<ol>
  <li>
    <p>Install the software:</p>
    <pre class="rootscreen">%UCL_PROMPT_ROOT% yum install rsv-gwvms-tester glideinwms-userschedd</pre>
  </li>
</ol>


---++ Configuring the Tester

Before you use the Tester, there are some one-time configuration steps to complete.

   1. <p>Configure <span style="color: red; weight: 900;">XXXXX</span> in the =/etc/rsv/metrics/org.osg.local-gfactory-site-querying-local.conf=</p>
   1. <p>Authorize your central manager to <span style="color: red; weight: 900;">do what?</span>:\
      <pre class="rootscreen">%UCL_PROMPT_ROOT% glidecondor_addDN -allow-others -daemon '<em>Central_Manager_DN</em>' '<em>/the/central/manager/DN</em>' condor</pre>
   1. <p>Copy your HTCondor configuration to the special HTCondor instance that RSV uses:</p>\
      <pre class="rootscreen">%UCL_PROMPT_ROOT% cp /etc/condor/config.d/* /etc/condor-cron/config.d/</pre>
   1. <p>Configure the special HTCondor-RSV instance with your host IP address</p>\
      <p>Create the new file =/etc/condor-cron/config.d/98_public_interface.config= with this content:</p>\
      <pre class="file">NETWORK_INTERFACE = <em>ADDRESS</em></pre>\
      <p>Where =ADDRESS= is the IP address of your Tester host</p>
   1. <p>Enable and activate the Tester&rsquo;s RSV probe:</p>\
      <pre class="rootscreen">%UCL_PROMPT_ROOT% rsv-control --enable org.osg.local-gfactory-site-querying-local --host <em>ADDRESS</em>
%UCL_PROMPT_ROOT% rsv-control --on org.osg.local-gfactory-site-querying-local --host <em>ADDRESS</em></pre>\
      <p>Where =ADDRESS= is the IP address of your Tester host</p>


---++ Using the Tester

There are at least two aspects of using the Tester:

   * Managing the services that are associated with the Tester software
   * Viewing results from the Tester

---+++ Managing Tester services

Because the Tester is built on other OSG software, there are a number of services in your installation. The specific services are:

%TABLE{sort="off"}%
| *Software* | *Service name* | *Notes* |
| Apache HTTP Server | =httpd= | Web server for results |
| HTCondor-Cron | =condor-cron= | cron-like jobs in HTCondor |
| RSV | =rsv= | OSG site validator |

Start the services in the order listed and stop them in reverse order. As a reminder, here are common service commands (all run as =root=):

%TABLE{sort="off"}%
| *To &hellip;* | *Run the command &hellip;* |
| Start a service | =service <em>SERVICE-NAME</em> start= |
| Stop a service | =service <em>SERVICE-NAME</em> stop= |
| Enable a service to start during boot | =chkconfig <em>SERVICE-NAME</em> on= |
| Disable a service from starting during boot | =chkconfig <em>SERVICE-NAME</em> off= |

---+++ Viewing Results

<span style="color: red; weight: 900;">NEED CONTENT</span>


---++ Getting Help

To get assistance, please use the [[Documentation.HelpProcedure][this page]].


---++ Reference

---+++ Certificates

%STARTSECTION{"Certificates"}%
| *Certificate* | *User that owns certificate* | *Path to certificate* |
| Host certificate | =root= | =/etc/grid-security/hostcert.pem= <br> =/etc/grid-security/hostkey.pem= |

Find instructions to request a host certificate [[Documentation/Release3.GetHostServiceCertificates][here]].
%ENDSECTION{"Certificates"}%

---+++ Networking

%STARTSECTION{"Firewalls"}%
%INCLUDE{"FirewallInformation" section="FirewallTable" lines="condorscheddshared,rsvin"}%

%ENDSECTION{"Firewalls"}%
