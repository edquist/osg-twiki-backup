%META:TOPICINFO{author="BrianLin" date="1479254552" format="1.1" reprev="1.3" version="1.3"}%
---+ Introduction to Gratia Accounting

%TOC{depth="3"}%

---++ About This Guide

This document serves as an introduction to the Gratia accounting ecosystem.

---++ Gratia: The big picture

Gratia is software used in OSG to gather accounting information. The information is collected from individual resources at a site, such as a Compute Element or a Storage Element. The program that collects the data is called a "Gratia probe". The information is transfered to a Gratia server. Most sites will choose to send the accounting data to the central OSG Gratia server, but you can also use a Gratia server at your site (which can send forward the data to the central OSG Gratia server). Here is a diagram:

<img src="%ATTACHURLPATH%/gratia-basics.png" alt="gratia-basics.png" />    

These are the definitions of the major elements in the above figure.

   * *Gratia probe*: A piece of software that collects accounting data from the computer on which it's running, and transmits it to a Gratia server.
   * *Gratia server*: A server that collects Gratia accounting data from one or more sites and can share it with users via a web page. 
   * *Reporter*: A web service running on the Gratia server. Users can connect to the reporter via a web browser to explore the Gratia data.
   * *Collector*: A web service running on the Gratia server that collects data from one or more Gratia probes. Users do not directly interact with the collector.

You can see the OSG's Gratia reports at [[http://gratia-osg-prod-reports.opensciencegrid.org/gratia-reporting/][the central OSG Gratia server]].

You can see a fancier version of the Gratia data at [[http://display.grid.iu.edu/][display.grid.iu.edu]]. This is *not* running a Gratia collector, but is a separate service. 

---+++ Gratia Probes
Currently, there are 15 probes that can report to Gratia. The probes could be subdivided into several major categories:
   1. __Local Batch System probes:__ A probe specific to  to the type of site's batch system is running at each grid site. It collects information about finished jobs. Condor, Torque(PBS), LSF, SGE and Slurm Batch Systems are supported. The probes are installed with installation of a Compute Element.
   1. __Transfer probes:__. A probe collects information about the file transfers from/to Storage installed at each grid site. !GridFTP, !dCache, xrootd, hadoop transfer probes are supported. A probe is installed with installation of a Storage Element.
   1. __Storage probes:__.A probe gathers information about physical and logical pools utilization of a Storage installed at each grid site.   dCache, xrootd, hadoop storage probe are supported. A probe is installed with installation of a Storage Element.
   1. __Worker Node probes:__.The probes that  may be installed on a worker node are ps-accounting probe and glexec probes. ps-accounting probe collects unix accounting information about finished processes ran by user. Glexec probe reports information about identity  of the user running jobs via glidein pilot. More information about glexec could be found [[InstallGlexec][here]].

---++ Gratia
Gratia is used for accounting of jobs and data transfers in OSG. There are individual _Gratia probes_ at sites that collect data as well as _Gratia services_ that collect data. The data is sent to a _Gratia service_ (aka _Collector_), by default to the central Gratia service maintained by OSG.

The information stored in Gratia can be accessed using web clients like the the [[http://display.grid.iu.edu/][OSG Display]] or [[http://gratiaweb.grid.iu.edu/][Gratia-Webtool]]. Otherwise you can subscribe to the regular [[Accounting.ReportsDescription][Email reports]].

#ReferenceSection
---++ Reference

   * [[Documentation.Release3/InstallGratia_DRAFT][Installing and Maintaining Gratia Probes]]
   * [[Documentation.Release3/TroubleshootingGratia_DRAFT][Troubleshooting Gratia Probes]]
   * [[Documentation.Release3/GratiaReference_DRAFT][Gratia Probe Reference]]

%META:FILEATTACHMENT{name="gratia-basics.png" attachment="gratia-basics.png" attr="h" comment="" date="1479158384" path="gratia-basics.png" size="28705" stream="gratia-basics.png" tmpFilename="/usr/tmp/CGItemp44201" user="BrianLin" version="1"}%
%META:TOPICMOVED{by="BrianLin" date="1478905155" from="Documentation/Release3.GratiaIntroduction" to="Documentation/Release3.GratiaIntroduction_DRAFT"}%
