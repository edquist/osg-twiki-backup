%META:TOPICINFO{author="BrianLin" date="1479158467" format="1.1" reprev="1.2" version="1.2"}%
---+ Installing and Maintaining Gratia Accounting

%TOC{depth="3"}%

---++ About This Guide

---++ Installing Gratia

Installation, setup and troubleshooting of the Gratia probes
   * The [[Documentation/Release3.InstallComputeElement][Compute Element install document]] will tell you also how to install its Gratia probes (for HTCondor, PBS, LSF, RSV, ...), mostly using =osg-configure= that simplifies the configuration.
   * Similarly install documents of Storage Elements describe also probes installation and configuration.
   * [[Accounting.ProbeConfigGlideinWMS][Gratia probe for HTCondor]]. Pay attention to [[Accounting.ProbeConfigGlideinWMS#Users_without_Certificates][this section]] if you are in a Campus Grid or any setup where x509 authentication (Grid certificates for users) is NOT used.
   * [[Documentation/Release3.InstallGlideinWMSFrontend#GratiaAccounting][Installing the HTCondor probe on a VO Frontend]]
   * [[Documentation/Release3.GlideinWMSCampusGrid#GratiaAccounting][HCCondor probe in a Campus Grid]]
   * InstallAwsVmGratiaProbe
<!--
   * [[Documentation/Release3.InstallGratiaLrmsProbe][Install and Configure Gratia LRMS Probes]] (HTCondor, PBS, LSF, SGE, GE, ...)
-->   

   * [[TroubleshootingGratia][Troubleshooting Gratia]]

---++ Configuring Gratia

In normal cases, =osg-configure= does the editing of the probe configuration files, at least on the CE. The configuration is found in =/etc/osg/config.d/30-gratia.ini= and [[IniConfigurationOptions#Gratia][documented elsewhere]]. 

If there are problems or special configuration, you might need to edit the Gratia configuration files yourself. Each probe has a separate configuration file found in =/etc/gratia/%RED%PROBE-NAME%ENDCOLOR%/ProbeConfig=. 

The !ProbeConfig files have many details. A few options that you might need to edit are shown before. This is *not* a complete file, but only shows a subset of the options.

<pre class="file">
&lt;ProbeConfiguration 

    CollectorHost="gratia-osg-itb.opensciencegrid.org:80"
    SSLHost="gratia-osg-itb.opensciencegrid.org:80"
    SSLRegistrationHost="gratia-osg-itb.opensciencegrid.org:80"

    ProbeName="condor:fermicloud084.fnal.gov"
    SiteName="WISC_OSG_EDU"
    EnableProbe="1"
/>
</pre>

The options you see here are:

| *Option* | *Comments* |
| !CollectorHost | The Gratia server this probe reports to |
| !SSLHost | The Gratia server this probe reports to |
| !SSLRegistrationHost | The Gratia server this probe reports to |
| !ProbeName | The unique name for this probe. Note that it includes the probe type and the host name |
| !SiteName | The name of your site, as registered in OIM. If your site must be registered in OIM |
| !EnableProbe | The probe will only run if this is "1" |

Again, there are many more options in this file. Most of the time you won't need to touch them.


#ReferenceSection
---++ Reference
