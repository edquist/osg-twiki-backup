%META:TOPICINFO{author="JoseCaballero" date="1466805338" format="1.1" reprev="1.1" version="1.1"}%
*WARNING: THIS DOCUMENTATION IS WORK IN PROGRESS!!!*

<!-- some useful definitions  (need 3 white spaces before * to enable it)
   * Set UCL_PROMPT_ROOT = [root@replica ~]$
   * Set VERSION = 0.9.2
IMPORTANT NOTE=  The version is actually set in the "Applicable versions" section. It is hardcoded there so it can be copied by other pages.
-->

---+!! !CvmfsReplica
<!--
%DOC_STATUS_TABLE%
-->
%TOC{depth="3"}%


---# About this Document

This document describes the cvmfsreplica daemon for CVMFS Stratum-1s.

%INCLUDE{"Documentation/DocumentationTeam/DocConventions" section="Header"}%
%INCLUDE{"Documentation/DocumentationTeam/DocConventions" section="CommandLine"}%

%INCLUDE{"Documentation/Release3/AutoPyFactory" section="Version"}%

%STARTSECTION{"Version"}%
---# Applicable versions

This documentation applies to the latest version of cvmfsreplica: 0.9.2
%ENDSECTION{"Version"}%

---# Description

cvmfsreplica is a tool to handle the process to running snapshots on a CVMFS Stratum-1 host. 
It is meant to be more flexible and complete than a simple cron job. 
The behavior of cvmfsreplica is driven by its configuration files. Therefore, it is recommended to read carefully the [[https://twiki.grid.iu.edu/bin/view/Documentation/Release3/CvmfsReplica][reference manual]] before starting the service. 
Each CVMFS repository is set separately in the configuration files. For each one of them, an internal thread will be created that loops uninterruptedly, triggering snapshot commands periodically. 
Besides triggering periodically a snapshot command, the service behavior can be modulated making use of the available plugins. Read the following section to learn more about the plugins.

---## Acceptance plugins

Acceptance plugins are used to decide, on every cycle, if the snapshot command should or not be attempted. 
None, one, or more than one acceptance plugins can be used. 
When they are used, the snapshot step is performed only if all of them passes successfully. 
Some acceptance plugin may also, when they don't pass, call a report plugin to notify the failure. 
Also, some acceptance plugin may stop that particular thread, so no more attempts will be performed for that particular repository. 

Detailed description of the Acceptance plugins and their configuration can be found in the [[https://twiki.grid.iu.edu/bin/view/Documentation/Release3/CvmfsReplicaReferenceManual][reference manual]]

---## Report plugins

The Report plugins are meant to notify the relevant events during the replication process, mostly when something does not work as expected. 
 
Detailed description of the Report plugins and their configuration can be found in the [[https://twiki.grid.iu.edu/bin/view/Documentation/Release3/CvmfsReplicaReferenceManual][reference manual]]

---## Post plugins

The Post plugins perform actions after the snapshot have been attempted, either successfully or not. 

Detailed description of the Post plugins and their configuration can be found in the [[https://twiki.grid.iu.edu/bin/view/Documentation/Release3/CvmfsReplicaReferenceManual][reference manual]]


---# Source code
cvmfsreplica it is written in python.
Code can be found [[http://github.com/jose-caballero/cvmfsreplica][here]]

---# Download

*WARNING: this is temporary until the RPMs are distributed from CERN*

<pre class="rootscreen">
%UCL_PROMPT_ROOT% rpm -Uhv  http://www.usatlas.bnl.gov/~caballer/files/tmp/cvmfsreplica-0.9.2-1.noarch.rpm
</pre>

---# Run the service

As any other UNIX service, cvmfsreplica is managed in the usual way.

To start the service:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% service start cvmfsreplica
</pre>


To restart the service:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% service restart cvmfsreplica
</pre>

To stop the service:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% service stop cvmfsreplica
</pre>

To check the status of the service:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% service status cvmfsreplica
</pre>











-- Main.JoseCaballero - 24 Jun 2016
