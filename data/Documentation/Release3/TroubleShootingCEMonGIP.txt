%META:TOPICINFO{author="AlainRoy" date="1333494531" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="WebHome"}%
%DOC_STATUS_TABLE%

---+!! Troubleshooting Information Services: CEMon and the GIP

%TOC%


---# About this document
This document will help you troubleshoot problems with the OSG Information Services, which includes CEMon and the GIP See also other documents recommended in the Reference section below.

This document follows the general OSG documentation conventions: %TWISTY{%TWISTY_OPTS_OUTPUT% showlink="Click to expand document conventions..."}%
%INCLUDE{"Documentation/DocumentationTeam/DocConventions" section="Header"}%
%INCLUDE{"Documentation/DocumentationTeam/DocConventions" section="CommandLine"}%
%ENDTWISTY%

---# How to get Help?
To get assistance please use our [[HelpProcedure][Help Procedure]]. 


---# Information Services: The big picture

All OSG sites report information about their site to a central OSG service that can be queried. For sites that participate in LHC experiments, the information is shared with the WLCG. 

At each site, usually on the Compute Element, a few processes cooperate to collect and publish this information. These processes are:

   * *GIP* (Generic Information Provider): This is a program that collects the information about your site. It uses a combination of static information from configuration files as well as information that it dynamically discovers from your system. 
   * *CEMon*: This is a program that periodically runs the GIP and then publishes the information to the OSG's central information services server. CEMon is a _webapp_ that runs within Tomcat. Although it is a webapp, it does not provide a web interface that users can interact with via their web browser.
   * *Tomcat*: Tomcat runs CEMon.

You can see the overall process in this diagram:

<img src="%ATTACHURLPATH%/cemon-gip-basics.png" alt="cemon-gip-basics.png">    

Broadly speaking, four steps are executed on a periodic basis:
   1. CEMon (running inside of Tomcat) execute the GIP.
   1. The GIP collects information about your site and returns it to CEMon.
   1. CEMon does some light processing of the data and transfers it to two destinations:
      i. The CEMon Collector at the GOC. 
      i. The RESS Collector at Fermilab, where it can be queried by Condor tools
   1. The CEMon Collector processes the data and if the data is good and comes from a site that is registered in [[https://oim.grid.iu.edu/][OIM]], it will transfer it to the BDII, an LDAP server. In some cases, it may also push the data to the WLCG Interoperability BDII.

#ValidateInfo
---# Validating that your data is being published

---## Validate data is being propagated to the BDII

   1. First, check the [[http://myosg.grid.iu.edu/wizardgipstatus/index?datasource=gipstatus&summary_attrs_showservice=on&summary_attrs_showrsvstatus=on&summary_attrs_showfqdn=on&gip_status_attrs_showtestresults=on&gip_status_attrs_showfqdn=on&account_type=cumulative_hours&ce_account_type=gip_vo&se_account_type=vo_transfer_volume&start_type=7daysago&start_date=02%2F23%2F2009&end_type=now&end_date=03%2F02%2F2009&all_resources=on&gridtype=on&gridtype_1=on&service=on&service_1=on&active_value=1&disable_value=1][GIP validator at MyOSG]] to see if data for your site is being reported.
   1. Next, use LDAP to query the BDII. Make sure to substitute your site name (not the CE's host name) in this command: <pre class="screen">
%UCL_PROMPT% ldapsearch -x -LLL -p 2170 -h is.grid.iu.edu -b mds-vo-name=%RED%WISC-OSG-EDU%ENDCOLOR%,mds-vo-name=local,o=grid
n: Mds-Vo-name=WISC-OSG-EDU,Mds-Vo-name=local,o=grid
objectClass: GlueTop
objectClass: Mds
Mds-Vo-name: WISC-OSG-EDU
... lots more output trimmed ...
</pre>
   1. If the information if not being reported correctly, run =/usr/bin/gip_info= on your CE. If the information does not appear to be correct, you may need to adjust your configure in =/etc/osg/config.d/=.
   1. Alternatively:
      1. Navigate to [[http://tinyurl.com/87dfj5y][MyOSG BDII Browser]]
      1. Under "Specific Resource Groups", enter your site name
      1. Click on the "Update Page" button
      1. A subset of the site BDII information will be available to browse

---## Validate is being propagated to the RESS

RESS is a Condor collector: it collects "ClassAds" from each site. You can use Condor commands both to see your !ClassAds and verify that your !ClassAd appears to be correct. You can do two easy checks. They are only briefly described here, but you can read [[ResourceSelection.ReSSClassadValidationMechanism][a more detailed description]].

   1. To see that your !ClassAds are being reported, you can look at them directly with the following command. Substitute your site name (not your CE host name). <pre class="screen">
%UCL_PROMPT% condor_status -l -pool osg-ress-1.fnal.gov  -constraints 'GlueSiteName == "%RED%FNAL_FERMIGRID%ENDCOLOR%"'
GlueCEStateWorstResponseTimeOriginal = 86400
GlueSiteSecurityContact = "mailto: fermigrid-help@listserv.fnal.gov"
GlueClusterUniqueID = "d0cabosg1.fnal.gov"
... more output trimmed ...
</pre>
   1. To see if !ReSS thinks your !ClassAds are valid, you can print out just the portion of the !ClassAd that indicates validity. Again, substitue your host name. _0_ means it's not valid, while _1_ means it is. <pre class="screen">
% condor_status -pool osg-ress-1.fnal.gov -format '%d\n' isClassadValid -constraints 'GlueSiteName == "%RED%FNAL_FERMIGRID%ENDCOLOR%"' | uniq
1
</pre>

Please note that due to some complications beyond the scope of this document, your site's !ClassAd may appear to be invalid while they are actually valid. 

---# Common Information Services Problems

---## Why is a site missing from the BDII?

There are several reasons your site might be missing fro the BDII. Things to check are:

   1. Is your site registered in [[https://oim.grid.iu.edu/][OIM]]? Make sure your CE's hostname is listed, and double-check that the DNS reverse lookup for the CE's hostname works correctly. (That is, verify that you can lookup the name fro the IP address.)
   1. Recall that the CEMon Collector will process the data, and it may discard the data if there are problems. Before the data is processed, it is saved in a web-readable directory: http://is.grid.iu.edu/data/cemon_raw_incoming/ . Look in that directory and verify that you have send data the CEMon Collector. The file names are the names of the computers that have sent data. If your data is not there, see the next section.
   1. After the data is processed but before it is sent to the BDII, it is saved in another web-readable directory: http://is.grid.iu.edu/data/cemon_processed_osg/ . Look in that directory and verify that the CEMon Collector did not discard your data. If your data was discarded, it might be because your site is not registered in OIM, or there are serious problems with the data or the DNS reverse lookup for for your CE failed.  
   1. If the data was successfully processed but you are not in the BDII, the problem may be at the GOC's site: please [[https://twiki.grid.iu.edu/bin/view/Documentation/Release3/HelpProcedure#Trouble_Tickets][file a ticket]].

---## Information not being sent to the CEMon Collector
If your data did not arrive at the CEMon Collector (i.e., you don't see it in step 2 above), there are several things you can examine:

   1. Check the permissions on =/var/log/gip= and =/var/cache/gip= on your CE. They should be owned by the "tomcat" user. (In the future, 

---# Appendix: Important Gratia files


<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = AlainRoy

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = User

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Installation
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %NO%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %YES%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = AnthonyTiradani 	
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %IN_PROGRESS%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = AnthonyTiradani 	
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %NO%
############################################################################################################
-->

%META:FILEATTACHMENT{name="cemon-gip-basics.png" attachment="cemon-gip-basics.png" attr="h" comment="" date="1333492022" path="cemon-gip-basics.png" size="23972" stream="cemon-gip-basics.png" tmpFilename="/usr/tmp/CGItemp50240" user="AlainRoy" version="3"}%
