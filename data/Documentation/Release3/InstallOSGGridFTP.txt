%META:TOPICINFO{author="MarcoMambelli" date="1318432474" format="1.1" version="1.6"}%
%META:TOPICPARENT{name="InstallBestPractices"}%
%LINKCSS%
---+!! %SPACEOUT{ "Install Stand-alone OSG GridFTP" }%
%TOC%

---+ Introduction

This page explains how to install the stand-alone Globus !GridFTP server.

The GridFTP package contains components necessary to set up a stand-alone gsiftp server and tools used to monitor and report its performance. A stand-alone GridFTP server might be used under the following circumstances:

    * A simple front-end to a filesystem allowing access over WAN - for example NFS.
    * BeStMan is capable of distributing its workload among several gsiftp servers so if you expect large movements of data into/out of your site, multiple gsiftp servers can be set up. 

---++ Engineering Considering

It is recommended that the GridFTP package be installed on its own server if:

    * You are serving the VOs that use storage heavily (CMS, ATLAS, CDF, and D0) and have more than 250 cores
    * Your site will be managing more than 50 TB of disk space 

If you are planning to have a Storage Element with BeStMan and have more than 1Gbps bandwidth, then you should plan on at least one GridFTP server per 4Gbps of available bandwidth (assuming you have 10Gbps interfaces on the server) if you want to maximize throughput.

You have to decide what authorization mechanism do you prefer. You may use either grid-mapfile or GUMS server for users’ authentication and authorization. More details about GUMS could be found at GUMS Installation Guide.

We currently recommend using GUMS as it provides superior flexibility and allows a site to manage all of its mappings in one central location; most large sites use GUMS. 

---++ How to get Help?

If you cannot resolve the problem, the best way to get help is by contacting osg-software@opensciencegrid.org. 

---++ Requirements
   1. A RHEL5 (or !CentOS 5, SL5) machine with [[http://fedoraproject.org/wiki/EPEL][EPEL]] repos enabled.
   1. The server must have a fully qualified domain name and a valid [[GetHostServiceCertificates][grid host certificate]] installed in =/etc/grid-security/=. 
   1. The firewall must allow incoming connections to the gsiftp port (default 2811). Outgoing connections must be allowed from high ports ( typically in range 32769-65535 ). 
   1. A working GUMS server or a gridmap-file are needed for authorization using grid certificates.

---++ Install Instructions

%INCLUDE{"Documentation.InstallVDTRepo" headingoffset="1"}%

!GridFTP requires a certificate package to run.  If you require a specific certificate package, follow the Documentation/Release3.InstallCACerts instructions to install it.  
If you do not install a grid certificate package first, the install procedure will install one for you as part of its dependencies.  (usually osg-ca-certs).

First, you will need to install the !GridFTP meta-package:

<pre class="rootscreen">
%UCL_PROMPT_ROOT% yum --enablerepo=osg-testing install osg-gridftp
</pre> 

---+++ Configuring GUMS support

By default, !GridFTP uses a gridmap file, found in =/etc/grid-security/gridmap-file=.
If you want to use GUMS security (recommended), you will need to enable using the following steps:

First, edit =/etc/grid-security/gsi-authz.conf= and uncomment the globus callout.
<pre class="file">
globus_mapping /usr/lib64/liblcas_lcmaps_gt4_mapping.so lcmaps_callout
</pre> 
This should be =/usr/lib64= for x86_64 architectures and =/usr/lib= for i386 architectures.

Next edit =/etc/lcmaps.db= to edit your gums information:
<pre class="file">
# Module definitions
path = /usr/lib64/modules

...
gumsclient = "lcmaps_gums_client.mod"
             "-resourcetype ce"
             "-actiontype execute-now"
             "-capath /etc/grid-security/certificates"
             "-cert   /etc/grid-security/hostcert.pem"
             "-key    /etc/grid-security/hostkey.pem"
             "--cert-owner root"
# Change this URL to your GUMS server
             "--endpoint https://*gums.fnal.gov:8443*/gums/services/GUMSXACMLAuthorizationServicePort"
</pre> 

If you would like to run SAZ, you will need to enable the relevant lines in the above file as well (more documentation to be added later).

---+++ (Optional) Modifying Environment 

Environment variables are stored in =/etc/sysconfig/globus-gridftp= which is sourced on service startup.
If you want to changed LCAS/LCMAPS log levels, or globus port ranges, you can edit them there.

---++ Starting and Stopping !GridFTP

Starting !GridFTP:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% service globus-gridftp-server start
</pre> 


Stopping !GridFTP:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% service globus-gridftp-server stop
</pre> 

---++ File Locations

   * Configuration files:
      * /etc/sysconfig/globus-gridftp-server : Environment variables for !GridFTP and LCAS/LCMAPS
      * /etc/sysconfig/gridftp.conf.d/ : Environment variables for !GridFTP plugins
      * /etc/gratia/gridftp-transfer/ProbeConfig
   * Log Files
      * /var/log/gridftp.log
      * /var/log/gridftp-auth.log 
      * /var/logs/gratia

---++ Screen Dump of Install Procedure 

PENDING

-- Main.DouglasStrain - 29 Aug 2011

%META:TOPICMOVED{by="JamesWeichel" date="1317239559" from="Documentation.InstallOSGGridFTP" to="Documentation/Release3.InstallOSGGridFTP"}%
