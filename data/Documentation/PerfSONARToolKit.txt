%META:TOPICINFO{author="ShawnMcKee" date="1377099521" format="1.1" reprev="1.4" version="1.4"}%
%META:TOPICPARENT{name="NetworkingInOSG"}%
%LINKCSS%

<!-- This is the default OSG documentation template. Please modify it in -->
<!-- the sections indicated to create your topic.                        --> 

<!-- By default the title is the WikiWord used to create this topic. If  -->
<!-- you want to modify it to something more meaningful, just replace    -->
<!-- %TOPIC% below with i.e "My Topic".                                  -->

---+!! %SPACEOUT{ "perfSONAR-PS Toolkit" }%
%TOC%

%STARTINCLUDE%

---++ Setting up *perfSONAR-PS* for OSG Sites

This page documents setting up *perfSONAR-PS* for OSG sites.

The !perfSONAR-PS toolkit is targeted for deployment at all OSG sites.  We are currently waiting for the final release of v3.3.   Our goal is to encourage *all* OSG sites to deploy, configure and register !perfSONAR instances so we can gather network metrics about the network paths between OSG sites.

A quick note on the physical location for the OSG !perfSONAR-PS instances: *Our strong recommendation is to co-locate  two !perfSONAR-PS nodes with the sites primary grid-storage*.   The reason is that we want the !perfSONAR instances to measure as much of the *network* path as is possible, end-to-end.    The !perfSONAR-PS measurements are intended to represent what the network is doing end-to-end and can be used to differentiate network problems from end-host/storage/software problems.

---+++ OSG !perfSONAR-PS Requirements

There are a few requirements to deploy !perfSONAR-PS toolkit instances at OSG sites:  hosting location, network setup and hardware to run the services

---++++ Physical location identified

OSG sites need to plan to host the recommended two !perfSONAR-PS hosts.  Hardware details are available at the URL below under "Hardware Guidelines".   A typical installation would have two 1U nodes installed at the same "network" location as the site's primary storage.   This is to ensure we are measuring as much of the end-to-end network path for the site's storage systems.

---++++ Network connectivity

The two perfSONAR-PS instances will both require publicly reachable addresses and DNS names setup.   Of course sites must also provide two network ports to connect the systems, appropriate for the type of network connection the systems require (RJ45, fiber, etc.).    For DNS names we recommend (but not *require*) the following:

   * The DNS name should have a two digit number to allow for future additional installations  
      * The 'odd' numbers should correspond to latency instances (example ....01 should be the first !perfSONAR-PS latency instance)
      * The 'even' number should correspond to bandwidth instances (example ...02 should be the first !perfSONAR-PS bandwidth instance)
   * The name should start with 'ps'  or 'perfsonar'  
   * The "site" info is assumed to come from the DNS domain but if not it might be included in the DNS name.

Using the above recommendations the !perfSONAR-PS installations at the University of Michigan ATLAS Great Lakes Tier-2 (AGLT2) might be:

   *  *psum01.agl2t.org*  -  The first latency node at the AGLT2 UM site
   *  *psum02.aglt2.org*  -  The first bandwidth node at the AGLT2 UM site

---++++ Hardware Guidelines

Internet2 has setup a hardware recommendation page at http://psps.perfsonar.net/toolkit/hardware.html      For example we have found Dell R320/R420 or R620 systems perfectly suitable for use as !perfSONAR-PS nodes.  While all three of these models work with 10G network cards, Dell will only sell the R620 with one since they don't test the other two models for 10G use.  Other similar hardware should work fine as well.  It is important to make sure your system has a well supported, popular network card under CentOS to help minimize possible  problems with your system. 

---+++ OSG perfSONAR-PS Toolkit Installation Instructions

As of this writing the perfSONAR-PS Toolkit that is released is v3.2.2.   However v3.3 is now available as a release candidate 4 and should soon (2-3 weeks) be available as a final release.  In the interest of getting sites installed and network monitoring functional, we recommend sites install v3.3 RC4 and plan to upgrade to the final release when available:

   * Installing the release candidate 4 v3.3 version will also give you a functional installation but is still not the "final" version. 
      * See the release announcement at http://psps.perfsonar.net/toolkit/releasenotes/pspt-3_3_rc4.html  
      * Once the final release v3.3 is ready sites will need to plan on upgrading/updating as soon as possible.
      * There very well may be bugs or problems (feedback encourage per the release notes at the URL above)
   * Unless you have a good reason to choose a different version we are recommending you install the *“NetInstall” !CentOS 6 64-bit version* which will install to the local system disk.  The system can then use ‘yum’ to update itself.

Note that the above instructions show details about installing and configuring.  *The configuration notes  are in the next section below, so please read ahead before clicking off to follow the quick-start links above.*

---+++ OSG perfSONAR-PS Configuration

Once the physical boxes are installed and operational, we need to configure the needed set of scheduled tests that the boxes should be running.  

Some additional information for OSG sites:
   * After installing (either the “NetInstall” or “LiveCD” versions) you will need to setup the services running on each type of node.  Our convention so far has been to make the first node (by name or IP) the “Latency” node and the second node the “Bandwidth” node (see networking info above).    This is easy to configure by using the Web GUI and selecting “Enabled Services” on the left hand navigation panel under “Toolkit Administration”.  You can select the button at the bottom for enabling only Latency or only Bandwidth services.   On the “Latency” node you should make sure to enable the two “Traceroute” services ( the MA and Scheduler).  Note this should be done if you click the "Latency only services" button.  If you want SSH access enabled but sure to click the checkbox next to 'SSH' before you "Save". 
   * Each site should fill out the appropriate “Administrative Information”  (under “Toolkit Administration” on left of Web GUI). <br><img src="%ATTACHURLPATH%/perfsonar-PS-admin-config.png" alt="perfsonar-PS-admin-config.png" width="1074" height="545" /></br>
      * *The "Host Location" field should be filled out with a complete address* (suitable for locating via GoogleMaps or similar)
      * The latitude and longitude can be found using Google Maps (https://www.google.com/maps ).  Zoom in on Google maps and right-click the location of your perfSONAR-PS installation and select "What's here".  The latitude and longitude will then be shown in the Google search box on the page.
      * The “Communities” section (see http://code.google.com/p/perfsonar-ps/wiki/pSPerformanceToolkit33#Communities ) should have “OSG” added in addition to whatever other communities the site wants to list (LHCONE, LIGO, HCC, ENGAGE, ATLAS, CMS, USATLAS, LHC, etc.)  
   * The NTP servers need to be setup carefully for the Latency node.  Ideally at least 4 “good” servers should be configured (add “local” or regional ones if they are not in the distributed setup).
   * Firewalls may be an issue (See comments in table above).  If you suspect your site will block *ANY* of the OSG sites, can you update your firewalls to allow the ports shown in the FAQ here http://psps.perfsonar.net/toolkit/FAQs.html#Q6 .

For all OSG sites, we want to configure a "full-mesh" of tests.   We plan on having:
   * Latency (OWAMP) tests
   * Bandwidth (BWCTL) tests
   * Traceroute tests

These will be controlled by an OSG "Mesh configurations".   The primary "configuration" step for sites is now simplified to configuring which "Meshes" the site wishes to participate in.  All OSG sites should plan to use the OSG mesh-configuration.   Individual VOs may also provide additional mesh configurations that we will document on this page as they become available. 

---++++ Configuring Sites for Participation in OSG and Other Meshes

The mesh configuration for each mesh is stored in a .json file that can be retrieved from a well-known URL.  For OSG we will have a single top-level mesh providing a complete set of inter-site tests but at a very low intensity.   *All OSG* sites should configure the agent to use the =osg json= mesh as follows:

   * Make sure your perfSONAR-PS node is up-to-date:  *yum update*
   * Configure the mesh agent to point to the OSG json file =osg json= by editing the perfSONAR-PS host's */opt/perfsonar_ps/mesh_config/etc/agent_configuration.conf* and adding: :
<verbatim>
<mesh>
 configuration_url             http://myosg.grid.iu.edu/pfmesh/json
 validate_certificate          0
</mesh>
</verbatim>
This line replaced the default *configuration_url* near the beginning.   Sites should also add additional *configuration_url* lines corresponding to other VO or site-specific meshes as appropriate.  See http://confluence.grid.iu.edu/display/CENTRAL/Perfsonar+Mesh+Configs for details.

One additional edit for the *agent_configuration.conf* is to customize the *admin_email* setting appropriate for each site.  For AGLT2 the example is:
<verbatim>
admin_email     smckee@umich.edu
admin_email     laurens@pa.msu.edu
</verbatim>
These lines were added to the end.  The last step for getting the mesh operational is to:
   * Run the cron-task in */etc/cron.d/cron-mesh_config_agent* You may wish to run this once after you modify the agent_configuration.conf file rather than waiting for it to run by cron by doing the following as =root=
<verbatim>
sudo -u perfsonar /opt/perfsonar_ps/mesh_config/bin/generate_configuration
</verbatim>
---+++ Registering Your !perfSONAR-PS Instances

Once sites have completed the installation and configuration steps above, we need them to register their instances.

Please follow the directions at http://www.opensciencegrid.org/bin/view/Documentation/RegisterPSinOIM

#MaintTrouble
---+++ perfSONAR-PS Maintenance and Troubleshooting

The current release (v3.3.1 as of August 21, 2013) of !perfSONAR-PS has been updated to include all our  previous "maintenance" recommendations from v3.2.x.   If we find additional maintenance items we will document them here.

Note USATLAS is trying to maintain a list of tips, maintenance items and troubleshooting at http://www.usatlas.bnl.gov/twiki/bin/view/Projects/LHCperfSONAR so please check there for new items.  In addition if you find other items we should add to this Wiki, please email Shawn !McKee <smckee@umich.edu>.

---+++ Modular Dashboard for  perfSONAR

The !perfSONAR-PS toolkit installations provide a reliable source of standard network metrics.  However, accessing and visualizing the set of all OSG network metrics would be very difficult if each user had to find and access the toolkit web pages for *each* OSG site.   Instead we are working on developing a central service called the "Modular Dashboard" which collects, stores and visualizes the network metrics and !perfSONAR-PS toolkit service status for our sites.   

There is a !GitHub Organization called *PerfModDash* which is working on this dashboard. We want to strongly encourage those interested in participating in its development. Please see https://github.com/PerfModDash 

This dashboard is the basis of a new OSG network service that is being deployed.  As sites register their instances in OIM (see above), this service will begin to monitor their toolkit services and gather the network metrics they are measuring.    OSG is tracking these and you can see the links on http://confluence.grid.iu.edu/display/CENTRAL/Perfsonar+Mesh+Configs for details.

---+++ Comments and Suggestions

We welcome and encourage any comments or suggestions about this information and planning.  Please send them via email to Shawn !McKee <smckee@umich.edu>


%STOPINCLUDE%

%BOTTOMMATTER%

-- Main.ShawnMcKee - 09 Sep 2012

 

%META:FILEATTACHMENT{name="perfsonar-PS-admin-config.png" attachment="perfsonar-PS-admin-config.png" attr="h" comment="Example PS config" date="1369154717" path="perfsonar-PS-admin-config.png" size="54493" stream="perfsonar-PS-admin-config.png" tmpFilename="/usr/tmp/CGItemp61168" user="ShawnMcKee" version="1"}%
