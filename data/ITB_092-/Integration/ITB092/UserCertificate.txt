%META:TOPICINFO{author="AnneHeavey" date="1194997743" format="1.1" reprev="1.15" version="1.15"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

%STARTINCLUDE%
%BR%
---+ _%INCLUDEHEADING%  %SPACEOUT{ "%TOPIC%" }%_
%EDITTHIS%
%BR%

There are many different Certificate Authorities that OSG sites can choose to recognize.  We recommend DOEGrids, as most OSG users are eligible for this.  This is the only CA for which we document the process.  For information on others, contact your [[http://www.grid.iu.edu/osg-includes/sc.php][VO Support Center]]. 

Certificates and their uses, particularly user certificates (also called personal certificates) are described in [[Documentation/CertificateWhatIs][CertificateWhatIs]].  You can use a browser to get your user certificate and convert it to work with OSG. This is described in [[Documentation/CertificateGet][How do I get or renew a DOEGrids Digital PKI/X509 Personal Certificate using a browser?]].  Alternatively, you can use a set of scripts that the VDT has packaged to get one.  This package gives you the certificate in the right format %RED%true?%ENDCOLOR% for grid use; but you can convert it appropriately for browser (or other) use, and import it as necessary.  You can also choose to get more than one user certificate, if you find that easier.

The package with scripts is included in the OSG software stack, however, we recommend that you have all your certificates (user, host and service) in place before you download and install this software. Yes, the old chicken-and-egg problem strikes again.  %RED%Here's what we are working towards:%ENDCOLOR% To solve this dilemma, we offer a "lite" package with only the certificate request scripts (and their dependencies) that you can install ahead of time.  You will need to [[PacmanInstall][install pacman]] first, and use it to install this package.

%RED%AH proposes moving "Uses" section to [[Documentation/CertificateWhatIs][CertificateWhatIs]]. Info copied there and merged (please review); info just hidden here for now, not deleted.%ENDCOLOR%

<!--
(heading) Uses of a personal certificate
An X509 credential consists of two parts, the public certificate and a private key. A piece of information cryptographically signed
with the private key can be verified with the public certificate (using its included public key).  By keeping the private key *private*,
communications to third parties can be trusted as having originated with the holder of the private key.  The public certificate
is cryptographically signed by the CA so that when the CA is *trusted*, the recipient is assured of the identity of the person
holding the private key.

There are three primary uses of certificates around the OSG:
   1. for initiating grid computing transactions (the main purpose)
   2. for authenticating at web sites using your browser
   3. for digitally signing email messages
For the first use, the credential is typically stored in your ~/.globus directory, the public certificate in a file called usercert.pem
and the private key in a file called userkey.pem.
To get one of these credentials it is most convenient to use the comandline tools in the cert-scripts package as described below.

For the other uses (web browser & email) it can be more convenient to get another certificate using
the web interface to the DOEGrids CA.  The public/private key pair is generated in your web browser
and the signed certificate, when issued, is downloaded into your (same) web browser, matched with
the private key and then can be used to authenticate with SSL web sites.  Depending upon your
email client tool you may or may not have to export your credential into a PKCS12 file from your
web browser and import it into your email client.  There are also tools to convert PKCS12 format
credentials to/from PEM format files for globus if you want to use exactly the same credential
for all uses, if you prefer to _not_ have two certificates.
-->

<!-- cOr follow the instructions in [[GetHostCertificates#Get_a_Personal_Grid_Certificate][Configuring Public Key Infrastructure]]. -->
---++ Get a certificate using the cert-script package

The cert-scripts package allows you to request a certificate directly from the host where you'll be doing OSG work. 

First [[PacmanInstall][install pacman]].

Log in to the user account where you will normally initiate grid actions.  The commands below will place your certificate in the globus default location ( =~/.globus= ).  You should specify _OSG_ for the RA affiliation and also for the VO unless you already know the more appropriate values to use.

%RED%Fix these commands:%ENDCOLOR%
<pre class="screen">
> <userinput>cd (where's best location?)</userinput>
> <userinput>pacman -get (what's the path?) VDT:cert-scripts</userinput>
(what questions will you have to answer, and what are the right responses?)
> <userinput>source setup.sh</userinput>
> <userinput>cd (where's the cert-request going to be?)</userinput>>
> <userinput>cert-request -ou p</userinput>
</pre>
The command will prompt you for necessary information, including your email address.  The complete description of this command
can be seen in the [[Security/CSReadMe#cert_request][certificate README file]]. One particularly convenient option is to create the PKCS12 format file of the full credential that can be imported directly into your web browser and email programs.

%NOTE% If you get inventive with the available options of the =cert-request= command then you may need to use some additional parameters in the "retrieve" command below.  

Look for email notification that the certificate has been issued. Once you receive it, you can retrieve the certificate with the following command, using the serial number given in the email notice.  First =cd= to the install directory. Then:

<pre class="screen">
> <userinput>source setup.sh</userinput>
> <userinput>cert-retrieve -certnum <i>0xYYYY</i></userinput>
</pre>
See the [[Security/CSReadMe#cert_retrieve][full man page of the cert-retrieve]] command.

%RED%Does this give you the usercert.pem and the userkey.pem, or a p12?%ENDCOLOR%

---++ Move files to $HOME/.globus and set permissions

Instructions are given in [[Documentation/CertificateGet#Convert_your_certificate_to_form][Convert your certificate to format for grid use]].  %RED%If you already have the right files, just copy the files over and set the permissions%ENDCOLOR%

<!-- This is now in Documentation > CertificateGet 

(heading) Get a certificate in your browser, export it and convert it

See the [[http://www.opensciencegrid.org/ra][OSG Registration Authority]] for instructions on obtaining a certificate with your browser.  %RED%Last I heard, these were not up to date; check with Rob Q.. See Documentation/CertificateGet  %ENDCOLOR% 
Follow the instructions for your browser to export it into a PKCS12 format file (.p12). For details of this just Google "export certificate my_web_browser"
and you will get many examples of how to export a certificate.  Naturally, substitute the name of your actual web browser for _my_web_browser_.

Once you have the PKCS12 format file (.p12), see [[Security.OsgRaOperations#Make_pem_files_for_globus_after][these instructions]] for converting it to .pem format.
-->

---++ Update the VOMS information (e.g., after renewing): 
You will need to check with your VO support for what you may need to do to
update your certificate information in your VO's VOMS server.

The example command that shows the typically useful information about a certificate is:

<pre class="screen">
> <userinput>openssl x509 -in ~/.globus/usercert.pem -subject -serial -dates -issuser -noout</userinput>
</pre>

---++ Test your credentials:

In the simplest case:
<pre class="screen">
> <userinput>source $VDT_LOCATION/setup.sh</userinput>
> <userinput>grid-proxy-init</userinput>
> <userinput>grid-proxy-info</userinput>
</pre>

To test with voms-proxy-init you will need instructions from your VO about the correct environment setup.


---++ Troubleshooting

If this doesn't work, check that the "gatekeeper" &mdash; the Grid component that accepts and executes remote jobs &mdash; can correctly authenticate you:

%NOTE% This example was run against the Fermilab site. Customize it for your VO and site.

<pre class="screen">
> <userinput>globusrun -a -r <replaceable>fermigrid2.fnal.gov</replaceable>/jobmanager-fork</userinput>
GRAM Authentication test successful
> 
</pre>

%RED%Are there scripts for renewing and revoking, or do they follow same instructions as browser people? Ah, and where are instructions for turning what you get here into something you can use in your browser? %ENDCOLOR%

%STOPINCLUDE%
%BR%
%COMPLETE3% %BR%
%RESPONSIBLE% Main.DougOlson - 26 Oct 2007 %BR%
%REVIEW%  Main.AnneHeavey - 13 Nov 2007 %BR%
%REVCOM%More comments and questions (in red).
