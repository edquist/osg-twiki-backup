%META:TOPICINFO{author="IgorSfiligoi" date="1235772463" format="1.1" reprev="1.31" version="1.31"}%
%META:TOPICPARENT{name="ComputeElementAuthorization"}%
---+!! *<noop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

---++ This page is obsolete

This Web page is obsolete. It is here just to host a few bits of information that have not been verified to exist elsewhere.

Please refer to for [[FullPrivPreConfig][the Full Privilege Authorization information]] from now on.

---+++!! Web services configuration files
The default authorization mode for WS_GRAM is Local or Compatibility.  It uses the =/etc/grid-security/grid-mapfile= as the basis for authorization.  

To enable Full Privilege mode you must run the =$VDT_LOCATION/monitoring/configure-osg.py= script after you have completed the previous configuration steps. During the execution of this script, a check is made to determine if you have already configured your node to use the Full Privilege authorization mode.  It does this by looking for the existence of the =/etc/grid-security/prima-authz.conf= file.

If that file exists, the script extracts <i>Your-GUMS-Server</i> information from the file and executes the command:

   * <pre class="screen"> $VDT_LOCATION/vdt/setup/configure_prima_gt4 --enable -gums-server <i>Your-GUMS-Server</i> </pre>

The script modfies four WS-GRAM security configuration files,  activating the PRIMA callout functionality for the Full Privilege authorization mode, in =$VDT_LOCATION/globus/etc/=:
   * =globus_delegation_service/factory-security-config.xml=
   * =globus_wsrf_core/global_security_descriptor.xml=
   * =globus_wsrf_rft/factory-security-config.xml=
   * =gram-service/managed-job-factory-security-config.xml=

---++ Validating Full Privilege Configuration
You can verify  you are configured correctly in both pre-ws and WS-GRAM mode by submitting a job to each GRAM and reviewing their respective log files looking for the PRIMA  callout messages.  This is a test to verify that you are configured correctly to contact your GUMS service and <b>not</b> that your GUMS service is assigning the correct UNIX account.  That aspect must be addressed by the GUMS administrator.

<b>Note:</b>  You may think that you can now remove your =/etc/grid-security/grid-mapfile=.  <b>Do not.</b>  An =/etc/grid-security-mapfile= must exist for CEMon to work correctly.  You _can_ empty or create an empty =grid-mapfile= if you like.

---+++!! Pre-ws validation 
Verify your =gatekeeper= service is up.  Then run a simple simple job.
<pre class="screen">
 $ source $VDT_LOCATION/setup.sh    <em>OR $VDT_LOCATION/setup.<b>csh</b> </em>
 $ grid-proxy-init 
    <em>(enter your passphrase)</em>
 $ globus-job-run <em>your-ce-host</em>:2119/jobmanager-fork /usr/bin/id 
</pre>

When  authorizing in Full Privilege mode, you will see the following new entries in your =$VDT_LOCATION/globus/var/globus-gatekeeper.log= file when jobs are submitted:
<pre class="programlisting">
<i><b>This line indicates that an authorization request is being sent to the GUMS server.... </b></i>
 PID: 7074 -- PRIMA INFO ts=2007-11-08T01:15:02-06:00 event=org.osg.prima.authz.start 
    DN="/DC=org/DC=doegrids/OU=People/CN=John Weigand 458491" 
    FQAN="/cms/uscms/Role=cmsuser/Capability=NULL" 
    FQAN_Issuer="/DC=ch/DC=cern/OU=computers/CN=lcg-voms.cern.ch" 
    Service_URL="https://cms-xen4.fnal.gov:8443/gums/services/GUMSAuthorizationServicePort"

<i><b>This line is the response to the authorization request from the GUMS service....</b></i>
 PID: 7074 -- PRIMA INFO ts=2007-11-08T01:15:03-06:00 
    event=org.osg.prima.authz.end status=0 decision=PERMIT 
    DN="/DC=org/DC=doegrids/OU=People/CN=John Weigand 458491"
    FQAN="/cms/uscms/Role=cmsuser/Capability=NULL" 
    FQAN_Issuer="/DC=ch/DC=cern/OU=computers/CN=lcg-voms.cern.ch" 
   Service_URL="https://cms-xen4.fnal.gov:8443/gums/services/GUMSAuthorizationServicePort" 
   local_user=uscms699
</pre>

---+++!! WS-GRAM validation 
Verify your =globus-ws= service is up.  Then run a simple simple web services job.
<pre class="screen">
 $ source $VDT_LOCATION/setup.sh    <em>OR $VDT_LOCATION/setup.<b>csh</b> </em>
 $ grid-proxy-init 
    <em>(enter your passphrase)</em>
 $ globusrun-ws -s -submit -F <em>your-ce-host</em>:9443 -Ft Fork -c /usr/bin/id 
</pre>

When  authorizing in Full Privilege mode, you will see the following new entries in your =$VDT_LOCATION/globus/var/container-real.log= file when jobs are submitted:
<pre class="programlisting">
<i><b>This line indicates that an authorization request is being sent to the GUMS server.... </b></i>
2007-11-08 10:21:37,869 INFO  gt4.OSGAuthorization [ServiceThread-21,isPermitted:134] PRIMA: 
    Contacting  authz service (https://cms-xen4.fnal.gov:8443/gums/services/GUMSAuthorizationServicePort) for for -
    UserDN:/DC=org/DC=doegrids/OU=People/CN=John Weigand 458491 - 
    HostDN/DC=org/DC=doegrids/OU=Services/CN=cms-xen9.fnal.gov - 
    FQAN:/cms/uscms/Role=cmsuser/Capability=NULL - 
    FQANIssuer:CN=lcg-voms.cern.ch, OU=computers, DC=cern, DC=ch

<i><b>This line is the response to the authorization request from the GUMS service....</b></i>
2007-11-08 10:21:38,464 INFO  gt4.OSGAuthorization [ServiceThread-21,isPermitted:154] PRIMA: 
   PERMIT - for - 
   UserDN:/DC=org/DC=doegrids/OU=People/CN=John Weigand 458491 - 
   HostDN/DC=org/DC=doegrids/OU=Services/CN=cms-xen9.fnal.gov - 
   FQAN:/cms/uscms/Role=cmsuser/Capability=NULL - 
   FQANIssuer:CN=lcg-voms.cern.ch, OU=computers, DC=cern, DC=ch 
   from authz service (https://cms-xen4.fnal.gov:8443/gums/services/GUMSAuthorizationServicePort)  
   is assigned local account (uscms699)
</pre>

---++ Retest the authorization mode using site verify
Run the [[ValidateSiteVerify][Site Verification]] script again locally (as a regular user, not root) and verify that the authorization still works. 


%BR%

%COMPLETE1% %BR%
%RESPONSIBLE% Main.JohnWeigand %BR%
%REVIEW% Main.StevenTimm  - 05 Jun 2008 %BR%
%REVCOM% Obsolete  %BR%
%REVFLAG%

%META:TOPICMOVED{by="AnneHeavey" date="1192818627" from="Integration/ITB_0_7.OsgCEAuthFullPriv" to="Integration/ITB_0_7.FullPrivilegeAuthorization"}%
