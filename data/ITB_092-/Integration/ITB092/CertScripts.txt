%META:TOPICINFO{author="ForrestChristian" date="1166109120" format="1.1" version="1.6"}%
%META:TOPICPARENT{name="DocumentationTable"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->
d7 1
---+!!<nop>Certificate Scripts Package Guide
Applies to releases of VDT version 1.3.10 and later, and OSG 0.3.6 and later.

%TOC%
%STARTINCLUDE%

---++Introduction
The cert-scripts package ($VDT_LOCATION/cert-scripts) (pacman package PPDG-Cert-Scripts)
provides several useful
scripts for interacting with CA's and the cert-check-time script is helpful
in setting up and monitoring the CA certificates and CRL's that get
installed in your trusted certificates directory.

---++Checking CA certificates
There are numerous CA certificates installed with VDT and you may not want to
allow all of them on your site.  The <b>cert-check-time</b> is a helpful command for reviewing them. This must be run in a
directory where you have write access even though it does not create any permanent files.  You may want to redirect  stdout to a file you can then review.
<pre>
    $ source $VDT_LOCATION/setup.sh
    $ cd <writtable-directory>
    $ $VDT_LOCATION/cert-scripts/bin/cert-check-time -cR
</pre>    
For each CA, the output shows ([[CertCheckTimeSampleOutput][sample output]]) :
  <UL>
    <LI>remaining lifetime of the CA certificate,
     <LI>the human readable name of the CA 
     <LI>and the location of the actual certificate file.
  </UL>
In addition, at the bottom of the listing it points out which CA's do not have a CRL. This is useful AFTER the edg-crl-upgraded daemon has run at least once because then it shows those CA's which have not published a certificate revocation list.
Note that two of the CAs, Kerberos CAs from PSC (85ca9edc.0) and FNAL (e1fce4e9.0) don't really need CRLs since they only
generate short lived certificates.

---++Checking CRL's
Certificate revocation lists contain the list of certificates (by serial number) that have
been issued by a CA but then revoked, meaning you should not accept them.
CRL's are updated frequently and typically have a lifetime limited to a month or less.
When a CRL has expired, the CRL file will still exist in the trusted certificates directory, but
Globus will fail all authentication attempts for <b>all</b> certificates issued by the corresponding CA.

For this reason, and others, it is important that CRL files are current and not expired.
Another variation of the cert-check-time script will list the remaining lifetime of CRL's in
the trusted certificates directory. This must be run in a directory where you have write access even though it does not create any files.  You may want to redirect  stdout to a file you can then review.
<pre>
   $ $VDT_LOCATION/cert-scripts/bin/cert-check-time -r
</pre>

For each CRL, the output  ([[SampleCertCheckTimeCRLs][sample output]]) shows:
<UL><LI>the remaining lifetime,
          <LI>the name of the CA that issued the CRL
          <LI>and the actual CRL file.
</UL>
Site administrators may find it useful to run this command in a daily cron job following the edg-crl-upgraded
daemon as a way to monitor the status of the CRL's.

---++FAQ
---+++Request a certificate for myself
   1. Use <tt>cert-request -ou p</tt>
---+++Request a certificate for my computer
   1. Use <tt>cert-request -ou s</tt>
---+++Request a certificate for the ldap service on my computer
   1. Use <tt>cert-request -ou s -service ldap -host <i>my-computer.some.domain</i> -label <i>ldap-my-computer</i></tt>
---+++ How do I retrieve a certificate
   1. Check the email notice you got when the certificate was granted for the serial number (<i>0xNNNN</i>)
   2. Use <tt>cert-retrieve -certnum <i>0xNNNN</i> [-label <i>label-matching-cert-request</i>]</tt>
---+++How do I get lots of service certificates
   1. Ask your RA to grant you the [[http://www.doegrids.org/Library/gridAdmin/gridAdminUser.html][gridadmin]] privilege.
   2. Use <tt>cert-gridadmin</tt> and you can get service certificates issued immediately  without using the web interface. (Since VDT 1.3.10, cert-scripts V1-7)
---+++ My certificate is about to expire, how do I get another with the same DN
   1. Use <tt>cert-renew</tt>

---++Additional Information

For additional information on the functionality of the cert-check-time script execute it with the <tt>-h</tt> option.

---+++ MAN pages

   * [[http://osg.ivdgl.org/twiki/bin/view/Security/CSReadMe#cert_check_time][cert-check-time]]    checks lifetime of certificates and revocation lists
   * [[http://osg.ivdgl.org/twiki/bin/view/Security/CSReadMe#cert_gridadmin][cert-gridadmin]]    immediate issuance of service certificates for authorized requestors
   * [[http://osg.ivdgl.org/twiki/bin/view/Security/CSReadMe#cert_lookup][cert-lookup]]    queries directory based on DN of certificates
   * [[http://osg.ivdgl.org/twiki/bin/view/Security/CSReadMe#cert_request][cert-request]]    generates and submits a certificate signing request
   * [[http://osg.ivdgl.org/twiki/bin/view/Security/CSReadMe#cert_retrieve][cert-retrieve]]    retrieves signed certificate previously requested
   * [[http://osg.ivdgl.org/twiki/bin/view/Security/CSReadMe#cert_renew][cert-renew]]    renews existing person certificate (not host or service)


<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.DougOlson - 01 Apr 2005<br>
-- Main.DougOlson - 14 Dec 2005<br>
-- Main.BurtHolzman - 04 Jan 2006<br>
-- Main.JohnWeigand - 06 Jan 2006<br>
-- Main.DougOlson - 22 Mar 2006<br>
%STOPINCLUDE%


-- Main.RobQ - 01 May 2006

%META:TOPICMOVED{by="ForrestChristian" date="1166045343" from="Integration.CertScripts050" to="Integration/ITB_0_5.CertScripts"}%
