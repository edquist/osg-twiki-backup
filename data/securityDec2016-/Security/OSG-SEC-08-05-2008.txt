%META:TOPICINFO{author="JimBasney" date="1220622914" format="1.1" reprev="1.20" version="1.20"}%
%META:TOPICPARENT{name="IncidentInformation2008"}%
%TOC%
---+ OSG-SEC-08-05-2008

There is a widespread incident involving HEP sites where attackers gained access using stolen ssh keys and local kernel exploits to gain root access. Rootkits were installed and ssh keys have been systematically stolen and used to compromise further sites. Some sites report only account compromised (no root escalation) and some other have simply detected unsuccessful ssh scans.

No OSG site has been reported to be infected or compromised, but some OSG sites are suspected compromised, and investigation is ongoing.

All sites should check their status and actively search for:
   * Connections attempts from the suspicious IP addresses 
   * Traces of suspicious SSH keys, files and malware described in the update 

Sites should also ensure that their system software is up-to-date (i.e., security updates have been applied) and that they are running an up-to-date Linux kernel.

We have found two user accounts compromised on non-OSG sites. The users are members of Atlas and they have been suspended from Atlas temporarily.

---++ US-CERT Current Activity - SSH Key-based Attacks
 <pre>-----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1  US-CERT Current Activity  SSH Key-based Attacks  Original release date: August 26, 2008 at 3:41 pm Last revised: August 26, 2008 at 3:41 pm   US-CERT is aware of active attacks against linux-based computing infrastructures using compromised SSH keys. The attack appears to initially use stolen SSH keys to gain access to a system, and then uses local kernel exploits to gain root access. Once root access has been obtained, a rootkit known as "phalanx2" is installed.  Phalanx2 appears to be a derivative of an older rootkit named "phalanx". Phalanx2 and the support scripts within the rootkit, are configured to systematically steal SSH keys from the compromised system. These SSH keys are sent to the attackers, who then use them to try to compromise other sites and other systems of interest at the attacked site.  Detection of phalanx2 as used in this attack may be performed as follows:   * "ls" does not show a directory "/etc/khubd.p2/", but it can be     entered with "cd /etc/khubd.p2".   * "/dev/shm/" may contain files from the attack.   * Any directory named "khubd.p2" is hidden from "ls", but may be     entered by using "cd".   * Changes in the configuration of the rootkit might change the     attack indicators listed above. Other detection methods may     include searching for hidden processes and checking the reference     count in "/etc" against the number of directories shown by "ls".  US-CERT encourages administrators to perform the following actions to help mitigate the risks:   * Proactively identify and examine systems where SSH keys are used     as part of automated processes. These keys will typically not have     passphrases or passwords.   * Encourage users to use the keys with passphrase or passwords to     reduce the risk if a key is compromised.   * Review access paths to internet facing systems and ensure that     systems are fully patched.  If a compromise is confirmed, US-CERT recommends the following actions:   * Disable key-based SSH authentication on the affected systems,     where possible.   * Perform an audit of all SSH keys on the affected systems.   * Notify all key owners of the potential compromise of their keys.  US-CERT will provide additional information as it becomes available. ==== This entry is available at http://www.us-cert.gov/current/index.html#ssh_key_based_attacks  -----BEGIN PGP SIGNATURE----- Version: GnuPG v1.4.7 (GNU/Linux)  iQEVAwUBSLRdn3IHljM+H4irAQKmTgf5AW2MfvEfRvH2sSws8iVGeu37pUFtGAvS Vc9e8zmLxZKrPOnkLE/Ix2BFttRXexTnpprPlDVc9S32XuEtWUqwZHmTt7o90Rwa 1HM26/DfAJRLl0V9GAPDlL58l1C0mty6tGDUg64MkgqipfgaLpd1B6krCLPpgfHy Yofo5biqOPDfi+KylqNKlCXbaasscVNFXSZON4ZRdQfPHrOv8vJcQ0jc5rnUyizM GsHASGh8bunmZk+Ur5MoowsR8zLam/RDuiehgGlZE6DPhmfA6v5gocBT25sgHGk2 xHGnOyovlIsytabMvc3FCzsEXGV/wT25tnqeEVQU0k6Zu128qmhFFw== =b59K -----END PGP SIGNATURE----- </pre>

---++ Attack Vector
 The attackers have been stealing SSH keys to compromise more accounts and machines. If the attacker got root access all keys which are not protected by a password or by other special measures should be regarded as compromised.

The keys might easily be used to attack further hosts and should be disabled at your site and everywhere else, too.

Please send any malicious SSH keys or their fingerprints (ssh-keygen -l -f <keyfile>) that you may have discovered to both [[mailto:project-egee-osct@cern.ch][project-egee-osct@cern.ch]] and [[mailto:cert@dfn-cert.de][cert@dfn-cert.de]].

It appears the same rootkit has been used at different sites: http://packetstormsecurity.nl/UNIX/penetration/rootkits/phalanx-b6.tar.bz2

Different versions of this rootkit have been discovered. It uses /dev/mem to manipulate the kernel and modify the hooks for some system calls. /dev/shm is used for staging, storing some of the file. The same directory is used by the python script.

If the rootkit was used with the same configuration on your host, you will find:
   * The directory '/etc/khubd.p2/' is not listed by 'ls /etc' but can be entered with 'cd /etc/khubd.p2/'. Alternatively, the directory '/etc/lolzz.p2' has been used in one incident 
   * In '/dev/shm/' there might be files of the attackers 
   * If you create a directory named 'khubd.p2' it will also not be shown by 'ls' but you can enter it 

The DFN-CERT tested the rootkit concerning the backdoor. A simple nmap scanning does not reveal anything. An infected system does also not start communication of its own - at least not with the version tested. There were quite special communication patterns seen regarding the U Calgary IP address which might be the information needed to start the backdoor. This might be similar to the mechanism of the suckit rootkit.

Artifacts found on the compromised hosts:

   * .p2rc some sort of config file setting aliases for copying stuff by ssh and with ssh-keys provided 
   * .phalanx2 loader of the rootkit and probably backdoor 
   * .sniff sniffer log 
   * sshgrab.py python script for collecting ~/.ssh dirs and shell histories of all users if readable 

It's been reported that the following root exploit has been found on one of the compromised hosts:
   * http://secwatch.org/exploits/2006/07/raptor_prctl.c which lists 
   * Vulnerable platforms: Linux from 2.6.13 up to 2.6.17.4 

and references http://nvd.nist.gov/nvd.cfm?cvename=CVE-2006-2451 but we don't know if this is the only local kernel exploit involved.

Mingchao (EGEE) compiled below the kernel versions of the hosts that have been root compromised:

   * Kernel: 2.6.22.7-57.fc6 
   * Kernel: 2.6.22.1-32.fc6 
   * Kernel: 2.6.22.14-72.fc6 
   * Kernel: 2.6.22.9-61.fc6 
   * Kernel: 2.6.20-1.2962.fc6 
   * Kernel: 2.6.22.9-61.fc6 
   * Kernel: 2.6.22.9-61.fc6 
   * Kernel: 2.6.22.14-72.fc6 
   * Kernel: 2.6.9-67.0.15 (SL4) 
   * Kernel: 2.6.9-67.0.20 (SL4) 
   * Fedora-Core-4/2.6.17-1.2142_FC4 
   * Fedora-Core-3/2.6.12-2.3.legacy_FC3smp 
   * Suse 10.0 kernel 2.6.13-15-default 

Most of the discovered root exploits affect old/unpatched kernels, for instance: http://www.milw0rm.com/exploits/2006 (Vixie cron exploit)

---+++ Rootkit detecting script
 This tool is kindly provided by Jens-Soenke Voeckler at ISI.EDU

It (file crk.gz) is available at:

https://osct.web.cern.ch/osct/4adef051e1fa64603e0d3646110a194c/

---+++ Suspicious SSH key detecting tool
 This tool is kindly provided by Andreas Bunten at DFN-CERT

They are available at:

https://osct.web.cern.ch/osct/4adef051e1fa64603e0d3646110a194c/

---+++ Common attack patterns

Leif Nixon (NSC) kindly provided below a list of a similarities in the attack patterns that were reported. This may help sites discover compromised accounts.
   * disabling command line history logging with export HISTFILE=/dev/null or unset HISTFILE, 
   * starting out intrusions with a set of brief noninteractive logins across multiple candidate systems that scout out the systems, typically running "id", "w", "uname -a", "mount" and similar, before choosing a target host and trying to root it, 
   * trying to use nfsshell to get elevated write privileges over NFS, 
   * logging in using "ssh <host> /bin/sh -i" or "ssh <host> /bin/bash -i", rather than just "ssh <host>". 

---++ Status

   * *Status*: _OPEN_ 
   * *Lead*: Jim Basney (+1 217 244 1954 / +1 217 778 4398 / jbasney@ncsa.uiuc.edu) 
   * *Responders*: Mine, Jim, Doug 
   * *GOC Ticket Numbers*: 5350, 5435 
   * *References*: CERNCERT-20080805, DFN-CERT#38506, [JANET_CSIRT #323555], [JANET_CSIRT #323557], [JANET_CSIRT #323559], [JANET_CSIRT #323561], [JANET_CSIRT #323563] 

_Optionally include additional status information here._

---++ Analysis

   * *Severity*: High: hacker activity is ongoing with risk of compromise 
   * *Urgency*: High: please give this incident a high priority during business hours. Reactions within one business day are expected. 

---++ Mitigation Plan

---+++ Actions to take

1) Our first action is to contact USAtlas and Atlas security officers and obtain a report (see above email from Dantong Yu)

2) Receive confirmation from EGEE to re-distribute the announcement (has already obtained as of 08-05 17:00 )

3) receive ET approval over OSG announcement (obtained 08-05-2008 around 6 pm)

4) send announcement to OSG sites and ask them to watch malicious IP addresses and the above user certificate. Sites should be able to automatically update their GUMS server

they should report any suspicious activity in this user's account and from above IP addresses.

two announcements sent out on 08-06-2008

5) We can possibly check whether sites have updated from Atlas VOMS server. This is optional and not necessary.

New actions based on new information received 08-19-2008:

6) Inform OSG sites about ongoing activity and coordinate with other incident response organizations.

---+++ How to monitor progress

We can use Gratia checks to see whether any jobs have been submitted with Karl Harrison's certificate.

We can also check if all sites have updated their GUMS server. We can send a notification. This is optional.

Coordinate with DFN-CERT, EGEE OSCT, and others.

---+++ Acceptable response time estimate

Response is expected within one business day.

---+++ List of affected parties

All OSG sites who accepted Atlas users are affected by two user accounts compromised. We believe that previous incidents at U Chicago and German Grid did not affect the OSG. We are informed that no user certificates have been compromised in both incidents.

---+++ Definition of End Of Event

Close of event will occur when, based on information from OSG sites and other CERTs, we determine that the high risk has passed.

---++ Incident Log
---+++ Communication with Atlas 08-05-2008

We contacted USAtlas and Atlas security officers and received the following report from Dantong Yu:

Please make announcement to the OSG site. I checked various system in BNL, and did not discover any suspicious activities from this particular user. I asked Jay to suspend this user from the ATLAS VOMS server. Alessandro agreed to remove this user from Atlas VOMS.

Here is what we found: <br /> <br /> 1) This user has a local account, but he has no activities in past few years. His logon shell is /bin/tcshnologin. Our system admin is pretty sure that BNL is not affected by this user. <br /> <br /> 2) We checked that our OSG gatekeeper logs. We did not see any job submitted by this user. <br /> <br /> 3) GUMS shows that this user was mapped to usatlas4 account. <br /> <br /> 4) The ATLAS analysis framework shows that this user submitted a job on 2006-04-12 10:15:58. We removed this user from ATLAS database to prevent him from submitting jobs.

---+++ The Sites Affected so far(including non-OSG sites)

The D-Grid, U Chicago and CERN incident have been reported on 08-05-2008. The remaining sites are reported on 08-06-2008.

1) First attack has affected the German Grid and been reported to EGEE. German Grid has some sites registered in EGEE and it is a national grid. The earliest report dates back to 8/4/2008 by an email from EGEE. NONE of these sites are registered with OSG.

The attacks on the German hosts seem to have come from:<br /><br />- - 208.42.23.94 - 2008-07-28 01:52:53 GMT+02<br />- - 216.186.49.132 - 2008-07-26 17:02:12 GMT+02<br />- - 75.60.89.233 - 2008-07-26 23:16:40 GMT+02<br /><br />We assume that the stolen ssh keys were transfered to:<br /><br />- - 136.159.55.31 - 2008-07-28 02:16:14 GMT+02<br /><br />RAL observed additional suspicious connection attempts from:<br /><br />- - 189.6.137.174 - 2008-07-14 10:37:44 GMT+02<br />- - 190.81.35.90 - 2008-07-14 14:08:59 GMT+02

FZ Juelich - Breakin 2008-07-28 00:34:13 GMT+02 from 216.186.49.132

Universitaet Wuppertal - Breakin 2008-07-26 17:02:12 GMT+02 via account "petrov"

Jul 26 17:02:12 jpsi sshd[9535]: Accepted publickey for petrov from 216.186.49.132 port 3664 ssh2

Break in via frontend of a small cluster of the theortical physics department. There is no grid middleware. ssh keys were stolen and from there workstations were compromised and more ssh keys stolen. The cluster in Wuppertal was not part of D-Grid.

DESY - Attempts maybe from 131.142.42.17 (2008-07-25 15:08:31 GMT+02) and 216.186.49.132 (2008-07-25 20:07:00 GMT+02) - it's not yet clear if this was legitimate (but we doubt it). No breakin.

The IP addresses include:
   * 134.94.104.3 
   * 134.94.74.11 
   * 134.94.74.111 
   * 134.94.169.134 
   * 134.94.170.60 
   * 134.94.76.31 
   * 134.94.76.32 
   * 134.94.169.124 
   * 134.94.170.30 
   * 134.94.2.72 
   * 132.195.105.39 
   * 132.195.105.51 
   * 132.195.105.56 
   * 132.195.105.204 

2) Another very similar attack has been detected at U of Chicago and has been posted at http://hep.uchicago.edu/admin/report_072808.html

U Chicago confirmed that NO OSG resources at U of Chicago have been affected and therefore there is no OSG incident. <br />Attack probably from bonner-pcs2.rice.edu - 168.7.16.22<br /><br />Hosts involved:
   * 128.135.102.235 cdfs4 
   * 128.135.102.231 cdfs3 
   * 128.135.102.236 cdfs5 
   * 128.135.102.211 putin 
   * 128.135.102.212 rumsfeld 
   * 128.135.102.181 cdf7 
   * 128.135.102.162 cp5 
   * 128.135.102.119 cdf44 
   * 128.135.102.228 pnn 
   * 128.135.102.175 cptest 
   * 128.135.102.170 nutest 
   * 128.135.102.144 cdf27 
   * 128.135.102.153 cdf29 
   * 128.135.102.157 rodman 
   * 128.135.102.223 hepelog 

<br />4) rice.edu - no information received. Rice is NOT an OSG site

5) CERN confirmed short but successful SSH connections from one of the malicious IP addresses below and is currently actively investigating the affected hosts. (NOT OSG)<br /><br />Jul 25 19:45:40 lxplus011 sshd[14080]: Accepted publickey for karl from<br />216.186.49.132 port 3399 ssh2<br />Jul 25 19:46:09 lxplus239 sshd[19137]: Accepted publickey for karl from<br />216.186.49.132 port 4322 ssh2<br /><br />Karl Harrison's account is believed to be compromised and has been blocked at CERN. Karl submitted a small number of<br />grid jobs, which are currently being investigated.<br /><br />More successful SSH connections have been detected between Jul 25<br />19:37:19 UTC+2 and Jul 25 20:11:09 UTC+2, involving 3 more users, but<br />none of them are grid users.<br /><br />While forensics are still ongoing, there is so far no evidence that the<br />attacker managed to obtain root access at CERN.

EGEE/CERN Security officer has not confirmed whether this user's X509 certificate is also compromised.

See affected users section below for more information

6) Cambridge pcet.hep.phy.cam.ac.uk - Breakin 2008-07-14 18:56 UTC+1:<br /> The same rootkit has been found at the host<br /> cet.hep.phy.cam.ac.uk (131.111.66.23), which belongs to one of<br /> UK GridPP sites. It appears to have been installed on *14 July<br /> 2008 at 18:56*. From the datestamp on the sshgrab.py file and<br /> Cambridge CERT reports on traffic to 136.159.55.31 it appears<br /> that the ssh keys were collected up to 25 July. The site<br /> involved is actively investigating into it. NOT OSG<br /><br />7) UK RAL Tier1 has detected a successful ssh login from the malicious IP<br />(216.186.49.132). Tier1 staff are actively looking into it and so far<br />there is no signs of rootkit or local system compromise. NOT OSG<br /><br /> Jul 25 18:38:45 lcgui0357 sshd[5575]: Accepted publickey for brochu<br />from 216.186.49.132 port 4490 ssh2<br /> Jul 25 18:39:06 lcgui0358 sshd[24060]: Accepted publickey for brochu<br />from 216.186.49.132 port 2668 ssh2<br /><br />The account being used for login is brochu, whose DN is:<br /><br />/C=UK/O=eScience/OU=Cambridge/L=UCS/CN=frederic brochu<br /><br />So far no evidence of his certificate being comprised.<br />See affected users section below for more information

<br />Additional unsuccessful SSH connections attempts were detected:<br /><br />Jul 14 10:37:44 goc02 sshd[7969]: Invalid user harrison from 190.81.35.90<br />Jul 14 10:37:44 goc02 sshd[7970]: input_userauth_request: invalid user<br />harrison<br />Jul 14 10:37:44 goc02 sshd[7970]: Failed password for invalid user<br />harrison from 190.81.35.90 port 55738 ssh2<br />Jul 14 10:37:44 goc02 sshd[7969]: Failed password for invalid user<br />harrison from 190.81.35.90 port 55738 ssh2<br /><br />Jul 28 14:08:59 lcgui0358 sshd[551]: Failed password for karl from<br />189.6.137.174 port 52925 ssh2<br />Jul 28 14:24:38 lcgui0358 sshd[1682]: Illegal user karla from 189.6.137.174<br />Jul 28 14:24:40 lcgui0358 sshd[1682]: Failed password for illegal user<br />karla from 189.6.137.174 port 49622 ssh2<br /><br />8) UK RAL PPD has detected a successful ssh login, the host involved is a<br />CVS server, no evidence of local compromise or sign of rootkit. NOT OSG<br /><br /> Jul 25 18:52:16 heplnx183 sshd[24802]: Accepted publickey for<br />chapman from 216.186.49.132 port 3997 ssh2<br /><br />9) University of Durham (NOT OSG): unsuccessful SSH connections attempts detected:<br />Jul 28 01:51:13 ui sshd[32183]: Invalid user gieseke from<br />::ffff:216.186.49.132<br />Jul 28 01:51:14 ui sshd[32184]: Connection closed by<br />::ffff:216.186.49.132<br />Jul 28 01:52:48 ui sshd[32194]: Invalid user stefan from<br />::ffff:216.186.49.132<br />Jul 28 01:52:49 ui sshd[32195]: Connection closed by<br />::ffff:216.186.49.132<br />Jul 28 01:53:31 ui sshd[32199]: Connection closed by<br />::ffff:216.186.49.132<br />Jul 28 01:54:12 ui sshd[32203]: Invalid user uwer from<br />::ffff:216.186.49.132<br />Jul 28 01:54:12 ui sshd[32204]: Connection closed by<br />::ffff:216.186.49.132

10) Information Science Institute, University of Southern California<br />Phalanx2 Rootkit on 3 of 7 machines. No details yet. NOT OSG<br /><br />11) CPPM-IN2P3 (NOT OSG) discovered unsuccessful connection attempts from one of the<br />malicious IP addresses:<br /><br />Jul 25 19:52:03 marlhcb sshd[10587]: Invalid user yingying from<br />216.186.49.132<br />:Jul 25 19:52:03 marlhcb sshd[10587]: Failed none for invalid user<br />yingying from 216.186.49.132 port 3502 ssh2<br />Jul 25 19:52:04 marlhcb sshd[10587]: Failed publickey for invalid user<br />yingying from 216.186.49.132 port 3502 ssh2<br />Jul 25 19:52:04 marlhcb sshd[10587]: Connection closed by 216.186.49.132<br /><br />12) Cambridge (UK) discovered SSH traffic between a local host and<br />136.159.55.31 from 22 July to 25 July. More information will be<br />available pending forensics. Not OSG<br /><br />13) ELTE (Hungary): Breakin via account "petrov" from 216.186.49.132 at<br />2008-07-26 16:54 GMT+02. NOT OSG<br /><br />Jul 26 16:54:43 pms7 sshd[3761]: Accepted publickey for petrov from<br />216.186.49.132 port 2542 ssh2<br /><br />The frontend to a large cluster was compromised and they are investigating.<br /><br />14) uiuc.edu - University of Illinois at Urbana-Champaign<br />We have a registered OSG site at UIUC. However, this does not seem to affect OSG site. We asked for confirmation. Below is JimBarlow's initial report.

The uiuc.edu cluster below is actually hosts on NCSA's network. We discovered<br />the compromised accounts on 7/26 and pretty much cleaned up from the<br />incident. A report was sent to the TG incident-report email address and<br />discussed on TG security-wg incident calls. When the DFN-CERT sent out<br />information to the FIRST mailing list I responded to them with our information,<br />which is how it came to be included in the information below. I am working<br />with DFN-CERT on this a bit more to see what comes forth. If anyone wants<br />to know more info, then let me know.

<br />15) Harvard - No contact yet. 131.142.42.17 might be involved. Breakin or attempts from 216.186.49.132 2007-07-25 and 131.142.42.17<br />Harvard has several resources registered with OSG. We sent an email and asked site admin for confirmation (Ian Syokes-Rees).

16) University of Minnesota - Attempts from 216.186.49.132 at 2008-07-25<br />17:28:30 GMT to 22:37:35 GMT. Does not look like they gained access. Not an OSG member

---+++ User Affected So Far

There are two users known to be affected so far.

1) Karl Harrison's account at CERN has been compromised (reported and suspended by Atlas on 08-05-2008). EGEE/CERN Security officer has not confirmed whether this user's X509 certificate is also compromised. In OSG, this user has the following access rights:

"/C=UK/O=eScience/OU=Cambridge/L=UCS/CN=karl harrison002" "/atlas" usatlas4

Atlas and USAtlas Security Officers have confirmed that the last activity submitted by this user is dated 2006-04-12 10:15:58. They think that there should not be any active jobs submitted by this user recently. Atlas officers have removed this user from the Atlas VOMS as a precaution and will ask him to get a new certificate.08-05-2008

2) Frederic Brochu's account has been compromised on UK RAL Tier1 reported on 08-06-2008. His DN is "/C=UK/O=eScience/OU=Cambridge/L=UCS/CN=frederic brochu" with FQAN /atlas, and mapped into usatlas4 in default OSG There is so far no evidence that the private key of the certificate of both users has been compromised. Atlas security officer agreed to suspend this user from Atlas VOMS server.

---+++ Stolen SSH Keys

Suspicious SSH fingerprints (ssh-keygen -l -f )
   * 1024 25:9f:21:3d:5a:c3:86:10:fb:24:4a:66:38:dd:2c:51 
   * 1024 38:74:dd:55:69:a3:14:f0:67:c4:6d:68:f3:f6:da:37 
   * 1024 1c:f4:3e:22:98:78:40:ab:02:5e:56:e8:f9:25:9d:da 
   * 1024 27:28:15:85:1d:64:41:68:5d:89:b5:91:37:fc:d5:29 
   * 1024 86:ce:d0:8e:2e:3e:a5:ee:3a:e1:89:bf:71:34:11:2f 
   * 1023 3e:1f:a8:15:02:3c:0a:b8:70:2f:df:e4:90:cc:3f:ec 
   * 1024 cb:da:15:07:68:94:22:f2:48:6d:10:0c:b0:a5:b0:17 
   * 2048 6c:9a:81:93:63:21:73:d1:71:07:b8:22:aa:fa:d7:a4 
   * 1024 de:0d:5c:55:86:13:2d:f0:91:58:06:08:62:7a:7c:0b 
   * 2048 5b:b5:84:f6:96:43:44:84:3c:dd:c2:3e:01:57:75:a2 
   * 2048 60:c0:9e:ce:e2:bd:2d:d8:40:07:7d:24:95:49:4e:e1 
   * 1024 0a:0f:b0:db:c9:52:71:f8:99:84:20:c2:cf:e5:5c:37 
   * 1024 0c:c3:d5:9d:6f:33:a6:cf:62:e1:64:fd:6a:ee:2b:83 
   * 1024 1d:ad:dd:3d:ab:5d:b2:09:75:66:e4:77:ed:a7:a1:c9 
   * 1024 1f:c2:58:b1:b7:8a:5d:78:67:de:a6:d2:d8:7d:ff:72 
   * 1024 21:84:5a:70:37:eb:95:48:15:19:5d:d2:9e:ca:aa:0d 
   * 1024 29:0f:dc:a7:7d:39:67:26:32:b2:ed:d6:7d:6d:7e:d8 
   * 1024 2f:8a:b7:78:9b:5d:11:c9:f8:4b:1c:da:73:2c:2e:c8 
   * 1024 37:4a:f2:ae:39:12:3f:ae:89:48:5a:b4:ba:b3:ac:bd 
   * 1024 40:27:f9:ca:25:74:69:66:11:cc:12:39:70:c0:3d:94 
   * 1024 41:9a:ec:cd:2d:88:54:ba:a1:b9:c7:4f:2e:cc:8b:5f 
   * 1024 43:6c:df:1f:ac:a8:bf:8d:ab:bd:13:b8:f4:0a:57:b4 
   * 1024 47:9b:1f:af:94:62:f2:8b:09:95:0f:fa:8b:22:c4:f0 
   * 1024 6c:da:d1:38:4d:b9:fc:e4:d4:05:9a:26:34:b2:f2:10 
   * 1024 8b:6e:0c:1b:05:0e:02:9c:9c:c0:10:bc:37:68:65:d6 
   * 1024 8d:62:09:96:2e:8c:5e:6e:96:0f:bc:92:9a:bd:59:67 
   * 1024 8e:f6:02:09:d8:77:34:70:56:b9:23:f1:2f:8d:bb:b9 
   * 1024 93:90:83:e4:b4:48:b2:b3:57:68:c2:76:78:b1:fd:2a 
   * 1024 a1:87:35:98:49:1b:15:0e:f4:34:a6:f6:8a:a2:aa:0d 
   * 1024 a2:6d:b2:81:05:af:e4:a2:6b:01:3a:38:5d:5c:97:7d 
   * 1024 a8:6f:41:f6:fc:45:24:f8:df:22:98:3d:c6:02:69:d6 
   * 1024 ad:31:76:34:b1:be:3d:7a:25:c9:8c:74:6f:a5:2c:6b 
   * 1024 b0:e4:43:4a:75:23:73:47:29:aa:b9:3b:3f:f6:08:70 
   * 1024 b3:23:85:20:cb:e9:72:8b:98:ee:a4:48:92:3a:19:bd 
   * 1024 c3:c9:02:2a:bc:2f:da:09:09:fa:53:5a:94:05:72:d2 
   * 1024 cb:1b:c5:42:4a:7e:8d:32:a7:7c:f0:48:d1:7e:32:73 
   * 1024 cf:1a:d6:f4:f6:ee:10:1c:d8:44:1e:58:67:93:22:cc 
   * 1024 cf:60:52:f2:d6:30:38:98:b8:d9:18:9f:a4:85:54:df 
   * 1024 d0:bb:39:1d:81:2b:0d:43:41:aa:8b:1e:f1:2b:15:d3 
   * 1024 d1:5b:0f:81:e9:0f:35:2c:9a:7c:79:9a:b8:9c:1c:73 
   * 1024 d6:fc:d6:80:e0:10:74:f8:95:6b:a1:74:81:fa:77:2d 
   * 1024 dd:f5:1a:6f:58:85:47:ff:21:74:e3:64:2a:dd:23:83 
   * 1024 e7:6c:c8:cb:b6:1e:00:60:08:5c:1d:4e:16:04:5a:57 
   * 1024 e8:56:d7:37:3b:88:6e:36:41:a3:2d:23:b5:03:93:82 
   * 2048 72:b3:ec:e6:ee:44:86:04:22:dd:ec:06:b7:b8:82:19 
   * 2048 7a:c5:95:fb:3a:84:42:e3:0a:f8:77:a3:b6:43:69:96 
   * 2048 93:df:9d:92:76:8a:83:8d:36:cb:75:ac:6a:e3:28:df 
   * 2048 e5:df:19:e0:9d:eb:e0:57:16:8e:09:ef:e4:04:d8:75 
   * 2048 e7:cf:bb:6f:27:e9:a4:13:fa:cf:3f:6a:ab:f8:a3:fc 
   * 2048 e9:cc:60:cb:b8:d8:f3:d6:2f:85:99:ad:4d:05:c2:f0 
   * 2048 ee:a9:5b:a9:19:f5:3c:69:3d:23:be:bd:f3:2b:69:74 <pre> </pre> 

---++ Incident Log (continued)

08-07-2008 9am: Ian stokes Rees responded to our email saying that none of the OSG resources under his control at Harvard has been affected

08-07-2008 we did gratia queries over Karl and Frederic's certificates across all OSG reporting sites.

the query used for these searches is:

select * from VOProbeSummary where CommonName like "%karl harrison%"

We found a single record for Karl
|  *#* | |  *EndTime* | |  *VOName* | |  *ProbeName* | |  *CommonName* | |  *ResourceType* | |  *Njobs* | |  *WallDuration* | |  *CpuUserDuration* | |  *CpuSystemDuration* |
|  1 | |  2007-09-22 00:00:00.0 | |  lhcb | |  condor:osgce.hepgrid.uerj.br | |  karl harrison | |  Batch | |  1 | |  1,149 | | 0 | | 0 |
| *Number of records = 1*  |||||||||||||||||||

Apparently job has ended long before

and we could not find any job record from Frederic

08-07-2008 5:30 pm: emailed John Huth at harvard to confirm usatlas at harvard is secure

08-08-2008 11:00 am Have not heard from John Huth. Emailed Suvendra Nath Dutta and John Brunelle : both aregris security contacts.

Immediate response from them received. Suvendra does not see any malicious IPs in its network logs.

08-08-08 11:30 am: Another response from Suvendra Nath Dutta

The 216.186.49.132 address appears to be a washington address:

% whois -h whois.arin.net 216.186.49.132 Washington State K-20 Telecommunications Network WA-K20-BLK3 (NET-216-186-0-0-1) 216.186.0.0 - 216.186.127.255 Quinault Lake School District No. 97 WSKT-58 (NET-216-186-49-128-1) 216.186.49.128 - 216.186.49.255

# ARIN WHOIS database, last updated 2008-08-07 19:10

# Enter ? for additional hints on searching ARIN's WHOIS database.

The 131.142.42.17 is in fact a Harvard address at the Center for astrophysics. Steve Beikman [[mailto:sjb@head.cfa.harvard.edu][]] informs us:

"131.142.42.17 was taken off line two weeks ago. On the morning of Friday, July 25, around 10:30am, it's network disabled. We've been investigating this since. US and German CERT are involved, along with several .edu and research sites."

-- Main.MineAltunay - 07 Aug 2008

---++ Incident Log 080819

08-19-2008: This incident is ongoing.

Still no OSG sites known to be affected. Received a list of additional IPs from Romain, and they do not match any OSG hosts (%RED%see revision below%ENDCOLOR%).

Received a longer list of IPs from DFN-CERT, and OSG sites appear to be involved. Jim and Doug are investigating.

Sent advisory to OSG security contacts.

-- Main.JimBasney - 19 Aug 2008

A busy day today. we were given an additional long list of possibly compromised hosts by Andreas Bunten of CERT-DFN in email at 06:14 PDT, about 1000 hosts. These included the CE node at the Atlas Tier2 at UChicago (tier2-osg.uchicago.edu).

The lists of hosts were sent to incident-discuss-l today, a complete list and a copy sorted and identified by which OSG resource they are near. You can check the archives at https://listserv.fnal.gov/scripts/wa.exe?A0=INCIDENT-DISCUSS-L.

-- Main.DougOlson - 19 Aug 2008

08-20-2008:

Doug contacted all OSG sites associated (or near to) possibly compromised systems reported by CERNCERT/DFN-CERT.

Larry Nelson reports a large number of unsuccessful ssh attempts on osg.hep.uiuc.edu systems.

Update 4 received from CERNCERT with new IP addresses.

---++ 08-19-2008 Advisory for OSG Security Contacts

<pre>-----BEGIN PGP SIGNED MESSAGE-----  Hash: SHA1   OSG security contacts,   This is a follow-up to the OSG security advisories sent August 6 regarding ssh  attacks against grid sites in Europe and the US.  Please be aware that this  widespread security incident is ongoing.  The attacker(s) have been stealing  ssh keys to compromise accounts and using local kernel exploits to gain root access.   Rootkits have been installed and ssh keys have been systematically stolen and  used to compromise further sites.  Some sites report only account compromises (no root escalation) and some other have simply detected unsuccessful ssh scans.   At this time, no OSG systems are confirmed to be compromised, but at least one  OSG CE is suspected compromised.  The incident and the investigation are ongoing.   If you are aware of any security compromise affecting OSG (for example,  if grid certificates are suspected to be compromised), please immediately  report it to security@opensciencegrid.org.   The OSG security team will be communicating individually with the security contacts  of resources suspected to be compromised.  Please note that the security of services  and resources accessed through OSG is primarily the responsibility of the service and  resource providers. Please do work immediately with your site's incident response team  regarding any security incident on your systems, as well as let security@opensciencegrid.org  know about it.  The OSG incident response team primarily fulfills a coordination role and will work with  you and your site security teams as such.  All sites should check their status and actively  monitor for ssh connection attempts from suspicious IP addresses and instances of suspicious  ssh keys, files, and malware as described below.  We also encourage sites to use firewalls  to restrict ssh access to OSG systems, so that ssh connections are allowed only from  trusted hosts.   Artifacts found on compromised hosts include:     * .p2rc: config file setting aliases for copying data by ssh and with    ssh-keys provided    * .phalanx2: loader of the rootkit and probably backdoor   * .sniff: sniffer log    * sshgrab.py: python script for collecting ~/.ssh dirs and shell   histories of all users if readable    ******************************************** * Rootkit detecting script * ********************************************  This tool is kindly provided by Jens-Soenke Voeckler at ISI.EDU  It (file crk.gz) is available at:   https://osct.web.cern.ch/osct/4adef051e1fa64603e0d3646110a194c/   Please note: there is no any guarantee whatsoever, use it at your own risk!   ******************************************** * Suspicious SSH key detecting tool * ********************************************  This tool is kindly provided by Andreas Bunten at DFN-CERT  It (file dowkd.pl.gz) is available at:   https://osct.web.cern.ch/osct/4adef051e1fa64603e0d3646110a194c/   Please note: there is no any guarantee whatsoever, use it at your own risk!   The information above was kindly provided by the DFN CERT (NREN in Germany),  the SWITCH CERT (NREN in Switzerland), the EGEE Operational Security Coordination Team,  and several CSIRTs from WLCG sites.  For the latest information from OSG about this incident,  please see:  https://twiki.grid.iu.edu/bin/view/Security/OSG-SEC-08-05-2008   The above page requires a twiki logon for access.   To obtain a twiki logon, please see:  https://twiki.grid.iu.edu/bin/view/TWiki/TWikiRegistration   This notice is signed by the OSG Security PGP key.   For details, see:  https://twiki.grid.iu.edu/bin/view/Security/SecureEmail   Sincerely, Jim Basney and Doug Olson OSG Security Team  security@opensciencegrid.org  -----BEGIN PGP SIGNATURE-----  Version: GnuPG v1.4.9 (Darwin)   iEYEARECAAYFAkirREgACgkQs5kqP2b0Vsw05QCeLLYkF/a5fUYouxrZojS3vmPk e/sAoIRTKS3ZlWqbQ1f+q6VAcMtpYQtp =uFSn  -----END PGP SIGNATURE----- </pre>

---+++ Follow up with OSG sites having hosts "near" targets
| <strong>Resource <br /></strong> | *Contact* | *Status* | *Comments* |
| !McGill HEP | Adrian Buzatu | no impact | info Andreas Warburton, one gatekeeper was in the target list |
| CalTech CMS T2 | Michael Thomas | no impact | |
| SLAC | security@slac | no impact | |
| MWT2_ATLAS_UC | Charles Waldman | no impact | one gatekeeper was in the target list |
| UC Teraport | Greg Cross | no impact | info from Rob Gardner and Ti Leggett, Greg looking at ssh-key overlap with Teraport |
| UCSD CMS T2 | Terrence Martin | no impact | |
| NCSA | Jim Basney | no impact | |
| UMD CMS | Malina Kirn | no impact | |
| AGLT2 | Thomas Rockwell | no impact | |
| UNM HPC | Dan Felker | no impact | no impact on CE, no grid activities on target node |
| GLOW (+ATLAS, +CMS) | Dan Bradley | no impact | |
| BNL Tier1 | John Hover | no impact | |
| NERSC | security@nersc | no impact | |
| Cinestav | Alberto Sanchez-Hernandez | no impact | |
| | | | |
| Sites with known grid impact || 0 | |
| Awaiting response/confirmation from sites || 0 | |
| | | | |

-- Main.DougOlson - 27 Aug 2008

CERNCERT-20080805 [UPDATE 5] received:

<pre>
*******************************************************
* What's new since the last update (Thu 2008-08-20 )? *
*******************************************************

- Further attacks discovered
- New patterns
- New suspicious IP addresses
- Updated tools

******************************
* Further attacks discovered *
******************************

- New suspicious IP addressed revealed a suspicious connection to/from CERN on
2008/05/26-23:00:39 UTC+2. The account linked with this connection has been
suspended. The account belongs to a system manager at physto.se.
The user changed his password at CERN on 2008-07-10, and it is believed the
attacker has not connected since then.

- On Sep 3, it was discovered that the department physto.se at
Stockholm University (130.242.128.0/24, 130.237.209.0/24) has had password
sniffers installed on several machines since a root intrusion on May 15.

While physto.se don't run any grid systems and the intruder has shown
no interest for grid systems, all grid certificates belonging to
physto.se users will be revoked as a precaution.

These include at least

	/O=Grid/O=NorduGrid/OU=physto.se/CN=Jorgen Sjolin
	/O=Grid/O=NorduGrid/OU=physto.se/CN=Karl Gellerstedt
	/O=Grid/O=NorduGrid/OU=physto.se/CN=Torbjorn Moa
	/O=Grid/O=NorduGrid/OU=physto.se/CN=Christian Ohm
	/O=Grid/O=NorduGrid/OU=physto.se/CN=Marianne Johansen
	/O=Grid/O=NorduGrid/OU=physto.se/CN=Philippe Mermod
	/O=Grid/O=NorduGrid/OU=physto.se/CN=Henrik Johansson

Of these, all but the last are members of the ATLAS VO. The last DN
only belongs to a local Swedish IceCube VO.

**************************
* Common attack patterns *
**************************

It has been discovered that successful connections to the backdoor may
produce the following syslog message (usually in /var/log/secure, /var/log/message):

---------------8<------------------
sshd[XXXX]: Disconnecting: Bad packet length 1883783500.
---------------8<------------------
(where XXXX is the PID of sshd)

It is possible to remotely check for signs of the backdoor using the script
"phalanx2_trigger-1.0.sh", but please note the script will generate a false
positive message in the log files "Bad packet length 1883783500." of the machine
that is being remotely checked.

The password collector used by the attackers has also been found at:

/usr/include/linux/.cache/cl

************************************************
* New suspicious IP addresses as of 2008-09-04 *
************************************************

It is believed the attacker also logged in from:

- 208.35.255.106
- 66.230.230.230
- 209.181.122.222
- 207.225.248.150

The known list of suspicious IP addresses is now:

- 207.206.202.54
- 207.206.215.122
- 207.224.215.94
- 209.181.138.229
- 209.181.131.209
- 208.42.23.94/v-208-42-23-94.mn.visi.com
- 99.236.185.205
- 99.237.220.123
- 208.42.23.94
- 216.186.49.132
- 75.60.89.233
- 136.159.55.31

*************************************************
* Suspicious SSH key and rootkit detecting tool *
*************************************************

It is possible to use suspicious SSH keys and rootkit detecting tool provided by
the community. The tools on the page below are kindly provided by their authors
and do not come with any guarantee whatsoever, use it at your own risk!

https://cern.ch/osct/7e0564aeabe51c2b1c69570c8d931bf2
</pre>

Mine forwarded this information to OSG security contacts. This incident has not directly impacted OSG systems to-date, but we continue to actively monitor.

-- Main.JimBasney - 04 Sep 2008

---++ Summary

   * *Final Report*: [[https://osg-docdb.opensciencegrid.org:440/][OSG !DocDB Document ###]] 

_What was the resolution of the incident?_

_What is the long-term mitigation plan (including changes in our operations, middleware or anything else that enabled the event) and timeline?_

_Deposit the final incident report in !DocDB and fill in the !DocDB URL and document number above._

---++ Access Control

_Uncomment the appropriate access control policy for this incident page. Logout of the twiki and try to access the page to ensure it is not publicly accessible. Do not attach files, as they will not be protected (see [[http://twiki.org/cgi-bin/view/TWiki/TWikiAccessControl#Controlling_access_to_Attachment][http://twiki.org/cgi-bin/view/TWiki/TWikiAccessControl#Controlling_access_to_Attachment]])._

Incident information accessible by Security Team members and GOC only:

   * Set ALLOWTOPICCHANGE = Main.SecurityTeamGroup, Main.GocGroup                                           

Incident information accessible by all authenticated twiki users:
   * Set ALLOWTOPICVIEW = Main.GridGroup                                          

-- Main.MineAltunay - 05 Aug 2008
