%META:TOPICINFO{author="DougOlson" date="1153434195" format="1.1" version="1.11"}%
%TOC%

---+ OSG Registration Authority Information

The primary URL for contacting the OSG RA is http://www.opensciencegrid.org/ra.

---++ Instructions for Agents
---+++ Processing OU=People certificate requests
   1. Email notification received by agents has name of VO in the subject line.
      * E.g., *[doesg-ra] DOEGrids CA - OSG CMS Certificate Request in Queue (request id: NNNNN)*
      * identifies OSG as the RA and CMS as the VO.<br>
      * For a complete list of VOs see http://vors.grid.iu.edu/cgi-bin/index.cgi?region=0&VO=0&res=0&grid=1.
   2. An agent for the identified VO should follow the link in the email notice to see complete information about the request within one business day, and click the "assign to me" link to take ownership of the request when they have determined it is a request that the agent can process.
   3. Using the additional information provided in the request the agent should determine who are acceptable sponsors that can validate the request. This may or may not be the same as the sponsor shown in the request.
   4. Agent should contact the sponsor by email or telephone to confirm the request.
      * Agent can accept confirmation by telephone directly, if using previously validated telephone number for the sponsor.
      * If sponsor responds by email it must be digitally signed to verify the sponsors identity.
   5. If sponsor confirms the certificate requestor by an acceptable means, the agent can issue the certificate.
      * If the sponsor denies the requestor then the agent should reject the request.
   6. Agent should record a summary of the verification (or rejection) of the request.  This summary can be sent to osg-ra-log@opensciencegrid.org or to another archive maintained by the agent or VO.  If a different archive is used the location of the archive should be communicated to the OSG RA.  The recorded information should include 
      * Request identifier (for certification requests)
      * Description of action take (approve, reject, cancel, revoke, etc.)
      * Name and/or individual email address of Agent who processed the request.
      * Name of Sponsor who confirmed the request (in some cases the Agent is also the Sponsor).
      * For certification requests, statement of why the requestor qualifies to receive certificate, i.e., membership in a particular VO, or association with a science program participating with OSG.
      * Certificate serial number
      * Certificate subject name, i.e., DN

---+++ Processing OU=Services certificate requests
   1. OU=Services requests will have the domain name of the host for which the certificate is requested in the subject line of the notification email.
      * E.g., *[doesg-ra] DOEGrids CA - OSG hep.olemiss.edu Certificate Request in Queue (request id: NNNNN)*
      * shows OSG as the RA and hep.olemiss.edu as the domain name for a request with 
         * DN = CN=sam/umiss000.hep.olemiss.edu,OU=Services,DC=doegrids,DC=org
   2. An agent with responsibility for the domain should click on the link in the email notice to check the complete information for the request within one business day of receiving the notice.
   3. If the agent is able to process the request agent should click the "assign to me" link to take ownership of the request.
   4. If the requestor has a valid DOEGrids personal certificate then agent can issue the certificate.
   5. If the requestor does not have a  valid DOEGrids personal certificate then they need to be authenticated as described for a personal certificate request above before issuing the new certificate.
   6. Agent should record a summary of the verification (or rejection) of the request.  This summary can be sent to osg-ra-log@opensciencegrid.org or to another archive maintained by the agent or VO.  If a different archive is used the location of the archive should be communicated to the OSG RA.  The recorded information should include 
      * Request identifier (for certification requests)
      * Description of action take (approve, reject, cancel, revoke, etc.)
      * Name and/or individual email address of Agent who processed the request.
      * Name of Sponsor who confirmed the request (in some cases the Agent is also the Sponsor). Not needed if requestor has a valid personal certificate.
      * For certification requests, statement of why the requestor qualifies to receive certificate, i.e., membership in a particular VO, or association with a science program participating with OSG.
      * Certificate serial number
      * Certificate subject name, i.e., DN

---+++ Letter requesting new or renewed agent access
Agents for DOEGrids (OSG, and all other RAs) are required to send an email letter requesting
authorization for agent access at least once per year, digitally signed with the certificate
that will be authorized for access.  The RA must also send a confirmation letter to approve
the request for agent access.  Below is the example letter for agents (from Appendix A of the 
[[http://www.doegrids.org/Docs/CP-CPS.pdf][CP/CPS]]) with the OSG RA.  
In this letter you should
specify which VOs registered with OSG you will handle certificate requests for. See
the [[http://vors.grid.iu.edu/cgi-bin/index.cgi?region=0&VO=0&res=0&grid=1][OSG VORS]] for
a list of the VOs registered with OSG.

%BLUE%
To: doegrids-ca-1@doegrids.org

Cc: osg-ra@opensciencegrid.org

Dear DOEGRids Operations:

I %ENDCOLOR% %RED% [your name] %ENDCOLOR% %BLUE% will be as an Agent of the Registration Authority for OSG. I have been authorized 
by OSG and the following VOs (%ENDCOLOR% %RED% list your VOs here %ENDCOLOR% %BLUE% )
to represent them for the purposes of approving/revoking DOEGrids certificates in our community. 
I have read and agree to the following clauses:

   1. In acting as the Agent of the RA for OSG I have read, understood and accept the responsibilities and tasks assigned to an Agent as laid out in the DOEGrids CP/CPS. http://www.doegrids.org/Docs/CP-CPS.pdf.
   2. I understand that DOEGrids Certification Service will notify me by email of changes to CP/CPS and I will immediately notify the DOEGrids PMA if I am no longer willing to act as an Agent for my RA under any new CP/CPS.
   3. I understand that failure to fulfill my responsibilities and tasks under this agreement may result in the termination of my appointment as a Agent for OSG.
   4. I agree only to act on enrollment requests associated with the OSG.
   5. I understand that I am responsible for the revocation of certificates that are suspected of being compromised or issued in violation of the DOEGrids CP/CPS policies. 
   6. I understand that I am responsible for customer support for the OSG VOs shown above, related to DOEGrids certificate issuance, revocation and information.

%ENDCOLOR%

---+++ Letter requesting !GridAdmin privilege
The !GridAdmin interface to the DOEGrids CA allows site administrators to be authorized to
submit service certificate requests, authenticated with their personal certificate,
and have the signed service certificate issued immediately.
!GridAdmin is available both as a [[http://www.doegrids.org/Library/gridAdmin/gridAdminUser.html][web interface]] and from the cert-gridadmin [[CertScriptsPackage][script]].
To request this privilege, you should familiarize yourself with the Subscriber Obligations (Section 2.1.2) and Grid Admins (Section A.3.4) of the [[http://www.doegrids.org/Docs/CP-CPS.pdf][DOEGrids CP/CPS]].
Then you should send the following letter as email, digitally signed with your personal certificate to the OSG RA.

%GREEN%
To: osg-ra@opensciencegrid.org

Dear OSG RA,

I %ENDCOLOR% %RED% [your name] %ENDCOLOR% %GREEN% would like to be a Grid admin for OSG. I would like to be authorized to request and approve DOEGrids Service certificates for the following name space(s):

   a. FQDN 1 or range of addresses for a particular domain<br>
 b. FQDN 2<br>
 c. others<br>

   1. As the Grid Admin for OSG I have read and understand the responsibilities and tasks assigned to a Grid Admin as laid out in the DOEGrids CP/CPS. http://www.doegrids.org/Docs/CP-CPS.pdf.
   2. I agree that as Grid Admin I will only submit and approve Service certificates for the FQDNs listed above. 
   3. I understand that I am responsible for the revocation of certificates that are suspected of being compromised or issued in violation of the DOEGrids CP/CPS policies. 

%ENDCOLOR%

You should receive a response within one or two business days about the status of your
request.

---++ Instructions for Users
---+++ [[CertScriptsPackage][Certificate Scripts package]]
This package of command-line utilities (click heading above), included as part of a VDT or OSG software installation, provides a convenient interface for requesting new and replacement certificates as well as checking the lifetime of certificates & CRLs and searching the DOEGrids certificate directory.

---+++ Digitally signed email
Most modern email clients can handle smime (digitally signed) email messages without difficulty once your certificate is loaded into the certificate store for the email client.

However, it is also possible to digitally sign messges from a command-line using openssl and your grid certificate .pem files (typically ~/.globus/user{cert|key}.pem).

Example sending signed email:
<verbatim>
$ openssl smime -sign -signer ~/.globus/usercert.pem -inkey ~/.globus/userkey.pem \
          -in message.txt | mail -s "email subject" person@example.com
</verbatim>

   * message.txt - body of the email message
   * ~/.globus/usercert.pem, userkey.pem - your personal grid certificate
   * person@example.com - address where email is to be sent

Example verifying signed message:
<verbatim>
$ openssl smime -verify -in message.txt -signer sendercert.pem \
     -CApath $X509_CERT_DIR
</verbatim>

   * message.txt - body of email message received.
      * note that the line beginning "Content-Type" and including 'boundary="---' must be a single line and not get broken or wrapped.
   * sendercert.pem - public certificate of the person who sent the message
   * note that there is an openssl smime option ( -noverify ) which avoids the need for specifying the trusted CA directory path, but this should only be used if you have a good reason to believe that the senders certificate is still valid.

---+++ Make PKCS12 file from .pem files for import to web browser
To import your grid certificate into a web browser it usually needs to be put into a PKCS12 format file.  The example below is the openssl command to generate this file form your default grid certificate files, ~/.globus/usercert.pem and ~/.globus/userkey.pem.
<verbatim>
openssl pkcs12 -inkey ~/.globus/userkey.pem -in ~/.globus/usercert.pem -export -out my-cert.p12
</verbatim>
You will have to enter the passphrase used to encrypt your private key (userkey.pem)
as well as another passphrase to encrypt the .p12 file.  This .p12 file (my-cert.p12) can be imported to your web browser, see your web browser help information on how to do this.

---+++ Verify that private key matches public certificate
The md5 digest strings of these two commands must match in order to verify that
the private key and public certificate match.
   * openssl x509 -noout -modulus -in usercert.pem | openssl md5
   * openssl rsa -noout -modulus -in userkey.pem | openssl md5

If your certificate and key file have names different than usercert.pem and userkey.pem just
substitute the actual names of your files. If the private key is encrypted you will be prompted
to enter the passphrase. This comparison work for any type of certificate/key pair, personal, host, service, etc.

---++ Work Plan
Information on the issues, action items and planned changes or upgrades of the OSG RA service is managed [[OsgRaPlanning][here]].


---++ Internal information for the RA.
Internal information for the RA, such as list of agents, unpublished email address, etc. is shown [[OsgRaAgents][here]] with restricted viewing.

-- Main.DougOlson - 27 Jun 2006
