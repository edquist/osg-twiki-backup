%META:TOPICINFO{author="AlainDeximo" date="1398687720" format="1.1" version="1.34"}%
%META:TOPICPARENT{name="OsgRaOperations"}%
---+!! OSG Registration Authority Information (OSG PKI)

%TOC%


---++ Certificate Workflow

   1.	Subscriber requests a personal certificate, using web browser or a script interface to OIM
   2.	OIM creates a ticket and sends an email acknowledgement of the request to the subscriber and a notice of the request to the Agent. The email notice to Agent will contain the name of the VO (or institution) selected by the subscriber. 
   3.	An Agent for the specified VO views the ticket and request web page then acknowledges that the request has been reviewed by entering an entry into the ticket request. Using the information provided for name, email address and phone numbers for subscriber and sponsor, the Agent determines one or more valid Sponsors who may be able to confirm the request. 
   4.	The Agent contacts the sponsor by telephone or email to ask for confirmation of the certificate request. 
      a.	Agent looks up approved sponsor for this request based on specified institution or VO. *at a real organization, every employee is their own sponsor; they are entitled to request a certificate. Non-employees, collaborators, normally name their Argonne employeed collaborator as their sponsor. Could a space be added to the form so that they subscriber can identify their specific sponsor?* 
      a.	Contact is done by either email or telephone to the Sponsor providing details about request and asking for confirmation. 
      a.	Sponsor makes direct contact with subscriber to verify the certificate request. *In the Argonne context, the sponsor normally expects the subscriber to make a certificate request. Thus, the sponsor does not have to check with the subscriber. The RA only confirms with the sponsor, the subscriber is not queried.*
      a.	Subscriber acknowledges or disavows having made the request. 
      a.	Sponsor conveys result from subscriber back to Agent by digitally signed email. *The sponsor may not have a certificate.*
   5.	Agent approves or rejects the request via web interface in OIM. 
   6.	If approved, OIM sends the certificate signed request (CSR) to !DigiCert CA for signing. 
   7.	!DigiCert signs the request and returns the signed certificate to OIM. 
   8.	OIM notifies the subscriber that certificate has been issued and provides a URL for downloading the certificate. 
   9.	!DigiCert then publishes the signed certificate into their system. 
   10.	Agent will then review recorded information about processing the request for future reference in the ticket and sets the ticket status to “Resolved”. 

---++ VO Sponsors 

A Sponsor is a trusted person in a VO that an RA or Grid Admin may consult to verify the identity of a certificate requester. It is important that the RA or Grid Admin capture this consultation in the ticket for the request.

The preferred way of doing so is for the Sponsor to have a DigiCert user certificate which is registered to an OIM account. This will allow a sponsor to provide authenticated confirmation via the ticketing system. This method reduces load for the RA and ensures OSG has good contact information for the Sponsor.  Therefore, RA agents are encouraged to populate OIM with all known sponsors for their specific VO.

An alternative method would be for the RA and Sponsor to communicate securely otherwise (i.e. signed email or in person), and the RA record this consultation in the ticket themselves. In this case the RA should record the means of communication and contact information for the Sponsor. This method is discouraged and intended only for situations where the Sponsor cannot register in OIM.  OIM registration intstructions can be found [[https://twiki.grid.iu.edu/bin/view/Operations/OIMRegistrationInstructions][here.]]

---++ Accepting user-provided sponsors

Users will have the option of manually providing a sponsors if they are not able to select one from the existing sponsor list of a particular VO. 

*The following sponsor information is required during a request submission as highlighted in the example below.*
%ATTACHURL%/Sponsor_Info.png  %BR%

   * RA agents must make sure that the identity of the sponsor who is manually provided in a certificate request is a person who can confirm that the submitter has made a certificate request based on reliable personal knowledge. Such means of doing so can either be by face-to-face or a telephone discussion with the submitter who is personally known to the sponsor. 

   * RA agents should also consider adding the manually provided sponsor to the VO sponsor list in OIM.

---++ Sponsor confirmation response

   There are 3 ways a sponsor can respond back to the RA agent with their valid confirmation.

    1. OIM/Ticketing system *(Preferred method)*
      * Below are some samples showing how to determine a sponsor has provided a valid entry into the request ticket.

       *Sponsor's entry is shown as valid by their full name being displayed at the top of their entry into the ticket.*
       %ATTACHURL%/Screen_shot_of_a_valid_entry_1.png  %BR%

       *Sponsor's entry is shown as valid by their DN being appended at the end of the entry into the ticket.*
       %ATTACHURL%/Screen_shot_of_a_valid_entry_2.png  %BR%

    2. If sponsor responds by email it must be digitally signed to verify the sponsors identity. 
      * The sponsor's email will need to be entered by the RA manually.  Be sure to include a comment before pasting in the email.  
         Something in the lines like " Signed email confirmation received from sponsor" should suffice. Also, please be sure to
         include the entire header of the signed email when manually adding to the ticket.

       *Sponsor's signed email entered into the request ticket.*

       %ATTACHURL%/Screen_shot_signed_email_entry.png  %BR%

    3. Agent may also accept confirmation by telephone directly, if using previously validated telephone number for the sponsor.


---++ Instructions for RA Agents processing OU=People certificate requests
   1.	Email notification received by agents contain the name of the submitter in the subject line. 
      * E.g., *Open Science Grid Dev: User Certificate Request for <Submitter’s name> ISSUE=### PROJ=###*%BR%
       %ATTACHURL%/email_header.png  %BR%
      * Identifies who submitted the request and the associated ticket created. 
      * A link to the actual certificate request is provided in the body of the email notification. %BR%
       %ATTACHURL%/request_link.png  %BR%
   2.	An agent for the identified VO mention in the email should follow the link in the email notice to view the complete information about the request within one business day.  The agent is to then submit an entry into the ticket acknowledging that the ticket has been reviewed and have determined it is a request that they then can process. %BLUE%Each request should be claimed by an agent in 2 business days at most%ENDCOLOR%
   3.	Using the additional information provided in the request the agent should confirm who are acceptable sponsors that would best validate the request. This may or may not be the same as the sponsor shown in the request. 
   4.	Agent should contact the sponsor by email or telephone to confirm the request. 
      * Agent can accept confirmation by telephone directly, if using previously validated telephone number for the sponsor. 
      * If sponsor responds by email it must be digitally signed to verify the sponsors identity. 
      * %BLUE%Email sent to Sponsor should be cc'd to person requesting certificate, so they will see the progress of their request, and can check with the Sponsor if something is taking too long.%ENDCOLOR% 
      * %BLUE%An agent can ask for an alternative Sponsor in case the first Sponsor cannot confirm the request. When an alternative sponsor is emailed, agent copies the requestor to his email.%ENDCOLOR%  
   5.	If the requestor's previous certificate has expired, and the agent or sponsor can confirm that the requestor is indeed the holder of the previous certificate, the agent may edit the DN in the request to match the previous certificate's DN, so that it is not necessary to update the requestor's DN in VOMS. 
   6.	%BLUE%If a sponsor is not responsive after 3 business days,%ENDCOLOR% 
      * %BLUE%The Agent should send a reminder email that is also copied to the Requestor.%ENDCOLOR% 
      * %BLUE%After business 5 days, Agent should email an alternative Sponsor, if one exists. The Agent should copy the Requestor to this second email so that the Requestor can follow the process.%ENDCOLOR% 
      * %BLUE%An agent can contact the OSG RA or VO Manager if a particular request or sponsor takes longer than usual, a week or 10 days at most.%ENDCOLOR% 
   7.	If sponsor confirms the certificate requestor by an acceptable means, the agent can issue the certificate. 
      * If the sponsor denies the requestor then the agent should reject the request. 
   8.	%BLUE%Agent must record a summary of the verification (or rejection) of the request as an entry into the ticket.%ENDCOLOR%   The recorded information should include 
  
      * Name of Sponsor who confirmed the request (in some cases the Agent is also the Sponsor). 

---++ Instructions for Grid Admins processing OU=Services certificate requests 
   1.   Email notification received by agents will contain the name of the Grid Admin for which the certificate is requested in the subject line of the notification email. 
      * E.g., *Open Science Grid Dev: Host Certificate Request by <Submitter’s name> ISSUE=### PROJ=###*	%BR%
       %ATTACHURL%/email_header_GA.png  %BR%
      * Identifies who submitted the request and the associated ticket created. 
   2. An agent with responsibility for the domain should click on the link in the email notice to check the complete information for the request within %BLUE%one business day of receiving the notice. %ENDCOLOR%%BR%
       %ATTACHURL%/request_link_GA.png  %BR%
   3. If the agent is able to process the request they are to submit an entry into the ticket acknowledging that the ticket has been reviewed and have determined it is a request that they then can process.
   4. If the requestor has a valid !DigiCert personal certificate the agent should get a digitally signed email from the requestor in order to issue the certificate. 
   5. If the requestor does not have a valid !DigiCert personal certificate then they need to be authenticated as described for a personal certificate request above before issuing the new certificate. 
   6. %BLUE%Agent must record a summary of the verification (or rejection) of the request in the OIM Action Note. %ENDCOLOR%  The recorded information should include 
      * Name of Sponsor who confirmed the request (in some cases the Agent is also the Sponsor). Not needed if requestor has a valid personal certificate. 
      * For certification requests, statement of why the requestor qualifies to receive certificate, i.e., membership in a particular VO, or association with a science program participating with OSG. 

---++ %BLUE%Audits of Agent activities%ENDCOLOR%
%BLUE%Auditing the registration process is an important part of maintaining the integrity of the whole identify certification system. At times there will be sampling audits of individual certificate requests and Agents may be contacted regarding those requests if the information in the tickets is insufficient.%ENDCOLOR%

---++ Becoming a OSG PKI Trusted Agent (Registration Authority Agent or Grid Admin)
Page can be found [[https://twiki.grid.iu.edu/bin/view/Operations/OSGPKITrustedAgent][here]].

---++ Certificate Revocation
When a certificate is revoked it is included in the Certificate Revocation List and it can no longer be used for authentication.
There are several conditions that are grounds to revoke a certificate.  These are:
   * the private key is suspected of being compromised (out of control of the owner)
   * the certificate is no longer in use
   * the information in the certificate is no longer accurate (name, hostname, email address)
   * the owner no longer has a valid reason to have the certificate (no longer working on a project of interest to OSG)
If the certificate owner or some other responsible party notifies an Agent that any of these conditions are true
then the Agent should revoke the certificate.  If in doubt, open a trouble ticket [[http://ticket.grid.iu.edu/goc/submit][here]] and CC osg-ra@opensciencegrid.org for clarification. The revocation should be recorded by providing an entry into the ticket describing in detail the actions taken.

---++ Forgotten Password/Lost private key
In the event a user has either forgotten their password or lost their private key complete the following steps:

*Forgotten password*
   * OSG PKI does not store or save passwords to user certificates.  Users have the option to keep their current certificate in hopes that they remember the password at a later time.
   * The user may also notify the VO's RA agent that they have either forgotten their password and have their certificate revoked as a safety precaution.
   * RA agent is to then immediately revoke the specific certificate reported by the user.
   * Once the certificate has been revoked.  The user is free to submit in a request for a new user certificate.

*Lost private key*
   * OSG PKI does not store private keys associated to user certificates.
   * The user must immediately notify the VO's RA agent that they have either misplaced or lost their private key to their user certificate.
   * RA agent is to then immediately revoke the specific certificate reported by the user.
   * Once the certificate has been revoked.  The user is free to submit a request in for a new user certificate.
   * If additional assistance is required.  A trouble ticket may be submitted [[http://ticket.grid.iu.edu/goc/submit][here]] and CC osg-ra@opensciencegrid.org to the trouble ticket. 

---++ 30 Days Request Cancellation
The following guidelines will result in a request cancellation after 30 days.
   * Insufficient requirements fulfilled to further facilitate the approval process in a timely manner.  If a request has not been approved then it will be manually canceled by the OSG RA.
   * Submitter has neglected to download approved certificate.  The request will be automatically canceled after 30 days from when the request was approved by the RA agent.
     An automated note will be sent to the submitter as a reminder to download their approved certificate 15 days from when the request was approved by the RA agent.
The submitter is welcome and encouraged to resubmit their request for a certificate if necessary.

---++ Other Agent Actions
 The main URL at the CA for actions authorized for Agents is found [[https://oim.grid.iu.edu/oim/certificateuser][here]]. The most frequently used actions are searching for certificates, and revocation. Any action causing changes (revocation, issuing certificates, granting privileges, etc.) should be recorded by providing an entry into the ticket describing the actions taken in detail.

---++ Termination of Agent or Grid Admin privileges
 When you wish to terminate any RA or Grid Admin privileges you have, due to change of job or responsibilities you should open a trouble ticket [[http://ticket.grid.iu.edu/goc/submit][here]] and CC osg-ra@opensciencegrid.org stating that you are ending your responsibilities and privileges. You should state who, if anyone, is taking over for your RA or Grid Admin responsibilities. When Agents terminate their privileges there need to be arrangements made to transfer the log of Agent actions to another Agent or to the OSG PKI staff. If the Agent has provided an entry into the ticket on all actions  then no additional transfer is necessary.



   * The RA approval page, 2012-09-18: <br />
     <img src="%ATTACHURLPATH%/ApprovalScreenV01.jpg" alt="ApprovalScreenV01.jpg" width='1114' height='956' />    

   * Subscriber certificate request form, top half, 2012-09-17: <br />
     <img src="%ATTACHURLPATH%/CertReqTopHalfv01.jpg" alt="CertReqTopHalfv01.jpg" width='1037' height='1030' />    

   * Subscriber certificate request form, bottom half, 2012-09-17: <br />
     <img src="%ATTACHURLPATH%/CertReqBottomHalfv01.jpg" alt="CertReqBottomHalfv01.jpg" width='1037' height='1154' />    

---++ GA process to request addition of a domain
 GAs who wish to have a domain name not already available please open a trouble ticket [[https://ticket.grid.iu.edu/goc/submit][here]].  Select the box "Resource" and fill in the name of the resource.  In the "Description" box fill in the domain(s) that you would like to be GA of that is not yet available.  Be sure to CC Alain Deximo and osg-ra@opensciencegrid.org that way the ticket is properly routed to the  appropriate assignee.  Your requested domain will be submitted to DigiCert for registration.  Once registration has been completed you will be notified and you may then submit your GA request [[https://oim.grid.iu.edu/oim/gridadmin][here]] for the domain that has just recently been registered.

---++ How to submit a request for account with expired certificate
 If you your user certificate has expired and you no longer have access to OIM, please open up a ticket [[http://ticket.grid.iu.edu/goc/submit][here]]. Select the box "Membership Request" and select the VO that you are associated with in the drop down menu.  In the "Description" box please provide in detail the nature of your request.  The assignee to the ticket will make all the necessary changes in OIM.  Once the changes have been made, you will be notified via the ticket.   You will be able to then submit a request for a user certificate [[https://oim.grid.iu.edu/oim/certificaterequestuser][here]] using your email associated to your expired certificate.  

---++ PKI certificate quotas

PKI certificate quotas are limitations put in place to prevent the unnecessary issuance of 
certificates to a particular user in any given period of time.  

They are implemented in the event an inappropriate amount of certificates are accidentally requested
by a submitter.  

On an as needed basis, *only PKI staff* are permitted and able to adjust the quotas as they 
they deem necessary.

*Quotas set per individual are the following:*
   * Users are allowed 3 user certificate per year.
   * Grid Admins can approve up to 1000 host certificates per year.
   * Grid Admins can approve up to 50 host certificates per day.

*Steps for PKI staff to adjust certificate quotas.*

   * Locate the users profile for whom the certificate quota will be adjusted under "OSG Contacts".

     %ATTACHURL%/OSG_contacts_b.png  %BR%

   * Now go down to "Certificate Request Quota" which is located at the bottom of the user's profile.

   * If for example, a user has reached their limit of 50 hosts certificate for the day and has 
     need for additional host certs.  A PKI staff would place a zero in highlighted area below 
     to reset the host quota limit.  If the user would like to generate a 100 hosts certs for the
     day, then the PKI staff would enter -50 into the field. 
     %ATTACHURL%/Host_cert_quota_b.png  %BR%

   * Once the appropriate amount has been enter into the field.  Click on the Submit button.

     %ATTACHURL%/submit.png  %BR%




-- Main.AlainDeximo - 29 Jan 2013

%META:FILEATTACHMENT{name="ApprovalScreenV01.jpg" attachment="ApprovalScreenV01.jpg" attr="" comment="The RA approval page, 2012-09-18" date="1349214294" path="ApprovalScreenV01.jpg" size="195968" stream="ApprovalScreenV01.jpg" tmpFilename="/usr/tmp/CGItemp64977" user="JohnVolmer" version="1"}%
%META:FILEATTACHMENT{name="CertReqTopHalfv01.jpg" attachment="CertReqTopHalfv01.jpg" attr="" comment="Subscriber certificate request form, top half, 2012-09-17" date="1349214493" path="CertReqTopHalfv01.jpg" size="171459" stream="CertReqTopHalfv01.jpg" tmpFilename="/usr/tmp/CGItemp64909" user="JohnVolmer" version="1"}%
%META:FILEATTACHMENT{name="CertReqBottomHalfv01.jpg" attachment="CertReqBottomHalfv01.jpg" attr="" comment="Subscriber certificate request form, bottom half, 2012-09-17" date="1349214962" path="CertReqBottomHalfv01.jpg" size="259346" stream="CertReqBottomHalfv01.jpg" tmpFilename="/usr/tmp/CGItemp64804" user="JohnVolmer" version="1"}%
%META:FILEATTACHMENT{name="email_header.png" attachment="email_header.png" attr="h" comment="" date="1352405689" path="email_header.png" size="15227" stream="email_header.png" tmpFilename="/usr/tmp/CGItemp15493" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="request_link.png" attachment="request_link.png" attr="h" comment="" date="1352406568" path="request_link.png" size="17159" stream="request_link.png" tmpFilename="/usr/tmp/CGItemp15505" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="email_header_GA.png" attachment="email_header_GA.png" attr="h" comment="" date="1352406949" path="email_header_GA.png" size="20137" stream="email_header_GA.png" tmpFilename="/usr/tmp/CGItemp15588" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="request_link_GA.png" attachment="request_link_GA.png" attr="h" comment="" date="1352407219" path="request_link_GA.png" size="30561" stream="request_link_GA.png" tmpFilename="/usr/tmp/CGItemp15342" user="AlainDeximo" version="2"}%
%META:FILEATTACHMENT{name="Host_cert_quota_b.png" attachment="Host_cert_quota_b.png" attr="h" comment="" date="1362513433" path="Host cert quota b.png" size="69869" stream="Host cert quota b.png" tmpFilename="/usr/tmp/CGItemp13406" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="OSG_contacts_b.png" attachment="OSG_contacts_b.png" attr="h" comment="" date="1362582812" path="submit.png" size="16969" stream="submit.png" tmpFilename="/usr/tmp/CGItemp16919" user="AlainDeximo" version="2"}%
%META:FILEATTACHMENT{name="submit.png" attachment="submit.png" attr="h" comment="" date="1362582853" path="submit.png" size="16969" stream="submit.png" tmpFilename="/usr/tmp/CGItemp13303" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="Screen_shot_of_a_valid_entry_1.png" attachment="Screen_shot_of_a_valid_entry_1.png" attr="h" comment="" date="1364396223" path="Screen shot of a valid entry 1.png" size="65466" stream="Screen shot of a valid entry 1.png" tmpFilename="/usr/tmp/CGItemp45012" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="Screen_shot_of_a_valid_entry_2.png" attachment="Screen_shot_of_a_valid_entry_2.png" attr="h" comment="" date="1364396249" path="Screen shot of a valid entry 2.png" size="109740" stream="Screen shot of a valid entry 2.png" tmpFilename="/usr/tmp/CGItemp45129" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="Screen_shot_signed_email_entry.png" attachment="Screen_shot_signed_email_entry.png" attr="h" comment="" date="1364396270" path="Screen shot signed email entry.png" size="60773" stream="Screen shot signed email entry.png" tmpFilename="/usr/tmp/CGItemp45041" user="AlainDeximo" version="1"}%
%META:FILEATTACHMENT{name="Sponsor_Info.png" attachment="Sponsor_Info.png" attr="h" comment="" date="1365184385" path="Sponsor Info.png" size="53884" stream="Sponsor Info.png" tmpFilename="/usr/tmp/CGItemp45124" user="AlainDeximo" version="1"}%
