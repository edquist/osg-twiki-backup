%META:TOPICINFO{author="NehaSharma" date="1449724534" format="1.1" reprev="1.57" version="1.57"}%
%META:TOPICPARENT{name="SecurityTeamWorkingArea"}%
x%TOC%

<!--
   * Set ALLOWTOPICVIEW = Main.GridGroup    
   * Set ALLOWTOPICCHANGE = Main.SecurityTeamGroup, Main.NehaSharma, Main.KatherineLato
   * Set DENYTOPICVIEW = Main.TwikiGuest
-->
---+ OSG CA Transition Procedure
The OSG CA was designed with a modular backend, so different backend CAs can be used to do the actual certificate signing. This is the procedure to transfer signing to a new backend CA.

---++ Prerequisites
   * The new Certificate Subscriber Agreement is put into production
   * OSG OIM modified to allow selecting which backend CA will sign cert requests for that VO.
   * Testing procedure completed.
   * New backend CA signed user certs will still have the same numeric suffix.
   * Procedure to pre-populate VOMS servers will be distributed to VO admins ahead of time.
   * VO client package is updated with the new VOMS service certificates a month before the VOMS server transitions and OSG community deployed the new client.
   * Any host certificate which need SANs must be generated by the OSG security team. The requestor must contact Mine/Neha/Jeny. The command line clients allowing SAN will come out in Jan 15 2016. Send an announcement to the VOs transitioning prior to that date.  

---++ General Info
   * CILogon OSG CA cert available in IGTF bundle 1.69 and OSG Software release (starting 3.2.29 and 3.3.3) 
   * Mine sent announcement to OSG about updating new OSG CA bundle on nodes and browsers
   * XSEDE confirmed that they installed the OSG CA certificate from the IGTF release
   * Diego@CERN confirmed that all CMS web services have the CILogon OSG CA cert

---++ Timeline
   * Convert friendly VO to use new backend CA - _5 weeks_
      * pre-populate VOMS server. - vo admins - _1 day_
         * Script attached below to pre-populate personal DNs for new DNs for existing VOMS users. Must be run on a machine that can connect to the voms mysql database. Uses -hhostname -uusername -ppassword databasename arguments similar to mysql client. 
         * The script will create a cilogon certificate db entry for every existing digicert entry.
      * Switch OIM to use new backend for this VO. - osg operations - _1 day_
      * Get new user and host certs for admins and servers. - vo admins - _1 week_
         * Technically this doesn't _need_ to be done until existing certs expire, but it would be good to have the VOs admins try everything to find any problems.
         * This would include any web servers using grid certificates for their service certificate, or accepting grid certificates for client authentication, like !DocDB.
      * Coordinate the new certificates with the release of vomses and lsc files. - osg operations - _2 weeks_
         * Again, technically this doesn't need to be done until existing certs expire, but would be good to coordinate the changes at the same time if possible.
      * Verify users and grid admins are able to successfully use new certificates - vo - _2 weeks_
   * After first VO is verified successful, coordinate and repeat with second and third wave of VOs.
   * each wave is expected to take 5 weeks. 

---++ Schedule
   * Note schedule is tentative, VOs should be contacted ahead of time to see if anyone might want to go earlier or have problems requiring them to go later.

|  | *VO* | *Status* | *Start Date* | *End Date* | *Notes*| *Transition Confirmation* | *VOMS server using Digicert cert*|

| 1 | cms | %ORANGE%IN PROGRESS%ENDCOLOR%|10/2015 | 1/12/16 | 3700 certs | confirmed | no|
| 2 | ATLAS | %GREEN%DONE%ENDCOLOR%|10/2015 | 12/08/15 | 1179 certs | confirmed | no|
| 3 | fermilab | %ORANGE%IN PROGRESS%ENDCOLOR%|12/05/15 | 1/26/16 | 1116 certs | confirmed |yes - voms1/2.fnal.gov|
| 4 | cdf | %ORANGE%IN PROGRESS%ENDCOLOR%|12/05/15 | 1/26/16 |  | confirmed |yes - voms1/2.fnal.gov|
| 5 | dune | %ORANGE%IN PROGRESS%ENDCOLOR%|12/05/15 | 1/26/16 |  | confirmed |yes - voms1/2.fnal.gov|

| 6 | gluex | |2/1/16 | 2/29/16 | 114 certs | confirmed |yes - gryphn.phys.uconn.edu|
| 7 | fusiongrid | | 2/1/16 | 2/29/16 | 70 certs | confirmed by default - emailed 8/31, 9/15, 9/21 |no|
| 8 | icecube | |2/1/16 | 2/29/16 | 33 certs | confirmed |no|
| 9 | osgedu | |2/1/16 | 2/29/16 | 23 certs | confirmed |yes - voms.grid.iu.edu|
| 10 | snoplus | | 2/1/16 | 2/29/16 | 9 certs | confirmed|no|
| 11 | lbne | |2/1/16 | 2/29/16 | 6 certs | confirmed |yes - voms1/2.fnal.gov|
| 12 | star | |2/1/16 | 2/29/16 | 2 certs | confirmed |yes - vo.racf.bnl.gov|
| 13 | nova | | 2/1/16 | 2/29/16 | 1 certs | confirmed by default - emailed 8/31, 9/15, 9/21 | yes - voms1/2.fnal.gov|
| 14 | osg | | 2/1/16 | 2/29/16 | 237 certs | confirmed | yes - voms.grid.iu.edu and voms1/2.opensciencegrid.org|

| 15 | ornl | | 3/1/16 | 3/31/16 | 95 certs | confirmed |no|
| 16 | dosar | | 3/1/16 | 3/31/16 | 68 certs | confirmed |yes - voms.dosar.org |
| 17 | sbgrid | | 3/1/16 | 3/31/16 | 30 certs | confirmed |yes - hpc.sbgrid.org|
| 18 | nysgrid | | 3/1/16 | 3/31/16 | 22 certs | confirmed |yes - dylan.ccr.buffalo.edu|
| 19 | seaquest | | 3/1/16 | 3/31/16 | 12 certs | confirmed |no|
| 20 | esgf | | 3/1/16 | 3/31/16 | 8 certs | confirmed |no|
| 21 | des | | 3/1/16 | 3/31/16 | 5 certs | confirmed |yes - voms1/2.fnal.gov|
| 22 | lhcb | | 3/1/16 | 3/31/16 | 2 certs | confirmed |no|

| 23 | glast.org | | 3/1/16 | 3/31/16 | 1 certs | confirmed |no|
| 24 | !T2K | | 3/1/16 | 3/31/16 | 19 certs | confirmed |no|
| 25 | nanohub | | 3/1/16 | 3/31/16 | 11 certs | confirmed |yes - voms1/2.fnal.gov|
|  | engage | | 3/1/16 | 3/31/16 | 8 certs | Does not exist anymore |no|
| 26 | xenon | | 3/1/16 | 3/31/16 | 4 certs | confirmed|no|
| 27 | gpn | |3/1/16 | 3/31/16 | 2 certs | confirmed |no|

| 28 | hcc | |4/1/16 | 4/30/16 | 87 certs |  confirmed by default - email 11/12/15, 11/24/15, 12/3/15 |yes - hcc-voms.unl.edu|
| 29 | belle | | 4/1/16 | 4/30/16 | 48 certs | confirmed |no|
| 30 | scda | |4/1/16 | 4/30/16 | 27 certs |  confirmed by default - email 11/12/15, 11/24/15 12/3/15 |no|
| 31 | glow | | 4/1/16 | 4/30/16 | 80 certs |  confirmed by default - email 11/12/15, 11/24/15 12/3/15 |yes - glow-voms.cs.wisc.edu|
| 32 | ANL | | 4/1/16 | 4/30/16 | 48 certs | confirmed |no|
| 33 | slac | | 4/1/16 | 4/30/16 | 26 certs | confirmed |no|
| 34 | ALICE | | 4/1/16 | 4/30/16 | 19 certs | confirmed |no|
| 35 | csiu | | 4/1/16 | 4/30/16 | 10 certs |  confirmed by default - email 11/12/15, 11/24/15 12/3/15 |yes - voms.grid.iu.edu|
| 36 | lsst | | 4/1/16 | 4/30/16 | 6 certs | confirmed |yes - voms1/2.fnal.gov|
| 37 | nees | | 4/1/16 | 4/30/16 | 4 certs | confirmed |yes - voms1/2.fnal.gov|
| 38 | dzero | | 4/1/16 | 4/30/16 | 2 certs |  confirmed by default - email 11/12/15, 11/24/15 12/3/15 |yes - voms1/2.fnal.gov|

| 39 | nersc | | 5/1/16 | 5/31/16 | 71 certs | email 12/3/15 | no|
| 40 | suragrid | | 5/1/16 | 5/31/16 | 47 certs | email 12/3/15 |yes - voms.hpcc.ttu.edu|
| 41 | lbnl | | 5/1/16 | 5/31/16 | 25 certs | email 12/3/15 |no|
| 42 | uc3 | | 5/1/16 | 5/31/16 | 15 certs | email 12/3/15 |yes - voms.grid.iu.edu|
| 43 | compbiogrid | | 5/1/16 | 5/31/16 | 10 certs | email 12/3/15 |yes - voms.cam.uchc.edu|
| 44 | lqcd | | 5/16/16 | 5/31/16 | 6 certs | email 12/3/15 |yes - voms1/2.fnal.gov|
| 45 | bnl | | 5/1/16 | 5/31/16 | 4 certs | email 12/3/15 |no|
| 46 | dream | | 5/1/16 | 5/31/16 | 2 certs | email 12/3/15 |yes - voms.hpcc.ttu.edu|

| 47 | mcdrd | | does not | exist   | | email 12/3/15 |yes - voms1/2.fnal.gov|
| 48 | lz | | 5/1/16 | 5/31/16   |  | email 12/3/15 |yes - voms.hep.wisc.edu|
| 49 | cigi | | 5/1/16 | 5/31/16   |   | email 12/3/15 |yes - voms.cigi.uiuc.edu|
| 50 | mis | | 5/1/16 | 5/31/16   |  | email 12/3/15 |yes - voms.grid.iu.edu|
| 51 | osgcrossce | |Does | not exist | anymore |  |yes - voms.grid.iu.edu|

---++ CMS 

| *Action item* |*Person Responsible* | *Status*| *Comments* |
|Establish the transition date for CMS after the deadline given to US CMS sites|Neha/Dave|%GREEN%DONE%ENDCOLOR%| Jan 12, 2016|
|Coordinate with US CMS Tier 1 sites to install the new OSG CA bundle and give them a deadline|Dave Mason|%ORANGE%IN PROGRESS%ENDCOLOR%||
|Coordinate with US CMS Tier 2 sites to install the new OSG CA bundle and give them a deadline|James Letts|%GREEN%DONE%ENDCOLOR%|None are using the Subject Alternative Name and all have the certificates installed|
|Coordinate with US CMS Tier 3 sites to install the new OSG CA bundle and give them a deadline|Kevin Lannon|%ORANGE%IN PROGRESS%ENDCOLOR%||
|Confirm all necessary testing has been done |Neha|%ORANGE%IN PROGRESS%ENDCOLOR%|https://twiki.grid.iu.edu/bin/view/Security/CATestProcedure#CMS|
|Provide means to obtain certs with multiple SANs|Mine|%GREEN%DONE%ENDCOLOR%|Send email to Mine/Jeny/Neha until Jan 12, 2016. After that, use osg-pki-tools from latest production release|
|Switch CMS to CILogon HSM in production OIM|Alain||||

---++ ATLAS

| *Action item* |*Person Responsible* | *Status*| *Comments* |
|Establish the transition date for ATLAS after the deadline given to US ATLAS sites|John|%GREEN%DONE%ENDCOLOR%| Dec 1, 2015|
|Coordinate with US ATLAS sites to install the new OSG CA bundle and give them a deadline|John|%GREEN%DONE%ENDCOLOR%||
|CILogon OSG CA cert installed on US ATLAS sites|Site Admins|%GREEN%DONE%ENDCOLOR%||
|Confirm all necessary testing has been done |Neha|%GREEN%DONE%ENDCOLOR%|https://twiki.grid.iu.edu/bin/view/Security/CATestProcedure#ATLAS|
|Provide means to obtain certs with multiple SANs|Mine|%GREEN%DONE%ENDCOLOR%|Send email to Mine/Jeny/Neha until Jan 12th' 16. After that, use osg-pki-tools from latest production release|
|Switch ATLAS to CILogon HSM in production OIM|Alain|%GREEN%DONE%ENDCOLOR%||
|Notify John and users who request host/service certs via command line tools about potential issue|Neha, Mine|%BROWN%NOT STARTED%ENDCOLOR%| release with solution expected to be out 12/17/15. will try for this to be sooner|

---++ Fermilab

| *Action item* |*Person Responsible* | *Status*| *Comments* |
|Establish the transition date|Neha|%GREEN%DONE%ENDCOLOR%|Jan 26, 2016 - confirmed with Joe (fermilab VO manager)|
|Confirm all necessary testing has been done |Neha|%ORANGE%IN PROGRESS%ENDCOLOR%|https://twiki.grid.iu.edu/bin/view/Security/CATestProcedure#Fermilab_Software_Services_Test|
|Coordinate with all service providers|Neha,Joe|%ORANGE%IN PROGRESS%ENDCOLOR%||
|Communicate transition info with user community|Joe Boyd|%ORANGE%IN PROGRESS%ENDCOLOR%||
|Upgrade uberftp on worker nodes|Ed|%BROWN%NOT STARTED%ENDCOLOR%|to-be-discussed 12/10/15|
|Test make_and_copy_cert.sh script|Steve|%BROWN%NOT STARTED%ENDCOLOR%|used to request host/service certs as grid admins. Testing pending 12/17/15 release of osg-pki-tools|
|Test uberftp on remote sites|Ray|%BROWN%NOT STARTED%ENDCOLOR%| Neha needs to deploy new mu2e service cert on preprod and request Ray C. to submit jobs offsite|
|Provide means to obtain certs with multiple SANs|Mine|%GREEN%DONE%ENDCOLOR%|Send email to Mine/Jeny/Neha until Jan 12th' 16. After that, use osg-pki-tools from latest production release|
|Switch fermilab to CILogon HSM in production OIM|Alain||||

---++ CDF

| *Action item* |*Person Responsible* | *Status*| *Comments* |
|Establish the transition date|Neha|%GREEN%DONE%ENDCOLOR%|Jan 26, 2016 - confirmed with Joe (VO manager)|

---++ DUNE

| *Action item* |*Person Responsible* | *Status*| *Comments* |
|Establish the transition date|Neha|%GREEN%DONE%ENDCOLOR%|Jan 26, 2016 - confirmed with Tom (VO manager)|



   * [[%ATTACHURL%/TransitionSchedule_Emails.rtf][TransitionSchedule_Emails.rtf]]: TransitionSchedule_Emails.rtf
   * [[%ATTACHURL%/cert-trans-march.rtf][cert-trans-march.rtf]]: The emails of the contacts for the VOs transitioning in March.
   * [[%ATTACHURL%/cert-trans-april-may.rtf][cert-trans-april-may.rtf]]: Ones for April and May

%META:FILEATTACHMENT{name="voms-add-cilogon-mysql" attachment="voms-add-cilogon-mysql" attr="" comment="Script to add CILogon OSG CA cert DNs to users that already have Digicert Grid CA certs." date="1435762206" path="voms-add-cilogon-mysql" size="1335" stream="voms-add-cilogon-mysql" tmpFilename="/usr/tmp/CGItemp59861" user="KevinHill" version="1"}%
%META:FILEATTACHMENT{name="TransitionSchedule_Emails.rtf" attachment="TransitionSchedule_Emails.rtf" attr="" comment="Ones for Feb" date="1441303390" path="TransitionSchedule_Emails.rtf" size="1157" stream="TransitionSchedule_Emails.rtf" tmpFilename="/usr/tmp/CGItemp13792" user="MineAltunay" version="1"}%
%META:FILEATTACHMENT{name="cert-trans-march.rtf" attachment="cert-trans-march.rtf" attr="" comment="The emails of the contacts for the VOs transitioning in March." date="1445542851" path="cert-trans-march.rtf" size="33052" stream="cert-trans-march.rtf" tmpFilename="/usr/tmp/CGItemp63092" user="KatherineLato" version="2"}%
%META:FILEATTACHMENT{name="cert-trans-april-may.rtf" attachment="cert-trans-april-may.rtf" attr="" comment="" date="1445820075" path="cert-trans-april-may.rtf" size="40406" stream="cert-trans-april-may.rtf" tmpFilename="/usr/tmp/CGItemp59438" user="KatherineLato" version="2"}%
