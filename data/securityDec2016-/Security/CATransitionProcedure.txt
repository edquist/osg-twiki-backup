%META:TOPICINFO{author="JenyTeheran" date="1452549359" format="1.1" reprev="1.70" version="1.70"}%
%META:TOPICPARENT{name="SecurityTeamWorkingArea"}%
x%TOC%

<!--
   * Set ALLOWTOPICVIEW = Main.GridGroup    
   * Set ALLOWTOPICCHANGE = Main.SecurityTeamGroup, Main.NehaSharma, Main.KatherineLato
   * Set DENYTOPICVIEW = Main.TwikiGuest
-->
---+ OSG CA Transition Procedure
The OSG CA was designed with a modular backend, so different backend CAs can be used to do the actual certificate signing. This is the procedure to transfer signing to a new backend CA.

---++ Prerequisites
   * The new Certificate Subscriber Agreement is put into production
   * OSG OIM modified to allow selecting which backend CA will sign cert requests for that VO.
   * Testing procedure completed.
   * New backend CA signed user certs will still have the same numeric suffix.
   * Procedure to pre-populate VOMS servers will be distributed to VO admins ahead of time.
   * VO client package is updated with the new VOMS service certificates a month before the VOMS server transitions and OSG community deployed the new client.
   * Any host certificate which need SANs must be generated by the OSG security team. The requestor must contact Mine/Neha/Jeny. The command line clients allowing SAN will come out in Jan 15 2016. Send an announcement to the VOs transitioning prior to that date.  

---++ General Info
   * CILogon OSG CA cert available in IGTF bundle 1.69 and OSG Software release (starting 3.2.29 and 3.3.3) 
   * Mine sent announcement to OSG about updating new OSG CA bundle on nodes and browsers
   * XSEDE confirmed that they installed the OSG CA certificate from the IGTF release
   * Diego@CERN confirmed that all CMS web services have the CILogon OSG CA cert

---++ Steps to Take a Transition a VO
   1. 1 month before the transition. Ask GOC for a list of all expiring certs from that VO.  
   2. 1 month before the transition date. Identify if the VO has standalone VOMS server. If it does: 
      a. Email the VOMS Administrator and asked them to obtain a new service certificate for VOMS. They do not need to install the new cert in VOMS server until the transition date, but we need to put the DN into VO Client package. 
      b. Give the script that pre-populates the VOMS server with new user DNs to VOMS Administrator and explain how it works. Script attached below to pre-populate personal DNs for new DNs for existing VOMS users must be run on a machine that can connect to the voms mysql database. Uses -hhostname -uusername -ppassword databasename arguments similar to mysql client. 
   3. 1 month before the transition. Contact the VO Managers and alert them about the upcoming change. They should send out an announcement to their community. Use the template announcement written by Neha. It should ask everyone to update their CA bundle and VO Client package. 
   4. 1 month before the transition. Alert GOC that the VO is transitioning. Re-Confirm the transition date. 
   5. If the VO is a certificate-only VO, no jobs running, they most likely will not have any VOMS server. Skip steps 2, 6, 7, 8. 
   6. 8 days before OSG Software Release Date. Send the new VOMS server cert DN to OSG GOC team (Kyle). GOC team will create the new VO client package and send this to OSG Software team. Skip this step and the next step if the VO does not have a standalone VOMS server or the VOMS server already have a new cert. 
   7. Check the OSG software release and confirm new client packages are released
   8. If the VO has multiple VOMS servers, make a note of when the other VOMS server will be upgraded to the new OSG CILogon CA cert. 
   9. 1 week before the transition. Confirm with the VO manager that we are undergoing transition. 
   10. 1 week before the transition. Check GOC is ready to switch this VO in production.
   11. 2 weeks after the transition. Keep monitoring the VO for possible problems.  
    
 
---++ Schedule
  
|  | *VO* | *Status* | *Start Date* | *End Date* | *Notes*| *Transition Confirmation* | *VOMS server using Digicert cert*|

| 1 | cms | %ORANGE%WILL START%ENDCOLOR%|1/16/2016 | 2/29/16 | 3700 certs | confirmed | no|
| 2 | ATLAS | %GREEN%IN PROGRESS%ENDCOLOR%|12/7/2015 | 1/31/16 | 1179 certs | confirmed | no|
| 3 | fermilab | %ORANGE%WILL START%ENDCOLOR%|1/26/16 | 2/26/16 | 1116 certs | confirmed. OLD VOMS SERVER MUST BE UPDATED BY APRIL 26 |yes - voms1/2.fnal.gov|
| 4 | cdf | %ORANGE%WILL START%ENDCOLOR%|1/26/16 | 2/26/16 |  | confirmed |yes - voms1/2.fnal.gov|
| 5 | dune | %ORANGE%WILL START%ENDCOLOR%|1/26/16 | 2/26/16 |  | confirmed |yes - voms1/2.fnal.gov|

| 6 | gluex | |2/1/16 | 2/29/16 | 114 certs | confirmed |yes - gryphn.phys.uconn.edu|
| 7 | icecube | |2/1/16 | 2/29/16 | 33 certs | confirmed |no|
| 8 | osgedu | |2/1/16 | 2/29/16 | 23 certs | confirmed REMOVED |yes - voms.grid.iu.edu|
| 9 | snoplus | | 2/1/16 | 2/29/16 | 9 certs | confirmed|no|
| 10 | lbne | |2/1/16 | 2/29/16 | 6 certs | confirmed. WILL NOT BE TRANSITIONED BECAUSE IT IS DEPRECATED |yes - voms1/2.fnal.gov|
| 11 | star | |2/1/16 | 2/29/16 | 2 certs | confirmed |yes - vo.racf.bnl.gov|
| 12 | nova | | 2/1/16 | 2/29/16 | 1 certs | confirmed by default - emailed 8/31, 9/15, 9/21. WILL BE TRANSITIONED UNDER FERMILAB VOMS | yes - voms1/2.fnal.gov|
| 13 | osg | | 2/1/16 | 2/29/16 | 237 certs | confirmed | yes - voms.grid.iu.edu and voms1/2.opensciencegrid.org (WILL NOT BE TRANSITIONED AS BEING MOVED TO voms1/2.fnal.gov WHICH IS ALREADY BEING DONE AS PART OF fermilab VO TRANSITION|

| 14 | fusiongrid | | 3/1/16 | 3/31/16 | 70 certs | confirmed by default - emailed 8/31, 9/15, 9/21 |no|
| 15 | ornl | | 3/1/16 | 3/31/16 | 95 certs | confirmed |no|
| 16 | dosar | | 3/1/16 | 3/31/16 | 68 certs | confirmed |yes - voms.dosar.org |
| 17 | sbgrid | | 3/1/16 | 3/31/16 | 30 certs | confirmed |yes - hpc.sbgrid.org|
| 18 | nysgrid | | 3/1/16 | 3/31/16 | 22 certs | confirmed |yes - dylan.ccr.buffalo.edu|
| 19 | seaquest | | 3/1/16 | 3/31/16 | 12 certs | confirmed. WILL BE TRANSITIONED IN JAN UNDER FERMILAB |no|
| 20 | esgf | | 3/1/16 | 3/31/16 | 8 certs | confirmed |no|
| 21 | des | | 3/1/16 | 3/31/16 | 5 certs | confirmed |yes - voms1/2.fnal.gov|
| 22 | lhcb | | 3/1/16 | 3/31/16 | 2 certs | confirmed |no|

| 23 | glast.org | | 3/1/16 | 3/31/16 | 1 certs | confirmed |no|
| 24 | !T2K | | 3/1/16 | 3/31/16 | 19 certs | confirmed |no|
| 25 | nanohub | | 3/1/16 | 3/31/16 | 11 certs | confirmed |yes - voms1/2.fnal.gov|
|  | engage | | 3/1/16 | 3/31/16 | 8 certs | Does not exist anymore |no|
| 26 | xenon | | 3/1/16 | 3/31/16 | 4 certs | confirmed|no|
| 27 | gpn | |3/1/16 | 3/31/16 | 2 certs | confirmed |no|

| 28 | hcc | |4/1/16 | 4/30/16 | 87 certs |  confirmed by default - email 11/12/15, 11/24/15, 12/3/15 |yes - hcc-voms.unl.edu|
| 29 | belle | | 4/1/16 | 4/30/16 | 48 certs | confirmed |no|
| 30 | scda | |4/1/16 | 4/30/16 | 27 certs |  confirmed by default - email 11/12/15, 11/24/15 12/3/15 |no|
| 31 | glow | | 4/1/16 | 4/30/16 | 80 certs |  confirmed by default - email 11/12/15, 11/24/15 12/3/15 |yes - glow-voms.cs.wisc.edu|
| 32 | ANL | | 4/1/16 | 4/30/16 | 48 certs | confirmed |no|
| 33 | slac | | 4/1/16 | 4/30/16 | 26 certs | confirmed |no|
| 34 | ALICE | | 4/1/16 | 4/30/16 | 19 certs | confirmed |no|
| 35 | csiu | | 4/1/16 | 4/30/16 | 10 certs |  confirmed by default - email 11/12/15, 11/24/15 12/3/15 |yes - voms.grid.iu.edu|
| 36 | lsst | | 4/1/16 | 4/30/16 | 6 certs | confirmed |yes - voms1/2.fnal.gov|
| 37 | nees | | 4/1/16 | 4/30/16 | 4 certs | confirmed |yes - voms1/2.fnal.gov|
| 38 | dzero | | 4/1/16 | 4/30/16 | 2 certs |  confirmed by default - email 11/12/15, 11/24/15 12/3/15 |yes - voms1/2.fnal.gov|

| 39 | nersc | | 5/1/16 | 5/31/16 | 71 certs | email 12/3/15, 12/14/15 | no|
| 40 | suragrid | | 5/1/16 | 5/31/16 | 47 certs | confirmed |yes - voms.hpcc.ttu.edu|
| 41 | lbnl | | 5/1/16 | 5/31/16 | 25 certs | confirmed |no|
| 42 | uc3 | | 5/1/16 | 5/31/16 | 15 certs | email 12/3/15, 12/14/15. DEPRECATED |yes - voms.grid.iu.edu|
| 43 | compbiogrid | | 5/1/16 | 5/31/16 | 10 certs | email 12/3/15, 12/14/15 |yes - voms.cam.uchc.edu|
| 44 | lqcd | | 5/16/16 | 5/31/16 | 6 certs | confirmed |yes - voms1/2.fnal.gov|
| 45 | bnl | | 5/1/16 | 5/31/16 | 4 certs | confirmed |no|
| 46 | dream | | 5/1/16 | 5/31/16 | 2 certs | confirmed |yes - voms.hpcc.ttu.edu|

| 47 | mcdrd | | does not | exist   | |  |yes - voms1/2.fnal.gov|
| 48 | lz | | 5/1/16 | 5/31/16   |  | confirmed |yes - voms.hep.wisc.edu|
| 49 | cigi | | 5/1/16 | 5/31/16   |   | confirmed |yes - voms.cigi.uiuc.edu|
| 50 | mis | | 5/1/16 | 5/31/16   |  | email 12/3/15, 12/14/15 |yes - voms.grid.iu.edu|
| 51 | osgcrossce | |Does | not exist | anymore |  |yes - voms.grid.iu.edu|

---++ CMS 

| *Action item* |*Person Responsible* | *Status*| *Comments* |
|Establish the transition date for CMS after the deadline given to US CMS sites|Neha/Dave|%GREEN%DONE%ENDCOLOR%| Jan 12, 2016|
|Coordinate with US CMS Tier 1 sites to install the new OSG CA bundle and give them a deadline|Dave Mason|%GREEN%DONE%ENDCOLOR%|Dave mentioned T1 should know about this as has been brought up in WLCG meeting. Jeny reported finding it in Dec 10th meeting where OSG CA transition was mentioned by Kyle Gross , who represents OSG - https://twiki.cern.ch/twiki/bin/view/LCG/WLCGDailyMeetingsWeek151207|
|Coordinate with US CMS Tier 2 sites to install the new OSG CA bundle and give them a deadline|James Letts|%GREEN%DONE%ENDCOLOR%|None are using the Subject Alternative Name and all have the certificates installed|
|Coordinate with US CMS Tier 3 sites to install the new OSG CA bundle and give them a deadline|Kevin Lannon|%GREEN%DONE%ENDCOLOR%| I don't think there will be a way to confirm that all T3 sites have installed the certificates.  The T3 sites are not managed in any sort of coherent fashion.  (Recall, T3 sites aren't funded by the operations program, so people pretty much do whatever they want.  There are even some sites that don't use any of the OSG infrastructure at all.)  I've informed the site admins via the HN, but I'm sure there will be some sites caught by surprise, and we'll just have to deal with that as it comes up.|
|Confirm all necessary testing has been done |Neha|%ORANGE%IN PROGRESS%ENDCOLOR%|https://twiki.grid.iu.edu/bin/view/Security/CATestProcedure#CMS|
|Provide means to obtain certs with multiple SANs|Mine|%GREEN%DONE%ENDCOLOR%|Send email to Mine/Jeny/Neha until Jan 12, 2016. After that, use osg-pki-tools from latest production release|
|Switch CMS to CILogon HSM in production OIM|Alain||||

---++ ATLAS

| *Action item* |*Person Responsible* | *Status*| *Comments* |
|Establish the transition date for ATLAS after the deadline given to US ATLAS sites|John|%GREEN%DONE%ENDCOLOR%| Dec 1, 2015|
|Coordinate with US ATLAS sites to install the new OSG CA bundle and give them a deadline|John|%GREEN%DONE%ENDCOLOR%||
|CILogon OSG CA cert installed on US ATLAS sites|Site Admins|%GREEN%DONE%ENDCOLOR%||
|Confirm all necessary testing has been done |Neha|%GREEN%DONE%ENDCOLOR%|https://twiki.grid.iu.edu/bin/view/Security/CATestProcedure#ATLAS|
|Provide means to obtain certs with multiple SANs|Mine|%GREEN%DONE%ENDCOLOR%|Send email to Mine/Jeny/Neha until Jan 12th' 16. After that, use osg-pki-tools from latest production release|
|Switch ATLAS to CILogon HSM in production OIM|Alain|%GREEN%DONE%ENDCOLOR%||
|Notify John and users who request host/service certs via command line tools about potential issue|Mine|%GREEN%DONE%ENDCOLOR%| provided various options to workaround the issue|

---++ Fermilab

| *Action item* |*Person Responsible* | *Status*| *Comments* |
|Establish the transition date|Neha|%GREEN%DONE%ENDCOLOR%|Jan 26, 2016 - confirmed with Joe (fermilab VO manager)|
|Confirm all necessary testing has been done |Neha|%GREEN%DONE%ENDCOLOR%|https://twiki.grid.iu.edu/bin/view/Security/CATestProcedure#Fermilab_Software_Services_Test|
|Coordinate with all service providers|Neha,Joe|%GREEN%DONE%ENDCOLOR%|discussed with DMD, DCSO, IFDH/SAM dev/ops, Jobsub dev|
|Communicate transition info with user community|Joe,Neha|%ORANGE%IN PROGRESS%ENDCOLOR%||
|Transition worker nodes from 3.1 to 3.2|Ed|%ORANGE%IN PROGRESS%ENDCOLOR%| will be done by 01/15/16|
|Transition interactive nodes from 3.1 to 3.2/3.3 |Ed|%GREEN%DONE%ENDCOLOR%| will be done on 12/17/16|
|Test old GPGrid GK |Ken|%GREEN%DONE%ENDCOLOR%| RITM0320528|
|Populate VOMS DB with new DNs |Neha|%GREEN%DONE%ENDCOLOR%| will be done by 01/15/16|
|Coordinate VOMS transition |Neha,Jeny,Tony|%GREEN%DONE%ENDCOLOR%|Agreed with DCSO that they'll switch 1 VOMS server at a time|
|Switch fermilab to CILogon HSM in production OIM|Alain||||

---++ CDF

| *Action item* |*Person Responsible* | *Status*| *Comments* |
|Establish the transition date|Neha|%GREEN%DONE%ENDCOLOR%|Jan 26, 2016 - confirmed with Joe (VO manager)|
|Populate VOMS DB with new DNs |Neha|%GREEN%DONE%ENDCOLOR%| will be done by 01/15/16|

---++ DUNE

| *Action item* |*Person Responsible* | *Status*| *Comments* |
|Establish the transition date|Neha|%GREEN%DONE%ENDCOLOR%|Jan 26, 2016 - confirmed with Tom (VO manager)|
|Populate VOMS DB with new DNs |Neha|%GREEN%DONE%ENDCOLOR%| will be done by 01/15/16|

---++ LQCD

Note: No certs with multiple FQDNs in SAN attribute of host/service certs are involved 

| *Action item* |*Person Responsible* | *Status*| *Comments* |
| Establish the transition date| Neha | | confirm with Amitoj (VO manager) |
| Understand where/how Digicert certs are being used | Neha |  | Met with Amitoj/Yujun on 01/07/16. lqcdgo.fnal.gov (host cert) - globus online endpoint; cc3.fnal.gov (host cert) - globus online endpoint; lqcdsrm.fnal.gov ( no host/service cert) - some user is logging to do g-u-c; lqcd.fnal.gov ( no host/service cert) - access to home areas controlled via user certs. Users will stop using this soon (so no need to test); Local (desktop) endpoint doesn't need certs |
| Confirm CILogon OSG CA cert has been installed where needed |Yujun | | Yujun says these are installed as part of Globus online itself and not via osg-ca-certs/scripts package|
| Test CILogon user cert works with Fermi Globus online endpoint| Yujun| | Can use cc3 as used by very few users|
| Test KCA user cert works with Fermi Globus online endpoint using CILogon OSG host cert| Yujun| |Can use cc3 as used by very few users|
| Upload new DNs in LQCD VOMS DB| Neha| ||
| User Communication|Amitoj| | Amitoj will send out email to users as needed. Neha to help with content as (if) needed |

---++ GLUEX

| *Action item* |*Person Responsible* | *Status*| *Comments* |
|Contact the VO Manager: Richard Jones to request the new certificates for VOMS server|Jeny|%GREEN%DONE%ENDCOLOR%||

---++ STAR

| *Action item* |*Person Responsible* | *Status*| *Comments* |
|Contact the VO Manager: Jerome Lauret, John Hover to request the new certificates for VOMS server|Jeny|%GREEN%DONE%ENDCOLOR%|John Hover will take care of this|


   * [[%ATTACHURL%/TransitionSchedule_Emails.rtf][TransitionSchedule_Emails.rtf]]: TransitionSchedule_Emails.rtf
   * [[%ATTACHURL%/cert-trans-march.rtf][cert-trans-march.rtf]]: The emails of the contacts for the VOs transitioning in March.
   * [[%ATTACHURL%/cert-trans-april-may.rtf][cert-trans-april-may.rtf]]: Ones for April and May

%META:FILEATTACHMENT{name="voms-add-cilogon-mysql" attachment="voms-add-cilogon-mysql" attr="" comment="Script to add CILogon OSG CA cert DNs to users that already have Digicert Grid CA certs." date="1435762206" path="voms-add-cilogon-mysql" size="1335" stream="voms-add-cilogon-mysql" tmpFilename="/usr/tmp/CGItemp59861" user="KevinHill" version="1"}%
%META:FILEATTACHMENT{name="TransitionSchedule_Emails.rtf" attachment="TransitionSchedule_Emails.rtf" attr="" comment="Ones for Feb" date="1441303390" path="TransitionSchedule_Emails.rtf" size="1157" stream="TransitionSchedule_Emails.rtf" tmpFilename="/usr/tmp/CGItemp13792" user="MineAltunay" version="1"}%
%META:FILEATTACHMENT{name="cert-trans-march.rtf" attachment="cert-trans-march.rtf" attr="" comment="The emails of the contacts for the VOs transitioning in March." date="1445542851" path="cert-trans-march.rtf" size="33052" stream="cert-trans-march.rtf" tmpFilename="/usr/tmp/CGItemp63092" user="KatherineLato" version="2"}%
%META:FILEATTACHMENT{name="cert-trans-april-may.rtf" attachment="cert-trans-april-may.rtf" attr="" comment="" date="1445820075" path="cert-trans-april-may.rtf" size="40406" stream="cert-trans-april-may.rtf" tmpFilename="/usr/tmp/CGItemp59438" user="KatherineLato" version="2"}%
