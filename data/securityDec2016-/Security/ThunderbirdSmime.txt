%META:TOPICINFO{author="KyleGross" date="1481047954" format="1.1" version="1.9"}%
%META:TOPICPARENT{name="OsgRaOperations"}%
---+!! Setting up Mozilla Thunderbird for SMIME email

%DOC_STATUS_TABLE%

%TOC%

---++ Install ESnet and DOEGrids CA certificates
To send, receive and verify digitally signed and/or encrypted email using DOEGrids CA (or other IGTF CA) certificates
you first need to install the CA certificates into the Thunderbird certificate manager. Note that this is
a separate instance of a certificate manager than the one for the !FireFox web browser, although
they are probably the same software.

Go to the TACAR secure CA certificate repository ans select both the ESnet Root CA
and the DOEGrids CA 1 to download.

<img src="%ATTACHURLPATH%/tacar-sel-esnet-doegrids.png" alt="tacar-sel-esnet-doegrids.png" width='600' height='538' />    

Scroll down to the bottom of the page and select *TAR.GZ* as the format and click *Download*.

 <img src="%ATTACHURLPATH%/tacar-download.png" alt="tacar-download.png" width='600' height='538' />

Save the file someplace you will remember and then untar the contents.
Open Thunderbird and select *Edit/Preferences* and then *Advanced*, the *Certificates* tab
and click on *View Certificates*.  Select the *Authorities* tab and you should see if you
have the ESnet certificates installed already.  They are not yet installed in the example shown below.

<img src="%ATTACHURLPATH%/tbird-cas.png" alt="tbird-cas.png" width='600' height='422' /> 

Next click the *Import* button and select the file you previously downloaded for the ESnet Root CA.
You should get a window asking if you want to trust this CA.  Check the boxes to *Trust this CA*
and then click *OK*.

<img src="%ATTACHURLPATH%/tbird-import-esnet.png" alt="tbird-import-esnet.png" width='600' height='324' />  

Now repeat the previous step and import the DOEGrids CA and check the boxes to trust it.

<img src="%ATTACHURLPATH%/tbird-import-doegrids.png" alt="tbird-import-doegrids.png" width='600' height='324' />  

Now both the ESnet Root CA and DOEGrids CA 1 should show up under Authorities in the Certificate manager.

<img src="%ATTACHURLPATH%/tbird-cas2.png" alt="tbird-cas2.png" width='600' height='422' />

Now you are ready to validate messages you receive which were digitally signed by a DOEGrids CA
issued certificate.
If you want to validate email signed by certificates from other IGTF accredited CAs just return to the
TACAR repository and repeat the process for the other CAs you want.

---++ Import your personal certificate
Remember where you stored the PKCS12 format (.p12) file containing your certificate.
In Thunderbird, select *Edit/Preferences* then *Advanced* and *Certificates*.

<img src="%ATTACHURLPATH%/tbird-cert-prefs.png" alt="tbird-cert-prefs.png" width='571' height='398' />

Click on the *View Certificates* button and the *Your Certificates* tab and then click on the *Import* button.
You should see a file browser window and select the .p12 file holding your certificate.
You should get a prompt to enter the master password for Thunderbird.  Enter your password and
click *OK*.

<img src="%ATTACHURLPATH%/tbird-cert-import-pw.png" alt="tbird-cert-import-pw.png" width='411' height='175' />

This should be followed by a Password Entry Dialog to unencrypt the file holding your certificate.
Enter the password and click *OK*.

<img src="%ATTACHURLPATH%/tbird-cert-import-pw.png" alt="tbird-cert-import-pw.png" width='411' height='175' />

Now your certificate should show up in the Certificate Manager under Your Certificates.

<img src="%ATTACHURLPATH%/tbird-show-pcert.png" alt="tbird-show-pcert.png" width='600' height='422' />

---++ Choose the certificate to use for signing and encryption
Select *Edit/Account Settings...* and then on *Security* under the account you want to use for digitally signed email.

<img src="%ATTACHURLPATH%/tbird-acct-sec.png" alt="tbird-acct-sec.png" width='600' height='560' /> 

Click the *Select* button under Digital Signing and then choose a certificate in the Select Certificate window,
and click *OK*.

<img src="%ATTACHURLPATH%/tbird-sel-pcert.png" alt="tbird-sel-pcert.png" width='600' height='270' />

Click *OK* at the prompt suggesting that you use this same certificate for encryption.
Now your certificate will show up for both Digital Signing and Encryption.  You may choose
to digitally sign message by default (or not).  If you don't digitally sign message by default you
still have the option to sign individual messages from the Thunderbird compose message window.
It is best to leave the default Encryption setting to Never and only choose encryption for individual messages you send.

<img src="%ATTACHURLPATH%/tbird-acct-sec-pcert.png" alt="tbird-acct-sec-pcert.png" width='600' height='560' />

Now click *OK* and you are ready to send digitally signed and/or encrypted email.

---++ Send digitally signed or encrypted email
From the Compose message window select *Options/Security/Digitally Sign This Message*, or
select the menu drop down from the Security button and select Digitally Sign This Message.

You can send encrypted email by choosing the same menu items but select *Encrypt This Message*.
Note that you can both sign and encrypt the same message.

When you send the message Thunderbird will check to see if you have a copy of the public certificate
for the person or people you are sending the message to. If you don't have their certificate already then
you can not send them encrypted email.

You can see whose certificates you have by opening the Certificate Manager (as shown above)
and clicking the *Other Peoples* tab.  The simplest way to add other peoples certificates is
to have them send you a digitally signed message, in which case their certificate gets automatically
added to the Certificate manager store.

---++ Verify a signed email you receive
When you receive a digitally signed email, and you have the corresponding CA certificate installed as trusted,
the message window displays a sealed envelope icon indicating a valid signature.

<img src="%ATTACHURLPATH%/dig-signed.png" alt="dig-signed.png" width='600' height='485' /> 

If you click on the envelope icon you will get details about the signature and the certificate
that signed the message.

<img src="%ATTACHURLPATH%/msg-sec.png" alt="msg-sec.png" width='544' height='330' />

If the signature is not valid for some reason the icon will look broken or disturbed in some way. Clicking
on that will provide more information about why the signature is not valid.
Some email transport services (mailling lists, etc.) will slightly change the content of a message
and this will cause the signature verification to fail.  This is the primary purpose of digitally signed email,
to be sure that the message has not been modified since it was signed and sent.


-- Main.DougOlson - 31 Jul 2009

<!-- CONTENT MANAGEMENT PROJECT

   DEAR DOCUMENT OWNER
   ===================

   Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER          = DougOlson

   Please define the document area, choose one of the defined areas from the next line
   DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Trash/Trash/Integration|Operations|Tier3)
   * Local DOC_AREA       = Security

   define the primary role the document serves, choose one of the defined roles from the next line
   DOC_ROLE = (Scientist|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

   Please define the document type, choose one of the defined types from the next line
   DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Knowledge
   
   Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

   Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

   change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

   change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %NO%

   change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


   DEAR DOCUMENT REVIEWER
   ======================

   Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = JamesBarlow
  
   Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %NO%


   DEAR DOCUMENT TESTER
   ====================

   Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = AnandPadmanabhan
  
   Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %IN_PROGRESS%
 
-->

%META:FILEATTACHMENT{name="tacar-sel-esnet-doegrids.png" attachment="tacar-sel-esnet-doegrids.png" attr="" comment="Select ESnet and DOEGrids" date="1249001058" path="tacar-sel-esnet-doegrids.png" size="101184" stream="tacar-sel-esnet-doegrids.png" tmpFilename="/usr/tmp/CGItemp2602" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="tacar-download.png" attachment="tacar-download.png" attr="" comment="Tacar download" date="1249001226" path="tacar-download.png" size="75179" stream="tacar-download.png" tmpFilename="/usr/tmp/CGItemp2629" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="tbird-cas.png" attachment="tbird-cas.png" attr="" comment="Tbird CM CAs" date="1249001612" path="tbird-cas.png" size="40134" stream="tbird-cas.png" tmpFilename="/usr/tmp/CGItemp2724" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="tbird-import-esnet.png" attachment="tbird-import-esnet.png" attr="" comment="Tbird import esnet" date="1249001879" path="tbird-import-esnet.png" size="27131" stream="tbird-import-esnet.png" tmpFilename="/usr/tmp/CGItemp2659" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="tbird-import-doegrids.png" attachment="tbird-import-doegrids.png" attr="" comment="Tbird import doegrids" date="1249001982" path="tbird-import-doegrids.png" size="27246" stream="tbird-import-doegrids.png" tmpFilename="/usr/tmp/CGItemp2589" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="tbird-cas2.png" attachment="tbird-cas2.png" attr="" comment="Tbird CM after CA import" date="1249002086" path="tbird-cas2.png" size="41212" stream="tbird-cas2.png" tmpFilename="/usr/tmp/CGItemp2601" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="tbird-cert-prefs.png" attachment="tbird-cert-prefs.png" attr="" comment="Tbird cert prefs" date="1249003375" path="tbird-cert-prefs.png" size="39379" stream="tbird-cert-prefs.png" tmpFilename="/usr/tmp/CGItemp2686" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="tbird-cert-import-pw.png" attachment="tbird-cert-import-pw.png" attr="" comment="Tbird cert import pw" date="1249003763" path="tbird-cert-import-pw.png" size="10074" stream="tbird-cert-import-pw.png" tmpFilename="/usr/tmp/CGItemp2632" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="tbird-show-pcert.png" attachment="tbird-show-pcert.png" attr="" comment="Tbird show cert" date="1249003852" path="tbird-show-pcert.png" size="22868" stream="tbird-show-pcert.png" tmpFilename="/usr/tmp/CGItemp2675" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="tbird-acct-sec.png" attachment="tbird-acct-sec.png" attr="" comment="Tbird acct sec" date="1249004081" path="tbird-acct-sec.png" size="57771" stream="tbird-acct-sec.png" tmpFilename="/usr/tmp/CGItemp2607" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="tbird-sel-pcert.png" attachment="tbird-sel-pcert.png" attr="" comment="Tbird select cert" date="1249004262" path="tbird-sel-pcert.png" size="25842" stream="tbird-sel-pcert.png" tmpFilename="/usr/tmp/CGItemp2678" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="tbird-acct-sec-pcert.png" attachment="tbird-acct-sec-pcert.png" attr="" comment="Tbird show acct cert" date="1249004708" path="tbird-acct-sec-pcert.png" size="61785" stream="tbird-acct-sec-pcert.png" tmpFilename="/usr/tmp/CGItemp2657" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="dig-signed.png" attachment="dig-signed.png" attr="" comment="signed message" date="1249005772" path="dig-signed.png" size="33313" stream="dig-signed.png" tmpFilename="/usr/tmp/CGItemp2508" user="DougOlson" version="1"}%
%META:FILEATTACHMENT{name="msg-sec.png" attachment="msg-sec.png" attr="" comment="check signature" date="1249005791" path="msg-sec.png" size="26619" stream="msg-sec.png" tmpFilename="/usr/tmp/CGItemp2657" user="DougOlson" version="1"}%
