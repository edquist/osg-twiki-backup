%META:TOPICINFO{author="KyleGross" date="1480453380" format="1.1" version="1.14"}%
%META:TOPICPARENT{name="SecurityTeamTeamWorkingArea"}%
---++Meeting on 06-19-2008

Please correct if any info below is misleading
Incident ID: 06-19-2008
Please use this ID for all further communication, fixes and reports.

Bob Ball reported that only gridftp and LRC are running on the machine. The LRC is not included in the VDT. LRC uses username and password for access. The compromised machine is not a gatekeeper. It is only used for data access. The machine only has http and tomcat services from VDT installed and turned on.

BB addition: vdt-control --list showed other services turned on, and this list is now attached below.  Note that even though condor-devel is shown as "enabled", it was chkconfig'd off.

John says that LRC is basically a !MySQL service.

There is no indication of what is the attack vector or the attack timeline. There are only outgoing connection logs for dropped packets. Therefore, we do not know which other machines may be compromised from the u of Michigan machine. The attack has been reported by a system admin in Denmark, whose machines was scanned from the port 10000 originating from the compromised u mich machine.

BB addition: isc.sans.org has this to say about port 10000:  "This is the kiddies looking for hosts running Webmin on Usermin."  Famous ports include 10000 through 10005 as reported [[http://isc.sans.org/port.html?port=10000][here]].

Bob said there must be only a host certificate on the machine. No user certificates are stored. Because gridftp only stores user proxies in memory and never writes to disk, we conclude there is a small risk of user proxy compromise. The gridftp deletes all instances of user proxies once the data transfer completes. If the attacker gained root access, he may steal the proxies during the data transfer. This is considered a low risk. After the local incident response team tells us the details, we can change the risk associated with compromised user proxies. Overall, so far we agree that the risk is low.

As our short-term mitigation plan: We agreed John will seek Atlas mgmt board's help; Bob will post gridftp, LRC and network log files on the twiki page we setup; Bob will ask local incident response team's help with the machine.  OSG asked Bob to seek the local incident response team at U mich in order to report on what services were running on this machine, the level of compromise, the attack vector and any other analysis they could gather. We will meet again tomorrow to discuss further details.

BB addition: A University IT forensics expert will join us in our server room in the morning to assist in diagnosing the machine.

To understand if this attack is due to the recent RPath announcement: we asked Bob whether they had a /home/execute/condor directory on the machine and whether he installed or turned on the condor service. there is no such directory and condor is not installed on this machine. So we conclude the compromise is not due to the RPath vulnerability.

Rob Quick confirmed that the compromised machine does not report to OSG. Therefore, this issue is still confined to ATlas and therefore must be addressed by Atlas and USAtlas security officers.
So far we have no reason to believe OSG users other than Atlas users may have contacted to this compromised machine.

We currently have no monitoring mechanism for the incident or an end of the incident/spread. We do not have enough information to determine those.
I would seek OSG executive Team 's approval on these actions.
Anything missing? please add on.

BB 20 June 2008 10:45am EDT

UM IT has taken away our boot disk for forensic analysis following a site visit this morning.  They will look at netflow logs during the affected period.  There is no evidence at all at this time that the machine was actively compromised.  It may have been used as a tcp relay for the port 10000 scan.  Still nothing is certain.  No one was logged in on the machine during the time of the attack.  See the newly attached cacti plots of machine activity, including number of concurrent logins and MySql activity, for the last 48 hours.

UM IT should have some sort of answer by the end of the day today.

---++ Meeting on 06-20-2008

Bob has contacted the local incident response team and they took a dump of the disk. The machine is reloaded with OS.
So far no evidence of compromise has been found, including a cause of the incident. Bob and the local experts are suspicious of TCP Relay attacks.

The cacti logs show that 12 hour before the incident discovered, there was only one user logged in. The log files are not deleted.
The Michigan team checked the network logs at the university boundary, there is no suspicious incoming messages found. However, the compromised machine is connected to the ultralight network, which connect caltech, michigan and other universities. The university security team does not observe the traffic through ultralight.

In var/log/messages file, we found that the compromised machine has sent periodic log files to a local syslog-ng collector. We asked the local incident response team to examine these log files. If there is any difference between the lg files kept on the compromised machine and the syslog-ng collector, this will indicate a compromise.

John explained to us that auto-pilot jobs were contacting the LRC machine for data registery. however, the pilot job never builds a SSL based connection and the pilot certificate never lands on the compromised machine. the connection to LRC is via username/password.

it is confirmed that the gatekeeper is running on the machine
So far in the logs recovered, we only see

/DC=org/DC=doegrids/OU=People/CN=wenjing wu 545240 submitting gatekeeper jobs or using gridftp. Mine will trace the proxy whether it is possibly stolen.
Bob will talk to the local security people in the afternoon. Michael Ernst agreed we will wait until then. We will meet at 4 pm CDT again.
Anything missing ? 


---++Meeting 06-20-2008 4:30 pm CDT
We confirmed the incident was due to root-level compromise. The only proxies that have landed on the compromised machine belongs to  wenjing wu.
Of course, this is what we can see from the grid-ftp and gatekeeper log files. remember that at root-level compromise, the log files may have been changed. We do not have any reason to believe they are changed though. Because the attacker would have just deleted the log files, if he wanted to hide info.

Wenjing says that her proxies are 96 hour lifetimed. Given she created the latest proxy on Thursday morning, her proxies still have lifetime until Monday evening. If the attacker stole her proxy, he can use it by Monday. We discussed whether we should revoke her certificate. But even revocation would have taken until Monday night. We will have to contact CAs, ask revocation and the propagate this to all sites. Therefore, I decided to track usage of Wenjing's proxy via Gratia tool throughout the weekend. I will not revoke her certificate. If I see any usage of her proxy , I will contact her and raise an alert.

So far we only see a single activity with her proxy. I sent it in my earlier email. That is legitimate usage and left from May 6th.

Another issue still puzzling us: there are gridftp connections from 130.199.185.50 ( lcg03.usatlas.bnl.gov ). We do not see any grid-ftp-auth.log entry for this connection. this is an fts server at BNL. John said that he will investigate why this machine connects to the LCR machine (the compromised machine). However, due to stringent security rules at BNL, John is not particularly worried that the BNL machine could be attacked from outside.
nevertheless, I asked him to clarify this with BNL site security people and inform us.
I will continue gratia queries until Monday evening. Remember that gratia does not record data transfers --only job submissions. This is a problem for our security purposes.
I decided not to make a public announcement because I have no reason to believe this incident affected other ATlas sites/users or OSG sites/users
Please respond if you have questions

---++Notes on 06-21-2008
Mine is doing daily (3 times a day) gratia queries to see whether Wenjing Wu's proxy has been compromised and is used to attack other OSG sites. 

The Gratia query I use for this is 

select * from VOProbeSummary where CommonName like "%wenjing wu%" 

So far I only get one record 

# 	  	EndTime 	  	VOName 	  	ProbeName 	  	CommonName 	  	ResourceType 	  	Njobs 	  	WallDuration 	  	CpuUserDuration 	  	

CpuSystemDuration

1	  	2008-05-06 00:00:00.0	  	usatlas	  	condor:t2srv0002.cmsaf.mit.edu	  	wenjing wu 545240	  	Batch	  	1	  	1	  	0	  	0

Number of records = 1

The Gratia is located at http://gratia-osg.fnal.gov:8880/gratia-reporting/, and I use custom-query option with the above query. 
Note the Gratia records do not include data transfer records, only the job submission records. 

 
   *  Set ALLOWTOPICVIEW = Main.DougOlson, Main.SecurityTeamTeamGroup, Main.RobQ, Main.AlainRoy, Main.JohnHover, Main.DantongYu, Main.TorreWenaus

   * Set ALLOWTOPICCHANGE = Main.DougOlson, Main.SecurityTeamTeamGroup, Main.RobQ, Main.AlainRoy, Main.JohnHover, Main.DantongYu, Main.TorreWenaus 

   * Set DENYTOPICVIEW = Main.TwikiGuest


-- Main.MineAltunay - 19 Jun 2008

   * [[%ATTACHURL%/UMich_vdt_control_out.txt][UMich_vdt_control_out.txt]]: UMich_vdt_control_out.txt

%META:FILEATTACHMENT{name="gridftp-auth.log.3.gz" attr="" autoattached="1" comment="third rotated log" date="1213928910" path="gridftp-auth.log.3.gz" size="5619" user="Main.BobBall" version="1"}%
%META:FILEATTACHMENT{name="gatekeeper.zip" attr="" autoattached="1" comment="Zipped file containing all globus/var/globus-gatekeeper files" date="1213987362" path="gatekeeper.zip" size="169162" user="Main.BobBall" version="1"}%
%META:FILEATTACHMENT{name="accounting.zip" attr="" autoattached="1" comment="Zipped file containing all globus/var/accounting* files" date="1213987334" path="accounting.zip" size="38170" user="Main.BobBall" version="1"}%
%META:FILEATTACHMENT{name="gridftp-auth.log.7.gz" attr="" autoattached="1" comment="Seventh (last) rotated log" date="1213928990" path="gridftp-auth.log.7.gz" size="15693" user="Main.BobBall" version="1"}%
%META:FILEATTACHMENT{name="gridftp-auth.log.1.gz" attr="" autoattached="1" comment="gridftp-auth first rotated log" date="1213928852" path="gridftp-auth.log.1.gz" size="13489" user="Main.BobBall" version="1"}%
%META:FILEATTACHMENT{name="UMich_vdt_control_out.txt" attr="" autoattached="1" comment="" date="1213929800" path="UMich_vdt_control_out.txt" size="798" user="Main.MineAltunay" version="1"}%
%META:FILEATTACHMENT{name="Cacti_umfs02_2day.pdf" attr="" autoattached="1" comment="Cacti monitor plots of umfs02 %22activity%22" date="1213972819" path="Cacti_umfs02_2day.pdf" size="1069890" user="Main.BobBall" version="1"}%
%META:FILEATTACHMENT{name="gridftp-auth.log.5.gz" attr="" autoattached="1" comment="Fifth rotated log" date="1213928948" path="gridftp-auth.log.5.gz" size="8059" user="Main.BobBall" version="1"}%
%META:FILEATTACHMENT{name="secure.zip" attr="" autoattached="1" comment="Zipped file containing all /var/log/secure* files" date="1213987295" path="secure.zip" size="214659" user="Main.BobBall" version="1"}%
%META:FILEATTACHMENT{name="messages.txt" attr="" autoattached="1" comment="Excerpt from /var/log/messages at time of incident" date="1213929030" path="messages.txt" size="2387739" user="Main.BobBall" version="1"}%
%META:FILEATTACHMENT{name="gridftp-auth.log.2.gz" attr="" autoattached="1" comment="Second rotated log" date="1213928891" path="gridftp-auth.log.2.gz" size="7803" user="Main.BobBall" version="1"}%
%META:FILEATTACHMENT{name="gridftp-auth.log.6.gz" attr="" autoattached="1" comment="Sixth rotated log" date="1213928966" path="gridftp-auth.log.6.gz" size="13112" user="Main.BobBall" version="1"}%
%META:FILEATTACHMENT{name="gridftp-auth.log.4.gz" attr="" autoattached="1" comment="Fourth rotated log" date="1213928930" path="gridftp-auth.log.4.gz" size="9664" user="Main.BobBall" version="1"}%
%META:FILEATTACHMENT{name="gridftp-auth.log" attr="" autoattached="1" comment="gridftp-auth.log, current" date="1213928804" path="gridftp-auth.log" size="141828" user="Main.BobBall" version="1"}%
