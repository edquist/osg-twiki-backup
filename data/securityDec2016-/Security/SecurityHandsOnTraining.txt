%META:TOPICINFO{author="AnandPadmanabhan" date="1240585245" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="BestPractices"}%
---+ Security Handson Training 
%TOC%

---++ Topics covered 
   * How to respond to a security incident 
   * How to ban a user DN from your site 
   * How to track down jobs submitted by a DN
   * How to locate relevant log files
   * Basic forensics steps for incident response

---++ The scenario 
   * OSG Security Team contacts you about a “bad DN”
   * We're submitting jobs using the “bad DN”
   * In a real incident
      * Contact security at opensciencegrid.org  and local security response
      * Security team will send you a signed email indicating the action to be taken
      * Take actions identified in the email ASAP
      * Detailed incident response procedures can be found [[IncidentDiscoveryReporting][here]]

---++ Major steps to take when responding to compromised user DN
   * Stop further exposure
   * Find out if your site was exposed and to what extent
   * Conduct basic forensics
   * Clean up suspect jobs

---+++ How to stop further exposure of your site?
   * Ban the user DN. We will discuss how later.
   * Keep CAs and CRLs upto date
      * Ensure that tools like vdt-update-certs and fetch-CRL have been enabled
   * Keep the VO list updated
      * Check if GUMS is contacting the VOMS server periodically and gums-host-cron service from VDT is enabled on CE
      * If using end-mkgridmap ensure that the edg-mkgridmap service is enabled in VDT
   * Watch the logs 
      * Gatekeeper logs, batch system logs and syslogs


---++++ Ban a user DN from your site?
---+++++ Sites using Gums 1.3
   * Go to the GUMS web interface
      * https://gums-host:8443/gums/
   * Add new  manual group called banned
      * Configuration -> User Groups -> Add
      * Select type = manual and provide name, description. Then save
   * Add this group to a “banned user group”
      * Click on Configuration 
      * Select the group from drop down menu and save
   * Add user DN to the banned group
      * Click on “Manual User Group Members” in “User Management” section
      * Click Add, select the appropriate “user group”
      * Add the user DN and save
   * Test the mapping from your CE
      * %gums-host mapUser "DN" (as su)
      * Only if the mapping returns null, the user is banned 

---+++++ Sites using Gums 1.2
   * No direct banning option is available directly in GUMS.
   * Here are some alternatives
       * Ensure your site should follow the best practices.
       * If critical security problem has been reported, you may choose to ban all the VOs the DN is a member of for a short period till the VO membership/CRL has been updated
       * Disable the unix account the user is getting mapped to

---+++++ Sites using edg-mkgridmap
   * Update the edg/etc/edg-mkgridmap.conf (in $VDT_LOCATION)
      * Add a line 'deny “DN”'  
      * Wild cards are also accepted
      * Regenerate grid-mapfile executing  edg/sbin/edg-mkgridmap
      * Log file can be generally found at edg/log/edg-mkgridmap.log
   * Check your grid-mapfile and confirm that the DN has indeed been removed

---++++ Best practices to limit exposure 
   * Keep CAs and CRLs upto date
      * Ensure that tools like vdt-update-certs and fetch-CRL have been enabled
   * Keep the VO list updated
      * Check if GUMS is contacting the VOMS server periodically and gums-host-cron service from VDT is enabled on CE
      * If using end-mkgridmap ensure that the edg-mkgridmap service is enabled in VDT
   * Watch the logs 
---++++ Waht does this step accomplish 
   * User will not be able to submit new jobs (or get authorized in the future) to your site.
   * Existing jobs will continue to run.

---+++  Find out if your site was exposed?

   *  Look at log files 
      *  Globus gatekeeper and accounting logs
      * GUMS log can provide a centralized place to check multiple gatekeepers
      * Check syslogs
   * Location of some log files can be found at
      * [[https://twiki.grid.iu.edu/bin/view/Integration/ITB092/ComputeElementLogFiles]]

---++++ What should log files tell you
   * Has the “bad DN” run on your site?
   * What IP address did the job originate from?
   * When (timestamps)? 
   * What unix account did the user map to?
   * Did the mapping use a pool account or were all users from VO mapped to the same account?
-- Main.AnandPadmanabhan - 13 Mar 2009
