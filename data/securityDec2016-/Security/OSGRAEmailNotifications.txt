%META:TOPICINFO{author="JamesBarlow" date="1274286594" format="1.1" version="1.7"}%
%META:TOPICPARENT{name="OsgRaPlanning"}%

%TOC%

---++ Email Notifications within the OSG RA
The certificate workflow status and notifications to interested parties has some significant shortcomings.
The existing workflow is illustrated at https://twiki.grid.iu.edu/twiki/bin/view/Security/OsgRaPlanning#Example_workflow.

This page describes a rather simple means to improve (not perfect) the situation.

---+++ Current status of notifications.
The interaction diagram below shows the current state of notifications (in black) along with the desired by missing
notifications (in %RED% red %ENDCOLOR%).  Terms defined below in the [[#Glossary][Glossary]].

<img src="%ATTACHURLPATH%/notices-jun08-v2a.png" alt="notices-jun08-v2a.png" width='960' height='720' />

Workflow steps in diagram above.
   1. Assume that a PI, supervisor or co-worker tells a person to request a certificate.
   1. A person (Subscriber) requests a certificate, including choice of VO.
   1. All Agents are notified of new requests automatically as soon as a request is submitted.
   1. Assume that the Subscriber tells their PI or supervisor that a request was submitted.
   1. An Agent claims this specific certificate request.
   1. Agent check with Sponsor to confirm the request.
   1. Sponsor checks with PI or Subscriber to verify that this request was submitted.
   1. Sponsor confirms status of request with Agent.
   1. Agent grants certificate (or rejects or cancels request).
   1. The RM sends CSR to CA for signing (automatic).
   1. CA signs certificate, publishes it to the ldap directory, and notifies subscriber.
   1. Agent records action of granting (or canceling/rejecting) request.
   1. Subscriber retrieves certificate. No notifications are generated.



---+++ Proposed notifications
The interaction diagram below shows the proposed changes to the notifications in %GREEN% green %ENDCOLOR%.
Terms defined below in the [[#Glossary][Glossary]].

 <img src="%ATTACHURLPATH%/proposed-notices-jun08-v2.png" alt="proposed-notices-jun08-v2.png" width='960' height='720' />

Workflow steps in the digram above.
   1. Assume that a PI, supervisor or co-worker tells a person to request a certificate.
   1. A person (Subscriber) requests a certificate, including choice of VO.
   1. Notice of new request received is sent to VO Filter service.
   1. VO Filter service forwards new request notice to appropriate VO Cert List & Log service.
   1. VO Cert List forwards notice to appropriate Agents and other interested parties that have subscribed to this VO list.
   1. Subscriber may notify PI that request was submitted, or PI may have chosen to receive VO certificate notifications automatically.
   1. An Agent for this VO claims the request.
   1. The Agent claiming request should reply to the original notice stating that request was claimed.  This will cause everyone subscribed to the VO cert list to receive a copy of this reply notice.
   1. Agent check with Sponsor to verify request.
   1. Expect that Sponsor checks with  Subscriber or PI to validate certificate request.
   1. Sponsor confirms status of request with Agent.
   1. Agent grants certificate (or cancels or rejects request).
   1. The RM sends CSR to CA for signing (automatic).
   1. CA signs certificate, publishes it to the ldap directory, and notifies subscriber.
   1. Proposed to add notification to VO Filter service that a certificate was issued, using a similar subject line as used for the original request notice.
   1. VO Filter service select specified VO and forwards to VO Cert List.
   1. VO Cert List forwards notice to Agents and other subscribed interested parties for this VO.
   1. Agent records action of granting (or canceling/rejecting) request, by replying to the VO Cert List & Log.
   1. Other Agents and interested parties will get copy of recorded action message for this request.
   1. Subscriber retrieves certificate.  No notifications are generated.


---+++ Work to do to implement these changes

   1. Set up alias with procmail filter to sort messages by VO using Subject line "OSG:VO" to do the filtering.
   1. Set up a mailman mail list for each VO that receives the filtered notices.
   1. Subscribe the Agents to the VO lists according to which VOs they process requests for.
   1. Redirect the doesg-ra mail list to use the alias with the procmail filter instead of the individual Agents' email addresses.
   1. Add the alias address from 1. to the recipients for "certificate issued" notice sent to subscriber, or a parallel message from the CA.
   1. Train Agents to log all actions to the VO list that they received the notice from.
   1. Inform VOs to subscribe PI's and other interested parties to the appropriate VO mail list.

---+++ Ongoing maintenance
   1. Update the procmail filter and appropriate VO lists for changes in Agents and VOs.
   1. Manage subscriptions to the VO lists.

---+++ Questions
   1. Set up mail processing on portnoy.lbl.gov or set up a dedicated machine?
   1. Use FNAL mail lists or mailman on portnoy.lbl.gov for the mail lists, or define a virtual host on crd.lbl.gov for mail man lists?
   1. What about integration with Roundup issue tracker (https://roundup.doegrids.org/Roundup/osg-ra/) ?
   1. What about RAs other than OSG?
      * Probably simplest thing is to include those in the VO Filter and have additional email lists for those RAs also.

---+++ Glossary
Including definitions from the DOEGrids CP/CPS:

   * *Agent* - see Registration Agent
   * *Agent Notifier* - the service sending email notifications to Agents
   * *Certification Authority (CA)* - The entity / system that issues X.509 identity certificates (places a subject name and public key in a document and then digitally signs that document using the private key of the CA
   * *CSR* - certificate signing request
   * *End Entity* - A system entity or person that is the subject of a public-key certificate and that is permitted and able to use, the matching private key only for a purpose or purposes other than  signing an X.509 public key certificate; i.e., an entity that is not a CA.
   * *Host Certificate* - A Certificate for server certification and encryption of communications (SSL/TSL). It will represent a single machine. Host Certificates are used internally by the PKI service and are not issued to other sites/VOs
   * *Log* - the logging database recording the action taken by the Agent (usually an email list web archive)
   * *Owner* - The human individual or organizational group that has valid rights to exclusive use of a subject name in a certificate.  The process of registering the end entity of a certificate request is what maintains the binding between an owner and the subject name (DN).
   * *Person Certificate* - A certificate associated with a unique human being.
   * *PI* - supervisor of Subscriber, or principle investigator of project that Subscriber is working on that causes the need for a certificate.
   * *Registration Authority (RA)* - An entity that is responsible for identification and authentication of certificate subjects, but that does not sign or issue certificates (i.e., an RA is delegated certain tasks on behalf of a CA).
   * *Registration Agent (RAg) or &#8220;Agent&#8221;* - RAg is the entity that interacts with the RM in order to cause the CA to issue certificates.  Agents working with the OSG have a defined set of onen or more VOs for which they process certificate requests.
   * *Registration Manager (RM)* - The RM is a front-end Web server for the CA that provides a Web user interface for CA subscribers and agents. The RM forwards certificate-signing requests to the actual CA (DOE GRIDS) to issue X.509 certificates.
   * *Registered Owner* - Once a certificate request has been verified, the ownership of the DN validated, and a certificate issued, the owner is considered to be the &#8220;registered owner&#8221; of the DN.  See above for definition of &#8220;Owner&#8221;.
   * *Relying Party* - A recipient of a certificate who acts in reliance on that certificate and/or digital signatures verified using that certificate. 
   * *Service Certificate* - A certificate for a particular service running on a host.  It will represent a single service on a single host.
   * *Sponsor* - a trusted person who can provide id vetting confirmation to an Agent for processing a certificate request
   * *Subscriber* - The person who requested a certificate.
   * *Subscriber Notifier* - the service sending email notifications to Subscribers
   * *UI* - web user interface to the Registration Manager with interfaces for Agents and Subscribers
   * *VO* - a virtual organization listed as one of the choices when requesting a certificate.
   * *VO Cert List & Log* - proposed email list and web archive service to distribute and record certificate request processing messages for a particular VO. Will have a separate list for each VO.  Agents that process certificate for more than one VO will be subscribed to as many email lists as necessary.
   * *VO Filter* - proposed service to direct certificate notifications to the relevant set of VO Agents.

-- Main.DougOlson - 10 Jun 2008
     
-- Main.DougOlson - 17 Jun 2008

%META:FILEATTACHMENT{name="notices-jun08.jpg" attr="" autoattached="1" comment="Current Notifications" date="1213121183" path="notices-jun08.jpg" size="59880" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="notices-proposed-jun08.jpg" attr="" autoattached="1" comment="Proposed Notifications" date="1213121504" path="notices-proposed-jun08.jpg" size="65722" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="notices-jun08-v2a.png" attr="" autoattached="1" comment="Current Notifications - V2a" date="1213717082" path="notices-jun08-v2a.png" size="27569" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="proposed-notices-jun08-v2.png" attr="" autoattached="1" comment="Proposed Nofitications - V2" date="1213717141" path="proposed-notices-jun08-v2.png" size="30627" user="Main.DougOlson" version="1"}%
%META:FILEATTACHMENT{name="notices-jun08-v2.png" attr="" autoattached="1" comment="Existing notifications - V2" date="1213714435" path="notices-jun08-v2.png" size="27091" user="Main.DougOlson" version="1"}%
