%META:TOPICINFO{author="AnandPadmanabhan" date="1323464062" format="1.1" reprev="1.33" version="1.33"}%
---+!! Testing of new CA distribution format on ITB
%TOC%

As some of you have heard, we are transitioning to using Digicert CA for end user and host certificates. We are conducting a pilot trial where we test the Digicert certificates compatibility with our software. We only have a month to finish this test. 

This test will have three parts 1) get a new CA package with digicert test CA and test software components; 2) get digicert host and service certificates for the machines/services on ITB; and 3) get user certificates for ITB participants and test our s/w infrastructure with these new certificates. We hope to get a wide coverage of OSG s/w components tested in ITB just in the same way we tested the transition to the new CA format. We will be creating an RPM package which contains the new CA certificates which the ITB test site will install. 

---++ Instruction to install !DigiCert CA from OSG repository
The new CA packages are released as RPMs to the osg-development and osg-testing repositories. 

----+++ Preperation

   1. Install Yum repository required by OSG: For more details, please see our [[Documentation/Release3.YumRepositories][yum repository documentation]].
   1.  Enable OSG testing Repository:  The only OSG repository enabled by default is the release one. If you want to enable another one, e.g. osg-testing, then edit its file (e.g. =/etc/yum.repos.d/osg-testing.repo=) and change the enabled option from 0 to 1: <pre class="file">
[osg-testing]
name=OSG Software for Enterprise Linux 5 - Testing - $basearch 
baseurl=http://vdt.cs.wisc.edu/repos/3.0/el5//testing/$basearch
failovermethod=priority
priority=98
enabled=%RED%1%ENDCOLOR%
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OSG
</pre>
   1. Install CA certificates: For full details and options, please see our [[Documentation/Release3.InstallCertAuth][CA certificates documentation]].

---+++ Install the Digicert Test CA 

<pre class="rootscreen">
%UCL_PROMPT_ROOT% yum install digicert-test-ca-certs
</pre>

---+++ Point your authentication system to VOMS-ITB 
All the testers with DigiCert Test CA personal certificates have been placed in a VOMS-ITB server at GOC as members of MIS VO on ITB. To authorise DNs from this VOMS server please update your configuration files as follows

   1. In the VOMSES file replace
<pre class="file"> "mis" "voms.grid.iu.edu" "15001" "/DC=org/DC=doegrids/OU=Services/CN=http/voms.grid.iu.edu" "mis" </pre> with 
<pre class="file"> "MIS" "voms-itb.grid.iu.edu" "15001" "/DC=com/DC=DigiCert-Grid/OU=Services/CN=voms-itb.grid.iu.edu" "MIS" </pre>
   1. If using grid-mapfiles in the edg-mkgridmap file replace
<pre class="file"> group vomss://voms.grid.iu.edu:8443/voms/mis mis </pre> with <pre class="file"> group vomss://voms-itb.grid.iu.edu:8443/voms/MIS mis </pre>
   1. If using GUMS In the gums.config replace
<pre class="file"> url="https://voms.grid.iu.edu:8443/voms/mis/services/VOMSAdmin" </pre> with <pre class="file"> Url="https://voms-itb.grid.iu.edu:8443/voms/MIS/service/VOMSAdmin" </pre>
and <pre class="file"> voGroup="/mis" </pre> with <pre class="file">voGroup="/MIS"</pre>

The configuration info pages on VOMS server can be  found at: [[https://voms-itb.grid.iu.edu:8443/voms/MIS/configuration/configuration.action]]. 

---+++ Checklist for ITB admins
   1. Make sure you have installed the Digicert CA from osg-testing repository. This should be done in addition to the other RPM that provides grid-certificates.
   1. Ensure you have host and service certificate from the Digicert CA installed.
   1. Get a new personal certificate and run validation tests against your ITB site with the new CA.
   1. Add your Digicert DN to authenticate you locally. You could do  this by updating your ITB GUMS server to point to the VOMS server
   1. Update this page with the list of software/services that were tested at your site.
   1. Please report back to security team and update this page  if you run into any problems. 

---++ Tests

Test expected from ITB is very simple. WE will provide you host and end user certificates from Digicert. You will install them on your ITB servers. You will do the  ITB tests as usual. Of course, we will also provide you with a CA files that contains the Digicert CA root certificate itself (see instructions). If GSI or some other library breaks, you will let us know. When you submit jobs or move data, we will also ask you to use your new Digicert personal certificate. To facilitate this
   1. Provide us with list of FQDNs for your ITB servers you need host and service certificate for.
   1. If you usually submit jobs to ITB servers for testing, then we will also get you a personal certificate from Digicert. 

In particular we want the following pieces of software/services tested/verified and signed off by ITB sites.

   1. CE 
      * gatekeeper
      * gsiftp
      * RSV probes
      * fetch-crl
   2. SE 
      * dcache
      * bestman
      * Xrootd/Hadoop with GridFTP
   3. GUMS
   4. VOMS
   5. OSG client
      * globus client tools
      * srm client tools
      * Condor-G
   6. WN Client
   7. pilot jobs framework
   8. glexec


%TABLE{ sort="off" valign="top" }%
%EDITTABLE{  header="| Site | Contact Person | Start Date | ITB Version | Node Type | Notes |"  format="| text,10| text,10 | text,10 | text, 10 | text, 10 | textarea,3x20|" }%
| Site | Contact Person | Start Date | ITB Version | Node Type | Notes |
| UC-ITB | Suchandra Thapa | 11/15/2011 | Latest RPM versions as of 11/09/2011 | Hadoop/Bestman2, xrootd/Bestman2, dcache, GUMS, CE, WN | WN are not configured to run glexec. Atlas does not require having glexec. Suchandra has no pacman versions of the software. Suchandra uses certify for bulk certificate request.Need FQDN for services? . Suchandra will need a personal certificate. <br />CE - <br />   vtbv-ce.uchicago.edu <br />   rsv/vtbv-ce.uchicago.edu - rsv service cert <br />   http/vtbv-ce.uchicago.edu  - http service cert <br /> <br />GUMS - <br />   itb-gums.uchicago.edu <br />   http/vtbv-ce.uchicago.edu  - http service cert <br /> <br />dcache - <br />   itbv-dc1.uchicago.edu <br />   http/ <br /> <br />hadoop - <br />   itbv-bmh1.uchicago.edu <br />   http/ <br /> <br />xrootd - <br />    itbv-bmx1.uchicago.edu <br />    http/ <br /> |
| FNAL | Steve Timm | ? After Supercomputing | | | FQDNs: cloudgums.fnal.gov and fgitbgkc1.fnal.gov. Needs a personal certificate for Steve Timm. Do not use certify |
| BNL | Xin Zhao | 11/15/2011 | | CE | ITB CE nodes: gridtest01.racf.bnl.gov and gridtest02.racf.bnl.gov. Xin  Zhao needs a personal certificate <br /> |
| UCSD | Terrence Martin | 11/15/2011 | | CE | Will do CE level testing with a gridmapfile on our ITB host. CE is not currently talking to GUMS. CE is sending sending jobs to production WNs so WNs will not be tested. <br /> <br />Question from Terrence: If I want to switch my systems to the new <br />CA do you know if the software for requesting large numbers of certs via grid- <br />admin called "certify" will work with this new CA? |
| FNAL_CMS | Tony Tiradani | 11/15/2011 | Latest RPM | CE (RPM), CE (Pacman), Worker Node (RPM), glexec, glideinwms | John W. has provided a GUMS server that is talking to the VOMS server that Rob Q. set up. <br /> <br />FQDNs: cms-xen13.fnal.gov, cms-xen15.fnal.gov, WN FQDN: cms-xen30.fnal.gov, cms-xen31.fnal.gov, cms-xen32.fnal.gov. Needs a Personal Certificate for Tony Tiradani. <br /> <br />Tony will also test glidein-wms. Service certificates needed for following FQDN <br />cms-xen6.fnal.gov <br />cms-xen7.fnal.gov <br />cms-xen8.fnal.gov |
| Nebraska | Brian Bockelman | 11/15/2011 | ? | ? | Limited participation. The site will only install the DigiCert root certificate on the nodes. They will NOT obtain new service/host certificates. They will test whether a user with DigiCert certificate can submit jobs. <br /> <br />Endpoints covered -  CEs, WNs, xrootd, and storage endpoints. |
| GOC | Rob Quick | 11/15/2011 | latest VOMS RPM version as of 11/9/2011 | VOMS | FQDN: voms-itb.grid.iu.edu. Personal certificates: Rob Quick, Kyle Gross, Elizabeth Chism |

---+++ Test Status



%TABLE{ sort="off" valign="top" }%
%EDITTABLE{  header="| Site | Contact Person | Installed Digicert CA from Yum | Installed Digicert Host/Service Cert | Tested Using Digicert Personal Cert |  Enable users from new VOMS-ITB  | Software/Services Tested | Notes | Status |"  format="| text,10| text,10 | text,10 | text, 10 | text, 10 | textarea,3x20 | textarea,3x20|textarea,3x20|" }%
| Site | Contact Person | Installed Digicert CA from Yum | Installed Digicert Host/Service Cert | Tested Using Digicert Personal Cert | Enable users from new VOMS-ITB | Software/Services Tested | Notes | Status |
| UC-ITB | Suchandra Thapa | %Y% | %Y% | %Y% | %Y% | GUMS, CE, SE (hdfs/bestman2, xrootd/bestman2), osg-client | GUMS gets an error talking to other VOMS server w/o the digicerts root CA. This is not a problem but a desired behavior since production  VOMS dont trust digicert CA. | Was able to use digicert host certs for gums and CE without problems.  Can authenticate and run jobs using digicert personal cert using manual mappings in gums. <br /> <br />Tested CE/GUMS/SE with VOMS information from GOC without issues. <br /> <br />Suchandra anticipates being done with voms testing  by the end of 12/6. <br /> <br />Update 12/6: Suchandra was able to store and use the digicert and a voms-proxy against a xrootd/bestman2 and hdfs/bestman2. |
| FNAL | Steve Timm | %Y% | %Y% | %Y% | | CE, digicert personal cert from client side | | 12/09 Update: Steve was able to make a voms-proxy-init <br />against the voms-itb.grid.iu.edu and that worked. <br /> <br />So thus far he has: <br />1) presenting cert to voms-admin web ui, ok <br />2) sending job to gatekeeper with grid-mapfile, ok (digicert on host cert and on user cert) <br />3) presenting cert to voms-proxy-init, ok <br />4) presenting cert to gums web ui, ok. <br />   (with digicert certs both in browser and on gums server) <br /> <br />Still to do <br />5) getting itb gums server to try to read voms-itb.grid.iu.edu <br />6) changing test gatekeeper back to use lcmaps and talk to gums <br />7) putting a digicert cert on his saz server. <br /> <br /> <br />11/30 Update: Steve was able to use personal Digicert cert with a <br />grid-proxy to run a fork job on a gatekeeper with a Digicert host cert <br />authorized by grid-mapfile. <br /> <br />Steve was able to put a host and http cert on a gums server, <br />add the digicert CA to the /etc/grid-security/certificates, <br />present my digicert personal cert to the browser, <br />and open the GUMS web UI. This means that these certs work OK for apache mod_ssl handshakes <br />which is what GUMS does. <br /> <br />Tests to begin on 11/21. Further delayed. Testing to begin on 11/29/2011 |
| BNL | Xin Zhao | %Y% | %Y% | %Y% | %Y% | GUMS, CE, personal cert from client side | | Test began on 11/21. Installed the new hostcert and CA bundle on gridtest01.racf.bnl.gov and ITB GUMS instance. <br /> <br />Join the MIS VO with the digicert user certificate at GOC ITB VOMS on 12/02/11. <br /> <br />Now we have digicert CA certs installed on our CE, GUMS and client node. Tested voms-proxy-init, globus job submission with and without condor-g, and globus-url-copy using the gridftp server, all work fine. |
| UCSD | Terrence Martin | %Y% | %Y% | NO | NO | | | Tests to begin on 11/17. Further delay reported on 11/29/2011. Did not do any testing due to other work unrelated to Digicert |
| FNAL_CMS | Tony Tiradani | %Y% | %Y% | %Y% | %Y% | voms-proxy-init, voms-proxy-info, globusrun, globus-job-run, osg client (RPM), OSG CE(RPM) | Was given a mismatching cert/key pair for cms-xen15.  Couldn't use it for anything.  How does one check the key for issuer and host validity?  Checking the cert is easy. <br />11/21/2011: The mismatching cert issue is resolved. | Update 12/09: <br />This round of testing included both glideinWMS and glexec.  glideinWMS has been configured to use glexec and thus tests it as well as uses it. <br /> <br />Once permissions were set  right (600 for the keys) on all nodes and then Condor was happy. <br /> <br />Update 11/30: Site was able to test authentication with CE and run simple hello world jobs on the fork jobmanager and the condor jobmanager (i.e. on worker nodes). glideinWMS tests are left. Waiting for VOMS-ITB issue to resolve. <br /> <br />Tony reports: <br />1) I am able to install the DigiCert CAs <br />2) I am simply copying the certs/keys to hostcert/key.pem on the <br />applicable machines (I back up the DOE cert/key first) <br />3) I have my personal DigiCert certificate <br /> |
| GOC | Rob Quick | %Y% | %Y% | | | VOMS server | | GOC was able to successfully configure the VOMS-ITB to use digicert CA. |
| | | | | | | | | |
*NOTE* : If any of the pieces fail the test please record the failure and provide details. If you did not test a particular software/service please also make a note of it.




-- Main.AnandPadmanabhan - 08 Nov 2011
