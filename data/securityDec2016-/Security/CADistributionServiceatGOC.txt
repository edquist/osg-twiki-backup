%META:TOPICINFO{author="JimBasney" date="1220546194" format="1.1" version="1.4"}%
%META:TOPICPARENT{name="SecurityTeamWorkingArea"}%
---+ Steps to Prepare a new CA package to be distributed at GOC-- Interim process
   1 These steps are meant to be an interim process until the SVN client is ready and each security team member have access to the GOC repository. there are comments listed below, please read it carefully. See Security.CreatingCADistributions for the SVN-based process.
   1 The GOC CA distribution pacman caches are: http://software.grid.iu.edu/pacman/cadist/ca-v39/. This bundle has two tar-balls I asked Rob the difference and he said there is a small unimportant difference. Please clarify with him again and only provide a single tar ball so as not to confuse anyone. 
   1 the old process for creating the CA distribution by VDT is here http://vdt.cs.wisc.edu/internal/igtf-updates.html 
   1 the SVN repository at VDT is here http://vdt.cs.wisc.edu/svn/viewvc.cgi/vdt/branches/V1_2-branch/CA-Certificates-Base/ 
   1 You will cretae two directories on your machine that are important: One for existing IGTF distribution directory and another one for the new IGTF distribution directory. I will call the new one made-igtf-1.6 in this example. the existing one is called existing-igtf-1.24 for illustration. IMPORTANT: The scripts we have (process-igtf-dictribution.pl and igtf-1.26-update-script.sh and igtf-1.26-update-diff.log) assume that $IGTF_directory is the NEW distribution directory. $VDT_directory is the EXISTING directory. When you run igtf-1.26-update-script.sh it will do teh changes over EXISTING directory which is VDT_Location whch is existing-igtf-1.2.4. The new files will be copied, unnecessary ones will be removed, and updates will be done into existing-igtf-1.24 directory. 
   1 First download the tarball from GOC Pacman cache into directory on your machine. 
   1 Create a directory with the existing distribution name and version number, e.g. existing-igtf-1.24. (Alain's process-igtf-distribution.pl script will search for the directory name and take version number from the directory nameas follows: e.g. existing-igtf-1.22 Alain's script will think the version is 24. In fact process-igtf-distrbution.pl only cares for the IGTF directory version, not your existing ca directory version. but I think it is good practice.) 
   1 get into your existing-igtf-1.24 and untar the certificates 
   1 Get the new distribution from IGTF. This is brand new distribution 1.26. IGTF website is at http://www.gridpma.org/, but the distribution is maintained at [[http://www.eugridpma.org/][the EUGridPMA site]]. I usually start at [[http://www.eugridpma.org/distribution/igtf/current/][the current distribution page]], then go into the accredited directory and fetch the installation bundle tarball. 
   1 Unpack the certificates:tar xzf igtf-policy-installation-bundle-1.26.tar.gz 
   1 make an installation directory: mkdir made-igtf-1.26. This is NEW distribution directory. <br /><p> You must install the certificates before using them. Make sure the directory name ends with the IGTF version and that there are no other digits in the name. This is IMPORTANT: process-igtf-distribution.pl script will search for the directory name and take version number from the directory name as follows: e.g. igtf-1.26 will be called 26. So it is important to keep the same structure. The process-igtf-distribution script will generate two files: igtf-1.26-update-diffs.log and igtf-1.26-update-script.sh. You will need those files. More on this later </p> 
   1 Configure the installation <pre> We want all of the accredited certificate authorities plus the Fermilab KCA certificate. </pre> 

<pre>        $ *./configure --prefix=../made-igtf-1.24 --with-profile=classic --with-profile=slcs --with-profile=mics --with-authority=FNAL_KCA*  </pre>

Configuration of the IGTF bundle complete

use "make install" to install the selected authorities in

$../made-igtf-1.26.
<pre>         $ *cd igtf-policy-installation-bundle-1.26* </pre><pre>        Install the certificates into your temporary directory</pre><pre>        $ *make install* </pre><pre>        Installing CAs for profile accredited:slcs </pre><pre>        install policy-igtf-slcs.info ../made-igtf-1.26/</pre><pre>        install src/accredited/a317c467.0 ../made-igtf-1.26/</pre><pre>        ...</pre><pre>        install src/accredited/9dd23746.namespaces ../made-igtf-1.26/ </pre><pre>        install src/accredited/9dd23746.signing_policy ../made-igtf-1.26/</pre><pre>        Installing CAs for profile accredited:classic</pre><pre>         install policy-igtf-classic.info ../made-igtf-1.26/</pre><pre>         install src/experimental/e1fce4e9.0 ../made-igtf-1.26/</pre><pre>         install src/experimental/e1fce4e9.info ../made-igtf-1.26/</pre><pre>         install src/experimental/e1fce4e9.namespaces ../made-igtf-1.26/</pre><pre>         install src/experimental/e1fce4e9.signing_policy ../made-igtf-1.26/</pre>

12. Run the process-igtf-distribution.pl with two directories: your new made-igtf-1.26 directory and existing-igtf-1.24.

IMPORTANT: the first argument is the NEW directory 1.26 (In the scripts this is referred as IGTF_directory). The second argument is your existing directory 1.24 (this is VDT_directory in my script.) When you generate the bash script, this order is very VERY important. The modifications will be done to the second directory, existing-igtf-1.24.

The process script is supposed to find the differences between each and every CA files. Use the script I attached to this web site because the Alain's script is hard-coded for the VDT environment and I am generating the igtf-1.26-update-script.sh differently. Again do not use Alain's scripts as they are . they won't run.

$ perl proces-igtf-distribution.pl made-igtf-1.26 existing-igtf-1.24 > out

No trailing slashes. It confuses the script.

Inside the out file, you will see bunch of print outs.(Anythign starts with MINE is added by me-I removed them but just in case.) The output file will tell you for each CA, how many new files are in the distribution 26 , hence to be added into 24 directory. Or how many files are not needed and removed from your existing directory 24. Adds or removes are told as if you are adding/removing into your existing-igtf-1.24. Go inside the igtf directories and ls for the specific CA hash value. did you expect to add or remove a file? You can look inside igtf-1.26-update-script.sh that will tell you exactly which files will be copied into existing-igtf-1.24 from made-igtf-1.26 or deleted.

If the output tells you a file has changed, look inside igtf-1.26-update-diffs.log : it tells you which files have been changed.

If you do not want to add a file: modify the igtf-1.26-update-script.sh accordingly

Run igtf-1.26-update-script.sh

check the changes are really done to existing-igtf-1.24.

12' ALTERNATIVE INSTRUCTIONS if you do not want to run igtf-1.26-update-script.sh . Make a note of every single output from the out file. Manually compare the CA files in two directories and manually either copy or remove or do nothing inside the existing-igtf-1.24 directory. because you are not running igtf-1.26-update-script.sh, you have to one by one copy or remove each file from the 1.26 directory into the 1.24 directory.

13. Copy TeraGrid CAs. from http://security.teragrid.org/TG-CAs.html . We proposed ET to only include Purdue Teragrid CA. But I have no feedback yet. So go ahead and include all TeraGrid CAs.Note in our scripts , We neverbother examining TeraGrid CA files. They are ignored purposefully in the code.

14. Examine the !TeraGrid CA files

15. Go inside existing-igtf-1.24 directory. Create a new tarball and name it something meaningful such as OSG-new-CA-distribution.1.26. Send it to GOC. Rob will update the pacman caches.

-- Main.MineAltunay - 14 Aug 2008

Be careful to check if !TeraGrid has removed a CA. And, it's necessary to update the INDEX.txt and CHANGES files manually.

The doegrids subdirectory and the *.conf.1c3f2ca8 files are used by doegrids-cert-request. They appear to come from https://pki1.doegrids.org/Other/doegrids.tar.

-- Main.JimBasney - 14 Aug 2008

   * [[%ATTACHURL%/process-igtf-distribution.pl.txt][process-igtf-distribution.pl.txt]]: Mine's modified process-igtf-distribution.pl

%META:FILEATTACHMENT{name="process-igtf-distribution.pl.txt" attachment="process-igtf-distribution.pl.txt" attr="" comment="Mine's modified process-igtf-distribution.pl" date="1218749739" path="process-igtf-distribution.pl" size="7414" stream="process-igtf-distribution.pl" tmpFilename="/usr/tmp/CGItemp8168" user="MineAltunay" version="2"}%
