%META:TOPICINFO{author="MineAltunay" date="1312994716" format="1.1" version="1.11"}%
---++ Identity Management Roadmap for OSG
%TOC%

---+++ How Identity Management Works in OSG 

---++++How to Get a New Certificate

   It is important to understand how OSG Registration Authority works. OSG Registration Authority (RA) consists of a service and a collection of agents and sponsors. The Agents and sponsors are members of various OSG VOs. Each VO in OSG identifies an RA Agent and a set of sponsors. Together agents and sponsors vets a user's identity. The RA service that implements the RA process is operated by the DOEGrids CA. The software and hardware is owned and operated by the DOEGrids CA using RedHat Certificate Services software. Whereas, the RA process is enacted by OSG RA Agents and sponsors. OSG do not have an RA service independent of the one provided by DOEGrids CA.    

    <img src="%ATTACHURLPATH%/IDMgmtCurrent_2011_1.jpg" alt="IDMgmtCurrent_2011_1.jpg" width='574' height='500' />    

   *Trust Relationship Diagram for Identity Vetting Workflow*
     <img src="%ATTACHURLPATH%/Slide4_2.jpg" alt="Slide4_2.jpg" width='673' height='194' />    

   *Identity Vetting in EGI: Trust Relationship Diagram for European CAs*
     <img src="%ATTACHURLPATH%/Slide5_2.jpg" alt="Slide5_2.jpg" width='689' height='131' />    

   OSG RA is also used to issue *service certificates* in addition to the personal certificates. These certificates have a slightly different workflow. *For this discussion, we will put service certificate aside and only discuss personal certificates.*  

---++++How to Register with a Virtual Organization
 
   Similar to the identity vetting step, a user's registration with his/her VO is performed by the VO admins. VO admin is a different person than a RA Agent. Depending on the VO, admins may consult the user's sponsor (same person from the identity vetting step) or consults an external user database in order to understand whether the user should become a member of the VO. Note that this is slightly different than identity vetting. Even with a proper identification, a person without any ties to a VO is refused membership. For LHC VOs, CERN HR maintains external membership databases. When a user wants to register with CMS or Atlas, the user provides his CERN ID number, birth date and some other information recorded in CERN db to prove his identity and his ties with the experiment. If the user does not show up in the CERN db, then his registry is refused. (The user initially signs up with the CERN database when he first joins the experiment.) After this, the user sends his certificate DN to be registered in the VO database. Thus, user's certificate is not necessarily used as an authentication vehicle during the VO registry. 

   For VOs without external databases, a VO admin should consult a sponsor in the VO (the same person from the identity vetting step)

     <img src="%ATTACHURLPATH%/IDMgmt_Current_2001_2.jpg" alt="IDMgmt_Current_2001_2.jpg" width='571' height='505' />    

   *Trust Relationship Diagram for VO Registration Workflow*
     <img src="%ATTACHURLPATH%/Slide6.jpg" alt="Slide6.jpg" width='720' height='540' />    

---+++ Assumptions
   1. Not all Sites need to see the identity of the person submitting  each job and moving each file. . Separate sites into those who a) do not  need and b) who need "to see the identity of the person submitting each job and moving each file". Expect there are both kinds of sites. 
      * Expect (b) to be DOE Sites but Fermilab may be in (a).
   1. Chain of trust can be defined by OSG.

---+++ Potential Needs

 
---+++ Problems with Identity Management
   Here we are focusing more on the certificate request and retrieval steps. However, VO registration is also part of the identity management lifecycle. We merely focus more on certificates because users have more difficulties in this area. 

   1. Usability: 
      1 *Difficulty of managing X.509 certificates* Exporting/importing certificates into/from browsers; having them work with grid command line tools; etc. This problem cannot be solved by OSG. This can be solved only by support from browser/OS vendors. _However, a viable solution for OSG is to hide the certificates from the end user as much as possible. This can be achieved by using glideinWMS user portals and similar portals to authenticate the user via username/password combos and then generating a user certificate on user's behalf without user's knowledge_.  
      1 *Approval period: Certificate approval takes 3-5 days*. The approval is dependent on the confirmation by a user's sponsor (i.e professor, PI, etc). The sponsor can approve a request as soon as he gets it, but in reality most sponsors take couple days to do this. Users, on the other hand, want "5-minute certificates", credentials that can be issued in 5 minutes. _This is not easy to fix because it requires changing sponsor's behaviors_.
      1 *The software used by the CA server has problems with some browser/OS combos*. Users frequently have trouble with request and renewal actions due to incompatibility between user browser and the CA server. CA server tries to patch and upgrade its software to remain compatible with Firefox versions, but this does not solve the issues on Windows, IE, Safari etc. _This problem is hard to solve because it takes a significant effort to patch the service against all browser/OS combinations_.
      1 *Certificate request and renewal forms are confusing to the end user*. They constantly fill in wrong values or need help with filling it in. _The web forms are somewhat easier to fix. OSG has already provided web forms with already-filled-in values_. 
   2. *Lack of an OSG-owned and operated Registration service* Since OSG does not run its own RA service (DOEGrids provides the services), OSG does not have the means to make changes to the RA process and its underlying service. Also, tthe current RA platform only works for a single CA. 
   3. *Having a single CA provider for OSG users and services*. Although OSG recognizes and accepts all IGTF CA certs, OSG only works with DOEgrids to issue certificates to new users. The hardware and the software for the OSG RA service is provided by the DOEGrids CA, Therefore, OSG users get DOEGrids issued certificates. _It is difficult but not impossible to have OSG to work with other CAs. For example, during emergencies, OSG has made plans to use alternative CAs, but the process has to be performed manually and cumbersome (via Emails/fax), bypassing all the automated features provided in the RA service_. 
   4. *Redundant steps in certificate request and VO registration steps* A VO essentially does very similar work twice in these two separate workflows. Having a single workflow that can do both identity vetting and VO registration would benefit the user and the VO staff. _This problem can be fixed. But many sites and stakeholders take comfort in having two separate workflows. Getting this change accepted will be hard because many people have warm and fuzzy feelings from keeping the statu-quo_.   

---+++ List of High Level Requirements
   1. Having the user talk to his sponsor only once. Eliminate redundant steps from the registration workflow.    
   2. Shorter certificate approval times. 
   3. Flexible RA service that can work with multiple CAs and university IdPs
   4. Accounting accuracy. If OSG users start using multiple CA (e.g. CILogon, CERN CA, and DOEGrids CA), A user can have multiple certificates. We may need to account for all the jobs submitted by a single person under different certificates.  

---+++ Possible Solutions

   Below we provide a summary of the solutions. There are three categories: running an OSG-owned and operated RA service (OSG running the same RA service and OSG writing a new RA service and running it), using an RA service run by a third part (GlobusOnline and XSEDE), and not using any RAs at all (Having a singe workflow and External IDPs). 

| | Same RA service run by OSG | OSG's custom RA service | Globus Online | TeraGrid/XSEDE Registration portal | Have a single registration workflow| External IDPs|
|*Changes to Identity Vetting Workflow*| Remains the same. But OSG can do small changes to the configurations| Remains largely the same. OSG can make some improvements to the process to shorten the approval period | Remains the same. Depends on how Globus Online will implement the process. OSG can provide input | Slightly different | No separate workflow for identity vetting | Eliminate the identity vetting workflow completely|
|*Changes to VO Registration Workflow*| Remains the same |Remains the same| Remains the same | Remains the same | Some changes. Merges with some of the identity vetting steps| Remains the same| 
|*Usability (Problem 1.3 -- cert request/renewal forms and Problem--1.4 CA service problems with browser/OS* | Remains the same. Small improvements via better web page layout and patches for different browser/OS combos | OSG can change the web page design drastically and improve browser incompatibility problems (issues 1.1 and 1.2) | Do not know how usable is the interface. | Do not know how usable the interface | Usability improves as two separate workflows are eliminated. No more separate web forms to fill in to get a certificate | Improves the usability drastically as user has to do no work to get certificates. No forms to fill, etc | 
|*Identity Vetting Approval Period (Problem 1.2)*| Remains the same | May be shortened if process is slightly modified (becomes equivalent to XSEDE portal) |May be shortened if process is slightly modified  (becomes equivalent to XSEDE portal) | Slightly shorter than Globus Online and custom-OSG RA service. The portal has a shorter workflow for identity vetting. |Shorter| Shortest. Certificate ready in 5-minutes | 
|*OSG ownership (Problem 2: OSG owned RA service)*| Yes | Yes| No | No | Yes | No |
|*Use of Multiple CAs (Problem 3 Having a single CA Provider)*| It may be configured. Do not know how hard. | Yes | OSG can use multiple CAs but Globus Online will control which CAs are there.| OSG can use multiple CAs but they should be integrated into the portal by XSEDE| Yes| Yes. But CAs and IdPs has to do integration work |  
|*Eliminates redundant certificate and VO registration workflows (Problem 4)*| No| No | No | No| Yes | Yes |
|*Effort Needed*| Significant. 1 FTE for 3-6 months doing the setup. 0.5 FTE for ongoing | Very significant. 1.5 FTE for a year for development. 0.5 FTE for ongoing | Low. 0.25 FTE for 6 months to work with Globus Online to deliver requirements | Low. 0.25 FTE for 6 months to work with XSEDE to deliver requirements | Low. 0.25 FTE for 6 months to work with VO to implement the new process | No work on OSG but significant work on the external IdPs and CAs to set up and maintain| 




---++++ 1. Providing an OSG-owned and operated User Database/Registration Authority
   This solution requires OSG to run its own RA service instead of using the RA service provided by the DOEGrids. In other words, OSG provides the hardware and software to implement the RA process. Please note that this solution does not require OSG to provide CA services (such as issuing certificates). Under this scenario, OSG itself becomes an Identity Provider (IdP). This is a different solution than using external IdPs such as BNL IdP or Fermilab IdP, which is discussed below. When such external IdPs are used, there is no need for OSG to run a central RA service.  

Currently, as its RA service, OSG uses RedHat Certificate Service software provided and run by DOEgrids CA. 

There are various options in providing an OSG-owned and operated RA

   *%ORANGE% 1.1 OSG runs a standalone RA service%ENDCOLOR%*

Since OSG wants to run an independent RA service on our own and then integrate it with another CA such as CIlogon CA, my initial thinking was how we can integrate RedHat software with CILogon CA. (I use CILogon CA throughout this text as an example of a alternative CA other than DOEGrids.) I still do not have a good answer for that. This is licensed software and I do not have access the software unless we convince RHCS to provide us with a free trial period. However, I asked a few people like Jim Basney and ESnet folks about this idea and they said they did not think this software would be easy to integrate with CIlogon. For now, I take their word for this. I will get back to this later. There is also an open source version of this software at http://pki.fedoraproject.org/
   * *Pros*:
      * Provides independence from any CA provider. Depending on RedHat code and how easy it is to integrate it with CILogon or other CAs. 
   * *Cons*:
      * Does not improve any of the usability concerns. The same software and ui problems persists since we get it from RedHat. Approval takes the same amount of time. 
      * Jim and ESnet thought it may be hard to tailor this service to interface Shib-enabled CAs such as CIlogon CA. 

    
   *%ORANGE% 1.2 Write an RA portal software from scratch: OSG's custom RA service %ENDCOLOR%*

   If we were to write this software from scratch, below are the major design considerations we should work on:
   * It has to have multiple simple and reliable user interfaces for different roles: RA authority, Agents, gridadmins, sponsors, and end users. It has to implement the identity vetting workflow correctly. Each of the above roles plays a part in the workflow. (For example, RA authority assign a request to an Agent (representing a VO). Agent assigns it to a local sponsor to vet the identity; sponsor approves it. user finally gets a notification.)  It has to ensure each role interface hands off information correctly to the next role.
   * Moreover, interfaces for end user has to be very simple and reliable. We have to support our code against one or two browsers at all times (e.g. Firefox and IE). (We currently have problems with this RedHat software. With every new browser version, the service needs patching/upgrading)
   * Also, the resulting product has to have good error and request tracking. Right now it is hard to find out where a request in the workflow. We track manually. Ideally, A user or an agent should be able to easily see where a request has stuck in the system (i.e. who is handling the request and for how long).
   * In addition it has to implement the full identity lifecycle: initial vetting, renewing, and removal. Each of these stages will have a different workflow than the one I described above (initial identity vetting).
   * Moreover, it has to have good archival and storage. Every request, approval, communication between agents, RA, and sponsors must be captured for future audits and renewals. 
   * Finally, the most important part: the service has to be Shib-enabled. We should be able to send approved requests to CIlogon CA for processing. Originally I thought this would not be hard as the code from Shibboleth project is available and I set myself up an Shib Idp within a day. But then I realized service certificates would be a challenge. Since we put aside the service certificates for this initial conversation, I only list it below as a sidenote. 
   * Currently, shibboleth protocol is not meant to provide identity services for service certs.For service certificates, what OSG does today is that a person requests to become a GridAdmin and he is authorized for a FQDN. From then on GridAdmin can automatically request and approve service certs for his domain. For this to work, CILogon CA needs to differentiate between human and service certs. (should the CA give the person a cert for his own name or a requested service  domain name; how to know who owns which domain, etc. ) Currently CIlogon CA does not distinguish between them. So I found a solution that Jim thinks doable. CILogon CA should not know any difference between a service cert or a GridAdmin. From the CA perspective, any request is just the same. The OSG RA should authenticate and authorize a Gridadmin, determine the credential for the service and then send this to CIlogon CA. This means we enhance the protocol between the IdP and the CILogon CA. Again, this is a departure from standard IdP software, meaning we will code this.
   * Another side note with service certificates: we have a different workflow for service certificates. It is a simpler (RA --> GridAdmin) workflow, but it has to have different user interfaces and details.
   * *Pros*: 
      * Complete control over the software and design. We can custom-design it for OSG needs. Usability complaints may be eroded (This may also be a con-- see below)
      * Provides independence from any CA provider. 
   * *Cons*
      * Design/development/testing the software will take at least a year for 1 FTE. 
      * Training operators/RA/Agents/GridAdmins with the new software
      * Designing good UI is very hard. Not certain we may make a huge improvement in that. 
      * Maintaining the code against browser/OS combos, continuous maintenance. 

---++++ 2. Using an RA Service Provided by a Different Entity
   This is similar to our current situation in that DOEGrids run the RA service for OSG. We are looking for a different entity to rpovide this service. There are two options

   *%ORANGE% 2.1 Use Globus Online RA service%ENDCOLOR%* 

Globus Online service plans to include a full-fledge RA service. They need a similar workflow system for BIRN and other communities for identity vetting and user registration. I described the workflow we need to Rachana in detail; She thought it was within the scope of RA software she is currently building. Technically, we were in agreement on many points. I told her the problems from RedHat software such as error tracking, archival, etc, and she was receptive. This solution requires no changes to the VO registration workflow. 
   * *Pros*:
      * No software to write, no service to run. Globus Online will take care of that. 
      * Can be made to talk to different CA providers
      * Eliminates some of the usability problems. Users will get a Shib token as well and can use this instead of X.509 certificate when a service provider allows it. 
   * *Cons*
      * Does not eliminate some of the usability problems. We do not know how the end result will turn out. Users will still have to wait for approval.  
      * The CAs that we can interface with depends on the RA provider's approval and support. For example, if Globus Online decides not to interface CA XYZ, we cannot use it that CA easily. 

   *%ORANGE% 2.2 Use TeraGrid/XSEDE User Registration Portal%ENDCOLOR%*
   
We can use Teragrid user portal as OSG central user database/RA service. We have been saying we should eliminate duplication between TG and OSG and OSG is an XD service provider. Having talked to Von and Jim about the registration workflow in TG, I think the level of vetting and the workflow requirements are very similar (putting aside service certificates). So there is no technical reason so far to rule out this idea. This may even help us beyond providing a portal service once our users are in TG database; we can take advantage of all identity services TG provides. One disadvantage is we would be very tightly coupled with TG.
   * *Pros*
      * No software to write, no service to run. XD Portal will take care of it all.
      * Although user's still need to wait for identity vetting/approval, due to the differences in workflow design, this wait is much shorter. It averages less than an hour to vet someone's identity and register with TeraGrid portal given the approver is available.
           * Eliminates some of the usability problems. Users will get a Shib token as well and can use this instead of X.509 certificate when a service provider allows it. 
      * Can easily integrate with other identity services provided by XD such as myProxy CA, Kerberos directory, etc. 

   * *Cons*
      * The CAs that we can interface with depends on the RA provider's approval and support. For example, if TeraGrid/XD decides not to interface CA XYZ, we cannot use it that CA easily. 
      * Very tightly coupled to TeraGrid. OSG becomes a XD Sevice Provider. Later changing the RA service may be very hard. 

   
---++++ 3. Do NOT Run Any RA Service at all. 

   There are two main options under this 

   *%ORANGE% 3.1 Use VO Registration as Identity Vetting Step%ENDCOLOR%*  

   This solution aims to eliminate the redundancy between the identity vetting and VO registration workflows. The identity vetting and the VO registration happens at a single step when a user applies for VO membership. 

   The *real* identity vetting will happen when end user goes to their VOs for registration. In VO registration during step 3, the VO admin either authenticates the user against an external database without using any certificates, or VO admin asks the sponsor to approve the request. In the former case (used by CMS and Atlas), there is no need to make any changes to the VO registration workflow since the authentication already happens. User is authenticated with his CERN ID, birth date, and other info. In the latter case (small VOs), the only modification is that the sponsor will also do the identity vetting that he is supposed to do during the certificate request workflow. This vetting requires the sponsor to contact the end user to verify he is indeed owner of this certificate and end user is making the VO membership request. Then the sponsor determines whether or not this person should be granted membership. Once a decision is made over membership request, VO admin will put user's certificate into VOMS. Note that there is no extra work on VO because they do the identity vetting anyhow. In fact this is less work: because right now they once vet a person's identity for certificate and then they do it once more when the person applies for VO membership.
         
For LHC VOs this solution works out of the box, because CMS and Atlas has stringent requirements during VO registration. CMS VOMS for example is integrated with CERN database such that a VO applicant has to show his CERN ID number, must know the correct birth date in CERN database and so on. Only then the user is allowed to register his certificate into CMS VOMS server. 

   *Redundancy in VO and Identity Vetting Workflows*
     <img src="%ATTACHURLPATH%/Slide7.jpg" alt="Slide7.jpg" width='720' height='540' />    

   *Proposed Trust Relationship Diagram Using CIlogon CA*
     <img src="%ATTACHURLPATH%/Slide8_2.jpg" alt="Slide8_2.jpg" width='698' height='261' />    

   * *Pros*
      * Get rid of the approval waiting period. Eliminate most of the usability problems. 
      * Eliminate the burden on VOs. Currently they do vetting and registration twice. 
      * No need to run any RA service, or write software. IdP works directly with CA with no OSG involvement. 
      * Would start working tomorrow. Ready solution.
      * Not locked into a single CA. Works with any Shib-enabled CA. No barriers to changing CAs.
      * Can work for small VOs immediately which do not require IGTF accreditation.  
      * Each VO has complete control; nothing is centrally stored.
      * There is a registration workflow built into VOMRS/ VOMS-admin tools. No big changes needed to perform approval at VO registration step. 
   * *Cons*
      * There is no IGTF accreditation for these certificates. However, IGTF has a guideline in the works for VO registration practices. Given CMS and Atlas VOs already do identity vetting at VO registration step independent of the X.509 certificate, these certificate may be granted accreditation. Again it is a long-winded road. 
      * VO has to take care of archival and storage of identity vetting steps. Yes there is a registration workflow at VOMRS but it still needs to be tweaked to achieve this. 
  
   *%ORANGE% 3.2 Use FNAL and BNL IdPs and integrate them with CILogon%ENDCOLOR%*
   
   BNL is just setting up their own Shibboleth IdP (around last month); FNAL is getting ready for theirs. CERN already runs its own IdP. Between these three IdPs we already can cover 80% of OSG population. These IdP can be easily integrated into CIlogon CA to provide certificates. To overcome accreditation barrier, BNL and FNAL will have to obtain their Silver accreditation from InCommon or a special examination of these two IdPs will be requested from IGTF. Both options are feasible. 

   * *Pros*
      * Solves most of usability problems. No waiting/approval period. Instant certificates. 
      * BNL and FNAL already registers most of LHC community in their enterprise databases (be it a visitor, employee, or student)
      * Not locked into a single CA. Works with any Shib-enabled CA. No barriers to changing CAs.
      * No changes to VO software or registration workflow
      * Would work for 80% of OSG users 
      * No need to run any RA service, or write software. 
      * IdPs work directly with CA with no OSG involvement needed.  
 
   * *Cons*
      * BNL and FNAL will have to go through some sort of an accreditation. This is feasible given FNAL has gone through this before and both institutions are highly motivated to receive such accreditation. 
      * Does not cover non-LHC users. 

---++++Conclusion

Given the resources OSG has, my conclusion is to use a hybrid of solutions 3.1 and 3.2. 3.1 is suitable for non-LHC VOs. Whereas solution 3.2 would help LHC users. 
 




-- Main.MineAltunay - 08 Jun 2011


  





%META:FILEATTACHMENT{name="IDMgmtCurrent_2011_1.jpg" attachment="IDMgmtCurrent_2011_1.jpg" attr="" comment="" date="1310587312" path="Slide1.jpg" size="73610" stream="Slide1.jpg" tmpFilename="/usr/tmp/CGItemp42841" user="MineAltunay" version="2"}%
%META:FILEATTACHMENT{name="IDMgmt_Current_2001_2.jpg" attachment="IDMgmt_Current_2001_2.jpg" attr="" comment="IDMgmt_2011_2" date="1310587288" path="Slide2.jpg" size="79506" stream="Slide2.jpg" tmpFilename="/usr/tmp/CGItemp42713" user="MineAltunay" version="2"}%
%META:FILEATTACHMENT{name="Slide3.jpg" attachment="Slide3.jpg" attr="" comment="" date="1310671926" path="Slide3.jpg" size="108007" stream="Slide3.jpg" tmpFilename="/usr/tmp/CGItemp38695" user="MineAltunay" version="1"}%
%META:FILEATTACHMENT{name="Slide6.jpg" attachment="Slide6.jpg" attr="" comment="" date="1311640181" path="Slide6.jpg" size="93217" stream="Slide6.jpg" tmpFilename="/usr/tmp/CGItemp38962" user="MineAltunay" version="1"}%
%META:FILEATTACHMENT{name="Slide7.jpg" attachment="Slide7.jpg" attr="" comment="" date="1311640195" path="Slide7.jpg" size="70369" stream="Slide7.jpg" tmpFilename="/usr/tmp/CGItemp38920" user="MineAltunay" version="1"}%
%META:FILEATTACHMENT{name="Slide4_2.jpg" attachment="Slide4_2.jpg" attr="" comment="" date="1311640486" path="Slide4_2.jpg" size="36181" stream="Slide4_2.jpg" tmpFilename="/usr/tmp/CGItemp38936" user="MineAltunay" version="1"}%
%META:FILEATTACHMENT{name="Slide5_2.jpg" attachment="Slide5_2.jpg" attr="" comment="" date="1311640607" path="Slide5_2.jpg" size="30536" stream="Slide5_2.jpg" tmpFilename="/usr/tmp/CGItemp39042" user="MineAltunay" version="1"}%
%META:FILEATTACHMENT{name="Slide8_2.jpg" attachment="Slide8_2.jpg" attr="" comment="" date="1311641252" path="Slide8_2.jpg" size="52356" stream="Slide8_2.jpg" tmpFilename="/usr/tmp/CGItemp39032" user="MineAltunay" version="1"}%
