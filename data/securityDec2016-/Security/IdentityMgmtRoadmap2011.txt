%META:TOPICINFO{author="MineAltunay" date="1310594288" format="1.1" version="1.4"}%
---++ Identity Management Roadmap for OSG
%TOC%

---+++ How Identity Management Works in OSG 

---++++How to Get a New Certificate

   There are two important concepts to understand. First, OSG Registration Authority (RA) consists of a service and a collection of agents and sponsors. RA Agents and sponsors are pulled from the OSG VOs. Agents and sponsors together vets a user's identity. Each VO in OSG identifies a person as an RA Agent and then identifies a set of sponsors. The RA service that implements the RA process is operated by the DOEGrids CA. In other words, the software and hardware is owned and operated by the DOEGrids CA. Whereas, the work is done by OSG RA Agents and sponsors. OSG do not have an RA service independent of the one provided by DOEGrids CA.    

    <img src="%ATTACHURLPATH%/IDMgmtCurrent_2011_1.jpg" alt="IDMgmtCurrent_2011_1.jpg" width='574' height='500' />    
 
---++++How to Register with a Virtual Organization
 
   Similar to the identity vetting step, a user's registration with his/her VO is performed by the VO admins. VO admin is a different person than a RA Agent. Depending on the VO, admins may consult the user's sponsor (same person from the identity vetting) or consults an external user database in order to understand whether the user have rights to be a member of the VO. For LHC VOs, CERN HR maintains external membership databases. When a user wants to register with CMS or Atlas, the user proves that he knows his CERN ID number, the birth date and some other information recorded in CERN db to prove his identity and his ties with the experiment. If the user does not show up in the CERN db, then his registry is refused. The user initially signs up with the CERN database when he first joins the experiment. After this, the user sends his certificate DN to register in the VO database. Thus, user's certificate is not necessarily used as an authentication vehicle during the VO registry. 

   For VOs without external databases, a VO admin should consult a sponsor in the VO (the same person as )

     <img src="%ATTACHURLPATH%/IDMgmt_Current_2001_2.jpg" alt="IDMgmt_Current_2001_2.jpg" width='571' height='505' />    

---+++ Problems with Identity Management
   Here we are focusing more on the certificate request and retrieval steps. However, VO registration is also part of the identity management lifecycle. We merely focus more on certificates because users have more difficulties in this area. 

   1. Usability: 
      1 User experience with CA web pages. Certificate request and renewal forms are confusing to the end user. They constantly fill in wrong values or need help with filling it in. 
      1 The software used by the CA server has problems with some browser/OS combos. Users frequently have trouble with request and renewal actions due to incompatibility between user browser and the CA server. CA server tries to patch and upgrade its software to remain compatible with Firefox versions, but this does not solve the issues on Windows, IE, Safari etc.
      1 Usability of X.509 certificates. Users have trouble with managing and using their X.509 certificates. Exporting/importing certificates into/from browsers; having them work with grid tools; etc. This problem is not particular for any CA.  
      1 Approval period. Certificate approval takes 3-5 days. The approval is dependent on the confirmation by a user's sponsor (i.e professor, PI, etc). The sponsor can approve a request as soon as he gets it, but in reality most sponsors take couple days to do this. Users, on the other hand, want "5-minute certificates", credentials that can be issued in 5 minutes. 
   2. Having a single CA provider for OSG users and services. Although OSG recognizes and accepts all IGTF CA certs, OSG only works with DOEgrids to issue certificates to new users. The identity vetting performed by OSG Registration Authority (RA) is tightly coupled with DOEGrids CA. The hardware and the software for the OSG RA service is provided by the DOEGrids CA. It is difficult but not impossible to have OSG to work with other CAs. For example, during emergencies, OSG has made plans to use alternative CAs, but the process has to be performed manually and cumbersome (via Emails/fax), bypassing all the automated features provided in the RA service. 
   3. Lack of an OSG-owned and operated Registration service that can be tied into multiple CAs and modify quickly based on OSG stakeholder needs. Since OSG does not run its own RA service, OSG does not have the means to make changes to the RA process and its underlying service. 
   4. Having redundant steps in certificate request and VO registration steps. A VO essentially does very similar work twice in these two separate workflow. Having a single workflow that can do both identity vetting and VO registration would benefit the user and the VO staff.  

---+++ List of High Level Requirements
   1. Improved user interface for certificate life-cycle management. We aim to eliminate the problems listed under Usability above.  
   2. Shorter approval times. Flexible Registration service that can be plugged into a university user database and talk to multiple CA operators for issuing certificates. Needs to be able to interface with Shibboleth IdP and SPs
   3. Separate user certificates from service certificates in solutions initially

---+++ Possible Solutions

---++++ 1. Providing an OSG-owned and operated User Database/Registration Authority.  
This solution requires OSG to run its own RA service instead of using the RA service provided by the DOEGrids. In other words, OSG provides the hardware and software to implement the RA process. Please note that this solution does not require OSG to provide CA services (such as issuing certificates). Under this scenario, OSG itself becomes an Identity Provider (IdP). This is a different solution than using external IdPs such as BNL IdP or Fermilab IdP, which is discussed below. When such external IdPs are used, there is no need for OSG to run a central RA service.  

Currently, as its RA service, OSG uses RedHat Certificate Service software provided and run by DOEgrids CA. 

There are various options in providing an OSG-owned and operated RA

   *%ORANGE% 1.1 Run the RedHat Certificate Service as a standalone service%ENDCOLOR%*

Since OSG wants to run an independent RA service on our own and then integrate it with another CA such as CIlogon CA, my initial thinking was that can we integrate RedHat software with CILogon CA. (I use CILogon CA throughout this text as an example of a alternative CA other than DOEGrids.) I still do not have a good answer for that. This is licensed software and I do not have access the software unless we convince RHCS to provide us with a free trial period. However, I asked a few people like Jim Basney and ESnet folks about this idea and they said they did not think this software would be easy to integrate with CIlogon. For now, I take their word for this. I will get back to this later. There is also an open source version of this software at http://pki.fedoraproject.org/
   * *Pros*:
      * Provides independence from any CA provider. Depending on RedHat code and how easy it is to integrate it with CILogon or other CAs. 
   * *Cons*:
      * Does not improve any of the usability concerns. The same software and ui problems persists since we get it from RedHat. Approval takes the same amount of time. 
      * Jim and ESnet thought it may be hard to tailor this service to interface Shib-enabled CAs such as CIlogon CA. 

    
   *%ORANGE% 1.2 Write an RA portal software from scratch%ENDCOLOR%*

   If we were to write this software from scratch, below are the major design considerations we should work on:
   * It has to have multiple simple and reliable user interfaces for different roles: RA authority, Agents, gridadmins, sponsors, and end users. It has to implement the identity vetting workflow correctly. Each of the above roles plays a part in the workflow. (For example, RA authority assign a request to an Agent (representing a VO). Agent assigns it to a local sponsor to vet the identity; sponsor approves it. user finally gets a notification.)  It has to ensure each role interface hands off information correctly to the next role.
   * Moreover, interfaces for end user has to be very simple and reliable. We have to support our code against one or two browsers at all times (e.g. Firefox and IE). (We currently have problems with this RedHat software. With every new browser version, the service needs patching/upgrading)
   * Also, the resulting product has to have good error and request tracking. Right now it is hard to find out where a request in the workflow. We track manually. Ideally, A user or an agent should be able to easily see where a request has stuck in the system (i.e. who is handling the request and for how long).
   * In addition it has to implement the full identity lifecycle: initial vetting, renewing, and removal. Each of these stages will have a different workflow than the one I described above (initial identity vetting).
   * Moreover, it has to have good archival and storage. Every request, approval, communication between agents, RA, and sponsors must be captured for future audits and renewals. 
   * Finally, the most important part: the service has to be Shib-enabled. We should be able to send approved requests to CIlogon CA for processing. Originally I thought this would not be hard as the code from Shibboleth project is available and I set myself up an Shib Idp within a day. But then I realized service certificates would be a challenge. Since we put aside the service certificates for this initial conversation, I only list it below as a sidenote. 
   * Currently, shibboleth protocol is not meant to provide identity services for service certs.For service certificates, what OSG does today is that a person requests to become a GridAdmin and he is authorized for a FQDN. From then on GridAdmin can automatically request and approve service certs for his domain. For this to work, CILogon CA needs to differentiate between human and service certs. (should the CA give the person a cert for his own name or a requested service  domain name; how to know who owns which domain, etc. ) Currently CIlogon CA does not distinguish between them. So I found a solution that Jim thinks doable. CILogon CA should not know any difference between a service cert or a GridAdmin. From the CA perspective, any request is just the same. The OSG RA should authenticate and authorize a Gridadmin, determine the credential for the service and then send this to CIlogon CA. This means we enhance the protocol between the IdP and the CILogon CA. Again, this is a departure from standard IdP software, meaning we will code this.
   * Another side note with service certificates: we have a different workflow for service certificates. It is a simpler (RA --> GridAdmin) workflow, but it has to have different user interfaces and details.
   * *Pros*: 
      * Complete control over the software and design. We can custom-design it for OSG needs. Usability complaints may be eroded (This may also be a con-- see below)
      * Provides independence from any CA provider. 
   * *Cons*
      * Design/development/testing the software will take at least a year for 1 FTE. 
      * Training operators/RA/Agents/GridAdmins with the new software
      * Designing good ui is very hard. Not certain we may make a huge improvement in that. 
      * Maintaining the code against browser/OS combos, continuous maintenance. 

---++++ 2. Using an RA Service Provided by a Different Entity
   This is similar to our current situation in that DOEGrids run the RA service for OSG. We are looking for a different entity to rpovide this service. There are two options

   *%ORANGE% 2.1 Use Globus Online RA service%ENDCOLOR%* 

Globus Online service plans to include a full-fledge RA service. They need a similar workflow system for BIRN and other communities for identity vetting and user registration. I described the workflow we need to Rachana in detail; She thought it was within the scope of RA software she is currently building. Technically, we were in agreement on many points. I told her the problems from RedHat software such as error tracking, archival, etc, and she was receptive.
   **Pros*:
      * No software to write, no service to run. Globus Online will take care of that. 
      * Can be made to talk to different CA providers
      * Eliminates some of the usability problems. Users will get a Shib token as well and can use this instead of X.509 certificate when a service provider allows it. 
   **Cons*
      * Does not eliminate some of the usability problems. Users will still have to wait for approval. Other UI concerns depends on the software design. 
      * The CAs that we can interface with depends on the RA provider's approval and support. For example, if Globus Online decides not to interface CA XYZ, we cannot use it that CA easily. 

   *%ORANGE% 2.2 Use TeraGrid/XSEDE User Registration Portal%ENDCOLOR%*
   
We can use Teragrid user portal as OSG central user database/RA service? We have been saying we should eliminate duplication between TG and OSG and OSG is a XD service provider. Having talked to Von and Jim about the registration workflow in TG, I think the level of vetting and the workflow requirements are very similar (putting aside service certificates). So there is no technical reason so far to rule out this idea. This may even help us beyond providing a portal service once our uses in TG database, we can take advantage of all identity services TG provides. One disadvantage is we would be very tightly coupled with TG.
   * *Pros*
      * No software to write, no service to run. XD Portal will take care of it all.
      * Although user's still need to wait for identity vetting/approval, due to the differences in workflow design, this wait is much shorter. It averages on 5-minutes to vet someone's identity and register with TeraGrid portal given the approver is available.
           * Eliminates some of the usability problems. Users will get a Shib token as well and can use this instead of X.509 certificate when a service provider allows it. 
      * Can easily integrate with other identity services provided by XD such as myProxy CA, Kerberos directory, etc. 

   * *Cons*
      * The CAs that we can interface with depends on the RA provider's approval and support. For example, if TeraGrid/XD decides not to interface CA XYZ, we cannot use it that CA easily. 
      * Very tightly coupled to TeraGrid. OSG becomes a XD Sevice Provider. Later changing the RA service may be very hard. 

   
---++++ 3. Do NOT Run Any RA Service at all. 

   There are two main options under this 

   *%ORANGE% 3.1Use VO Registration as Identity Vetting Step%ENDCOLOR%*  

We will accept any university IdP and let them hook into CILogon CA. The vetting on these university credentials are worthless (no accreditation- whatsoever), or unknown at best. We cannot possibly know how a university manages their user database unless the university is accredited at InCommon Bronze or Silver levels, which nobody has such accreditation yet. Even users with no university IdPs can still get certificates. For example, ProtectNetwork IdP is a catch-all IdP that regsiters anyone with an email account. The identity vetting will happen when end user goes to their VOs for registration. A VO member (Agent and the sponsor) will do the identity vetting just as normal. If the person admitted to membership, Vo admin will put his/her certificate into VOMS. This is no extra work on VO because they do the identity vetting anyhow. In fact this is less work: because right now they once vet a person's identity for certificate and then they do it once more when the person applies for VO membership.
         
For LHC VOs this solution works out of the box, because CMS and Atlas has stringent requirements during VO registration. CMS VOMS for example is integrated with CERN database such that a VO applicant has to show his CERN ID number, must know the correct birth date in CERN database and so on. Only then the user is allowed to register his certificate into CMS VOMS server. 

   * *Pros*
      * Get rid of the approval waiting period. Eliminate most of the usability problems. 
      * Eliminate the burden on VOs. Currently they do vetting and registration twice. 
      * No need to run any RA service, or write software. IdP works directly with CA with no OSG involvement. 
      * Would start working tomorrow. Ready solution.
      * Not locked into a single CA. Works with any Shib-enabled CA. No barriers to changing CAs.
      * Can work for small VOs immediately which do not require IGTF accreditation.  
      * Each VO has complete control; nothing is centrally stored.
      * There is a registration workflow built into VOMRS/ VOMS-admin tools. No big changes needed to perform approval at VO registration step. 
   * *Cons*
      * There is no IGTF accreditation for these certificates. However, IGTF has a guideline in the works for VO registration practices. Given CMS and Atlas VOs already do identity vetting at VO registration step independent of the X.509 certificate, these certificate may be granted accreditation. Again it is a long-winded road. 
       * VO has to take care of archival and storage of identity vetting steps. Yes there is a registration workflow at VOMRS but it should be a tweaked to achieve this. 
  
   *%ORANGE% 3.2 Use FNAL and BNL IdPs and integrate them with CILogon%ENDCOLOR%*
   
   BNL is just setting up their own Shibboleth IdP (around last month); FNAL is getting ready for theirs. CERN already runs its own IdP. Between these three IdPs we already can cover 80% of OSG population. These IdP can be easily integrated into CIlogon CA to provide certificates. To overcome accreditation barrier, BNL and FNAL will have to obtain their Silver accreditation from InCommon or a special examination of these two IdPs will be requested from IGTF. Both options are feasible. 

   * *Pros*
      * Solves most of usability problems. No waiting/approval period. Instant certificates. 
      * BNL and FNAL already registers most of LHC community in their enterprise databases (be it a visitor, employee, or student)
      * Not locked into a single CA. Works with any Shib-enabled CA. No barriers to changing CAs.
      * No changes to VO software or registration workflow
      * Would work for 80% of OSG users 
      * No need to run any RA service, or write software. 
      * IdPs work directly with CA with no OSG involvement needed.  
 
   * *Cons*
      * BNL and FNAL will have to go through some sort of an accreditation. This is feasible given FNAL has gone through this before and both institutions are highly motivated to receive such accreditation. 
      * Does not cover non-LHC users. 

---++++Conclusion

Given the resources OSG has, my conclusion is to use a hybrid of solutions 3.1 and 3.2. 3.1 is suitabel for non-LHC VOs. Whereas solution 3.2 would help LHC users. 
 




-- Main.MineAltunay - 08 Jun 2011


%META:FILEATTACHMENT{name="IDMgmtCurrent_2011_1.jpg" attachment="IDMgmtCurrent_2011_1.jpg" attr="" comment="" date="1310587312" path="Slide1.jpg" size="73610" stream="Slide1.jpg" tmpFilename="/usr/tmp/CGItemp42841" user="MineAltunay" version="2"}%
%META:FILEATTACHMENT{name="IDMgmt_Current_2001_2.jpg" attachment="IDMgmt_Current_2001_2.jpg" attr="" comment="IDMgmt_2011_2" date="1310587288" path="Slide2.jpg" size="79506" stream="Slide2.jpg" tmpFilename="/usr/tmp/CGItemp42713" user="MineAltunay" version="2"}%
