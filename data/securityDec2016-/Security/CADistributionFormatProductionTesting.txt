%META:TOPICINFO{author="AnandPadmanabhan" date="1300380819" format="1.1" reprev="1.1" version="1.1"}%
%TOC%
---++Testing of new CA distribution format on Production

The proposed change in the CA package due to the new layout from IGTF to accommodate openssl 1.0 is slated to go into production on OSG with the next IGTF release. The changes have already been identified in [[https://twiki.grid.iu.edu/bin/view/SoftwareTeam/SEP7][SEP7]] and implemented. However since this change affects our security infrastructure significantly the security team will like to have the changes tested on few older versions of Production sites before we roll out a production deployment. For this purposes the chosen test sites will be asked to temporarily install the CA package from the ITB CA cache. Below you will find instructions for how to accomplish this change, how to rollback in case of errors or after the testing is complete and a short survey of the testing.

---+++ Steps to install cache from ITB
---++++Pointing to the ITB Cache
<pre class="rootscreen">
%UCL_PROMPT_ROOT% source $VDT_LOCATION/setup.sh
%UCL_PROMPT_ROOT% vdt-ca-manage setupca --location %RED%local%ENDCOLOR%  --url itb
  Setting up CA Certificates for VDT installation at '/opt/osg-1.2.18'
  CA Certificates will be installed into /opt/osg-1.2.18/globus/share/certificates

  Setup completed successfully.
</pre>
*NOTE*: Please use appropriate parameter for --location for your installation. Available options: --location <local|root|PATH>
---++++ Fetch CAs and CRLs
<pre class="rootscreen">
%UCL_PROMPT_ROOT% vdt-ca-manage refreshCA
  Fetching CAs....
  vdt-update-certs
  Log file: /opt/osg-1.2.18/logs/vdt-update-certs.log
  Updates from: http://software-itb.grid.iu.edu/pacman/cadist/ca-certs-version

  Nothing to update: your CA certificate installation is already up-to-date.

%UCL_PROMPT_ROOT%vdt-ca-manage fetchCRL
  Fetching CRLs....

  ...done
</pre>

---++++ Checking if the location has been updated using
<pre class="rootscreen">
%UCL_PROMPT_ROOT% vdt-ca-manage showcaurl
  http://software-itb.grid.iu.edu/pacman/cadist/ca-certs-version
%UCL_PROMPT_ROOT% vdt-version  | grep CA
  CA Certificates 1.17ITB (includes IGTF 1.38 CAs)
%UCL_PROMPT_ROOT% ls -la $VDT_LOCATION/globus/share/certificates/*.pem | wc
     91     819    9365
%UCL_PROMPT_ROOT% ls -la $VDT_LOCATION/globus/share/certificates/*.r0 | wc
     91     819    9373
</pre>

---++++Verify the operations of compute element 
   1. Use the script $VDT_LOCATION/verify/site_verify to see if any problems are being reported and if they are related to the new CA certificates
   2. Execute [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/CESimpleTest][simple CE tests]]
   3. If no problem was noticed leave the new CA package up for atleast 24 hours and report any failures due to CA certificates
   4. Observe RSV probe output and report any failures of RSV probes due to CA certificates.

---+++ WN Client installation
Options for CA installations on worker nodes can be installed [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/WorkerNodeClient#CA_Certificates_Installation_on][here]]. 
Use the same basic procedure above to update the CA packages at appropriate worker nodes based on your installation. 

---++++ client Testing 

   1. CE 
      * gatekeeper
      * gsiftp
      * RSV probes
      * vdt-update-certs
      * vdt-ca-manage
      * fetch-crl





-- Main.AnandPadmanabhan - 17 Mar 2011
