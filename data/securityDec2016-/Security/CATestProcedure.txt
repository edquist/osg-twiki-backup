%META:TOPICINFO{author="NehaSharma" date="1429804322" format="1.1" reprev="1.55" version="1.55"}%
%META:TOPICPARENT{name="SecurityTeamWorkingArea"}%
<!--
   * Set ALLOWTOPICVIEW = Main.GridGroup    
   * Set DENYTOPICVIEW = Main.TwikiGuest
-->
%TOC%
---+ OSG CA Testing Plan

---++ Purpose
The OSG CA was designed with a modular architecture, so new back-end signing CAs can be used to do the actual certificate signing. This is the procedure to verify a new signing CA is working correctly.

---++ Must remember

1. Remind CMS and ATLAS to test workflows (post IGTF accreditation in October 2015)
2. Before we configure production OIM to use CILogon HSM on the backend, we must notify all who may want to renew their existing Digicert certificates

---++ Testing Phases

| *Phase* | *Owner* | *Co-ordinator* | *Duration* |  *Status* |
| All CA functions work correctly with the new signing CA | OSG Operations/OSG Security Team/Neha | | _4/1/15 - 4/30/15_ | %ORANGE%IN PROGRESS%ENDCOLOR% | 
| Testing on ITB servers to uncover any issues with the new certs and existing OSG software | ITB Site Admins | Neha/OSG Security | _5/1/15 - 6/30/15_ | %ORANGE%IN PROGRESS%ORANGE% |
| VOs to test custom software/workflows with new certificates | VO Managers | Neha/OSG Security | _5/1/15 - 6/30/15_ | %ORANGE%CMS/ATLAS CAN NOT START UNTIL OCT 2015%ENDCOLOR% |
| OSG Services testing with new certificates | Admins hosting services for OSG | Neha/OSG Security | _5/1/15 - 6/30/15_ | %RED%NOT STARTED%ENDCOLOR% |

---++ CA Functionality Tests

| *Scenerio* | *Use Case* | *Status* | *Notes* |
| Getting Personal Cert | Request, approve and import new certificate into browsers | %GREEN%PASS%ENDCOLOR% | https://ticket-itb.grid.iu.edu/goc/5185, accessed fermilab cloudvoms web interface |
| | New DN should appear in expected format | %GREEN%PASS%ENDCOLOR% | Example: /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Neha Sharma 225 |
| | Numeric prefix should be the same as in the old certificate | %GREEN%PASS%ENDCOLOR%  | 225 |
| Renewing Personal Cert | Renew digicert personal cert | %GREEN%PASS%ENDCOLOR% | Renewing existing Digicert issued personal cert successfully produced a new CILogon signed personal cert. |
| Renewing Personal Cert | Renew new certs | %GREEN%PASS%ENDCOLOR% | Successfully renewed cilogon signed cert after Soichi modified the expiration date in OIM-ITB. |
| | Test whether users with existing !DigiCert certs can get new certificates without going through identity vetting | %GREEN%PASS%ENDCOLOR% | |
| | Test whether users who do not have existing !DigiCert certs go through identity vetting | %GREEN%PASS%ENDCOLOR% | successfully got account without an existing cert. Went through expected approval process.  https://ticket-itb.grid.iu.edu/goc/5199 |
| Revoking User Cert| Revoke certificate via OIM interface| %GREEN%PASS%ENDCOLOR% | Unexpected DN showing up- https://oim-itb.grid.iu.edu/oim/certificateuser?id=2455. Pinged GOC.  -- Successfully revoked certificate 100000271 |
| |Verify certificate's serial number appears in published CRL within expected time limit (? hours) |%GREEN%PASS%ENDCOLOR% | revoked at 2:01pm. In CRL at 2:07pm. |
| Getting Host Cert|Get host cert via command line tools | %GREEN%PASS%ENDCOLOR% | osg-cert-request -T -t cloudvoms1.fnal.gov -e neha@fnal.gov -n "Neha Sharma" -p 6308406791 -m "testing command line tool" -v fermilab |
| | Verify DN matches old certificate with new prefix | %GREEN%PASS%ENDCOLOR% | /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=cloudvoms1.fnal.gov |
| | Get host cert via OIM web interface | %GREEN%PASS%ENDCOLOR%  | https://oim-itb.grid.iu.edu/oim/certificatehost?id=5276 Didn't get email about cert requested |
| | Verify DN matches old certificate with new prefix | %GREEN%PASS%ENDCOLOR% | /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=cloudvoms2.fnal.gov |
| Revoking Host Cert | Revoke host cert via OIM web interface | %GREEN%PASS%ENDCOLOR% | successfully revoked certificate serial #10000027b |
| | Verify certificate's serial number appears in published CRL within expected time limit (? hours) | %GREEN%PASS%ENDCOLOR% | Revoked at 2:14pm. In CRL at 2:26pm. |
| Getting Service Cert|Get service cert via command line tools | %GREEN%PASS%ENDCOLOR% | osg-gridadmin-cert-request -T -v mis -H 'http/pepperjack.fnal.gov' |
| | Verify DN matches old certificate with new prefix | %GREEN%PASS%ENDCOLOR% | CN=http/pepperjack.fnal.gov in both cases. |
| | Get service cert via OIM web interface | %GREEN%PASS%ENDCOLOR% | https://oim-itb.grid.iu.edu/oim/certificatehost?id=5312 Didn't get email about cert requested |
| | Verify DN matches old certificate with new prefix | %GREEN%PASS%ENDCOLOR% | CN=http/pepperjack.fnal.gov in both cases. |
| Revoking Service Cert | Revoke service cert via OIM web interface | %GREEN%PASS%ENDCOLOR% | Kevin Hill has revoked a certificate with serial ID:100000254 at 1:17pm 4/7. |
| | Verify certificate's serial number appears in published CRL within expected time limit (? hours) | %GREEN%PASS%ENDCOLOR% | Correct serial number in crl published at 2:22pm 4/7. |

---+++ Note
   * (1) Host and service cert request as a guest would result in notification email. But as a grid admin, won't ( osg-gridadmin-cert-request )

---++ ITB Tests

---+++ Testers

Instructions for ITB Testers

   * Install [[https://twiki.grid.iu.edu/twiki/pub/Security/CATestProcedure/cilogon-osg.tar.gz][CA certs]] for the new signing CA ( temporary location to expedite testing )
   * Request [[https://oim-itb.grid.iu.edu/oim/certificaterequestuser][User]] and [[https://oim-itb.grid.iu.edu/oim/certificaterequesthost][Host/Service]] certificates
   * Deploy the new host/service certs on server nodes and restart services
   * Generate VOMS credentials using new user cert
   * Run Service tests as mentioned below

We have commitment from following ITB testers 

|*Admin*|*Availability*|*Services to be tested*|*VO under which certs requested*|*Comment*|
|Suchandra Thapa|Now| GWMS Frontend, HTCondor-CE, GRAM CE, Bestman, Dcache, GWMS Factory(?), GUMS, Condor | OSG | |
|Xin Zhao|Now| HTCondor-CE, GRAM CE, !FetchCrl, gridFTP, RSV, OSG info services, Gratia, osg-configure, glexec, HTCondor| ATLAS | |
|Horst Severini|Now| !FetchCrl, edg-mkgridmap, osg-configure, GRAM CE, gridFTP, RSV, !BeStMan, OSG Info Services, Gratia, HTCondor, HTCondor CE | DOSAR | |
|Garhan Attebury|Now|Bestman, CVMFS, Fetch CRL, Frontier Squid, Gratia, !GratiaWeb, !GridFTP, GSI-OpenSSH, GUMS, HDFS (gridftp-hdfs/xrootd-hdfs?), HTCondor CE, OSG PKI Tools, RSV, Worker Node, xrootd| | | 
|Brian Lin| End of April | !FetchCrl, HTCondor CE, GRAM CE, gridFTP, uberFTP, lcmaps, Xrootd, RSV, CVMFS, VOMS, !MyProxy, Bestman, OSG Info Services, Gratia, osg-configure, glexec, edg-mkgridmap, lcgutil, gfal2util, HTCondor, PBS| |OSG Software Nightly Builds| 
|Neha Sharma| Now | GUMS, VOMS, VOMS Admin, vo-client, CA certificates | |
 
---+++ Use cases
Initial software list taken from _SoftwareTeam.ComponentHome_

%BROWN%*Testers to be found%ENDCOLOR%

| *Service* | *Use Case* | *Comment* |
| !BeStMan  | Authenticate and transfer files with proxies derived from new CA signed certs |  |
| CA certificates | Proper packaging | |
| %BROWN%cctools%ENDCOLOR%  | |
| %BROWN%CEMon%ENDCOLOR%  | | Probably going away | 
| CVMFS  | | |
| Fetch CRL  | CRLs getting updated | | 
| Frontier Squid  | | |
| %BROWN%Generic Information Provider (GIP)%ENDCOLOR%  |  | Probably going away | 
| !GlideinWMS VO Frontend  | | |
| %BROWN%GlideTester%ENDCOLOR% | | |
| Globus GRAM; gatekeeper, jobmanagers  | Test job submitted with VOMS proxy derived from new CA cert should run correctly  | |
| Gratia  | | |
| !GratiaWeb | | |
| !GridFTP| Authenticate and transfer files with proxies derived from new CA signed certs | |
| !GSI-OpenSSH | | |
| GUMS | Run jobs with new cert when mapped via gums | |
| Hadoop Distributed File System (HDFS)  | | |
| !HTCondor CE and BLAHP  | | |
| %BROWN%InstalledCapacityReport%ENDCOLOR%  | | |
| OSG Configure  | | |
| %BROWN%OSG Display%ENDCOLOR%  | | |
| OSG Info Services  | | |
| OSG PKI Tools  | | |
| RSV  | | |
| VOMS | Add new CA signed personal cert to existing VOMS account and be successfully approved,voms-proxy-init with new cert | |
| VOMS Admin | New user registration with new cert | |
| VO Package aka vo-client  | | |
| Worker Node | | |
| !XRootD  | | |

---+++ Test Results
| *Tester* | *Service* | *Status* | *Notes* |
| Horst Severini | !BeStMan | %GREEN%PASS%ENDCOLOR% |  | 
|  | CA certificates | %GREEN%PASS%ENDCOLOR% |  | 
|  | Fetch CRL | %GREEN%PASS%ENDCOLOR% |  | 
|  | Globus GRAM; gatekeeper, jobmanagers | %GREEN%PASS%ENDCOLOR% |  | 
|  | Gratia | %GREEN%PASS%ENDCOLOR% |  | 
|  | !GridFTP | %GREEN%PASS%ENDCOLOR% |  | 
|  | OSG Info Services | %GREEN%PASS%ENDCOLOR% |  | 
|  | RSV | %GREEN%PASS%ENDCOLOR% |  | 
|  | edg-mkgridmap | %GREEN%PASS%ENDCOLOR% |  | 
|  | osg-configure | %GREEN%PASS%ENDCOLOR% |  | 
|  | HTCondor-CE | %GREEN%PASS%ENDCOLOR% | See Test details (1) |
| Garhan Attebury | !BeStMan | %GREEN%PASS%ENDCOLOR% |  | 
|  | CA certificates | %GREEN%PASS%ENDCOLOR% |  | 
|  | Fetch CRL | %GREEN%PASS%ENDCOLOR% |  | 
|  | GUMS | %GREEN%PASS%ENDCOLOR% |  | 
|  | GSI-OpenSSH | %GREEN%PASS%ENDCOLOR% |  | 
|  | VOMS | %GREEN%PASS%ENDCOLOR% |  | 
|  | xrootd | %GREEN%PASS%ENDCOLOR% | v4.1.1-1.osg32.el6 server/client |
|  |  |  |  |

---+++ Test Details

   * (1) I had to add the following two lines to */etc/condor-ce/condor_mapfile*:
GSI "^\/DC\=org\/DC\=opensciencegrid\/O=Open Science Grid\/OU\=Services\/CN\=(host\/)?([A-Za-z0-9.\-]*)$" \2@daemon.opensciencegrid.org
GSI "^\/DC\=\opensciencegrid/DC\=org\/O=Open Science Grid\/OU\=Services\/CN\=(host\/)?([A-Za-z0-9.\-]*)$" \2@daemon.opensciencegrid.org

---+++ Known Issues
Url for JIRA tickets that will be created for items that require fixing should be included here.
   * (1) 
   * (2) 

---++ VO-specific Software Test
VO manager should test all VO specific software that handles certificates.

Note: CILogon OSG CA certs won't be installed on CERN nodes until it's IGTF accreditation ( Oct 15' 2015). So CMS and ATLAS workflow testing cannot begin until then.

---+++Instructions for Testers
   * To be updated in Oct 2015

---+++VO Testing Table
| *VO* | *Software* | *Components Involved* | *Tester* | *Status* | *Notes* |
| CMS | CRAB | CRAB, !GlideMon, !CMSWeb ( DBS, !PhedEx, !SiteDB), VOMS | Eric V. |%BROWN%Not started%ENDCOLOR% | Test that new user certs can be used to submit jobs via CMSWeb. All services involved run at CERN, so no need to do any major testing |
|  | WMAgent | WMAgent, CMSWeb, !SiteDB, Condor CM, VOMS | Seangchen, Krista, Dirk ( Tier 0)  |%BROWN%Not started%ENDCOLOR% | Install new CA and host/service cert on Test WMAgent, update condor_mapfile. Test that jobs can be submitted using new-user-cert/new wmagent-cert via CMSWeb, script and whatever tier 0 uses |
| ATLAS | PANDA | PANDA, GUMS | John H. | %BROWN%Not started%ENDCOLOR% |  |
| Fermilab | Jobsub | Jobsub, GUMS | Dennis | %BROWN%Not started%ENDCOLOR% |  |

---+++ Test Details

   * (1) 
   * (2)

---+++ Known Issues

   * (1) 
   * (2) 

---++ OSG Services Test
Sites hosting OSG Services should test service with new certificates

Instructions for Testers
   * Install [[https://twiki.grid.iu.edu/twiki/pub/Security/CATestProcedure/cilogon-osg.tar.gz][CA certs]] for the new signing CA ( temporary location to expedite testing )
   * Request [[https://oim-itb.grid.iu.edu/oim/certificaterequestuser][User]] and [[https://oim-itb.grid.iu.edu/oim/certificaterequesthost][Host/Service]] certificates

| *Service* | *Certificates involved*| *Host Site* | *Tester* | *Status* | *Notes* |
| Gratia Collector | Yes | Fermilab | Nick/Marco | | |
| Gratia DB | No | Fermilab | Nick/Marco | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/OSGDocRepoServiceLevelAgreement][OSG Document Repository]] | ? | Fermilab | Marcia | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/OSGWebPageServiceLevelAgreement][OSG Web Pages]] | Yes | Fermilab | Marcia | |
| VOMS | Yes | Fermilab | Neha | | |
| VOMS Admin | Yes | Fermilab | Neha | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/BDIIServiceLevelAgreement][BDII]] | No | GOC | Scott Teige | | CMS is main user |
| [[https://twiki.grid.iu.edu/bin/view/Operations/CollectorServiceLevelAgreement][GOC Condor Collector]] | Yes | GOC | Scott Teige | | administered by Carl/Juan@Wisc |
| [[https://twiki.grid.iu.edu/bin/view/Operations/GOCContactServiceLevelAgreement][GOC Service Desk]] | Yes | GOC | Scott Teige | | Not really a service running on a host. Basically means people who run support|
| [[https://twiki.grid.iu.edu/bin/view/Operations/SoftwareCacheServiceLevelAgreement][OSG Production Software cache]] | Yes (!InCommon) | GOC | Scott Teige | | Check with Anand what this means - repo1/2 or software1/2 |
| !GratiaWeb | Yes (!InCommon) | GOC | Scott Teige | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/GlideInWMSServiceLevelAgreement][GWMS factory]] | Yes | GOC | Scott Teige | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/MyOSGServiceLevelAgreement][MyOSG]] | Yes (!InCommon) | GOC | Scott Teige | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/OASISServiceLevelAgreement][OASIS (CVMFS)]] | Yes (oasis, oasis-replica = !InCommon, oasis-login = !DigiCert) | GOC | Scott Teige | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/OIMServiceLevelAgreement][OIM]] | Yes (!InCommon) | GOC | Scott Teige | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/OSGDisplayServiceLevelAgreement][OSG Display]] | No | GOC | Scott Teige | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/JIRAServiceLevelAgreement][OSG Jira]] | Yes (!InCommon) | GOC | Scott Teige | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/SoftwareRepoServiceLevelAgreement][OSG RPM Software Repository]] | Yes (!InCommon) | GOC | Scott Teige | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/OSGXSEDEServiceLevelAgreement][OSG-XSEDE]] | Yes (both !DigiCert and !InCommon) | GOC | Scott Teige | | GWMS Frontend and submit host |
| [[https://twiki.grid.iu.edu/bin/view/Operations/RSVServiceLevelAgreement][OSG RSV Collector]] | Yes | GOC | Scott Teige | | [[https://twiki.grid.iu.edu/bin/view/Operations/RSVServiceLevelAgreement][RSV Collector]] |
| [[https://twiki.grid.iu.edu/bin/view/Operations/RSVReportsServiceLevelAgreement][OSG-WLCG Comparison Reporting]] | Yes | GOC | Scott Teige | | runs queries against gratia db and feeds in to epel |
| [[https://twiki.grid.iu.edu/bin/view/Operations/TicketingServiceLevelAgreement][OSG Ticket Exchange (TX)]] | Yes | GOC | Scott Teige | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/GOCTicketServiceLevelAgreement][Ticketing/Notification]] | Yes (!InCommon) | GOC | Scott Teige | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/TWikiServiceLevelAgreement][Twiki]] | Yes (!InCommon) | GOC | Scott Teige | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/VOMSServiceLevelAgreement][VOMS]] | Yes | GOC | Scott Teige | | MIS, CSIU, OSGEDU, OSG ( backup) |
| [[https://twiki.grid.iu.edu/bin/view/Operations/OSGConnectServiceLevelAgreement][OSG Connect]] | Yes | UChicago | Suchandra, Rob Gardner | | |
| Stashcache | Yes | UChicago | Suchandra, Rob Gardner | | |
| [[https://twiki.grid.iu.edu/bin/view/Operations/GlideInWMSServiceLevelAgreement][GWMS factory]] | Yes | UCSD | Jeff Dost | | |
| Koji | Yes | UW-Madison | Mat Selmeci | | |


---+++ Test Details

   * (1) 
   * (2)

---+++ Known Issues

   * (1) 
   * (2) 

   * [[%ATTACHURL%/cilogon-osg.tar.gz][cilogon-osg.tar.gz]]: !CILogonHSM Cert and CRL

%META:FILEATTACHMENT{name="cilogon-osg.tar.gz" attachment="cilogon-osg.tar.gz" attr="" comment="CILogonHSM Cert and CRL" date="1427994092" path="cilogon-osg.tar.gz" size="5953" stream="cilogon-osg.tar.gz" tmpFilename="/usr/tmp/CGItemp19647" user="NehaSharma" version="2"}%
