%META:TOPICINFO{author="MineAltunay" date="1352325500" format="1.1" reprev="1.3" version="1.3"}%
%TOC%

---++OSG PKI Transition Guidance for VOs

This document provides the overall guidance for VOs regarding the OSG PKI Transition. It describes the tasks that a VO should perform for a smooth transition. Although OSG provides documentation for end users and system administrators, there are still some tasks that are specific for a VO and should be decided and documented by the VO management. This document lists such VO-specific tasks and guides VOs to plan for such tasks. 
   * We recommend that the VO should assign a person to coordinate the PKI transition activities within VO. This person(s) can make sure that system administrators and end users can perform their tasks and they receive help when things go wrong.        
   * We strongly recommend that VOs prepare documentations for the end users and system administrators based on the following tasks tailored for their specific situation.
   * Although we plan for a smooth transition period, there may be some problems discovered along the way. VOs should alert their system administrators that there may be a number of cases where the administrators will need to help users troubleshoot transition related problems. VO should provide some instructions for end users regarding how to report problems, and VOs should help system administrators handle such issues. 
   

---+++ VO-Specific Tasks 
---++++ General Planning Tasks

   1 Identify a person who will coordinate the transition tasks in the VO. 
   2 Make sure OSG PKI Transition team and VO transition lead communicate with one another and up to date in terms of their plans. 
   3. Make a plan for how to deal with problems/errors reported by users and admins. If OSG ticketing system will be used, make sure GOC and VO system administrators and end users are aware of using this system and have access to it. 
   4 Create documentation for end users and system administrators based on the tasks described below tailored specifically for your VO's situation. 

---++++ Tasks Related to Services/Hosts
 
   1 Identify the services that has a service and host certificate from DOEGrids CA. 
   2 Make a list of the expiration dates for the host/service certificates. Remind the sservice operators to keep an eye on the list. We strongly recommend checking the list monthly as each month more certificates will expire. It is very important that the service operators will obtain new host/service certificates from OSG CA before the expiraton date. We suggest that replacement certificates from OSG CA should be obtained a month before the expiration date of the current certificates. 
   3 Identify the services that authorizes end users based on end user certificates. These services will have to register new user certificates as the users obtain new certificates from OSG CA. For example, CMS VO has a list of VOMS, GGUS ticketing system, pilot based submission servers, CERN twikis and indico service, and various other services that all uses certificates to authorize users. It is the VO's responsibility to identify all such services and produce documentation tailored for a specific service. 
   4 Encourage service operators to first build a test instance of the services that they run and perform the changes in the test instance.
   5 Direct service operators to OSG documentation on how to obtain [[https://confluence.grid.iu.edu/display/CENTRAL/User+Guide][host/service certificates]].  OSG has a web-based request form that you can make certificate requests at. If you prefer commandline tools to request and retrieve your certificates, follow the instructions on https://twiki.grid.iu.edu/bin/view/Operations/OSGPKICommandlineClients.
   6 Distribute the new service/host certificates to third parties if needed for service-service handshakes. For VOMS server, the new VOMS host certificate should be distributed to all GUMS services. The vomses file distributed by OSG contains the certificate information for each VOMS server certificates. When your certificate change, notify the OSG GOC via a ticket so that your new certificate can be included in the vomses file. 
   6 The service operators should also update the list of trusted root Certificate Authorities. This step will allow the service to accept and trust the DigiCert trust roots, DigiCert root and intermediate Certificate Authorities. 
      1 For a grid resource, simply do a *yum update osg-ca-certs* or *yum update osg-ca-certs-compat* depending on your system's openssl version. This will update your /etc/grid-security/certificates directory with the latest CA files form OSG. If you do not use rpms, get the CA tarballs by following instructions at https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallCertAuth
      2 If this is not a grid resource, e.g. a web service, then download the trust roots from http://digicert-grid.com/. Find the instructions specific to your service to add the CA certificates.
   7 On grid resources, update the vomses files. Vomses file has a list of all VOMS servers and their certificate DNs. As VOMS servers will change their own certificates from DOEGrids CA to OSG CA, vomses file will be updated. The OSG Grid Operation Center updates and distributes the most recent vomses file at http://software.grid.iu.edu/pacman/tarballs/vo-package/vomses 
   8. End User Authorization. Document the steps necessary for the services (identified in #3) to register the new user certificates. Consider whether a service can and should register multiple certificates for a single user. Some services simply do not have the capability to do so. You can visit [[https://twiki.grid.iu.edu/bin/view/Security/DOEGrids2DigiCertDNTransition][this link]] for more information on this topic.
      1 In particular, we strongly recommend that VOMS+VOMRS server should not try to register multiple certificates for a single user account. Instead, the VOMS Admin should create a separate VOMS user account for each user certificate. This is because the GUMS server version installed at most OSG sites cannot handle multiple certificates downloaded from the VOMS servers. We will provide additional instructions on how to achieve this. 
      2 As a result of having separate VOMS accounts for each user certificate, each user certificate will be treated as a separate user at a grid site. In other words, each certificate will be mapped into a separate local unix account at a grid site. Consider if this is suitable for your VO operations. If it is necessary for your users to link suh accounts, please notify OSG PKI team and we will help you work with sites. Sites can manually change ser mappings to make sure all user certificates are mapped into the same unix account.  
      3 Grid resources (CE/SE) will receive the new user certificate DNs directly from the VOMS servers. The system admins will not have to do anything specifically
      4 Non-grid services need to be updated manually by the system admin. If you have services such as twiki, ticketing systems, etc, provide documentation for your service operators on how they should register new user certificates. 
   9 Encourage service operators to test their services with new OSG CA certificates
   10 If everything works well, encourage service operators to apply the changes to production servers.

---++++End User Transition Tasks

   1 Alert end users that they should apply to OSG CA for a certificate. We recommend that users should apply for new certificates a month ahead of their current certificates expire. The instructions on how to obtain new certificates is available at https://confluence.grid.iu.edu/display/CENTRAL/User+Guide. 
   2 After obtaining the certificate, the users should import it into their browsers and the file system. This step is not any different than what we used to do with DOEGrids CA.
   3 Users should extract the certificate Distinguished Name and they should register their new certificates with VO services that authorizes users based on user certificates. VO should provide documentation on how end users will register their new certificates with VO services.
   4 If users have client-side tools installed on their personal machines, they should update the trust roots on their client side tools. 
      1 Users can do a *yum update osg-ca-certs* or *yum update osg-ca-certs-compat* depending on their system's openssl version. This will update the /etc/grid-security/certificates directory with the latest CA files form OSG. If they do not use rpms, they can get the CA tarballs by following instructions at https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallCertAuth
      2 The DigiCert CA certificates are available at http://digicert-grid.com/. 
   5 Users should test accessing VO services with their new certificates
   6 Provide users with instructions on how to report problems. For example, document who the user should contact first if they lose access to a service after switching certificates. 







-- Main.MineAltunay - 07 Nov 2012
