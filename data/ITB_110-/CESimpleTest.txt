%META:TOPICINFO{author="KyleGross" date="1225985960" format="1.1" version="1.24"}%
%META:TOPICPARENT{name="ValidatingComputeElement"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

%STARTINCLUDE%
%BR%
---+ _%INCLUDEHEADING%  %SPACEOUT{ "%TOPIC%" }%_
%EDITTHIS%
%BR%

---++ Notes

This document is intended for those who are new to setting up an OSG Compute Element (grid gateway server) and is presented as a simple review of the most basic services.

---++ Set up your credentials

The first step is to configure the CE to allow access using your own Grid credentials. (See the [[CertScripts#FAQ][Personal Certificates FAQ]] for more.) Once that's done you'll be able to run local tests and verify operation of your CE locally. Here we'll assume a =grid-mapfile= exists as the method for authorization and mapping of DN to a local account.  

Make sure you have a grid proxy for yourself. This is based on your certificate. This is to be done as yourself, *not as root*. Here we assume the your =usercert.pem= and =userkey.pem= exist in the standard, =$HOME/.globus/= area. (If not check the man-pages for options).

<pre class="screen">
 > <b>source $VDT_LOCATION/setup.(c)sh</b>
 > <b>grid-proxy-init</b>
   <em>(you will be prompted for your GRID pass phrase)</em>
</pre>
   
Then, to get the subject (DN) of your proxy, run: 

<pre class="screen">
 > <b>grid-proxy-info -identity</b>
   /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Joe Blow 830711
</pre>

As root again, take the identity string and pre-pend it to the =/etc/grid-security/grid-mapfile= and assign it to a local user account (you can use any of the VirtualOrganizations/VOInfo accounts you've created at the beginning to test; you cannot use root). So the grid-mapfile should have at least one entry like:

<pre class="programlisting">
"/DC=org/DC=doegrids/OU=People/CN=Joe Blow 830711" usatlas1 
</pre>

Where " =usatlas1= " is the local account. This is enough to enable the rest of the installation testing.


---++ Simple Test of Fork Queue

Using the grid proxy you just created, you can test the Globus gatekeeper fork queue (job run directly on the CE). The resource is specified by the <i>FQDN</i> represented by <i>hostname</i> (below) and the jobmanager type. Executing: 

<pre class="screen">
 > <b>globus-job-run <i>hostname</i>/jobmanager-fork /usr/bin/id</b> 
  uid=9872(usatlas1) gid=9872(usatlas1) groups=9872(usatlas1)
</pre>

Should return the UNIX user account assignment based on the =grid-mapfile= created/updated in the last section.  A record of this submission can be found in the gatekeeper logfile,  =$VDT_LOCATION/globus/var/globus-gatekeeper.log= :

<pre class="programlisting">
TIME: Fri Nov 16 11:51:51 2007
 PID: 18512 -- Notice: 6: /opt/osg/vtb-0.8b1/globus/sbin/globus-gatekeeper pid=18512 starting at Fri Nov 16 11:51:51 2007 
TIME: Fri Nov 16 11:51:51 2007
 PID: 18512 -- Notice: 0: GATEKEEPER_ACCT_FD=4 (/opt/osg/vtb-0.8b1/globus/var/accounting.log)
TIME: Fri Nov 16 11:51:51 2007
 PID: 18512 -- Notice: 6: Got connection 128.3.30.236 at Fri Nov 16 11:51:51 2007
TIME: Fri Nov 16 11:51:51 2007
 PID: 18512 -- Notice: 5: Authenticated globus user: /DC=org/DC=doegrids/OU=People/CN=Joe Blow 830711
TIME: Fri Nov 16 11:51:51 2007
 PID: 18512 -- Notice: 0: GATEKEEPER_JM_ID 2007-11-16.11:51:51.0000018512.0000000000 for /DC=org/DC=doegrids/OU=People/CN=Joe Blow 830711 on 128.3.30.236
TIME: Fri Nov 16 11:51:51 2007
 PID: 18512 -- Notice: 0: GRID_SECURITY_HTTP_BODY_FD=7
TIME: Fri Nov 16 11:51:51 2007
 PID: 18512 -- Notice: 5: Requested service: jobmanager 
TIME: Fri Nov 16 11:51:51 2007
 PID: 18512 -- Notice: 5: Authorized as local user: usatlas1
TIME: Fri Nov 16 11:51:51 2007
 PID: 18512 -- Notice: 5: Authorized as local uid: 9872
TIME: Fri Nov 16 11:51:51 2007
 PID: 18512 -- Notice: 5:           and local gid: 9872
TIME: Fri Nov 16 11:51:51 2007
 PID: 18512 -- Notice: 0: executing /opt/osg/vtb-0.8b1/globus/libexec/globus-job-manager
TIME: Fri Nov 16 11:51:51 2007
 PID: 18512 -- Notice: 0: GRID_SECURITY_CONTEXT_FD=10
TIME: Fri Nov 16 11:51:51 2007
 PID: 18512 -- Notice: 0: Child 18553 started
</pre>

---++ Simple Test Of The  Job Manager Queue

One can repeat the above test but direct the job to the cluster's batch scheduler.  The example below is for the Condor job manager.  Other supporter batch systems include PBS ( =jobmanager-pbs= ), LSF ( =jobmanager-lsf= ) and SGE ( =jobmanager-sge= ).

<pre class="screen">
 > <b>globus-job-run <i>hostname</i>/jobmanager-condor /usr/bin/id</b> 
   uid=9872(usatlas1) gid=9872(usatlas1) groups=9872(usatlas1)
</pre>

The same results should appear as with the fork queue submission.  The =globus-gatekeeper.log= file will look identical except for the "Request service" message:

<pre>
   PID: 29703 -- Notice: 5: Requested service: jobmanager-condor
</pre>

---++ Simple Test Of GSIFTP Services

A simple test of the gsiftp services can be done by creating a simple test file and then copying it from one location on your machine to the default storage area for your CE. When you [[ComputeElementInstall#Configuring_the_OSG_Attributes][configured your OSG attributes]], you defined a shared storage space ( =$OSG_DATA= ) with read-write access for all users. We will use this as the destination directory for the file we are copying.  The steps here are: create the file, (source the osg-attributes), copy the file, verify the copy.  Again, substitute your <i>FQDN</i> for <i>hostname</i> below.

<pre class="screen">
> <b>echo "My test gsiftp file" > /tmp/gsiftp.test</b>
> <b>source $VDT_LOCATION/monitoring/osg-attributes.conf</b>   
> <b>globus-url-copy file:/tmp/gsiftp.test gsiftp://<i>hostname</i>${OSG_DATA}/gsiftp.test</b>
> <b>ls -l  $OSG_DATA/gsiftp.test</b>
 -rw-r--r--  1 usatlas1 usatlas1  20 Jan  9 13:29 /storage/local/data1/osg/OSG.DIRS/data/gsiftp.test
</pre>

As with the job-submission tests above, one can view the interaction with the service in the relevant globus log files:  =$VDT_LOCATION/globus/var/log/gridftp-auth.log= for the authorization record and =$VDT_LOCATION/globus/var/log/gridftp.log= for the data transfer.

%STOPINCLUDE%
%BR%
%COMPLETE3% %BR%
%RESPONSIBLE% Main.JeffPorter - 25 Oct 2007 %BR%
%REVIEW%

%META:TOPICMOVED{by="ForrestChristian" date="1166042277" from="Integration.CESimpleTest050" to="Integration/ITB_0_5.CESimpleTest"}%
