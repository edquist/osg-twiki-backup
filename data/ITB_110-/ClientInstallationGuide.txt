%META:TOPICINFO{author="JeffPorter" date="1188517876" format="1.1" reprev="1.13" version="1.13"}%
%META:TOPICPARENT{name="DocumentationTable"}%
%LINKCSS%

<!-- This is the default OSG documentation template. Please modify it in -->
<!-- the sections indicated to create your topic.                        --> 

<!-- By default the title is the WikiWord used to create this topic. If  -->
<!-- you want to modify it to something more meaningful, just replace    -->
<!-- %TOPIC% below with i.e "My Topic".                                  -->

---+!! Installing the OSG Client Software Using Pacman
%TOC%

%STARTINCLUDE%
%EDITTHIS%

This process assumes that you have already [[Documentation/CertificateGet][obtained a grid certificate]] from an OSG-recognized Certificate Authority and joined an OSG Virtual Organization. If you have not, you will not be able to complete this process.

---++ System Requirements
See [[http://vdt.cs.wisc.edu/releases/1.6.1/requirements.html][VDT System Requirements]]. 

%NOTE% The OSG Client 0.6.x is only supported on Linux. It does not currently support Mac OS X or other *nixes.



---++ Install pacman
The OSG Client uses pacman for installation. Use the latest version to ensure that it is compatible with the OSG Client installation.

<pre class="screen">
[~]$ <userinput>wget http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-latest.tar.gz</userinput>
--09:56:21--  http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-latest.tar.gz
           => `pacman-latest.tar.gz'
Resolving physics.bu.edu... done.
Connecting to physics.bu.edu[128.197.41.42]:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 879,760 [application/x-gzip]

100%[===========================================================>] 879,760      745.78K/s    ETA 00:00

09:56:22 (745.78 KB/s) - `pacman-latest.tar.gz' saved [879760/879760]

[~]$ <userinput>tar -zxvf pacman-latest.tar.gz</userinput>
pacman-3.20/
pacman-3.20/bin/

<replaceable>&lt; - - SNIP! - - ></replaceable>

pacman-3.20/src/tracebackSaver.pyc
pacman-3.20/src/urlAccess2.pyc
[~]$ <userinput>cd pacman-3.20</userinput>
[~/pacman-3.20]$ <userinput>source setup.sh</userinput>   <replaceable># or setup.csh (depends on shell)</replaceable>
[~/pacman-3.20]$ <userinput>cd ..</userinput>
</pre>

---++ Install the OSG Client
You will need to create a directory for the client and then install it using pacman.

<pre class="screen">
[~]$ <userinput>mkdir osg-client</userinput>
[~]$ <userinput>cd osg-client/</userinput>
</pre>

%NOTE% In the next step, installing the OSG client software through pacman, we have found that it may sometimes not recognize a supported platform such as Scientific Linux and fail. If that occurs, see if your platform is in the supported list by executing =pacman -platforms=. You can then force pacman to use a particular platform by running it with the =-pretend-platform= switch: %BR% =pacman -pretend-platform:linux-sl-fermi-5.5=

<pre class="screen">
[~/osg-client]$ <userinput>pacman -get OSG:Client</userinput>
Do you want to add [http://software.grid.iu.edu/pacman/] to [trusted.caches]? (y or n): <userinput>y</userinput>
Package [client] found in [OSG]...
Package [OSG:vo-client-0.6] found in [OSG]...
Package [vo-client-0.6] found in [OSG]...
Do you want to add [http://vdt.cs.wisc.edu/vdt_161_cache] to [trusted.caches]? (y or n): <userinput>y</userinput>
Package [VDT-Client] found in [http://vdt.cs.wisc.edu/vdt_161_cache]...
Package [http://vdt.cs.wisc.edu/vdt_161_cache:VDT-Common] found in [http://vdt.cs.wisc.edu/vdt_161_cache]...

<replaceable>&lt; - - SNIP! - - ></replaceable>
</pre>

%STARTInsetBox%

---+++ Troubleshooting: Unsupported Platform Error

If you get a "Unsupported Platform" error while installing the OSG Client using pacman, try the installation step again, but this time use the =-pretend-platform= switch for pacman, selecting an appropriate platform

%ENDInsetBox%


<!-- After the installation has completed, you will also be able to... -->

<pre class="screen">
VDT 1.6.1 installs a variety of software, each with its own license.
In order to continue, you must agree to the licenses.
You can view the licenses online at:

     http://vdt.cs.wisc.edu/licenses/1.6.1

After the installation has completed, you will also be able to
view the licenses in the "licenses" directory.

Do you agree to the licenses? [y/n] <userinput>y</userinput>

</pre>

Answer =y= to continue the installation.

<pre class="screen">
If you would like, we can configure the Condor batch system to
start automatically at boot time.

Configuring the Condor daemon requires changes to
- /etc/init.d (or /etc/rc.d/init.d)

Would you like to enable the Condor batch system to run automatically?

Possible Answers:
     y: Yes. Please remove any old instances of the service and run
        this one..
     n: No. Please remove any old instances of the service, but don't
        run this one.
</pre>

Answer =y= to start up the Condor.  This is a personal condor that is only for submitting jobs to remote sites. It is not the server Condor for receiving jobs. If you are submitting jobs from a machine that is also receiving jobs with Condor, answering "yes" to this will *not* overwrite the server Condor. Only your condor-g will be affected.

<pre class="screen">
Several services provided by the VDT create unbounded log files.  If you wish, w
e can rotate those file on a daily basis.

Would you like to setup daily rotation of VDT log files?

Possible Answers:
     y: Yes. Please remove any old instances of the service and run
        this one..
     n: No. Please remove any old instances of the service, but don't
        run this one.

<userinput>y</userinpu>
</pre>

You will probably want to answer "yes" and have your VDT log files rotated. They can get rather large if you are running many jobs.


<pre class="screen">
Do you want to run a cron job that will update the CA certificate
revocation lists automatically? This will use the fetch-crl program
that comes with the VDT. The cron job will run at a random time
between midnight and 6:00am. We select a random time to avoid having
all VDT installations fetching CRLs at the same time.

Do you want to update the CA certification revocation lists (CRLs) automatically
? [y/n] <userinput>y</userinput>
</pre>

Most of the time answering "yes" to updating your CRLs automatically is preferred.

<pre class="screen">
The VDT typically installs public certificates and signing policy files
for the well-known public CA's. This is necessary in order for you to
perform GSI authentication with any remote Grid services (that have
service/host certificates signed by these CA's).

For more information please refer to the VDT documentation:
Where would you like to install CA files?

Choices:
        r (root)  - install into /etc/grid-security/certificates
                   (existing CA files will be preserved)
        l (local) - install into $VDT_LOCATION/globus/share/certificates
        n (no)    - do not install
</pre>

Answer =l= (lowercase "L") so that the CA files will be installed inside of your installation directory.

At this point you are almost done. The client will complete with the following output:

<pre class="screen">
The VDT version 1.6.1 has been installed.


The OSG Client package ITB version 0.5.2 has been installed.
</pre>

Although the OSG Client has been installed, you will have to configure it with your grid certificate in order to start submitting jobs.





---++ Install Your Grid Certificate
This assumes that you have already [[Documentation.CertificateGet][obtained a grid certificate]] from an OSG-supported Certificate Authority. Contact your VO for detailed instructions.

Your certificate may not be in the right format for the OSG Client to use. Most grid certificates are in a certificate & key combination file (*.p12). We need to separate these two things out into separate files, =usercert.pem= and =userkey.pem=. =userkey.pem= contains the encrypted private key and should have restrictive permissions such that only the owner can read or write to it. =usercert.pem= is the certificate, containting the public key. This file is not encrypted and can be distributed freely.


%NOTE% We do not recommend using your KCA certificate for grid access because it expires every week. 


---+++ To obtain the =usercert.pem= and =userkey.pem= files from a DOE_GRID_Certificate.p12 file:

Move your p12 certificate file to your =$HOME/.globus= on the system running the OSG client. You will then need to convert the p12 file into formats that the client can use. 

<pre class="screen">
$ <userinput>cp <replaceable>DOE_GRID_Certificate</replaceable>.p12 $HOME/.globus</userinput>
$ <userinput>cd $HOME/.globus</userinput>
$ <userinput>openssl pkcs12 -in <replaceable>DOE_Grid_Certificate.p12</replaceable> -clcerts -nokeys -out ./usercert.pem</userinput>
  Enter Import Password: <replaceable>*********</replaceable>
  MAC verified OK
$ <userinput>openssl pkcs12 -in <replaceable>DOE_Grid_Certificate.p12</replaceable> -clcerts -nocerts -out ./userkey.pem</userinput>
  Enter Import Password:   <replaceable>*********</replaceable> 
  MAC verified OK
  Enter PEM pass phrase:   <replaceable>*********</replaceable>
  Verifying - Enter PEM pass phrase:   <replaceable>*********</replaceable>
$ <userinput>chmod go-rw userkey.pem</userinput>
</pre>

The last step corrects any permissioning problems.


---+++ To update the Fermi VOMS information (e.g., after renewing): 
<pre class="screen">
$ <userinput>cd $HOME/.globus</userinput>
$ <userinput>openssl x509 -in .globus/usercert.pem -subject -serial -noout</userinput>
</pre>

---+++ To test your credentials:

%NOTE% This example was for the Fermilab VO. Customize the commands for your VO's environment. 

<pre class="screen">
[osg-client]$ <userinput>cd osg-client</userinput>
[osg-client]$ <userinput>source setup.sh</userinput>
[osg-client]$ <userinput>voms-proxy-init -voms <replaceable>fermilab:/fermilab</replaceable></userinput>
Cannot find file or dir: $prefix/etc/vomses
Your identity: /DC=org/DC=doegrids/OU=People/CN=E. Forrest Christian 802298
Enter GRID pass phrase:
Creating temporary proxy ............................................................................. Done
Contacting  fermigrid2.fnal.gov:15001 [/DC=org/DC=doegrids/OU=Services/CN=host/fermigrid2.fnal.gov] "fermilab" Done
Creating proxy .................................. Done
Your proxy is valid until Wed May 30 01:28:09 2007
[osg-client]$ <userinput>globusrun -a -r <replaceable>fermigrid1.fnal.gov</replaceable>/jobmanager-fork</userinput>

GRAM Authentication test successful
[forrestc@cmssrv09 osg-client]$ 
</pre>

Now attempt to get a grid poxy by using either the =grid-proxy-init= or =voms-proxy-init= commands.

<pre class="screen">
[osg-client]$ <userinput>voms-proxy-init -voms <replaceable>fermilab:/fermilab</replaceable></userinput>
Cannot find file or dir: $prefix/etc/vomses
Your identity: /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Forrest Christian/USERID=forrestc
Contacting  fermigrid2.fnal.gov:15001 [/DC=org/DC=doegrids/OU=Services/CN=host/fermigrid2.fnal.gov] "fermilab" Done
Creating proxy ............................................ Done
Your proxy is valid until Wed May 23 21:35:09 2007
[osg-client]$ <userinput>globus-job-run fermigrid1.fnal.gov/jobmanager-condor /usr/bin/printenv</userinput>
HOME=/grid/home/fnalgrid
OSG_WN_TMP=/local/stage1
OSG_DATA=/grid/data

<replaceable>SNIP!</replaceable>

_CONDOR_ANCESTOR_3168=19619:1179931237:3100815932
_CONDOR_ANCESTOR_19619=19620:1179931237:3450294528
[osg-client]$ 
</pre>

---++++ Troubleshooting

If this doesn't work, check that the "gatekeeper" &mdash; the Grid component that accepts and executes remote jobs &mdash; can correctly authenticate you:

%NOTE% This example is against the Fermilab site. Customize it for your VO and site.

<pre class="screen">
[osg-client]$ <userinput>globusrun -a -r <replaceable>fermigrid2.fnal.gov</replaceable>/jobmanager-fork</userinput>
GRAM Authentication test successful
[osg-client]$ 
</pre>

This is a handy diagnostic test to know for any job.

---++  Firewall Considerations

Some GRAM job initiation and management operations require call backs to the client machine. If your client is running a firewall blocking ephemeral ports, an ephemeral port range should be intentified for use and opened for incoming connections.  Opening the port range may depend on your firewall implementation.  Indentifying the port range in the client tools is done in two ways:

   * specifiy the GLOBUS_TCP_PORT_RANGE variable in the $VDT_LOCATION/setup.sh script:

 <pre class="screen">
GLOBUS_TCP_PORT_RANGE=20000,20200
export GLOBUS_TCP_PORT_RANGE
</pre>

   * specify range in for use by Condor-g in the $CONDOR_CONFIG file ( *Note:* condor must be restarted):

<pre class="screen">
HIGHPORT = 20200 
LOWPORT  = 20000
</pre>





%STOPINCLUDE%

%BOTTOMMATTER%

-- Main.ForrestChristian - 29 May 2007

%META:TOPICMOVED{by="ForrestChristian" date="1166046231" from="Integration.ClientInstallationGuide050" to="Integration/ITB_0_5.ClientInstallationGuide"}%
