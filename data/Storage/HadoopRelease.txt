%META:TOPICINFO{author="BrianBockelman" date="1288643998" format="1.1" version="1.12"}%
%META:TOPICPARENT{name="Hadoop"}%
---+!! *<noop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

---+++ Hadoop 0.20 Release

The Hadoop-0.20 OSG release involves a giant overhaul of how we package.  The highlights are:
   1 Switching to the CDH3 distribution.
   1 Switching to source RPMs from EPEL for all Globus components.
   1 Upgrade to bestman2 (which is the remaining non-source RPM).
   1 Using Koji to handle release engineering and mash to auto-create repos.
   1 Adding xrootd as a major component.

---+++ RPMs for Hadoop 0.20
Here are the SRPMs we are using for Hadoop 0.20:
   * GratiaReporting
   * bestman2
   * globus-gridmap-callout-error
   * gratia-probe
   * hadoop-0.20
   * hadoop-0.20-osg
   * lcas
   * lcas-plugins-basic
   * lcmaps
   * lcmaps-plugins-basic
   * lcmaps-plugins-scas-client
   * lcmaps-plugins-verify-proxy
   * saml2-xacml2-c-lib
   * xrootd
   * xrootd-cmstfc
   * xrootd-hdfs
   * xrootd-lcmaps
   * globus-mappings-osg

---+++ Setting up your build environment

   * Email Michael Thomas your certificate's DN.
   * Install koji on your RHEL5 machine from EPEL.
   * Install your certificate into ~/.koji/koji.cert.  Copy the PEM formatted certificate and key into this file.
   * Copy the attached koji.conf to /etc/koji.conf.
   * Copy the DOEGrids and ESNet CA certs into /etc/pki/tls/certs/ca-bundle.crt.  Again, copy/paste the CA certs into the file.
   * The build target we use is dist-el5-hadoop20.
   * Edit your rpmmacros file:
      <verbatim>echo > ~/.rpmmacros << EOF
%_topdir $HOME/rpmbuild
%_smp_mflags -j3
EOF
</verbatim>
   * Create the necessary directories:
      <verbatim>
mkdir -p ~/rpmbuild/{BUILD,INSTALL,RPMS,SOURCES,SPECS,SRPMS}
</verbatim>

---+++ Building an RPM

Given a SRPM called =foo.srpm=:
   * =rpm -Uhv foo.srpm=  Installs the sources locally
   * =rpmbuild -bs ~/rpmbuild/SPECS/foo.spec=  Recreates the SRPM, verifying everything is self-consistent.
   * If the RPM is not in the repo already, =koji add-pkg <repo> ~/rpmbuild/SRPMS/foo.srpm=
   * =koji build <repo> ~/rpmbuild/SRPMS/foo.srpm=

---+++ Building an appliance.

Given a kickstart configuration, =kickstart.cfg=:
<verbatim>koji spin-appliance dist-el5 x86_64 ~kickstart.cfg</verbatim>

%META:FILEATTACHMENT{name="koji.conf" attachment="koji.conf" attr="" comment="" date="1287200173" path="koji.conf" size="599" stream="koji.conf" tmpFilename="/usr/tmp/CGItemp30619" user="BrianBockelman" version="1"}%
