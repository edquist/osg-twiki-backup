%META:TOPICINFO{author="WillMaier" date="1237478088" format="1.1" version="1.1"}%
%META:TOPICPARENT{name="Hadoop"}%
---+!! *<noop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

The grid-enabled Hadoop DFS utilizes normal Globus GridFTP servers with a
specialized plugin in order to do transfers.  Because it uses this server
software, we are able to take advantage of the OSG's accounting system.  The
system, Gratia, has a plugin which monitors the Globus GridFTP logs and reports
any transfer data to a central collector.

The instructions on this page must be followed for every GridFTP server on Hadoop.

---+ Configuration

Configure the probe with the newly installed configuration script.

<verbatim>
source ${VDT_LOCATION}/setup.sh
$VDT_LOCATION/vdt/setup/configure_gratia  --probe gridftp-transfer --report-to <gratia_host:gratia_port>  --probe-cron --site-name "<site_name>"
</verbatim>

Verify the location of the GUMS server in =$VDT_LOCATION/gums/config/gums-client.properties=. 
This file should have been set correctly by the =GridFTP_HDFS=
package.

Now, turn on the services:

<verbatim>
vdt-control --on gratia-gridftp-transfer
vdt-control --enable gums-host-cron
vdt-control --on gums-host-cron
</verbatim>

This should install a cronjob for the user root. If you run the
following command as root:

<verbatim>
crontab -l
</verbatim>

The output should include lines like the following:

<verbatim>
7,17,27,37,47,57 * * * * /opt/osg/osg-100/gratia/probe/gridftp-transfer/gridftp-transfer_meter.cron.sh > /opt/osg/osg-100/gratia/var/logs/gratia-probe-gridftp-transfer.log 2>&1
36 6,12,18,0 * * * /opt/osg/osg-100/gums/scripts/gums-host-cron
</verbatim>

Run =gums-host-cron= by hand and verify that the generated file is
non-zero:


<verbatim>
${VDT_LOCATION}/gums/scripts/gums-host-cron
ls -l ${VDT_LOCATION}/monitoring/osg-user-vo-map.txt
</verbatim>

Also, read through the =$VDT_LOCATION/monitoring/log/gums-host-cron.log= 
logfile to make sure there were no errors.

Run the Gratia probe once by hand to check for functionality:

<verbatim>
${VDT_LOCATION}/gratia/probe/gridftp-transfer/gridftp-transfer_meter.cron.sh
</verbatim>

Look for any abnormal termination and report it if it is a non-trivial site issue.

-- Main.WillMaier - 19 Mar 2009