%META:TOPICINFO{author="KyleGross" date="1225985966" format="1.1" version="1.3"}%
%META:TOPICPARENT{name="StorageForum"}%
Proposed instructions for setting values for storage elements in glue schema 1.3.

See https://twiki.cern.ch/twiki/bin/view/LCG/GSSDGLUEProposal for an example.

See https://forge.cnaf.infn.it/plugins/scmsvn/viewcvs.php/*checkout*/v_1_3/spec/draft-3/pdf/GLUESchema.pdf?rev=33&root=glueschema for the specification.

---++++++Notes

   * Glue schema 1.2 does not have a <nop>VirtualOrganizations/VOInfoInfo element. Therefore, if compatibility with glue schema 1.2 is desired, there need to be multiple <nop>GlueSA elements, whereas in glue schema 1.3 there would be multiple <nop>VirtualOrganizations/VOInfoInfo elements.
   * Technically, the schema allows multiple <nop>GlueSAAccessControlBase.Rules to be specified for each <nop>GlueSA. However, because of a bug in existing clients, only one VirtualOrganizations/VOInfo per <nop>GlueSA should be specified. If a storage area allows more than one VO, include one <nop>GlueSA element for each VO.

<verbatim>
A) one GlueSE for each storage element
GlueSE/GlueSEUniqueID=$se_fqdn (convention; any ID allowed)
GlueSE/GlueSEName=$se_registered_name
GlueSEPort: 8443 (for GFAL compatibility)
GlueSEArchitecture: disk (or tape, if tape-back capable)
GlueSEStatus: Production (or Queueing, Closed, Draining for maintenance modes - see specification).
GlueSEImplementationName: dCache (or Castor, etc)
GlueSEImplementationVersion: 1.8.0-26 (dCache example, patch level)
GlueSESizeTotal: $(value of GlueSETotalOnlineSize) + $(value of GlueSETotalNearlineSize)
GlueSESizeFree: $(value of GlueSESizeTotal) - $(value of GlueSEUsedOnlineSize)  - $(value of GlueSEUsedNearlineSize)
GlueSETotalOnlineSize: $total_disk (GB)
GlueSEUsedOnlineSize: $used_disk (GB)
GlueSETotalNearlineSize: $total_tape (GB)
GlueSEUsedNearlineSize: $used_tape (GB)
GlueForeignKey: GlueSiteUniqueID=$(value of mds-vo-name)
GlueSEInformationServiceURL: $ldap_uri

B) one GlueSEAccessProtocol for each ftp protocol (Optional -may wish to allow srm access only. Definitions for other protocols TBD.)
GlueSEAccessProtocol/GlueSEAccessProtocolLocalID=gsiftp
GlueSEAccessProtocol/GlueSEAccessProtocolType=gsiftp
GlueSEAccessProtocol/GlueSEAccessProtocolEndpoint=gsiftp://$ftp_fqdn:$ftpport ($ftpport is usually 2811)
GlueSEAccessProtocol/GlueSEAccessProtocolVersion=x.y.z formatted version (use 1.0.0, or 2.0.0 for gridftp2)
GlueSEAccessProtocol/GlueSEAccessProtocolSupportedSecurity=gsi
GlueSEAccessProtocol/ GlueChunkKey=$(value of GlueSEUniqueID)

C) one GlueSEControlProtocol for each srm protocol
GlueSEControlProtocol/GlueSEControlProtocolType=SRM
GlueSEControlProtocol/GlueSEControlProtocolVersion=x.y.z formatted version (for srm v2.2, have one complete GlueSEControlProtocol with 1.1.0, and another with 2.2.0)
GlueSEControlProtocol/GlueSEControlProtocolLocalID=srm_v$srmver (srmver=x.y from value of ControlProtocolVersion)
GlueSEControlProtocol/GlueSEControlProtocolEndpoint=httpg://$se_fqdn:$se_port/srm/managerv$x ( dCache example. $se_port is usually 8443. $x=x from value of ControlProtocolVersion)
GlueSEControlProtocol/ GlueChunkKey=$(value of GlueSEUniqueID)

D) one GlueSA for each storage area (for backwards compatibility, one GlueSA for each vo subdirectory that is defined)
GlueSA/GlueSALocalID=$areaname (Conventionally, $areaname=$area_handle:$(value of GlueSARetentionPolicy):$(value of GlueSAAccessLatency))
GlueSA/GlueSAPath=/pnfs/$se_domain/$area_directory (dCache example; for any implementation, should be full path. For backwards compatibility, should be /pnfs/$se_domain/$area_directory/$vo_subdirectory if $vo_subdirectory is defined) 
GlueSA/GlueSAPolicyFileLifeTime=permanent
GlueSAStateAvailableSpace: $total_area (KB)
GlueSAStateUsedSpace: $used_area  (KB)
GlueSA/GlueSAAccessControlBase.Rule=$VO1
GlueSA/GlueSAAccessControlBase.Rule=VO:$VO1 (to satisfy new ACBR convention)
...
GlueSARetentionPolicy: replica (or custodial if tape-backed)
GlueSAAccessLatency: online ( or nearline if tape-backed)
GlueSAExpirationMode: neverExpire
GlueSATotalOnlineSize: $total_disk_in_area (GB)
GlueSAUsedOnlineSize: $used_disk_in_area (GB)
GlueSAFreeOnlineSize: $(value of GlueSATotalOnlineSize) - $(value of GlueSAUsedOnlineSize)
GlueSAReservedOnlineSize: $reserved_disk_in_area (GB)
GlueSATotalNearlineSize: $total_tape_in_area (GB)
GlueSAUsedNearlineSize: $used_tape_in_area (GB)
GlueSAFreeNearlineSize: $(value of GlueSATotalNearlineSize) - $(value of GlueSAUsedNearlineSize)
GlueSAReservedNearlineSize: $reserved_tape_in_area (GB)
GlueChunkKey: GlueSEUniqueID=$(value of GlueSEUniqueID)

E) Zero or more GlueVOInfo under each GlueSA, for the purpose of publishing space tokens
GlueVOInfo/GlueVOInfoLocalID=$voinfoname
GlueVOInfo/GlueVOInfoName=$voinfoname (Conventionally, $voinfoname = $voinfo_handle(should refer to the role of an authorized user):$(value of GlueVOInfoTag))
GlueVOInfo/GlueVOInfoPath=/pnfs/$se_domain/$area_directory/$vo_subdirectory (dCache example. Overrides GlueSAPath. For backwards compatibility, must equal $(value of SAPath) when any of $VO1, $VO2, $VO3, ... also satisfy any GlueSAAccessControlBase.Rule)
GlueVOInfo/GlueVOInfoTag=$space_token_description
GlueVOInfo/GlueVOInfoAccessControlBase.Rule=VO:$VO1 (or VOMS:/$group/Role=$role if using roles and VOMS authorization)
GlueVOInfo/GlueVOInfoAccessControlBase.Rule=VO:$VO2
GlueVOInfo/GlueVOInfoAccessControlBase.Rule=VO:$VO3
... 
GlueChunkKey: GlueSEUniqueID=$(value of GlueSEUniqueID)

</verbatim>
-- Main.TedHesselroth - 25 Oct 2007