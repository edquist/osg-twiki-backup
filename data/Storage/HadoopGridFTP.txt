%META:TOPICINFO{author="WillMaier" date="1237475444" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="Hadoop"}%
---+!! *<noop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%


---+    Prerequisites

The GridFTP server for HDFS is based upon the stock Globus server
with a new loadable module to interact with Hadoop.

Make sure that the =xinetd= RPM is installed on your system.

The installation process is based on
[[ReleaseDocumentation.PacmanBestPractices][Pacman]]; 
see the [[ReleaseDocumentation.WebHome][release documentation]] for
help on [[ReleaseDocumentation.PacmanInstall][installing Pacman]] if
you do not have it already.

Now, create your install directory; we will refer to this as
=$VDT_LOCATION= in this documentation.

---+    Installation

The installation is relatively automatic.  If your site uses GUMS,

<verbatim>
cd $VDT_LOCATION
echo "http://t2.unl.edu/store/cache" > trusted.caches
echo "http://vdt.cs.wisc.edu/vdt_1101_cache" >> trusted.caches
export VDTSETUP_AGREE_TO_LICENSES=y
export VDTSETUP_INSTALL_CERTS=l
export VDTSETUP_CA_CERT_UPDATER=n
export VDTSETUP_ENABLE_BESTMAN=n
export VDTSETUP_ENABLE_ROTATE=n
export VDTSETUP_ENABLE_GRIDFTP=n
export VDTSETUP_EDG_CRL_UPDATE=n
export VDT_GUMS_HOST=<host for your GUMS install>
pacman -get http://t2.unl.edu/store/cache:GridFTP_HDFS
ln -s /etc/grid-security/certificates $VDT_LOCATION/globus/TRUSTED_CA
</verbatim>

If your site does not use GUMS, replace the =VDT_GUMS_HOST= line with

<verbatim>
export VDT_NO_PRIMA=1
</verbatim>

Currently supported platforms include RHEL-4 and RHEL-5, both in
32-bit and 64-bit.

The installation automatically enables the GridFTP server in
=/etc/xinetd.d=. This means that =GridFTP_HDFS= must be installed
using the root account. The GridFTP server uses port 5000 (as
opposed to 2811, the default port).

---+    Configuration
---++    CA Certificates

Please refer to the [[ReleaseDocumentation.WebHome][release documentation]]
for instructions on how to
[[ReleaseDocumentation.ComputeElementPostInstall#Choosing_and_Installing_a_CA_Dis][install the proper CA certificates]].

---++    Authentication

There are two ways to configure authentication:


---+++    PRIMA/GUMS

This approach integrates well with larger sites. First, install the
PRIMA configurations:

<verbatim>
cp $VDT_LOCATION/post-install/*-authz.conf /etc/grid-security
</verbatim>

Then edit the line starting with =imsContact= in =/etc/grid-security/prima-authz.conf= 
to point to your GUMS installation.


---+++    grid-mapfile

This approach is not recommended.

Create =/etc/grid-security/grid-mapfile=. For each user at your
site, add a line to the file mapping the user's DN to their user
name:

<verbatim>
"<DN>" <user>
</verbatim>

For example:

<verbatim>
"/DC=org/DC=doegrids/OU=People/CN=Will Maier 286302" osg_uscms01
</verbatim>

---++    HDFS

Unfortunately, GridFTP-HDFS does not yet integrate naturally into
the Hadoop configuration system.  You must specify the following
environment variables for the GridFTP server:

   $ =VDT_GRIDFTP_HDFS_REPLICAS=: integer number of replicas for each saved file (default: =3=).
   $ =VDT_GRIDFTP_HDFS_NAMENODE=: hostname of the Hadoop namenode (default: =hadoop-name=).
   $ =VDT_GRIDFTP_HDFS_PORT: port number of the Hadoop namenode (default: =9000=).
   $ =VDT_GRIDFTP_HDFS_MOUNT_POINT: FUSE mount point on the SRM node (default: =/mnt/hadoop=). This
     allows the GridFTP server to convert from SRM filenames (which include the
     FUSE mount path) and the native Hadoop filenames (which do not include the
     FUSE mount path).
   $ =VDT_GRIDFTP_LOAD_LIMIT: maximum number of active transfers (default:
     =20=). If the system load is above this integer value, then the gridftp
     server will accept new transfers, but not allow them to actually start
     movement.

In order to set these variables, you can export the variables appropriately in
the files =$VDT_LOCATION/vdt/etc/vdt-local-setup.sh= and
=$VDT_LOCATION/vdt/etc/vdt-local-setup.csh=.

---++    Add to SRM

Any [[HadoopSRM][BestMan SRM]] server must be told of the location of the new
GridFTP server before it can use it. Add this new server to the =bestman.rc= of
the SRM server and restart the server.

---++    Enable Gratia Probe

See the [[HadoopGratia][Gratia probe installation instructions]] for more information.

---+    Running the server

Now, simply turn on the server:

<verbatim>
vdt-control --enable gridftp-hdfs
vdt-control --enable vdt-rotate-logs # DO NOT FORGET THIS ONE!
vdt-control --on
</verbatim>

Make sure you turn on log rotation.

-- Main.WillMaier - 19 Mar 2009
