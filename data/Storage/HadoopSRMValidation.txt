%META:TOPICINFO{author="TedHesselroth" date="1270499351" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="Hadoop"}%
---+!! *<noop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

---++ Reading files from SRM

Testing a SRM endpoint is fairly straight forward. You'll need to know the SE path endpoint on the hadoop door and you'll have to have a valid gridcert that is permitted to move files in and out of your site.

First generate a proxy certificate with grid-proxy-init or voms-proxy-init.  Now attempt to pull from your srm door. The command will look something like:

<verbatim>
# srmcp -2 -debug srm://cit-se2.ultralight.org:8443/srm/v2/server?SFN=/mnt/hadoop/junk.txt file:////tmp/junk.txt
[some debug output omitted]
Tue Aug 18 22:42:11 PDT 2009: starting SRMGetClient
Tue Aug 18 22:42:11 PDT 2009: In SRMClient ExpectedName: host
Tue Aug 18 22:42:11 PDT 2009: SRMClient(https,srm/managerv2,true)
SRMClientV2 : user credentials are: /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=dkcira/CN=655958/CN=Dorian Kcira
SRMClientV2 : WEBSERVICE_PATH srm/managerv2
SRMClientV2 : connecting to srm at httpg://cithep250.ultralight.org:8443/srm/v2/server
copy_jobs is empty
Tue Aug 18 22:42:12 PDT 2009: calling srmPrepareToGet
SRMClientV2 :  srmPrepareToGet, contacting service httpg://cithep250.ultralight.org:8443/srm/v2/server
Tue Aug 18 22:42:13 PDT 2009: received responce
Tue Aug 18 22:42:13 PDT 2009:  srm returned requestToken = get:1318
copy_jobs is not empty
copying CopyJob, source = gsiftp://cithep230.ultralight.org:2811//mnt/hadoop/junk.txt destination = file:////tmp/junk.txt
GridftpClient: memory buffer size is set to 1048576
GridftpClient: tcp buffer size is set to 1048576
GridftpClient: connecting to cithep230.ultralight.org on port 2811
Tue Aug 18 22:42:13 PDT 2009: no more pending transfers, breaking the loop
GridftpClient: gridFTPClient tcp buffer size is set to 1048576
GridftpClient: gridFTPRead started
GridftpClient: set local data channel authentication mode to None
GridftpClient: parallelism: 10
GridftpClient: starting a transfer from /mnt/hadoop/junk.txt
GridftpClient: waiting for completion of transfer
GridftpClient: DiskDataSink.close() called
GridftpClient: gridFTPWrite() wrote 234bytes
GridftpClient: closing client : org.dcache.srm.util.GridftpClient$FnalGridFTPClient@39a2f02e
GridftpClient: closed client
execution of CopyJob, source = gsiftp://cithep230.ultralight.org:2811//mnt/hadoop/junk.txt destination = file:////tmp/junk.txt completed
SRMClientV2 :  srmReleaseFiles, contacting service httpg://cithep250.ultralight.org:8443/srm/v2/server
srmReleaseFilesResponse status code=SRM_SUCCESS
copy_jobs is empty
stopping copier
</verbatim>

The line =srmReleaseFilesResponse status code=SRM_SUCCESS= is your indication that the transfer was successful.  You should manually check the contents of the local file =/tmp/junk.txt= and verify that the contents are correct.

---++ Writing files to SRM

To write files to SRM, you must first generate a proxy certificate with grid-proxy-init or voms-proxy-init.  Now attempt to write to your srm door. The command will look something like:

<verbatim>
# srmcp -2 -debug file:////tmp/junk.txt srm://cit-se2.ultralight.org:8443/srm/v2/server?SFN=/mnt/hadoop/store/user/wart/junk.txt
[some debug output omitted]
Tue Aug 18 22:45:20 PDT 2009: starting SRMPutClient
Tue Aug 18 22:45:20 PDT 2009: In SRMClient ExpectedName: host
Tue Aug 18 22:45:20 PDT 2009: SRMClient(https,srm/managerv2,true)
SRMClientV2 : user credentials are: /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=dkcira/CN=655958/CN=Dorian Kcira
SRMClientV2 : WEBSERVICE_PATH srm/managerv2
SRMClientV2 : connecting to srm at httpg://cithep250.ultralight.org:8443/srm/v2/server
copy_jobs is empty
SRMClientV2 :  srmPrepareToPut, contacting service httpg://cithep250.ultralight.org:8443/srm/v2/server
Tue Aug 18 22:45:21 PDT 2009:  srm returned requestToken = put:1351
Tue Aug 18 22:45:21 PDT 2009: no more pending transfers, breaking the loop
copy_jobs is not empty
copying CopyJob, source = file:////tmp/junk.txt destination = gsiftp://cithep230.ultralight.org:2811//mnt/hadoop/store/user/wart/junk.txt
GridftpClient: memory buffer size is set to 1048576
GridftpClient: tcp buffer size is set to 1048576
GridftpClient: connecting to cithep230.ultralight.org on port 2811
GridftpClient: gridFTPClient tcp buffer size is set to 1048576
GridftpClient: gridFTPWrite started, source file is java.io.RandomAccessFile@307b4703 destination path is /mnt/hadoop/store/user/wart/junk.txt
GridftpClient: gridFTPWrite started, destination path is /mnt/hadoop/store/user/wart/junk.txt
GridftpClient: set local data channel authentication mode to None
GridftpClient: parallelism: 10
GridftpClient: adler32 for file java.io.RandomAccessFile@307b4703 is 3cec4db3
GridftpClient: Was not able to send checksum value:org.globus.ftp.exception.ServerException: Server refused performing the request. Custom message:  (error code 1) [Nested exception message:  Custom message: Unexpected reply: 500 Invalid command.] [Nested exception is org.globus.ftp.exception.UnexpectedReplyCodeException:  Custom message: Unexpected reply: 500 Invalid command.]
GridftpClient: waiting for completion of transfer
GridftpClient: starting a transfer to /mnt/hadoop/store/user/wart/junk.txt
GridftpClient: DiskDataSink.close() called
GridftpClient: gridFTPWrite() wrote 234bytes
GridftpClient: closing client : org.dcache.srm.util.GridftpClient$FnalGridFTPClient@168e4805
GridftpClient: closed client
execution of CopyJob, source = file:////tmp/junk.txt destination = gsiftp://cithep230.ultralight.org:2811//mnt/hadoop/store/user/wart/junk.txt completed
srmPutDone status code=SRM_SUCCESS
copy_jobs is empty
stopping copier
</verbatim>

The line =srmReleaseFilesResponse status code=SRM_SUCCESS= is your indication that the transfer was successful.  You should manually check the contents or checksum of the file in hdfs and verify that the contents are correct.

-- Main.MichaelThomas - 19 Aug 2009

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = BrianBockelman

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = Storage

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Installation
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %NO%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %NO%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %NO%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %NO%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %YES%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = FirstName
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %NO%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = FirstLast
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %NO%
############################################################################################################
-->