%META:TOPICINFO{author="TedHesselroth" date="1194370500" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="DCache18Preview"}%
There is a page on the srm twiki at https://srm.fnal.gov/twiki/bin/view/SrmProject/SrmSpaceReservation, and in the dCache bood at http://www.dcache.org/manuals/Book/dCacheBook.html#cf-srm-space-ac.

---++++++ dCacheSetup

See the parent topic for enabling space reservation in SRM-dCache.

---++++++ <nop>PoolManager.conf

Link groups for custodial and volatile must be set up in [[PoolManager][PoolManager.conf]]. It is sufficient for testing to have all pools be custodial by defaul.

---++++++ srm-reserve-space

With no pools explicity linked to the volatile link group (as above), this reservation will succeed, but transfers will actually fail with a "no space available" message.

<verbatim>
 /opt/d-cache/srm/bin/srm-reserve-space -desired_size=1000000 -guaranteed_size=1000000 -retention_policy=REPLICA -space_desc=tedsmillion srm://testsrmserver.fnal.gov:8443
</verbatim>

The correct value for retention_policy in this case is CUSTODIAL.

<verbatim>
 /opt/d-cache/srm/bin/srm-reserve-space -desired_size=1000000 -guaranteed_size=1000000 -retention_policy=CUSTODIAL -space_desc=tedsmillion srm://testsrmserver.fnal.gov:8443
</verbatim>

You will see the token in the output

<verbatim>
Space token =18
</verbatim>

---++++++ srmcp

The token is used in srmcp. Even then, if the client (srmcp) specifies -retention_policy=REPLICA on the srmcp command line, the transfer will fail for the same reason. 

<verbatim>
/opt/d-cache/srm/bin/srmcp -retry_num=0 -srm_protocol_version=2 -space_token=18 \
file:////tmp/testfile srm://testsrmserver.fnal.gov:8443/pnfs/fnal.gov/data/test1
</verbatim>

Note: if the client specifies retention_policy=REPLICA on the command line,

<verbatim>
/opt/d-cache/srm/bin/srmcp -retry_num=0 -srm_protocol_version=2 -retention_policy=REPLICA -space_token=18 \
file:////tmp/testfile srm://testsrmserver.fnal.gov:8443/pnfs/fnal.gov/data/test1
</verbatim>

The option will be ignored and the file will be written to the custodial pool group.

-- Main.TedHesselroth - 17 Apr 2007
