%META:TOPICINFO{author="TedHesselroth" date="1194996376" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="DCache18Preview"}%
---+++ Configuration of Storage Elements for Opportunistic Use

---++++ Introduction

The general requirements for a storage element supporting opportunistic use are

   * Only a portion of the total storage is made available.
   * The amount of storage made available for opportunistic use may be specified.
   * A capability of specifying a portion of the total storage for opportunistic use.
   * Allowing particular VOs and Roles a privilege to use space other than opportunistic storage.
   * Files created through opportunistic use shall not be permanently available in the storage system.

---++++ Procedure for dCache 1.8 with SRM 2.2

SRM 2.2 supports [[space reservation][SpaceReservation]]. A storage site administrator may configure the site for opportunistic use through space reservation. In SRM-dCache 1.8 the creation of space reservations is controlled by use use of link groups. The site administrator may assign storage pools to link groups. This shall be the basis of dividing the storage; certain pools are designated for opportunistic use.

Here are the operations that are performed to enable opportunistic use of storage. Note that explicit authorization of privileged VOs is also necesary in order to prohibit opportunistic access.

---+++++ Modification of <nop>PoolManager configuration

Please start from the [[PoolManager][PoolManager.conf]] file described in the SpaceReservation topic.

1. In the file PoolManager.conf add the following lines for 

<verbatim>
psu create unit -store  public:osg@osm
</verbatim>

2. Add lines to create a unit group and add the new unit to it

<verbatim>
psu create ugroup community-store
psu addto ugroup community-store public:osg@osm
</verbatim>

3. Determine which pools shall be designated for opportunistic use.  Add a line for each of these pools. The names to use are the ones used internally by dCache. See the dCache documentation for how to determine the correct pool names.

<verbatim>
psu create pool poolnode1_1
psu create pool poolnode1_2
psu create pool poolnode2_1
psu create pool poolnode2_2
psu create pool poolnode3_2
psu create pool poolnode3_2
</verbatim>

4. Create a pool group for opportunistic use and add the pools to it.

<verbatim>
psu create pgroup opportunistic
psu addto pgroup opportunistic poolnode1_1
psu addto pgroup opportunistic poolnode1_2
psu addto pgroup opportunistic poolnode2_1
psu addto pgroup opportunistic poolnode2_2
psu addto pgroup opportunistic poolnode3_1
psu addto pgroup opportunistic poolnode3_2
</verbatim>

-- Main.TedHesselroth - 13 Nov 2007
