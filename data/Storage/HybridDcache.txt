%META:TOPICINFO{author="PrestonSmith" date="1176384929" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="StorageForum"}%



d36 5
-- Main.PrestonSmith - 12 Apr 2007

Following is how Purdue is set up mixing resilient and non-resilient pools. We don't (currently) have a hard partioning in place to select writing to resilient vs non-resilient space explicitly.


---++ Define Pool Groups

*Edit /opt/d-cache/config/PoolManager.conf (or use the admin interface and 'save')*
<verbatim>
psu create pgroup ResilientPools
psu addto pgroup ResilientPools cms-055_2
psu addto pgroup ResilientPools cms-031_1
etc...

psu create pgroup default
psu addto pgroup default dcache-02_5
psu addto pgroup default dcache-03_3
psu addto pgroup default dcache-00_3
etc..
</verbatim>

---++ Set up links and a section 
<verbatim>
psu create link default-link any-protocol any-store world-net
psu set link default-link -readpref=10 -writepref=10 -cachepref=10 -p2ppref=-1
psu add link default-link default
psu create link Resilient-link any-protocol any-store world-net
psu set link Resilient-link -readpref=10 -writepref=10 -cachepref=0 -p2ppref=20 -section=Resilient-section
psu add link Resilient-link ResilientPools

pm set Resilient-section  -cpucostfactor=0.0 -spacecostfactor=0.0
pm set Resilient-section  -idle=0.0 -p2p=2.0 -alert=0.0 -halt=0.0 -fallback=0.0
pm set Resilient-section  -p2p-allowed
pm set Resilient-section  -stage-allowed=false
pm set Resilient-section  -max-copies=500
pm st Resilient-section  -cpucostfactor=0.0 -spacecostfactor=0.0
pm st Resilient-section  -idle=0.0 -p2p=2.0 -alert=0.0 -halt=0.0 -fallback=0.0
pm st Resilient-section  -p2p-allowed
pm st Resilient-section  -stage-allowed=false
pm st Resilient-section  -max-copies=500
</verbatim>

   * The section funcationality is explained in  the [[http://www.dcache.org/manuals/Book/cf-partitioning.shtml][relevent chapter from The Book]]
   * We use it to let us do an essentially random pool selection (costs of 0.0) in our resilient pools

---++ Change replica manager to only replicate within your resilient pool group
*Edit dCacheSetup:*

   * edit the line with =resilientGroupName=*=. and change the "*" to the name of your resilient pool group
      * =resilientGroupName=ResilientPools=
   * Restart replicaManager

%META:TOPICMOVED{by="PrestonSmith" date="1176384929" from="Storage.RunningWithBothResilientAndNon-resilientPools" to="Storage.HybridDcache"}%
