%META:TOPICINFO{author="TedHesselroth" date="1210353133" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="DCache18Preview"}%
---+++ Configuration of Storage Elements for Replica Management

---+++++ Modification of the Storage Element Configuration

Please start from the [[PoolManager][PoolManager.conf]] file described in the SpaceReservation topic. This file is installed through the VDT packeage for dCache unless the install is an upgrade from a previous dCache version.

1. Determine which pools shall be designated for the "resilient" portion of the storage system.  In [[PoolManager][PoolManager.conf]], add a line for each of these pools. The names to use are the ones used internally by dCache. See the dCache documentation for how to determine the correct pool names.

<verbatim>
psu create pool pool1_1
psu create pool pool1_2
psu create pool pool2_1
psu create pool pool2_2
psu create pool pool3_2
psu create pool pool3_2
</verbatim>

2. Find the pool group for replica manager use, make sure it is uncommented out, and add the pools to it. If the name "ResilientPools" is not used, modify the line for resilientGroupName in config/dCacheSetup.

<verbatim>
psu create pgroup ResilientPools
psu addto pgroup ResilientPools pool1_1
psu addto pgroup ResilientPools pool1_2
psu addto pgroup ResilientPools pool2_1
psu addto pgroup ResilientPools pool2_2
psu addto pgroup ResilientPools pool3_1
psu addto pgroup ResilientPools pool3_2
</verbatim>

3. Verify that there is a link that includes this pool group.

<verbatim>
# resilient - will not be linkGrouped
psu create link resilient-link any-store world-net any-protocol
psu set link resilient-link -readpref=10 -writepref=10 -cachepref=10 -p2ppref=-1
psu add link resilient-link ResilientPools
</verbatim>

Save the [[ResilientPoolManager][new PoolManager.conf]]. 

4. Load the new rules into the <nop>PoolManager and for good measure (in case additional customizations were made) update the link groups in <nop>SrmSpaceManager.

<verbatim>
$ ssh -l admin -c blowfish -p 22223 localhost
admin@localhost's password: 

    dCache Admin (VII) (user=admin)


(local) admin > cd PoolManager
(PoolManager) admin > reload -yes
(PoolManager) admin > ..
(local) admin > cd SrmSpaceManager@srm-oursiteDomain
(SrmSpaceManager@srm-cd-oursiteDomain) admin > update link groups
update started
(SrmSpaceManager@srm-oursiteDomain) admin > 

</verbatim>

6. Check that the rules were loaded into the <nop>PoolManager.

<verbatim>
(PoolManager) admin > psu dump setup 
#
# Printed by diskCacheV111.poolManager.PoolSelectionUnitV2 at Wed Nov 14 09:56:54 CST 2007
#
#
#
# The units ...
#
psu create unit -net    0.0.0.0/255.255.255.255
psu create unit -net    0.0.0.0/0.0.0.0
psu create unit -store  *@*
psu create unit -protocol */*
#
...
</verbatim>

The settings shown may vary if you have made other customizations to PoolManager.conf.





-- Main.TedHesselroth - 09 May 2008
