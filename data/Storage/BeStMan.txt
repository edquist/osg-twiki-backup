%META:TOPICINFO{author="KyleGross" date="1225985966" format="1.1" version="1.16"}%
%META:TOPICPARENT{name="StorageForum"}%
---++ Berkeley Storage Manager (!BeStMan) SRM v2.2 status

!BeStMan is an implementation of SRM v2.2, developed by Lawrence Berkeley National Laboratory, for a small disk based storage and mass storage systems such as HPSS. End users may have their own personal !BeStMan that manages and gives an SRM interface to their local disks. It works on top of existing disk-based unix file system, and has been reported so far to work on file systems such as NFS, GPFS, PVFS, AFS, GFS, NGFS, HFS+, Hadoop, !XrootdFS and Lustre. It also works with any existing file transfer service, such as gsiftp, http, https, bbftp and ftp. It requires the minimal administrative efforts on the deployment and updates. If storage spans on multiple file systems and storage systems, [[ReleaseDocumentation.DCache][SRM/dCache]] should be considered.

---+++ News
   * 10-9-2008 !BeStMan 2.2.1.1.r6 is released.
   * 8-19-2008 !BeStMan 2.2.1.0 is released with !BeStMan gateway mode (formerly bestman-xrootd) combined with full management mode.
   * 5-16-2008 !BeStMan 2.2.0.10 is released with features including GUMS/VirtualOrganizations/VOInfoMS FQAN support.
   * 2-15-2008 !BeStMan 2.2.0.8 is released.
   * 1-24-2008 !BeStMan 2.2.0.6 is released.
   * 12-?-2007 !BeStMan 2.2.0.5 is released.
   * 11-1-2007 !BeStMan 2.2.0.4 is released.

---+++ Links

   * [[http://datagrid.lbl.gov/bestman][Downloadables and instructions]]
   * [[http://datagrid.lbl.gov/bestman/bestman-manual.html][BeStMan Manual]]
   * [[http://datagrid.lbl.gov/bestman/docs/bestman-faq.html][BeStMan FAQ]]
   * [[ReleaseDocumentation/Bestman][OSG release documentation]]
   * [[http://vdt.cs.wisc.edu/vdt_181_cache/Bestman.pacman][BeStMan pacman from VDT 1.8.1]]
   * [[SRMv2Client][SRM v2.2 LBNL client command line examples]]

---+++ Topics

   * <a href="#installation_info">Installation information</a>
   * <a href="#server_control">Server Control</a>
   * <a href="#sample_client">Sample Client Commands</a>
   * <a href="#validation">Validation</a>
   * <a href="#integ_info_sys">Integration with the Information System</a>
   * <a href="#storage_usage">Storage Usage in !BeStMan</a>

---+++ Support
   * email to srm@lbl.gov

---+++ Details on Topics
   * <a name="installation_info"><b>Installation information</b></a>
      * [[http://vdt.cs.wisc.edu][VDT]] provides a package for installing !BeStMan, using pacman. 
      * Manual installation is possible after downloading !BeStMan from [[http://datagrid.lbl.gov/bestman][http://datagrid.lbl.gov/bestman]], and run configure.
      * <b>Preparation for manual installation</b>
         * Grid service certificate
            * e.g. /DC=org/DC=doegrids/OU=Services/CN=srmtest/myhost.lbl.gov
            *       /home/srm/osgdemo/srmtestcert.pem 
            *       /home/srm/osgdemo/srmtestkey.pem
         * !GridFTP server hostname, port number
            * e.g. dmx09.lbl.gov
         * GLOBUS_TCP_PORT_RANGE
            * e.g. GLOBUS_TCP_PORT_RANGE=6201,6299
         * Two open port numbers to be assigned to !BeStMan
            * e.g. http=6249, https=6250
         * Local disk path and size information to be managed by !BeStMan
            * e.g. /data/osgdemo/data : 20000MB
         * log file path information for !BeStMan (recommended using different disk partition from the cache)
            * e.g. /data/osgdemo/log
         * Java 1.5.0_x installation path
            * e.g. /sandbox/jdk1.5.0_12
         * !BeStMan installation directory
            * e.g. /data/osg/bestman
      * <b>Manual configuration</b>
         * Note that srmcache keyword is on by default since v2.2.0.6 to have user controlled disk space can be accessible through SRM interface. If not wanted, you can disable by providing -disable-srmcache-keyword or edit conf/bestman.rc for srmcacheKeywordOn=false.
         * e.g. based on the above sample information
configure \ %BR%
--with-replica-storage-path=/data/osgdemo/data \ %BR%
--with-replica-storage-size=20000 \ %BR%
--with-http-port=6249 \ %BR%
--with-https-port=6250 \ %BR%
--with-globus-tcp-port-range=6201,6299 \ %BR%
--with-certfile-path=/home/srm/osgdemo/srmtestcert.pem \ %BR%
--with-keyfile-path=/home/srm/osgdemo/srmtestkey.pem \ %BR%
--with-eventlog-path=/data/osgdemo/log \ %BR%
--with-cachelog-path=/data/osgdemo/log %BR%

   * <a name="server_control"><b>Server control</b></a>
      * to Start the !BeStMan server, in $SRM_HOME/sbin
         * SXXbestman start  or SXXbestman.personal start
      * to Stop the !BeStMan server, in $SRM_HOME/sbin
         * SXXbestman stop  or SXXbestman.personal stop
      * Or manually
         * e.g. nohup $SRM_HOME/sbin/bestman.server >& /tmp/bestman-.log 2>&1 &
   * <a name="sample_client"><b>Sample client runs (or [[SRMv2Client][more SRM v2.2 client command line examples]])</b></a>
      * Assuming that SRM_HOME=/data/osgdemo/bestman with above sample configuration
         * ping
            * $SRM_HOME/bin/srm-ping srm://osp4.lbl.gov:8443/srm/v2/server
         * put
            * $SRM_HOME/bin/srm-copy file:////tmp/test.data srm://osp4.lbl.gov:8443/srm/v2/server\?SFN=/srmcache/~/osg.test.data
         * ls
            * $SRM_HOME/bin/srm-ls srm://osp4.lbl.gov:8443/srm/v2/server\?SFN=/srmcache/~/osg.test.data
         * get
            * $SRM_HOME/bin/srm-copy srm://osp4.lbl.gov:8443/srm/v2/server\?SFN=/srmcache/~/osg.test.data file:////tmp/osg.data
         * rm
            * $SRM_HOME/bin/srm-rm srm://osp4.lbl.gov:8443/srm/v2/server\?SFN=/srmcache/~/osg.test.data
         * mkdir
            * $SRM_HOME/bin/srm-mkdir srm://osp4.lbl.gov:8443/srm/v2/server\?SFN=/srmcache/~/osg.test.dir
         * rmdir
            * $SRM_HOME/bin/srm-rmdir srm://osp4.lbl.gov:8443/srm/v2/server\?SFN=/srmcache/~/osg.test.dir
         * space reservation
            * $SRM_HOME/bin/srm-sp-reserve -serviceurl srm://osp4.lbl.gov:8443/srm/v2/server -size 1000 -gsize 900 -lifetime 900
            * Or, $SRM_HOME/bin/srm-space -reserve -serviceurl srm://osp4.lbl.gov:8443/srm/v2/server -size 1000 -gsize 900 -lifetime 900
         * space update
            * $SRM_HOME/bin/srm-sp-update -serviceurl srm://osp4.lbl.gov:8443/srm/v2/server -size 5000 -gsize 4000 -lifetime 300 -spacetoken V.10
            * Or, $SRM_HOME/bin/srm-space -serviceurl srm://osp4.lbl.gov:8443/srm/v2/server -size 5000 -gsize 4000 -lifetime 300 -update V.10 
         * space tokens retrieval
            * $SRM_HOME/bin/srm-sp-tokens -serviceurl srm://osp4.lbl.gov:8443/srm/v2/server
            * Or, $SRM_HOME/bin/srm-space -serviceurl srm://osp4.lbl.gov:8443/srm/v2/server -getspacetoken
         * space information retrieval
            * $SRM_HOME/bin/srm-sp-info -serviceurl srm://osp4.lbl.gov:8443/srm/v2/server -spacetoken V.10
            * Or, $SRM_HOME/bin/srm-space -serviceurl srm://osp4.lbl.gov:8443/srm/v2/server -getspacetokenmeta V.10
         * put operation with the reserved space
            * $SRM_HOME/bin/srm-copy file:////tmp/test.data srm://osp4.lbl.gov:8443/srm/v2/server\?SFN=/srmcache/~/osg.test2.data -spacetoken V.10
         * purge an SURL in the reserved space
            * $SRM_HOME/bin/srm-sp-purge -serviceurl srm://osp4.lbl.gov:8443/srm/v2/server -s "srm://osp4.lbl.gov:8443/srm/v2/server?SFN=/srmcache/~/osg.test2.data" -spacetoken V.10 
            * Or, $SRM_HOME/bin/srm-space -serviceurl srm://osp4.lbl.gov:8443/srm/v2/server -s "srm://osp4.lbl.gov:8443/srm/v2/server?SFN=/srmcache/~/osg.test2.data" -purge V.10 
         * space release
            * $SRM_HOME/bin/srm-sp-release -serviceurl srm://osp4.lbl.gov:8443/srm/v2/server -spacetoken V.10
            * Or, $SRM_HOME/bin/srm-space -serviceurl srm://osp4.lbl.gov:8443/srm/v2/server -release V.10

   * <a name="validation"><b>Validation</b></a>
      * A series of testing can be done with [[Storage.SRMTester][srm-tester]]. 
         * Sample command for srm-tester is below.
%BR%
srm-tester \ %BR%
-serviceurl srm://osp4.lbl.gov:8443/srm/v2/server \ %BR%
-op ping,put,get,bringonline,ls,mv,srmrm,gsiftp,mkdir,rmdir,reserve,getspacemeta,getspacetokens,release,gettransferprotocols \ %BR%
-deleteafterput false \ %BR%
-putsource file:////tmp/sourcetest.data \ %BR%
-gettarget file:////tmp/targettest.data \ %BR%
-gsiftpcopysource gsiftp://datagrid.lbl.gov//testdata/S/test.data \ %BR%
-browseafterput \ %BR%
-remotetarget "srm://osp4.lbl.gov:8443/srm/v2/server?SFN=/srmcache/~/srmtest.data" \ %BR%
-browseurl "srm://osp4.lbl.gov:8443/srm/v2/server?SFN=/srmcache/~/srmtest.data" \ %BR%
-getsource "srm://osp4.lbl.gov:8443/srm/v2/server?SFN=/srmcache/~/srmtest.data" \ %BR%
-s "srm://osp4.lbl.gov:8443/srm/v2/server?SFN=/srmcache/~/srmtest.data" \ %BR%
-copytarget "srm://osp4.lbl.gov:8443/srm/v2/server?SFN=/srmcache/~/srmtest2.data" \ %BR%
-mvtarget "srm://osp4.lbl.gov:8443/srm/v2/server?SFN=/srmcache/~/srmtest3.data" \ %BR%
-removeurl "srm://osp4.lbl.gov:8443/srm/v2/server?SFN=/srmcache/~/srmtest3.data" \ %BR%
-dirurl "srm://osp4.lbl.gov:8443/srm/v2/server?SFN=/srmcache/~/srmtest4" \ %BR%
| & tee bestman.test.log

         * Sample command for srm-tester with a parameter input file is below. 
srm-tester -drive -params osp4.properties %BR%
%BR%
% more osp4.properties %BR%
testsites=LBNL %BR%
proxyfile=/tmp/x509up_u9999 %BR%
target=file:////tmp/targettest.data %BR%
putsource=file:////tmp/sourcetest.data %BR%
op=put,get,bringonline,ls,mv,srmrm,gsiftp,mkdir,rmdir,reserve,getspacemeta,getspacetokens,release,gettransferprotocols,getspacetokens %BR%
retrytimeallowed=5 %BR%
gsiftpcopysource=gsiftp://datagrid.lbl.gov//testdata/S/test.data %BR%
pullcopysrm=LBNL@srm://osp4.lbl.gov:8443/srm/v2/server?SFN=/srmcache/~/test.data %BR%
browseafterput=true %BR%
advisorydelete=false %BR%
putoverwrite=LBNL@true %BR%
%BR%

   * <a name="integ_info_sys"><b>Integration with the Information System</b></a>
      * Integration of the SE with the central information systems takes place during the Compute Element installation/configuration. See the topic [[ReleaseDocumentation/GenericInformationProviders][Generic Information Providers]]. The SE does not collect or publish information independently.
   * <a name="storage_usage"><b>[[BeStManStorageUse][Storage Usage in !BeStMan]]</b></a>


---+++ Support
   * email to srm@lbl.gov

%BR%

-- Main.AlexSim - 15 Oct 2008

%META:TOPICMOVED{by="AlexSim" date="1195504143" from="Storage.BeStManStatus" to="Storage.BeStMan"}%
