%META:TOPICINFO{author="JohnWeigand" date="1315337601" format="1.1" reprev="1.6" version="1.6"}%
%META:TOPICPARENT{name="AccountingAndWLCG"}%
---+ Accounting Systems Interoperability Questions And Issues
%TOC%
---++ Introduction
This is where all current questions and issues related to interoperability of the Accounting Systems should be listed.


---++ APEL SSM/ActiveMQ interface
Currently, the Gratia/APEL interface sends the selected Gratia data to WLCG by performing  a direct SQL DML update of a table (OSG_CN_DATA)  in the APEL accounting database.  This will be changing sometime in the future and will be using an SSM/ActiveMQ method to perform this.  There will no longer be any direct access to the APEL database.

This section provides some references/notes/questions on this new interface.

---+++ References
[[https://wiki.egi.eu/wiki/APEL/Server][APEL/Server]]:
This page references a record publisher component which, on the surface, sounds like the capability to retrieve data from APEL.  However, there is no further information about it.%BR%
%BLUE%Will there be the  capability to retrieve data from the APEL database via this new protocol?%ENDCOLOR%

[[https://wiki.egi.eu/wiki/APEL/SSMOverview][SSM Overview]]:
This messaging system will replace the current direct access SQL DML update/access to the APEL database table for OSG (OSG_CN_DATA).

[[https://wiki.egi.eu/wiki/APEL/SSMInstallation][SSM Installation]]

[[https://wiki.egi.eu/wiki/APEL/APELSSMExternalTesting][SSM External Testing]]

[[https://wiki.egi.eu/wiki/APEL/MessageFormat][APEL/SSM Message format]]
 
[[http://activemq.apache.org/python.html][ActiveMQ]]



<a href="./gratia/APEL-SSM-testing.html">APEL-SSM testing (gr7x0)</a>


---+++ Release date
Is there a hard "drop-dead" date when the current direct access to the APEL accounting will no longer be supported?

---+++ [[https://wiki.egi.eu/wiki/APEL/SSMInstallation][SSM Installation]]
This section contains some questions specific to this document.

__Prerequisites__  %BR%
* __certificates__ %BR%
 The documentation in the [[https://wiki.egi.eu/wiki/APEL/SSMInstallation#Certificates][Certificates section of SSM Installation page]] implies a host certificate should be used.%BR%
 %BLUE%Can a service certificate be used?%ENDCOLOR%%BR%

 * __Stomp__ %BR%
This is the client software which communicates with Apache !ActiveMQ (the message broker).%BR%
%BLUE%Where can we find documentation on this package?%BR%
http://packages.python.org/stompy/introduction.html ? %ENDCOLOR%%BR%

* __lcg-CA__ %BR%
We use the OSG CA certificates.%BR%
%BLUE%Will this suffice?%ENDCOLOR%%BR%

__Installation__ %BR%
Have not got this far so no questions at this time%BR%

__Configuration__ %BR%
The last bullet in this section implies that an acknowledgment is performed indicating the success/failure of the communication between the client and consumer.  This implies some level of synchronous communication.%BR%
%BLUE%Is this just at the message level or does this extend to the APEL database update the consumer is performing?%ENDCOLOR%%BR%

__Certificates__ %BR%
This implies a host certificate should be used.  It would be easier to implement if a service certificate could be used as this would facilitate running from multiple hosts as needed.%BR%
%BLUE%Can a service certificate be used?%ENDCOLOR%%BR%

__Running the SSM__ / __Stopping the SSM__ %BR%
Based on the description this sounds like a daemon process that is periodically checking a messages directory for files.%BR%
%BLUE%Is there a plan to allow this to be run from init.d services?%ENDCOLOR%%BR%

---+++ [[https://wiki.egi.eu/wiki/APEL/MessageFormat][APEL SSM message format]]
---++++ Current interface
The approach taken with the current  interface was to keep it as simple as possible allowing for an easy means of correcting changing data in the OSG Gratia accounting system.  On a daily basis, the interface performs:
   * DELETE from OSG_CN_DATA where Month = mm and Year = yy %BR%
     (this removes all interfaced OSG resource group data for the month)
   * INSERT into OSG_CN_DATA (summarized data) where Month = mm and Year = yy. %BR%
     (for all interfaced OSG resource groups) 
   * commit %BR%
     (this is all one atomic transaction)

This approach could be used for the the following reasons:
   * The current Gratia/APEL interface is performed using a direct SQL DML update of the APEL accounting database. 
   * The required  granularity of the APEL/EGI data is monthly summaries by Site,  VO and DN. 
   * The OSG site's data is segregated from other EGI sites by being stored in an OSG specific table (OSG_CN_DATA).  

---++++ New interface









 





---++ *Comments*

%COMMENT{type="tableappend"}%

%META:TOPICMOVED{by="X509_2fDC_3dorg_2fDC_3ddoegrids_2fOU_3dPeople_2fCN_3dKyle_20A_2e_20Gross_20453426" date="1291735203" from="ReleaseDocumentation.AccountingInteropQuestionsAndIssues" to="Interoperability.AccountingInteropQuestionsAndIssues"}%
