%META:TOPICINFO{author="BenClifford" date="1173542631" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="LectureTwoTutorial"}%
<link rel="stylesheet" type="text/css" href="%PUBURL%/%WEB%/WorkshopTutorialModules/exercises.css">

---+!! Using <nop>MyProxy

%TOC%

%STARTINCLUDE%
%EDITTHIS%

A <nop>MyProxy server is running on your local machine and we will use that to see how we can manage your credentials using the <nop>MyProxy Server.

---+++ Loading proxy into <nop>MyProxy Server
This steps creates a proxy on the <nop>MyProxy Server. For this exercise we will use the credentials that were pre-configured for you, so unset environment variables. Also, there is no need for a local proxy at this point, so we remove it.


<pre class="screen">
[train31@gridlab1 ~]$ <userinput>unset X509_USER_PROXY</userinput>
[train31@gridlab1 ~]$ <userinput>grid-proxy-destroy</userinput>
[train31@gridlab1 ~]$ <userinput>grid-proxy-info</userinput>
ERROR: Couldn't find a valid proxy.
Use -debug for further information.
[train31@gridlab1 ~]$ 
[train31@gridlab1 ~]$ <userinput>myproxy-init -s %LOGINHOST%</userinput>
Your identity: /C=US/O=SDSC/OU=SDSC/CN=Account Train31/UID=train31
Enter GRID pass phrase for this identity:
Creating proxy ............................... Done
Proxy Verify OK
Your proxy is valid until: Fri Jun 30 10:34:27 2006
Enter <nop>MyProxy pass phrase:
Verifying - Enter <nop>MyProxy pass phrase:
Verify failure
Error entering passphrase.
[train31 ~]$ <nop>myproxy-init -s %LOGINHOST%
Your identity: /C=US/O=SDSC/OU=SDSC/CN=Account Train31/UID=train31
Enter GRID pass phrase for this identity:
Creating proxy .......................................................... Done
Proxy Verify OK
Your proxy is valid until: Fri Jun 30 10:34:42 2006
Enter <nop>MyProxy pass phrase:
Verifying - Enter <nop>MyProxy pass phrase:
A proxy valid for 168 hours (7.0 days) for user train31 now exists on %LOGINHOST%.
[train31 ~]$ 
</pre>

The first pass phrase is to decrypt your private key.

The second pass phrase is one to protect your login on the <nop>MyProxy server.

A credential exists for you on the server now, but there are no local credentials.

<pre class="screen">
[train31 ~]$ <userinput>grid-proxy-info</userinput>
ERROR: Couldn't find a valid proxy.
Use -debug for further information.
[train31 ~]$ 
</pre>

---+++ Accessing credentials from <nop>MyProxy Server

<pre class="screen">
[train31 ~]$ <userinput>myproxy-logon -s %LOGINHOST%</userinput>
Enter <nop>MyProxy pass phrase:
A credential has been received for user train31 in /tmp/x509up_u539.
[train31 ~]$ 
</pre>

The pass phrase here is the <nop>MyProxy pass phrase, rather than your credential.

A local copy of proxy certificate with lifetime of 12 hours  exists now.

<pre class="screen">
[train31 ~]$ <userinput>grid-proxy-info </userinput>
subject  : /C=US/O=SDSC/OU=SDSC/CN=Account Train31/UID=train31/CN=1046308089/CN=398902167/CN=947386583
issuer   : /C=US/O=SDSC/OU=SDSC/CN=Account Train31/UID=train31/CN=1046308089/CN=398902167
identity : /C=US/O=SDSC/OU=SDSC/CN=Account Train31/UID=train31
type     : Proxy draft (pre-RFC) compliant impersonation proxy
strength : 1024 bits
path     : /tmp/x509up_u539
timeleft : 11:59:42
[train31 ~]$ 
</pre>

---+++ Using credentials from <nop>MyProxy Server for globus-url-copy

<pre class="screen">
[train31 ~]$ <userinput>\rm <nop>myProxyTest </userinput>
[train31 ~]$ <userinput>ls -lt <nop>myProxyTest</userinput>
ls: <nop>myProxyTest: No such file or directory
[train31 ~]$ <userinput>globus-url-copy gsiftp://localhost:2811/home/train31/tempFile gsiftp://localhost:2811/home/train31/myProxyTest</userinput>
[train31 ~]$ <userinput>ls -lt <nop>myProxyTest</userinput>
-rw-r--r--  1 train31 train31 43 Jun 23 10:37 <nop>myProxyTest
[train31 ~]$ <userinput>more <nop>myProxyTest</userinput> 
Temporary file for testing globus-url-copy
[train31 ~]$ 
</pre>



---+++ Using credentials from <nop>MyProxy Server to submit a GRAM job

Try submitting a job (using the GRAM job submission commands that you learned in the introductory module) to run the command '/usr/bin/whoami' using your <nop>MyProxy credentials. You should see that your job returns the name of your user ID.


---+++ Running globusrun-ws from a different machine
Swap machines with your friend. Attempt to run the job from previous step. You should see the login of your friend:

Now download credentials from your <nop>MyProxy Server using your username and password. Next, run the job again. Your username on the <nop>MyProxy server is your login name.

<pre class="screen">
[ranantha ~]$ <userinput>myproxy-logon -s %LOGINHOST% -l train31</userinput>
Enter <nop>MyProxy pass phrase:
A credential has been received for user train31 in /tmp/x509up_u502.
[ranantha ~]$
</pre>

The above overwrites your friend's credntial with yours from <nop>MyProxy server. Attempt running the job now, you should see your own login name, since the credentials are yours.

Remember to destroy your proxy from your friend's machine!

<pre class="screen">
[ranantha@gridlab1 ~]$ <userinput>grid-proxy-destroy </userinput>
[ranantha@gridlab1 ~]$ 
</pre>


---+++ Deleting your credentials from <nop>MyProxy Server

Use =myproxy-destroy= to remove your credentials from the server. You should have valid credentials to do that.

<pre class="screen">
[train31@gridlab1 ~]$ <userinput>myproxy-destroy  -s %LOGINHOST%</userinput>
Default <nop>MyProxy credential for user train31 was successfully removed.
[train31@gridlab1 ~]$
</pre>


%STOPINCLUDE%
<!--                                                                            
      * Set LOGINHOST = gridlab1
      * Set GRIDHOST = tg-login.ncsa.teragrid.org
      * Set OTHERHOST = gridlab2
-->
%BOTTOMMATTER%
-- Main.ForrestChristian - 2007 Jan 29: pulled from original %BR% 