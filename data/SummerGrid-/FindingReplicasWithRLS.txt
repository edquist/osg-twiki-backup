%META:TOPICINFO{author="ForrestChristian" date="1173207878" format="1.1" version="1.3"}%
%META:TOPICPARENT{name="LectureFourTutorial"}%
<link rel="stylesheet" type="text/css" href="%PUBURL%/%WEB%/WorkshopTutorialModules/exercises.css">

---+!! %SPACEOUT{ "%TOPIC%" }%

%TOC%

%STARTINCLUDE%
%EDITTHIS%

The above sections have dealt with moving data around, and always made the assumption that you knew where the files you wanted were located.

Next we will deal with the <firstterm>Replica Location Service (<acronyum>RLS</acronym>)</firstterm>.

---+++Check that we can connect to an RLS server.

<pre class="screen">
$ <userinput>globus-rls-admin -p rls://%LOGINHOST%</userinput>
ping rls://%LOGINHOST%: 0 seconds
</pre>

---+++Querying an RLS server

First perform a simple query for an example logical filename that has been placed in the RLS by the instructors:

<pre class="screen">
$ <userinput>globus-rls-cli rls://%LOGINHOST%</userinput>
rls> <userinput>query lrc lfn example</userinput>
  example: gsiftp://%LOGINHOST%/scratch/example
  example: gsiftp://%OTHERHOST%/scratch/example
</pre>

This queries for a logical filename =example=. The results show that this file can be retrieved via either of two URLs (one in scratch space on %LOGINHOST%, and one in scratch space on %OTHERHOST%).

Now try querying for logical filename =another-example=.

---+++Adding mappings to the RLS

You can also publish your own logical filename into the RLS, with mappings to physical files, using the =create= command:

<pre class="screen">
rls> <userinput>create train30-first-lfn gsiftp://%LOGINHOST%/home/train30/dataex/largefile-train30</userinput>
</pre>

This creates an LFN called =train30-first-lfn= and then adds a mapping to =gsiftp://%LOGINHOST%/home/train30/dataex/largefile-train30=.

%NOTE% This does *NOT* check that the gsiftp URL is valid. If you enter the wrong information here, then RLS will report the wrong information when you later query it.

<pre class="screen">
rls> <userinput>query lrc lfn train30-first-lfn</userinput>
  train30-first-lfn: gsiftp://%LOGINHOST%/home/train30/dataex/largefile-train30
</pre>

Now copy largefile to another place (on another gridlab machine or on one of the remote sites), and
register it into the RLS, with the same LFN. You will need to use the =add= command instead of the =create= command, because the LFN already exists and you just need to add a new mapping.

Get a neighbour to query the RLS for your logical filename, and see that the mappings you have made are public for everyone to see.

---+++Multiple RLS servers

---++++Other LRCs

So far, you have only been using the RLS server on %LOGINHOST%. There are servers running on other machines.

Use =globus-rls-admin= to ping the RLS server on %OTHERHOST% and check that it is online.

Then, connect to one of the other servers using =globus-rls-cli= and query for the =example= LFN that we used above. You should see that there are some other locations from which you can get the example file.

Try adding your own LFN into one of the other servers, using =globus-rls-cli=

---++++RLIs

So far, you have interacted with the Local Replica Catalog on each installation. This is where LFNs and mappings are created.

RLS has another component, called a <span class="firstterm">Replica Location Index</span>. This gathers information from several LRCs, so that you can find LFN mappings from all of those LRCs in one place.

There is an RLI on gridlab1 that gathers information from all of the tutorial LRCs.

You can query it like this:
<pre class="screen">
rls> <userinput>query rli lfn example</userinput>
rls> <userinput>query rli lfn example</userinput>
  example: rls://%LOGINHOST%:39281
</pre>

What comes back from the RLI is *not* a list of physical files. Instead, it is a list of LRCs that have some information about the requested LFN.

To find all the replicas, you need to query all of the listed LRCs in turn. In the above paste, only gridlab1 is listed. During the tutorial, you will hopefully find that other LRCs also know some information about example LFN.

Although it may not happen immediately, the RLIs will also learn about the logical filenames that you have created for yourself.

Query the RLI to see if the logical names that you added above have appeared in the RLI. If they haven't yet, wait a while and try again.

---+++RLS server statistics

Next use the =-S= option to check the status/statistics of each of the two servers. You should see output similar to that below: 

<pre class="programlisting">
$ <userinput>globus-rls-admin -S rls://%LOGINHOST% </userinput>
Version:    2.1.5
Uptime:     00:28:15
LRC stats
  update method: lfnlist
  update method: bloomfilter
  updates bloomfilter: rls://%OTHERHOST%:39281 last 06/21/04 22:44:45
  lfnlist update interval: 86400
  bloomfilter update interval: 900
  numlfn: 1
  numpfn: 1
  nummap: 1
RLI stats
  updated by: rls://%OTHERHOST%:39281 last 06/21/04 22:44:35
  updated via bloomfilters
globus-rls-admin -S rls://gk2
Version:    2.1.5
Uptime:     00:32:33
LRC stats
  update method: lfnlist
  update method: bloomfilter
  updates bloomfilter: rls://%OTHERHOST%:39281 last 06/21/04 22:44:40
  lfnlist update interval: 86400
  bloomfilter update interval: 900
  numlfn: 2
  numpfn: 2
  nummap: 2
RLI stats
  updated by: rls://%OTHERHOST%:39281 last 06/21/04 22:44:49
  updated via bloomfilters
</pre>


<!-- ***  Comments plugin to create comments table for section   ***    -->

      * Set LOGINHOST = gridlab1
      * Set GRIDHOST = tg-login.ncsa.teragrid.org
      * Set OTHERHOST = gridlab2
%COMMENT{ type="tableappend" }%

%ENDMore%
<!-- ***  End Comment                                            ***    -->


%STOPINCLUDE%

<!--                                                                            
      * Set LOGINHOST = workshop1.lac.uic.edu
      * Set LOGINIP = 131.193.181.56
      * Set GRIDHOST = tg-login.sdsc.teragrid.org
      * Set OTHERHOST = workshop2.lac.uic.edu
      * Set CERTSUBJECT = /O=Grid/OU=OSG/CN=Training User 99
      * Set LOGINNAME = train99
      * Set HOMEDIR = /home/%LOGINNAME%
--> 

%BOTTOMMATTER%
-- Main.ForrestChristian - 2007 Jan 29: pulled from original %BR% 
-- Main.ForrestChristian - 24 Mar 2007 - Added VARIABLES  %BR% 