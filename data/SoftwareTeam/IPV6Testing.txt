%META:TOPICINFO{author="EdgarFajardo" date="1405723110" format="1.1" reprev="1.6" version="1.6"}%
---+!! Testing Software with IPV6

%TOC{depth="2"}%

---# About this Document

This document is for the OSG Software team,  to gather information on testing software pieces with IPV6.


This document follows the general OSG documentation conventions: %TWISTY{%TWISTY_OPTS_OUTPUT% showlink="Click to expand document conventions..."}%
%INCLUDE{"Documentation/DocumentationTeam/DocConventions" section="Header"}%
%INCLUDE{"Documentation/DocumentationTeam/DocConventions" section="CommandLine"}%
%ENDTWISTY%

For more information on ipv6 see: [[http://en.wikipedia.org/wiki/IPv6][IPV6]].

---# Requirements

   1 Be familiar with your institute's network policy and firewall configuration
   1 _root_ access is required to configure a host-based firewall using =iptables=

---# Enabling IPV6

The first thing is to determine the IPV6 address of the machine. Like this:

<pre class="screen">
%UCL_PROMPT% nslookup -type=aaaa ipv6vm001.fnal.gov
Server:		132.239.0.252
Address:	132.239.0.252#53

Non-authoritative answer:
ipv6vm001.fnal.gov	has AAAA address 2001:400:2410:29::182
</pre>

Then the IPV6 Default Gateway address is needeed. For this ask your network admin.

Modify the file =/etc/sysconfig/network-scripts/ifcfg-eth0=  and be sure these lines exist, and replace the IPV6 address by your IPV6 address.

<pre class="file">
IPV6INIT=yes
IPV6_AUTOCONF=no
IPV6ADDR="2001:400:2410:29::182"
IPV6_DEFAULTGW="The IPV6 Default Gateway"
</pre>

Then restart the network devices
<pre class="rootscreen">
%UCL_PROMPT_ROOT% service network restart
Shutting down interface eth0:                              [  OK  ]
Shutting down loopback interface:                          [  OK  ]
Bringing up loopback interface:                            [  OK  ]
Bringing up interface eth0:                                [  OK  ]
</pre>

---# Testing ipv6 connectivity

From another machine which already has ipv6 networking capabilities:

<pre class="screen">
%UCL_PROMPT% ping6 ipv6vm001.fnal.gov
PING ipv6vm001.fnal.gov(ipv6vm001.fnal.gov) 56 data bytes
64 bytes from ipv6vm001.fnal.gov: icmp_seq=1 ttl=51 time=68.1 ms
64 bytes from ipv6vm001.fnal.gov: icmp_seq=2 ttl=51 time=57.6 ms
</pre>

And from your own box

<pre class="screen">
[efajardo@ipv6vm001 ~]# ping6 uaf-4.t2.ucsd.edu
PING uaf-4.t2.ucsd.edu(uaf-4.t2.ucsd.edu) 56 data bytes
64 bytes from uaf-4.t2.ucsd.edu: icmp_seq=1 ttl=51 time=57.6 ms
</pre>

Now make sure you can login to your vm over ipv6. Fermilab kerberos still doesn't support it. So add your ssh_key to your machine and make sure this file =/etc/ssh/sshd_config= has this lines

<pre class="file">
RSAAuthentication yes
PubkeyAuthentication yes
</pre>

Now make sure you can access your ssh over ipv6:
<pre class="screen">
efajardo@uaf-4 ~$ ssh -6 root@ipv6vm001.fnal.gov
Last login: Wed Jun 11 14:51:47 2014 from 2607:f720:1700:1b30:21f:c6ff:feeb:2631
[root@ipv6vm001 ~]#  
</pre>


---# Disabling IPv4

Now that you are sure you can log into your box over ipv6. You may want to try over ipv6 only services to do that just comment out the following line in the file =/etc/sysconfig/network-scripts/ifcfg-eth0= 

<pre class="file">
#IPADDR=131.225.41.182 
</pre>

And restart the network services:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% service network restart
</pre>

You can test that you are successful since the ping command will no longer work:

<pre class="screen">
ping ipv6vm001.fnal.gov
PING ipv6vm001.fnal.gov (131.225.41.182): 56 data bytes
Request timeout for icmp_seq 0
Request timeout for icmp_seq 1
</pre>

---# Disabling IPv6

You may want to disable IPv6, to this modify the file 

=/etc/sysconfig/network-scripts/ifcfg-eth0= 

And comment the IPV6 address

<pre class="file">
#IPV6ADDR="2607:f720:1700:1b30::9b" 
</pre>

And restart the network services:
<pre class="rootscreen">
%UCL_PROMPT_ROOT% service network restart
</pre>

You can test that you are successful since the ping command will no longer work:

<pre class="screen">
ping6 ipv6vm001.fnal.gov
Request timeout for icmp_seq 0
Request timeout for icmp_seq 1
</pre>

---# Testing in mix mode

You may want to test in mix mode that services run over IPV6. To do this you can use a tool called NTOP. It is installed in all the test machines and you can access the web interface of it _hostname:3000_ like:

[[http://cabinet-10-10-9.t2.ucsd.edu:3000/][Ntop cabinet-10-10-9]]

Then go to _All Protocols_ -> _Traffic_

You will see something like this:

<img src="https://twiki.opensciencegrid.org/twiki/bin/viewfile/SoftwareTeam/IPV6Testing/Screen_Shot_2014-07-18_at_3.31.07_PM.png" width="800" height=500" border="0" alt="NTP-web" />


With this you can see if the traffic from a defined host is coming in IPv6 (see IPv6 column on the web interface).
---# Enforcing communication over IPv6


If you want to enforce IPv6 over mix mode you can try using directly the IPV6 address for example in xrdcp:

<pre class="screen">
xrdcp -d 1 /tmp/first_test root://[2607:f720:1700:1b30::a4]:1094//tmp/first_test_8
[19B/19B][100%][==================================================][0B/s] 
</pre>

Notice that the IPV6 address in URL follow [[http://www.ietf.org/rfc/rfc2732.txt][RFC2732]].

---# Virtual machines nodes for IPV6 tests



| *Node*| *Owner*|*Last Verified*|
|cabinet-10-10-9.t2.ucsd.edu| Edgar | 14-Jul-2014|
|cabinet-10-10-10.t2.ucsd.edu| Edgar | 14-Jul-2014| 
|ipv6vm001.fnal.gov| Edgar | 14-Jul-2014| 




-- Main.EdgarFajardo - 04 Jun 2014

%META:FILEATTACHMENT{name="Screen_Shot_2014-07-18_at_3.31.07_PM.png" attachment="Screen_Shot_2014-07-18_at_3.31.07_PM.png" attr="" comment="Ntop-Web-Screenshot" date="1405722818" path="Screen Shot 2014-07-18 at 3.31.07 PM.png" size="139292" stream="Screen Shot 2014-07-18 at 3.31.07 PM.png" tmpFilename="/usr/tmp/CGItemp38123" user="EdgarFajardo" version="1"}%
