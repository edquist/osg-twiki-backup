%META:TOPICINFO{author="AlainRoy" date="1328730268" format="1.1" version="1.6"}%
%META:TOPICPARENT{name="Projects"}%
---+ Support for Scientific Linux

---++ Requirements 

USCMS has requested that the OSG Software support the OSG worker node on Scientific Linux 6 in production by the end of February. To be precise:

   * OSG Software: We only need to do the worker node in February, but others portions will be needed soon after.
   * Date: USCMS has only specified "February" as the deadline.
   * Operating system: CMS has only asked for Scientific Linux 6, but we will ensure that it works on !CentOS 6 and Red Hat Enterprise Linux 6 as well. This is because we know there is broad interest in this support across all of OSG. 

---++ Effort & Timeline

This has not yet been estimated. It depends on getting the set of details (below) correct. This is still in progress.

---++ Technical Details 

---+++ Repositories
[[https://jira.opensciencegrid.org/browse/REPO-2][JIRA Ticket]]

Currently our repository at the GOC does not easily support multiple operating systems. We need to change it:

<table>
<tr><td width=50%> *Current layout* </td><td width=50%> *New layout* </td></tr>
<tr valign=top>
<td>
<pre class="file">
+---osg-release
|   |
|   +- i386
|   +- x86_64
|   +- source
|
+---osg-contrib     (i386, x86_64, source)
+---osg-testing     (i386, x86_64, source)
+---osg-development (i386, x86_64, source)
</pre>
</td>
<td>
<pre class="file">
+-- 3.0
    |
    +--el5
    |  |
    |  +-osg-release     (i386, x86_64, source)
    |  +-osg-contrib     (i386, x86_64, source)
    |  +-osg-testing     (i386, x86_64, source)
    |  +-osg-development (i386, x86_64, source)
    +--el6
    |  |
    |  +-osg-release     (i386, x86_64, source)
    |  +-osg-contrib     (i386, x86_64, source)
    |  +-osg-testing     (i386, x86_64, source)
    |  +-osg-development (i386, x86_64, source)
</pre>
</td></tr></table>

To maintain backwards compatibility, we'll make symbolic links for the top-level directories that currently exist (osg-release, etc.) to the 3.0/el5 versions of those directories.

*Important Notes:*
   * This requires cooperation with the GOC to reorganize the repository.
   * This requires us to have a separate osg-release binary RPM per OS (which installs the repository locations), which also requires GOC participation. (To update our symbolic links to the latest version of the =osg-release= RPM.)

---+++ Compatibility between SL5 and SL6 versions

To the best of our knowledge, there is nothing preventing us from keeping the SL5 and SL6 versions completely synchronized. That is, we can use a single .spec file to build RPMs for SL5 and SL6. While there are differences between SL5 and SL6, we believe they are small and can be handled with conditional statements in the spec file. That is statements that allow the RPM to be created differently for SL5 and SL6. ([[RPMDevelopmentGuide#Packaging_for_Multiple_Distro_Ve][Documented elsewhere]])

Once our SL6 support is in production, every time we update an RPM, our general policy will be:
   * Rebuild that RPM for both SL5 and SL6
   * Verify that both SL5 and SL6 repositories contain the same versions of the same RPM
   * Do simultaneous releases on SL5 and SL6

When there are urgent fixes that would be slowed down by this, we will not allow the versions not to be synchronized but we ensure there is a way to report the differences between SL5 and SL6. (Documentation or otherwise.)

---+++ Dist tags

Previously, we added a "dist tag" to every version string for every RPM that we released, so our version can be distinguished from the same software that might exist in another repository. For example, if we rebuilt =lcg-utils-1.2.3-1= from the EPEL repository, we would change the version to =lcg-utils-1.2.1-1%RED%.osg%ENDCOLOR%=. 

We will continue this practice, but we need to distinguish the builds for different OSes as well. (To reduce confusion and due to the need to have separate Name-Version-Releases within Koji.) We will have two dist tags:

   * .osg.el5
   * .osg.el6

El is short for "enterprise linux" and is the generic term for "Red Hat Enterprise Linux", "Scientfic Linux", and "CentOS".

---+++ Build and test infrastructure

We continue to use the Koji software in the UW-Madison hosted Batlab, and have extended it with an SL6 build host.

We have configured Koji to allow SL6 builds. (Creating tags, etc.).

We need to extend our set of test computers (also in the Batlab) to include !CentOS 6 and Red Hat Enterprise Linux 6. (We already have SL6)

We need to do some development of the test infrastructure so we don't send too many emails (one per platform).

---+++ Subversion repository

We will do our development for SL6 changes in a separate branch of the existing Subversion code repository. 

When development is finished, we will merge the SL6 branch into the existing branch. Moving forward, we will have a single branch for SL5 and SL6 work. 

---+++ osg-build

osg-build has been extended to work with SL6 builds.

   * =--el5=: Makes an EL5 build
   * =--el6=: Makes an EL6 build

   * =allbuild= task: Makes koji svn builds for all platforms.

---+++ Other tools

We need a script to check the differences between two repositories, so we can verify that the SL5 and SL6 repositories are synchronized. (Or have acceptable differences)

---+++ To Do

We need to check the dependencies we rely on (from the OS and EPEL) and verify that there are no changes between SL5 and SL6 that require deep reworking of our RPMs or could cause breakage. 