%META:TOPICINFO{author="MatyasSelmeci" date="1359657802" format="1.1" version="1.3"}%
%META:TOPICPARENT{name="InternalDocs"}%
---+!! Non-Root Installs of OSG Client Software (WIP)

%TOC%

---++ Rationale

We currently have a large number of hosts across the osg using the osg client
software installed from pacman or via some other non-rpm mechanism, due to the
requirement that these packages be installable by non-root users.

We must offer an official way of ensuring that these hosts can have up-to-date
versions of the client software. We must do this without creating a separate
distribution, to reduce the maintenance burden. So we should have some way of
leveraging our existing RPMs for this.

Note: in this document, the term "client" includes the worker node client,
since the =osg-wn-client= package is a subset of the =osg-client= package.

---++ Ideas

---+++ Original

   1. Install the client packages, relocated (force-relocated, either with \
      =rpm --badreloc --relocate= or with =yum --installroot=)
   1. Run a script to fix problems caused by this (hard-coded paths, etc.)
   1. Tar up the results

---+++ rpm2cpio

Actually installing the client packages in step 1 of "Original" seems a bit
brittle; we are not sure if we want the post-install scripts to run, for
example. Perhaps we can just extract the files from the rpms instead (via
rpm2cpio) and the run the script and tar up the results.






---++ Issues

It is very important to make creation of the non-root package from an RPM an
automatable process.  It hasn't been decided whether we'll create these
tarballs as part of the release process, or at some earlier time.  Having the
tarballs available even when the software is in testing allows us to test
non-root installs in our nightlies.  Having koji automatically create a
non-root package after a build is a very nice solution, but would take a lot of
effort to implement.

In order to avoid having to solve dependency resolution ourselves, we'll ship
the entire wn-client as one tarball, and the full client as another tarball.