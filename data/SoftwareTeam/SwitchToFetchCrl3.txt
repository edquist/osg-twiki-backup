%META:TOPICINFO{author="MatyasSelmeci" date="1359076877" format="1.1" reprev="1.6" version="1.6"}%
%META:TOPICPARENT{name="InternalDocs"}%
---+!! Proposal to switch to Fetch-CRL 3 on Enterprise Linux 5 systems

%TOC%

Original ticket: [[https://jira.opensciencegrid.org/browse/SOFTWARE-689][SW-689]]

---++ Overview

The version of Fetch-CRL shipped on EL5, =fetch-crl-2.8.5= is old and has some
issues that are not likely to be fixed.  Most notable is the issue that
occasionally blank CRLs will get generated, and will never be replaced by
correct ones even in subsequent runs of =fetch-crl=. (That is the issue
specifically mentioned in the ticket).

Because of this, we are considering switching to version 3 of Fetch-CRL on EL5.
This is not necessary on EL6, because EL6 ships with only version 3 of
Fetch-CRL.

Since there are configuration incompatibilities between version 2 and version 3
that require manual changes, the RPM is called =fetch-crl3= on el5, and can be
installed side-by-side with version 2.

---++ End-user upgrade procedure

The upgrade instructions, which include a config migration table and an example
=fetch-crl3= config file, have moved to
[[Documentation.UpgradeFetchCrl2to3_draft]].

The difficulty of the upgrade should be fairly minor; it depends on how many
configuration changes the sysadmin has made for fetch-crl 2. Furthermore,
because =fetch-crl= and =fetch-crl3= can be installed in parallel, the admin is
not required to run =fetch-crl3= to get up-to-date CRLs -- it is merely
recommended. Therefore, the upgrade can be done on the user's timeframe.

Here are lists of things we will need to examine or change in order to make the
transition from fetch-crl 2 to 3 as painless as possible for the end-user.

---++ Work required for OSG Software team (and others?)

---+++ Package changes

Packages in our SVN that have =fetch-crl= as an explicit dependency:
   * =cms-xrootd=
   * =dcache-gratia-probe=
   * =glite-ce-cream= ( we may not end up shipping this )
   * =osg-gridftp= 
   * =osg-gridftp-hdfs=
   * =osg-gridftp-xrootd=
   * =osg-se-bestman=
   * =osg-se-bestman-xrootd=
   * =osg-se-hadoop= ( and =-gridftp=, =-srm= subpackages )
   * =osg-wn-client=
   * =rsv-metrics= <sup>1</sup>
   * =voms-admin-server=

<sup>1</sup>
=rsv-metrics= says it requires =fetch-crl= but does not run it anywhere, so that dep can be removed.
Looks like it was for an old probe that is no longer used.

RPMs _outside_ of our SVN that have =fetch-crl= as an explicit dependency:
   * =nordugrid-arc-ca-utils= -- provided by EPEL <sup>2</sup>
   
<sup>2</sup> We do not use this package, but we should mention it in the announcement anyway.
A (hopefully) minor problem with this package is that because we do not ship
it, its dependency on =fetch-crl= will not be changed to =fetch-crl3=.

Since =fetch-crl3= does not "provide" the =fetch-crl= dependency, the user will
have to keep both =fetch-crl= and =fetch-crl3= installed as long as they use
=nordugrid-arc-ca-utils= and one of the osg packages mentioned above.


RPMs that have =/usr/sbin/fetch-crl= as a dependency: none

---+++ Software changes

Stuff that can invoke or use (parts of) =fetch-crl= that should be changed to use =fetch-crl3= instead (if that exists):
   * =osg-configure= (=osg_configure.modules.utilities.fetch_crl()=)
   * *DONE* =osg-test= (=test_06_fetch_crl.py=)
   * =osg-ca-manage=, =osg-ca-certs-status= in the =osg-ca-scripts= package (checks if it's enabled and when it was last run)

---+++ Docs changes
Twiki pages to update:
   * Documentation.Release3.InstallBestPractices
   * Documentation.Release3.InstallCertAuth
   * Documentation.Release3.InstallBestmanXrootdSE (install transcript only)
   * Documentation.Release3.InstallGratiaService (install transcript only)
   * Documentation.Release3.InstallGridFtpXrootd (install transcript only)
   * Documentation.Release3.InstallGums
   * Documentation.Release3.InstallHadoopSE
   * Documentation.Release3.InstallOSGBestmanSE (install transcript only)
   * Documentation.Release3.InstallOSGClient
   * Documentation.Release3.InstallRSV
   * Documentation.Release3.InstallVoms
   * Documentation.Release3.InstallWNClient
   * Documentation.Release3.InstallXrootd
   * [[Documentation.Release3.OSGServices]]
   * Documentation.Release3.OsgCaManage
   * <s>Documentation.Release3.RsvPigeonTools</s> (OSG 1.2 only, don't bother)
   * Documentation.Release3.SrmTester
   * Documentation.Release3.UnderstandingComputeElement (note: looks a lot like [[Documentation.Release3.OSGServices]], is one of those two superfluous?)

Pages marked 'install transcript only' have transcripts ("screen dumps") of the output of a full installation procedure.


---+++ Change Plan / Social

   1. Need the blessing of the security group, technology group and production group
   1. Need the upgrade instructions ([[Documentation.UpgradeFetchCrl2to3_draft]]) reviewed and tested
   1. Send a pre-announcement of the change a few weeks in advance;%BR%
      include whether or not this is something to worry about, how much effort migration will take, etc.
   1. Do the release; highlight this change in the release notes and announcement, and link to the upgrade instructions


<!-- vim:ft=twiki
-->
