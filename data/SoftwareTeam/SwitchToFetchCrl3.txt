%META:TOPICINFO{author="TimCartwright" date="1360347278" format="1.1" reprev="1.8" version="1.8"}%
%META:TOPICPARENT{name="Projects"}%
---+!! Project 18: Switch to Fetch CRL 3 on EL 5 Systems

---++ Description

---+++ Background

On Enterprise Linux 5 (el5) systems, the standard version of Fetch CRL is the =fetch-crl-2.8.5= package. It is very old and has some defects that are unlikely to be fixed. Most notable is the issue that blank CRL files are generated occasionally, causing Fetch CRL to issue warnings and never update those CRLs. This issue affects only el5 systems, because el6 systems ship only version 3 of Fetch CRL. Further, el5 systems *do* have access to a standard Fetch CRL v3 package, named =fetch-crl3=.

---+++ Goal

Switch from Fetch CRL version 2 to version 3 on EL 5 systems.

We do not ship Fetch CRL packages, so our effort is focused on changing Fetch CRL dependency declarations in our packages and on supporting the transition, especially through documentation. In particular, the Fetch CRL configuration format and semantics changed from version 2 to 3, requiring manual changes. Fortunately, the Fetch CRL RPMs have different names and non-overlapping file lists, so it is possible (and recommended) to install them side-by-side, make configuration changes, then disable and remove Fetch CRL v2.

---+++ Links

   * [[https://jira.opensciencegrid.org/browse/SOFTWARE-689][SOFTWARE-689]]: (Bug) fetch-crl fails on zero-sized CRLs
   * [[Documentation.UpgradeFetchCrl2to3_draft][Documentation: Upgrade instructions]]
   * [[SwitchToFetchCrl3Details][Technical details]]

---++ Work required for OSG Software team (and others?)

---+++ Package Changes

Packages in our SVN that have =fetch-crl= as an explicit dependency:

   * =cms-xrootd= (contrib)
   * =dcache-gratia-probe=
   * =glite-ce-cream= (in production since 3.1.7, but we may drop support?)
   * =osg-gridftp= (metapackage)
   * =osg-gridftp-hdfs= (metapackage)
   * =osg-gridftp-xrootd= (metapackage)
   * =osg-se-bestman= (metapackage)
   * =osg-se-bestman-xrootd= (metapackage)
   * =osg-se-hadoop= (and =-gridftp=, =-srm= subpackages)
   * =osg-wn-client= (metapackage)
   * =rsv-metrics= (but see note below)
   * =voms-admin-server=

*Note on rsv-metrics:* =rsv-metrics= says it requires =fetch-crl= but does not run it anywhere, so that dependency can be removed. Looks like it was for an old probe that is no longer used.

RPMs _outside_ of our SVN that have =fetch-crl= as an explicit dependency:

   * =nordugrid-arc-ca-utils= (EPEL)
   
*Note on nordugrid-arc-ca-utils:* We do not use this package, but we should mention it in the announcement anyway. A (hopefully) minor problem with this package is that because we do not ship it, its dependency on =fetch-crl= will not be changed to =fetch-crl3=. Since =fetch-crl3= does not “provide” the =fetch-crl= dependency, the user will have to keep both =fetch-crl= and =fetch-crl3= installed as long as they use =nordugrid-arc-ca-utils= and one of the OSG packages mentioned above.

RPMs that have =/usr/sbin/fetch-crl= as a dependency: none.

---+++ Software Changes

Some of our software specifically runs the =fetch-crl= executable. These programs must be changed, ideally so that they run =fetch-crl3= if it exists, or =fetch-crl= if it does not. See the =osg-test= code for an example of how to do this carefully. Software to update:

   * =osg-configure= (=osg_configure.modules.utilities.fetch_crl()=)
   * =osg-test= (=test_06_fetch_crl.py=, %RED%done%ENDCOLOR%)
   * =osg-ca-manage= and =osg-ca-certs-status= in the =osg-ca-scripts= package (checks if fetch-crl is enabled and when it was last run)

---+++ Documentation Changes

!TWiki pages to update:

   * Documentation.Release3.InstallBestPractices
   * Documentation.Release3.InstallCertAuth
   * Documentation.Release3.InstallBestmanXrootdSE (install transcript only)
   * Documentation.Release3.InstallGratiaService (install transcript only)
   * Documentation.Release3.InstallGridFtpXrootd (install transcript only)
   * Documentation.Release3.InstallGums
   * Documentation.Release3.InstallHadoopSE
   * Documentation.Release3.InstallOSGBestmanSE (install transcript only)
   * Documentation.Release3.InstallOSGClient
   * Documentation.Release3.InstallRSV
   * Documentation.Release3.InstallVoms
   * Documentation.Release3.InstallWNClient
   * Documentation.Release3.InstallXrootd
   * [[Documentation.Release3.OSGServices]]
   * Documentation.Release3.OsgCaManage
   * <s>Documentation.Release3.RsvPigeonTools</s> (OSG 1.2 only, don't bother)
   * Documentation.Release3.SrmTester
   * Documentation.Release3.UnderstandingComputeElement (note: looks a lot like [[Documentation.Release3.OSGServices]], is one of those two superfluous?)

Pages marked “install transcript only” have transcripts (“screen dumps”) of the output of a full installation procedure.

---++ Change Plan / Social Engineering

   1. Need the blessing of Security (%RED%done%ENDCOLOR%), Technology, and Production
   1. Need the upgrade instructions ([[Documentation.UpgradeFetchCrl2to3_draft]]) reviewed and tested
   1. Send a pre-announcement of the change a few weeks in advance; include whether or not this is something to worry about, how much effort migration will take, etc.
   1. Do the release; highlight this change in the release notes and announcement, and link to the upgrade instructions

%META:TOPICMOVED{by="TimCartwright" date="1360345566" from="SoftwareTeam.FetchCrl3OnEl5Proposal" to="SoftwareTeam.SwitchToFetchCrl3"}%
