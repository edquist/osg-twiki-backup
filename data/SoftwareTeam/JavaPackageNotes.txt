%META:TOPICINFO{author="TimCartwright" date="1310764861" format="1.1" reprev="1.4" version="1.4"}%
%META:TOPICPARENT{name="WebHome"}%
---+ Java Packages for Scientific Linux 5

---++ Background

See:

   * [[https://jira.opensciencegrid.org/browse/SOFTWARE-3][JIRA ticket SOFTWARE-3]]
   * [[https://twiki.cern.ch/twiki/bin/view/EMI/HowToUseJavaInEMI][How to use Java in EMI]]
   * [[http://fedoraproject.org/wiki/Packaging/Java][Fedora packaging guidelines for Java]]

---++ Policy

At the most general level, the following policy is %RED%recommended%ENDCOLOR%:

   * Follow the [[http://fedoraproject.org/wiki/Packaging/Java][Fedora Packaging Guidelines for Java]], when possible
   * By default, use the Oracle JDK for build and installation dependencies, but allow !OpenJDK for builds and installs when required
   * Rethink everything once !OpenJDK 7 is out and available as the default JDK from our supported platform(s)

*Reasoning:* Most OSG Java packages have been built and/or tested _only_ against the Oracle JDK, although some now use !OpenJDK (e.g., VOMS Admin). In general (i.e., not just in OSG), !OpenJDK 6 causes problems for some people and some software. An Oracle JDK RPM is available from Scientific Linux 5, although not from other RHEL-5-like distributions.

---+++ Declaring Dependencies on Java

For %RED%all packages%ENDCOLOR% that declare build and runtime dependencies on Java, the following policy is %RED%recommended%ENDCOLOR%:

%TABLE{sort="off"}%
| *Java* | *Build Dependency* | *Runtime Dependency* |
| Oracle JDK (default) | =java-1.6.0-sun-compat= | =java-1.6.0-sun-compat= |
| !OpenJDK 6 | =java-openjdk= | =java-devel-openjdk= |

*Reasoning:* In this case, we disagree with EMI’s recommendations a little bit. They suggest using the generic =java= and =java-devel= virtual packages; however, *both* the Oracle JDK (i.e., java-1.6.0-sun-compat) and !OpenJDK packages provide those virtual packages, so they do not help us specific precisely which flavor of Java we get. It is unclear why EMI recommends their use, honestly.

---+++ Builds Using Ant or Maven

Ant and Maven are two common build tools (like =make=) in the Java environment. Maven is broader in scope and uses Ant. Ant is available in Scientific Linux 5, but apparently not RHEL 5 or CentOS 5; Maven is not available in any of the OS distributions nor EPEL. However another distribution, [[http://www.jpackage.org/][JPackage]], provides RPMs for these build tools as well as tools of their own. The Fedora Packaging Guidelines explicitly recommend the use of JPackage.

For source packages of Java components that use Ant or Maven, the following policy is %RED%recommended%ENDCOLOR%:

   * Where possible, use the recipes in the [[http://fedoraproject.org/wiki/Packaging/Java][Fedora Packaging Guidelines for Java]] for packaging Ant and Maven builds
   * For build systems (only), use the JPackage repository (with low priority) to get RPMs for Ant (if necessary) and Maven

*Reasoning:* We want to following the Fedora Packaging Guidelines (FPG) in general, so it makes sense to follow their Java guidelines, too. The use of JPackage is recommended because (a) it is part of the guidelines, (b) it is widely used in the general community for packaging Java, and (c) it provides RPMs of critical build tools, like Maven, that are missing from other standard distributions. The JPackage repository should not be needed at install time, so it is not part of our recommended list of install distributions.

---++ Open Issues

   * How to set correct environment for *every* Java-using program?
   * Do we need to support platforms other than Scientific Linux 5? If so, do we need to pass-through SL5 packages such as:
      * =java-1.6.0-sun-compat=
      * The Oracle JDK
      * =jpackage-utils=

---++ Notes

According to the EMI page, the =java= dependency is the recommended runtime dependency. That virtual package is satisfied by:

   * java-1.4.2-gcj-compat
   * java-1.6.0-openjdk (1.6.0.0-1.11.b16 through 1.6.0.0-1.22.1.9.8)
   * java-1.6.0-sun-compat (1.6.0.20-1 through 1.6.0.26-3)

---+++ java-1.6.0-openjdk

!OpenJDK is an open-source implementation of the Java platform. !OpenJDK 7 will be the Oracle-backed reference implementation of Java 7, but the status of !OpenJDK 6 (= java-1.6.0-openjdk) in the Java ecosystem is less clear.

Nonetheless, this set of packages (including -demo, -devel, -javadoc, and -src) are available in Scientific Linux 5.6 (and presumably, earlier) and provide a complete JDK/JRE.

Package properties:

   * It sets up the JDK to work with the RPM alternatives system
   * It provides a bunch of virtual packages to satisfy dependencies (including =java-sdk= but not =jdk=)

---+++ java-1.6.0-sun-compat

From the RPM metadata: This package provides JPackage compatibility symlinks and directories for the vendor's JDK rpm.

I think what this means is that the Oracle/Sun JDK 1.6 does not install into the filesystem like the JPackage standard dictates, so the -compat RPM adds a bunch of symlinks and empty directories to the filesystem to satisfy JPackage. Also, the package appears to have the following properties:

   * It sets up the Oracle/Sun JDK to play nicely with the RPM alternatives system
   * It conflicts with certain JDK packages from IBM, Blackdown, and BEA
   * It provides a bunch of virtual packages to satisfy dependencies
   * It depends on the =jdk= virtual package, which is the Oracle/Sun JDK package

This compatibility package is available only on Scientific Linux 5, not !CentOS 5 or from EPEL. So *if* we depend on it for our Java packaging, then we are either constrained to Scientific Linux 5 or must pass-through the =-compat= package.

---+++ jdk

Scientific Linux 5, at least, supplies the full Oracle/Sun JDK 1.6.
