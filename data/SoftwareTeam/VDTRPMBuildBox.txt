%META:TOPICINFO{author="AlainRoy" date="1315409192" format="1.1" version="1.6"}%
%META:TOPICPARENT{name="RPMTempDocuments"}%
%LINKCSS%

<!-- This is the default OSG documentation template. Please modify it in -->
<!-- the sections indicated to create your topic.                        --> 

<!-- By default the title is the WikiWord used to create this topic. If  -->
<!-- you want to modify it to something more meaningful, just replace    -->
<!-- %TOPIC% below with i.e "My Topic".                                  -->

---+!! Installing a OSG Build Box
%TOC%

---++ Installing additional Repos
For a build box, you need the repos: [[http://fedoraproject.org/wiki/EPEL][EPEL]], [[http://www.jpackage.org/][JPackage]] and OSG.

   1. Install EPEL: <pre class="screen">
%UCL_PROMPT_ROOT% wget http://download.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm
%UCL_PROMPT_ROOT% rpm -i epel-release-5-4.noarch.rpm </pre>
   1. Install JPackage: <pre class="screen">
%UCL_PROMPT_ROOT% yum -y install yum-priorities
%UCL_PROMPT_ROOT% rpm -Uvh http://mirrors.dotsrc.org/jpackage/5.0/generic/free/RPMS/jpackage-release-5-4.jpp5.noarch.rpm
</pre>
   1. Edit the =/etc/yum.repos.d/jpackage.repo=, replacing =$releasever= with '5', just the number 5.  There are 2 locations, only the location in url is what matters.
   1. Install the OSG Yum Repository <pre class="screen">
%UCL_PROMPT_ROOT% rpm -Uvh http://repo.grid.iu.edu/osg-development/i386/osg-release-3.0-6.noarch.rpm 
</pre>


---++ Installing the osg-build tool
osg-build is used to build OSG packages.  It is a wrapper for tools like rpmbuild and mock.

<pre class="screen">
%UCL_PROMPT_ROOT% yum --enablerepo=osg-development --nogpgcheck install osg-build
</pre>

---++ Checking out the package source from subversion
Current work is done in subversion.  The command to check out the subversion is:
<pre class="screen">
%UCL_PROMPT% svn co https://vdt.cs.wisc.edu/svn/native vdt-native
</pre>

---++ Setting up Mock
Install mock (should be brought in by osg-build in newer builds):
<pre class="screen">
%UCL_PROMPT_ROOT% yum -y install mock
</pre>

Add your user to the mock group.  Edit =/etc/group=, adding your %RED%username%ENDCOLOR% (as returned by =id=) to the mock line:
<pre class="file">
mock:x:109:%RED%username%ENDCOLOR%
</pre>

---+++ Performance Suggestions
It is suggested that mock builds are done in ram.  Mock build are all conducted under =/var/lib/mock/=.  Mounting that directory in ram will cause builds to be much faster.  

An example mount command:
<pre class="screen">
%UCL_PROMPT_ROOT% mount -t tmpfs -o size=3072m tmpfs /var/lib/mock
</pre>

---++ Enabling OSG-Development Repo by default (optional)
Edit =/etc/yum.repos.d/osg-development.repo=, changing enabled to %RED%1%ENDCOLOR%.
<pre class="file">
[osg-development]
name=OSG Software for Enterprise Linux 5 - Development - $basearch 
mirrorlist=http://repo.grid.iu.edu/mirror/osg-development/$basearch
failovermethod=priority
priority=98
enabled=%RED%1%ENDCOLOR%
gpgcheck=0
#gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OSG
</pre>