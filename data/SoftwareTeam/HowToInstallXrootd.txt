%META:TOPICINFO{author="TanyaLevshina" date="1302540606" format="1.1" reprev="1.3" version="1.3"}%
%META:TOPICPARENT{name="XrootdRPMPhase1"}%
---++ How to install and tesl Xrootd-server rpm
   1. login as _root_ on a host you want to install xrootd server.
   1. create  /etc/yum.repos.d/vdt.repo:<pre class="rootscreen">
[vdt-development]
name = VDT RPM repository - development versions for Redhat Enterprise Linux 5 and compatible
baseurl = http://vdt.cs.wisc.edu/native/rpm/development/rh5/$basearch
gpgcheck = 0
enabled = 1
</pre>
   1. Install xrootd-server and dependent rpms:<pre class="rootscreen">
yum install xrootd-server
</pre>The following rpms will be installed:<pre class="rootscreen">
Installing:
 xrootd-server                          x86_64                          1:20110408.895ef4f-1                            vdt-development                          3.2 M
Installing for dependencies:
 xrootd-client                          x86_64                          1:20110408.895ef4f-1                            vdt-development                          1.2 M
 xrootd-libs                            x86_64                          1:20110408.895ef4f-1                            vdt-development                          2.0 M
</pre>
   1. Run xrootd setup:<pre class="rootscreen">
$ service xrootd setup     #creates appropriate directory for xrootd, create user,group "xrootd" if needed, change permission
</pre>All xrootd related configuration files and directories are now belong to the user defined in == /etc/sysconfig/xrootd== (default: user "xrootd", group "xrootd"). All xrootd related daemons are owned by this user. These user and group are created  if they don't exist. If you want to change the user and the group modify == /etc/sysconfig/xrootd==.  If you start daemons as one user and then decided to change a user you have to  modify == /etc/sysconfig/xrootd== and rerun "service xrootd setup".  %ICON{warning}% Note: there are still some files in /tmp that should be deleted manually before daemon could start successfully. We are trying to resolve this issue with developers.
   1. In order to test that xrootd is working as a stand alone data server do the following:<pre class="rootscreen">
$ service xrootd start                   # starts xrootd daemon 
</pre> You should be able now to store files using xrdcp command in ==/tmp==. To test do:<pre class="rootscreen">
$ xrdcp /bin/sh root://localhost:1094//tmp/first_test
[xrootd] Total 0.76 MB  |====================| 100.00 % [inf MB/s]
$ ls -l /tmp/first_test 
-rw-r--r-- 1 xrootd xrootd 801512 Apr 11 10:48 /tmp/first_test
</pre>
   1. To stop xrootd server:<pre class="rootscreen">
$ service xrootd stop
</pre>
  
---++ Creating Xrootd Cluster
   1. You will need to have at least two nodes in order to create a cluster. One node will serve as a "redirector" node , the other as a data server. You will need to start two daemons on each node ==xrootd== and ==cmsd==. Install rpms  on the second node (see steps 1-4 in the previous section).
   1. Select redirector host (A) and data server host ( B)
   1. You will be writing in the /tmp area on the host B. By default cmsd daemon requires at least 11GB of free space for the storage area. Please check how much space you have available (df -h) and then put an appropriate modification in the =/etc/xrootd/xrootd-clustered.cfg=.
   1. Modify  =/etc/xrootd/xrootd-clustered.cfg= on both nodes<pre class="file">
all.export /tmp stage
%RED%
set xrdr = hostA
all.manager $(xrdr):3121
if $(xrdr)
  all.role manager
else
  all.role server
  cms.space min 2g 5g
fi
#all.manager localhost 3121
#all.role server
%ENDCOLOR%
</pre>Changes in the configuration file are given in %RED%red%ENDCOLOR%. Replace hostA with the actual redirector name
   1. Start services:<pre class="rootscreen">
$ service cmsd start
$ service xrood start
</pre>
   1. Verify that you can copy file to /tmp on the server data:<pre class="rootscreen">
$ xrdcp /bin/sh  root://%RED%hostA%ENDCOLOR%:1094///tmp/second_test
[xrootd] Total 0.76 MB  |====================| 100.00 % [inf MB/s]
</pre>Check that the ==/tmp/second_test== is located on data server host B.

-- Main.TanyaLevshina - 05 Apr 2011
