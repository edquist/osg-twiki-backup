%META:TOPICINFO{author="BrianBockelman" date="1312817797" format="1.1" reprev="1.5" version="1.5"}%
%META:TOPICPARENT{name="RPMTempDocuments"}%
---+!! Koji Workflow
[[https://koji-hub.batlab.org/koji][OSG Koji]]

---++ Configuring certificate authentication

There are some pre-requisite configuration steps that only need to be done once on your build host:

   * Install the =osg-ca-certs= RPM onto the host.
   * Copy/paste the contents of =/etc/grid-security/certificates/d1b603c3.0= and =/etc/grid-security/certificates/1c3f2ca8.0= into =/etc/pki/tls/certs/ca-bundle.crt=.
   * Concatenate the contents of =~/.globus/usercert.pem= and =~/.globus/userkey.pem= into =~/.koji/client.crt=.
   * Email osg-software the DN of your certificate.

---++ Adding new package

Note that if a package with the same NVR (Name-Version-Release) as the one
you're trying to build already exists in koji, your build will fail.

Either use =rpmdev-bumpspec= (from =rpmdevtools=) to increment the Release of
your package, or pass =--scratch= to =koji build= or =vdt-build koji= to create
a scratch build.  The results of a scratch build won't be saved, so they won't
block subsequent builds with the same NVR. This is useful for experimenting
with koji.
---+++ Preferred: Using vdt-build (0.0.15+)
<pre class="screen">
%UCL_PROMPT% vdt-build koji %RED%package_name%ENDCOLOR% --kojilogin="your_cn" </pre>

---+++ Only if needed: Manually
Add new packages to the el5-osg tag.  Your CN will look like =Derek Weitzel 285345=
<pre class="screen">
%UCL_PROMPT% koji add-pkg el5-osg %RED%package_name%ENDCOLOR% --owner="your_cn" </pre>

Build packages to the el5-osg build target.  This will automatically put them in the development repo.
<pre class="screen">
%UCL_PROMPT% koji build el5-osg %RED%SRPM%ENDCOLOR% </pre>


---++ Upgrading packages from development -> testing -> release
Only an admin can upgrade packages to testing and release.

Build name is the name-version-release of the build.
<pre class="screen">
%UCL_PROMPT% koji tag-pkg el5-osg-testing %RED%build_name%ENDCOLOR% </pre>

And to release:
<pre class="screen">
%UCL_PROMPT% koji tag-pkg el5-osg-release %RED%build_name%ENDCOLOR% </pre>
