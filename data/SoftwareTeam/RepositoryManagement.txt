%META:TOPICINFO{author="BrianBockelman" date="1312843001" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="RPMTempDocuments"}%

---+ Repository Management

This document attempts to record everything there is to know about repository management for the OSG.

---++ Public Repositories

We host four public-facing repositories at vdt.cs.wisc.edu (to migrate to software.grid.iu.edu in the future):
   * *development*: This repository is the bleeding edge.  Installing from this repository may cause the host to stop functioning, and we will not assist in undoing any damage.
   * *testing*: This repository contains software ready for testing.  If you install packages from here, they may be buggy, but we will provide limited assistance in providing a migration path to a fixed verison.
   * *release*: This repository contains software that we are willing to support and can be used by the general community.
   * *contrib*: RPMs contributed from outside the OSG.  This is not yet heavily used, so the policies aren't fixed.

Koji maintains internal copies of all the above repositories; Koji is updated immediately when build jobs complete, but the above repositories will only be updated on the schedule outlined below.

---++ Build repositories

   * *Mock*: The =mock= task in =vdt-build= uses the following repositories:
      * The public-facing *development* repository.
      * !CentOS, EPEL and !JPackage
      Mock will pull directly from the above repositories.  Mock will install buildsys-build and yum-priorities by default in the buildroot, then resolve !BuildRequires dependencies
   * *Koji*: The =koji= task in =vdt-build= uses the [[http://koji-hub.batlab.org/koji/taginfo?tagID=2][el5-osg-build]] repo, which is the union of the following repositories:
      * The Koji internal development tag.
      * The dist-el5-build tag (consisting of the appropriate macros for %dist).
      * !CentOS, EPEL, and !JPackage
      Koji will work from its internal cache of the above repositories (downloading the packages from the source), and will not update until the build repository is regenerated (see below).  By default, Koji does a groupinstall of the build group, then resoolves the BuildRequires dependencies.

*WARNING*: We strive to keep Koji and mock consistent, but Koji's build repository may differ from mock's!  Koji is considered to be the authoritative build repository.

---++ Creation and Updates of Repositories

The top line tells what we *plan* to do, while the second line tells current status

   * When RPMs are built with Koji, the kojira daemon will re-create the internal Koji development repository each time a new package is built.
      * Whenever the development repository is updated, kojira will also trigger an update of the Koji build repository
      * *WARNING*: Unfortunately, kojira is not working at this time.  The internal Koji development and build repositories must be manually updated with the "koji regen-repo" command.
   * *development* is updated once every hour based on the Koji el5-osg-development tag.  Any package built will end up here by default.
      * *WARNING*: This is also not true; we are working on the cron job.
   * *testing* is updated once an hour based on the Koji el5-osg-testing tag.  It is a manual action to be promoted from development to testing.
      * *testing* points to a hand-created repository, and is frozen until after the Site Admins meeting.
   * *release* is updated only during recognized update windows, based on the Koji el5-osg-release tag.  It is a manual action to be promoted from development to testing.
      * *release* points to a hand-created repository
