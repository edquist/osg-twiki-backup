%META:TOPICINFO{author="AlainRoy" date="1317828940" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="InternalDocs"}%
---+ How to Cut a Release

%RED%<b>This document is a work in progress</b>%ENDCOLOR%

---++ Step 0. Pre-work

   * You should get a VM ready so you can do a test installation. 
   * You need to know the tag for which you are going to do a release
      * *Test Release:* =el5-osg-testing=
      * *Production Release:* =el5-osg-release=

---++ Step 1. Find the list of packages 

You need to figure out which packages are going to be in the release. There are two parts to this. 

---++ Part 1: The policy question

---++ Part 2: The technical details

Once you know which packages you want to release, you need to know the precise and full set of packages that need to be tagged. We should have a nice script to help you with this, but for now you can to do a lot of manual work. We use two processes in order to double-check the set. 

Process 1: For each high-level package you want to release:
   1. Add that package to the list.
   1. =yumdownloader %RED%package-name%ENDCOLOR%=
   1. * =rpm -qp --requires %RED%package-rpm-name%ENDCOLOR%=
   1. For each package in the dependencies that is in our repository and not already released, go to step 1. (That is, add to the list, download, and search the dependencies)

Process 2: For each high-level package you want to release:
   1. On a clean VM, do =yum install %RED%package-name%ENDCOLOR%=
   1. Look at the set of packages that yum lists, and the repository they are from. Compare the ones in our development/testing repository to the list from Process 1. Did you make any mistakes?
   1. Note that you don't have to complete the install if you don't want to--you just need the list of RPMs from yum.
   
---++ Step 2. Tag the packages

<pre class="screen">
% koji tag-pkg el5-osg-release cilogon-ca-certs-1.0-1 cilogon-ca-certs-compat-1.0-1 empty-ca-certs-1.0-1 \
                             igtf-ca-certs-1.41-1 igtf-ca-certs-compat-1.41-1 osg-ca-certs-1.23-1 \
                             osg-ca-certs-compat-1.23-1 osg-cert-scripts-2.7.1-1 osg-ca-scripts-0.0.9-1.osg
Enter PEM pass phrase: 
Created task 8421
Created task 8422
Created task 8423
Created task 8424
Created task 8425
Created task 8426
Created task 8427
Created task 8428
Created task 8429
Watching tasks (this may be safely interrupted)...
</pre>

<pre class="screen">
% koji list-tagged el5-osg-release
Build                                     Tag                   Built by
----------------------------------------  --------------------  ----------------
...
cilogon-ca-certs-1.0-1                    el5-osg-release       Anand Padmanabhan 75166
cilogon-ca-certs-compat-1.0-1             el5-osg-release       Anand Padmanabhan 75166
empty-ca-certs-1.0-1                      el5-osg-release       Alain Roy 424511
...
</pre>

---++ Step 3. Check the release

---++ Step 4. Document the release

---++ Step 5. Announce the release
