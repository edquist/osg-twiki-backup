%META:TOPICINFO{author="AlainRoy" date="1320176801" format="1.1" version="1.3"}%
%META:TOPICPARENT{name="InternalDocs"}%
---+ How to Cut a Release

%RED%<b>This document is a work in progress</b>%ENDCOLOR%

---++ Step 0. Pre-work

   * You should get a VM ready so you can do a test installation. 
   * You need to know the tag for which you are going to do a release
      * *Test Release:* =el5-osg-testing=
      * *Production Release:* =el5-osg-release=
   * Run =koji list-tagged --latest %RED%release-name%ENDCOLOR%=. Save the results in a file.

---++ Step 1. Find the list of packages 

You need to figure out which packages are going to be in the release. There are two parts to this. 

---++ Part 1: The policy question

---++ Part 2: The technical details

Once you know which packages you want to release, you need to know the precise and full set of packages that need to be tagged. We should have a nice script to help you with this, but for now you can to do a lot of manual work. We use two processes in order to double-check the set. 

Process 1: For each high-level package you want to release:
   1. Add that package to the list.
   1. =yumdownloader %RED%package-name%ENDCOLOR%=
   1. * =rpm -qp --requires %RED%package-rpm-name%ENDCOLOR%=
   1. For each package in the dependencies that is in our repository and not already released, go to step 1. (That is, add to the list, download, and search the dependencies)

Process 2: For each high-level package you want to release:
   1. On a clean VM, do =yum install %RED%package-name%ENDCOLOR%=
   1. Look at the set of packages that yum lists, and the repository they are from. Compare the ones in our development/testing repository to the list from Process 1. Did you make any mistakes?
   1. Note that you don't have to complete the install if you don't want to--you just need the list of RPMs from yum.

Put each package name into a file (below it is =packages-to-update=), one package per line. You can verify you have a good set of names by running the following command:

<pre class="screen">
%  xargs -a packages-to-update -n 1 koji buildinfo > package-check
</pre>

Then search the file =package-check= for the string =No such build=. If you see that, you have a mistake in your list of packages.
   
---++ Step 2. Tag the packages

<pre class="screen">
% xargs -a packages-to-update koji tag-pkg el5-osg-release 
Enter PEM pass phrase: 
Created task 8421
Created task 8422
Created task 8423
Created task 8424
Created task 8425
Created task 8426
Created task 8427
Created task 8428
Created task 8429
Watching tasks (this may be safely interrupted)...
</pre>

<pre class="screen">
% koji list-tagged el5-osg-release
Build                                     Tag                   Built by
----------------------------------------  --------------------  ----------------
...
cilogon-ca-certs-1.0-1                    el5-osg-release       Anand Padmanabhan 75166
cilogon-ca-certs-compat-1.0-1             el5-osg-release       Anand Padmanabhan 75166
empty-ca-certs-1.0-1                      el5-osg-release       Alain Roy 424511
...
</pre>

---++ Step 3. Check the release

Do a test installation in a clean VM. Fermicloud is a nice choice here, though certainly not required. We've already tested the software, so the goal is to make sure that you didn't miss any RPMs when you tagged.

---++ Step 4. Document the release

   * Run =koji list-tagged --latest %RED%release-name%ENDCOLOR%= and compare to the version you previously listed.
   * Make [[Documentation.Release3.ReleaseNotes][release notes]]. Follow previous examples.Note that for RPMs that have been updated, you list the new and old version. 

---++ Step 5. Announce the release