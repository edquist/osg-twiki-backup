%META:TOPICINFO{author="TimCartwright" date="1302533232" format="1.1" version="1.3"}%
---+ Native Packaging History

%RED%DRAFT DRAFT DRAFT DRAFT%ENDCOLOR%

This document is being written in April of 2011. It is meant to provide input from the VDT team to Dan Fraser's root cause analysis of native packaging. 

---++ 1.0 Background

---+++ 1.1 Coherency principle
A principle we had from the beginning, and for a long time was:

<blockquote>
Principle: Maintain coherency between the Pacman and native package versions of the VDT. Share as much as possible. 
</blockquote>

This was not an optimization against saving time for future work, but was an effort to leverage our existing work. It lead to at least three decisions:
   * Create binary RPMs out of the build process that we use for Pacman packages. These were conversions of the tarballs we were already creating.
   * Improve our configuration system such that we can share configuration scripts between Pacman and RPM installations. 
   * Attempt to keep the organization of packages such that we have (or nearly have) a one-to-one correspondance of Pacman packages and RPMs. 

In retrospect, we do not think this was the right principle to adopt.

---+++ 1.2 Community

When we began this work, we did not have a good understanding of the existing communities, how they thought about packaging, and what they expected from packaging.

---++ 2.0 Timelines

(All dates should be presumed to be wrong--these sections barely deserve to be called drafts but will be updated soon.)

---+++ 2.1 LIGO packaging timeline

May/June 2009? LIGO request for GT 4.2

2009-05-26: “Today I spoke with Tim Cartwright about VDT packaging for LIGO. He's going to dig into creation of Debian source packages starting today.” — Alain to Condor-LIGO mailing list.

2009-06: Tim’s status reports indicate some progress on Debian packages (mostly GPT), but many other activities including Pacman releases and hiring.

2009-07-02: “I am writing the debian/rules file. Instead of being a makefile, it is in Perl, because we have a medium- to long-term goal of having a single build system for pacman, Debian, and RPM.” — Tim to Condor-LIGO mailing list; note the approach.

2009-07-10: Status report from Tim to Alain — Still working on GPT with separate, unified Debian/Pacman build script. First week of significant CS 368 work.

2009-07-17: First alpha of a GPT package sent to LIGO. “I used Perl in hopes of integrating our build systems for Debian, RPM, and our own internal system. I can convert my work to a makefile, but I want to have some further conversations with Alain about laying out a path for future VDT builds.” — Tim to Condor-LIGO mailing list; note the approach.

2009-07-23: Email exchange about GPT package (“First draft of a GPT source package”) — generally shows Tim’s lack of understanding of Debian source packaging conventions, despite 2 months having passed. And again, the approach: “And, at the same time, finding ways to not repeat ourselves as we support multiple packaging systems; solving that problem is critical to our long-term mental health and ability to deliver quality packages in a reasonable time.”

2009-08-11: Decision to put files in /opt/vdt instead of /.

2009-08-21: First mention in Tim’s status reports of work on Debian packages for Globus Toolkit. “Started down one path [of, ultimately, 3] for Debianizing the Globus build”.

2009-08-28: Tim’s status report mentions two more approaches to GT packaging and much time spent on discussions.

2009-09-02: Second alpha of GPT + Globus Toolkit packages (essentials only) to LIGO. Many, many known quality issues, even in this limited release.

2009-09-14: Third alpha of GPT and Globus Toolkit, now including all GT binaries. Many quality issues remain (e.g., a handful of post-installation commands had to be run manually). Scott Koranda asks why we are still stuck on GT 4.0.x instead of 4.2.x. Alain says that we will make 4.2.x binaries for LIGO.

2009-09-18: Tim status report: Converting to 4.2.1 took a few days, mostly due to problems with the GT CVS repository.

2009-09-21: Alpha release of GT 4.2.1. Many known issues. First (known) request for x86-64 binaries from Scott Koranda.

2009-09-23: Alpha release of GT 4.2.1 on x86-64, including a few corrections to source packages.

2009-09-24: Tim email to Jim Basney — start of work on GSI-OpenSSH?

2009-09-25: “Next week, I'm going to add a second VDT person to our native packaging efforts.” — Alain to Condor-LIGO mailing list.

2009-09-30: Alpha release of GSI-OpenSSH.

2009-10-05: Alpha release of GSI-OpenSSH (5.2p1+4.7), incorporating ideas from LIGO Hannover developers.

2009-10-16: Alpha release of GT 4.2.1 and GSI-OpenSSH 5.2p1+4.7: Many quality improvements.

2009-10-23: Tim status report: Mention of significant effort toward configuration infrastructure.

2009-10-23: Alpha release of GT 4.2.1 RPM and new APT repository.

2009-10-29: Tim status report: Significant time spent making a Debian package for CA certificates, as an extension to our existing process for packaging CA certificates.

2009-11-05: Tim update on CA certificates to Chander, Mine, Rob Q., and Alain.

2009-11-06: Release of CA certificates package; alpha release of GT and GSI-OpenSSH source RPMs. Mention of work starting on !MyProxy.

2009-11-11: Another Tim update on CA certificates to Chander, Mine, Rob Q., and Alain — hand off to GOC for further work.

2009-11-20: Tim status report: Mentions meeting with Suchandra and VDT team to discuss configuration.

2009-11-20: Alpha release of !MyProxy 4.9 for Debian and RPM. Some continued pushing from, esp., Scott Koranda to make packages that meet administrator needs or else run the risk of having LIGO defect to other package providers.

2009-11-23: Email from Tim to Scott Koranda, re: packaging philosophy; again, even this late, note concerns about approach: “If it were just a matter of providing LIGO with 4-5 source packages that fit (as best as possible) standard RPM and Debian conventions, it wouldn't be so bad.  But we are also trying to figure out how to move most or all of the VDT to native packaging, and that's a much bigger and more complex undertaking.  Despite its large flaws, we have had some things very easy with Pacman, and so we're now starting to find and unwind all sorts of issues that we're going to have to deal with when we support other packaging systems. What's more, we are so understaffed here, that we *must* find a way to minimize the effort required to support *all* of the packaging systems that our users want.  And that includes not just putting code into packages, but also our configuration glue, and our testing infrastructure.”.

Following this point, I think we became far more aligned with community practices for native packaging.

2009-12-2: Alpha release of GT on Debian with significant build improvements.

2009-12-7: First mention of working (in earnest) on post-install scripts.

2009-12-11: Tim status report: Spending time on joint Debian-RPM infrastructure for post-install stuff.

2009-12-17: Beta release of *Condor* packages for Debian and RPM — work done (mostly) by Thawan Kooburat (graduate student).

2009-12-29: Proposal for LIGO repository organization. Effectively accepted as is, over the following week or two.

2010-1-8: Tim status report: Still working on infrastructure to support both Debian and RPM packages.

2010-1-21: Discussions with Globus team about GT 5.2 and native packaging.

2010-1-25 through 2010-2-12: More work with CA certificates and helping the GOC.

2010-1-28: Major new beta release of GT packages for Debian and RPM, now in standardized APT and YUM repositories. Significant milestone release.

2010-2-10: New beta release of GT 4.2.1 and !MyProxy 5.0.

2010-2-15: Beta release of !UberFTP 2.5.

2010-2-25: Beta release of GSI-OpenSSH 5.3p1+4.7.

2010-3-5: Revised beta of GSI-OpenSSH 5.3p1+4.7 based on testing feedback.

2010-3-15: Found out about new Globus patch that affected LIGO — forced rebuild of GT.

2010-3-19: Beta release of GT 4.2.1r3-1 (new patch).

2010-3-24: Nice email from Scott Koranda explaining how LIGO was building on top of the VDT native packages already.

2010-4-16: Tim status report: Starting to ramp up on OSG Summer School.

2010-4-29: *Production* release of GT 4.2.1, GSI-OpenSSH, !MyProxy, and !UberFTP.

2010-8-20: Small update release to GSI-OpenSSH.

2010-8-22: First formal request from LIGO for pre-WS GRAM in GT packages.

2010-8-23: First inquiry about upgrading to GT 5.0 — not a formal request yet.

2010-10-4: First alpha of GT 5.0 Debian binaries.

2010-10-20: First beta of GT 5.0.2 on Debian.

2010-11-8: Second beta of GT 5.0.2 on Debian, and first beta on RPM.

2011-1-13 to 2011-1-21: Security update of !MyProxy to 5.3p1.

2011-2-1: Production release of GT 5.0.2 and new GSI-OpenSSH, !MyProxy, and !UberFTP.

2011-2-8: Repository signing implemented.

2011-2-23: Official, small change request for GT 5.0 packages.

2011-3-31: Beta release of GT and !MyProxy updates on Debian.

2011-4-8: Beta release of GT and !MyProxy updates on RPM.

Make sure to include ramp-up time. Meeting with Miron suggesting we don't keep in sync with Pacman/OSG for LIGO?

Early 2010? GT 4.2 release

Request for GT 5.0?

Various updates we did?

---+++ 2.2 Non-LIGO packaging timeline

Early 2010? Discussion about improved configuration scheme, with eye on keeping it compatible between Pacman and RPM. Involved Suchandra

May 2010? Blueprint at BNL re: configuration & native packaging

Fall 2010: Native packaging, Mat's infrastructure for binary RPMs, Tim's configuration prototype. Glexec mongo RPM. Note that glexec came before worker nodes.

February 2011: Clarified worker node RPMs
March 2011: Worker node RPMs

---+++ 2.3 Other interesting dates

June/July 2009: Tim's class

July 27, 2009 (verified): Mat's start date

March-July 2010: OSG Summer School

July 2010: Tim's class
