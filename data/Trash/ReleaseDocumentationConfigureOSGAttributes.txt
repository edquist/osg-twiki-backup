%META:TOPICINFO{author="BrianBockelman" date="1261585033" format="1.1" version="1.55"}%
%META:TOPICPARENT{name="ComputeElementInstall"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

%STARTINCLUDE%
%BR%
---+ _%INCLUDEHEADING%  %SPACEOUT{ "%TOPIC%" }%_
%EDITTHIS%
%BR%

---++ Overview of OSG Configuration

OSG Configuration is controlled by one file, config.ini, located in =$VDT_LOCATION/osg/etc=.  The process of configuration is done via a command line tool, =configure-osg=, which should be in your path after you source =setup.sh=.  If you do not configure your CE, it will not be functional.

%STARTOSG12%
The =configure-osg= script used to be called =configure-osg.py= and was not in the path - only in the =$VDT_LOCATION/monitoring= directory.  The documentation has been reflected to update the current release.  If you try to install an older release, you'll have to adjust from these instructions accordingly.  A symlink from =osg/etc= to =monitoring= is present for backward compatibility.  Additionally, you do not need to run ==vdt-control --on== before executing the =configure-osg.py= like in OSG 1.0 and earlier OSG 1.2 releases.
%ENDOSG12%

%NOTE%  Prior to OSG 1.0, configuration was done via and interactive set of shell scripts, =configure-osg.sh=.  That script is available in OSG 1.0 and should work, but =configure-osg.py= is recommended.  This script has been removed from the latest OSG 1.2 release.

The =configure-osg= script takes the input configuration file, =$VDT_LOCATION/osg/etc/config.ini=, and runs the configuration process in batch mode (i.e., without user interaction).  Details about the syntax and formatting of the input configuration file can be found in  [[ConfigurationFileFormat][ Configuration File Format]] documentation with additional discussions of configuration options in the [[ConfigurationFileHelp][Configuration file help]] document.   The general format of the configuration file is a list of attribute assignments (attribute = value) broken into subsections delineated by square brackets ( [x] denotes subsection x).
 
Running the =configure-osg= script with a suitable input file will:

   * Sets attributes described in [[PrepareForComputeElementConfigure][CE Site Administrator Overview]]
   * Runs post-VDT-installation configuration of standard services, including GIP, Gratia, CEMon, Authentication, RSV, and WS-GRAM.
   * Runs additional configration of optional services such as Squid (if on same node as CE - not recommended) and <nop>MonALISA
   * On first execution only, it copies the =$VDT_LOCATION/osg/etc/locations/grid3-locations.txt= to =$OSG_APP/etc= with 666 permissions 
   * It writes warnings and messages to the =$VDT_LOCATION/vdt-install.log= file.  (Verbosely with the <b>-d</b> option)
   * If the -v option is used (to verify a configuration file), any warnings or errors will be written to the console through =stderr=.

%NOTE% The <nop>MonALISA configuration script is run regardless of whether <nop>MonALISA is used.  However, it is only configured for use if requested. 

The remainder of this section will cover the various ways to run the =configure-osg= script.  You will need to first edit config.ini as covered below, then run the script.

---++ Running =configure-osg=

configure-osg currently has two modes: *configure* (configures the CE) and *verify* (runs a sanity check on the input file).  By default, configure-osg will assume it should configure the install in $VDT_LOCATION.  Alternatively, the <b>-D</b> option can be used to point to the target installation.     The following table shows the basic methods assuming the simplest setup.  

| Invocation | Action |
| =configure-osg  -c= | Fully configure the CE using the configuration file at =$VDT_LOCATION/osg/etc/config.ini=. |
| =configure-osg.py  -v= | Verifies the contents of =$VDT_LOCATION/osg/etc/config.ini= |
| =./configure-osg.py  -e=   | *WARNING: OBSOLETE* in current OSG 1.2 releases.  Extracts configuration from an existing install located at =$OLD_VDT_LOCATION= or the one pointed to by using the <b>-D</b> option and writes a configuration file for it at  =./extracted-config.ini=. |
Additionally, you may add the <b>-d</b> option to your command line arguments and get additional debug logging in vdt-install.log.

%STARTOSG12% 
In the current release, configure-osg no longer supports the -e option.  Instead you should use the =extract-config= program which looks at the directory given in the =OLD_VDT_LOCATION= environment variable and then generates a file in the current directory called =extracted-config.ini= if possible.
%ENDOSG12%

With each successful execution of the =configure-osg= script in configure mode, the following files should be updated:
   * =osg/etc/osg-attributes.conf=
   * =osg/etc/osg-job-environment.conf=
   * =osg/etc/osg-local-job-environment.conf=
If this is not true, you will need to examine vdt-install.log for errors.

%NOTE% You can rerun the configure-osg script at a later time to reconfigure your settings or if the initial configuration did not complete successfully.

%STARTOSG12%
As of OSG 1.2, the configure-osg script will also enable services on your installation after being run in configure mode.
%ENDOSG12%

---++ Typical Workflows 

There are three typical use cases for using the configure-osg.py script:  moving/upgrading an existing installation, configuring a brand new installation,  modifying the configuration of a working installation.  The workflows for these three cases are listed here.

   * *Moving/upgrading an existing installation* not configured using configure-osg.py
      * Source =setup.sh= from the new installation
      * export OLD_VDT_LOCATION pointing to source installation.
      * Extract the old configuration by running =configure-osg -e= . This will produce a configuration file, =extracted-config.ini=.
      * Edit the extracted-config.ini to correct any mistakes, change any references to the original installation, and to add any missing options.  Then backup =$OSG_LOCATION/osg/etc/config.ini=, and then copy =extracted-config.ini= to =$OSG_LOCATION/osg/etc/config.ini=
      * <b>Test</b> the configuration by running =configure-osg -v=. 
      * Configure the new installation by running =configure-osg -c=
   * *Moving/upgrading an existing installation* configured using configure-osg
      * Source =setup.sh= from the new installation
      * Locate the ini file used to configure the old installation and copy it to =$OSG_LOCATION/osg/etc/config.ini=
      * Change any path references in the config.ini from the old installation location to the current installation location
      * <b>Test</b> the configuration by running =configure-osg -v=. 
      * Configure the new installation by running =configure-osg -c=
   * *Configuration of a brand new installation*:
      * Source =setup.sh= from the new installation
      * Create or copy a  =$VDT_LOCATION/osg/etc/config.ini= with information that is required for your site 
      * <b>Test</b> the configuration by running =configure-osg -v=.
      * Configure the new installation by running =configure-osg -c=
   * *Modify the configuration* of a working installation
      * edit =$VDT_LOCATION/osg/etc/config.ini= file with changes (e.g. new SE, number of nodes in cluster, ...)
      * <b>Test</b> the configuration by running =configure-osg -v=.
      * Configure the new installation by running =configure-osg -c= 

---++ Knowing what to put in the config.ini

The remainder of the [[ComputeElementInstall][Compute Element Install]] guide will cover the various sections of config.ini and what needs to be changed to complete the configuration steps.  If you would like to see the absolutely minimal number of changes that can be made for a working configuration, refer to the [[QuickInstallGuide][Quick Install Guide]].

%STOPINCLUDE%
%BR%
%COMPLETE3% %BR%
%RESPONSIBLE% Main.SuchandraThapa - 16 May 2008 %BR%
%REVIEW% Main.KeithJackson -  21 Jul 2009 %BR%
%REVFLAG% %X% %BR%


---++ *Comments*
%COMMENT{type="tableappend"}%


%META:TOPICMOVED{by="ForrestChristian" date="1166046785" from="Integration.ConfigureOSGAttributes050" to="Integration/ITB_0_5.ConfigureOSGAttributes"}%
