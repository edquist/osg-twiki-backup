%META:TOPICINFO{author="BrianBockelman" date="1233797488" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="WebHome"}%
---++ WLCG-related Metrics

The OSG, on behalf of the USLHC VOs, collects several different metrics each month and delivers this data through various means to the WLCG.

This page attempts to define what metrics are collected, how data is collected, and who the data is delivered to, as well as various relevant links.

The three main areas which we are interested in monthly are job accounting, service availability, and installed capacity

---+++ Job Accounting

---+++++ Data collected
For each job, we are interested in the following data:
   * Associated VO
   * Amount of CPU time used
   * Elapsed time of job
   * Site where the job ran
   * Job exit code
   * User who ran the job
Gratia collects per-job data (including these metrics) from the batch system at each site and stores it in the central OSG collector; the data collection and transfer [[Accounting/WebHome][is documented here]].

---+++++ Information distribution details
Every day, the summary information for each site (wall hours, wall success rate, and overall success rate) is sent to the osg-accounting-info mail list.  Each week, the summary of the site activity broken down by user is sent to the site admins.  Each VO's summary by user is sent to VO administrators.

Every night, the a script runs at the central OSG collector and, for each WLCG site, the script uploads the month's accounting to the WLCG APEL accounting database through a direct connection.  [[Accounting/GratiaInterfacesApelLcg][This process is documented here]].

Every month, the WLCG generates a report showing, for each site and federation, the number of CPU hours for each WLCG VO and the MoU commitment for each WLCG VO.  These CPU hours are normalized by the average kSI2K power of each site.

---+++ Service Availability

---+++++ Data collected
We use the WLCG algorithm to determine *availability and reliability of services, sites, and federations based on test results*.  Availability is defined to be the percent of time the service is functional; reliability is defined to  be the percentage of time the service is functional out of the scheduled 

The algorithm used to go from test results to the availability numbers is quite complex and [[http://twiki.grid.iu.edu/bin/view/Operations/RSVPeriodicReporting/Gridview_Service_Availability_Computation-1.pdf][described in detail here]].  We describe it shortly here.  A service is in the OK state if all of its critical tests are passing; if one of these tests are failing, then it is labelled CRITICAL.  The availability is defined to be the % of time the service is in the OK state.  The reliability is the % of time the service is in the OK state out of the time it wasn't in downtime.  A site's state is OK if it has one service of each type (CE or SE) in the OK state; site availability and reliability are defined similarly to service availability and reliability.  A federation's availability/reliability is the weighted average it's component site's availability/reliability.

---+++++ Information distribution details

Each test result is added to a site-local webpage and sent through the gratia infrastructure to a collector at the GOC.  From there, each new test result is transferred into the EGEE SAM result reporting system.  The [[Operations/RsvSAMGridView][distribution details are located here]].  The EGEE SAM results are transferred to the WLCG GridView application, where the availability and reliability are computed.

The OSG also calculates the availability and reliability using an independently implemented algorithm.

Every day, the OSG sends out several availability-related reports.  The most significant is the osg-sites report.  This report shows, for each site, the availability and reliability for the last day, 7 days, 30 days, and month to date.

Each month, the WLCG generates a report showing, for each site and federation, the calculated availability and reliability.  The sites are weighted by the calculated site size.

Each month, the OSG generates a federation-based report showing the job accounting and availability statistics.  This report is sent out to the OSG Joint Oversight Team.

---+++ Installed Capacity
This activity is just now being organized.

-- Main.BrianBockelman - 03 Feb 2009
