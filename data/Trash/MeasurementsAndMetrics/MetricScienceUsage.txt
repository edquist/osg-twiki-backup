%META:TOPICINFO{author="JamesWeichel" date="1269468393" format="1.1" version="1.4"}%
%META:TOPICPARENT{name="WebHome"}%
---+ Metric for Non HEP Science Usage of the OSG
%TOC%

---++ Introduction
One of the statements in the OSG Charter is, "The Open Science Grid will be open to all sciences that have a need for distributed large scale computing and data management, and can bring resources to be federated."  Two measures of progress on this goal are 1) the number of distinct scientific domains using OSG and 2) the amount (e.g. wall or cpu hours) of that usage.  This document covers a measure of the usage of OSG by scientific domains.

---++ Discussion
The accounting records collected by [[https://twiki.grid.iu.edu/bin/view/MonitoringInformation/WebHome#Gratia_Accounting][Gratia]] contain the VO Distinguished Name (DN) but not the Science Domain.  Therefore, to sum usage by Science Domain, an additional mapping from VO and/or DN is required.  For some VOs, all (or nearly all) users are working on the same project and are in the same Science Domain.  For example, the the ATLAS and CMS VOs are both in the High Energy Physics domain.  Other VOs have usage by users in different science domains.  For these VOs, a mapping is required from each specific user to their science domain.

Currently, to provide this mapping, the accounting records must be post-processed to add the science domain.  The source of these mappings is either the OIM (for VOs representing a single domain) or a set of tables (in csv format) that map individual user DNs to Science Domain.  Specifically, the Engage, y, z, and gpn VOs maintain tables for their users.  These tables, unfortunately, must be manually maintained.

Given the large number of users of OSG, the user mapping is always incomplete.  Only the set of users with significant usage have a entry.  This leads to only a small error in the cpu hours per domain since these users typically represent on the order of 95% of the usage.  Small users often graduate to large users over time, so the mapping must be updated on at least a yearly basis.

Note that there can be a significant number of hours represented by the "unknown" VO.  In most cases these records are generated by gratia older probes that don't distinguish jobs submitted locally to the batch job scheduler that are not OSG jobs.  Those local jobs that are OSG jobs also appear in other records with the correct VO and DN shown.  Both "unknown" and "other" VOs are removed from the query without any significant loss of hours that should be credited to OSG.

---++ Method Used to Derive Usage by Science Domain
Graphs showing the usage over time by Science Domain are generated using the following process.
   1. Query production OSG records, excluding unknown and other VO
   1. Develop a mapping from VO and/or specific OSG user identified by Distinguished Name (DN)
      A. Interrogate [[http://myosg.grid.iu.edu/vosummary/index?datasource=summary&summary_attrs_showfield_of_science=on&start_type=7daysago&end_type=now&all_vos=on&active_value=1][MyOSG VO Page]] (derived from OIM) to map VOs with a single science domain
      A. Use url provided by Engage where Engage user to science is maintained (upon request)
      A. Use similar urls from x, y, z VOs for their users
      A. Source a list maintained by Brian Bockelman to cover other cases (is this just gpn users covered by the previous line?)
      A. Add list from this !TWiki page csv attachment (if we decide to do this)
   1. Use the above mapping from the previous step to add Science Domain to VO and/or User records
   1. Provide data table of result with Plot of Wall hours vs. time by Science Domain
   1. Provide another data table with Plot of Wall hours vs. time by Science Domain not including HEP usage

---++ Procedure to Update (Yearly)
Given that the mapping tables from user DN to Science Domain are manually maintained, they must be updated as new users appear or existing users submit job using a new DN.  This should be done on a yearly basis or whenever the most accurate results are desired.

A [[http://t2.unl.edu/gratia/xml/unclassified_users][plot or table]] is provided to get a measure of how much time is not being classified.  This can be used to identify large users then need to be classified using the various mapping tables discussed above.

#GraphsAndData
---++ Graphs and Data
%NOTE% On the graphs below, you can force the display to show only full months by changing the starttime and endtime to be the first day of a month (e.g. 20100301 00:00:00).

---+++ Wall Hours by Science Domain
View: [[http://t2.unl.edu/gratia/xml/monthly_field][Monthly Wall Hours vs. Time for all Science Domains]]

---+++ Wall hours for Non-HEP Science Domains
View: [[http://t2.unl.edu/gratia/xml/monthly_nonhep_field][Monthly Wall Hours vs. Time for Non-HEP Science Domains]]

---++ What Would Required to Have a Production View by Science


-- Main.JamesWeichel - 23 Mar 2010