%META:TOPICINFO{author="NehaSharma" date="1283199124" format="1.1" reprev="1.12" version="1.12"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%DOC_STATUS_TABLE%
%TOC{depth="2"}%

---++About This Document
This document is intended for users who want to use fermi srm clients to do any of following
   * list/remove files at a storage location 
   * get files from a storage location
   * put files in a storage location (in usual or space reserved area)
   * transfer files from one storage location to another
   * create/remove directory at a storage location
   * make/release space reservation against a storage element

---++Requirements
   * A valid grid proxy 
   * Permission to actually get/put/list the data
   * OSG Client, CE or WN software installed

---++ Procedure
SRM Fermi Clients are packaged in to VDT and should be available on any node that has the OSG Client, CE or WN software installed.
To run the clients, you need to 
   * login to proper node
<pre class="screen">
source [VDT-INSTALL]/setup.sh
</pre>
   * generate your voms credentials
   * make sure you have clients in your [PATH] by running example command such as
<pre class="screen">
which srmcp
</pre>

---++++srmping - Ping the SE to see if it is accepting client requests
*Syntax*
<pre class="screen">
srmping [options] -debug srm-url
options can be listed using: 
srmping %RED%-help%ENDCOLOR%</pre>
*Example* <br></br>
Ping a SE
<pre class="screen">srmping %RED%-debug%ENDCOLOR% srm://gwdca04.fnal.gov:8443/srm/managerv2</pre>

---++++ srmcp - Perform data transfers to/from/between SE
*Syntax*
<pre class="screen">
srmcp [options] source-srm-url destination-srm-url
options can be listed using:
srmcp %RED%-help%ENDCOLOR%</pre>
*Example* <br></br>
Copy a file from local filesystem to remote storage location using srm protocol
<pre class="screen">srmcp %RED%-2%ENDCOLOR% file:////home/neha/test1 srm://fapl033.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/data/neha/test1</pre>
Copy a file from local filesystem to remote storage location using gsiftp protocol
<pre class="screen">srmcp file:////home/neha/test1 gsiftp://fapl035.fnal.gov:2811/test2</pre>
Copy a file from remote storage location to local filesystem using srm protocol
<pre class="screen">srmcp %RED%-2%ENDCOLOR% srm://fapl033.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/data/neha/test1 file:////home/neha/test3</pre>
Copy a file from local filesystem to remote storage location using gsiftp protocol
<pre class="screen">srmcp gsiftp://fapl035.fnal.gov:2811/test1 file:////home/neha/test4</pre>
Copy file using the space token<br></br>
Note: This command should be run after you have run the srm-reserve-space command and obtained a space token.
<pre class="screen">srmcp %RED%-2%ENDCOLOR% %RED%-space_token=%ENDCOLOR%[space-token] %RED%-retention_policy=%ENDCOLOR%REPLICA %RED%-access_latency=%ENDCOLOR%ONLINE file:////home/s1/neha/dcache-test/test-file srm://fapl033.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/data/public/srmcp-space-token</pre>
Copy multiple files with one command
<pre class="screen">srmcp %RED%-2 -copyjobfile%ENDCOLOR% [path to the text file containing list of sources and destination]</pre>
Limit or extend the number of retry attempts
<pre class="screen">srmcp %RED%-2 -retry_num=%ENDCOLOR%[number of retries before client gives up. default value 20] file:////home/neha/test1 srm://fapl033.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/data/neha/test1</pre>
Perform a third-party copy using pushmode. Difference in Push/Pull mode is explained [[http://home.fnal.gov/~timur/pushpull.html][here]]
<pre class="screen">srmcp %RED%-2 -pushmode=%ENDCOLOR%true srm://gwdca04.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/data/fermilab/test1 srm://fapl033.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/data/neha/test1</pre>

---++++ srmls - List contents of a directory 
*Syntax*
<pre class="screen">
srmls [options] srm-url
</pre>

Options can be listed using: 
<pre class="screen">
srmls %RED%-help%ENDCOLOR%</pre>

*Example* <br></br>
List the contents of a directory
<pre class="screen">srmls %RED%-2%ENDCOLOR% srm://gwdca04.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/data/sdss/</pre>
List detailed information (such as permissions, storage type, creation/modification time) for a file/directory
<pre class="screen">
-bash-3.00$ srmls %RED%-2 -l%ENDCOLOR% srm://gwdca04.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/data/fermilab/liveTestFile1
  10000000 /pnfs/fnal.gov/data/fermilab/liveTestFile1
 space token(s) :none found
  storage type:PERMANENT
  retention policy:CUSTODIAL
  access latency:NEARLINE
  locality:ONLINE
  - Checksum value:  9f680001
  - Checksum type:  adler32
   UserPermission: uid=13160 PermissionsRW
   GroupPermission: gid=9767 PermissionsR
  WorldPermission: R
 created at:2010/08/04 11:26:38
 modified at:2010/08/04 11:26:38
   - Assigned lifetime (in seconds):  -1
  - Lifetime left (in seconds):  -1
  - Original SURL:  /pnfs/fnal.gov/data/fermilab/liveTestFile1
 - Status:  null
 - Type:  FILE
</pre>
---++++ srmmv - Move directory from one location to another
*Syntax*
<pre class="screen">
srmmv [options] source-srm-url destination-srm-url
options can be listed using:
srmmv %RED%-help%ENDCOLOR%</pre>
*Example* <br></br>
Move the directory from one location to another
<pre class="screen">srmmv %RED%-2%ENDCOLOR% srm://gwdca04.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/data/sdss/old srm://gwdca04.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/data/sdss/new/old</pre>

---++++ srmrm - Remove an existing file 
Note that this command can only be used to remove files, not directories.
*Syntax*
<pre class="screen">
srmrm [options] srm-url 
options can be listed using:
srmrm %RED%-help%ENDCOLOR%</pre>
*Example* <br></br>
Remove an existing file
<pre class="screen">srmrm %RED%-2%ENDCOLOR% srm://gwdca04.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/data/sdss/testfile</pre>

---++++ srmmkdir - Create a new directory 
*Syntax*
<pre class="screen">
srmmkdir [options] srm-url
options can be listed using:
srmmkdir %RED%-help%ENDCOLOR%</pre>
*Example* <br></br>
Create a new directory
<pre class="screen">srmmkdir %RED%-2%ENDCOLOR% srm://gwdca04.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/data/sdss/newdir</pre>

---++++ srmrmdir - Delete an existing directory 
*Syntax*
srmrmdir [options] srm-url
options can be listed using:
srmrmdir %RED%-help%ENDCOLOR%</pre>
*Example* <br></br>
Delete an existing directory
<pre class="screen">srmrmdir %RED%-2%ENDCOLOR% srm://gwdca04.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/data/sdss/newdir</pre>

---++++ srm-reserve-space - Reserve space in advance for the upcoming requests
Note: This function will only work if Space Reservation is enabled, configured correctly and your VO is authorized to reserve space.<br></br>
*Syntax*
<pre class="screen">srm-reserve-space [options] srm-url
options can be listed using:
srm-reserve-space %RED%-help%ENDCOLOR%</pre>
*Example* <br></br>
The possible values for various options are explained [[https://srm.fnal.gov/twiki/pub/WorkshopsAndConferences/SRMV2Changes/SRM.Storage.Space.and.File.types.Shoshani.Sim.pdf][here]]
<pre class="screen">srm-reserve-space %RED%-2 --retention_policy=%ENDCOLOR%REPLICA %RED%--access_latency=%ENDCOLOR%ONLINE %RED%-lifetime=%ENDCOLOR%7776000 %RED%-desired_size=%ENDCOLOR%500000000000 %RED%-guaranteed_size=%ENDCOLOR%500000000000 %RED%-space_desc=%ENDCOLOR%public-token srm://gwdca04.fnal.gov:8443</pre>

---++++ srm-release-space - Release an occupied space

Note: This function will only work if you previously reserved space using srm-reserve-space command.<br></br>
*Syntax*
<pre class="screen">srm-release-space [options] srm-url
options can be listed using: 
srm-release-space %RED%-help%ENDCOLOR%</pre>
*Example* <br></br>
Release space
<pre class="screen">srm-release-space %RED%-space_token=%ENDCOLOR%168041 srm://gwdca04.fnal.gov:8443</pre>
where "168041" is the space token received upon successful execution of srm-reserve-space command(mentioned in the example above)

Note: After this command is successful, try to copy file in to the reserved area using same space token (using srmcp ofcourse). This time the transfer should fail.

---++Problem Resolution And Help
---+++Support
If you have questions or need help using Fermi SRM Clients, please send email to osg-storage@opensciencegrid.org
---+
%STOPINCLUDE%

---++ *Comments*
| I have updated/fixed this document and its ready for review | Main.NehaSharma | 20 July 2010 - 10:13|
%COMMENT{type="tableappend"}%

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = NehaSharma

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = Storage

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = EndUser

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = HowTo
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %NO%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = TanyaLevshina
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %IN_PROGRESS%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         =  TedHesselroth
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %NO%
############################################################################################################
-->
