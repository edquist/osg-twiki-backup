%META:TOPICINFO{author="JamesWeichel" date="1255446469" format="1.1" reprev="1.13" version="1.13"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! *<nop>%SPACEOUT{%TOPIC% Server Installation}%*
%TOC%

---++Introduction

The gsiftp package contains components necessary to set up a stand-alone gsiftp server and tools necessary to monitor and report its performance.
A stand-alone gsiftp server might be used under the following circumstances:
   * A simple front-end to a filesystem allowing access over WAN - for example [[/Storage/HadoopUnderstanding][HDFS]].
   * Bestman is capable of distributing its workload among several gsiftp servers so if you expect large movements of data into/out of your site, multiple gsiftp servers can be set up.

---++++++!!Applicable Versions
This document applies to an install of 
%RED%
*osg-version 1.2.3* 
%ENDCOLOR%
(or higher) and 
%RED%
*vdt-version  2.0.0*
%ENDCOLOR%
(or higher).

---++++++!!Engineering Considerations
It is recommended that the gsiftp package be installed on its own server if:
   * You are serving the VOs that use storage heavily (CMS, ATLAS, CDF, and D0) and have more than 250 cores
   * Your site will be managing more than 50 TB of disk space

If you are planning to have a Storage Element with !BeStMan and have more
than 1Gbps bandwidth, then you should plan on at least one !GridFTP server
per 4Gbps of available bandwidth (assuming you have 10Gbps interfaces on the
server) if you want to maximize throughput. 

---++Checklist
   1. [[PacmanInstall][pacman]] %PACMAN_VERSION% installed at $PACMAN%PACMAN_VERSION%
   1. host certificate installed in =/etc/grid-security/= %BLUE%this should be a link to a page explaining host certificates%ENDCOLOR%
   1. storage filesystem mounted on the server
   1. opened ports for authentications with ftp server (typically 2811) and for the data transfers (high ports typically in range 32769-65535).
   1. GUMS server is up and running if prima authentication and authorization is used.

---++Installation Procedure
Login as root and set up pacman environment:
<pre class="screen">
su root
source $PACMAN%PACMAN_VERSION%/setup.sh
</pre>
Set The GUMS server location if you are planning to use GUMS for authentication and authorization.
<pre class="screen">
export VDT_GUMS_HOST=osp3.lbl.gov
</pre>
Create a directory where the software will be located and download it there:
<pre class="screen">
mkdir /opt/osg/osg-%OSG_VERSION%-gsiftp/
cd /opt/osg/osg-%OSG_VERSION%-gsiftp/
pacman -get %CACHE%:GridFTP
</pre>

Configure newly downloaded environment, verify downloaded versions are what you expected, and that the VDT version is correct.
<pre class="screen">
source setup.sh
vdt-post-install
vdt-control --list
vdt-version
</pre>

Set up CA certificates:
<pre class="screen">
$VDT_LOCATION/vdt/bin/vdt-ca-manage setupca --location local -url osg
</pre>

Set up GUMS authorization:
<pre class="screen">
cp $VDT_LOCATION/post-install/prima-authz.conf /etc/grid-security
cp $VDT_LOCATION/post-install/gsi-authz.conf /etc/grid-security
</pre>

Edit both the files below by entering the transfer ports (high opened ports):

   * $VDT_LOCATION/vdt/etc/vdt-local-setup.sh :
<verbatim>
GLOBUS_TCP_PORT_RANGE=low_port,high_port
export GLOBUS_TCP_PORT_RANGE
GLOBUS_TCP_SOURCE_RANGE=low_port,high_port
export GLOBUS_TCP_SOURCE_RANGE
</verbatim>

   * $VDT_LOCATION/vdt/etc/vdt-local-setup.csh:
<verbatim>
setenv GLOBUS_TCP_PORT_RANGE low_port,high_port
setenv GLOBUS_TCP_SOURCE_RANGE low_port,high_port
</verbatim>

---++ Service Configuration
Enable and start services:
<pre class="screen">
vdt-control --enable fetch-crl vdt-rotate-logs vdt-update-certs gsiftp gratia-gridftp-transfer gums-host-cron  
</pre>

Remember to configure the [[GratiaTransferProbe#Configuring_Gratia_GridFTP_trans][gratia transfer probe]].

---++ Service Startup/Shutdown
To start type:
<pre class="screen">
vdt-control --on
</pre>
and to stop:
<pre class="screen">
vdt-control --off
</pre>

---++ Validation of Service Operation

On a client host run the globus-url-copy to verify the gsiftp service can successfully transfer a file:
<pre class="screen">
globus-url-copy file:///etc/hosts  gsiftp://osp1.lbl.gov/tmp/hostscopy
</pre>

Verify that the [[GratiaTransferProbe#Sanity_Check][gratia probe is working]].



---++Debugging Information
---++++++!!Files
   * Configuration file:
      * $VDT_LOCATION/vdt/services/vdt-run-gsiftp.sh.env  
      * $VDT_LOCATION/gratia/probe/gridftp-transfer/ProbeConfig	 
   * Log Files
      * $VDT_LOCATION/globus/var/log/gridftp.log
      * $VDT_LOCATION/globus/var/log/gridftp-auth.log 
      * $VDT_LOCATION/gratia/var/logs 
---++++++!!Caveates/Known Issues


---++Comments
%COMMENT{type="tableappend"}%

%STOPINCLUDE%
%BR%
%COMPLETE2% %BR%
%RESPONSIBLE% Main.IwonaSakrejda - 17 Sep 2009 %BR%
%REVIEW% Main.TanyaLevshina - 
