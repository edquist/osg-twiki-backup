%META:TOPICINFO{author="TanyaLevshina" date="1285965088" format="1.1" version="1.60"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! <nop>Berkley Storage Manager (!BeStMan) 
%DOC_STATUS_TABLE%
%TOC{depth="3"}%
%STARTINCLUDE%


---+ About this Document

%ICON{hand}% This document is for System Administrators who are planning to use storage that is installed on top of a POSIX-compliant file system. . It covers the installation of !BeStMan-fullmode  to be integrated into the %LINK_OSG%.
The goal of this document is to give enough information for system administrators to do initial simple configuration of the storage as well as provide references to the documents that may help to accomplish more sophisticated configuration.  This document applies to the latest release %RED% OSG-%OSG_VERSION% %ENDCOLOR%. All procedures presented in this document in general require _root_ privileges.

%INCLUDE{"Documentation/DocumentationTeam/DocConventions" section="Header"}%
%INCLUDE{"Documentation/DocumentationTeam/DocConventions" section="CommandLine"}%

---+ Introduction

!BeStMan, developed by the Scientific Data Management Group of Lawrence Berkeley National Laboratory, is a generic SRM v2.2 load balancing frontend for transfer servers. It works on top of existing disk-based POSIX-compliant file systems, and has been reported so far to work on file systems such as NFS, GPFS, PVFS2, GFS, Ibrix, HFS+, Hadoop, !XrootdFS and Lustre. It also works with any existing file transfer service, such as gsiftp, http, https, bbftp and ftp. !BeStMan is fuly compliant with SRM v2.2. It supports dynamic management of the storage space and queuing of SRM requests. It can be configured to support MSS. If you are not planning to use dynamic space management, requests queuing and not interested in MSS support you may consider to install [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/BestmanGateway][BeStMan-gateway]] that implements only basic SRM v2.2 functionality.

For general information on storage software architecture, implementations and use, please read [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/StorageInfrastructureSoftware][StorageInfrastractureSoftware]]. For information on planning, installing and validating storage software, please follow this link to [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/StorageSiteAdministrator][StorageSiteAdministrator]].

---+ Engineering Considerations
!BeStMan  could be installed on one node and the installation cache consists of the following components: 
   * !BeStMan is an implementation of SRM v2.2 for essential interfaces to disk based storage systems - [[https://sdm.lbl.gov/bestman][BeStMan Home Page]] 
   * !GridFTP server  provides a high-performance, secure, reliable data transfer [[http://www.globus.org/toolkit/docs/4.2/4.2.1/data/gridftp/][GridFTP documentation]]. 
   * POSIX-compliant file system
   * optional package
      * Gratia gridftp transfer probe - cron job that reports all the file transfers to [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/GratiaSiteCollector Gratia collector]]
   * If you want !BeStMan to use GUMS for authorization, you should be able to use the existing GUMS installed on your site or install it yourself on the different node, following [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/InstallConfigureAndManageGUMS][GUMS Server Installation Guide ]] 
    
The following questions should be answered before you can proceed with installation and 
configuration of !BeStMan storage solution: 
 
   $ Q. _What authorization mechanism do you prefer?_ : You need to decide if you want to use grid-mapfile or !GUMS server for users’ authentication and authorization. More details about !GUMS could be found at [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/InstallConfigureAndManageGUMS GUMS Installation Guide]]. %BR% %BR% We currently recommend using GUMS as it provides superior flexibility and allows a site to manage all of its mappings in one central location; most large sites use GUMS.

   $ Q. _What kind of storage do you like to provide to your users?_: You may choose volatile cache(files are stored in storage for a fixed period of time), custodial cache (files are stored until explicitly deleted) or both. You can also allow users to write to specified areas that are outside !BeStMan managed cache. For details see....


   $ Q. _How many !GridFTP servers you will need?_: You can choose to run multiple !GridFTP servers to achieve load balance and better performance. 


   $ Q. _Do you want to enable Gratia gridftp-transfer probes?_ : Yes!  The Gratia gridftp-transfer probes provide OSG storage statistics for accounting, much like the Gratia job accounting.  More details can be found at [[https://twiki.grid.iu.edu/bin/view/Accounting/WebHome  Gratia Home Page]]. The reported information will include the source and destination of transfer, certificate subject of transfer initiator, size and status of the transferred file. %BR% %BR% This probe captures only transfer statistics, hence it needs to be installed on your !GridFTP server.  If you do not run your !GridFTP server and !BeStMan server out of the same VDT installation, you will want to additionally install this probe on your other !GridFTP servers.

---+ How to get Help?

If a problem occurs during installation or verification of the service, see [[#DebugInfo][Debugging Information]].

If you cannot resolve the problem, the best way to get help is by following  [[HelpProcedure][this page]]. 

If you cannot find answers, please send all your questions to :
   * osg-storage@opensciencegrid.org
   * srm@lbl.gov
---+ Requirements

   1. [[ReleaseDocumentation/PacmanInstall][pacman]] version >= %PACMAN_VERSION% is required
   1. The server must have a fully qualified domain name and a valid [[ReleaseDocumentation/GetGridCertificates][grid host certificate]] installed in =/etc/grid-security/=
   1. !BeStMan server needs to have a valid service certificate. The certificate should be own by a user login that is running !BeStMan server.The right permission (600) should be set on those files. By default !BeStMan is using a service certificate =/etc/grid-security/http/httpcert.pem= and certificate key =/etc/grid-security/http/httpkey.pem=.

%ICON{warning}%  !BeStMan should be configured with host certificate in order to be able to handle requests from !LCG-Utils tools. This is mandatory for at least all !BeStMan servers that support ATLAS experiment. Normally the OSG !BeStMan implementation uses a service certificate, not a host certificate. This causes lcg-cp to fail because the certificate name (which looks like http/hostname instead of just hostname or host/hostname) doesn't match the hostname. There are two ways to solve this problem:
   * copy hostcert.pem, hostkey.pem into /etc/grid-security/http and rename these two files to httpcert.pem, httpkey.pem respectively. Change ownership of these files and directory.
   * create a directory  /etc/grid-security/bestmancert copy hostcert.pem, hostkey.pem into this directory and  these two files to bestmancert.pem, bestmankey.pem.respectively. Change ownership of these files and directory. You will need to use relevant options to specify certificate and certificate key while configuring !BeStMan.


   1. The firewall must allow incoming connections to the !GridFTP port (default 2811). Outgoing connections must be allowed from high ports ( typically in range 32769-65535 ). We recommend to consult the [[ReleaseDocumentation/ComputeElementFirewalls][Firewall Guide]] if you install the !GridFTP server for the first time.
   1. A working GUMS server or a grid-mapfile is needed for authorization using grid certificates.

---+ !BeStMan Installation Procedure
Login as root and check if pacman version >=%PACMAN_VERSION% is installed:
<pre class="rootscreen">
cd &lt;PACMAN3.28_LOCATION&gt;
. setup.sh
pacman -version
</pre>


Next,  create an installation directory and change this directory. This directory will later be used to get the !BeStMan package  from the %CACHE% cache.

<pre class="rootscreen">
mkdir -p /opt/osg_%OSG_VERSION%-bestman/
cd /opt/osg_%OSG_VERSION%-bestman/
</pre>

If you are using GUMS authorization method you will need to setup _VDT_GUMS_HOST_ environment variable, if you are using  grid-mapfile ,please, proceed to the next step.
<pre class="rootscreen"> 
cd &lt;VDT_LOCATION&gt;
export VDT_GUMS_HOST=&lt;GUMS hostname&gt;  
</pre>

Finally, execute pacman to get the !BeStMan package from the %CACHE% cache. Pacman will ask whether you want to trust the cache (=yall=).
<pre class="rootscreen">
cd &lt;VDT_LOCATION&gt;
pacman -get %CACHE%:Bestman
</pre>
The install procedure will print out a warning:
<verbatim>
========== IMPORTANT ==========
Most of the software installed by the VDT *will not work* until you install
certificates.  To complete your CA certificate installation, see the notes
in the post-install/README file.
</verbatim>

%INCLUDE{"ReleaseDocumentation/CaCertificatesInstall" section="InstallACertificateAuthorityPackage"}%
---++ Post-Install Procedure

To finalize your installation you must run the =vdt-post-install= program on the command line:

<pre class="rootscreen">
vdt-post-install
</pre>

You can verify that the version installed is the version you expected by executing =vdt-version=. To see all services available use =vdt-control -list=
<pre class="rootscreen">
vdt-version
vdt-control --list
</pre>


%TWISTY{%TWISTY_OPTS_REVIEW%}%
I think the below should say "This completes the installation of the certificate authority package." and not of Bestman server.
%ENDTWISTY%


This completes the installation of the !BeStMan server. Move to the next section to configure the !BeStMan and !GridFTP servers. You may also chose to configure Gratia transfer probe at this time.

If you want to install additional !GridFTP servers on the different nodes, please follow [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/GsiFtpStandAlone][the document for additional GridFTP servers]].


---+ !BeStMan Configuration

You will need to configure !BeStMan first in order to enable it as a service. The full review of !BeStMan configuration options are provided in the [[http://sdm.lbl.gov/bestman/docs/bestman-guide.html][Bestman Administrative Guide]]. The process is controlled by a !BeStMan-specific configuration script ( =$VDT_LOCATION/bestman/setup/configure= ) with command line arguments to define such items as cache directories, CA cert and CRL locations, service ports, logging information ..

If you are using grid-mapfile, then the simplest configuration command  for your !BeStMan installation  is shown below:
<pre class="rootscreen">
cd &lt;VDT_LOCATION&gt; 
source setup.sh 
$VDT_LOCATION/vdt/setup/configure_bestman --server y 
</pre>

This command will install !BeStMan that will be 
   * running  by user _"daemon"_,
   * using certificate  /etc/grid-security/http/httpcert.pem and certificate key /etc/grid-security/http/httpkey.pem
   * listening on secure port 10443 and public port 10080
   * utilizing  gridftp server running on the same host on 2811 port
   * using grid-mapfile for authentication and authorization

 If you want to use GUMS for authorization, the simplest configuration  command will be:
<pre class="rootscreen">
<verbatim>
cd <VDT_LOCATION> 
source setup.sh 
$VDT_LOCATION/vdt/setup/configure_bestman --server y\
        --cert <bestman service cert>\
        --key  <bestman service key>\
        --gums-host <GUMS hostname>\
        --gums-port <GUMS port number>
</verbatim>
</pre>
Where 
   * _bestman service cert_  is a path to service certificate 
   * _bestman service key_  is a path to service certificate private key</br> 

%ICON{"warning"}% *the certificate file and key  should belong to the user* - Please, see [[#Requirements][Requirements]]. 

%ICON{warning}%  !BeStMan should be configured with host certificate in order to be able to handle requests from !LCG-Utils tools. This is mandatory for at least all !BeStMan servers that support ATLAS experiment. Normally the OSG !BeStMan implementation uses a service certificate, not a host certificate. This causes lcg-cp to fail because the certificate name (which looks like http/hostname instead of just hostname) doesn't match the hostname. 
   * _GUMS hostname_ is fqdn name of  !GUMS server, <br/> 
   * _GUMS port number_  is the port of !GUMS  server, <br/>   


%TWISTY{%TWISTY_OPTS_REVIEW%}%
The following paragraph references a command, but I don't see the actual command anywhere.  Is something missing?
%ENDTWISTY%

This command will install !BeStMan that will be 
   * running  by user _"daemon"_,
   * listening on secure port 10443 and public port 10080
   * utilizing  gridftp server running on the same host on 2811 port
   * using GUMS for authorization
 
It is important to notice that --server y should be specified, otherwise the =configure_bestman= script disables the bestman server and then
it needs to be turned on again with the =vdt-control --on bestman=.



%STARTSECTION{"ComplexConfiguration"}%
More advanced command that allows you to use GUMS authorization, specified non-default ports for !BeStMan and !GridFTP ports range, multiple gridftp servers, etc is shown below:
<pre class="rootscreen">
<verbatim>
#cd <VDT_LOCATION>
# source setup.sh
# vdt/setup/configure_bestman  --server <y,n>\
        --user <bestman user>\
        --cert <bestman service cert>\
        --key  <bestman service key>\
        --http-port <public port number>\
        --https-port <secure port number>\
        --globus-tcp-port-range <low_port,high_port>\
        --volatile-file-lifetime <lifetime in seconds>\
        --cache-size <Cache size in MB>\
        --gums-host <GUMS hostname>\
        --gums-port <GUMS port number>\
        --with-transfer-servers <GridFTP server list>
</verbatim>
</pre>

%TWISTY{%TWISTY_OPTS_REVIEW%}%
It would probably look nicer if the below parameters were organized into a table.  
(This is probably an optional comment though)
%ENDTWISTY%


Where :
   * _bestman user_ is a name of the non-privileged user that runs !BeStMan server process
   * _bestman service cert_ is a path to service certificate 
   * _bestman service key_ is a path to service certificate private key</br> 
%ICON{"warning"}% *the certificate file and key  should belong to the user* - Please, see [[#Requirements][Requirements]]. 
   * _public port number_ public port (==configure_bestman== default port : 10080). 
   * _secure port number_ private port (==configure_bestman== default port: 10443)</br> 
%ICON{"warning"}% Please, make sure that these two ports are open if  you have a firewall on your node.
   * _low_port,high_port_  is the open ports range that is allowed for all outbound globus connections for gridftp (see also how to deal with firewall in [[#GridFTP_Configuration][ in this section]]).
   * _cache_size_ is the size of volatile cache area  allocated for storage
   * _lifetime in seconds_ is the time in seconds that file stored in !BeStMan volatile cache will be available (default is 30minutes)
   * _GUMS hostname_ is the fqdn name of  !GUMS serve
   * _GUMS port number_ is the port of !GUMS  server,
   * _GridFTP server list_ is a list !fqdn of your !GridFTP servers, separated by ; . e.g. “gsiftp://host1.domain.tld;gsiftp://host2.domain.tld” %BR%If not specified, the local hostname will be used as a name of !GridFTP server.
  

This command will allow you to configure !BeStMan that will manage a volatile space located under $VDT_LOCATION/vdt-app-data/bestman/cache directory. The size of the area will be controlled by specified  _cache_size_ or by size of the disk partition. The files that are stored at this area will be available during _lifetime in seconds_ period.

If you want to create a custodial storage place where file could be stored unless they are explicitly deleted by user you will need to add the following options to the configuration above:
<pre class="rootscreen">
<verbatim> 
       --with-custodial-storage-path <path>
        --with-custodial-storage-size <size>
</verbatim>
</pre>
Where
   * _path_ is the path to custodial storage
   * _size_ is the size of custodial storage 

If you would like also add other areas where people may store the data, you can use one of the following options:
<pre class="rootscreen">
<verbatim> 
       --with-allowed-paths <List of accessible paths>
</verbatim>
</pre>
or 
<pre class="rootscreen">
<verbatim> 
       --with-blocked-paths <List of non-accessible paths>
</verbatim>
</pre>
Where:
   * _List of accessible paths_ list of directories, separated by semicolon, accessible to users. If not specified, $VDT_LOCATION/vdt-app-data/bestman/cache directory will be used to store volatile data . %ICON{warning}%  Keep in mind that !BeStMan will not be able to manage space in  the areas specified in the list unless it is not also specified as custodial area.
   * _List of non-accessible paths_ list of directories separated by semicolon, non-accessible to users (default are "/;/etc;/var") . One of the  --with-allowed-paths / --with-blocked-paths options should be used


More configuration options could be found with _--help__ option.

%TWISTY{%TWISTY_OPTS_REVIEW%}%
At this point (or around here somewhere), you need to run "vdt-post-install".
Otherwise, the files in the post-install directory (like in the following GridFTP section) will not be there.
%ENDTWISTY%


%ENDSECTION{"ComplexConfiguration"}%

---++ !GridFTP  Configuration

!GridFTP server comes with !BeStMan installation. 

If you are using GUMS authorization method, please copy the following two files from _$VDT_LOCATION/post-install_ to in _/etc/grid-security_. Otherwise skip the this step: 
 <pre class="rootscreen">
cp $VDT_LOCATION/post-install/prima-authz.conf /etc/grid-security 
cp $VDT_LOCATION/post-install/gsi-authz.conf /etc/grid-security 
</pre>

If you have a firewall, the gridftp open port range should be properly set. In order to do so you will have to modify _vdt-local-setup.sh_.
<pre class="file">
<verbatim>
#edit $VDT_LOCATION/vdt/etc/vdt-local-setup.sh 
GLOBUS_TCP_SOURCE_RANGE=<low_port,high_port>
GLOBUS_TCP_PORT_RANGE=<low_port,high_port>
export GLOBUS_TCP_SOURCE_RANGE
export GLOBUS_TCP_PORT_RANGE
</verbatim>
</pre>

Where _low_port,high_port_ - is the ports range that is allowed for all outbound globus connections for gridftp (e.g GLOBUS_TCP_SOURCE_RANGE=40000,49150). See [[ReleaseDocumentation/ComputeElementFirewalls#iptables_for_RHEL_or_compatible][Firewall Guide]]  for more information how to modify iptables.

You can have multiple installation of  !GridFTP servers located on  the nodes you have 
specified in !BeStMan configuration (see  [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/GsiFtpStandAlone][standalone !GridFTP installation]] if you want to install it as a separate server).

You will need to make sure that users have write permissions in to the designated storage area, specified in the list of accessible paths.  

---+++ Gratia !GridFTP Transfer Probe Configuration

If you are using !GridFTP server that is installed during the !BeStMan installation, you will need  to enable and configure Gratia !GrdFTP transfer probe, and perform the actions described in  [[GratiaTransferProbe][Preparing, Installing and Validating Gratia transfer probe]].

---+ Enabling the Services

You can use the _vdt-control -list_ command to see all services that are installed as part of the install, and whether or not they are enabled or disabled. 
You will need to enable the following services:
   * fetch-crl   
   * vdt-rotate-logs  
   * vdt-update-certs       
   * gsiftp           
   * gratia-gridftp-transfer  %ICON{warning}% In case you want to run Gratia !GridFTP transfer probe
   * gums-host-cron   %ICON{warning}% In case you want to run Gratia !GridFTP transfer probe and are using !GUMS for authorization
   * edg-mkgridmap     %ICON{warning}% In case you want to generate and/or update grid-mapfile and use it  for authorization 

You can execute _vdt-control -enable_ command and list all services you want to enable:
<pre class="rootscreen">
<verbatim>
cd <VDT_LOCATION>
source setup.sh
vdt-control -enable fetch-crl vdt-rotate-logs vdt-update-certs gsiftp
</verbatim>
</pre> 

If you are using !GUMS or have grid-mapfile and don't want to use automatically generated one, please skip this section:
<pre class="rootscreen">
<verbatim>
cd <VDT_LOCATION>
source setup.sh
vdt-control -enable edg-mkgridmap
edg/sbin/edg-mkgridmap
</verbatim>
</pre> 
---+ Services Startup/Shutdown 


The detailed description of all the options available to start/stop services could be found [[ReleaseDocumentation/StartingServices][here]].
   1. Start !BeStMan  (!GridFTP and Gratia transfer probe). Login on !BeStMan node, then:<pre class="rootscreen">cd  &lt;VDT_LOCATION&gt; 
. setup.sh 
vdt-control --on 
</pre>
   1. Stop !BeStMan (!GridFTP and Gratia transfer probe). Login on !BeStMan node, then: <pre class="rootscreen">cd  &lt;VDT_LOCATION&gt; 
. setup.sh 
vdt-control --off  
</pre> 

---+ Integration with the information system

Integration of the SE with the central information systems takes place during the Compute Element installation/configuration. See the topic [[ReleaseDocumentation/GenericInformationProviders][Generic Information Providers]]. The SE does not collect or publish information independently.


---+ Validation of Service Operation

---++ Site registration and daily monitoring

Once you have your SE setup and configured, you can register it with the [[http://datagrid.lbl.gov/sitereg/][LBNL SRM monitoring system]]. This will run daily tests against your SE and the results can be viewed [[http://datagrid.lbl.gov/osg/][here]].

---++ Self-testing with srm clients

In order to verify that the system is functional you will need to have access to srm client commands, be able to create a proxy certificate (_grid-proxy-init_ or _voms_proxy_init_ command) and have access to your certificate and private key.

There are multiple ways of doing this.

---+++ Preparing to run srm-client command on the !BeStMan node

Running commands on the node you have just installed !BeStMan. 
   * Login on this node as "yourself"
   * Setup location of !BeStMan installation
<pre class="screen">
cd &lt;VDT_LOCATION&gt;
. setup.sh
</pre>
   * Make sure that you have access to your certificate and private key on that node. You will need it to create a proxy certificate. Execute grid-proxy-init:
<pre class="screen">
grid-proxy-init
Your identity: .....
Enter GRID pass phrase for this identity:
</pre>
   * You will need to add the path to all the srm client commands to your _PATH_ environment variable. You will need to have your proxy certificate to run SRM clients.
<pre class="screen">
source <VDT_LOCATION>/setup.sh
. setup.sh
export PATH=$PATH:$VDT_LOCATION/bestman/bin
</pre>

---+++ Preparing to run srm-client command from the different node

 Install client command on the node where you have your certificate and key. The detailed instruction is provided in [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/ClientInstallationGuide][in that installation Guide]]. Then generate a proxy certificate by issuing _grid_proxy_init or _voms_proxy_init_:
<pre class="screen">
source <VDT_LOCATION>/setup.sh
grid-proxy-init
Your identity: .....
Enter GRID pass phrase for this identity:
</pre>

or

<pre class="screen">
. &lt;VDT_LOCATION&gt;/setup.sh
voms-proxy-init -voms  &lt;voms_name&gt;
Enter GRID pass phrase for this identity:
</pre>
Where  &lt;VDT_LOCATION&gt is the directory where you installed the client.


---+++ Executing SRM-client commands 

After you create a proxy certificate, you may try to verify !BeStMan with srm client commands:

Execute srm-ping: 
<pre class="screen">
 srm-ping srm://BeStMan_host:secured_http_port/srm/v2/server 
 </pre>

Expected results: 
<pre class="screen">
srm-ping   2.2.1.2.i7.p3  Fri Jul 10 15:56:18 PDT 2009
SRM-Clients and BeStMan Copyright(c) 2007-2009,
Lawrence Berkeley National Laboratory. All rights reserved.
Support at SRM@LBL.GOV and documents at http://datagrid.lbl.gov/bestman
 
SRM-CLIENT: Connecting to serviceurl httpg://fg0x1.fnal.gov:10443/srm/v2/server

SRM-PING: Tue Mar 02 14:17:38 CST 2010  Calling SrmPing Request...
versionInfo=v2.2

Extra information (Key=Value)
backend_type=BeStMan
backend_version=2.2.1.3.8
backend_build_date=2009-12-03T05:09:14.000Z 
gsiftpTxfServers[0]=gsiftp://fg0x1.fnal.gov
clientDN=/DC=org/DC=doegrids/OU=People/CN=Tanya Levshina 508821
gumsIDMapped=fnalgrid
</pre>

If you have reasonable result you may try to srm copy. In order to do so create a file 
_“test”_ in _/tmp_ directory and write into the default volatile space:
 
<pre class="screen">
srm-copy   file:////tmp/test1  srm://BeStMan_host:secured_http_port/srm/v2/server\?SFN=/srmcache/~/test_1
</pre>
 
You should get back something like that: 
<pre class="screen">
srm-copy   2.2.1.2.i7.p3  Fri Jul 10 15:56:18 PDT 2009
SRM-Clients and BeStMan Copyright(c) 2007-2009,
Lawrence Berkeley National Laboratory. All rights reserved.
Support at SRM@LBL.GOV and documents at http://datagrid.lbl.gov/bestman
 
SRM-CLIENT: Tue Mar 02 14:19:20 CST 2010 Connecting to httpg://fg0x1.fnal.gov:10443/srm/v2/server

SRM-CLIENT: Tue Mar 02 14:19:20 CST 2010 Calling SrmPrepareToPutRequest now ...
request.token=fnalgrid:1_PUT_3055620301
status=SRM_REQUEST_QUEUED
explanation=null
SRM-CLIENT: Next status call in 10 seconds.
SRM-CLIENT: Tue Mar 02 14:19:32 CST 2010 Calling Status at Tue Mar 02 14:19:32 CST 2010
SRM-CLIENT: Result Status from SRM (srmStatusOfPutRequest)=SRM_SUCCESS

SRM-CLIENT: RemainingPinTime=289
SRM-CLIENT: received TURL=gsiftp://fg0x1.fnal.gov//usr/local/osg_1.2-bestman/vdt-app-data/bestman/cache/fnalgrid/V.0.0-1258657694/te
st_1

SRM-CLIENT: Tue Mar 02 14:19:32 CST 2010 start file transfer
SRM-CLIENT:Source=file:////tmp/test
SRM-CLIENT:Target=gsiftp://fg0x1.fnal.gov//usr/local/osg_1.2-bestman/vdt-app-data/bestman/cache/fnalgrid/V.0.0-1258657694/test_1

SRM-CLIENT: Tue Mar 02 14:19:35 CST 2010 end file transfer for file:////tmp/test

SRM-CLIENT: Tue Mar 02 14:19:35 CST 2010 Calling putDone for srm://fg0x1.fnal.gov:10443/srm/v2/server?SFN=/srmcache/~/test_1
Result.status=SRM_SUCCESS
Result.Explanation=null

SRM-CLIENT: Request completed with success

SRM-CLIENT: Printing text report now ...

SRM-CLIENT*REQUESTTYPE=put
SRM-CLIENT*TOTALFILES=1
SRM-CLIENT*TOTAL_SUCCESS=1
SRM-CLIENT*TOTAL_FAILED=0
SRM-CLIENT*REQUEST_TOKEN=fnalgrid:1_PUT_3055620301
SRM-CLIENT*REQUEST_STATUS=SRM_SUCCESS
SRM-CLIENT*SOURCEURL[0]=file:////tmp/test
SRM-CLIENT*TARGETURL[0]=srm://fg0x1.fnal.gov:10443/srm/v2/server?SFN=/srmcache/~/test_1
SRM-CLIENT*TRANSFERURL[0]=gsiftp://fg0x1.fnal.gov//usr/local/osg_1.2-bestman/vdt-app-data/bestman/cache/fnalgrid/V.0.0-1258657694/te
st_1
SRM-CLIENT*ACTUALSIZE[0]=15
SRM-CLIENT*FILE_STATUS[0]=SRM_SUCCESS
SRM-CLIENT*EXPLANATION[0]=SRM-CLIENT: PutDone is called successfully
</pre>
If you turn on Gratia !GridFTP transfer probes, you should be able to see the accounting information by accessing your Gratia collector. See details in  [[GratiaTransferProbe][Preparing, Installing and Validating Gratia transfer probe]].

---+++ Self-testing with srm-tester

A series of self-testing can be done with [[Storage.SRMTester][srm-tester]]. Follow instructions and samples on the [[Storage.SRMTester][srm-tester page]].

---+ Troubleshooting
---++ File Locations


You could find log and configuration files for each of the module in the following location: 

%TWISTY{%TWISTY_OPTS_REVIEW%}%
I could have messed something up (my gridftp had a port conflict when I started up), but I did not get the second file in my vdt install: 
$VDT_LOCATION/vdt/services/vdt-run-gsiftp.sh.env,
I see it in a different VDT installation though, so it's probably just an issue because I have too many things installed on the same machine.
%ENDTWISTY%


| *Module Name* |  *Configuration files* | *Log files* | 
|!BeStMan | $VDT_LOCATION/bestman/conf/bestman.rc | $VDT_LOCATION/vdt-app-data/bestman/logs/event.srm.log<br/>$VDT_LOCATION/vdt-app-data/bestman/logs/bestman.log | 
|!GridFTP |$VDT_LOCATION/vdt/services/vdt-run-gsiftp.sh.env| $VDT_LOCATION/globus/var/log/gridftp.log<br/> $VDT_LOCATION/globus/var/log/gridftp-auth.log |

---++ Open Ports
%TWISTY{%TWISTY_OPTS_REVIEW%}%
I'd probably mention that these are default ports, since you can specify them in the above configuration.

Also, what does 8080 (default 10080) mean?  Is 8080 the default or just another standard port?
%ENDTWISTY%

The following ports are opened for the installed services
|*Module Name*|*Port Number*| *Protocol*|
|!BeStMan| 8080 (default 10080)| tcp|
||8443 (default 10443)|tcp|
|!GridFTP|2811|tcp|
||lowPort,maxPort if needed to control outbound globus connections|tcp|  

#DebugInfo

---++ Debugging Procedure
If  system validation failed, you would probably need to check the each component in order 
to verify your installation. In order to do so you should check all of them in the following order: 
   * !GUMS (if in use) 
   * !GridFTP 
   * !BeStMan 

---+++ Verifying !GUMS 

Make sure that the service certificate you specified for !BeStMan  configuration with  
--cert &lt;service_cert&gt; , --key  &lt;service_key&gt;  options and !GridFTP service certificate are 
accepted by !GUMS  (see [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/InstallConfigureAndManageGUMS][GUMS Installation Documentation]])   
 
Get mapping _uid_ for your certificate and verify that this _uid_ exists on !BeStMan and !GridFTP node. 
 
---+++ Verifying !GridFTP 

Login on the node where you have installed have your certificate installed and  access to %CACHE%:wn_client or  %CACHE%:client.

You will need to get your _voms-proxy_ or _grid_proxy_ certificate see [[Validation of Service Operation][this section]] : 

Then test !GridFTP: 
<pre class="screen">
cd $VDT_LOCATION 
. setup.sh 
echo “This is a test” >/tmp/test 
globus-url-copy -dbg file:///tmp/test gsiftp://GridFtp_host/tmp/test 
</pre>

Check the !GridFTP logs if you have encountered any errors.

---+++ Verifying !BeStMan

Make sure that !BeStMan is running and there is no error in the log file (_$VDT_LOCATION/vdt-app-data/bestman/logs/event.srm.log_)

<pre class="screen">
# ps auxww|grep $VDT_LOCATION/bestman|grep -v grep
daemon   27648  0.0  0.0  4944 1168 pts/2    S    07:46   0:00 /bin/sh /usr/local/osg-bestman/bestman/sbin/bestman.server
daemon   27676  3.3  7.4 715240 155208 pts/2 Sl   07:46   1:59 /usr/local/osg-bestman/jdk1.6/bin/java -server -Xmx512m -Dorg.globus.tcp.port.range=20000,25000 -DX509_CERT_DIR=/usr/local/osg-bestman/globus/TRUSTED_CA -Daxis.ServerConfigFile=/usr/local/osg-bestman/bestman/conf/server-config.wsdd gov.lbl.srm.server.Server /usr/local/osg-bestman/bestman/conf/bestman.rc
</pre>

If !BeStMan is not running check information in that log file _$VDT_LOCATION/vdt-app-data/bestman/logs/bestman.log_.

---+ Reference


%TWISTY{%TWISTY_OPTS_REVIEW%}%
The UNL link no longer works:
   * [[http://t2.unl.edu/documentation/hadoop/bestman-hdfs][UNL !BeStMan Instruction]]
Wasn't this moved to the twiki?
%ENDTWISTY%


   * [[http://sdm.lbl.gov/bestman][BeStMan official website]].
   * [[ReleaseDocumentation.BestmanGateway][OSG BeStMan Gateway Mode page]]
   * [[ReleaseDocumentation.BestmanGatewayXrootd][OSG BeStMan Gateway and Xrootd page]]
   * [[ReleaseDocumentation.BestmanOnCE][OSG BeStMan Gateway on CE page]]
   * [[https://twiki.grid.iu.edu/bin/view/Storage/SEToolsTipsFAQs][Tips and FAQ]]
   * [[ReleaseDocumentation.GratiaTransferProbe][OSG Gratia Transfer Probe page]]
   * [[http://sdm.lbl.gov/bestman][BeStMan website at LBNL]] - [[http://sdm.lbl.gov/bestman/docs/bestman-guide.html][BeStMan User guides]], [[http://sdm.lbl.gov/bestman/docs/bestman-faq.html][BeStMan FAQ]] and latest downloadable tar files available here. Latest downloadables should be the same version as in VDT.
   * [[Storage.SRMv2Client][SRM v2.2 LBNL client command line examples]]
   * [[Storage.SRMTester][SRM-Tester]]
   * [[http://hep-t3.physics.umd.edu/HowToForAdmins.html#osginstall][UMD !BeStMan Admin Instruction]] - UMD experience on how to admin !BeStMan
   * [[http://t2.unl.edu/documentation/hadoop/bestman-hdfs][UNL !BeStMan Instruction]]
   * [[http://wt2.slac.stanford.edu/xrootdfs/bestman-gateway.html][SLAC !BeStMan Gateway mode Instruction]] - SLAC guide on !BeStMan gateway mode
   * [[http://www.usatlas.bnl.gov/twiki/bin/view/Admins/BestMan][US ATLAS !BeStMan instruction page]]
   * [[http://datagrid.lbl.gov/osg][OSG SRM Daily Testing Results]] - OSG provides SRM v2.2 daily testing. Site registration is needed [[http://datagrid.lbl.gov/sitereg][HERE]]
   * [[http://sdm.lbl.gov/srm-wg][SRM specifications and collaboration]] - from SRM collaboration working group
   * [[http://s-2.sourceforge.net/][S2]] - A SRM v2.2 test suite from CERN. It provides basic functionality tests based on use cases, and cross-copy tests, as part of the certification process and supports file access/transfer protocols: rfio, dcap, gsidcap, gsiftp


---+ Screen Dump of the Complete Install Process 
---++ Basic Installation and Configuration

Below is a screen dump of basic installation and configuration of !BeStMan:
   * create and using gridmap file for authorization
   * running on default ports
   * using default certificate and key files
   * using default volatile storage area 
   * not enabling gratia probe services
%TWISTY%
Login as root:
<pre class="rootscreen">
#cd /usr/local
#cd pacman-3.29
#source setup.sh
#cd ..
#mkdir osg_1.2-bestman
#pacman -get http://software.grid.iu.edu/osg-1.2:Bestman
Do you want to add [http://software.grid.iu.edu/osg-1.2] to [trusted.caches]? (y/n/yall): yall
Beginning VDT prerequisite checking script vdt-common/vdt-prereq-check...       

All prerequisite checks are satisfied.
                                                                          


========== IMPORTANT ==========
Most of the software installed by the VDT *will not work* until you install
certificates.  To complete your CA certificate installation, see the notes
in the post-install/README file.


# source setup.sh
# $VDT_LOCATION/vdt/bin/vdt-ca-manage setupca --location local -url osg
Setting CA Certificates for VDT installation at '/usr/local/osg_1.2-bestman'

Setup completed successfully.
# vdt-post-install
Starting...
Configuring PRIMA... Done.
Configuring EDG-Make-Gridmap... Done.
Completed all configuration.

# vdt-version

You have installed a subset of VDT version 2.0.0p13:

Software                                                 Status              
--------                                                 ------              
Berkeley Storage Manager (BeStMan) 2.2.1.3.8             OK                  
vdt-ca-manage 1.1                                        OK                  
vdt-update-certs 2.5                                     OK                  
CA Certificates 1.13 (includes IGTF 1.34 CAs)            -                   
EDG Make Gridmap 3.0.0                                   OK                  
Fetch CRL 2.6.6                                          OK                  
GPT 3.2-4.0.8p1                                          OK                  
Gratia GridFTP Probe 1.06.13b-1                          OK                  
Grid User Management System (GUMS) Client 1.3.17         OK                  
Java 5 SDK 1.5.0_21                                      OK                  
Java 6 SDK 1.6.0_16                                      OK                  
Logrotate 3.7                                            OK                  
PRIMA Authorization Module 0.8.4                         OK                  
pyOpenSSL module 0.9                                     OK                  
VOMS Client 1.8.8-2p1                                    OK                  
Wget 1.11.4                                              OK                  


Status legend:
OK: Software is up to date with the latest release in VDT version 2.0.0
- : Not enough information to determine if updates are available.
See man page for more information.

# vdt-control --list
Service                 | Type   | Desired State
------------------------+--------+--------------
fetch-crl               | cron   | do not enable
vdt-rotate-logs         | cron   | do not enable
vdt-update-certs        | cron   | do not enable
gsiftp                  | inetd  | do not enable
gratia-gridftp-transfer | cron   | do not enable
gums-host-cron          | cron   | do not enable
edg-mkgridmap           | cron   | do not enable

# $VDT_LOCATION/vdt/setup/configure_bestman --server y 

# vdt-control -enable fetch-crl vdt-rotate-logs vdt-update-certs edg-mkgridmap gsiftp
running 'vdt-register-service --name fetch-crl --enable'... ok
running 'vdt-register-service --name vdt-rotate-logs --enable'... ok
running 'vdt-register-service --name vdt-update-certs --enable'... ok

# vdt-control --list
Service                 | Type   | Desired State
------------------------+--------+--------------
fetch-crl               | cron   | enable
vdt-rotate-logs         | cron   | enable
vdt-update-certs        | cron   | enable
gsiftp                  | inetd  | enable
gratia-gridftp-transfer | cron   | do not enable
gums-host-cron          | cron   | do not enable
edg-mkgridmap           | cron   | enable
bestman                 | init   | enable
# $VDT_LOCATION/edg/sbin/edg-mkgridmap

# vdt-control --on
enabling cron service fetch-crl... ok
enabling cron service vdt-rotate-logs... ok
enabling cron service vdt-update-certs... ok
enabling inetd service gsiftp... ok
skipping cron service 'gratia-gridftp-transfer' -- marked as disabled
skipping cron service 'gums-host-cron' -- marked as disabled
enabling cron service edg-mkgridmap... ok
enabling init service bestman... ok
</pre>
Login as user:
<pre class="screen">
$ source /usr/local/osg_1.2.6_bestman/setup.sh
$ export PATH=/usr/local/osg_1.2.6_bestman/bestman/bin:$PATH
$ grid-proxy-init 
Your identity: /DC=org/DC=doegrids/OU=People/CN=Tanya Levshina 508821
Enter GRID pass phrase for this identity:
Creating proxy ...................................... Done
Your proxy is valid until: Fri Feb 19 03:27:02 2010

$ srm-ping srm://fg0x1.fnal.gov:10443/srm/v2/server 
srm-ping   2.2.1.2.i7.p3  Fri Jul 10 15:56:18 PDT 2009
SRM-Clients and BeStMan Copyright(c) 2007-2009,
Lawrence Berkeley National Laboratory. All rights reserved.
Support at SRM@LBL.GOV and documents at http://datagrid.lbl.gov/bestman
 
SRM-CLIENT: Connecting to serviceurl httpg://fg0x1.fnal.gov:10443/srm/v2/server

SRM-PING: Tue Mar 02 15:15:29 CST 2010  Calling SrmPing Request...
versionInfo=v2.2

Extra information (Key=Value)
backend_type=BeStMan
backend_version=2.2.1.3.8
backend_build_date=2009-12-03T05:09:14.000Z 
gsiftpTxfServers[0]=gsiftp://fg0x1.fnal.gov
clientDN=/DC=org/DC=doegrids/OU=People/CN=Tanya Levshina 508821
localIDMapped=fnalgrid

$ echo "This is a test " > /tmp/test

$ srm-copy   file:////tmp/test srm://fg0x1.fnal.gov:10443/srm/v2/server\?SFN=/srmcache/~/test
srm-copy   2.2.1.2.i7.p3  Fri Jul 10 15:56:18 PDT 2009
SRM-Clients and BeStMan Copyright(c) 2007-2009,
Lawrence Berkeley National Laboratory. All rights reserved.
Support at SRM@LBL.GOV and documents at http://datagrid.lbl.gov/bestman
 
SRM-CLIENT: Tue Mar 02 15:15:59 CST 2010 Connecting to httpg://fg0x1.fnal.gov:10443/srm/v2/server

SRM-CLIENT: Tue Mar 02 15:16:00 CST 2010 Calling SrmPrepareToPutRequest now ...
request.token=fnalgrid:0_PUT_3041267912
status=SRM_REQUEST_QUEUED
explanation=null
SRM-CLIENT: Next status call in 10 seconds.
SRM-CLIENT: Tue Mar 02 15:16:11 CST 2010 Calling Status at Tue Mar 02 15:16:11 CST 2010
SRM-CLIENT: Result Status from SRM (srmStatusOfPutRequest)=SRM_SUCCESS

SRM-CLIENT: RemainingPinTime=289
SRM-CLIENT: received TURL=gsiftp://fg0x1.fnal.gov//usr/local/osg_1.2-bestman/vdt-app-data/bestman/cache/fnalgrid/V.0.0-1603597117/test

SRM-CLIENT: Tue Mar 02 15:16:12 CST 2010 start file transfer
SRM-CLIENT:Source=file:////tmp/test
SRM-CLIENT:Target=gsiftp://fg0x1.fnal.gov//usr/local/osg_1.2-bestman/vdt-app-data/bestman/cache/fnalgrid/V.0.0-1603597117/test

SRM-CLIENT: Tue Mar 02 15:16:15 CST 2010 end file transfer for file:////tmp/test

SRM-CLIENT: Tue Mar 02 15:16:15 CST 2010 Calling putDone for srm://fg0x1.fnal.gov:10443/srm/v2/server?SFN=/srmcache/~/test
Result.status=SRM_SUCCESS
Result.Explanation=null

SRM-CLIENT: Request completed with success

SRM-CLIENT: Printing text report now ...

SRM-CLIENT*REQUESTTYPE=put
SRM-CLIENT*TOTALFILES=1
SRM-CLIENT*TOTAL_SUCCESS=1
SRM-CLIENT*TOTAL_FAILED=0
SRM-CLIENT*REQUEST_TOKEN=fnalgrid:0_PUT_3041267912
SRM-CLIENT*REQUEST_STATUS=SRM_SUCCESS
SRM-CLIENT*SOURCEURL[0]=file:////tmp/test
SRM-CLIENT*TARGETURL[0]=srm://fg0x1.fnal.gov:10443/srm/v2/server?SFN=/srmcache/~/test
SRM-CLIENT*TRANSFERURL[0]=gsiftp://fg0x1.fnal.gov//usr/local/osg_1.2-bestman/vdt-app-data/bestman/cache/fnalgrid/V.0.0-1603597117/test
SRM-CLIENT*ACTUALSIZE[0]=15
SRM-CLIENT*FILE_STATUS[0]=SRM_SUCCESS
SRM-CLIENT*EXPLANATION[0]=SRM-CLIENT: PutDone is called successfully
</pre>
%ENDTWISTY%
---++ Advanced Installation and Configuration

The is a screen dump of basic installation and configuration of !BeStMan:
   * using GUMS for authorization
   * running on specified ports
   * using different certificate and key files
   * specifying custodial storage area
   * enabling gratia probe services

%TWISTY%
Login as root:
<pre class="rootscreen">
#cd /usr/local
#cd pacman-3.29
#source setup.sh
#cd ..
# mkdir osg_1.2-bestman
# cd osg_1.2-bestman
#  export VDT_GUMS_HOST=gums.fnal.gov
#  pacman -get http://software.grid.iu.edu/osg-1.2:Bestman
Do you want to add [http://software.grid.iu.edu/osg-1.2] to [trusted.caches]? (y/n/yall): yall
Beginning VDT prerequisite checking script vdt-common/vdt-prereq-check...       

All prerequisite checks are satisfied.
                                                                          


========== IMPORTANT ==========
Most of the software installed by the VDT *will not work* until you install
certificates.  To complete your CA certificate installation, see the notes
in the post-install/README file.

# source setup.sh
# $VDT_LOCATION/vdt/bin/vdt-ca-manage setupca --location local -url osg
Setting CA Certificates for VDT installation at '/usr/local/osg_1.2-bestman'

Setup completed successfully.
# vdt-post-install 
Starting...
Configuring PRIMA... Done.
Configuring EDG-Make-Gridmap... Done.
Completed all configuration.

# cp $VDT_LOCATION/post-install/prima-authz.conf /etc/grid-security 
# cp $VDT_LOCATION/post-install/gsi-authz.conf /etc/grid-security 

# $VDT_LOCATION/vdt/setup/configure_bestman --server y --gums-host gums.fnal.gov --gums-port 8443 --cert /etc/grid-security/http1/httpcert.pem --key  /etc/grid-security/http1/httpkey.pem --with-custodial-storage-path /cache  --with-custodial-storage-size 10000
# mkdir /cache
# chown daemon.daemon /cache
# chmod 777 /cache
# $VDT_LOCATION/vdt/setup/configure_gratia --probe-cron --force-probe-config --site-name FERMI_TEST_1 --report-to gratia-osg-itb.opensciencegrid.org:8881 --probe gridftp-transfer
[root@fg0x1 osg_1.2-bestman]# vdt-control --enable fetch-crl  vdt-rotate-logs vdt-update-certs  gums-host-cron vdt-update-certs gsiftp gratia-gridftp-transfer
running 'vdt-register-service --name fetch-crl --enable'... ok
running 'vdt-register-service --name vdt-rotate-logs --enable'... ok
running 'vdt-register-service --name vdt-update-certs --enable'... ok
running 'vdt-register-service --name gums-host-cron --enable'... ok
running 'vdt-register-service --name vdt-update-certs --enable'... ok
running 'vdt-register-service --name gsiftp --enable'... ok
running 'vdt-register-service --name gratia-gridftp-transfer --enable'... ok
[root@fg0x1 osg_1.2-bestman]# vdt-control --list
Service                 | Type   | Desired State
------------------------+--------+--------------
fetch-crl               | cron   | enable
vdt-rotate-logs         | cron   | enable
vdt-update-certs        | cron   | enable
gsiftp                  | inetd  | enable
gratia-gridftp-transfer | cron   | enable
gums-host-cron          | cron   | enable
edg-mkgridmap           | cron   | do not enable
bestman                 | init   | enable
</pre>

Login as user:
<pre class="screen">
$ source /usr/local/osg_1.2.6_bestman/setup.sh
$ export PATH=/usr/local/osg_1.2.6_bestman/bestman/bin:$PATH
$ grid-proxy-init 
Your identity: /DC=org/DC=doegrids/OU=People/CN=Tanya Levshina 508821
Enter GRID pass phrase for this identity:
Creating proxy ...................................... Done
Your proxy is valid until: Fri Feb 19 03:27:02 2010
$ srm-ping srm://fg0x1.fnal.gov:10443/srm/v2/server 
srm-ping   2.2.1.2.i7.p3  Fri Jul 10 15:56:18 PDT 2009
SRM-Clients and BeStMan Copyright(c) 2007-2009,
Lawrence Berkeley National Laboratory. All rights reserved.
Support at SRM@LBL.GOV and documents at http://datagrid.lbl.gov/bestman
 
SRM-CLIENT: Connecting to serviceurl httpg://fg0x1.fnal.gov:10443/srm/v2/server

SRM-PING: Tue Mar 02 16:22:49 CST 2010  Calling SrmPing Request...
versionInfo=v2.2

Extra information (Key=Value)
backend_type=BeStMan
backend_version=2.2.1.3.8
backend_build_date=2009-12-03T05:09:14.000Z 
gsiftpTxfServers[0]=gsiftp://fg0x1.fnal.gov
clientDN=/DC=org/DC=doegrids/OU=People/CN=Tanya Levshina 508821
gumsIDMapped=fnalgrid

$ srm-copy   file:////tmp/test srm://fg0x1.fnal.gov:10443/srm/v2/server\?SFN=/srmcache/~/test
srm-copy   2.2.1.2.i7.p3  Fri Jul 10 15:56:18 PDT 2009
SRM-Clients and BeStMan Copyright(c) 2007-2009,
Lawrence Berkeley National Laboratory. All rights reserved.
Support at SRM@LBL.GOV and documents at http://datagrid.lbl.gov/bestman
 
SRM-CLIENT: Tue Mar 02 16:28:08 CST 2010 Connecting to httpg://fg0x1.fnal.gov:10443/srm/v2/server

SRM-CLIENT: Tue Mar 02 16:28:08 CST 2010 Calling SrmPrepareToPutRequest now ...
request.token=fnalgrid:2_PUT_3078426836
status=SRM_REQUEST_QUEUED
explanation=null
SRM-CLIENT: Next status call in 10 seconds.
SRM-CLIENT: Tue Mar 02 16:28:20 CST 2010 Calling Status at Tue Mar 02 16:28:20 CST 2010
SRM-CLIENT: Result Status from SRM (srmStatusOfPutRequest)=SRM_SUCCESS

SRM-CLIENT: RemainingPinTime=289
SRM-CLIENT: received TURL=gsiftp://fg0x1.fnal.gov//usr/local/osg_1.2-bestman/vdt-app-data/bestman/cache/fnalgrid/V.0.0-732596058/test

SRM-CLIENT: Tue Mar 02 16:28:21 CST 2010 start file transfer
SRM-CLIENT:Source=file:////tmp/test
SRM-CLIENT:Target=gsiftp://fg0x1.fnal.gov//usr/local/osg_1.2-bestman/vdt-app-data/bestman/cache/fnalgrid/V.0.0-732596058/test

SRM-CLIENT: Tue Mar 02 16:28:23 CST 2010 end file transfer for file:////tmp/test

SRM-CLIENT: Tue Mar 02 16:28:23 CST 2010 Calling putDone for srm://fg0x1.fnal.gov:10443/srm/v2/server?SFN=/srmcache/~/test
Result.status=SRM_SUCCESS
Result.Explanation=null

SRM-CLIENT: Request completed with success

SRM-CLIENT: Printing text report now ...

SRM-CLIENT*REQUESTTYPE=put
SRM-CLIENT*TOTALFILES=1
SRM-CLIENT*TOTAL_SUCCESS=1
SRM-CLIENT*TOTAL_FAILED=0
SRM-CLIENT*REQUEST_TOKEN=fnalgrid:2_PUT_3078426836
SRM-CLIENT*REQUEST_STATUS=SRM_SUCCESS
SRM-CLIENT*SOURCEURL[0]=file:////tmp/test
SRM-CLIENT*TARGETURL[0]=srm://fg0x1.fnal.gov:10443/srm/v2/server?SFN=/srmcache/~/test
SRM-CLIENT*TRANSFERURL[0]=gsiftp://fg0x1.fnal.gov//usr/local/osg_1.2-bestman/vdt-app-data/bestman/cache/fnalgrid/V.0.0-732596058/test
SRM-CLIENT*ACTUALSIZE[0]=15
SRM-CLIENT*FILE_STATUS[0]=SRM_SUCCESS
SRM-CLIENT*EXPLANATION[0]=SRM-CLIENT: PutDone is called successfully

$ #reserve the space

$ srm-sp-reserve  srm://fg0x1.fnal.gov:10443/srm/v2/server  -retentionpolicy custodial -userdesc my_token  -size 1000 -gsize 1000  -lifetime -1    
srm-sp-reserve   2.2.1.2.i7.p3  Fri Jul 10 15:56:18 PDT 2009
SRM-Clients and BeStMan Copyright(c) 2007-2009,
Lawrence Berkeley National Laboratory. All rights reserved.
Support at SRM@LBL.GOV and documents at http://datagrid.lbl.gov/bestman
 

SRM-CLIENT: Exception from client=Unable to locate a login configuration
SRM-CLIENT: Connecting to serviceurl httpg://fg0x1.fnal.gov:10443/srm/v2/server
SRM-CLIENT: Tue Mar 02 16:27:50 CST 2010 Calling SrmReserveSpace

SRM-CLIENT: .......................
        Status Code=SRM_SUCCESS
        SpaceToken=P.2
        TotalReservedSpaceSize=1000
        Guaranteed Space Size=1000
        Lifetime=-1

Printing text report now...

SRM-CLIENT*REQUEST_STATUS=SRM_SUCCESS
SRM-CLIENT*REQUEST-TOKEN=null
SRM-CLIENT*SPACE-TOKEN=P.2
SRM-CLIENT*EXPLANATION=null
SRM-CLIENT*TOTALRESERVEDSPACESIZE=1000
SRM-CLIENT*GUARANTEEDSPACESIZE=1000
SRM-CLIENT*LIFETIME=-1

$ srm-copy   file:////tmp/test srm://fg0x1.fnal.gov:10443/srm/v2/server\?SFN=/srmcache/~/test_sp -spacetoken P.2
srm-copy   2.2.1.2.i7.p3  Fri Jul 10 15:56:18 PDT 2009
SRM-Clients and BeStMan Copyright(c) 2007-2009,
Lawrence Berkeley National Laboratory. All rights reserved.
Support at SRM@LBL.GOV and documents at http://datagrid.lbl.gov/bestman
 
SRM-CLIENT: Tue Mar 02 16:28:47 CST 2010 Connecting to httpg://fg0x1.fnal.gov:10443/srm/v2/server

SRM-CLIENT: Tue Mar 02 16:28:48 CST 2010 Calling SrmPrepareToPutRequest now ...
request.token=fnalgrid:3_PUT_3078426836
status=SRM_REQUEST_QUEUED
explanation=null
SRM-CLIENT: Next status call in 10 seconds.
SRM-CLIENT: Tue Mar 02 16:28:59 CST 2010 Calling Status at Tue Mar 02 16:28:59 CST 2010
SRM-CLIENT: Result Status from SRM (srmStatusOfPutRequest)=SRM_SUCCESS

SRM-CLIENT: RemainingPinTime=289
SRM-CLIENT: received TURL=gsiftp://fg0x1.fnal.gov//cache/fnalgrid/P.2-1620785401/test_sp

SRM-CLIENT: Tue Mar 02 16:29:00 CST 2010 start file transfer
SRM-CLIENT:Source=file:////tmp/test
SRM-CLIENT:Target=gsiftp://fg0x1.fnal.gov//cache/fnalgrid/P.2-1620785401/test_sp

SRM-CLIENT: Tue Mar 02 16:29:02 CST 2010 end file transfer for file:////tmp/test

SRM-CLIENT: Tue Mar 02 16:29:02 CST 2010 Calling putDone for srm://fg0x1.fnal.gov:10443/srm/v2/server?SFN=/srmcache/~/test_sp
Result.status=SRM_SUCCESS
Result.Explanation=null

SRM-CLIENT: Request completed with success

SRM-CLIENT: Printing text report now ...

SRM-CLIENT*REQUESTTYPE=put
SRM-CLIENT*TOTALFILES=1
SRM-CLIENT*TOTAL_SUCCESS=1
SRM-CLIENT*TOTAL_FAILED=0
SRM-CLIENT*REQUEST_TOKEN=fnalgrid:3_PUT_3078426836
SRM-CLIENT*REQUEST_STATUS=SRM_SUCCESS
SRM-CLIENT*SOURCEURL[0]=file:////tmp/test
SRM-CLIENT*TARGETURL[0]=srm://fg0x1.fnal.gov:10443/srm/v2/server?SFN=/srmcache/~/test_sp
SRM-CLIENT*TRANSFERURL[0]=gsiftp://fg0x1.fnal.gov//cache/fnalgrid/P.2-1620785401/test_sp
SRM-CLIENT*ACTUALSIZE[0]=15
SRM-CLIENT*FILE_STATUS[0]=SRM_SUCCESS
SRM-CLIENT*EXPLANATION[0]=SRM-CLIENT: PutDone is called successfully
</pre>
%ENDTWISTY%

%STOPINCLUDE% 
%BR% 

---+ *Comments*
%COMMENT{type="tableappend"}%
<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = TanyaLevshina

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = Storage

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Installation
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %YES%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = AlexSim
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %YES%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = DouglasStrain
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %IN_PROGRESS%
############################################################################################################
-->