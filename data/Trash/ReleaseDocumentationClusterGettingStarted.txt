%META:TOPICINFO{author="MarcoMambelli" date="1256390069" format="1.1" reprev="1.4" version="1.4"}%
%META:TOPICPARENT{name="GridColombiaWorkshop2009"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

---++ Introduction
   * The purpose of this exercise is to setup a small test cluster that can be  used to illustrate creating a site capable of receiving Grid jobs and data.
   * It will have a minimal number of "head nodes" that will host various services such as a Condor job manager, an OSG gatekeeper and storage element.
   * It will have a two or more "compute nodes" that will receive and execute jobs.


---++ Site planning
   * Take a look at SitePlanning
   * Probably the first option will be to just use a gridmap file rather than a GUMS service
   * Identify which software (service) will be installed on which host.
   

---++ Identify the hosts and and assign their roles
Lets say your test grid cluster is going to have in its name,  "tg1" (from Test Grid 1),  and you have 8 machines.
The fully qualified domain name (FQDN) includes a domain (here "yourdomain.org"). In the documents sometime the machines will be referred with their short name, e.g. =tg1-ce= instead of =tg1-ce.yourdomain.org=.

   * =tg1-ce.yourdomain.org= a Compute Element (and cluster head-node) 
   * =tg1-se.yourdomain.org= a Storage Element 
   * =tg1-gums.yourdomain.org= a GUMS server
   * =tg1-nfs.yourdomain.org= an NFS server 
   * =tg1-ui.yourdomain.org=  your user interface machine
   * =tg1-c001.yourdomain.org= compute node 1
   * =tg1-c002.yourdomain.org= compute node 2
   * =tg1-c003.yourdomain.org= compute node 3
   
We may double up on services on some of the head nodes, and may add/subtract compute nodes (but you need at least one).  But this would be the basic host-role assignment.   You might call this your *node matrix*.

---++ The machines
All machines are assumed to have a Linux OS installed. Linux releases differ for configuration and placement of files. These documents refer to Scientic Linux 5.3.  However, any Red Hat based Linux distribution (Fedora, !CentOS, etc.) should work fine.  You may have to adapt these instructions if you have something different (SUSE, Debian, or Gentoo for example).  A basic server installation is assumed. To simplify the cluster this configuration was used:
   * !SeLinux is disabled
   * =iptables= (firewall) is disabled 
<pre>
chkconfig --list iptables
chkconfig iptables off
</pre>
   * =autofs= is disabled

---++ The network layout
We will assume that all the machines are on the same network (public or private).  If the machines are all located on a private network, then the client machines attempting to submit jobs to the compute element (gatekeeper) would obviously need to be on that network as well.

---++ Network configuration
A simple network configuration (that will work both when the machines are in a public network and also when they are isolated) can be obtained using the =/etc/hosts= file and static IP addresses.

=/etc/hosts=, same file on all machines, contains a map of the whole cluster, resolving localhost and all the hosts of the cluster, both as FQDN and short name.
<pre>
[copy /etc/hosts from the gs1 cluster]
</pre>

=/etc/resolv.conf= has to contain the correct DNS 

=/etc/nsswitch.conf= instructs the host to look first in the file using this line:
<pre>
#hosts:     db files ldap nis dns
hosts:      files dns
</pre>

=/etc/sysconfig/network= contains the FQDN of the host and the gateway used, e.g.
<pre>
NETWORKING=yes
HOSTNAME=tg1-ce.yourdomain.org
GATEWAY=192.168.1.254
</pre>

=/etc/sysconfig/network-scripts/ifcfg-eth0= (and eventual other network interfaces) is configured to use a static IP. The IPADDR value has to be consistent with the one assigned in =/etc/hosts=. Some of the lines are:
<pre>
BOOTPROTO=static
TYPE=Ethernet
IPADDR=192.168.1.51
</pre>

---+++ Protecting /etc/resolv.conf
If a host has multiple network interfaces (e.g. dual homed hosts) and runs DHCP client on the second interface, this replaces =/etc/resolv.conf=. 
=/etc/resolv.conf= can be write protected with =chattr= command under Linux ext3 file system:
<pre>chattr +i /etc/resolv.conf
</pre>

For more information or alternatives check: http://www.cyberciti.biz/faq/dhclient-etcresolvconf-hooks/ 

%BR%
%COMPLETE3% %BR%
%RESPONSIBLE% Main.RobGardner - 23 Oct 2009 %BR%
%REVIEW%


---++ *Comments*
%COMMENT{type="tableappend"}%


<!--
   * Set USERSTYLEURL = https://twiki.grid.iu.edu/twiki/pub/ReleaseDocumentation/GridColombiaWorkshop2009/centerpageborder.css
-->
