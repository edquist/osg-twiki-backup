%META:TOPICINFO{author="SuchandraThapa" date="1248897037" format="1.1" version="1.21"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%


---++ Introduction
There are two ways of updating your compute element (CE) between minor revisions of an OSG release (e.g. 1.0.1 to 1.0.2 or 1.2.0 to 1.2.1).  

   * The first method uses a new updater script from VDT.
   * The second method uses a series of Pacman commands.

We recommend the first method as its semi-automated, quicker, and less prone to error.  Note:
   * You *must* be running an OSG 1.0.0 (VDT 1.10.1) compute element, or later.    
   * There is no automatic way to upgrade a storage element installed from OSG 1.0.0.   This is because Bestman was not yet an OSG package, and dCache is not installed from the OSG caches.   However, once you've installed a Bestman SE from this release, you'll be able to make subsequent updates using the updater script method.

Both methods require updating configure-osg and osg-version packages.

---++ Before proceeding
These instructions are for an in-place update of an existing OSG 1.0.0 installation.  If you are trying to update an OSG 0.8.0 installation, do a fresh installation.  Before attempting an in-place update,  ask yourself the following questions to determine if it is safe to do so:

   * Did you install the VDT from more than one VDT cache? (Look in $VDT_LOCATION/trusted.caches to see if there is more than one VDT URL listed there.) Or did you install from more than one OSG cache? If you are unsure, mail your trusted.caches file to vdt-support@opensciencegrid.org, and we'll help you out.
   * If you run services (like a CE), did you install as anything other than root? There are some cases where this might cause problems. Client installations should be fine.
   * Did you install OSG 1.0 before its official release?
   * Did you install a versioned CE package? That is, when you run =pacman -lc=, do you see a package named =ce= (which is good) or a package named =ce-1.0.0= (which is bad.)

If you answered yes to any of these questions, you're better off doing a fresh installation.

---++ Getting started

Before updating, do the following:

   * Change into your $VDT_LOCATION directory and source the setup file (setup.sh or setup.csh).
   * Run =vdt-control --off= in order to turn off your services.
   * Make sure no OSG processes are running. Look for =globus-job-manager= processes, or anything owned by your =rsv= user.  If there are any, kill them.
   * Make a backup of your installation (=cp -pr $VDT_LOCATION BACKUP-LOCATION=).

Decide whether to use the vdt-updater script or to manually run Pacman commands to update your installation.  Using the VDT-updater script is the recommended procedure for in-place updates.


---++ Update configure-osg & osg-version

---+++ configure-osg
On an existing osg installation, you'll need to update the osg-config package.  First run
   * =pacman -lc | grep osg-config=


Depending on what osg-config package(s) are on your system, you'll need to do one of two things. If the output that you get is similar to either of the two following examples, then you'll need to update the osg-config package. 
<pre class="screen">
# pacman -lc|grep osg-config
    [*] osg-config
    [*] osg-config-1.0.0
</pre>
or
<pre class="screen">
# pacman -lc | grep osg-config
    [*] osg-config
</pre>
In this case, you'll need to update the osg-config package.  You can do this by running pacman as follows:
   * =pacman -update osg-config=
After the update, the output of the pacman -lc will not change.
 

If you have only the older versioned osg-config package, you'll need to install the newer osg-config package.  In this case, the output will resemble the following
<verbatim class="screen">
# pacman -lc|grep osg-config
    [*] osg-config-1.0.0
</verbatim>

In this case, you'll need to install the new osg-config package by running the following command
   * =pacman -get OSG:osg-config= 
After completing the installation, running
   * =pacman -lc | grep osg-config=
will give you 
<pre class="screen">
# pacman -lc|grep osg-config
    [*] osg-config
    [*] osg-config-1.0.0
</pre>

In the monitoring directory, you'll find a =config.ini.new=.  This file has a new version of the config.ini file with updated and simpler syntax especially in regards to configuring SEs and Subclusters.  You can use this as your new starting point for your configuration but it is not necessary for you to do so. Instructions for updating your config.ini can be found [[ConfigFileUpdateInstructions][here]].  *However, your old config.ini file can still be used  without any changes to configure your updated system.*

%BR%

*Important:*  The new configure-osg.py script requires the config file to be named config.ini.  There is no longer an option to allow a differently named file.  If you are currently using a file named something other than config.ini, rename it to config.ini now.

%BR%

*Important:* If you are using custom settings in your =osg-local-job-environment.conf=, you need to migrate those settings to the =Local Settings= section of the config.ini.  The =osg-local-job-environment.conf= will get overwritten with the settings from config.ini with this release.

%BR%

Now validate your config.ini file before running further steps:
   * =./monitoring/configure-osg.py -v= 
There are now extra ini files that are not needed.  You can delete the following in the monitoring directory if they are present:
   * =rm monitoring/simple-config.ini monitoring/full-config.ini monitoring/extract-config.ini= 

---+++ osg-version

There is a new package in this update that provides a script named osg-version which allows you to determine the osg and vdt version of your installation.  Running osg-version will give you the osg version (1.0.1 in this case).  This version should increment as new vdt updates come out.  In addition, =osg-version --verbose= will give you the osg version and the vdt version for your system.  Run:
   * =cd $VDT_LOCATION=
   * =pacman -get OSG:osg-version=


---++ Update with VDT-Updater script

The VDT team has created a new script that allows you to update an existing OSG 1.0.0 installation on a semi-automated fashion. (This is not for updating from OSG 0.8 or earlier.)  We recommend using this script since it will make the process much easier.  First, fetch the script
   * =pacman -get OSG:VDT-Updater= 

To ensure that you have that latest version of the VDT-Updater (even if you just ran the previous 'pacman -get' command), run:
   * =pacman -update VDT-Updater=

Then make a complete backup - do not skip this step:
   * =cp -pr $VDT_LOCATION BACKUP-LOCATION= 

The updater script is going to verify the contents of your backup, so you should have a backup that is a file-level copy of the VDT installation. Do not use tar, for example, to make the backup or else the updater script will not be able to verify the backup for you.
Finally, run the updater script:
   * =vdt/update/vdt-updater=
The update script may ask you some questions, including if you want to run =configure-osg.py=.  If you choose to run that, make sure that you have setup your config.ini file (instructions above).  

When the update completes successfully:
   * If you skipped the updater run of =configure-osg.py=, do it manually now to finish configuration:
      * =./monitoring/configure-osg.py -v= 
      * =./monitoring/configure-osg.py -c=
   * Verify that the services you want to run are enabled:
      * =vdt-control --list=
   * Then turn the services on:
      * =vdt-control --on=


---++ Update manually with Pacman

Follow the [[http://vdt.cs.wisc.edu/releases/1.10.1/release-v-manual.html][instructions]] provided by the VDT team.  Due to the complexity and the opportunity for error, *we don't recommend using this method*. Again, this is a process for updating from OSG 1.0.0 not from OSG 0.8.

Run the following commands to finish the configuration.  The first command will validate your configuration in the config.ini file, the second command will apply the configuration.
   * =./monitoring/configure-osg.py -v= 
   * =./monitoring/configure-osg.py -c=

Once the update procedure has been completed, turn the services back on:
   * Verify that the list of services you want to run are enabled:
      * =vdt-control --list=
   * Then turn the services on:
      * =vdt-control --on=

---++ Known issues
   * Updates prior to OSG 1.0.0 are not supported.

---++ More information
   * [[http://vdt.cs.wisc.edu/releases/1.10.1/release-v.html][VDT update instructions]]


%BR%
%COMPLETE3% %BR%
%RESPONSIBLE% Main.SuchandraThapa - 22 Apr 2009 %BR%
%REVIEW% Main.KeithJackson - 21 Jul 2009  %BR%
%REVFLAG% %X% %BR%

---++ *Comments*
%COMMENT{type="tableappend"}%

%META:TOPICMOVED{by="RobGardner" date="1240596369" from="ReleaseDocumentation.UpgradeInstructions" to="ReleaseDocumentation.UpdateInstructions"}%
