%META:TOPICINFO{author="IwonaSakrejda" date="1254462382" format="1.1" reprev="1.7" version="1.7"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! *<nop>%SPACEOUT{%TOPIC% Server Installation}%*
%TOC%

---++Introduction

The gsiftp package contains components necessary to set up a stand-alone gsiftp server and tools necessary to monitor and report its performance.
%BLUE% xxx %ENDCOLOR%

---++++++!! Applicable Versions
This document applies to an install of 
%RED%
*osg-version 1.2.3* 
%ENDCOLOR%
(or higher) and 
%RED%
*vdt-version  2.0.0*
%ENDCOLOR%
(or higher).

---++++++!!Engineering Considerations
It is recommended that the gsiftp package be installed on its own server.  A stand-alone gsiftp server might be used under the following circumstances:
   * A simple front-end to a filesystem - not a production solution.
   * Bestman is capable of distributing its workload among several gsiftp servers so if you expect large movements of data into/out of your site, multiple gsiftp servers can be set up.
%BLUE%
More suggestions??????
%ENDCOLOR%

---++Checklist
   1. [[PacmanInstall][pacman]] %PACMAN_VERSION% installed at $PACMAN%PACMAN_VERSION%
   1. host certificate installed in =/etc/grid-security/=
   1. storage filesystem mounted on the server
   1. check (and open) ports for authentications with ftp server (typically 2811) and for the data transfers (high ports typically in range 32769-65535).

---++Installation Procedure
Login as root and set up pacman environment:
<pre class="screen">
su root
source $PACMAN%PACMAN_VERSION%/setup.sh
</pre>
Set The GUMS server location if you are planning to use GUMS for authentication.
<pre class="screen">
export VDT_GUMS_HOST=osp3.lbl.gov
</pre>
Create a directory where the software will be located and download it there:
<pre class="screen">
mkdir /opt/osg/osg-%OSG_VERSION%-gsiftp/
cd /opt/osg/osg-%OSG_VERSION%-gsiftp/
pacman -get %CACHE%:GridFTP
</pre>

Configure newly downloaded environment, verify downloaded versions are what you expected, and that the VDT version is correct.
<pre class="screen">
source setup.sh
vdt-post-install
vdt-control --list
vdt-version
</pre>

Set up CA certificates:
<pre class="screen">
$VDT_LOCATION/vdt/bin/vdt-ca-manage setupca --location local -url osg
</pre>

Set up GUMS authorization:
<pre class="screen">
cp $VDT_LOCATION/post-install/prima-authz.conf /etc/grid-security
cp $VDT_LOCATION/post-install/gsi-authz.conf /etc/grid-security
</pre>

Edit both the files below by entering the transfer ports (high opened ports) and un-commenting the associated lines:

   * $VDT_LOCATION/vdt/etc/vdt-local-setup.sh
   * $VDT_LOCATION/vdt/etc/vdt-local-setup.csh


---++ Service Startup and Validation
Enable and start services:
<pre class="screen">
vdt-control --enable fetch-crl vdt-rotate-logs vdt-update-certs gsiftp gratia-gridftp-transfer gums-host-cron  
vdt-control --on
</pre>

Run =gums-host-cron= to create account-to-vo mapping and verify that the file was created and that the mappings between VOs and accounts in the file looks ok:
<pre class="screen">
$VDT_LOCATION/gums/scripts/gums-host-cron --gumsdebug
ls -l /opt/osg/osg-1.2-gsiftp/osg/etc/osg-user-vo-map.txt 
cat /opt/osg/osg-1.2-gsiftp/osg/etc/osg-user-vo-map.txt 
</pre>

On the glient host run the globus-url-copy to verify the gsiftp service can successfully transfer a file:
<pre class="screen">
globus-url-copy file:///etc/hosts  gsiftp://osp1.lbl.gov/tmp/hostscopy
</pre>

%BLUE%
Verify rsv probes are working:
%ENDCOLOR%
---++Caveates/Known Issues

---++Comments
%COMMENT{type="tableappend"}%

%STOPINCLUDE%
%BR%
%COMPLETE1% %BR%
%RESPONSIBLE% Main.IwonaSakrejda - 17 Sep 2009 %BR%
%REVIEW%
