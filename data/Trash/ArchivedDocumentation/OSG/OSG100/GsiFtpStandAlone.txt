%META:TOPICINFO{author="JamesWeichel" date="1254250348" format="1.1" reprev="1.6" version="1.6"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! *<nop>%SPACEOUT{%TOPIC% Server Installation}%*
%TOC%

---++Introduction

The gsiftp package is 
%BLUE% xxx %ENDCOLOR%

---++++++!! Applicable Versions
The applicable software versions for this document are 
%RED%
*osg-version 1.2.3* 
%ENDCOLOR%
(or higher) and 
%RED%
*vdt-version  2.0.0*
%ENDCOLOR%
(or higher).

---++++++!!Engineering Considerations
It is recommended that the gsiftp package be installed on its own server.  If you expect large movements of data into/out of your site, multiple gsiftp servers can be set up.
%BLUE%
Fix this to what it should be.  Are there any guidelines for when multiple servers are necessary?
%ENDCOLOR%

---++Checklist
   1. pacman %PACMAN_VERSION% installed at $PACMAN%PACMAN_VERSION%
   1. host certificate installed in =/etc/grid-security/=
   1. storage filesystem mounted on the server
   1. check (and open) ports for communication with ftp server (typically xxxx) and for the file transfers (high ports typically in range yyyy-zzzz).

---++Installation Procedure
Login as root and set up pacman environment:
<pre class="screen">
su root
source $PACMAN%PACMAN_VERSION%/setup.sh
</pre>
Set The GUMS server location if you are planning to use GUMS for authentication.
<pre class="screen">
export VDT_GUMS_HOST=osp3.lbl.gov
</pre>
Create a directory where the software will be located and download it there:
<pre class="screen">
mkdir /opt/osg/osg-%OSG_VERSION%-gsiftp/
cd /opt/osg/osg-%OSG_VERSION%-gsiftp/
pacman -get %CACHE%:GridFTP
</pre>

Configure newly downloaded environment, verify downloaded versions are what you expected, and that the VDT version is correct.
<pre class="screen">
source setup.sh
vdt-post-install
vdt-control --list
vdt-version
</pre>

Set up CA certificates:
<pre class="screen">
$VDT_LOCATION/vdt/bin/vdt-ca-manage setupca --location local -url osg
</pre>

Set up GUMS authorization:
<pre class="screen">
cp $VDT_LOCATION/post-install/prima-authz.conf /etc/grid-security
cp $VDT_LOCATION/post-install/gsi-authz.conf /etc/grid-security
</pre>

Edit both the files below by entering the transfer ports (high opened ports) and un-commenting the associated lines:
<pre class="screen">
$VDT_LOCATION/vdt/etc/vdt-local-setup.sh
$VDT_LOCATION/vdt/etc/vdt-local-setup.csh
</pre>

---++ Service Startup and Validation
Enable and start services:
<pre class="screen">
vdt-control --enable fetch-crl vdt-rotate-logs vdt-update-certs gsiftp gratia-gridftp-transfer gums-host-cron  
vdt-control --on
</pre>

Run =gums-host-cron= to create account-to-vo mapping and verify that the file was created and that the mappings in the file looks ok:
<pre class="screen">
$VDT_LOCATION/gums/scripts/gums-host-cron --gumsdebug
ls -l /opt/osg/osg-1.2-gsiftp/osg/etc/osg-user-vo-map.txt 
cat /opt/osg/osg-1.2-gsiftp/osg/etc/osg-user-vo-map.txt 
</pre>

Run =xx= to verify the gsiftp service can successfully transfer a file:
<pre class="screen">
xx
</pre>

%BLUE%
Verify rsv probes are working:
%ENDCOLOR%
---++Caveates/Known Issues

---++Comments
%COMMENT{type="tableappend"}%

%STOPINCLUDE%
%BR%
%COMPLETE1% %BR%
%RESPONSIBLE% Main.IwonaSakrejda - 17 Sep 2009 %BR%
%REVIEW%
