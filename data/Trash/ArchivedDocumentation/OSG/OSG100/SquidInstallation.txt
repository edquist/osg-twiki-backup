%META:TOPICINFO{author="BrianBockelman" date="1486495294" format="1.1" version="1.24"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! *<noop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

A guide to installing squid from the %CACHE% cache.

---++ Introduction

The OSG and ITB caches both provide squid pacman packages.  Squid is a web caching service that speeds up downloads from http servers by locally caching files and serving the cached files rather than retrieving the files over the internet.  Due to the disk and memory requirements for squid, the typical use case would be for squid to be installed on a single server on a cluster with CE nodes using that server to proxy http and https requests.  Tests that were done in the ITB with Squid server on the same node as the CE led to rapid crash of the CE, therefore it is strongly recommended to install the Squid server on a different node from the gatekeeper.

Squid will need to be installed as the root user and should have 2 or more gigabytes of disk space dedicated to it for caching purposes and at least 512MB of memory (1 GB or more of memory is preferable).
 

---++ Download and installation
There are several options for installing squid.  It may be available as part of your linux distribution; you may install it using vdt; or you may install it with your CE.   We will cover installing squid using vdt or as part of your CE in this documentation.  Both of these options will install squid via pacman; first [[Trash.ReleaseDocumentationPacmanInstall][install pacman]], if you have not done so already.

Install squid using the following command either in an empty directory if you are installing squid on a standalone machine or in the directory with your CE installation if you are installing it on your CE.

<pre class="screen">
# <b>pacman -get %CACHE%:squid </b>
</pre>

---++ Configuration on a standalone host

If you are installing squid on a standalone machine, you can configure and enable it by using the following commands in the directory where squid was installed.
<pre class="screen">
# <b>source setup.sh</b>
# <b>./vdt/setup/configure_squid -server y --mem-cache-size 512 --disk-cache-size 1024</b>
# <b>vdt-control --on squid</b>
</pre>

When you run =configure-osg.py= on your CE, you should set the enable option to =True= in the =Squid= section of the configuration file that it uses.  In addition you should fill in the size of the caches that squid uses in that section.

---++ Configuration on a CE 

%IMPORTANT% This configuration is not recommended for a CE that gets more than a small amount of use.  

If you are installing squid in the same directory as your CE then, you can run =configure-osg.py= and indicate that you have squid installed on the localhost by setting the location to localhost.

---++ Configuration for CRL updates

To make the fetch-crl script use the Squid proxy for caching CRL update requests, add your squid
location to =/etc/sysconfig/fetch-crl=:

<pre class="screen">
http_proxy=http://my.squid.server:3128
export http_proxy
</pre>

The http replies from some of the CRL servers (such as crl.swisssign.net)
don't specify any expiration or last-modified information, so
squid assumes the response shouldn't get cached.  You can configure
squid to use a small freshness setting for such replies with the
refresh_pattern setting:

<pre class="screen">
#  TAG: refresh_pattern
#       usage: refresh_pattern [-i] regex min percent max [options]
#
#       By default, regular expressions are CASE-SENSITIVE.  To make
#       them case-insensitive, use the -i option.
#
#       'Min' is the time (in minutes) an object without an explicit
#       expiry time should be considered fresh. The recommended
#       value is 0, any higher values may cause dynamic applications
#       to be erroneously cached unless the application designer
#       has taken the appropriate actions.

refresh_pattern .               5       20%     4320
</pre>

The '5' in the above configuration line is normally set to '0'.  5 or 10
minutes is probably a good value to use if you want to cache these CRLs.
 Be careful if you use this as a general proxy, though, as the comment
in the squid documentation warns that this may erroneously cache dynamic
content that you don't want cached.

%BR%
%COMPLETE3% %BR%
%RESPONSIBLE% Main.SuchandraThapa - 18 Oct 2007 %BR%
%REVIEW% Main.AlainRoy 

%META:TOPICMOVED{by="AnneHeavey" date="1192741358" from="Integration/ITB_0_7.CESquidInstallation" to="Integration/ITB_0_7.SquidInstallation"}%
