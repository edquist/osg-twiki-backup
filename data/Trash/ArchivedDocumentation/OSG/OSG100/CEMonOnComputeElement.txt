%META:TOPICINFO{author="JohnWeigand" date="1161712876" format="1.1" reprev="1.3" version="1.3"}%
%META:TOPICPARENT{name="CEInstallGuide050"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->
d78 1
---+!!<nop>CEMon Installation / Activation
%TOC%
%STARTINCLUDE%
---+++CEmon
<div class="twikiSmall" style="text-align: left; font-style: italic;"><a href="%SCRIPTURLPATH%/edit%SCRIPTSUFFIX%/%WEB%/%TOPIC%?t=%SERVERTIME{ "$epoch" }%">Edit this section</a></div>

The [[http://grid.pd.infn.it/cemon/field.php][CEMon]] (CEMonitor) service is responsible for providing information coming from the Computing Element (CE) and is being implemented as an optional component in the OSG Compute Element (CE) architecture in support of the [[ResourceSelection.WebHome][ReSS (Resource Selection Service) OSG project]].  This service is capable of collecting the CE resource information by using [[http://lfield.home.cern.ch/lfield/cgi-bin/wiki.cgi?area=gip&page=documentation][Generic Information Provider]] (GIP).. A properly installed and configured CEMonitor service pushes collected information in classad format to a central [[ResourceSelection.WebHome][Information Gatherer]] (IG) running on designated host (<i>osg-ress-1.fnal.gov</i>). IG advertises these classads to the [[http://www.cs.wisc.edu/condor][Condor Match Maker]] service.

    :

d78 1
---++++Activating CEMon
The <nop>CEMon package is installed, configured and activated automatically when you run the <i>configure-osg.sh</i> script.  CEMon uses both <i>apache</i> and <i>tomcat-5</i>.  

---+++++CEMon for OSG 0.5.0
<OL><LI>Copy the startup scripts to <i>/etc/init.d</i>
---+++++CEMon for OSG 0.5.1
The <nop>CEMon package is installed and configured, but not activated, with this release.  CEMon uses both <i>apache</i> and <i>tomcat-5</i>.  To activate it, you will need to (<b>as root</b>):

<OL>
<LI>Copy the startup scripts to <i>/etc/init.d</i>
<pre>
&gt;  cd /etc/init.d
&gt;  cp $VDT_LOCATION/post-install/apache /etc/init.d/.  
&gt;  cp $VDT_LOCATION/post-install/tomcat-5 /etc/init.d/.  
</pre>
        <LI>Activate the services so, they will automatically start when the node is booted.
</pre>
&gt;  chkconfig --add  apache
&gt;  chkconfig  apache on 
&gt;  chkconfig --add  tomcat-5
&gt;  chkconfig  tomcat-5 on 
</pre>
</OL>
<pre>
</pre></li>
Check the <i>tomcat</i> <i>CEMon</i> log file, <i>$VDT_LOCATION/tomcat/v5/logs/glite-ce-monitor.log</i> for this entry:
   $ %I% %RED% *NOTE* %ENDCOLOR%: _<nop>CEMon_ requires an =/etc/grid-security/grid-mapfile= to exist.  It can be an empty file, but it must exist.   The =$VDT_LOCATION/vdt/setup/configure_cemon= script checks for this and creates an empty one, if none exists.

---++++Verifying CEMon is functional
Check the <i>tomcat</i> <i>CEMon</i> log file, =$VDT_LOCATION/tomcat/v5/logs/glite-ce-monitor.log= for this entry:
<pre class="programlisting">
<pre>
Once you've started publishing to the CEMon server, you might want to verify the information.  You can do this my running:
       Client CN=osg-ress-4.fnal.gov, OU=Services, DC=doegrids, DC=org accepted
</pre>
         --pool osg-ress-1.fnal.gov \
         --constraint "GlueCEInfoHostName == \"YOUR_HOST_NAME\"" 

Once you've started publishing to the <nop>CEMon server, you might want to verify the information.  You can do this by running:

<pre>
         -pool osg-ress-4.fnal.gov \
  <b><i>(remember to change YOUR_HOST_NAME with your fully
---++++CEMon configuration files
The configuration of CEMon is done for you in the <i>configure_cemon</i> script.  This section is intended to highlight the key changes made by that script.  
<UL>
<LI>$VDT_LOCATION/glite/etc/glite-ce-monitor/cemonitor-config.xml<br>
       
 <b>Remember to change YOUR_HOST_NAME with your fully
</UL>
a184 1
---++++Troubleshooting CEMoncemonitor-config.xml
<OL>
<LI>The first thing you will want to do is verify <i>apache</i> and  <i>tomcat</i> are running.

Be prepared for a lot of output if you are successful.


---++++Troubleshooting CEMon
The first thing you will want to do is verify <i>apache</i> and  <i>tomcat</i> are running.

<pre>
If <i>apache/tomcat</i> are not running, restart them and re-verify.<br>
       certificate.)</b></i>
<UL><LI><b>apache</b> - <i>$VDT_LOCATION/apache/logs directory
         <LI><b>tomcat</b> - </i>$VDT_LOCATION/tomcat/v5/logs/catalina.out
</UL>
d130 2
<LI><i>CEMon</i> requires an <i>/etc/grid-security/grid-mapfile</i> to exist.  It can be an empty file, but it must exist.  If you see this java execption in your <i>$VDT_LOCATION/tomcat/v5/logs/glite-ce-monitor.log</i> file, you will need to create an empty <i>grid-mapfile</i>.
<pre>
20 Oct 2006 14:57:36,017 org.glite.ce.commonj.configuration.basic.AuthZConfigParser - gridMapFileNotFound
org.glite.security.authz.InitializeException: gridMapFileNotFound
    :
</pre>
The  <i>$VDT_LOCATION/vdt/setup/configure_cemon</i> script checks for this and creates an empty one, if none exists.  It is automatically run during the OSG 0.5.1 installation process.  So this should not  normally be a problem, but you should be aware of it.

<LI>If you do not have an HTTP certificate in <i>/etc/grid-security/http/httpcert.pem(httpkey.pem)</i> file or a symlink to one from that location, you will see this message in the <i>$VDT_LOCATION/tomcat/v5/logs/glite-ce-monitor.log</i> file.  The correct ownershop is critical, as well.
<pre>
20 Oct 2006 15:22:26,391 org.glite.security.util.DirectoryList - 
          No files found matching /etc/grid-security/http/httpcert.pem
20 Oct 2006 15:22:26,391 org.glite.security.util.FileCertReader - 
          Error while reading certificates or CRLs: No files found matching /etc/grid-security/http/httpcert.pem
    :
20 Oct 2006 15:22:26,393 org.glite.ce.monitor.holder.NotificationHolder - 
          Connection refused by the Consumer (https://osg-ress-1.fnal.gov:8443/ig/services/CEInfoCollector)
</pre>
The <i>CEMon</i> configuration file <i>$VDT_LOCATION/glite/etc/glite-ce-monitor/cemonitor-config.xml</i> contains the entry for where the HTTP certificate and your <i>TRUSTED_CA</i>'s should exist.  The default installation is shown here:
<pre>
&lt; service id="main-service"
         description="cemonitor service"
         sslkeyfile="/etc/grid-security/http/httpkey.pem"
         sslcertfile="/etc/grid-security/http/httpcert.pem"
         sslkeypasswd=""
         sslCAfiles="/storage/local/data1/osg-ce/globus/TRUSTED_CA/*.0"
         &gt;
</pre>
You can, of course, make the change here.  If you do, you need to restart <i>tomcat</i>.

<LI>If you see a message in the <i>glite-ce-monitor.log</i> message indicating "Connection refused".
<pre>
20 Oct 2006 16:13:33,700 org.glite.ce.monitor.holder.NotificationHolder - 
     Connection refused by the Consumer 
     (https://osg-ress-1.fnal.gov:8441/ig/services/CEInfoCollector)   
              <b><i>Example above shows wrong port</i></b>
</pre>
Verify the URL in the message,
  <UL>
    <LI>Using a browser that contains a valid grid certificate,  cut and paste the url shown in the message. The following should appear if CEMon is working.
<pre>
CEInfoCollector
Hi there, this is an AXIS service!
Perhaps there will be a form for invoking the service here...
</pre>
    <LI>If it does not appear correct, <i>ping</i> the hostname.  
    <LI>If the above indicate <i>connection refused</i>, then contact  WHO DO I CONTACT
   </UL>
d168 2
</OL>
%NOTE% The head process is normally owned by root. The child processes' user should be the owner of the http certificate.

%EDITTABLE{ head="| *Message* | *Resolution* |" format="| text | text |" changerows="on" editbutton="Edit table"}%
| *Message* | *Resolution* |
| =gridMapFileNotFound exception= | Since <i>CEMon</i> requires a <i>grid-mapfile</i>, create an empty =/etc/gird-security/grid-mapfile.= |
| =No files found matching /etc/grid-security/http/httpcert.pem=  %BR%%BR% <em>or</em> =Error while reading certificates or CRLs: No files found matching /etc/grid-security/http/httpcert.pem= %BR%%BR% <em>or</em> =Connection refused by the Consumer (<nop>https:&lt;The_ReSS_Server&gt;)= | If you do not have an HTTP certificate in =/etc/grid-security/http/httpcert.pem(httpkey.pem)= file or a symlink to one from that location, you will see these  messages.   The correct ownershop is critical, as well.  The http certificates are defined in the  <i>cemonitor-config.xml</i>  and <i>ce-monitor.xml</i> files of the =$VDT_LOCATION/glite/etc/glite-ce-monitor= directory. |
| =Connection refused by the Consumer= | Verify the URL in the message. Using a browser that contains a valid grid certificate,  cut and paste the url shown in the message. The following should appear if CEMon is working. %BR% =CEInfoCollector %BR% Hi there, this is an AXIS service! %BR% Perhaps there will be a form for invoking the service here...= %BR% If it does not appear correct, <i>ping</i> the hostname. |



-- Main.JohnWeigand - 20 Oct 2006
%INCLUDE{"WhuReferences"}%

-- Main.JohnWeigand - 20 Oct 2006<br>
%INCLUDE{"Integration.WhuReferences"}%
-- Main.JohnWeigand - 20 Oct 2006 %BR% 



%META:TOPICMOVED{by="ForrestChristian" date="1166041027" from="Integration.CENodeCEMon050" to="Integration/ITB_0_5.CENodeCEMon"}%
