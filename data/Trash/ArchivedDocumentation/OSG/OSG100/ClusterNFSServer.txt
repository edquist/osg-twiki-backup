%META:TOPICINFO{author="RobGardner" date="1256377819" format="1.1" reprev="1.4" version="1.4"}%
%META:TOPICPARENT{name="GridColombiaWorkshop2009"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

---++ Introduction
   * We'll setup a shared file system using NFS as discussed in SitePlanning.
   * The NFS server is =tg1-nfs=, all other hosts import the home directories and some service directories
   * NFS directories are mounted on =/nfs= and linked to the required destination to make the configuration more explicit

---++ Directories exported
   * =/home= - Home directories for grid users (osg, osgedu, usatlas1, ...), condor user and any local user
   * =/condor= - Condor installation directories. It may have a subdirectory for each Condor version installed

---++ Configuration of the NFS server
   * gs1-nfs is setup to export its directories under /exports
      * exported separately because some will be ro on worker nodes
      * =vi /etc/exports=
      * Configuring NFS:<pre>
vi /etc/exports # exported to the subnet async,no_root_squash,rw
chkconfig --level 3 nfs on
chkconfig --level 5 nfs on
/etc/init.d/nfs start
</pre>
      * local mount tested
      * on =tg1-nfs= the directories are linked, not mouned
   * on another machine (=tg1-ce=, some tests on the worker node) configure the import    
      * edit =/etc/fstab=
      * prepare =fstab._addon.tg1= to replicate on other machines (appending it to /etc/fstab)
      * create directories and links
      * disable iptables (this can be revisited later by opening up ports used by needed services)
      * prepare a script to automate part of the process (part of make-dirs.gs1) =make-dirs.tg1=: Create directories and links used for NFS configuration, disable iptables<pre>
# cat gs1-files/make-dirs.gs1 
mkdir ~/.ssh
cp gs1-files/authorized_keys.gs1-host ~/.ssh/authorized_keys
mkdir /nfs
mkdir /nfs/condor
mkdir /scratch
mkdir /scratch/condor
mkdir /nfs/home
mkdir /nfs/certificates
mkdir /nfs/osg
chkconfig --list iptables
chkconfig iptables off
ls /opt/
mv /home /home.orig
ln -s /nfs/home /home
ln -s /nfs/condor/condor /opt/condor
mkdir /share
ln -s /nfs/osg /share/osg
mkdir /etc/grid-security
ln -s /nfs/certificates /etc/grid-security/certificates
history > history.${HOSTNAME}
</pre>
   * propagate the changes to the rest of the cluster (pushing the script and running it)
   * Customization NFS options
      *  For worker nodes, use =ro=

%BR%
%COMPLETE1% %BR%
%RESPONSIBLE% Main.RobGardner - 23 Oct 2009 %BR%
%REVIEW%

---++ *Comments*
%COMMENT{type="tableappend"}%

<!--
   * Set USERSTYLEURL = https://twiki.grid.iu.edu/twiki/pub/ReleaseDocumentation/GridColombiaWorkshop2009/centerpageborder.css
-->
