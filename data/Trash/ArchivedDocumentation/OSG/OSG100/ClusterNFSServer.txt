%META:TOPICINFO{author="MarcoMambelli" date="1256341548" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="GridColombiaWorkshop2009"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

---++ Introduction
   * We'll setup a shared file system using NFS as discussed in SitePlanning.
   * The NFS server is =tg1-nfs=, all other hosts import the home directories and some service directories
   * NFS directories are mounted on =/nfs= and linked to the required destination to make the configuration more explicit

---++ Directories exported
   * home - home directories for grid users (osg, osgedu, usatlas1, ...), condor user and any local user
   * condor - condor installation directories. It may have a subdirectory for each Condor version installed
   * osg

---++ Configuration of the NFS server
   * gs1-nfs is setup to export its directories under /exports
      * exported separately because some will be ro on worker nodes
      * vi /etc/exports
      * nfs configured:
<pre>
vi /etc/exports # exported to the subnet async,no_root_squash,rw
chkconfig --level 3 nfs on
chkconfig --level 5 nfs on
/etc/init.d/nfs start
</pre>
      * local mount tested
      * on gs1-nfs directories are linked, not mouned
   * on another machine (gs1-ce, some test on wn) configure the import    
      * edit /etc/fstab
      * prepare fstab._addon.gs1 to replicate on other machines (appending it to /etc/fstab)
      * create directories and links
      * disable iptables (was interfering)
      * prepare a script to automate part of the process (part of make-dirs.gs1)
make-dirs.gs1: Create dirs and links used for NFS configuration, disable iptables
<pre>
# cat gs1-files/make-dirs.gs1 
mkdir ~/.ssh
cp gs1-files/authorized_keys.gs1-host ~/.ssh/authorized_keys
mkdir /nfs
mkdir /nfs/condor
mkdir /scratch
mkdir /scratch/condor
mkdir /nfs/home
mkdir /nfs/certificates
mkdir /nfs/osg
chkconfig --list iptables
chkconfig iptables off
ls /opt/
mv /home /home.orig
ln -s /nfs/home /home
ln -s /nfs/condor/condor /opt/condor
mkdir /share
ln -s /nfs/osg /share/osg
mkdir /etc/grid-security
ln -s /nfs/certificates /etc/grid-security/certificates
history > history.${HOSTNAME}
</pre>
   * propagate the changes to the rest of the cluster (pushing the script and running it)
   * do some host customization (ro on workernodes)

---+++ Accounts creation
Account must be created on a host (gs1-ce) 
   * account creation with useradd (condor, gsadmin, gsuser, osg, osgedu, marco)
   * creation of addon files (to append):
      * group._addon.gs1 
      * passwd._addon.gs1  
      * shadow._addon.gs1 (shadov is write protected)
   * push the files to al the hosts, append them to the corresponding files
   * check the files manually



%BR%
%COMPLETE1% %BR%
%RESPONSIBLE% Main.RobGardner - 23 Oct 2009 %BR%
%REVIEW%

---++ Comments
%COMMENT{type="tableappend"}%