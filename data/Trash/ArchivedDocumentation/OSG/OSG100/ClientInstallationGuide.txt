%META:TOPICINFO{author="RobGardner" date="1248193565" format="1.1" reprev="1.36" version="1.36"}%
---+!! *<noop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%



---++ Preliminaries
This process assumes that you have already [[Documentation/CertificateGet][obtained a grid certificate]] from an OSG-recognized Certificate Authority and joined an OSG Virtual Organization. If you have not, you will not be able to complete this process.

See %VDT_DOCS_URL% for system requirements.  If you do a non-root install, make sure that you own your =$HOME/.globus= directory and its permissions are 755.  Use [[PacmanInstall][Pacman]] to install the client and consult PacmanBestPractices if you have trouble.  You'll need a personal grid certificate to use the installation.

---++ Install the OSG client
Create a directory for the client and =cd= to it, such as:

<pre class="screen">
[~]$ <userinput>mkdir osg-client</userinput>
[~]$ <userinput>cd osg-client/</userinput>
</pre>

And install:

<pre class="screen">
[~/osg-client]$ <userinput>pacman -get %CACHE%:client</userinput>
Do you want to add [http://software.grid.iu.edu/pacman/] to [trusted.caches]? (y or n): <userinput>y</userinput>
Do you want to add [http://vdt.cs.wisc.edu/vdt_1101_cache] to [trusted.caches]? (y or n): <userinput>y</userinput>
</pre>

The display will be self-overwriting of package checks, eventually continues with:

<!-- After the installation has completed, you will also be able to... -->

<pre class="screen">
VDT 1.10.1 installs a variety of software, each with its own license.
In order to continue, you must agree to the licenses.
You can view the licenses online at:

     http://vdt.cs.wisc.edu/licenses/1.10.1

After the installation has completed, you will also be able to
view the licenses in the "licenses" directory.

Do you agree to the licenses? [y/n] <userinput>y</userinput>

</pre>

Answer =y= to continue the installation.

The following installation questions will differ depending if the installation is performed as 'root' user or not. Choose the section that applies to you.

---+++Installing as regular user
<pre class="screen">
The VDT typically installs public certificates and signing policy files 
for the well-known public CA's. This is necessary in order for you to 
perform GSI authentication with any remote Grid services (that have 
service/host certificates signed by these CA's).

For more information please refer to the VDT documentation:
http://vdt.cs.wisc.edu/releases/1.10.1/setup_ca.html

Where would you like to install CA files?

Choices:
	l (local) - install into $VDT_LOCATION/globus/share/certificates
	n (no)    - do not install
l
</pre>

Choose =l= to have a local installation completely self-contained.

Now go to the final installation steps.

---+++Installing as root
<pre class="screen">

If you would like, we can configure the Condor batch system to
start automatically at boot time.

Configuring the Condor daemon requires changes to
- /etc/init.d (or /etc/rc.d/init.d)

Would you like to enable the Condor batch system to run automatically?

Possible Answers:
     y: Yes. I want the service to run automatically (once enabled)
     n: No. I do NOT want the service to run automatically

Note: Services are enabled with vdt-control; see 'post-install/REAME'.
<userinput>y</userinput>
</pre>

Answer =y= to enable startup of Condor.  This Condor installation is for submitting jobs to remote sites. It is not expected to be a server installation for receiving jobs. If you are submitting jobs from a machine that is also receiving jobs with Condor, answering "yes" to this will *not* overwrite the server Condor. Only your condor-g will be affected.

<pre class="screen">

The VDT typically installs public certificates and signing policy files 
for the well-known public CA's. This is necessary in order for you to 
perform GSI authentication with any remote Grid services (that have 
service/host certificates signed by these CA's).

For more information please refer to the VDT documentation:
http://vdt.cs.wisc.edu/releases/1.10.1/setup_ca.html

Where would you like to install CA files?

Choices:
        r (root)  - install into /etc/grid-security/certificates
                   (existing CA files will be preserved)
        l (local) - install into $VDT_LOCATION/globus/share/certificates
        n (no)    - do not install

<userinput>l</userinput>
</pre>

Answer =l= (lowercase "L") so that the CA files will be installed inside of your installation directory.


<pre class="screen">
Do you want to run a cron job that will update the CA certificate
revocation lists automatically? This will use the fetch-crl program
that comes with the VDT. The cron job will run at a random time
between midnight and 6:00am. We select a random time to avoid having
all VDT installations fetching CRLs at the same time.

Do you want to update the CA certification revocation lists (CRLs) automatically
? [y/n] <userinput>y</userinput>
</pre>

Often, you will need CRLs for a client installation.  You can choose "y" to enable now or enable later via ==vdt-control== as needed.
 
<pre class="screen">
Several services provided by the VDT create unbounded log files.  If you wish, we can rotate those file on a daily basis.

Would you like to setup daily rotation of VDT log files?

Possible Answers:
     y: Yes. I want the service to run automatically (once enabled)
     n: No. I do NOT want the service to run automatically

Note: Services are enabled with vdt-control; see 'post-install/REAME'.

<userinput>n</userinpu>
</pre>

Often, log files associated with client services will not grow large.  You can answer "no" here and enable later via ==vdt-control== as needed.

<pre class="screen">

Do you want to automatically update your CA certificates? If so,
we will check for updates once a day via cron.

Do you want to automatically update your CA Certificates? [y/n] 
</pre>

Since the client codes do regularly require CA certificates, you should answer "yes" to this automatic update feature.


---+++Final installation steps
This part applies to both root and regular user installation.

Before installing the packages this reminder is printed:
<pre class="screen">
========== IMPORTANT ==========
The VDT no longer installs certificate authority certificates at install time.
Most of the software installed by the VDT *will not work* until you install
certificates.  To complete your CA certificate installation, see the notes
in the post-install/README file.
</pre>

If all goes well, the client's pacman installation will complete with the following output:

<pre class="screen">
The VDT version 1.10.1v has been installed.

The OSG Client package %CACHE% version 1.0.1 has been installed.
</pre>

Some last steps have to be performed to select the certificates and complete the installation.

Now you have to install the CE certificates: after sourcing the setup file, edit vdt-update-certs.conf choosing OSG certificates (uncomment the line shown below) and run the certificate setup script:

<pre class="screen">
> source setup.sh
> vi $VDT_LOCATION/vdt/etc/vdt-update-certs.conf
</pre>

<pre class="screen">
# Uncomment the following line to get the CAs from the OSG
cacerts_url = http://software.grid.iu.edu/pacman/cadist/ca-certs-version
</pre>

<pre class="screen">
> source $VDT_LOCATION/vdt-questions.sh; $VDT_LOCATION/vdt/sbin/vdt-setup-ca-certificates
vdt-update-certs
  Log file: /ecache/share/osg-client090713/vdt/var/log/vdt-update-certs.log
  Updates from: http://software.grid.iu.edu/pacman/cadist/ca-certs-version

Will update CA certificates from version unknown to version 1.8.
</pre>

%STARTOSG12%
The CA certificates installation procedure is diferent for OSG 1.2:
<pre class="screen">
> . ./setup.sh 
[uct3-edge5] /ecache/share/itbcli090713 > vdt-ca-manage setupca --location local --url osg
Setting CA Certificates for VDT installation at '/ecache/share/itbcli090713'

Setup completed successfully.
</pre>
%ENDOSG12%


If you encounter any problems, review the *vdt-install.log* file.  You can view what has been installed by running ==vdt-version==:

<pre class="screen">
> source <i>your-osg-client-dir</i>/setup.(c)sh
> vdt-version
You have installed a subset of VDT version 1.10.1d:
    CA Certificates v36 (includes IGTF 1.21 CAs)
    Condor/Condor-G 7.0.2
    cURL 7.18.0
    Fetch CRL 2.6.6
    Globus Toolkit, pre web-services, client 4.0.7
    Globus Toolkit, web-services, client 4.0.7
    GPT 3.2autotools2004-NMI-9.0
    GSI-Enabled OpenSSH 4.3
    Java 5 SDK 1.5.0_14
    lcg-info 1.11.0-1
    lcg-infosites 2.6-2
    Logrotate 3.7
    MyProxy 4.2
    Pegasus 2.1.0
    PPDG Cert Scripts 2.6
    pyGlobus gt4.0.1-1.13
    PyGlobus URL Copy 1.1.2.11
    RLS, client 3.0.041021
    SRM Fermi Client 1.8.0-15p3
    SRM Berkeley Client 2.2.0.10
    UberFTP 1.27
    Wget 1.11
</pre>


%STARTOSG12%
The version output for OSG 1.2 is:
<pre class="screen">
> source <i>your-osg-client-dir</i>/setup.(c)sh
> vdt-version

You have installed a subset of VDT version 2.0.0p5:

Software                                                 Status              
--------                                                 ------              
Bandwidth Test Controller 1.3                            OK                  
vdt-ca-manage 1.0                                        OK                  
vdt-update-certs 2.4                                     OK                  
CA Certificates 1.8 (includes IGTF 1.30 CAs)             -                   
CGSI-gSOAP 1.2.1.2                                       OK                  
Condor/Condor-G 7.2.4                                    OK                  
cURL 7.18.2                                              OK                  
Fetch CRL 2.6.6                                          OK                  
Globus Toolkit, pre web-services, client 4.0.8           OK                  
Globus Toolkit, web-services, client 4.0.8               OK                  
GPT 3.2-4.0.8p1                                          OK                  
GSI-Enabled OpenSSH 4.6                                  OK                  
Java 5 SDK 1.5.0_18                                      OK                  
lcg-info 1.11.4-1                                        OK                  
lcg-infosites 2.6-2                                      OK                  
LCG-Utils 1.6.11-1p1 (includes GFAL 1.10.11-1) 1.6.11-1p1 OK                  
LCG File Catalog Client 1.6.11.4                         OK                  
Logrotate 3.7                                            OK                  
MyProxy Client 4.7                                       OK                  
NDT 3.5.0                                                OK                  
Network Path and Application Diagnosis Client 1.5.5      OK                  
One-Way Active Measurement Protocol (One-Way Ping) 3.1   OK                  
Pegasus 2.3.0                                            OK                  
PPDG Cert Scripts 2.7                                    OK                  
pyGlobus gt4.0.1-1.13                                    OK                  
PyGlobus URL Copy 1.1.2.11                               OK                  
SRM Fermi Client 1.9.2-4                                 OK                  
SRM Berkeley Client 2.2.1.2.i7.p1                        OK                  
UberFTP 2.4                                              OK                  
VOMS Client 1.8.8-2p1                                    OK                  
Wget 1.11.4                                              OK                  


Status legend:
OK: Software is up to date with the latest release in VDT version 2.0.0
- : Not enough information to determine if updates are available.
See man page for more information.
</pre>
%ENDOSG12%

---++ Run a simple test of the installation

Now that the OSG Client has been installed, you will have to configure it with your grid user certificate in order to start submitting jobs.  Log in as a normal user, setup your environment and get a proxy certificate:
<pre class="screen">
> source <i>your-osg-client-dir</i>/setup.(c)sh
> voms-proxy-init .... <i>or</i> 
> grid-proxy-init ....
</pre>
Use *-help* in the proxy-init commands to find out options.  You will be prompted to enter your certificate password.

To make sure your proxy is working, pick a known node and run =globusrun=. The node shown is just an example:
<pre class="screen">
> globusrun -a -r testwulf.hpcc.ttu.edu
</pre>
If successful, this returns:
<pre class="screen">
GRAM Authentication test successful
</pre>

---++ Start services

This section applies only to clients installed as root.

Most of the client functionality are not provided by services but by client tools for running jobs and moving data. However, some services are routine processes under ==vdt-control== for starting and stopping the services.  To run these services,  logon as root or as the owner of the client package and source the setup script:
<pre class="screen">
# source <i>your-osg-client-dir</i>/setup.[c]sh
</pre>

You can determine which services are configured by running *vdt-control --list*. (For a more detailed review of turning VDT services on and off, consult [[http://vdt.cs.wisc.edu/releases/1.10.1/man/vdt-control.html][vdt-control]] and OSG StartingServices documentation written for the Compute Element).

If you answered questions as in the example install above, you will find:

<pre class="screen">
# vdt-control --list
Service            | Type   | Desired State
-------------------+--------+--------------
fetch-crl          | cron   | enable
vdt-rotate-logs    | cron   | do not enable
vdt-update-certs   | cron   | enable
condor             | init   | enable
globus-ws          | init   | do not enable

</pre>

For condor-g submissions: fetch-crl and =condor= as needed. Do not worry about =globus-ws= as it's inclusion is an artifact of the vdt installation and is disabled by default.  Turning on all enabled services is done by, ==vdt-contol --on==.

---++ Testing the Client

A series of validation tests of the client tools can be found in the ValidateClients documentation. These basic tests include querying services, submitting jobs, and transfering files.

---++  Firewall Considerations

Some GRAM job initiation and management operations require call backs to the client machine.

   * If your client host is behind a firewall and not registered in DNS, assign your client's ip-address to the =GLOBUS_HOSTNAME= variable: 
      * <pre class="screen">  export GLOBUS_HOSTNAME=<i>your-ip-address</i> </pre>
   * If your client is behind a firewall blocking ephemeral ports, an ephemeral port range should be intentified for use and opened for incoming connections.  Opening the port range may depend on your firewall implementation. If you are doing a personal non-root installation, check with your administrator to determine which ports are open for you to use.  Then, indentifying the port range in the client tools is done in two ways (numbers shown here are just examples):
      * specifiy the GLOBUS_TCP_PORT_RANGE variable in the $VDT_LOCATION/setup.sh (and setup.csh) script: <pre class="screen">
GLOBUS_TCP_PORT_RANGE=20000,22000
export GLOBUS_TCP_PORT_RANGE
</pre>
      * specify range in for use by Condor-g in the $CONDOR_CONFIG file ( *Note:* condor must be restarted):  <pre class="screen">
HIGHPORT = 22000 
LOWPORT  = 20000
</pre>

%BR%
%COMPLETE3% %BR%
%RESPONSIBLE% Main.MarcoMambelli - 13 Jul 2009 %BR%
%REVIEW% Main.RobertEngel - 21 Jul 2009 %BR%
%REVFLAG% %X%  %BR%


---++ *Comments*
%COMMENT{type="tableappend"}%

%META:TOPICMOVED{by="ForrestChristian" date="1166046231" from="Integration.ClientInstallationGuide050" to="Integration/ITB_0_5.ClientInstallationGuide"}%
