%META:TOPICINFO{author="ElizabethChism" date="1466010131" format="1.1" version="1.11"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

%STARTINCLUDE%

*Purpose*: The purpose of this document is to provide dCache based SE administrators the information on how to prepare, install and validate the SE.

---++ Preparation
---+++ Introduction

dCache is a disk-caching system jointly developed by Deutsches Elektronen-Synchrotron (DESY) and Fermi National Accelerator Laboratory (Fermilab). Although it was initially developed to provide disk caching for tertiary storage, dCache makes an excellent grid Storage Element (SE) &ndash; even without tape backend &ndash; because it has a [[https://srm.fnal.gov/twiki/bin/view/SrmProject/WebHome][Storage Resource Manager]] interface and supports multiple transfer protocols: gridftp, xrootd, dcap, and http. dCache also provides a single name space across the entire pool of disk servers, making it look like a single file system to the users. It simplifies administration by providing mechanisms for internal clean-up and load balancing, which allows efficient use of storage space and handling of users' requests.

dCache is a storage element implementation that meets the SRM v2.2 specification. dCache is not packaged with the base Virtual Data Toolkit installation, but is available through the VDT as a separately downloadable package. In addition, OSG provides Gratia storage and transfer probes for site and grid-wide monitoring. Recently, subset of [[http://datagrid.ucsd.edu/toolkit][community toolkit]] was added to vdt-dcache distribution.

The dCache distributed components are implemented with the Cells package. Cells communicate with each other and components of dCache are implemented as cells. Hardware resources on a dCache node depend on what cells are running on that node. For a detailed description of dCache cells and the resources they require, see <a target="_top" href="https://plone4.fnal.gov/P0/DCache/dcachedoc/cell-descriptions/">Descriptive Cell Listing</a>. !dCache also uses !PostgreSQL databases for SRM and [[https://twiki.grid.iu.edu/bin/view/Documentation/StorageDcachePnfs][Pretty Normal File System (PNFS)]] to provide transparent file access.

---+++ Architecture
The detailed dcache architecture is provided at [[http://www.dcache.org][dCache Project Home Page]].
Main dCache components are listed in the table below:
| *Component Name* | *Purpose* |
|Location Manager|Instructs a newly started domains to which domain they should connect |
|PNFS, Chimera| Name servers|
|PNFS Manager|Manages the name space functionality|
|Info Provider|Provides a description of a !dCache instance using the GLUE information model|
|!gPlasma|Manages authorization of the clients|
|!PoolManager|Selects which pool is used for an incoming request|
|!ResilientManager|Keeps track of the number of replicas of each file within a certain subset of pools and makes sure this number is always withina specified range|
|!SrmSpaceManager|Provides a standardized webservice interface for managing a storage resource. Provides means to reserve space, initiate file storage or retrieve, and replicate files to another SRM|
|Doors ||
|  dcap door|Supports dcap protocol|
|  gsiftp door|Supports !GridFTP protocols v1 and !GridFTP v2. |
|  gsidcap door|Supports dCap protocol with a GSI authentication wrapper|
|  xrootd door|Supports xroot file transfer protocol|
|  NFSv4.1| Supports NFSv4.1 protocol|
|Pools| Store retrieved files and provide access to that data. Data access is supported via movers. A machine may have multiple pools| 


<div class="figure">
  <p><img src="%ATTACHURLPATH%/dcache_tier2.png" class="scaled" alt="Medium-sized dCache installation (click to enlarge)" /></a></p>
  <p>[[%ATTACHURLPATH%/dcache_tier2.png][Medium-sized dCache installation (click to enlarge)]] %BR% </p></div>

The following are the recommended system minimums for an OSG dCache installation. All nodes should have Scientific Linux 4.2 or later.

*Admin Nodes*

   * <p>Dual CPU or Dual Core Intel Xeon, 2.8GHz or better</p> 
   * <p>4 GB RAM or more</p> 
   * <p>Raided (mirrored) system disks, hot swappable with spare recommended</p> 
   * <p>Raided data disks (RAID 5) with a hot spare on the Admin Nodes with the billing or srm databases running the XFS file system. These should be backed up regularly.</p> 
   * <p>Gigabit or better network links</p> 

*Pool Nodes*

   * <p>Dual CPU or Dual Core Intel Xeon, 2.8GHz or better or equivalent Opteron (e.g., quad Opteron 270)</p> 
   * <p>4 GB RAM or more</p> 
   * <p>Raided (mirrored) system disks, hot swappable with spare recommended</p> 
   * <p>Raided data disks (RAID 5) hot swappable with hot spare recommended running the XFS file system. External RAIDs are highly recommended.</p> 
   * <p>Gigabit or better network links</p> 

*PNFS Node*

   * <p>8 GB RAM</p> 
   * <p>Postgres databases on raided disk (RAID 5) with back-up performed regularly.</p> 
   * <p>Disk should be used exclusively for the pnfs database.</p> 

*Note:*

See [[http://cd-docdb.fnal.gov/cgi-bin/RetrieveFile?docid=1837&version=1&filename=dcache_tuning.pdf"][ _dCache Tuning_ ]] for recommended Linux TCP/IP parameter tuning

[[https://indico.desy.de/getFile.py/access?contribId=19&sessionId=5&resId=0&materialId=slides&confId=138][dCache hardware layouts]] provides a good guide for the layout of dCache hardware in a variety of scales. The [[http://www.dcache.org/manuals/index.shtml"][dCache manual]] also has more information.

Please check [[http://wiki.postgresql.org/wiki/Tuning_Your_PostgreSQL_Server][Tuning PostgreSQL]] has recommendations on tuning !PostgreSQL. 

---++ Installation

VDT provides a package for installing dCache on an Open Science Grid site. The latest version  is available for download from the [[http://vdt.cs.wisc.edu/components/dcache.html][VDT-dCache website]]. There are two ways to read the installation/setup/configuration instructions. You can either read [[http://vdt.cs.wisc.edu/extras/2.3.5/InstallingDcacheForOSG.README.html][Installation Procedure]] or once you have downloaded and untarred [[http://vdt.cs.wisc.edu/software/dcache/server/2.3.5/][the tarball]] appropriate for your machine, you can read the README file (present under INSTALL_LOCATION/install/ directory). If you are planning to do upgrade of existing dCache installation, please, follow [[http://vdt.cs.wisc.edu/extras//2.3.5/UpgradeDcacheForOSG.html][Upgrade Procedure]].

---+++ Trash/Integration with the information system
 Trash/Integration of the SE with the central information systems takes place during the Compute Element installation/configuration. See the topic [[ReleaseDocumentation/GenericInformationProviders][Generic Information Providers]]. The SE does not collect or publish information independently.

---+++ Trash/Integration with Gratia dCache probes
The probes report storage related information to the central Gratia collector. There are two types of probes:
   * The dCache-transfer probe reports to Gratia the details of each file transfer into or out of a dCache file server.
   * The dCahche-storage probe is responsible for reporting storage capacity and storage usage to the central Gratia collector. The information reported is:
      * The storage capacity and amount used for each dCache pool.
      * The storage capacity and amount used for each SRM Space reservation
Please follow [[https://twiki.grid.iu.edu/bin/view/ReleaseDocumentation/GratiaDcacheProbes][Gratia dCache Probes Installation]] to install and configure Gratia dCache Probes.
---++ Validation

Please perform the following tests to validate your SE before declaring it to be functional:

<pre class="screen">
srmping
</pre>

<pre class="screen">
srmcp
</pre>
---++ References

[[http://s-2.sourceforge.net/][S2]] - A SRM v2.2 test suite from CERN. It provides basic functionality tests based on use cases, and cross-copy tests, as part of the certification process and supports file access/transfer protocols: rfio, dcap, gsidcap, gsiftp

<br />%STOPINCLUDE% 
%BR% 
%COMPLETE3% %BR% 
%RESPONSIBLE% Main.NehaSharma - 12 Sept 2008 %BR% 
%REVIEW% Main.TanyaLevshina - 21 Jul 2009 %BR%
%REVFLAG% %X% %BR%

---++ *Comments*
| Under Installation, neither the Installation Procedure or Upgrade Procedure links are valid. | Main.JamesWeichel | 09 Sep 2009 - 18:27 |
| Under Installation, neither the Installation Procedure or Upgrade Procedure links are valid. | Main.JamesWeichel | 09 Sep 2009 - 18:42 |
| I hope that I have fixed all the links | Main.TanyaLevshina | 04 Nov 2009 - 15:20|
| We will need to add simple validation test commands | Main.TanyaLevshina | 04 Nov 2009 - 15:20|
%COMMENT{type="tableappend"}%

%META:FILEATTACHMENT{name="dcache_tier2.png" attachment="dcache_tier2.png" attr="" comment="" date="1257462558" path="dcache_tier2.png" size="157327" stream="dcache_tier2.png" tmpFilename="/usr/tmp/CGItemp11636" user="TanyaLevshina" version="1"}%
