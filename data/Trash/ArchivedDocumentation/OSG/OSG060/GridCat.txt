%META:TOPICINFO{author="KyleGross" date="1225985929" format="1.1" version="1.7"}%
%LINKCSS%

---+!! <nop>%SPACEOUT{ "%TOPIC%" }%
%TOC%

%STARTINCLUDE%

---++ Introduction
%EDITTHIS%

<nop>GridCat is a high level grid cataloging system using status dots on geographic maps as well as a catalog of participating sites. The status dots represent a site's health. The catalog contains information on site readiness, site problems, a brief reason for problems, number of job slots available, and disk space available with other valuable information per site to help job submission and job scheduling for application users and grid develpers. <nop>GridCat tries to present the grid-site at its simplest status representation. It is used as an operations tool as well as a monitoring service.

(See the [[http://www.ivdgl.org/gridcat][GridCat Home]] for more information.)

<nop>GridCat was started as a web page code development project within iVDGL and as a subproject for the Grid3 project to support the high level grid site status cataloging. Version number 0.0.1 was released on April 2, 2004.

<!-- The OSG-ITB instance of the <nop>GridCat is deployed as: [[http://www.ivdgl.org/osg-int/gridcat/][OSG-ITB GridCat]] -->

<nop>GridCat is operated by aggregating information from all participating computing service and storage service sites. It uses <nop>MySQL database to store site status information. The database can be accessed using a xml-rpc client tool. Certain site requirements should be met for a site information to be displayed correctly. 

---++ Site Requirements
%NOTE% In order for a computing or storage service site to be added, the site has to pass at least one =globusrun -a -r hostname= test.

<nop>GridCat tests grid site status. The four fundamental <nop>GridCat tests for a computing service site that will determine site's Green/Red status dot are:

*Authentication Test*:
   * =globusrun -a -r hostname/jobmananger-batch=

*<nop>HelloWorld Test*: 
   * =globus-job-run hostname /bin/echo "Hello World"=

*Batch Test* is a combination the following:
   * *Batch submission*:
      * =globus-job-submit hostname/jobmanager-batch /bin/sleep 57=
      * This gives jobid with the format =<nop>https://hostname:port/numeric_1/numeric_2=
   * *Batch Query*: 
      * =globus-job-status jobid=
   * *Batch Cancel* using fork jobmanager and 
      * =globus-job-clean -force -r hostname jobid=
*gsiftp file transfer test*, out- and in-bound: 
   * =globus-url-copy file:///a/b/c gsiftp://hostname/usually_tmp/c= 
   * if successful,also =globus-url-copy gsiftp://hostname/usually_tmp/c file:///a/b/c=

In addition to the site status tests,<nop>GridCat obtains fundamental site information using the <nop>CoreMIS (MIS-CI) information collector and jobmanager-mis which is included by default. MIS-CI's sensor collects information and puts them in SQLite database in the site. The information can be queried using the jobmanager-mis which is based on the jobmanager-fork and customized.

Information collected from MIS-CI are Jobs and Disks. Jobs information is the number of available CPU slots for batch submission over total available CPU slots which could be different from the number in "CPUs" column of the<nop>GridCat display because Jobs information is obtained dynamically and from the batch system's jobs query which could provide only all the batch slots configured independently of the site's intended CPUs provision. Disks information is the number of disk space available in Gbyte for the direcotries, $app, $data, $tmp, $wntmp, and osg installation over the total disk space from which these directories are mounted.

The <nop>GridCat tests for a storage service vary depending on storage services advertised through the storage service's information provider which could have a different hostname from the storage service host. Typically, in- and out-bound file tranfer client command execution must be carried out successfully in order for a storage service to be functional. The client command execution commands include =globus-url-copy= or =srmcp= for gsiftp and srm protocol, respectively. At the moment, these two service protocols are supported by <nop>GridCat. <nop>GridCat performs only very simple in- and out-bound file tranfer tests.

In order for a site to be cataloged to the OSG <nop>GridCat instance, it must meet several requirements. 

_Computing service_ sites (CS in <nop>GridCat display) should meet the following:
   1. Installation and configuration of OSG
   1. The site's gatekeeper hostname should be sent to the OSG-<nop>GridCat administrator.

_Storage service_ sites (SS in <nop>GridCat display) should meet these requirements:
   1. Storage service hostname
   1. Information Provider protocol, hostname, and port number
   1. Information Provider query string (e.g., <tt>mds-vo-name=USCMS-FNAL-WC1,o=grid</tt>) should be sent to the <nop>GridCat administrator

If the site is neither CS nor SS, the service COULD BE displayed in <nop>GridCat by providing:
   1. The site's hostname
   1. A list of supported services in the site 

---+++Setting Site State To Active
At the moment, all CS sites initially added to <nop>GridCat are presumed to be inactive. All SS sites initially added to <nop>GridCat are presumed to be active. Inactive CS sites will have the site status dot with the grey color. Once the site becomes active, the site status dot will become either green or red, depending on the <nop>GridCat test results.

Since the default site state is presumed to be inactive, the CS site admin has to proactively switch the site state to be active. The switching can be done by modifying =$VDT_LOCATION/MIS-CI/etc/grid-site-state-info=.

If the value of grid_site_state_bit is 1, the site commences its active state (i.e., the content of =$VDT_LOCATION/MIS-CI/etc/grid-site-state-info=) will look like:

<pre>
export grid_site_state_bit=1
</pre>

%NOTE% It might take up to 2 hours until this change takes effect in the <nop>GridCat display.

If the site decides to become inactive for various reasons (e.g., site maintenance), the site admin can set the value of grid_site_state_bit to be other than =1=. See the [[http://www.ivdgl.org/MIS-CI/grid-site-state-info][example grid-site-state-info file]]. 


---++So How Can I Add My Site to <nop>GridCat
In order for a site to be added to <nop>GridCat, the site admin should request site addition to the grid operations center (GOC) and typically a hostname should be sent to the OSG grid operations center (GOC) [[goc-at-opensciencegrid-dot-org]]. Then, GOC will send the request to <nop>GridCat administrator.

---++Extracting <nop>GridCat Information
GridCat provides xml-rpc service from the <nop>GridCat instance to provide collected information to grid users . The <nop>GridCat service can be accessed using <nop>GridCat client. Two versions of <nop>GridCat client are provided with python and perl languages. Perl version requires various other perl module installation and is more difficult to set up. Python version is recommended to be used. They can be obtained from:
   * [[http://www.ivdgl.org/gridcat/gcatc.py][GridCat Client python version]]
   * [[http://www.ivdgl.org/gridcat/gcatc.pl][GridCat Client perl version]]

<nop>GridCat client accesses database and displays necessary information. The following information query are implemented and can be obtained using the client.

---++++ Usage
<pre class="screen">
gcatc.py %GREEN%[%ENDCOLOR%--useservice=%GREEN%]%ENDCOLOR% %GREEN%[%ENDCOLOR%OPTIONS [<u>args</u>]%GREEN%]%ENDCOLOR%
</pre>

Here an example URI can be <nop>http://www.ivdgl.org/osg-int/gridcat/services.php and OPTIONS are:                   

| *Top level options* ||
| =-h &brvbar; --help &brvbar; --usage= | Print help |
| <tt>--useservice=</tt> | Invoke useservice method to switch to the requested service. This option should be followed by one of the Method options. | 
| *Introspect options:* ||
| =--listmethods= | List available methods |
| <tt>--methodhelp=</tt> | Provides help for a specific method |
| <tt>--methodsig=</tt> | Provides what should be the argument for a specific method |
| *Method options* ||
| =--sitenames= | Invoke sitenames method and list all site names |
| =--hostnames= | Invoke hostnames method and list all gatekeeper host names |
| =--jobmanagers= | Invoke jobmanagers method and list jobmanagers in a site |
| =--sitestatus= | Invoke sitestatus method and show site status in a site |
| =--authstatus= | Show authorization possibility status in a site |
| =--batchstatus= | Show batch job accessibility status in a site |
| =--gsiftpstatus= | Show gsiftp accessibiltiy status in a site |
| =--directories= | List grid accessible directories in a site |
| =--cpuslots= | Show available CPU slots in a site |
| =--diskspace= | Show available data directory disk space in GB in a site |
| =--showtables= | Invoke showtables method and list all<nop>GridCat MySQL tables |
| =--showfields== | Invoke showfields method and list names of all fields in a table |
| =--getsiteresult= | Invoke getsiteresult method and show query result |
| =--getresult= | Invoke getresult method and show query result. (This is the last resort if none of above methods get you what you want if you know what you are doing.) |
| =--services= | Lists available services |


---++++ Example
Download <nop>GridCat Client and try:

<pre class="screen">
&gt; <b>./gcatc.py --sitenames</b>
</pre>


---++Jobs and Disks Information
Job and disks information are collected by MIS-CI cron job every 10 minutes in each site, if MIS-CI is configured to the default configuration. The collected informations are stored in each site to the <nop>SQLite tables "site_cluster" and "diskinfo". 

The job information displayed in <nop>GridCat is obtained by the jobmanager mis and is updated every 30 minutes or longer (at times up to 1-2 hours). Therefore, while long jobs can be caught by<nop>GridCat easily, sometimes short jobs can not been seen because they finish quickly before the next <nop>GridCat update occurs. Clicking the retangular bar in the Jobs column in the <nop>GridCat shows you more detailed job information.

The disk information (updated every 30 minutes or longer) displayed in <nop>GridCat is only for the =$data= directory. Clicking the retangular bar in the Disks column in the <nop>GridCat shows you a more detailed view. 

---++Definition of Site, Facility, and CPUs
Sitename is determined by the site admin during installation (See the OSG installation quick guide). It is a desriptive short name for a collection of services within the site.

Facility name in <nop>GridCat is logically chosen during <nop>GridCat instantiation. The convention is to take the <span class="firstterm">Top Level Domain (TLD)</span>. For example, the TLD of =ufloridaigt.phys.ufl.edu= is =ufl.edu=. Removing the =.edu= gives you the  facility name for =ufloridaigt=.

"Facility" is meant to be an administrative domain which is managed/operated by a number of site admins in the site. The facilities name describes the local administrative domain. For example, at UF we have two clusters on OSG, a production cluster dedicated to CMS and a production cluster for everyone. The policies implemented on each batch system differs in terms of what percetage CMS gets when compared to others. Our facility name describes the admin group here at UF HEP.  So, in<nop>GridCat, "Facility" is a level above "Site" but displays in <nop>GridCat are arranged using the concept of "Site".

CPUs are a fixed number of CPUs which the site is presumably providing, taken from batch system information. The field is populated initially using this information. However, only the site administrator can provide a truly accurate number. The BNL site is such an example.


---++Interactively Updating <nop>GridCat
As a site admin, <nop>GridCat information may be updated interactively. Site name, Facility name, and CPUs are three fields that can be updated by site admins. Also a site status test can be performed as the site admin.  These interactive site admin role can be activated by sending an email to <nop>GridCat operator or adding a line in the following format:

<pre>
   SITE_CONTACT_CERT_DN="/O=Anywhere/Blah=Blah/CN=Your Name 3049493203"
</pre>

to the monitoring configuration file =$VDT_LOCATION/monitoring/grid3-info.conf=

---++ Publishing your SE
[[https://goc.grid.iu.edu/][Register your Storage Element with OSG]].  The Grid Operations Center will add it to <nop>GridCat.

The <nop>GridCat tests for an SE vary depending on what storage services are advertised through the SE information provider, which could have a different hostname from the SE host itself. Typically, in- and out-bound file transfer client command execution must be carried out successfully for a storage service to be functional. The client command execution commands include =globus-url-copy= or =srmcp= for gsiftp and srm protocol, respectively. At the moment, these two service protocols are supported by <nop>GridCat. <nop>GridCat performs only very simple in- and out-bound file tranfer tests.

In order for an SE site to be cataloged to the OSG <nop>GridCat instance, a few requirements must be met:
   1. Storage service hostname
   1. Information Provider protocol, hostname, and port number
   1. Information Provider query string 

Examples of SEs include: 
   1. =cmssrm.fnal.gov=
   1. =ldap://cmslcgce.fnal.gov:2170=
   1. ="mds-vo-name=USCMS-FNAL-WC1,o=grid"=

After these three fundamental parameters are provided to the Grid Operations Center via the resource registration forms, they will be provided to <nop>GridCat. As the first SE test, <nop>GridCat will try an ldapsearch query on which services are provided (gsiftp and/or SRM). Then, <nop>GridCat will construct the second test command string. 

For an SRM inbound test: 
<pre class="screen">
<b>srmcp -x509_user_proxy=/home/gridcat/.gridcat/mygridcat.proxy -retry_num=0 \
srm://cmssrm.fnal.gov:8443/resilient/ivdgl/gridcat.ss.test.gridcat \
file:////tmp/gridcat.ss.test.gridcat </b>
</pre>


For a gsiftp inbound test:
<pre class="screen">
<b>globus-url-copy \
gsiftp:///cmssrm.fnal.gov/resilient/ivdgl/gridcat.ss.test.gridcat \
file:////tmp/gridcat.ss.test.gridcat </b>
</pre>

Outbound tests are performed similarly.

If the LDAP query is successful and inbound and outbound tests pass for each service provided, the <nop>GridCat status will become green for the SE.

In order for <nop>GridCat to parse srm access root directory, etc, the BDII or MDS must have been configured with GIP. In the above example, the GIP is configued using the BDII service. However, since MDS comes with the OSG CE which could act as the information provider for both CE and SE or MDS can be installed on the SE directly, it is convenient for the site admin to configure the GIP.

------------------

---++++ What does <nop>GridCat expect for Glue attribute values?

Since <nop>GridCat obtains SE information from MDS with GIP which implements Glue schema, <nop>GridCat interprets Glue schema in the following way for Glue 1.2:

| !Glue Attribute | Typical/Example Value | Comments (what !Gridcat thinks) | 
| !GlueSchemaVersionMajor | 1 |  | 
| !GlueSchemaVersionMinor | 2 |  | 
| !GlueSEName | MY_STROAGE_SITE_NAME | Sitename for <nop>GridCat. Pick a descriptive human readable and a name that can be used for unix file name | 
| !GlueSEUniqueID | srmcms.phys.ufl.edu | SE hostname | 
| dataGridVersion | OSG-0_2_1 | !GridName-Version, Only for Glue 1.1 |
| !GlueSEAccessProtocolType | srm | protocol, srm or gsiftp | 
| !GlueSEAccessProtocolPort | 8443 | port number | 
| !GlueSARoot | cms:/cms | Access root from various protocols in the form {VO}:{ACCESS_ROOT} so that test command : %BR%  =srmcp <nop>file:////tmp/gridcat.ss.test.gridcat srm://srmcms.phys.ufl.edu:8443/cms/gridcat.ss.test.gridcat= %BR%  can be executed successfully for example | 
| !GlueSAAccessControlBaseRule | cms | accessible VirtualOrganizations/VOInfo name  | 
| !GlueSAStateAvailableSpace | 1 | dynamic available space  | 
| !GlueSAStateUsedSpace | 1 | dynamic used space  | 
| !GlueSAPolicyFileLifeTime | Permanent | file type  | 


---++ Verifying SE Publication
Use the =[[http://gdsuf.phys.ufl.edu:8080/releases/gridcat/gridcat-verify-ss-info.sh.txt][gridcat-verify-ss-info.sh]]= script to check for GIP configuration for SE. The script reads in the number of Protocols, !GlueSEUniqeID, and VirtualOrganizations/VOInfo from an ldapsearch (<tt>ldapsearch -x -l 30 -b mds-vo-name=local,o=grid -h <<ldap_host_for_SE>> -p <<ldap_port_for_SE>></tt>) and then it compares these are aligned well with each other. If everything is as expected, the script will say 'Looks ok' and print a summary.

For example, if the script detected the following, publishing will work well with <nop>GridCat.

<pre class="programlisting">
protocols="srm gsiftp"
hosts="my.srm.edu my.gsiftp.edu"
number_of_vos="20 10"
</pre>

If the script detected the following two examples, publishing will not work with <nop>GridCat.

The following example will not work because it uses same hostname for srm and gsiftp:

<pre class="programlisting">
protocols="srm gsiftp"
hosts="my.gsiftp.edu my.gsiftp.edu"
number_of_vos="20 10"
</pre>


The following example will not work because there are two protocols yet the number of hosts is 1:

<pre class="programlisting">
 protocols="srm gsiftp"
 hosts="my.srm.edu"
 number_of_vos="20 10"
</pre>


---++ Contacting <nop>GridCat

| *Phone* | (352) 392-1791 |
| *Email* | [[bockjoo at phys dot ufl dot edu]] |
| *OSG <nop>GridCat DN* | <tt>/DC=org/DC=doegrids/OU=People/CN=OSG <nop>GridCat</tt> |

%STOPINCLUDE%

%WHU%

<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

---++!! Major updates
-- Main.RobGardner - 09 Mar 2005   %BR%  
-- Main.BockjooKim - 10 Feb 2006   %BR%  
-- Main.RobQ - 01 May 2006   %BR%  
-- Main.MarciaTeckenbrock - 12 Sep 2006   %BR%  


%META:TOPICMOVED{by="ForrestChristian" date="1166049447" from="Integration.GridCat050" to="Integration/ITB_0_5.GridCat"}%
