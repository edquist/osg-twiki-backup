%META:TOPICINFO{author="KyleGross" date="1225985930" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="VomsWhatToDo"}%
%LINKCSS%


---+!! Configuring VirtualOrganizations/VOInfoMS - the configure_voms script
%TOC%

%STARTINCLUDE%
---++Configuring VirtualOrganizations/VOInfoMS - the configure_voms script

%EDITTHIS%

The <i>$VDT_LOCATION/vdt/setup/configure_voms</i> script has been provided for creating and removing VOs from VirtualOrganizations/VOInfoMS.

You may be wondering why you are being told about this script before describing the installation process.  During the VirtualOrganizations/VOInfoMS installation process, this script is executed and creates a 'test' VirtualOrganizations/VOInfo called <i>VDT</i>.  After the installation completes, the verification process  uses this <i>VDT</i> test VirtualOrganizations/VOInfo to determine the success of the installation.  By reviewing this section of the documentation now, you will be more aware of what to look for when you create your own VirtualOrganizations/VOInfo(s).

The <i>configure_voms</i> script is also used to remove any VOs that are no longer needed and will be documented here as well.

---+++Creating a VO
All VOs should be created using the <i>configure_voms</i> script.

Syntax:
<pre>
configure_voms --server &lt y,n &gt
               --vo &lt vo name &gt
               --mail-from &lt from address on voms mail &gt
               --smtp-host &lt outgoing smtp host &gt
               --vdt-install &lt VDT installation root &gt
</pre>

%NOTE% The =$VDT_LOCATION/vdt-install.log= contains all messages from its execution not visible in stdout/err on the command line.


The <i>configure_voms</i> script does the following (note: the examples that follow show the files for the <i>VDT</i> test VirtualOrganizations/VOInfo that is created):
<ol>
  <li>Creates a <nop>MySql database called <i>voms_VDT</i>.
<pre class="screen">
&gt; <b>mysql -uroot</b>
mysql&gt; <b>show databases;</b>
+----------------+
| Database       |
+----------------+
| mysql          |
| test           |
| voms_VDT       |
+----------------+
</pre>
  </li>
  <li>Creates all the necessary VirtualOrganizations/VOInfoMS configuration files for your VO.
<pre>
> ls <b>$VDT_LOCATION/vdt-app-data/voms  </b>
-rw-r--r--    1 root    root        5 Sep  1 10:45 last_port   <em>(Maintains the last port number 
                                                                assigned a  VO's server)</em>
drwxr-xr-x    6 root    root     4096 Sep  1 10:45 voms        <em>(VOMS server configuration data
                                                                for each VO)</em>
drwxr-xr-x    6 root    root     4096 Sep  1 10:45 voms-admin  <em>(WEB UI configuration data for 
                                                                each VO)</em>
drwxr-xr-x    2 root    root     4096 Sep  1 10:45 vomses      <em>(voms-proxy-init configuration file 
                                                                for each VO)</em>

> ls <b>$VDT_LOCATION/vdt-app-data/voms/voms/VDT</b>
-rw-r-----    1 daemon  daemon    367 Aug 31 23:06 voms.conf
-rw-r-----    1 daemon  daemon     23 Aug 31 23:05 voms.pass
 
> ls <b>$VDT_LOCATION/vdt-app-data/voms/voms-admin/VDT</b>
-rw-r--r--    1 root    daemon    946 Aug 31 23:05 voms-admin-VDT.xml
-rw-r-----    1 daemon  daemon    921 Aug 31 23:05 voms.database.properties
-rw-r--r--    1 root    root     9354 Aug 31 23:06 voms.service.properties
-rw-r--r--    1 root    daemon     95 Aug 31 23:05 vomses

> ls <b>$VDT_LOCATION/vdt-app-data/voms/vomses</b>
-rw-r--r--    1 root     root          100 Aug 31 23:06 VDT    <em>(voms-proxy-init configuration file
                                                                for the VDT VO)</em>

&gt <b>cat VDT</b>
"VDT" "cms-xen3.fnal.gov" "15000" "/DC=org/DC=doegrids/OU=Services/CN=cms-xen3.fnal.gov" "VDT" "32"
</pre>

  </li>
  <li>Updates the apache, tomcat and glite configuration files for the new VirtualOrganizations/VOInfoMS VO.</li>
  <li>Restarts all the necessary services including the VirtualOrganizations/VOInfoMS server.</li>
  <li>A Global-ACL is created for the HOST certificate for this server with <i>allow all</i> capabilities.  This lets the <i>root</i> user on this machine update the VirtualOrganizations/VOInfoMS VirtualOrganizations/VOInfo using the =voms-admin= command, so <i>root</i> is, in effect, already a VirtualOrganizations/VOInfo-Admin  in this VO.  It is not, however, a member of the VO, which is an important distinction. %BR% %BR% This <i>root</i> user capability can be removed after an individual  is assigned the VirtualOrganizations/VOInfo-Admin role as described in the next section. </li>
</ol>

Many default values were applied during this process.  The values applied can  be viewed in the 
<i>$VDT_LOCATION/vdt-install.log</i> and searching for 'This is voms-admin-configure'.


---+++Removing a VO 
The <i>configure_voms</i> script is also used to remove a VirtualOrganizations/VOInfo from the VirtualOrganizations/VOInfoMS installation:

<pre class="screen">
&gt; <b>source  $VDT_LOCATION/setup.sh</b>
&gt; <b>$VDT_LOCATION/vdt/setup/configure_voms  -vo &lt vo name &gt  --remove</b>
</pre>

No output indicates success, hopefully.

%NOTE% If you have set the <i>root</i> password for <nop>MySQL, you will be prompted for the password when you execute the script.

The script will:
   * stop the VirtualOrganizations/VOInfo's VirtualOrganizations/VOInfoMS server, 
   * remove the associated !MySql database, 
   * remove all configuration files for the VO
   * restart tomcat and apache




%STOPINCLUDE%

%BOTTOMMATTER%

-- Main.JohnWeigand - 27 Feb 2007