%META:TOPICINFO{author="StevenTimm" date="1160761731" format="1.1" reprev="1.5" version="1.5"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->
d68 1
---+!!<nop>The Managed Fork Queue
%TOC%
%STARTINCLUDE%


---++The Managed Fork Queue
<div class="twikiSmall" style="text-align: left; font-style: italic;"><a href="%SCRIPTURLPATH%/edit%SCRIPTSUFFIX%/%WEB%/%TOPIC%?t=%SERVERTIME{ "$epoch" }%">Edit this section</a></div>

With OSG 0.4.1 and greater an optional service called the Managed Fork has been introduced. This service replaces
the default jobmanager fork with a jobmanager which uses Condor to manage the incoming jobmanager fork requests.   condor_q and condor_history can then be used to see the actual command lines of the fork jobs as they run and afterwards, providing an important logging capacity.

<font color=blue>Please note that the managed fork will only work in Condor 6.7.15 or greater; older versions of Condor will run all local universe jobs as soon as they are submitted or may result in an error.</font>

The standard fork jobmanager is used to spawn jobs on the gatekeeper/headnode, the Managed Fork updates the fork jobmanager to submit requests to the local universe Condor queue instead. These jobs are still run on the gatekeeper/headnode, but the jobs may now be subject to limitations and
priority as assigned by the local system administrator.
 

By using the "local universe" fork jobs are not actually subject to scheduling delays, unless the total number of allowed fork jobs of a given type is exceeded.


---+++Managed Fork Package Installation

The installation is done in same directory as the OSG CE software.
To specify an external Condor installation set the
following two environment variables before installing:
d39 4
<ul>

  <li><code><b>VDTSETUP_CONDOR_LOCATION</b></code>: the location of
      your Condor installation (e.g. <code>/opt/condor</code>). The Condor
      <code>bin/</code>,
      <code>sbin/</code>, <code>etc/</code>, <code>lib/</code>...  directories should be
      directly under this location.

  <li><code><b>VDTSETUP_CONDOR_CONFIG</b></code> (optional): The location of your
      Condor configuration file (if non-standard). Default is
      <code>${VDTSETUP_CONDOR_LOCATION}/etc/condor_config</code>.


</ul>
d41 3
 Otherwise a full Condor installation will be installed with the package.

<pre class="screen">
&gt; <b>cd $VDT_LOCATION</b>
&gt; <b>source $VDT_LOCATION/setup.sh</b>
&gt; <b>pacman -get ITB:ManagedFork</b>
&gt; cd $VDT_LOCATION
&gt; source $VDT_LOCATION/setup.sh
&gt; pacman -get ITB:ManagedFork
<pre>
  &gt; cd $VDT_LOCATION
  &gt; source $VDT_LOCATION/setup.sh
  &gt; pacman -get ITB:ManagedFork
</pre>
To configure the default jobmanager to be the managed fork jobmanager, execute the
following command.
d87 4
&gt; source $VDT_LOCATION/setup.sh
&gt; $VDT_LOCATION/vdt/setup/configure_globus_gatekeeper --managed-fork y
To configure the default jobmanager to be the managed fork jobmanager, execute the following command.
<pre>
By default, the managed fork jobmanager will behave just like the fork jobmanager.  
If you wish to restrict it, you need to modify your local Condor configuration.  
If you're using Condor from the VDT this can be done by editing 
<i>$VDT_LOCATION/condor/local.&lt;hostname&gt;/condor_config.local</i>. 
  &gt; $VDT_LOCATION/vdt/setup/configure_globus_gatekeeper --managed-fork y --server y
<p>Only allow 20 local universe jobs to execute concurrently: 

START_LOCAL_UNIVERSE = TotalLocalJobsRunning < 20

Only allow 20 local universe jobs to execute concurrently: 
START_LOCAL_UNIVERSE = TotalLocalJobsRunning < 20 || GridMonitorJob == TRUE
d64 1
<pre>
   START_LOCAL_UNIVERSE = TotalLocalJobsRunning < 20
START_LOCAL_UNIVERSE = TotalLocalJobsRunning < 20 || GridMonitorJob =?= TRUE
</pre>

Set a hard limit on most jobs, but always let grid monitor jobs run (strongly recommended):
   START_LOCAL_UNIVERSE = TotalLocalJobsRunning < 20 || GridMonitorJob =?= TRUE
To replace the default fork jobmanager execute the
following command.
<pre>

=source $VDT_LOCATION/setup.sh=
=$VDT_LOCATION/vdt/setup/configure_globus_gatekeeper --managed-fork n=
</pre>
d77 1
   source $VDT_LOCATION/setup.sh
   $VDT_LOCATION/vdt/setup/configure_globus_gatekeeper --managed-fork n --server y
For more details on setup and configuration, refer to the [[http://vdt.cs.wisc.edu/releases/1.4.0/notes/Globus-ManagedFork-Setup.html][VDT 1.4.0 Managed Fork Jobmanager Release Notes]].
For more details on setup and configuration, refer to the 
<a href="http://vdt.cs.wisc.edu/releases/1.4.0/notes/Globus-ManagedFork-Setup.html">
VDT 1.4.0 Managed Fork Jobmanager Release Notes</a>.
<verbatim>
</verbatim>
d85 1
</pre>

%INCLUDE{ "Integration.WhuReferences" }%
For more details on setup and configuration, refer to the [[http://vdt.cs.wisc.edu/releases/1.6.1/notes/Globus-Integration.ManagedFork-Setup.html][VDT 1.6.1 Managed Fork Jobmanager Release Notes]].
%STOPINCLUDE%

%WHU%
-- Main.RobQ - 01 May 2006<br>
-- Main.JohnWeigand - 07 Sep 2006 - Updated for OSG 0.5.0<br>
<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

---++!! Major Updates

-- Main.RobQ - 01 May 2006   %BR%
-- Main.AlainRoy - 22 Feb 2007 - Updated for clarity <br>

%META:TOPICMOVED{by="ForrestChristian" date="1166051931" from="Integration.ManagedFork050" to="Integration/ITB_0_5.ManagedFork"}%
