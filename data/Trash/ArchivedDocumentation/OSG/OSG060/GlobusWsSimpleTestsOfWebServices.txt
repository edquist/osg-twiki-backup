%META:TOPICINFO{author="ForrestChristian" date="1170708464" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="InstallAndConfigureGlobusWebServices"}%
%LINKCSS%

---+!! Simple Test Scenarios for Globus Web Services Installation
%TOC%
d17 1
%STARTINCLUDE%
%EDITTHIS%
a17 1
This describes several simple tests that can be performed to validate the installation of globus-ws (1st column of the table below). These tests can be used for both gridmap and gt4prima authorization methods.

The 2nd column of the table provdes an abbreviated look at the =$VDT_LOCATION/globus/var/container.log= output associated with each execution.  It's purpose is to document the web services that are invoked that require some form of authorization.  The various colors are intended to indicate the independent threads the services are running in and may illustrate where/why caching of the authorized user id is occuring.


The tests are based on the VDT set of tests described in 
[[http://vdt.cs.wisc.edu/releases/1.3.10/submitting_wsgram_jobs][Submitting Jobs to Web Service GRAM]].


d17 1
#TestOne
---++++ Test 1: Trivial job ... no delegation services
---+++ Test 1: Trivial job ... no delegation
d19 8
<pre class="screen">
&gt; <b>globusrun-ws -submit -F cms-xen1.fnal.gov:9443 -Ft Fork -c /usr/bin/id</b>
Submitting job...Done.
Job ID: uuid:54008c80-babb-11db-a0d1-00163e010001
Termination time: 02/13/2007 17:06 GMT
Current job state: Active
Current job state: CleanUp
Current job state: Done
Destroying job...Done.
&gt; <b>globusrun-ws -submit -F quux.fnal.gov:9443 -Ft Fork \ 
     -c /bin/date</b>
  Submitting job...Done.
  Job ID: uuid:d5f01e9a-ffae-11da-914f-00502287d62d
  Termination time: 06/20/2006 16:15 GMT
  Current job state: Active
  Current job state: CleanUp
  Current job state: Done
  Destroying job...Done.
</pre>

#TestOneServices
---+++++ Services / Authorizations
1 authorizations + 1 using cache + 1 sudoer

---+++++ Using gt4prima

<pre class="programlisting">
<font color=green>Thread-12 Target http://www.globus.org/namespaces/2004/10/gram/job}createManagedJob</font>
<font color=green>Thread-12 GT4 PRIMA AUTHZ</font>

<font color=green>Thread-12 ... is assigned local account (uscmspool036)</font>
<font color=blue>Thread-11 Target http://wsrf.globus.org/core/notification}destroy</font>
<font color=blue>Thread-11 GridMapAuthorization isPermitted Service null</font>
<font color=blue>Thread-11 <u>Peer ... authorized as 'daemon'</u></font>
<font color=red>Thread-16 Target http://www.globus.org/namespaces/2004/10/gram/job/exec}destroy </font>
<font color=red>Thread-16 USES CACHE</font>
<font color=red>Thread-16 ... is assigned local account (uscmspool036)</font>
</pre>

---+++++ Using grid-mapfile
<pre class="programlisting">
<font color=green>Thread-11 Target http://www.globus.org/namespaces/2004/10/gram/job}createManagedJob</font>
<font color=green>Thread-11 GridMapAuthorization isPermitted Service ManagedJobFactoryService</font>
<font color=green>Thread-11 Peer ... authorized as 'fermilab'</font>
<font color=blue>Thread-12 Target http://wsrf.globus.org/core/notification}destroy</font>
<font color=blue>Thread-12 GridMapAuthorization isPermitted Service null</font>
<font color=blue>Thread-12 <u>Peer ... authorized as 'daemon'</u></font>
<font color=red>Thread-37 Target http://www.globus.org/namespaces/2004/10/gram/job/exec}destroy </font>
<font color=red>Thread-37 GridMapAuthorization isPermitted Service null</font>

<font color=red>Thread-37 Peer ... authorized as 'fermilab'</font>
</pre>


#TestTwo
---++++ Test 2: Trivial job with job description file ... no delegation

<pre class="screen">
&gt; <b>globusrun-ws -submit -F quux.fnal.gov:9443 -Ft Fork \
    -job-description-file /tmp/runjob-ws.sh.6188</b>
  Submitting job...Done.
  Job ID: uuid:fb40c56c-ffb5-11da-8fe5-00502287d62d
  Termination time: 06/20/2006 17:06 GMT
  Current job state: Active
  Current job state: CleanUp
  Current job state: Done
  Destroying job...Done.

&gt; <b>cat /tmp/runjob-ws.sh.6188</b>
  &lt;job> 
    &lt;executable>/bin/date</executable> 
  &lt;/job>
</pre>

---+++++ Services / Authorizations 
Same pattern as [[#TestOneServices][Test 1]].


#TestThree
---++++Test 3: Trivial job with -s (stream) option .. delegation


<pre class="screen">
&gt; <b>globusrun-ws -submit -F quux.fnal.gov:9443 -Ft Fork \
    -s -c /bin/date</b>
  Delegating user credentials...Done.
  Submitting job...Done.
  Job ID: uuid:bd10d25e-ffb6-11da-83fc-00502287d62d
  Termination time: 06/20/2006 17:12 GMT
  Current job state: Active
  Current job state: CleanUp-Hold
  <font color=green>Mon Jun 19 12:12:11 CDT 2006</font>
  Current job state: CleanUp
  Current job state: Done
  Destroying job...Done.
  Cleaning up any delegated credentials...Done.
</pre>




#TestThreeServices
---+++++ Services / Authorizations
3 authorizations + 2 for gridftp (stdout/err)  + 7 from cache + 2 using sudoer


---+++++ Using gt4prima
<pre class="programlisting">
<font color=green>Thread-16 Target http://www.globus.org/08/2004/delegationService}requestSecurityToken</font>
<font color=green>Thread-16 GT4 PRIMA AUTHZ</font> 

<font color=green>Thread-16 ... is assigned local account (uscmsspool036)</font> 
<font color=blue>Thread-12 Target http://www.globus.org/namespaces/2004/10/gram/job}createManagedJob</font>
<font color=blue>Thread-12 GT4 PRIMA AUTHZ </font>
<font color=blue>Thread-12 ... is assigned local account (uscmsspool036)</font> 
<font color=red>Thread-11 Target http://www.globus.org/namespaces/2004/10/gram/job/exec}getMultipleResourceProperties</font>
<font color=red>Thread-11 USES CACHE</font>
<font color=red>Thread-11 ... is assigned local account (uscmsspool036)</font> 
<font color=green>THread-16 Target http://www.globus.org/namespaces/2004/10/gram/job/exec}release</font>
<font color=green>Thread-16 USES CACHE</font>

<font color=green>Thread-16 ... is assigned local account (uscmsspool036)</font> 
<font color=blue>Thread-12 Target http://www.globus.org/namespaces/2004/10/rft}createReliableFileTransfer</font>
<font color=blue>Thread-12 GT4 PRIMA AUTHZ </font>
<font color=blue>Thread-12 ... is assigned local account (uscmsspool036)</font> 
<font color=red>Thread-11 Target http://www.globus.org/namespaces/2004/10/rft}subscribe</font>
<font color=red>Thread-11 USES CACHE</font>
<font color=red>Thread-11 ... is assigned local account (uscmsspool036)</font> 
<font color=green>Thread-16 Target http://www.globus.org/namespaces/2004/10/rft}start</font>
<font color=green>Thread-16 USES CACHE</font>

<font color=green>Thread-16 ... is assigned local account (uscmsspool036)</font> 
<font color=blue>Thread-12 Target http://wsrf.globus.org/core/notification}notify  WARN Failed to send</font>
<font color=blue>Thread-12 <u>NoAuthorization</u></font>
<font color=red>Thread-11 Target http://wsrf.globus.org/core/notification}notify  WARN Failed to send</font>
<font color=red>Thread-11 <u>NoAuthorization</u></font>
<font color=green>Thread-16 Target http://wsrf.globus.org/core/notification}notify  WARN Failed to send</font>
<font color=green>Thread-16 <u>NoAuthorization</u></font>

<font color=blue>Thread-12 Target http://wsrf.globus.org/core/notification}notify  WARN Failed to send</font>
<font color=blue>Thread-12 <u>NoAuthorization</u></font>
<font color=red>Thread-11 Target http://wsrf.globus.org/core/notification}destroy</font>
<font color=red>Thread-11 GridMapAuthorization isPermitted Service null</font>
<font color=red>Thread-11 <u>Peer ... authorized as 'daemon'</u></font>
<font color=green>Thread-16 Target http://www.globus.org/namespaces/2004/10/rft}destroy</font>
<font color=green>Thread-16 USES CACHE</font>
<font color=green>Thread-16 ... is assigned local account (uscmsspool036)</font> 

<font color=blue>Thread-12 Target http://wsrf.globus.org/core/notification}destroy</font>
<font color=blue>Thread-12 GridMapAuthorization isPermitted Service null</font>
<font color=blue>Thread-12 <u>Peer ... authorized as 'daemon'</u></font>
<font color=red>Thread-11 Target http://www.globus.org/namespaces/2004/10/gram/job/exec}destroy</font>
<font color=red>Thread-11 USES CACHE</font>
<font color=red>Thread-11 ... is assigned local account (uscmsspool036)</font> 
<font color=green>Thread-16 Target http://www.globus.org/08/2004/delegationService}destroy</font>
<font color=green>Thread-16 USES CACHE</font>

<font color=green>Thread-16 ... is assigned local account (uscmsspool036)</font> 
</pre>


---+++++ Using grid-mapfile
<pre class="screen">
<font color=green>Thread-12 Target http://www.globus.org/08/2004/delegationService}requestSecurityToken</font>
<font color=green>Thread-12 GridMapAuthorization isPermitted Service DelegationFactoryService</font>
<font color=green>Thread-12 Peer ... authorized as 'fermilab'</font>
<font color=blue>Thread-11 Target http://www.globus.org/namespaces/2004/10/gram/job}createManagedJob</font>
<font color=blue>Thread-11 GridMapAuthorization isPermitted Service ManagedJobFactoryService</font>
<font color=blue>Thread-11 Peer ... authorized as 'fermilab'</font>
<font color=green>Thread-12 Target http://www.globus.org/namespaces/2004/10/gram/job/exec}getMultipleResourceProperties</font>

<font color=green>Thread-12 GridMapAuthorization isPermitted Service null</font>
<font color=green>Thread-12 Peer ... authorized as 'fermilab'</font>
<font color=red>Thread-17 Target http://www.globus.org/namespaces/2004/10/gram/job/exec}release</font>
<font color=red>Thread-17 GridMapAuthorization isPermitted Service null</font>
<font color=red>Thread-17 Peer ... authorized as 'fermilab'</font>
<font color=black>Thread-16 Target http://www.globus.org/namespaces/2004/10/rft}createReliableFileTransfer</font>
<font color=black>Thread-16 GridMapAuthorization isPermitted Service ReliableFileTransferFactoryService</font>
<font color=black>Thread-16 Peer ... authorized as 'fermilab'</font>
<font color=blue>Thread-11 Target http://www.globus.org/namespaces/2004/10/rft}subscribe</font>

<font color=blue>Thread-11 GridMapAuthorization isPermitted Service ReliableFileTransferService</font>
<font color=blue>Thread-11 Peer ... authorized as 'fermilab'</font>
<font color=green>Thread-12 Target http://www.globus.org/namespaces/2004/10/rft}start</font>
<font color=green>Thread-12 GridMapAuthorization isPermitted Service ReliableFileTransferService</font>
<font color=green>Thread-12 Peer ... authorized as 'fermilab'</font>
<font color=red>Thread-17 Target http://wsrf.globus.org/core/notification}notify  WARN Failed to send</font>
<font color=red>Thread-17 <u>NoAuthorization</u></font>
<font color=black>Thread-16 Target http://wsrf.globus.org/core/notification}notify  WARN Failed to send</font>

<font color=black>Thread-16 <u>NoAuthorization</u></font>
<font color=blue>Thread-11 Target http://wsrf.globus.org/core/notification}notify  WARN Failed to send</font>
<font color=blue>Thread-11 <u>NoAuthorization</u></font>
<font color=green>Thread-12 Target http://wsrf.globus.org/core/notification}notify  WARN Failed to send</font>
<font color=green>Thread-12 <u>NoAuthorization</u></font>
<font color=red>Thread-17 Target http://wsrf.globus.org/core/notification}destroy</font>
<font color=red>Thread-17 GridMapAuthorization isPermitted Service null</font>

<font color=red>Thread-17 <u>Peer ... authorized as 'daemon'</u></font>
<font color=black>Thread-16 Target http://www.globus.org/namespaces/2004/10/rft}destroy</font>
<font color=black>Thread-16 GridMapAuthorization isPermitted Service ReliableFileTransferService</font>
<font color=black>Thread-16 Peer ... authorized as 'fermilab'</font>
<font color=blue>Thread-11 Target http://wsrf.globus.org/core/notification}destroy</font>
<font color=blue>Thread-11 GridMapAuthorization isPermitted Service null</font>
<font color=blue>Thread-11 <u>Peer ... authorized as 'daemon'</u></font>
<font color=green>Thread-12 Target http://www.globus.org/namespaces/2004/10/gram/job/exec}destroy</font>

<font color=green>Thread-12 GridMapAuthorization isPermitted Service null</font>
<font color=green>Thread-12 Peer ... authorized as 'fermilab'</font>
<font color=red>Thread-17 Target http://www.globus.org/08/2004/delegationService}destroy</font>
<font color=red>Thread-17 GridMapAuthorization isPermitted Service null</font>
<font color=red>Thread-17 Peer ... authorized as 'fermilab'</font>
</pre>



#TestFour
---++++ Test 4: Trivial job with -s (stream) option and to file .. delegation
<pre class="screen">
&gt; <b>globusrun-ws -submit -F quux.fnal.gov:9443 -Ft Fork \ 
    -s -so job.26925.out -c /bin/date</b>
  Delegating user credentials...Done.
  Submitting job...Done.
  Job ID: uuid:271043ac-ffc5-11da-9d41-00502287d62d
  Termination time: 06/20/2006 18:55 GMT
  Current job state: Active
  Current job state: CleanUp-Hold
  Current job state: CleanUp
  Current job state: Done
  Destroying job...Done.
  Cleaning up any delegated credentials...Done.
 
&gt; <b>ls -l job.26925.out</b>
  -rw-r--r--    1 weigand  weigand        29 Jun 19 13:55 job.26925.out

&gt; <b>cat job.26925.out</b>
Mon Jun 19 13:55:21 CDT 2006
</pre>


#TestFourServices
---+++++ Services / Authorizations 
Same pattern as [[#TestThreeServices][Test 3]].



#TestFive
---++++ Test 5: Trivial job with delegation

<pre class="screen">
&gt; <b>globusrun-ws -submit -F quux.fnal.gov:9443 -Ft Fork \ </b>
    -job-delegate -c /bin/date
  Delegating user credentials...Done.
  Submitting job...Done.
  Job ID: uuid:55a676b8-ffc6-11da-86f9-00502287d62d
  Termination time: 06/20/2006 19:03 GMT
  Current job state: Active
  Current job state: CleanUp
  Current job state: Done
  Destroying job...Done.
  Cleaning up any delegated credentials...Done.
</pre>


#TestFiveServices
---+++++ Services / Authorizations
2 authorizations + 2 from cache + 1 sudoer

---+++++ Using gt4prima 

<pre class="programlisting">
<font color=green>Thread 11 Target http://www.globus.org/08/2004/delegationService}requestSecurityToken</font>
<font color=green>Thread 11 GT4 PRIMA AUTHZ </font>
<font color=green>Thread 11 ... is assigned local account (uscmspool036)</font>
<font color=blue>Thread 12 Target http://www.globus.org/namespaces/2004/10/gram/job}createManagedJob</font>
<font color=blue>Thread 12 GT4 PRIMA AUTHZ </font>
<font color=blue>Thread 12 ... is assigned local account (uscmspool036)</font>

<font color=red>Thread-16 Target http://wsrf.globus.org/core/notification}destroy</font>
<font color=red>Thread-16 GridMapAuthorization isPermitted Service null</font>
<font color=red>Thread-16 <u>Peer ... authorized as 'daemon'</u></font>
<font color=green>Thread 11 Target http://www.globus.org/namespaces/2004/10/gram/job/exec}destroy</font>
<font color=green>Thread 11 USES CACHE</font>
<font color=green>Thread 11 ... is assigned local account (uscmspool036)</font>
<font color=blue>Thread 12 Target http://www.globus.org/08/2004/delegationService}destroy</font>
<font color=blue>Thread 12 USES CACHE</font>

<font color=blue>Thread 12 ... is assigned local account (uscmspool036)</font>
</pre>



---+++++ Using grid-mapfile
<pre class="programlisting">
<font color=green>Thread-12 Target http://www.globus.org/08/2004/delegationService}requestSecurityToken</font>
<font color=green>Thread-12 GridMapAuthorization isPermitted Service DelegationFactoryService</font>
<font color=green>Thread-12 Peer ... authorized as 'fermilab'</font>
<font color=blue>Thread-37 Target http://www.globus.org/namespaces/2004/10/gram/job}createManagedJob</font>
<font color=blue>Thread-37 GridMapAuthorization isPermitted Service ManagedJobFactoryService</font>
<font color=blue>Thread-37 Peer ... authorized as 'fermilab'</font>

<font color=red>Thread-11 Target http://wsrf.globus.org/core/notification}destroy</font>
<font color=red>Thread-11 GridMapAuthorization isPermitted Service null</font>
<font color=red>Thread-11 <u>Peer ... authorized as 'daemon'</u></font>
<font color=green>Thread-12 Target http://www.globus.org/namespaces/2004/10/gram/job/exec}destroy </font>
<font color=green>Thread-12 GridMapAuthorization isPermitted Service null</font>
<font color=green>Thread-12 Peer ... authorized as 'fermilab'</font>
<font color=blue>Thread-37 Target http://www.globus.org/08/2004/delegationService}destroy</font>
<font color=blue>Thread-37 GridMapAuthorization isPermitted Service null</font>

<font color=blue>Thread-37 Peer ... authorized as 'fermilab'</font>
</pre>



#TestSix
---++++ Test 6: Trivial job with -s (stream) option and job description file .. delegation

<pre class="screen">
&gt; <b>globusrun-ws -submit -F quux.fnal.gov:9443 -Ft Fork \
    -s -job-description-file /tmp/runjob-ws.sh.6188</b>
  Delegating user credentials...Done.
  Submitting job...Done.
  Job ID: uuid:e34c5066-0096-11db-b438-00502287d62d
  Termination time: 06/21/2006 19:56 GMT
  Current job state: Active
  Current job state: CleanUp-Hold
  Tue Jun 20 14:56:42 CDT 2006
  Current job state: CleanUp
  Current job state: Done
  Destroying job...Done.
  Cleaning up any delegated credentials...Done.

&gt; <b>cat /tmp/runjob-ws.sh.6188</b>
  &lt;job> 
    &lt;executable>/bin/date</executable> 
  &lt;/job>
</pre>



#TestSixServices
---+++++ Services and Authorizations
Same pattern as [[#TestThreeServivces][Test 3]].


%STOPINCLUDE%

%BOTTOMMATTER%
-- Main.JohnWeigand
-- Main.ForrestChristian - 05 Feb 2007

