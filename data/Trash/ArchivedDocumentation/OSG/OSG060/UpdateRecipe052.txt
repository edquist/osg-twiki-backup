%META:TOPICINFO{author="ForrestChristian" date="1172276413" format="1.1" reprev="1.10" version="1.10"}%
%META:TOPICPARENT{name="WebHome"}%
%LINKCSS%

---++Updating an ITB 0.5.2 Installation to use VDT 1.6.1a
%TOC%

%STARTINCLUDE%
%EDITTHIS%

These instruction assume you did the original installation as root and will be preforming the update as root.

We tried very hard to have the update procedure "just work" with pacman -update. We can't just do a pacman -update because of some bugs in the VDT, so we have a script to run before and after the update procedure. In at least one case, the update still failed in hard to detect ways. We're frustrated, but also want to get the update out to you. 

So here is the deal: we would like you to try the update procedure and see if it works. If it does, let us know (email to the osg-int mailing list is good). If it doesn't work, then you'll have to install from scratch. We're sorry for the complex procedure, but we would like to try this out. The ITB is like the wild west!

---+++ Procedure 1: The Pacman update
<ol style="list-style-type: upper-alpha;">
<li> Shutdown VDT Services
<pre class="screen">
# <b>vdt-control --off </b>
</pre> </li>

<li>Back Up the Previous Install
<pre class="screen">
# <b>cp -p -r $VDT_LOCATION /some/backup/directory </b>
# <b>cd $VDT_LOCATION </b>
# <b>source setup.sh </b>
</pre> </li>

<li>Prepare and Install the Update
<pre class="screen">
# <b>wget= http://vdt.cs.wisc.edu/releases/1.6.1/vdt-update-helper.sh </b>
# <b>chmod 0755 vdt-update-helper.sh </b>
# <b>./vdt-update-helper.sh pre </b>
# <b>pacman -update -v download pac </b>
# <b>./vdt-update-helper.sh post </b>
</pre></li>

<li>Look at the shell output from the previous commands. Do you see "failed" anywhere? If so, it failed, skip to Procedure 2. </li>
<li>Look at your setup.sh. Is !MonaLisa_HOME defined? Is GLITE_LOCATION defined? If either of these is missing, it failed. Skip to Procedure 2. </li>
<li>Rerun configuration:
<pre class="screen">
# <b>cp monitoring/osg-attributes.conf.old monitoring/osg-attributes.conf </b>
# <b>$VDT_LOCATION/monitoring/configure-osg.sh </b>
</pre></li>
<li>Restart VDT Services:
<pre class="screen">
# <b>vdt-control --on </b>
</pre>

%NOTE% If you have made any unique changes to /etc/xinetd.d/globus-gatekeeper and /etc/xinetd.d/gsiftp these will need to be redone. 

</li>
<li>Run site_verify.pl to make sure your site looks good. </li>
</ol>
---+++ Procedure 2: The Fresh install

%NOTE% Only do Procedure 2 if Procedure 1 failed. If it failed for any reason, do Procedure 2. 

<ol style="list-style-type: upper-alpha;"> 
<li>Define =OLD_VDT_LOCATION= to point at the backup you made earlier. For instance, if you're using bash and you backed up to =/usr/local/grid.backup=, then:
<pre class="screen">
# <b>export OLD_VDT_LOCATION=/usr/local/grid.backup </b>
</pre> </li>

<li>Switch into the location you want the vdt (pretend it's /usr/local/grid), and blow everything away:
<pre class="screen">
# <b>cd /usr/local/grid </b>
# <b>rm -rf * </b>
</pre> </li>

<li>Install the OSG according to the CEInstallGuide. The difference here is that you defined OLD_VDT_LOCATION, so it will preserve some of your configuration.</li>
</ol>

%STOPINCLUDE%



%BOTTOMMATTER%
-- Main.RobQ - 14 Feb 2007 %BR%
-- Main.ForrestChristian - 23 Feb 2007 (copyedits) %BR%
