%META:TOPICINFO{author="ForrestChristian" date="1172517117" format="1.1" version="1.3"}%
%META:TOPICPARENT{name="DocumentationTable"}%
%LINKCSS%

---+!!<nop>Monitoring Setup Old
%TOC%
%STARTINCLUDE%

---++ Monitoring Setup Old
%EDITTHIS%

---+++ Configure MIS-CI

%IMPORTANT% For OSG-ITB 0.5.1/VDT 1.4.0 and greater, MIS-CI is no longer part of the OSG CE package and
there is nothing to configure, skip all  the MIS-CI instructions below.
 
The Monitoring and Information Services Core Infrastructure (MIS-CI) provides information on the site environment and computing resources. The OSG-CE package includes MIS-CI. This section describes how to configure MIS-CI if you wish to enable it.

The =$VDT_LOCATION/MIS-CI/configure-misci.sh= script performs the configuration. It creates or adds a crontab for the MIS-CI information collectors. The Unix account for the MIS-CI scripts should be <b>mis</b>. By default, the script assumes the !Integration.GridCat DN is mapped to the ivdgl user.  You will need to use the =--choose_user= option to change to <b>mis</b>.

<pre class="screen">
$ <b>cd $VDT_LOCATION</b>
$ <b>SOURCE  ./setup.sh</b>
$ <b>$VDT_LOCATION/MIS-CI/configure-misci.sh --choose_user</b>
    Editing site configuration...
    Creating MIS-CI.db
        :
     <i>( a lot of information on the tables it is creating will appear before any questions are asked)</i>
        :
    Would you like to set up MIS-CI cron now? (y/n) <b>y</b>
    At what frequency (in minutes) would you like to run MIS-CI ? [10] <b>10</b>
    Under which account the cron should run ? [ivdgl] <b>mis</b>
    Frequency 10
    User mis
    Would you like to create MIS-CI crontab  ? (y/n) <b>y</b>
    Updating crontab
    Configuring MIS jobmanager
    /storage/local/data1/osg/MIS-CI/share/misci/globus/jobmanager-mis is created

    Your site configuration :
    sitename ITB_INSTALL_TEST
    dollarapp /storage/local/data1/osg/OSG.DIRS/app
    dollardat /storage/local/data1/osg/OSG.DIRS/data
    dollartmp /storage/local/data1/osg/OSG.DIRS/data
    dollarwnt /storage/local/data1/osg/OSG.DIRS/wn_tmp
    dollargrd /storage/local/data1/osg
    batcheS condor
    vouserS uscms01 ivdgl sdss usatlas1 cdf grase fmri gadu
    End of your site configuration


   If you would like to add more vo users,
   you should edit /storage/local/data1/osg/MIS-CI/etc/misci/mis-ci-site-info.cfg.
   You have additional batch managers :  condor .
   If you would like to add these,
   you should edit /storage/local/data1/osg/MIS-CI/etc/misci/mis-ci-site-info.cfg.

   configure--misci Done
   Please read /storage/local/data1/osg/MIS-CI/README
</pre>


MIS-CI is collecting information using crontab as the user mis (or ivdgl if you left it as the default). Therefore, in order to stop
MIS-CI processes, crontab should be removed. The script =$VDT_LOCATION/MIS-CI/uninstall-misci.sh= is provided for this purpose:
<pre class="screen">
> <b>cd $VDT_LOCATION  </b>
> <b>source setup.(c)sh </b>
> <b>cd MIS-CI </b>
> <b>./uninstall-misci.sh</b>
</pre>

After finishing configuring the MIS-CI, a few checks might be necessary:
<OL>
  <li> Verify the crontab was created for the <i>mis</i> user.
<pre class="screen">
&gt; <b>crontab -u mis -l</b>
</pre></li>
  <li>If you want to force an MIS-CI table update (due to fresh install or update), then as the MIS-CI user (<i>mis</i>), execute:

<pre class="screen">
&gt; <b>$VDT_LOCATION/MIS-CI/sbin/run-mis-ci.sh</b>
</pre>
</li>
  <li>  As a non-root user, verify that at least one table is filled.
%NOTE% If you chose not to force an update, it might take 10 minutes or so before the tables are filled with current information.</b>

<pre class="screen">
&gt; <b>source $VDT_LOCATION/.setup.(c)sh</b>
&gt; <b>grid-proxy-init</b>
 <i>(enter your password)</i>
&gt; <b>globus-job-run &lt;hostname&gt;/jobmanager-mis /bin/sh siteinfo</b>
 <i> (Here &lt;hostname&gt; is the CE hostname.)</i>
 <i>...... sample output ....
   id                       1 
   ymdt                     Wed Jan 11 19:00:01 UTC 2006 
   sitename                 ITB_INSTALL_TEST 
   hostname                 localhost 
   VOname                   local:100 
   appdir                   /storage/local/data1/osg/OSG.DIRS/app 
   datadir                  /storage/local/data1/osg/OSG.DIRS/data 
   tmpdir                   /storage/local/data1/osg/OSG.DIRS/data 
   wntmpdir                 /storage/local/data1/osg/OSG.DIRS/wn_tmp 
   grid3dir                 /storage/local/data1/osg 
   jobcon                    condor 
   utilcon                  fork 
   locpname1                 
   locpname2                 
   ncpurunning              0 
   ncpus                    4 </i>
</pre></li>
</ol>


---+++ Configure MDS (GRIS)
The Globus information system is called MDS and is pre-configured to read the osg-attributes.conf information file.   

The configuration script (<i>VDT_LOCATION/vdt/setup/configure_mds</i>) is executed automatically during the initial download with default values   It also install the <i>gris</i> daemon as an /etc/rc.d service.  

The <i>gris</i> daemon should have been started as a part of the initial installation.  To verify:

<pre class="screen">
&gt;  <b>ps -efwww |grep ldap</b>
daemon    7584     1  0 15:25 ?        00:00:00 /bin/sh  /storage/local/data1/osg/globus/sbin/grid-info-soft-register 
                      -log  /storage/local/data1/osg/globus/var/grid-info-system.log 
                      -f  /storage/local/data1/osg/globus/etc/grid-info-resource-register.conf 
                      -- /storage/local/data1/osg/globus/libexec/grid-info-slapd 
                      -h ldap://0.0.0.0:2135 -d 0 
                      -f /storage/local/data1/osg/globus/etc/grid-info-slapd.conf
daemon    7627  7584  1 15:25 ?        00:00:00 /storage/local/data1/osg/globus/libexec/slapd 
                      -h ldap://0.0.0.0:2135 -d 0 -f /storage/local/data1/osg/globus/etc/grid-info-slapd.conf
daemon    7639     1  0 15:25 ?        00:00:00 /bin/sh  /storage/local/data1/osg/globus/sbin/grid-info-soft-register
                      -log /storage/local/data1/osg/globus/var/grid-info-system.log -register -t mdsreg2
                      -h cmssrv09.fnal.gov -p 2135 -period 600 
                     -dn Mds-Vo-Op-name=register, Mds-Vo-name=ITB_INSTALL_TEST, o=grid -daemon -t ldap 
                      -h cmssrv09.fnal.gov -p 2135 -ttl 1200 -r Mds-Vo-name=local, o=grid -T 20 -b ANONYM-ONLY 
                     -z 0 -m cachedump -period 30
</pre>

If it is not running, you will need to restart it:

<b>Usage:</b>

<verbatim>
 > /etc/init.d/gris  [start | stop ]
</verbatim>


The GRIS by default logs to syslog facility local4.  You can create a log of who is accessing your GRIS by adding the following to =/etc/syslog.conf= (on redhat-like machines):  

<pre>
local4.*                                                /var/log/slapd.log
</pre>

MDS should be configured for anonymous bind.  You can  send a test query to your local host which will perform no authentication on the user submitting the request.  First, verify you have no proxy certificate (/tmp/x509u_(your_PID)).  If one exists, remove it first. Then, 

<pre class="screen">
&gt;  source $VDT_LOCATION/setup.sh
&gt;  grid-info-search -anonymous
<i>... your screen should scroll for a while showing a lot of data... 
....you can redirect the output to validate</i>
</pre>



%STOPINCLUDE%

%WHU%

-- Main.JeffPorter - 24 Jan 2007