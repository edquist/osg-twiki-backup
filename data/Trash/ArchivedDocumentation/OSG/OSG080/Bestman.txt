%META:TOPICINFO{author="AlexSim" date="1196966479" format="1.1" version="1.8"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! *<nop>Berkeley Storage Manager (!BeStMan)*
%TOC%

%STARTINCLUDE%

*Purpose*:   The purpose of this document is to provide [[Storage.BeStMan][BeStMan]] based SE administrators the information on how to prepare, install and validate the SE. 

---++ Preparation
---+++ Introduction
Berkeley Storage Manager ([[Storage.BeStMan][BeStMan]]) is a full implementation of SRM v2.2, developed by Lawrence Berkeley National Laboratory, for a small disk based storage and mass storage systems such as HPSS. End users may have their own personal [[Storage.BeStMan][BeStMan]] that manages and gives an SRM interface to their local disks. It works on top of existing disk-based unix file systems, and has been reported so far to work on file systems such as NFS, PVFS, AFS, GFS, and Lustre. It also works with any existing file transfer service, such as gsiftp, http, https, bbftp and ftp. It requires minimal administrative efforts on the deployment and updates. If storage spans on multiple file systems and storage systems, [[ReleaseDocumentation.DCache][SRM/dCache]] should be considered.

---+++ Integration with the information system
Integration of the SE with the central information systems takes place during the Compute Element installation/configuration. See the topic [[ReleaseDocumentation/GenericInformationProviders][Generic Information Providers]]. The SE does not collect or publish information independently.

---+++ More information
In order to learn more about [[Storage.BeStMan][BeStMan]], please visit the [[http://datagrid.lbl.gov/bestman][BeStMan official website]] and [[Storage.BeStMan][OSG BeStMan Status page]].

---++ Installation
   * Installation information
      * [[http://vdt.cs.wisc.edu][VDT]] provides a package for installing [[Storage.BeStMan][BeStMan]], using pacman. 
      * Manual installation is possible after downloading [[Storage.BeStMan][BeStMan]] from [[http://datagrid.lbl.gov/bestman][http://datagrid.lbl.gov/bestman]], and running configure.
      * Preparation for manual installation 
         * Grid service certificate
            * e.g. /DC=org/DC=doegrids/OU=Services/CN=srmtest/myhost.lbl.gov
            *       /home/srm/osgdemo/srmtestcert.pem 
            *       /home/srm/osgdemo/srmtestkey.pem
         * !GridFTP server hostname, port number
            * e.g. dmx09.lbl.gov
         * GLOBUS_TCP_PORT_RANGE
            * e.g. GLOBUS_TCP_PORT_RANGE=6201,6299
         * Two open port numbers to be assigned to !BeStMan
            * e.g. http=6249, https=6250
         * Local disk path and size information to be managed by !BeStMan
            * e.g. /data/osgdemo/data : 20GB
         * log file path information for !BeStMan
            * e.g. /data/osgdemo/log
         * Java 1.5.0_x installation path
            * e.g. /sandbox/jdk1.5.0_12
         * !BeStMan installation directory
            * e.g. /data/osg/bestman
      * Manual configuration
         * e.g. based on the above sample information
configure \ %BR%
--with-replica-storage-path=/data/osgdemo/data \ %BR%
--with-replica-storage-size=20000 \ %BR%
--with-http-port=6249 \ %BR%
--with-https-port=6250 \ %BR%
--with-globus-tcp-port-range=6201,6299 \ %BR%
--with-certfile-path=/home/srm/osgdemo/srmtestcert.pem \ %BR%
--with-keyfile-path=/home/srm/osgdemo/srmtestkey.pem \ %BR%
--with-eventlog-path=/data/osgdemo/log \ %BR%
--with-cachelog-path=/data/osgdemo/log %BR%

---++ Server control
   * to Start the !BeStMan server, in $SRM_HOME/sbin
      * SXXbestman start  or SXXbestman.personal start
   * to Stop the !BeStMan server, in $SRM_HOME/sbin
      * SXXbestman stop  or SXXbestman.personal stop
   * Or manually
      * e.g. nohup $SRM_HOME/sbin/bestman.server >& /tmp/bestman-.log 2>&1 &

---++ Sample client runs
   * Assuming that SRM_HOME=/data/osgdemo/bestman with above sample configuration
      * ping
         * $SRM_HOME/bin/srm-ping srm://dmx09.lbl.gov:6250/srm/v2/server
      * put
         * $SRM_HOME/bin/srm-copy file:////tmp/test.data srm://dmx09.lbl.gov:6250/srm/v2/server\?SFN=~/osg.test.data
      * ls
         * $SRM_HOME/bin/srm-ls srm://dmx09.lbl.gov:6250/srm/v2/server\?SFN=~/osg.test.data
      * get
         * $SRM_HOME/bin/srm-copy srm://dmx09.lbl.gov:6250/srm/v2/server\?SFN=~/osg.test.data file:////tmp/osg.data
      * rm
         * $SRM_HOME/bin/srm-rm srm://dmx09.lbl.gov:6250/srm/v2/server\?SFN=~/osg.test.data


---++ Installation validation
   * A series of testing can be done with [[Storage.SRMTester][srm-tester]].  
      * Sample command for srm-tester is below.

srm-tester \ %BR%
-serviceurl srm://dmx09.lbl.gov:6250/srm/v2/server \ %BR%
-op ping,put,get,bringonline,ls,mv,srmrm,gsiftp,mkdir,rmdir,reserve,getspacemeta,getspacetokens,release,gettransferprotocols \ %BR%
-deleteafterput false \ %BR%
-putsource file:////tmp/sourcetest.data \ %BR%
-gettarget file:////tmp/targettest.data \ %BR%
-gsiftpcopysource gsiftp://datagrid.lbl.gov//testdata/S/test.data \ %BR%
-browseafterput \ %BR%
-remotetarget "srm://dmx09.lbl.gov:6250/srm/v2/server?SFN=~/srmtest.data" \ %BR%
-browseurl "srm://dmx09.lbl.gov:6250/srm/v2/server?SFN=~/srmtest.data" \ %BR%
-getsource "srm://dmx09.lbl.gov:6250/srm/v2/server?SFN=~/srmtest.data" \ %BR%
-s "srm://dmx09.lbl.gov:6250/srm/v2/server?SFN=~/srmtest.data" \ %BR%
-copytarget "srm://dmx09.lbl.gov:6250/srm/v2/server?SFN=~/srmtest2.data" \ %BR%
-mvtarget "srm://dmx09.lbl.gov:6250/srm/v2/server?SFN=~/srmtest3.data" \ %BR%
-removeurl "srm://dmx09.lbl.gov:6250/srm/v2/server?SFN=~/srmtest3.data" \ %BR%
-dirurl "srm://dmx09.lbl.gov:6250/srm/v2/server?SFN=~/srmtest4" \ %BR%
| & tee bestman.test.log

   * Sample command for srm-tester with a parameter input file is below.
      * e.g. srm-tester -drive -params dmx09.properties
      * e.g. more dmx09.properties
testsites=LBNL %BR%
proxyfile=/tmp/x509up_u9999 %BR%
target=file:////tmp/targettest.data %BR%
putsource=file:////tmp/sourcetest.data %BR%
op=put,get,bringonline,ls,mv,srmrm,gsiftp,mkdir,rmdir,reserve,getspacemeta,getspacetokens,release,gettransferprotocols,getspacetokens %BR%
retrytimeallowed=5 %BR%
gsiftpcopysource=gsiftp://datagrid.lbl.gov//testdata/S/test.data %BR%
pullcopysrm=LBNL@srm://dmx09.lbl.gov:6250/srm/v2/server?SFN=~/srmtest.data %BR%
browseafterput=true %BR%
advisorydelete=false %BR%
putoverwrite=LBNL@true %BR%
%BR%

%STOPINCLUDE%
%BR%
%COMPLETE3% %BR% 
%RESPONSIBLE% Main.AlexSim - 4 Dec 2007 %BR%
%REVIEW%