%META:TOPICINFO{author="KyleGross" date="1476285321" format="1.1" version="1.20"}%
%META:TOPICPARENT{name="ComputeElementInstall"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

%STARTINCLUDE%
%BR%
---+ _%INCLUDEHEADING%  %SPACEOUT{ "%TOPIC%" }%_
%EDITTHIS%
%BR%

---++ RSV background

<p> The [[Trash/MonitoringInformation.RSV][OSG-RSV]] package, by default, is installed along with the OSG CE but not fully configured. Additional configuration steps are necessary as documented below. If you are looking to install !RSV on a monitoring host independent of your CE then please [[http://rsv.grid.iu.edu/documentation/vdt-package.html#install_on_monitoring_host][look here]] for instructions on that. 

<p> *Note*: Refer to [[PreInstallationChecklistCE#Using_existing_Condor_6_9_x_inst][the pre-install Checklist]] for information about using a pre-existing Condor *6.9.x* installation instead of condor-devel that OSG-RSV brings along. 

---++ Upgrade for early OSG 0.8 installations

<p> If you're looking to upgrade RSV on an existing %CACHE% %VERSION% CE, then [[%VDT_DOCS_URL%/release-a.html#rsv][look here]] for upgrade instructions, and then refer back to this page for configuration information. Sysadmins who installed RSV before Dec 13th 2007 can find [[http://vdt.cs.wisc.edu/releases/1.8.1/release-f.html][instructions on getting RSV bug fixes]], specifically to the <tt>classads-valid-probe</tt> and the local site admin's HTML page generator, through VDT's 1.8.1f release (Scroll down to section 5).

---++ RSV configuration steps

All steps below need to be executed as =root=.

   * Configure Metrics to run and how often: If this is the first time you're configuring !RSV, then copy the sample metrics file =$VDT_LOCATION/osg-rsv/config/sample_metrics.conf= to =$VDT_LOCATION/osg-rsv/config/&#60;host_FQDN&#62;_metrics.conf=, and make further edits to it if necessary. The sample file has the metrics listed with appropriate (recommended) time intervals. Enable/Disable a particular metric: Any line that starts with *on* is enabled; change that keyword to *off* to disable a metric. For example, if you site runs only the PBS job-manager, then you might disable the other jobmanagers-status probes.
   <pre>   on jobmanagers-status-probe@org.osg.batch.jobmanager-pbs-status 24 */2 * * *</pre>
   More information on this is [[http://rsv.grid.iu.edu/documentation/vdt-1.8.1a-package.html#configure_metrics][available here]]. Go here for documenation on [[http://rsv.grid.iu.edu/documentation/vdt-1.8.1a-package.html#extra_probe_specs][adding custom switches to the !RSV !probes]].

   * Ensure you have a valid username for !RSV (say, =rsvuser=); then run !RSV config scripts as shown below. Replace entries in =<em><strong>italics</strong></em>= to appropriate values (<em>FQDN of your CE, a non-root user, and a proxy file for that user's UID owned by that user</em> with 600 permissions):
   <pre> $VDT_LOCATION/vdt/setup/configure_osg_rsv --uri &#60;<em><strong>FQDN of host to probe</strong></em>&#62; \
   --user <em><strong>rsvuser</strong></em> --init --server y --setup-for-apache \
   --probes --gratia --verbose --proxy /tmp/x509up_u<em><strong>550</strong></em> </pre>
      More information on the !RSV configuration script is [[http://rsv.grid.iu.edu/documentation/vdt-1.8.1a-package.html#configure_osg_rsv_script][available here]].

   * If you chose *not* to configure the !RSV Gratia collector in the =configure-osg.sh= step, then run =configure_gratia= to setup metric probe:
   <pre>$VDT_LOCATION/vdt/setup/configure_gratia --probe metric --report-to &#60;Appropriate_RSV_collector_shown_below:port&#62;</pre>
     !Trash/MonitoringInformation.RSV Collector to use in above command execution
     | <strong>Production Resources</strong> | <strong>ITB Resources</strong> |
     | rsv.grid.iu.edu:8880 | rsv-itb.grid.iu.edu:8880 |

   * Start Condor-devel and !RSV services (and Apache, assuming you want the VDT Apache to serve your local status pages)
  <pre>   vdt-control --on condor-devel
   vdt-control --on  osg-rsv
   $VDT_LOCATION/vdt/setup/configure_apache --server y
   vdt-control --on  apache </pre>
      More information on this  is [[http://rsv.grid.iu.edu/documentation/vdt-1.8.1a-package.html#start_rsv][available here]].

   * If you want to be sure everything worked fine, you should look for two things: 
      * Look at Gratia consumer log file: =$VDT_LOCATION/osg-rsv/logs/consumers/gratia-script-consumer.out= to see if probe results were uploaded succesfully to the !GOC maintained !RSV database. You should a bunch of entries similar to this:
   <pre>   08-20-2007 16:35:26 - Executing script '/usr/local/grid/ . . . record.py'
   OK </pre>
      *  Check out the status web page that is created with results of RSV probe runs each day. By default, this page is =$VDT_LOCATION/osg-rsv/output/html/status.html=, but can be reconfigured. You can either view the local status pages directly on the monitoring host ; or you can view these pages on the web at !http://&#60;FQDN_of_monitoring_host&#62;:8080/rsv, assuming you [[http://rsv.grid.iu.edu/documentation/vdt-package.html#configure_osg_rsv_script_localweb][configured !RSV to use the !VDT Apache]] to serve them in the above configuration steps. Beware that you <em>need to have an !OSG approved cert loaded in your web browser</em> to be able to view them page. The status pages should look similar to [[http://rsv.grid.iu.edu/documentation/sample_status.html][what is documented here]].

More information on configuring !RSV and related topics is available in the [[http://rsv.grid.iu.edu/documentation/vdt-package.html][RSV documentation pages]].


%STOPINCLUDE%
%BR%
%COMPLETE3% %BR%
%RESPONSIBLE% -- Main.ArvindGopu - 21 Nov 2007 %BR%
%REVIEW%

%META:TOPICMOVED{by="AnneHeavey" date="1192740955" from="Integration/ITB_0_7.RSVInstallGuide" to="Integration/ITB_0_7.InstallAndConfigureRSV"}%
