%META:TOPICINFO{author="JohnWeigand" date="1178734456" format="1.1" reprev="1.12" version="1.12"}%
%META:TOPICPARENT{name="OsgCEAuthorization"}%
%LINKCSS%

---+!!<nop>The gums-host-cron cronfile and script

%STARTINCLUDE%
%EDITTHIS%

%IMPORTANT% Beginning with OSG 0.5.1, the =grid3-user-vo-map.txt= name is being deprecated.  The new name will be =osg-user-vo-map.txt=.  The documentation in this section will reference the new name.  To facilitate the transition, the scripts that maintain this file will insure both files exists (the old one symlinked to the new one).  So when you see this occur, do not be concerned.  At some point in the future when all components referencing this file have been changed, the scripts will remove all evidence of this little inconvenience.

   * For the Grid3 Scenario: To facilitate ongoing maintenance of the <i>/etc/grid-security/grid-mapfile</i> and <i>$VDT_LOCATION/monitoring/osg-user-vo-map.txt</i> files, a cron file and script were installed in your installation directory and will need to be activated.
   * In the Compatibility Scenario: Both the <i>grid-mapfile</i> and <i>osg-user-vo-map-txt</i> need to be updated at the same time from your GUMS server.
   * In the Full Privilege Scenario: <i>grid-mapfile</i> is not used; only the <i>$VDT_LOCATION/monitoring/osg-user-vo-map.txt</i> needs to be updated from your GUMS server.

A script (<i>gums-host-cron</i>) has been provided in <i>$VDT_LOCATION/gums/bin/gums-host-cron</i>  This script will do the following:
   1. It executes the <i>gums-host</i> command  using both the <i>generateGridMapfile</i> and <i>generateGrid3UserVoMap</i> arguments. In order to determine your authorization mode, the script looks for the existence of the PRIMA callout in the <i>/etc/grid-security/gsi-authz.conf</i> file.  If present, it assumes Full Privilege mode.  If not, it assumes Compatibility mode.
   1. It creates a temporary copy of the <i>osg-user-vo-map.txt</i> and <i>grid-mapfile</i> (if needed) and compares them against the current copy.
   1. It only updates the CE node's current copy if a change has occurred.  When a change is effected, a backup of the old file with a <i>*.cronsaved</i> suffix will be created.   This allows an administrator to more easily identify any changes.  The date of the backup file will reflect when it was last in effect.
   1. Additionally, the script will create 2 more files in the <i>.monitoring</i> directory:
      * <i>osg-supported-vo-list.txt</i>:  Identifies the list of VOs for which services can be authorized and have at least one UNIX account created.
      * <i>osg-undefined-accounts.txt</i>: Identifies UNIX accounts that can be assigned by <i>GUMS</i>, but have not yet been created on the CE node. 
   1. At the completion of each successful run, it will create an empty <i>osg-user-vo-map.last-checked</i> file as a time stamp.  It should always have a time stamp equal or later to that of the <i>osg-user-vo-map.txt</i> file. This file allows the administrator(s) to more easily verify the currency of the data.


To test the <i>gums-host-cron</i> script and to initially populate the files for the first time using your GUMS server (as <i>root</i>):

<pre class="screen">
 &gt; $VDT_LOCATION/gums/bin/gums-host-cron
</pre>

During the installation process, the <i>gums-host-cron</i> cron process was automatically enabled.  The default interval is every 6 hours and the time randomly set. You can verify this by running the <i>vdt-control</i> script and you can view the timing in the <i>$VDT_LOCATION/vdt/services/state</i> file.
<pre class="screen">
 &gt; source $VDT_LOCATION/setup.sh
 &gt; vdt-control --list gums-host-cron
<b>... output....</b>
Service            | Type   | Desired State
-------------------+--------+--------------
gums-host-cron     | cron   | enable
<b>... end of output....</b>

&gt; grep gums-host-cron $VDT_LOCATION/vdt/services/state
gums-host-cron  cron    enable  51 11,17,23,5 * * *     /storage/local/data1/osg-ce/gums/bin/gums-host-cron
</pre>
%IMPORTANT% If you desire to change the timing, change the <i>$VDT_LOCATION/vdt/services/state</i> file and <b>NOT</b> the crontab entry.  Then run the following to effect the change:
<pre class="screen">
&gt; vdt-control --off gums-host-cron
&gt; vdt-control --on gums-host-cron
</pre>

%STOPINCLUDE%
%WHU%

<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

---++!! Major updates
-- Main.JohnWeigand - 29 Sep 2006 - NOTE:  This is used as an include and intentionally mentions both Compatibility and Full Privilege Modes even though this may be included in sections specific to one or the other.   Much of the explanation is the same regardless of the mode and I wanted it to be consistent.  %BR% 
-- Main.JohnWeigand - 09 May 2007 - Corrected the implementation instructions for the gums-host-cron cron entry.

%META:TOPICMOVED{by="ForrestChristian" date="1166051290" from="Integration.GumsHostCron050" to="Integration/ITB_0_5.GumsHostCron"}%
