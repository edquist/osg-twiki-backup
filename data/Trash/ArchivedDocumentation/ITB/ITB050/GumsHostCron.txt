%META:TOPICINFO{author="JohnWeigand" date="1161809678" format="1.1" reprev="1.3" version="1.3"}%
%META:TOPICPARENT{name="OsgCEAuthorization050"}%
---+!!<nop>The gums-host-cron cronfile and script

%STARTINCLUDE%
<div class="twikiSmall" style="text-align: left; font-style: italic;"><a href="%SCRIPTURLPATH%/edit%SCRIPTSUFFIX%/%WEB%/%TOPIC%?t=%SERVERTIME{ "$epoch" }%">Edit this section</a></div>

<font color="blue"><b>Note:</b> Beginning with OSG 0.5.1, the <i>grid3-user-vo-map.txt</i> name is being deprecated.  The new name will be <i>osg-user-vo-map.txt</i>.  The documentation in this section will reference the new name.  To facillitate the transition, the scripts that maintain this file will insure both files exists (the old one symlinked to the new one).  So when you see this occur, do not be concerned.  At some point in the future when all components referencing this file have been changed, the scripts will remove all evidence of this little inconvenience.</font>

To facilliate ongoing maintenance of the <i>grid-mapfile</i> and <i>osg-user-vo-map.txt</i> files, a cron file and script were installed in your installation directory and will need to be activated.
<UL>
<LI>In the Compatibility Scenario, both the <i>grid-mapfile</i> and <i>osg-user-vo-map-txt</i> need to be updated at the same time from your GUMS server.
<LI>In the Full Privilege Scenario, only the <i>osg-user-vo-map-txt</i> needs to be updated from your GUMS server.
</UL>

A script (<i>gums-host-cron</i>) has been provided in <i>$VDT_LOCATION/gums/bin/gums-host-cron</i>  This script will do the following:
<OL>
<LI>It executes the <i>gums-host</i> command  using both the <i>generateGridMapfile</i> and <i>generateGrid3UserVoMap</i> arguments.<br>
In order to determine your authorization mode, the scipt looks for the existence of the prima callout in the <i>/etc/grid-security/gsi-authz.conf</i> file.  If present, it assumes Full Privilege mode.  If not, it assumes Compatiblity mode..
<LI>It will create a temporary copy of the files and compares them against the current copy
<LI>It only updates the CE nodes current copy if a change has occurred.  When a change is effected, a backup of the old file with a <i>*.cronsaved</i> suffix will be created.   This allows and adminstartor to more easily identify any changes.  The date of the backup file will reflect when it was last in effect.
<LI>At the completion of each successful run, it will create a file called with a <i>*.last-checked</i> suffix.  This will allow the administartor(s) to more easily verify the currency of the data.
</OL>

To test the <i>gums-host-cron</i> script and to initially populate the two files for the first time using your GUMS server (as <i>root</i>):
<pre>
  &gt;  $VDT_LOCATION/gums/bin/gums-host-cron
</pre>

A cron file has been installed in <i>$VDT_LOCATION/post-install/gums-host-cron</i>. The default interval is every 6 hours. Example cron:
<pre>
  0 0,6,12,18 * * * root &lt;VDT_LOCATION&gt;/gums/bin/gums-host-cron
</pre>
To implement the cron (as <i>root</i>):
<pre>
  &gt;   cd  /etc/cron.d
  &gt;   ln -s $VDT_LOCATION/post-install/gums-host-cron
&gt; <b>cd  /etc/cron.d</b>
&gt; <b>ln -s $VDT_LOCATION/post-install/gums-host-cron</b>
</pre>
%WHU%

<hr/>
*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.JohnWeigand - 29 Sep 2006 - NOTE:  This is used as an include and intentionally mentions both Compatiblity and Full Privilege Modes even though this may be included in sections specific to one or the other.   Much of the explantion is the same regardless of the mode and I wanted it to be consistent.<br>
<!-- MAJOR UPDATES
<!-- This INCLUDE produces a WHU cross-reference for this topic -->
%INCLUDE("WhuReferences")%
%INCLUDE{"WhuReferences"}%

%META:TOPICMOVED{by="ForrestChristian" date="1166051290" from="Integration.GumsHostCron050" to="Integration/ITB_0_5.GumsHostCron"}%
