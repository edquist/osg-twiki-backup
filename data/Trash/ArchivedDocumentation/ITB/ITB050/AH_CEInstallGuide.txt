%META:TOPICINFO{author="ElizabethChism" date="1466010124" format="1.1" version="1.5"}%
%LINKCSS%
---+!!<nop>OSG CE 0.5.n Installation Instructions

This document is intended for administrators responsible for installing and configuring:%BR%
   *OSG Compute Element (CE) version 0.5.2 onto OSG ITB Resources*

It is not meant as an all-inclusive guide to Grid computing or even all the options for configuring a CE. 

%TOC%
%STARTINCLUDE%

---++ Introduction

<!-- Instructions for installing a CE intended for the OSG version 0.4.0 Production grid can be found [[http://kb.grid.iu.edu/data/aths.html][here]]. -->

%INCLUDE{"OsgConventions"}%
Also see [[http://vdt.cs.wisc.edu/releases/1.6.1/installation_think.html][Installation Considerations for 1.6.1]] from VDT site.

%INCLUDE{"OperatingSystems"}%
%INCLUDE{"OSGInstallationMethod"}%
Need to add recommendations for using root vs nonroot.  (vdt site has a page; need to find)
%INCLUDE{"InstallationAssistance"}%
To see updates that appear in this release, see [[CEReleaseChanges]].
This section not needed for first timers; CRL is not defined; for MIS-CI service give sample command for removing cron entry
%INCLUDE{"VdtReleaseNotes"}%
%INCLUDE{"AH_CESoftWare"}%




<!-- INCLUDE{"CEKnownProblems"}  Moved to Trouble shooting guide -->


%INCLUDE{"AH_CEPreInstallationChecklist"}%
Move to after cert stuff (which is after ce install)

---++
To install pacman, see [[PacmanInfo]].  Find pacman troubleshooting info there, too.  To just install it:
<verbatim>
> cd  [install directory]
> wget http://physics.bu.edu/pacman/sample.cache/tarballs/pacman-[version].tar.gz
</verbatim>
Where the pacman version appropriate for OSG 0.6.0 is 3.19. E.g.,:
<verbatim>
> wget http://physics.bu.edu/pacman/sample.cache/tarballs/pacman-3.19.tar.gz
</verbatim>

---++Installing the OSG Worker Node Client Package

This must be installed in a location visible to jobs executing on the worker node. Refer to the 
[[WorkerNodeClient][Worker Node Client]] Guide for additional information.

%INCLUDE{"AH_CEInstallingServices"}%
%INCLUDE{"AH_CESoftWareDiscover"}%
%INCLUDE{"AH_CEConfigurePKI"}%
%INCLUDE{"CESiteAdminGuide"}%
---++ Batch System
If you intend to use the [[http://www.cs.wisc.edu/condor/][Condor]] system, install it from the VDT cache using pacman. You can do this before or after installing the CE package.  We strongly recommend to install Condor in a different directory than your main CE installation ($VDT_LOCATION), e.g., =/opt/condor=.   See Trash/Integration.CondorBatchSystemHints and Trash/Integration.MinimalCondorHints for more information  And see [[http://www.cs.wisc.edu/condor/manual/v6.8/3_2Installation.html][Condor installation instructions]]. (will change version, so link will need to change)

To pull Condor from the VDT cache, use:

<pre class="screen">
 > <b>pacman -get http://vdt.cs.wisc.edu/vdt_161_cache:Condor</b>
</pre>

This runs a script; answer "y" to the yes/no questions. Install the CA files in the same place as for the CE install (usually "r" for /etc/grid-security/certificates is the right choice)

---+++ If Condor is installed outside $VDT_LOCATION
(Any pre-existing Condor installation will be outside this area.)

If you have installed Condor as your batch queuing system, you are required to set two environment variables so the Condor path is correctly configured. This will ensure that VDT middleware services point to appropriate locations in your external Condor installation.

If you first source the Condor setup script, it will set the variables CONDOR_LOCATION and CONDOR_CONFIG and CONDOR_ROOT.  You can use these in the following variable definitions if you like. Afterwards you will have to source the VDT setup script to reset variables. 

   * *VDTSETUP_CONDOR_LOCATION* - the location of your Condor installation  (e.g. =/opt/condor=). The Condor =bin/=, =bin=, =etc/=, =lib/=... directories should be directly under this location. (E.g., =export VDTSETUP_CONDOR_LOCATION=$CONDOR_LOCATION=) This will preserve a Condor installed in the standard location.
   * *VDTSETUP_CONDOR_CONFIG* (optional): The location of your Condor configuration file (if non-standard). Default is =$VDTSETUP_CONDOR_LOCATION/etc/condor_config=.

Go back to $VDT_LOCATION and source the setup script there.
%INCLUDE{"ManagedFork"}%
%RED%Mention in included file above: "disabling is only if you don't like it: Put back in place the default fork manager..." %ENDCOLOR%
%INCLUDE{"ConfiguringGlobusJobs"}%

%INCLUDE{"StartingServices"}%

%INCLUDE{"ConfigureOSGAttributes"}%

%INCLUDE{"CESimpleTest"}%


---++ Authorizing Users: Operational Configuration
The earlier test case only authorized yourself as a local user.  You should now go to  [[OsgCEAuthorization][Osg CE Authorization]] document and authorize other users before performing the *OSG Registration* of your service (otherwise no one but you will be able to access it!).  You should do this before doing the rest of the monitoring configuration steps below, otherwise you may  have to repeat the steps later, particularly if your site is using GUMS.

---++ Installing and Configuring Globus Web Services
Instructions and configuration of WS-GRAM can be viewed [[InstallAndConfigureGlobusWebServices][here]].
%RED% First part "basics" contains commands that are only informational; go to Authorization Modes %ENDCOLOR%
For full privilege setup, all you need is:
<verbatim>
> cd $VDT_LOCATION
> source setup.sh
> ./vdt/setup/configure_prima_gt4 --enable \
               --gums-server YOUR_GUMS_SERVICE
</verbatim>
This brings up some messages; follow this doc, not those messages. %BR%
Need to do sudoers thing -- find user under which VDT has the services run: In Preinstall info, it says " if there's already a globus user, the web services container will run as globus; else as daemon.%BR%
In visudo, copy in do shift colon, then set list to check that there are no whitespaces after the slashes.%BR%
My =vdt-control --on globus-ws ...=
failed; did we forget to configure web services?%BR%
need to clone the host certs and have them owned by same owner as web services -- problem when you put in certs after ce install, which i did.
John thinks certs should be in place first. %BR%
Run
$VDT_LOCATION/vdt/setup/configure_globus_ws%BR%
and%BR%
$VDT_LOCATION/vdt/setup/configure_globus_wsgram

if it doesn't work, go see "starting services" to do the vdt register thing.
---++Monitoring Setup

%INCLUDE{"CENodeGIP"}%
%INCLUDE{"CENodeCEMon"}%

---++ Optional Components
---+++ !Trash/Integration.MonALISA
To configure this optional component, see the 
[[MonALISA][Trash/Integration.MonALISA]] document in this guide.

---+++ !Trash/Integration.Squid

%INCLUDE{"CESquidInstallation"}%

<!--  Discovery Service  To configure this optional component, see the  <a href="http://osg.ivdgl.org/twiki/bin/view/ReleaseDocumentation/Trash/Integration.DiscoveryServiceInstallation"> Discovery Service MDS)</a> document in this guide. -->


%INCLUDE{"CESiteVerify"}%

%INCLUDE{"CEFireWalls"}%

%INCLUDE{"CEInstallTroubleShooting"}%

%INCLUDE{"OSGShutdownGuide"}%

<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->
*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.RobQ - 01 May 2006<br>
-- Main.MarciaTeckenbrock - 12 Sep 2006<br>
-- Main.JohnWeigand - 05 Oct 2006 - updated the "Activate your site" TOC entry for the new file and site-status script.<br>
-- Main.JeffPorter - 23 Jan 2007 - Moving some text to INCLUDE documents

%STOPINCLUDE%
%INCLUDE{"Trash/Integration.WhuReferences"}%


-- Main.AnneHeavey - 27 Apr 2007
