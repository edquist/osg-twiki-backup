%META:TOPICINFO{author="KyleGross" date="1225985924" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="VomsWhatToDo"}%
%LINKCSS%


---+!! Enabling a VirtualOrganizations/VOInfoMS VO - the voms-admin command
%TOC%

%STARTINCLUDE%
---++Enabling a VirtualOrganizations/VOInfoMS VO - the voms-admin command
%EDITTHIS%


Several things have to be done to actually enable your VirtualOrganizations/VOInfo to begin accepting membership, used for voms proxy generation, and used for the Compatibility and Full  Privilege [[OsgCEAuthorization][authorization modes]] on compute (CE) and storage (SE) element  nodes.

The following sub-sections will reference the default <i>VDT</i> in the text and examples.  When enabling your 'real' VO, the same steps are required and, where different, it will be noted.


---+++Establishing a VirtualOrganizations/VOInfo-Admin
A person (or persons) can be designated as the VirtualOrganizations/VOInfo-Admin for the VirtualOrganizations/VOInfoMS VirtualOrganizations/VOInfo created.  This person(s) has administrative capability within VirtualOrganizations/VOInfoMS that the normal VirtualOrganizations/VOInfo member will not have.  

There are 2 options for adding this capability to an individual:

<ol>
  <li>The individual <u>is not</u> a member of the VO.   A Global-ACL for that individual with <i>allow all</i> capability allows a person to administer the VirtualOrganizations/VOInfo's VirtualOrganizations/VOInfoMS from the command line and WEB UI.
    <ul>
      <li>Individual's certificate file is available:
<pre class="screen">
&gt; <b>source $VDT_LOCATION/setup.sh</b>
&gt; <b>voms-admin -vo <em>VO</em> add-acl-entry Global-ACL \
        allow all <em>usercert.pem</em></b>
</pre>
      </li>
      <li>Individual's certificate file is <u>not</u> available:
<pre class="screen">
&gt; <b>voms-admin -vo <em>VO</em>  -nousercert  add-acl-entry  Global-ACL \
  allow all \
 "<em>USER DN</em>" "<em>USER CA</em>"</b>
</pre>
      </li>
    </ul>
  </li>
  <li>The individual <u>is</u> a member of the VO.  This can be accomplished by giving the individual the Global-ACL capability above or by first adding them to the VirtualOrganizations/VOInfo as a member (described in the next section) and then assigning them the <i>VirtualOrganizations/VOInfo-Admin</i> role with the following command:
    <ul>
      <li>Individual's certificate file is available:     
<pre class="screen">
&gt; <b>voms-admin -vo <em>VO</em> assign-role  <em>GROUP</em> \
                 VO-Admin <em>usercert.pem</em></b>
</pre>
	  </li>
      <li>Individual's certificate file is <u>not</u> available:
<pre class="screen">
&gt; <b>voms-admin -vo <em>VO</em> assign-role  <em>GROUP</em> \
                 VO-Admin  \
                 "<em>USER DN</em>" "<em>USER CA</em>"</b>
</pre>
	  </li>
    </ul>
  </li>
</ol>

---+++Adding  a user to the VO
Individuals with the <i>VirtualOrganizations/VOInfo-Admin</i> role or the  <i>allow all</i> Global-ACL are referred to as VirtualOrganizations/VOInfo Managers in VirtualOrganizations/VOInfoMS and are the only ones who can add new members via the web UI.

In normal practice, users will request VirtualOrganizations/VOInfo membership by accessing the <i>New user registration</i> menu item on the main VirtualOrganizations/VOInfoMS web page.  This document will not go into the details of that process here, nor will it address the basic usage and navigation of the VirtualOrganizations/VOInfoMS web ui.

The purpose of this section is to show you how to add a user for the purposes of assigning the <i>VirtualOrganizations/VOInfo-Admin</i> role as a part of the initial setup.   

Four data items are required for each user:
   * DN
   * CA
   * Common Name (CN part of the DN or just 1st and last name so you can be easily identified)
   * email address 


If you have the user's certificate file available, then these 4 items are derived from that.
<ul>
  <li>Individual's certificate file is available:     
<pre class="screen">
&gt; <b>voms-admin -vo <em>VO</em> add-member  \
       <em>GROUP</em>  <em>usercert.pem</em></b>
</pre>
  </li>
  <li>Individual's certificate file is <u>not</u> available:
<pre class="screen">
&gt; <b>voms-admin -vo <em>VO</em> add-member  \
       <em>GROUP</em>   \
       "<em>USER DN</em>" "<em>USER CA</em>"  \
       "<em>USER CN</em>" <em>USER EMAIL</em>"</b>
</pre>
  </li>
</ul>

If you have added the user for the purpose of assigning the <i>VirtualOrganizations/VOInfo-Admin</i> role, you will want to re-visit [[VomsWhatToDo#Establishing_a_VO_Admin][Establishing a VirtualOrganizations/VOInfo-Admin]] to assign the role.


---+++Verifying you are a VirtualOrganizations/VOInfo-Admin
If you've established yourself with the <i>VirtualOrganizations/VOInfo-Admin</i> role or with the <i>allow all</i> Global-ACL, you can now go back the VirtualOrganizations/VOInfoMS web ui in a browser with your certificate and from the main menu:
   1. Under <i>For VirtualOrganizations/VOInfo Managers</i>, select <i>Administer the VO</i>
   1. Then, select <i>Global ACL</i>

You should no longer see the <i>Access Denied</i> error and should be able to see the Global-ACL's  that have been created.   As a <i>VirtualOrganizations/VOInfo-Admin</i>, you can do anything you want.  

%NOTE% A user with the <i>VirtualOrganizations/VOInfo-Admin</i> role only has these privileges in the VirtualOrganizations/VOInfoMS web ui.  The command line <i>voms-admin</i>  does not authorize using the VirtualOrganizations/VOInfoMS roles.  It allow <i>voms-admin</i> command line capability, you must establish a Global-ACL with the capability you desire.  By default, only the <i>root</i> user has this on initial installation.


---+++Enabling read-only access to your VO
Another Global-ACL needs to be created with <i>allow list</i> capabilities for anyone that presents a certificate issued by a known VO.  The purpose for this is two-fold:
   * Those sites using [[GumsAdmins][GUMS servers]] will be able to access your VirtualOrganizations/VOInfo without the VirtualOrganizations/VOInfo-Admin having to individually provide this  Global-ACL capability on a case by case basis.  
   * It allows VirtualOrganizations/VOInfo members or (those that think they are VirtualOrganizations/VOInfo members) to query the VirtualOrganizations/VOInfoMS to troubleshoot problems in getting voms proxies and verify their membership in various groups and role assignments. 

To enable read-only access, execute the following command:

<pre class="screen">
&gt; <b>source $VDT_LOCATION</b>
&gt; <b>voms-admin --vo <em>VO</em>  --nousercert add-acl-entry \
   Global-ACL allow list \
   "/O=VOMS/O=System/CN=Any Authenticated User" \
   "/O=VOMS/O=System/CN=Dummy Certificate Authority"</b>
</pre>




%STOPINCLUDE%

%BOTTOMMATTER%

-- Main.JohnWeigand - 27 Feb 2007