%META:TOPICINFO{author="ForrestChristian" date="1172188591" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="InstallAndConfigureGlobusWebServices"}%
%LINKCSS%

---+!! Basic web services with PRIMA authorization
%TOC%

%STARTINCLUDE%
%EDITTHIS%

---+++ Installing GLOBUS web services with PRIMA authorization
The necessary software for web services using the grid-mapfile for authorizing access is already installed. Some of the configuration has already been completed, but the service  has not been activated.

<!-- Additonally, for OSG 0.4.1, you will need to install the <i>PRIMA-GT4</i> pacman cache from VDT. <br><b>Note:</b>For OSG 0.5.n, this cache is already installed. -->

<pre class="screen">
&gt; <b>cd $VDT_LOCATION</b>
&gt; <b>source setup.sh</b>
&gt; <b>source $PACMAN_LOCATION/setup.sh</b>
&gt; <b>pacman -get http://www.cs.wisc.edu/vdt/vdt_1310_cache:PRIMA-GT4</b>
</pre>

This should not prompt you with questions.

This installs the following jar files in =$VDT_LOCATION/globus/lib=:
   * bcprov-jdk14-122.jar
   * opensaml-renamed-1.0.1.jar
   * prima-gt4-0.1.0.jar
   * glite-security-util-java-1.0.0dev.jar  
   * org.glite.security.voms-api-java-unknown.jar  
   * privilege-1.1.0.jar


---+++ Configuring PRIMA web services authorization
During the installation above, the following configuration scripts have already been run.  You can view their output in the =$VDT_LOCATION/vdt-install.log=:

| =./vdt/setup/configure_globus_ws= | [[http://vdt.cs.wisc.edu/releases/1.3.10/config/configure_globus_ws][VDT description]] |
| =./vdt/setup/configure_globus_wsgram= | [[http://vdt.cs.wisc.edu/releases/1.3.10/config/configure_globus_wsgram][VDT description]] |

If you are going to continue with the configuration for PRIMA, you should stop the stop the globus web services container if it is already running:

<pre class="screen">
&gt; <b>/etc/init.d/globus-ws stop</b>
 <i>... verify it is stopped</i>
&gt; </b>ps -efwww |grep "org.globus.wsrf.container.ServiceContainer"</b>
</pre>

You then need to configure web services for prima authorization by running the <i>configure_prima_gt4</i> script (see the [[http://vdt.cs.wisc.edu/releases/1.3.10/config/configure_prima_gt4.html][VDT description]])

<pre class="screen">
&gt; <b>cd $VDT_LOCATION</b>
&gt; <b>source setup.sh</b>
&gt; <b>./vdt/setup/configure_prima_gt4 --enable --gums-server YOUR_GUMS_SERVICE</b>
</pre>

E.g., =./vdt/setup/configure_prima_gt4 --enable --gums-server cmssrv09.fnal.gov=

There are four security configuration files that identify use of the default <i>gridmap</i> authorization services.  These can be found in =$VDT_LOCATION/globus/etc/=:

<pre>
globus_delegation_service/factory-security-config.xml
globus_wsrf_core/global_security_descriptor.xml
globus_wsrf_rft/factory-security-config.xml
gram-service/managed-job-factory-security-config.xml
</pre>

=$VDT_LOCATION/post-install/README= contains a section called <i>Globus-Base-WS-Essentials</i> with the following:
   * The user selected to run the Globus web services (container) as <i>globus</i> if it already exists. If not, then <i>daemon</i>.
   * It will say your host certificate was <i>cloned</i> as =containercert.pem/containerkey.pem= since the globus ws container runs as a non-root user.
%IMPORTANT% When you renew your host certifcate, be sure to clone it in these =container*.pem= files as well.
   * The init script was copied to =/etc/init.d/globus-ws=


---+++ Modifying =/etc/sudoer=

In =$VDT_LOCATION/post-install/README=, the section <i>Globus-Base-WSGRAM-Server</i> describes the modifications to =/etc/sudoer= necessary for the web services GRAM to function properly.

%NOTE% This must be done manually.

Make these changes now, keeping in mind the user under which VDT determined your container will run.

%IMPORTANT% Paths =/etc/sudoer= cannot be soft links. Use full paths only.

Example =/etc/sudoer= recommendations from an installation where local user IDs do _not_ have to be maintained. In the example that follows, the web services user is the <i>daemon</i> user: 

<pre class="programlisting">
Runas_Alias GLOBUSUSERS = ALL, !root
daemon ALL=(GLOBUSUSERS) \
     NOPASSWD: \
     /usr/local/osg-ce/globus/libexec/globus-job-manager-script.pl *
daemon ALL=(GLOBUSUSERS) \
     NOPASSWD: \
     /usr/local/osg-ce/globus/libexec/globus-gram-local-proxy-tool *
</pre>



<a name="vomsdir-install" />

---+++ Additional configurations required

Ensure that you have a =/etc/grid-security/vomsdir= directory containing one certificate. Your host certtificate will do. You will need to create the directory and populate it with your host certificate until this is resolved.

%STARTInsetBox%
---++++ prima-authz.conf vomsdir and verifyAC behavior
%INCLUDE{ "PrimaauthzConfAndVerifyACBehavior" }%
%ENDInsetBox%

As root:
<pre class="screen">
> <b>cd /etc/grid-security</b>
> <b>mkdir vomsdir</b>
> <b>cp -p containercert.pem vomsdir/.</b>
</pre>


Continue with the [[InstallAndConfigureGlobusWebServices#CommonSteps][Common Steps]]

%STOPINCLUDE%

%WHU%
---++!! Major Updates
-- John Weigand %BR%
-- Main.ForrestChristian - 09 Feb 2007 %BR% 