%META:TOPICINFO{author="ForrestChristian" date="1166049447" format="1.1" reprev="1.4" version="1.4"}%
%META:TOPICPARENT{name="Integration.DocumentationTable050"}%
---+!!<nop>Generic Information Providers (GIP)
%TOC%
%STARTINCLUDE%
%EDITTHIS%

---++Introduction
The Open Science Grid (OSG) Generic Information Provider (OSG-GIP) has been developed to enable LCG-OSG interoperability, OSG resource selection service, [[GridCat][Integration.GridCat]], etc. The GIP is a grid information service that aggregates static and dynamic resource information for use with LDAP-based information systems. The GIP produces information based on the GLUE Schema.  For more information about OSG-GIP visit the [[http://grow.its.uiowa.edu/research/gip/index.shtml][OSG-GIP webpage]].

---++ Installation
The Generic Information Provider is installed with the standard OSG installation.  To activate it, you must complete the configuration section of this document.


---++ Configuration
---+++ Configuration
To configure GIP run the configure_gip script with the =--batch= option which specifies the local batch system at your site. (i.e. Condor, PBS, LSF, etc)

The =--srm= is an optional parameter which needs to be specified only if you have a srm accessible storage element. 
   $ %I% %RED% *NOTE* %ENDCOLOR%: If you intend to install the Generic Information Provider (GIP), you should understand that the configuration script uses the <i>$VDT_LOCATION/monitoring/osg-attributes.conf</i> and the <i>$VDT_LOCATION/vdt-app-data/MonaLisa/monalisa.properties</i> file.   Variables in both these files are populated with default values and you may only be prompted where a default is missing.  The <i>$VDT_LOCATION/monitoring/configure-osg.sh</i> and <i>$VDT_LOCATION/vdt/setup/configure_monalisa</i> scripts populate these configuration files by prompting you for answers.   For <nop>Integration.MonALISA, you can perform the configuration and still not activate the process. 
%NOTE% If you intend to install the Generic Information Provider (GIP), you should understand that the configuration script uses the =$VDT_LOCATION/monitoring/osg-attributes.conf= and  =$VDT_LOCATION/vdt-app-data/MonaLisa/monalisa.properties= files.   Variables in both these files are populated with default values and you may only be prompted where a default is missing.  The <i>$VDT_LOCATION/monitoring/configure-osg.sh</i> and <i>$VDT_LOCATION/vdt/setup/configure_monalisa</i> scripts populate these configuration files by prompting you for answers.   For <nop>Integration.MonALISA, you can perform the configuration and still not activate the process. 
<b>NOTE:</b> Executing configure_gip creates six configuration files located at $VDT_LOCATION/lcg/share/doc/osg-info-gip-config/ and corresponding ldif files located at $VDT_LOCATION/lcg/var/gip/ldif/.
%NOTE% Executing configure_gip creates six configuration files located at =$VDT_LOCATION/lcg/share/doc/osg-info-gip-config/= and corresponding ldif files located at =$VDT_LOCATION/lcg/var/gip/ldif/=.
---+++ Usage 
<pre>
<pre class="screen">
&gt; <b>$VDT_LOCATION/vdt/setup/configure_gip --batch &lt;condor|pbs|lsf|sge&gt; [--srm]</b> 
</pre>

Example 1:
<pre>
<pre class="screen">
</pre>
&gt; <b>$VDT_LOCATION/vdt/setup/configure_gip --batch &lt;condor|pbs|lsf|sge&gt; </b> 
<pre>

We have set up the Generic Information Providers (GIP). If you were running
the GRIS (MDS), you must stop and restart it for these changes to take
affect. You can do this with the following commands:
 
/opt/osg/post-install/gris stop
/opt/osg/post-install/gris start
 
Note that this information is also in /opt/osg/post-install/README
</pre>

Example 2: 
<pre>
&gt; <b>$VDT_LOCATION/vdt/setup/configure_gip --batch &lt;condor|pbs|lsf|sge&gt --srm; </b> 
</pre>
<pre>
Do you also wish to publish your gsiftp information(Y/n) [n]y
Do you also wish to publish your gsiftp information(Y/n) [n] <b>y</b>
 
IOWA-SRM
<b>IOWA-SRM</b>
 
rsgrid3.its.uiowa.edu
<b>rsgrid3.its.uiowa.edu</b>
 
What is the Full path of the root directory for this storage area ?
(This will be your base directory, e.g if your accessible path is your cms accessible area is "/pnfs/xxxx.edu/data1/cms")
/pnfs/example.edu
<b>/pnfs/example.edu</b>
 
What is the local directory that is the root of this vo cdf ?
( This is the relative path e.g. e.g if your accessible path is your cms accessible area is "/pnfs/xxxx.edu/data1/cms")
(Just hit Enter if this VO doesnot have an srmcp-able directory)
data/cdf
<b>data/cdf</b>

...

We noticed that your Default SE (rtgrid1), is different than your CE host
(rsgrid3.its.uiowa.edu)
Please enter SE where gsiftp will is running: [rtgrid1]

...
</pre>

---++ Post Install
<pre>
<pre class="screen">
</pre>

<pre>
&gt; <b>/etc/init.d/gris stop</b>
&gt; <b> ps -aux | grep slapd </b>
</pre>

Make sure that the following processes have stopped 
   * $VDT_LOCATION/globus/sbin/grid-info-soft-register
   * $VDT_LOCATION/globus/libexec/slapd
<pre>
<pre class="screen">
&gt; <b>/etc/init.d/gris start</b>
</pre>
---++ Testing
---+++ Testing
---+++ Anonymous Bind Method (default)
---++++ Anonymous Bind Method (default)
<pre>
<pre class="screen">
&gt; <b>ldapsearch -h your.fully.qualified.hostname -p 2135 -x -b mds-vo-name=local,o=grid</b>
</pre>
---+++ Authenticated Bind Method
---++++ Authenticated Bind Method
<pre>
<pre class="screen">
&gt; <b>grid-info-search -h your.fully.qualified.hostname</b>
</pre>
---+++ Meaning of Testing
---++++ Meaning of Testing
In both cases (Authenticated and Anonymous) you should see LDAP information in LDIF format.  In most cases several screens of LDAP information will be output to the screen.

To validate a GIP installation refer to the [[http://grow.its.uiowa.edu/osg-gip/][Validation Page]].  This page is updated once an hour so there may be a delay in validating your GIP installation.  After each execution the "Last run" time on the page is also updated.  This is a handy reference to see if your current installation was validated.  
To validate a GIP installation refer to the [[http://grow.its.uiowa.edu/dokuwiki/doku.php/projects/gipvalidate/index][Validation Page]].  This page is updated once an hour so there may be a delay in validating your GIP installation.  After each execution the "Last run" time on the page is also updated.  This is a handy reference to see if your current installation was validated.  
   $ %I% %RED% *NOTE* %ENDCOLOR%: This assumes your site has been registered and is also viewable on [[GridCat][Integration.GridCat]].
%NOTE% This assumes your site has been registered and is also viewable on [[GridCat][Integration.GridCat]].

---++ Troubleshooting
   * Error comparing subject names.: Desired subject and actual subject of certificate do not match. %BR%
     Desired subject: =/CN=ldap/cmssrv09.fnal.gov=  %BR%
     Actual subject: =/DC=org/DC=doegrids/OU=Services/CN=cmssrv09.fnal.gov=  %BR%
</OL>
    *Cause:* You are probably using your host certificate for your LDAP certificate.  A common shortcut.

*In Progress*


---++Miscellaneous Info
   * [[http://infnforge.cnaf.infn.it/scm/controlleroo.php?group_id=9&dir_name=/v_1_2/mapping/ldap/schema&hide_attic=0][GLUE 1.2 LDAP schema]]                                                                                                                  
   * [[http://infnforge.cnaf.infn.it/projects/glueinfomodel/][Documents about GLUE]]
   * Links from Laurence Field:
      * [[http://lfield.home.cern.ch/lfield/cgi-bin/wiki.cgi?area=bdii&page=documentation][BDII]] 
      * [[http://lfield.home.cern.ch/lfield/cgi-bin/wiki.cgi?area=gip&page=documentation][GIP]] 
      * [[http://lfield.home.cern.ch/lfield/cgi-bin/wiki.cgi?area=glue&page=information][GLUE]] 
   * [[http://griddev.uchicago.edu/download/grid3/doc.pkg/GIIS-configuration/][Grid3 era]]


---++Useful LDAP Tool

If you run an un-authenticated GRIS / GIP and want to check your results a helpful tool is the [[http://www-unix.mcs.anl.gov/~gawor/ldap/][LDAP browser]].  
   1. Download the zip/tar file and unpack it.  
   1. Start it by running the lbe.sh script. A graphical user interface will appear.  
   1. Create a new connection and enter the following properties for the new connection:
<verbatim>
    Host: your.fully.qualified.hostname
    Base DN: mds-vo-name=local,o=grid</verbatim>
</verbatim>

If you would simply like to see what the GIP looks like when configured, feel free to use rsgrid3.its.uiowa.edu as a hostname.


---++Explanation of BDii 
BDii is the Berkeley Database Information Index. It consists of two or more standard LDAP databases that are populated by an update process. The OSG-ITB BDii service is collecting GIP information from OSG ITB hosts which are listed in the OSG [[GridCat050][GridCat]] database which have installed OSG 0.1.6 (early version are not compatible).

The connect to the BDii service standard LDAP querying command can be used.
<verbatim>
ldapsearch -LLL -x -h data.grid.iu.edu -p 2170 -b "o=grid"
</verbatim>
</pre>

The BDii server name is "data.grid.iu.edu" the BDii port to query is 2170.

---++Explanation of GIP / Glue Attributes

What follows is a large amount of [[http://www.cnaf.infn.it/~sergio/datatag/glue/index.htm][Glue attributes]] which are added by the GIP with some notes on what the attributes mean.  
   $ %I% %RED% *NOTE* %ENDCOLOR%: Not all the values here have been properly configured yet, they are just provided as an example.
%NOTE% Not all the values here have been properly configured yet, they are just provided as an example.

---+++<nop>GlueSite

*OSG unique site name* <br>
=GlueSiteName: CIT_CMS_OSG=

*Human readable description of the site* <br>
=GlueSiteDescription: Caltech CMS OSG Site=

*Site email contacts*
<verbatim>
GlueSiteUserSupportContact: mailto: my@email.com
GlueSiteSysAdminContact: mailto: my@email.com
GlueSiteSecurityContact: mailto: my@email.com

*Geographic location of the site* <br>
<verbatim>
GlueSiteLocation: Pasadena, US 
GlueSiteLatitude: 34
GlueSiteLongitude: 118

*Web site describing the site, if any*
<verbatim>
GlueSiteWeb: http://www.opensciencegrid.org
</verbatim>

---+++<nop>GlueCEUniqueID

<nop>GlueCEUniqueID defines a gatekeeper combined with a jobmanager and queue.  The format for the <nop>GlueCEUniqueID is hostname:port/jobmanager-batch-queue .

*Please note that 'jobmanager-condor-atlas' does not exist as a submittable jobmanager.  'jobmanager-condor' is the actual jobmanager that exists while 'atlas' is the queue that the job should be submitted to*

*The idea is that this should express how many CPU's are available at this time to a VO*

<verbatim>
dn: GlueCEUniqueID=rsgrid3.its.uiowa.edu:2119/jobmanager-condor-atlas, mds-vo-name=local,o=grid
GlueCEHostingCluster: rsgrid3.its.uiowa.edu
GlueCEName: atlas
GlueCEUniqueID: rsgrid3.its.uiowa.edu:2119/jobmanager-condor-atlas
GlueCEInfoGatekeeperPort: 2119
GlueCEInfoHostName: rsgrid3.its.uiowa.edu
GlueCEInfoLRMSType: condor
GlueCEInfoLRMSVersion: 6.7.7

*How many CPU's exist for this queue, may be busy or available*
<verbatim>
GlueCEInfoTotalCPUs: 10
GlueCEInfoJobManager: condor
GlueCEInfoContactString: my-ce.my.domain:2119/jobmanager-condor-atlas

*How long a VO can expect to wait before being submitted to a machine*
<verbatim>
GlueCEStateEstimatedResponseTime: 0

*How many CPU's are available right now for this VO*
<verbatim>
GlueCEStateFreeCPUs: 10
</verbatim>

*<nop>RunningJobs + <nop>WaitingJobs*
<verbatim>
GlueCEStateTotalJobs: 0
</verbatim>

*How many jobs are waiting in the queue*
<verbatim>
GlueCEStateWaitingJobs: 0
GlueCEStateWorstResponseTime: 0
</verbatim>

*How many open CPU's are available for the queue*
<verbatim>
GlueCEStateFreeJobSlots: 0
</verbatim>

*How long a job may remain in the queue before being removed (CPU time)*
<verbatim>
GlueCEPolicyMaxCPUTime: 0
GlueCEPolicyMaxRunningJobs: 0
GlueCEPolicyMaxTotalJobs: 0
</verbatim>

*How long a job may remain in the queue before being removed (Wall time)*
<verbatim>
GlueCEPolicyMaxWallClockTime: 0
GlueCEPolicyPriority: 1
GlueCEPolicyAssignedJobSlots: 0
</verbatim>

*Which VO may run jobs on this queue*
<verbatim>
GlueCEAccessControlBaseRule: VO:atlas
GlueForeignKey: <nop>GlueClusterUniqueID=rsgrid3.its.uiowa.edu
GlueInformationServiceURL: ldap://rsgrid3.its.uiowa.edu:2135/mds-vo-name=local,o=grid
</verbatim>


---+++<nop>GlueSubClusterUniqueID

<nop>GlueSubClusterUniqueID provides information about what grid software version is installed on the cluster as well as general information about a cluster.  It also can hold VO published information about what software has been installed.  For example, !GlueHostApplicationSoftwareRunTimeEnvironment: CMKIN could also be added by a VO.

<verbatim>
dn: GlueSubClusterUniqueID=rsgrid3.its.uiowa.edu, GlueClusterUniqueID=rsgrid3.its.uiowa.edu, mds-vo-name=local,o=grid
GlueChunkKey: GlueClusterUniqueID=rsgrid3.its.uiowa.edu
</verbatim>

*<nop>GlueHostApplicationSoftwareRunTimeEnvironment lists all the software installed on the cluster*
<verbatim>
GlueHostApplicationSoftwareRunTimeEnvironment: LCG-2
GlueHostApplicationSoftwareRunTimeEnvironment: LCG-2_1_0
GlueHostApplicationSoftwareRunTimeEnvironment: LCG-2_1_1
GlueHostApplicationSoftwareRunTimeEnvironment: LCG-2_2_0
GlueHostApplicationSoftwareRunTimeEnvironment: LCG-2_3_0
GlueHostApplicationSoftwareRunTimeEnvironment: LCG-2_3_1
GlueHostApplicationSoftwareRunTimeEnvironment: LCG-2_4_0
GlueHostApplicationSoftwareRunTimeEnvironment: R-GMA
GlueHostArchitectureSMPSize: 2
</verbatim>

*The SI and SF benchmarks have been used to make sure that a job will finish in a cluster before being removed*
<verbatim>
GlueHostBenchmarkSF00: 0
GlueHostBenchmarkSI00: 381
GlueHostMainMemoryRAMSize: 513
GlueHostMainMemoryVirtualSize: 1025
</verbatim>

*Method of publishing information about whether or not the cluster nodes have inbound / outbound access*
<verbatim>
GlueHostNetworkAdapterInboundIP: FALSE
GlueHostNetworkAdapterOutboundIP: TRUE
GlueHostOperatingSystemName: Redhat
GlueHostOperatingSystemRelease: 7.3
GlueHostOperatingSystemVersion: 3
GlueHostProcessorClockSpeed: 1001
GlueHostProcessorModel: PIII
GlueHostProcessorVendor: intel
GlueSubClusterName: rsgrid3.its.uiowa.edu
GlueSubClusterUniqueID: rsgrid3.its.uiowa.edu
GlueSubClusterPhysicalCPUs: 0
GlueSubClusterLogicalCPUs: 0
GlueSubClusterTmpDir: /tmp
GlueSubClusterWNTmpDir: /tmp
GlueInformationServiceURL: ldap://rsgrid3.its.uiowa.edu:2135/mds-vo-name=local,o=grid
</verbatim>


---+++<nop>GlueCESEBindGroupCEUniqueID
Defined what storage element is considered close to this Computing Element.  This is done on a per VO basis, for example, these attributes say that the default place for atlas data to go would be to rsgrid3.its.uiowa.edu and into the directory /storage/atlas (another convention on the LCG is that the mount point has a folder in it for each VO that is accepted)
Defined what storage element is considered close to this Computing Element.  This is done on a per VO basis, for example, these attributes say that the default place for atlas data to go would be to rsgrid3.its.uiowa.edu and into the directory =/storage/atlas= (another convention on the LCG is that the mount point has a folder in it for each VO that is accepted)

<verbatim>
dn: GlueCESEBindGroupCEUniqueID=rsgrid3.its.uiowa.edu:2119/jobmanager-condor-atlas, mds-vo-name=local,o=grid, GlueCESEBindGroupCEUniqueID: rsgrid3.its.uiowa.edu:2119/jobmanager-condor-atlas
GlueCESEBindGroupSEUniqueID: rsgrid3.its.uiowa.edu

dn: GlueCESEBindSEUniqueID=rsgrid3.its.uiowa.edu, GlueCESEBindGroupCEUniqueID=rsgrid3.its.uiowa.edu:2119/jobmanager-condor-atlas, mds-vo-name=local,o=grid
GlueCESEBindSEUniqueID: rsgrid3.its.uiowa.edu
GlueCESEBindCEAccesspoint: /storage
GlueCESEBindCEUniqueID: rsgrid3.its.uiowa.edu:2119/jobmanager-condor-atlas
GlueCESEBindMountInfo: none
GlueCESEBindWeight: 0
</verbatim>

---+++<nop>GlueSEUniqueID

<nop>GlueSEUniqueID defined an access point into a Storage Element.

<verbatim>
dn: GlueSEUniqueID=rsgrid3.its.uiowa.edu,mds-vo-name=local,o=grid
GlueSEUniqueID: rsgrid3.its.uiowa.edu
GlueSEName: my-site-name:disk
GlueSEPort: 8443
GlueSESizeTotal: 0
GlueSESizeFree: 0
GlueSEArchitecture: disk
GlueInformationServiceURL: ldap://rsgrid3.its.uiowa.edu:2135/mds-vo-name=local,o=grid
</verbatim>

---+++<nop>GlueSEAccessProtocolLocalID

<nop>GlueSEAccessProtocolLocalID defined the protocols that may be used to access this Storage Element.  In this example, gsiftp is the protocol that is defined.

<verbatim>
dn: GlueSEAccessProtocolLocalID=gsiftp, GlueSEUniqueID=rsgrid3.its.uiowa.edu,Mds-Vo-name=local,o=grid
GlueSEAccessProtocolLocalID: gsiftp
GlueSEAccessProtocolType: gsiftp
GlueSEAccessProtocolVersion: 1.0.0
GlueSEAccessProtocolPort: 2811
GlueSEAccessProtocolSupportedSecurity: GSI
GlueChunkKey: <nop>GlueSEUniqueID=rsgrid3.its.uiowa.edu
</verbatim>

%INCLUDE{ "Integration.WhuReferences" }%

<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
-- Main.AnandPadmanabhan - 12 Feb 2007 <br>
-- Main.RobGardner - 24 May 2005<br>
-- Main.RansomBriggs - 10 Jun 2005<br>
-- Main.RansomBriggs - 17 Jun 2005<br>
-- Main.JohnWeigand- 12 Jan 2006<br>
-- Main.EricShook - 09 Mar 2006<br>
-- Main.AnandPadmanabhan - 15 Mar 2006 <br>
-- Main.RobQ - 01 May 2006   %BR% 

%META:TOPICMOVED{by="ForrestChristian" date="1166047849" from="Integration.GenericInformationProviders050" to="Integration/ITB_0_5.GenericInformationProviders"}%
