%META:TOPICINFO{author="AnneHeavey" date="1192738131" format="1.1" version="1.6"}%
%META:TOPICPARENT{name="VomrsInstallGuide"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

%STARTINCLUDE%
%BR%
---+ _%INCLUDEHEADING%  %SPACEOUT{ "%TOPIC%" }%_
%EDITTHIS%
%BR%

If all the required certificates were in place prior to the pacman installation, a default VO called <i>VDT</i> has been created in VOMRS and VOMS. The =init.d= services have been started.  To start those services and verify the success of your installation:
<pre class="screen">
> cd $VDT_LOCATION
> source setup.sh
> vdt-control --on
</pre>

The output of =vdt-control --list= should be:
<pre class="screen">
Service            | Type   | Desired State
-------------------+--------+--------------
fetch-crl          | cron   | enable
mysql              | init   | enable
vdt-rotate-logs    | cron   | enable
apache             | init   | enable
tomcat-55          | init   | enable
tomcat-5           | init   | enable
voms               | init   | enable
vomrs              | init   | enable
</pre>

All the daemon services should be up and running. This section will take you through the steps necessary to verify that VOMRS is functional. For VOMS instalaltion verification please check VOMS Installation Guide. 

For  all the verifications, you will need to source the VDT setup.(c)sh script:

<pre class="screen">
&gt; <b>cd <em>VDT_LOCATION</em></b>
&gt; <b>source setup.sh</b>
</pre>

---++ Verifying  the apache/tomcat daemon
To verify that Apache is running:
<pre class="screen">
&gt; <b>ps -efwww |  grep  apache  |grep httpd</b>
  <em>(there will be a number of these)</em>
root       ... /usr/local/osg-vomrs/apache/bin/httpd 
                    -d /usr/local/osg-voms/apache -k start -f /usr/local/osg-voms/apache/conf/httpd.conf
daemon   ... /usr/local/osg-vomrs/apache/bin/httpd 
                    -d /usr/local/osg-voms/apache -k start -f /usr/local/osg-vomrs/apache/conf/httpd.conf
      
</pre>

%NOTE% Verify that it is the only one running with <i>init (pid=1)</i> as it's parent and the path contains your VDT_LOCATION.  

VOMRS is running under tomcat 5.5 and VOMS is running under Tomcat-5. To verify Tomcat-55  and Tomcat-5   are running:
<pre class="screen">
&gt; <b>ps -efwww |  grep tomcat</b>
daemon   ... /usr/local/osg-vomrs/jdk1.5/bin/java -server -Xmx256M -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager 
                -Djava.util.logging.config.file=/usr/local/osg-vomrs/tomcat/v55/conf/logging.properties 
                -Djava.endorsed.dirs=/usr/local/osg-vomrs/tomcat/v55/common/endorsed 
                -classpath :/usr/local/osg-vomrs/tomcat/v55/bin/bootstrap.jar:/usr/local/osg-vomrs/tomcat/v55/bin/commons-logging-api.jar 
                -Dcatalina.base=/usr/local/osg-vomrs/tomcat/v55 
                -Dcatalina.home=/usr/local/osg-vomrs/tomcat/v55 
                -Djava.io.tmpdir=/usr/local/osg-vomrs/tomcat/v55/temp org.apache.catalina.startup.Bootstrap start

daemon   ... /usr/local/osg-vomrs/jdk1.4/bin/java            
                  -Djava.endorsed.dirs=/usr/local/osg-vomrs/tomcat/v5/common/endorsed 
                  -classpath /usr/local/osg-vomrs/jdk1.4/lib/tools.jar:/usr/local/osg-vomrs/tomcat/v5/bin/bootstrap.jar:/usr/local/osg-voms/tomcat/v5/bin/commons-logging-api.jar      
                  -Dcatalina.base=/usr/local/osg-vomrs/tomcat/v5 -Dcatalina.home=/usr/local/osg-vomrs/tomcat/v5 
                  -Djava.io.tmpdir=/usr/local/osg-vomrs/tomcat/v5/temp org.apache.catalina.startup.Bootstrap start
    :
    :
</pre>

%NOTE% Verify that it is the only one running with <tt>init (pid=1)</tt> as it's parent and the path contains your VDT_LOCATION.  


---++ Verifying  the mysql daemon
<nop>MySql  is used to provide persistent storage of the VOMS VO membership data. To verify it is running:

<pre class="screen">
&gt; <b>ps -efwww |  grep  mysql</b>
root    ... /bin/sh /usr/local/osg-vomrs/mysql/real-bin/mysqld_safe 
                   --defaults-file=/usr/local/osg-vomrs/mysql/var/my.cnf 
                   --datadir=/usr/local/osg-vomrs/vdt-app-data/mysql/var
                   --pid-file=/usr/local/osg-vomrs/vdt-app-data/mysql/var/cms-xen3.fnal.gov.pid

</pre>

%NOTE% Verify that it is the only one running with <i>init (pid=1)</i> as it's parent and the path contains your VDT_LOCATION. 

---++ Verifying the VOMRS WEB UI

If all the certificates were in place prior to the pacman installation, a default VO called <i>VDT</i> was configured.
To verify it is accessible:

   1. Point a certificate-enabled browser window to https://<i>your.host.name</i>:8443/vomrs/VDT/vomrs
      * You should be prompted for your certificates passphrase %RED%I was not%ENDCOLOR%
      * You should get a <i>Welcome to the VDT VO Registration Service!</i> page
   1. In the left hand menu under <i>VDT Registration Home</i>, select *Registration (Phase I) *. The registration page should say <i>There are no Representative with Approved Status. Can not register! Please try again later!</i>. It is correct because there are no members in this vo who could approve your registration.
   1. Go <i>Back</i> twice in your browser to return to the main page.
   1. Click *Required Personal Information*. It will show you the list of default personal information that is collected by this VO. You should be able to modify it later when you become a VO Administrator.
  
At this point, you know your VOMRS WEB UI is functional.

---++ Verifying the VOMRS server daemon
The VOMRS server's performs multiple tasks that include email notification and synchronization with VOMS. 
To verify the VOMRS server is running:
<pre class="screen">
&gt; <b>service vomrs status</b>
Status VORegistrationServer(vdt): Running...pid=31126      [  OK  ]
</pre>

or 
<pre class="screen">
&gt; <b>ps -efwww| grep vomrs</b>
root  ... java -Dfnal.vox.vomrs.server.mail=send fnal/vox/vomrs/server/VORegistrationServer /usr/local//vomrs/var/etc/vomrs_vdt/vomrs.xml
</pre>
%RED%I got a very long output %ENDCOLOR%

%NOTE% There are individual <i>VOMRS servers</i> for each VO.
---++ Securing your server
All access to VOMRS is through apache and tomcat, even the command line <i>voms-admin</i> command.  To secure your server and require only authenticated access, run the following command.

<pre class="screen">
&gt; <b>source $VDT_LOCATION/setup.sh</b>
&gt; <b>$VDT_LOCATION/vdt/setup/configure_apache --secure</b>
&gt; <b>/etc/init.d/apache restart</b>
restart
</pre>
%RED%Now, how do I check that it's secure?  %BR%
Also, where do I find instructions on configuring my vomrs instance? %BR%
Do we refer people to the manual?%BR%
I see instructions for configuring voms -- VomsConfiguration -- do I still need to do that?%BR%
What do I do with it once it's configured to let OSG know it's there and hook it into the infrastructure?  AH 9/13/07%ENDCOLOR%

%STOPINCLUDE%
%BR%
%COMPLETE1% %BR%
%RESPONSIBLE% Main.RobGardner - 18 Oct 2007 %BR%
%REVIEW%