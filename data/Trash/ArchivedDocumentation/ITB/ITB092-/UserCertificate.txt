%META:TOPICINFO{author="AnneHeavey" date="1194975683" format="1.1" reprev="1.14" version="1.14"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

%STARTINCLUDE%
%BR%
---+ _%INCLUDEHEADING%  %SPACEOUT{ "%TOPIC%" }%_
%EDITTHIS%
%BR%

There are many different Certificate Authorities that OSG sites can choose to recognize.  We recommend DOEGrids, as most OSG users are eligible for this.  This is the only CA for which we document the process.  For information on others, contact your [[http://www.grid.iu.edu/osg-includes/sc.php][VO Support Center]]. 

Certificates and their uses, particularly user certificates (also called personal certificates) are described in [[Documentation/CertificateWhatIs][CertificateWhatIs]].

%RED%AH proposes moving "Uses" section to [[Documentation/CertificateWhatIs][CertificateWhatIs]]. Info copied there and merged (please review); info just hidden here for now, not deleted.%ENDCOLOR%

<!--
---++ Uses of a personal certificate
An X509 credential consists of two parts, the public certificate and a private key. A piece of information cryptographically signed
with the private key can be verified with the public certificate (using its included public key).  By keeping the private key *private*,
communications to third parties can be trusted as having originated with the holder of the private key.  The public certificate
is cryptographically signed by the CA so that when the CA is *trusted*, the recipient is assured of the identity of the person
holding the private key.

There are three primary uses of certificates around the OSG:
   1. for initiating grid computing transactions (the main purpose)
   2. for authenticating at web sites using your browser
   3. for digitally signing email messages
For the first use, the credential is typically stored in your ~/.globus directory, the public certificate in a file called usercert.pem
and the private key in a file called userkey.pem.
To get one of these credentials it is most convenient to use the comandline tools in the cert-scripts package as described below.

For the other uses (web browser & email) it can be more convenient to get another certificate using
the web interface to the DOEGrids CA.  The public/private key pair is generated in your web browser
and the signed certificate, when issued, is downloaded into your (same) web browser, matched with
the private key and then can be used to authenticate with SSL web sites.  Depending upon your
email client tool you may or may not have to export your credential into a PKCS12 file from your
web browser and import it into your email client.  There are also tools to convert PKCS12 format
credentials to/from PEM format files for globus if you want to use exactly the same credential
for all uses, if you prefer to _not_ have two certificates.
-->

<!-- cOr follow the instructions in [[GetHostCertificates#Get_a_Personal_Grid_Certificate][Configuring Public Key Infrastructure]]. -->
---++ Get a certificate using the cert-script package

If you don't need a certificate for your browser, you can request one directly from the host where you'll be doing OSG work. Log in to the user account where you will normally initiate grid actions.  The commands below will place your certificate in the globus default location ( =~/.globus= ).  You should specify _OSG_ for the RA affiliation and also for the VO unless you already know the more appropriate values to use.

%RED%VDT_LOCATION will contain different things depending on what you install (client, CE, etc.)  Does the following need any qualification?%ENDCOLOR%
<pre class="screen">
> <userinput>source $VDT_LOCATION/setup.sh</userinput>
> <userinput>cert-request -ou p</userinput>
</pre>
The command will prompt you for necessary information.  The complete description of this command
can be seen in the [[Security/CSReadMe#cert_request][certificate README file]].

Look for email notification that the certificate has been issued. Once you receive it, you can retrieve it with the following command, using the serial number given in the email notice.

<pre class="screen">
> <userinput>source $VDT_LOCATION/setup.sh</userinput>
> <userinput>cert-retrieve -certnum <i>0xYYYY</i></userinput>
</pre>
If you got inventive with the available options of the cert-request command then you may
need to use some additional parameters.  See the [[Security/CSReadMe#cert_retrieve][full man page of the cert-retrieve]] command.

One particularly convenient option is to create the PKCS12 format file of the full credential that
can be imported directly into your web browser and email programs.

---++ Get a certificate in your browser, export it and convert it

See the [[http://www.opensciencegrid.org/ra][OSG Registration Authority]] for instructions on obtaining a certificate with your browser.  %RED%Last I heard, these were not up to date-- check with Rob Q.. See [[Documentation/CertificateGet]].  %ENDCOLOR% 
Follow the instructions for your browser to export it into a PKCS12 format file (.p12). For details of this just Google "export certificate my_web_browser"
and you will get many examples of how to export a certificate.  Naturally, substitute the name of your actual web browser for _my_web_browser_.

Once you have the PKCS12 format file (.p12), see [[Security.OsgRaOperations#Make_pem_files_for_globus_after][these instructions]] for converting it to .pem format.


---++ Update the VOMS information (e.g., after renewing): 
You will need to check with your VO support for what you may need to do to
update your certificate information in your VO's VOMS server.

The example command that shows the typically useful information about a certificate is:

<pre class="screen">
> <userinput>openssl x509 -in ~/.globus/usercert.pem -subject -serial -dates -issuser -noout</userinput>
</pre>

---++ Test your credentials:

In the simplest case:
<pre class="screen">
> <userinput>source $VDT_LOCATION/setup.sh</userinput>
> <userinput>grid-proxy-init</userinput>
> <userinput>grid-proxy-info</userinput>
</pre>

To test with voms-proxy-init you will need instructions from your VO about the correct environment setup.


---++ Troubleshooting

If this doesn't work, check that the "gatekeeper" &mdash; the Grid component that accepts and executes remote jobs &mdash; can correctly authenticate you:

%NOTE% This example was run against the Fermilab site. Customize it for your VO and site.

<pre class="screen">
> <userinput>globusrun -a -r <replaceable>fermigrid2.fnal.gov</replaceable>/jobmanager-fork</userinput>
GRAM Authentication test successful
> 
</pre>


%STOPINCLUDE%
%BR%
%COMPLETE3% %BR%
%RESPONSIBLE% Main.DougOlson - 26 Oct 2007 %BR%
%REVIEW%  Main.AnneHeavey - 13 Nov 2007 %BR%
%REVCOM%Question about VDT_LOCATION and get cert instructions (in red).
