%META:TOPICINFO{author="TanyaLevshina" date="1258996893" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! *<nop>%SPACEOUT{ "Gridftp-Xrootd Installation" }%*
%TOC%

---++ Introduction
You may want to install !GridFtp-Xrootd (generic !GridFtp with !Xrootd pre-load libraries)


---++ Pacman Installation
You will need to install the Pacman package v3.28 or higher to install Bestman-gateway from OSG v1.2. This work is done by root account. You will need to perform the following steps:
   * create a directory for Pacman . OSG recommends putting pacman in a separate directory from the software that you fetch from OSG.  
   * fetch the Pacman software 
   * unpack Pacman software 
   * setup pacman home
   
<pre class="screen">
 mkdir /opt/pacman
 cd /opt/pacman
 wget http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-3.28.tar.gz
 tar --no-same-owner -xzvf pacman-3.28.tar.gz
 cd pacman-3.28
 . setup.sh
</pre>


---++ Installing !GridFtp-Xrootd

The installation described here is done as root. Select the node where you want to install !GridFtp-Xrootd  and execute the following steps:
   * setup pacman 
   * create directory for !GridFtp-Xrootd software
   * download software from OSG cache
   * setup trusted certificates
   * enable log rotation, CRL and trusted certificates update  

<pre class="screen">
mkdir /opt/osg-v1.2
cd /opt/osg-v1.2
. ../pacman/pacman-3.28/setup.sh
pacman -get http://software.grid.iu.edu/osg-1.2:Xrootd-GridFTP
setup.sh
$VDT_LOCATION/vdt/bin/vdt-ca-manage setupca --location local --url osg
vdt-control --enable fetch-crl vdt-rotate-logs vdt-update-certs
</pre>

---++ Configure !GridFtp-Xrootd
To configure !GridFtp-Xrootd you will have to do the following steps:
   * change directory to !GridFtp-Xrootd  software installation
   * setup vdt home area
   * run configuration script (you will need to specify the !GridFtp-Xrootd virtual mount point and storage area on redirector node) 
   * set !GridFtp port range

<pre class="screen">
cd /opt/osg-v1.2
. setup.sh
$VDT_LOCATION/vdt/setup/configure_gridftp --use-xrootd --xrootd-host &lt;redirector_fqn&gt; --xrootd-mount-point /local/xrootd/data --xrootd-storage-path /local/xrootd/data 
</pre>

If you are dealing with firewall the gridftp port range should be properly set. In order to do so you will have to modify vdt-local-setup.sh.

<pre class="screen">
#edit $VDT_LOCATION/vdt/etc/vdt-local-setup.sh 
GLOBUS_TCP_SOURCE_RANGE=<low_port,high_port>
GLOBUS_TCP_PORT_RANGE=<low_port,high_port>
export GLOBUS_TCP_SOURCE_RANGE
export GLOBUS_TCP_PORT_RANGE
</pre>

Where low_port,high_port - controls all outbound globus connections for !GgridFtp (e.g GLOBUS_TCP_SOURCE_RANGE=40000,49150) 

Enable !GridFtp-Xrootd
<pre class="screen">
vdt-control --enable gsiftp
</pre>



---++ Start/Stop !GridFtp-Xrootd

You will need to login to node where  GridFtp-Xrootd is installed  to start/stop xrtood:

To start:

<pre class="screen">
cd /opt/osg-v1.2
. setup.sh
vdt-control -on
</pre>

To stop:

<pre class="screen">
cd /opt/osg-v1.2
. setup.sh
vdt-control -on
</pre>

---++ Testing !GridFtp  of the cluster

Login on the node where you have installed have your certificate installed and access to http://software.grid.iu.edu/osg-1.2:client.

You will need to get your voms-proxy certificate:

voms-proxy-init –voms <voname>:/<voname> 

Then test GridFtp:
<pre class="screen">
cd  /opt/osg-v1,2 
. setup.sh 
echo “This is a test” >/tmp/test 
globus-url-copy -dbg file:///tmp/test gsiftp://<GridFtp_host>/local/xrootd/data/test
</pre>


%BR%
%COMPLETE1% %BR%
%RESPONSIBLE% Main.TanyaLevshina - 30 Oct 2009 %BR%
%REVIEW%

---++ Comments
%COMMENT{type="tableappend"}%
