%META:TOPICINFO{author="ArvindGopu" date="1213035162" format="1.1" version="1.11"}%
%META:TOPICPARENT{name="RSV"}%
%TOC%
%LINKCSS%

---+Install !RSV version 2 separately on an existing OSG CE 0.8.0 resource or a separate monitoring host.
%STARTINCLUDE%
%BR%

---++ Background

<p> This document is for OSG admins who wish to install the newer version 2 of !RSV on a separate monitoring host or an existing OSG CE 0.8.0 node. In the latter case, the new version will be installed in a <strong> separate location compared to the CE</strong>. 

<p><u>IMPORTANT: If you're installing on an exising OSG CE, then please follow the instructions below carefully -- if you don't, especially if you don't install the new !RSV package in a new directory as shown, then there's a chance you might mess up your CE install! Please contact rsv-dev if you have any questions <strong>before</strong> you begin. Thank you!</u>


---++ Pre-setup steps

   * If using !OSG CE 0.8 -- Turn off old !RSV bits, and disable those services

<pre class="screen">  export EXISTING_CE_LOCATION=/path/to/0.8.0/CE
  . $EXISTING_CE_LOCATION/setup.sh
  vdt-control --off osg-rsv
  vdt-control --off condor-devel
  vdt-register-service --disable --name osg-rsv
  vdt-register-service --disable --name condor-devel
  ## Watch for errors in $EXISTING_CE_LOCATION/vdt-install.log</pre>
</pre>


---++ In separate (fresh) terminal, get new !RSV package in new directory

<p> In a <u>separate fresh terminal</u>, as root, create a directory for !RSV version 2 package, and then get it using pacman.

<pre class="screen">  . /path/to/pacman-3.20-or-greater/setup.sh
  export NEW_RSV_LOCATION=/opt/new/rsv-2.0
  mkdir $NEW_RSV_LOCATION 
  cd $NEW_RSV_LOCATION 
  pacman -get http://vdt.cs.wisc.edu/vdt_1101_cache:OSG-RSV</pre>

<p> Answer the !VDT questions: 
   * if you are installing !RSV v2 on _an existing OSG CE_, we recommend you do _not_ install CA certs and CRLs again, and that you do not enable log_rotate (!RSV has its own logrotate). Just ensure you enable osg-rsv and condor-cron. -- this is the case in the example shown below.
   * OR, if you are installing this version of !RSV _on a separate monitoring host_ that is not an existing OSG CE then please answer 'y' to CAcerts/Crls/enable_log_rotate questions.

<pre class="programlisting">     Do you want to add [http://vdt.cs.wisc.edu/vdt_1100_cache] to [trusted.caches]? (y or n): y
     Do you agree to the licenses? [y/n] y
     Would you like to setup daily rotation of VDT log files?
     n

     Do you want to automatically update your CA Certificates? [y/n] n

     Where would you like to install CA files?
     n

     Would you like to enable OSG-RSV to run automatically?
     y

     Do you want to update the CA certification revocation lists (CRLs) automatically? [y/n] n

     Would you like to enable the Condor Cron batch system to run automatically? 
     y</pre>
 

<p> Once the pacman download finishes, execute the setup.sh in the new !RSV directory; also symlink CAcert directory from your existing setup.
   <pre class="screen">  . $NEW_RSV_LOCATION/setup.sh </pre>

If you are installing !RSV v2 on _an existing OSG CE_, then sym-link CAcerts/CRLs to your CE location
<pre class="screen">  export EXISTING_CE_LOCATION=/path/to/0.8.0/CE
  ln -s  $EXISTING_CE_LOCATION/globus/share/certificates $NEW_RSV_LOCATION/globus/share/certificates</pre>




---++ !RSV configuration steps

%INCLUDE{"MonitoringInformation/ShouldIUserServiceCert"}%

%INCLUDE{"MonitoringInformation/PreConfigCheckListRsv"}%


---+++ !RSV running on OSG CE <strong>not using GUMS</strong>; <strong>using !RSV service cert</strong> to run probes; using existing Apache server to serve local results webpage:

  <pre class="screen"> ## In example shown below, existing apache's index.html page 
 ## is the file in which  a link to the !RSV results page will be added.

 $VDT_LOCATION/osg-rsv/setup/configure_osg_rsv --user <em><strong>rsvuser</strong></em> --init --server y \
      --ce-probes --ce-uri "<em><strong>&#60;CE_FQDN&#62;</strong></em>" \ 
      --gridftp-probes [--gridftp-uri "<em><strong>&#60;GridFTP_FQDN&#62;</strong></em>" --gridftp-dir <em><strong>/path/to/write/test/file</strong></em>] \ 
      --gratia --grid-type "<em><strong>OSG-ITB or OSG</strong></em>" \
      --consumers --verbose --setup-for-apache  \
      [--apache-conf-file <em><strong>/path/to/CEorExisting/apache/conf/http.conf</strong></em>] \ 
      [--apache-index-file <em><strong>/path/to/CEorExisting/apache/htdocs/index.html</strong></em>] \
      --use-rsv-cert \
      [--rsv-cert-file <em>/path/to/cert/public/cert</em> --rsv-key-file <em>/path/to/cert/private/key</em>] </pre>

%INCLUDE{"MonitoringInformation/ConfigureRsvV2AdvSeSrmServcertNogums"}%
_Note_: If you would like to use an existing Apache server, then use the =--apache-conf-file= and =--apache-index-file= switches as shown in the previous configuration example above, and then restart your existing Apache using your usual start/stop mechanism.

%INCLUDE{"MonitoringInformation/ConfigureRsvV2AdvSeBestmanServcertNogums"}%
_Note_: If you would like to use an existing Apache server, then use the =--apache-conf-file= and =--apache-index-file= switches as shown in the previous configuration example above, and then restart your existing Apache using your usual start/stop mechanism.

      For more example configurations, [[https://twiki.grid.iu.edu/twiki/bin/view/MonitoringInformation/InstallAndConfigureRsvAdvanced#More_Example_Configurations][see here]]. 




---++ Start !RSV and related services
<p> First, start Condor-cron and !RSV services 

  <pre class="screen">  . $NEW_RSV_LOCATION/setup.sh
  vdt-control --on condor-cron osg-rsv

  ## If you are NOT using old CE or existing Apache server, then start Apache that RSV brought along; o/w skip this step
  # vdt-control --on apache</pre>
 
<p> If you want your CE's (or another existing) Apache server to serve your local status pages, then disable the new !RSV's Apache, and restart the existing Apache service (Note: This assumes you specified the <tt>--setup-for-apache</tt> switch above); Otherwise, skip this step. For example:
  <pre class="screen">  . $NEW_RSV_LOCATION/setup.sh
  vdt-control --disable apache

  . $EXISTING_CE_LOCATION/setup.sh
  ## Ensure apache is a registered and enabled service
  vdt-register-service --enable --name apache
  vdt-control --off apache
  vdt-control --on apache</pre>

<p> Finally, go back to using new RSV's commands once Apache has been (re)started.
  <pre class="screen">  . $NEW_RSV_LOCATION/setup.sh</pre>



<!-- <p>      More information on this  is [[http://rsv.grid.iu.edu/documentation/vdt-1.8.1a-package.html#start_rsv][available here]]. -->


%INCLUDE{"MonitoringInformation/ValidateRsvV2Configuration"}%



-- Main.ArvindGopu - 05 Jun 2008