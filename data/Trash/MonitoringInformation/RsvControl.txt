%META:TOPICINFO{author="ScotKronenfeld" date="1290188610" format="1.1" reprev="1.1" version="1.1"}%
---+!! Using rsv-control
=rsv-control= is a script introduced in !RSV 3.3.0 that provides an interface to many !RSV tasks.  =rsv-control= can view !RSV jobs, run metrics, enable or disable metrics and consumers, and allow advanced configuration.

%TOC{depth="3"}%

---++ Viewing !RSV jobs

rsv-control provides two different interfaces: viewing the _desired_ state and viewing the current _actual_ state or what metrics and consumers are running.

---+++ Desired state
To view the desired state, use the =--list= (=-l= for short) flag.  This will create one table for each host showing the metrics that are enabled to run against that host.    

<pre class="screen">
%UCL_PROMPT_SHORT% rsv-control --list

Metrics enabled for host: osgitb1.nhn.ou.edu              | Service
----------------------------------------------------------+--------------------
org.osg.batch.jobmanager-default-status                   | OSG-CE
org.osg.batch.jobmanagers-available                       | OSG-CE
org.osg.certificates.cacert-expiry                        | OSG-CE
org.osg.certificates.crl-expiry                           | OSG-CE
org.osg.general.osg-directories-CE-permissions            | OSG-CE
org.osg.general.osg-version                               | OSG-CE
org.osg.general.ping-host                                 | OSG-CE
org.osg.general.vdt-version                               | OSG-CE
org.osg.general.vo-supported                              | OSG-CE
org.osg.globus.gram-authentication                        | OSG-CE
org.osg.globus.gridftp-simple                             | OSG-GridFTP
org.osg.gratia.condor                                     | OSG-CE
org.osg.gratia.metric                                     | OSG-CE


Metrics enabled for host: osg-edu.cs.wisc.edu:10443       | Service
----------------------------------------------------------+--------------------
org.osg.srm.srmcp-readwrite                               | OSG-SRM
org.osg.srm.srmping                                       | OSG-SRM
</pre>

Other options:
   * To view all installed metrics use the =--all= (=-a=) flag along with =--list=.  This will print an extra table showing metrics that are disabled on all hosts.
   * If you are having problems with the output being truncated try the =--wide= (=-w=) flag.

---+++ Actual state

To view the current, running state of !RSV jobs, use the =--job-list= flag (=-j= for short).  This will show all metrics and consumers running in !RSV.

<pre class="screen">
%UCL_PROMPT_SHORT% rsv-control --job-list

Hostname: osg-edu.cs.wisc.edu
     ID OWNER      ST NEXT RUN TIME   METRIC
  154.0 rsvuser    I  11-19 12:15     org.osg.certificates.cacert-expiry
  155.0 rsvuser    R  11-19 11:23     org.osg.gratia.metric
  156.0 rsvuser    I  11-19 18:47     org.osg.general.vdt-version
  157.0 rsvuser    I  11-19 12:30     org.osg.certificates.crl-expiry
  158.0 rsvuser    I  11-19 11:31     org.osg.globus.gram-authentication
  159.0 rsvuser    I  11-19 11:41     org.osg.general.osg-version
  160.0 rsvuser    R  11-19 11:25     org.osg.batch.jobmanager-default-status
  161.0 rsvuser    I  11-20 04:59     org.osg.batch.jobmanagers-available
  162.0 rsvuser    I  11-19 11:37     org.osg.general.osg-directories-CE-permissions
  163.0 rsvuser    I  11-19 12:08     org.osg.globus.gridftp-simple
  164.0 rsvuser    I  11-19 12:09     org.osg.gratia.condor
  165.0 rsvuser    R  11-19 11:27     org.osg.general.ping-host
  166.0 rsvuser    I  11-19 18:47     org.osg.general.vo-supported

Hostname: osg-edu.cs.wisc.edu:10443
     ID OWNER      ST NEXT RUN TIME   METRIC
  113.0 rsvuser    I  11-19 11:33     org.osg.srm.srmping
  114.0 rsvuser    R  11-19 11:28     org.osg.srm.srmcp-readwrite

     ID OWNER      ST CONSUMER
  198.0 rsvuser    R  html-consumer
  199.0 rsvuser    R  gratia-consumer

</pre>

The ST field indicates the current job status:
   * R = the metric is currently running
   * I = the metric is idle and will be run at the next scheduled interval
   * Any other letter may indicate a problem
   * Consumers will always appear to be running even though they will only run once every five minutes.

---++ Running a metric

=rsv-control= can be used to run metrics one time against a host.  This can be useful for:
   * updating the status of a metric that had a problem instead of waiting until the next scheduled run time
   * testing a metric against a host before deciding whether to enable it

Note that *the record for each run will be published to all active consumers*.

---+++ Simplest test:

Use the =--run= (=-r=) flag.  You must also provide the =--host= (=-u=).  The syntax is:

=rsv-control --run --host _HOST_ _METRIC_ [_METRIC2_ ...]=

where METRIC is the full metric name (e.g. org.osg.general.osg-version).  You can get the metric names from the =--list= output.

For example:
<pre class="screen">
%UCL_PROMPT_SHORT% rsv-control --run --host osg-edu.cs.wisc.edu org.osg.general.osg-version

Running metric org.osg.general.osg-version:

metricName: org.osg.general.osg-version
metricType: status
timestamp: 2010-11-19 11:40:19 CST
metricStatus: OK
serviceType: OSG-CE
serviceURI: osg-edu.cs.wisc.edu
gatheredAt: vdt-itb.cs.wisc.edu
summaryData: OK
detailsData: OSG 1.2.15
EOT
</pre>

---+++ Running multiple metrics

---+++ Running all enabled metrics

---+++ Passing extra configuration 

---++ Enabling and Disabling metrics and consumers

-- Main.ScotKronenfeld - 19 Nov 2010
