%META:TOPICINFO{author="ArvindGopu" date="1213977942" format="1.1" version="1.19"}%
%META:TOPICPARENT{name="RSV"}%
%TOC%
%LINKCSS%

---+Upgrade !RSV from version 1 to version 2 on OSG CE 0.8.0 resources
%STARTINCLUDE%
%BR%

---++ Background

<p> This document is for OSG admins who wish to upgrade !RSV on an OSG CE 0.8.0 to a newer version of the probes <u><strong>only on systems that use condor-devel  to run !RSV </strong></u>.

---++ Get new files, and do some clean-up

---+++ Turn off osg-rsv related services, and back up your existing !RSV directories just to be safe
<pre class="screen"> vdt-control --off osg-rsv condor-devel apache
 cd $VDT_LOCATION
 cp -a osg-rsv osg-rsv-bkup
 cp -a condor-devel condor-devel-bkup</pre>

---+++ Get new files and place them in appropriate directories

   <pre class="screen"> cd $VDT_LOCATION/vdt/setup
 mv configure_osg_rsv configure_osg_rsv.old
 wget http://rsv.grid.iu.edu/downloads/pre-release/0.8.0/configure_osg_rsv
 chmod +rx $VDT_LOCATION/vdt/setup/configure_osg_rsv

 cd $VDT_LOCATION/osg-rsv/config
 ## If these files exist, then please delete them or move them out of the way
 wget http://rsv.grid.iu.edu/downloads/pre-release/0.8.0/rsv-gratia.info
 wget http://rsv.grid.iu.edu/downloads/pre-release/0.8.0/rsv-nagios.conf
 chmod -R go+rX $VDT_LOCATION/osg-rsv/config/

 cd $VDT_LOCATION/osg-rsv/bin
 mv probes probes.old
 wget http://rsv.grid.iu.edu/downloads/RSV-v1-tarballs/OSG_RSV_Probes-1.7.0.tar.gz
 tar -zxvf OSG_RSV_Probes-1.7.0.tar.gz
 mv rsv-probes-upgrade probes
  
 mkdir $VDT_LOCATION/osg-rsv/bin/misc
 cd $VDT_LOCATION/osg-rsv/bin/misc
 wget http://rsv.grid.iu.edu/downloads/pre-release/0.8.0/cleanup-rsv.pl
 ## If this file exists, then please delete it or move it out of the way
 cd $VDT_LOCATION/osg-rsv/bin/consumers
 wget http://rsv.grid.iu.edu/downloads/pre-release/0.8.0/html-consumer

 chmod -R go+rX $VDT_LOCATION/osg-rsv/bin/

 mkdir $VDT_LOCATION/osg-rsv/setup/                    ## If this does not exist, create it
 ln -s $VDT_LOCATION/vdt/setup/configure_osg_rsv $VDT_LOCATION/osg-rsv/setup/configure_osg_rsv
</pre>

---+++ Clean up some old files

  <pre class="screen"> ## move this file out of the way
 mv $VDT_LOCATION/osg-rsv/specs/global-specs/ping-host-probe\@org.osg.general.ping-host.spec /tmp

 perl $VDT_LOCATION/osg-rsv/bin/misc/cleanup-rsv.pl --reset</pre>
 
 <pre class="programlisting">Continue (y/n) [n]: y</pre>


%INCLUDE{"MonitoringInformation/ShouldIUserServiceCert"}%

---++ !RSV configuration steps
<P> <strong>NOTE: </strong> The !GUMS probe that is distributed with !RSV v2  is _not expected_ to work in OSG 0.8. So we recommend you not to enable it. The following configuration examples will <strong>disable</strong> the !GUMS probe by default.

%INCLUDE{"MonitoringInformation/PreConfigCheckListRsv"}%

%INCLUDE{"MonitoringInformation/ConfigureRsvV2AdvCeServcertNogums"}%

%INCLUDE{"MonitoringInformation/ConfigureRsvV2AdvSeSrmServcertNogums"}%

%INCLUDE{"MonitoringInformation/ConfigureRsvV2AdvSeBestmanServcertNogums"}%

%INCLUDE{"MonitoringInformation/ConfigureRsvV2AdvCeSeSrmProxyNoGums"}%


      For more example configurations, [[https://twiki.grid.iu.edu/twiki/bin/view/MonitoringInformation/InstallAndConfigureRsvAdvanced][see here]]. 


%INCLUDE{"MonitoringInformation/StartRsvV1"}%


%INCLUDE{"MonitoringInformation/ValidateRsvV1Configuration"}%




---++ REVERT If things do not work out, then bail ...
<pre class="screen"> vdt-control --off osg-rsv condor-devel apache

 cd $VDT_LOCATION
 mv osg-rsv osg-rsv.bad
 mv condor-devel condor-devel.bad
 cp -a osg-rsv.bkup osg-rsv
 cp -a condor-devel.bkup condor-devel
  
 cd $VDT_LOCATION/vdt/setup
 mv configure_osg_rsv configure_osg_rsv.bad
 mv configure_osg_rsv.old configure_osg_rsv
 chmod +rx $VDT_LOCATION/vdt/setup/configure_osg_rsv

 vdt-control --on condor-devel osg-rsv apache</pre>

<p>And you should be back in business ... at least to the state you were in before you started this upgrade :-)

<p><br>

<hr color="#111111">
<p><br>


-- Main.ArvindGopu - 02 Jun 2008