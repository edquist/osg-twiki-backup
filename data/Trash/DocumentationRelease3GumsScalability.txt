%META:TOPICINFO{author="MarcoMambelli" date="1363793022" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="NavTechGUMS"}%
%LINKCSS%
---+!! GUMS Scalability 
%DOC_STATUS_TABLE%
%TOC%

---# About this Document

The purpose of this document is to put together various GUMS configuration and system level settings that may help optimize GUMS server performance. It assumes you are familiar with GUMS, its installation and configuration as covered in InstallGums.

---# Background

The !FermiGrid Services group at Fermilab carried out various baseload/stress test runs against locally deployed GUMS server (gums1318.fnal.gov, which is actually a front end to 2 back end SL5 64bit servers gums1318a.fnal.gov and gums1318b.fnal.gov running gums 1.3.18.009-15.2). Each baseload run involved 50 clients contacting the server in parallel. Stress run, which was run on top of the baseload jobs, involved 5000 clients contacting the server in parallel (each client making 100 calls).  The purpose of these runs was to tune settings at various levels and achieve  a 100% success rate for all calls (number of calls from baseload jobs + 500,000 calls from stress run jobs) made to GUMS server. 

---#  Settings

---## GUMS configuration settings

In file =/etc/gums/gums.config=

| *Setting* | *Value* | *Comments* |
| hibernate.c3p0.timeout | 300 | number of seconds after which an idle connection is removed from connection pool |
| hibernate.c3p0.max_size | 300 | max number of db connections to keep in the connection pool |
| hibernate.c3p0.min_size | 25 | min number of ready db connections to keep in the connection pool |
| hibernate.c3p0.numHelperThreads | 50 | see note below | 
| hibernate.connection.url | 'jdbc:mysql://[host:port]/GUMS_1_3?autoReconnect=true& amp;tcpKeepAlive=true' | |

%NOTE% The c3p0 library is very asynchronous. Slow JDBC operations are generally performed by helper threads that don't hold contended locks. Spreading these operations over multiple threads can significantly improve performance by allowing multiple operations to be performed simultaneously.

---## Tomcat settings

In file =/etc/tomcat5/server.xml=

| *Setting* | *Value* | 
| maxThreads | 800 | 
| acceptCount | 4096 | 
| autoFlush | true |
| minSpareThreads | 50 |
| maxSpareThreads | 75 | 
| maxKeepAliveRequests | 1 |

---## System level settings

| *Setting* | *Value* | *Comments* |
| net.ipv4.tcp_max_syn_backlog | 1024 | |
| net.core.somaxconn | 4096 | |
| net.core.rmem_max | 8388608 | |
| net.core.wmem_max | 8388608 | |
| net.ipv4.tcp_rmem | 32768 87380 8388608 | |
| net.ipv4.tcp_wmem | 16384 65536 8388608 | |
| net.ipv4.tcp_mem | 8388608 8388608 8388608 | |

---# References
   * [[InstallGums][GUMS Installation guide]]
   * [[http://tomcat.apache.org/tomcat-5.5-doc/]] Official tomcat5 documentation
   * [[http://www.hibernate.org/docs]] Official hibernate documentation
   * [[http://www.mchange.com/projects/c3p0/][c3p0 documentation]] and [[http://sourceforge.net/projects/c3p0/][code]]

---# Comments
%COMMENT{type="tableappend"}%

<!-- CONTENT MANAGEMENT PROJECT

   DEAR DOCUMENT OWNER
   ===================

   Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER          = NehaSharma

   Please define the document area, choose one of the defined areas from the next line
   DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = General

   define the primary role the document serves, choose one of the defined roles from the next line
   DOC_ROLE = (Scientist|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

   Please define the document type, choose one of the defined types from the next line
   DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Knowledge
   
   Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

   Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

   change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

   change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %NO%

   change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


   DEAR DOCUMENT REVIEWER
   ======================

   Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = MarcoMambelli
  
   Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %YES%


   DEAR DOCUMENT TESTER
   ====================

   Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = 
  
   Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %NO%
 
-->

%META:FILEATTACHMENT{name="GUMSSAZStressTestsRound2.pdf" attachment="GUMSSAZStressTestsRound2.pdf" attr="" comment="Details on GUMS Stress Test" date="1363118211" path="GUMSSAZStressTestsRound2.pdf" size="385594" stream="GUMSSAZStressTestsRound2.pdf" tmpFilename="/usr/tmp/CGItemp47317" user="NehaSharma" version="1"}%
