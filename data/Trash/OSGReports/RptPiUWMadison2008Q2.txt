%META:TOPICINFO{author="ToddTannenbaum" date="1217443202" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="CreateNewReport"}%
<!-- Complete the template. You can either use TWiki style, copy in plain text, or put in HTML. --> <!-- IF COPYING IN HTML: Please only include the sections between your BODY tags. -->

---+!! 2008Q2 PI Quarterly Report

%STARTINCLUDE%

---++ University of Wisconsin - Madison
%EDITTHIS% <!-- EDIT BELOW THIS LINE ONLY! -->

---+++ Management Activities

Participation in OSG related presentations, workshops, steering meetings, incl:
   1 SBGrid workshop in Boston in May. 
   1 Meeting with WLCG and EGEE in Madison in May. 
   1 OSG Users meeting in BNL. 
   1 HPDC VO workshop in Boston in June. 
   1 HPC workshop in Italy in late June and visit DOE and NSF offices in late June. Still looking to hire another VDT developer and a Deputy Facility Coordinator. 

---+++ Software Activities

---++++ VDT

The VDT packaging of dCache was updated to 1.8.0, tested, and released. Many OSG sites have upgraded. <br /> <br />Five updates were made to OSG 0.8. They included security updates (Condor, MySQL, and Syslog-ng). <br /> <br />Major work was accomplished on VDT 1.10.0, which is the basis for the integration testbed testing for OSG 1.0. An update to VDT 1.10.0 will be the basis for OSG 1.0. The release came in early April, but we spent a lot of time work on it during this time period. Some features of interest:
   * No longer ship OpenSSL, but use the native SSL. (Do you want more verbiage on this? To get the philosophy right?) 
   * New Platform support: Debian 4 (for LIGO) and SLES 9 
   * Major update to RSV: bug fixes, new probes, improvements to Condor Cron facility (Do you want more verbiage on the details here?) 
   * Major Generic Information Provider update. (More verbiage?) 
   * Tons of software updates 
   * Tons of bug fixes

Staffing: We've been trying to hire a fourth VDT member. So far no success. We're temporarily borrowing someone from the Condor flightworthy group (Alan De Smet), and continuing our hiring process. <br /> <br />Our major focus for VDT was, and is, the OSG 1.0 release.
---++++ Middleware Contributions for OSG

In order to improve the ability of OSG sites to gather accounting and auditing information in the face of the increasing use of pilot jobs in OSG, a solution involving integration of GLExec with the condor_procd has been pursued. An initial version of this solution has been made available in version 1.10.0 of the VDT.

Developing this system has involved adding several new features to the condor_procd and also modifying the GLExec plugin used in OSG to interface with the condor_procd. The GLExec plugin modifications have been made and are maintained by Igor Sfiligoi at FNAL.

Features added to the condor_procd for this work include:
   1 The ability to leverage the full configuration language of Condor. (Previously, the condor_procd received all configuration options via command line arguments.) 
   1 The ability to leverage the full logging subsystem of Condor. (Previously, the condor_procd relied on a very primitive logging mechanism only suitable for debugging by the program's developers.) 
   1 A helper utility was developed in order to allow external programs (like the GLExec plugin) to use the condor_procd's novel method of using UNIX supplementary group IDs (SGIDs) for keeping track of process families. 
   1 The condor_procd's functionality was extended to support two new commands, accessible both from the condor_procd's client library and from the procd_ctl command-line tool: - A LIST command that gives a summary view of all processes in a family along with some resource usage information. - A TRACK_BY_GID command that facilitates use of the SGID-based tracking mechanism. 
   1 A handful of other small changes were additionally required for the condor_procd to integrate with the GLExec plugin. 

This work also enabled the discovery of a couple small bugs in Condor, for which fixes have been developed and are available in current releases. The only milestone for this work was to get versions of GLExec and the condor_procd that integrate to support enhanced accounting and auditing for pilot jobs into VDT version 1.10.0. This ensures this software will be made available with the 1.0 release of the OSG software stack. This milestone has been accomplished.

Other middleware work performed: 
   * Minor improvements in setting hold reasons for Condor-C and Condor-G. 
   * Fixed condor_preen to not remove MyProxy-related files in spool directory. 
   * Worked with Terrence Martin and the Globus team to reduce the memory usage of the gt4 gahp (spurred by the Out-of-Memory errors above). We developed some simplifications in how the gt4 gahp uses Globus's java apis that reduced the memory footprint. 
   * Reviewed some proposed changes in how WS GRAM handles Condor user logs. They'll start using one log per job (which can be cleaned up), instead of a single log that can't feasibly be rotated. 

---+++ Troubleshooting Activities

Worked with Parag to diagnose some stuck pre-WS GRAM jobs going from Fermi to Univ. Oklahoma. Part of the problem was a bug in how the GRAM perl module was querying LSF for job status. I opened Globus Bugzilla ticket 5775 describing the problem.

Helped Terrence Martin diagnose some network timeout and Out-of-Memory errors that the gt4 gahp in Condor-G was generating. This was part of is stress testing, submitting several thousand jobs at a time.

Helped Sebastien Goasguen at Clemson debug why his Condor-G installation wasn't running.

Rob Gardner and Shaowen Wang reported that /bin/date jobs submitted via globus-job-run to a fork jobmanager at UChicago were taking many minutes to run. We investigated and found two suspected culprits: + A bug in the schedd that can cause scheduler universe jobs to not start until the schedd's next queue scan. Dan fixed this in Condor 7.0.1. + Several hundred old gram state files, which the grid monitor took 2 minutes to process on every scan. The grid monitor is more intelligent about this in Condor 7.0.0.

During the above investigation of the slow jobs at UChicago, we discovered that the VDT-patched version of GRAM can leak Condor user logs if the jobs are removed from the Condor queue by something other than GRAM. We wrote a patch and gave it to the VDT.

Horst Severini reported that SAMGrid jobs were not being matched in the OCHEP cluster at UOklahoma. The problem was a bug with NEGOTIATOR_MATCHLIST_CACHING that was fixed in the Condor 6.8 series. They were running Condor 6.8.0.

Xin Zhao report very slow submission rates on a couple Condor-G machines at BNL. The problem was that they had a large number of jobs (8000 submitted in 4 hours) but hadn't set the gridmanager's throttle to handle that number of jobs efficiently.

Investigated a report by Jay Packard of a lot of stuck jobs on a Condor-G machine at BNL. They were using a VOMS-extended proxy where the VOMS extension had a much shorter lifetime than the main proxy. When the VOMS extension expired, they refreshed it, but the new main proxy had the same expiration time (which wasn't passed yet). So Condor thought the proxy was unchanged and continued to use the old one, which was cached in memory.

Steve Timm reported large numbers of failed Condor-G jobs. The main cause was determined to be a port-range that was too small on one or two gatekeepers.

%STOPINCLUDE%
