%META:TOPICINFO{author="MarcoMambelli" date="1254419298" format="1.1" version="1.6"}%
%META:TOPICPARENT{name="PlansTimelines"}%
---++ A plan for rsv-control

This description was discussed in a meeting with Arvind Gopu, Marco Mambelli, Alain Roy, Rob Quick, and Suchandra Thapa on August 28, 2009.

---+++ rsv-control interface

Usage:
<pre>
rsv-control
      --help | -h 
      --version 
      --list [ --wide | -w]
      --enable  --metric  &lt;metric-name>  --host &lt;hostname>[:port]
      --enable  --service &lt;service-name> --host &lt;hostname>[:port]
      --disable --metric  &lt;metric-name>  --host &lt;hostname>[:port]
      --disable --service &lt;service-name> --host &lt;hostname>[:port]
      --test --service &lt;service-name> --host &lt;hostname>[:port]
</pre>

Definitions of the options:

*--help:* print a usage statement

*--version:* print the version of this tool and the version of RSV that is being used.

*--list:* List all of the metrics that are installed. (Not probes, but individual metrics.) They will be listed in a table no more than 76 characters wide (but see -w and -ww) that looks approximately like this:

<pre>
Metric                                         | Service  | Hostname
-----------------------------------------------+ ---------+--------------------
org.osg.general.ping-host                      | CE       | osg-edu.cs.wisc.edu
org.osg.general.ping-host                      | CE       | glow.cs.wisc.edu
org.osg.gums.gums-running                      | CE       |   --disabled--
org.osg.general.osg-directories-CE-permissions | CE       | osg-edu.cs.wisc.edu
</pre>

If the table rows can't be fully displayed in 76 characters and the --wide option is not specified, then the following heuristics are applied in order to make it short enough. That is, if the first step is sufficient, no further heuristics are applied, and so on:
   1. The hostname is shortened to be just the first portion of the name (before the .)
   1. The hostname is shortened to be less than 16 characters, preserving the beginning of the hostname.
   1. The metric name is shortened to fit, but the beginning of the metric name is removed and replaced with "..."

*--wide:* Modifies --list so that the table is as wide as it needs to display the entire table without chopping off any fields.

*--enable:* Enables one of the metrics to be run. This requires one of the following parameters, but they are mutually exclusive:

   * *--metric:* The full name of the metric to be enabled
   * *--service:* This will enable all of the metrics that apply to a service. The user can discover this set by examining the --list output.
   * *--host:* Either the full hostname of the host to run the metric on, or a description of the form _hostname:port_ which is the full hostname and port.

*--disable:* Disable works in the same way as --enable, but will disable the metric (or set of metrics corresponding to a service) instead of enabling it.

*--test:* Test works in the same way as --enable, but will test the metric (or set of metrics corresponding to a service). This means that the metric  is scheduled for immediate execution. Cron execution of the metric is not affected. Also log files and submit files are different.

---+++ Implementation plan
As of the end of August 2009, Marco has implemented much of the underlying functionality for rsv-control, but the interface doesn't match the one shown above. 

We expect that this new interface can be implemented by 23-Sep-2009 and passed to the ITB/VTB for testing.  
   * As of 9/17 v0.6 of the interface is available for internal testing. This implements the above requirements

Code is in this CVS repository:
http://repo.mwt2.org/viewvc/marco/rsvscripts/        

---+++ Open items

---+++ Future work
We expect that rsv-control will be expanded with more functionality. We have not decided who will implement it--it may revert to the RSV team at Indiana. Two major pieces of functionality we would like to see are:

   1. The ability to list, enable, and disable the RSV consumers. 
   1. The ability to set specific configuration for each metric (beyond the hostname:port described above)
   1. An --interactive option to simplify the user interface