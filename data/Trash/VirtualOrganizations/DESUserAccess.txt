%META:TOPICINFO{author="TanyaLevshina" date="1351264972" format="1.1" reprev="1.2" version="1.2"}%
---+!! How To Setup Limited Access to DES Data
%TOC%

---++ Requirements 
1. This is a temporary service that should be available ~30 days
2. The number of users is limited. In general, users don't have certificates and don't have access to fermilab site
3. The users will have READ ONLY access to the produced sets of output data


Proposed solution: Use globus connect/globus-online mechanism to allow users access to the above mentioned output data.
---++ Administrator's Tasks
This will require the following preliminary steps from a administrator:

   1. setup gridftp server with gridmapfile authentication (Brian has mentioned that des09.fnal.gov could be used and we need to coordinate this with Nikolay). The instruction how to setup a standalone grdiftp server could be found [[https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallOSGGridFTP][here]].
   1. mount bluearc /des/orchestration area on this machine
   1. create a unix user (==%RED%desuser%ENDCOLOR%==) on the gridftp server machine, allow read ONLY access to  /des/orchestration/DTS/%RED%output-data%ENDCOLOR% directory
   1. request and obtain service certificate by following [[https://www.opensciencegrid.org/bin/view/Documentation/Release3/GetHostServiceCertificates#Send_the_request_AN1][this instruction]]
   1. add DN of this service certificate to gridmapfile mapped to ==%RED%desuser%ENDCOLOR%==
   1. register with [[https://www.globusonline.org/SignUp][Globus Online]] or [[https://www.globusonline.org/SignIn][login]] to an existing account
   1. setup a public endpoint </br><img src="%ATTACHURLPATH%/Screen_shot_2012-10-26_at_9.52.31_AM.png" alt="Screen_shot_2012-10-26_at_9.52.31_AM.png" width='770' height='440' />    
   1. setup identity provider: use myproxy server, e.g myproxy.ncsa.uiuc.edu</br><img src="%ATTACHURLPATH%/Screen_shot_2012-10-26_at_10.18.05_AM.png" alt="Screen_shot_2012-10-26_at_10.18.05_AM.png" width='500' height='384' />    
   1. create a cron job that periodically creates limited proxy certificate and renew it with myproxy server
     grid-proxy-init -limited
     myproxy-init -v -l desuser -s myproxy.ncsa.uiuc.edu
  1. notify set of users about globusonline endpoint, username/password for myproxy retrieval

---++ User's Tasks
  1. Register in globus online
  1. Install globus-connect (one click install  - mac, windows, linux )
  1. Start transfer of files (will need to activate endpoint by specifying myproxy server, user/password)

---++ Monitoring and troubleshooting
Monitoring could be done via gridftp log files:
gridftp-auth.log
 New connection from: transfer.api.globusonline.org:35448
[11448] Thu Oct 25 13:57:10 2012 :: DN /DC=org/DC=doegrids/OU=Services/CN=<servicename>/CN=..... successfully authorized.
[11448] Thu Oct 25 13:57:10 2012 :: User desuser successfully authorized.

gridftp log
DATE=20121025155815.542534 HOST=fermigridosg1.fnal.gov PROG=globus-gridftp-server NL.EVNT=FTP_INFO START=20121025155815.128710 USER=desuser FILE=/des/orchestration/....../test_job_script BUFFER=0 BLOCK=262144 NBYTES=4505 VOLUME=/ STREAMS=1 STRIPES=1 DEST=[67.184.183.224] TYPE=RETR CODE=226
 
Destination gives you the hostname of a computer from where the transfer has been instantiated.

-- Main.TanyaLevshina - 26 Oct 2012

   

     

%META:FILEATTACHMENT{name="Screen_shot_2012-10-26_at_9.52.31_AM.png" attachment="Screen_shot_2012-10-26_at_9.52.31_AM.png" attr="h" comment="Endpoint Registration" date="1351263589" path="Screen shot 2012-10-26 at 9.52.31 AM.png" size="159325" stream="Screen shot 2012-10-26 at 9.52.31 AM.png" tmpFilename="/usr/tmp/CGItemp14211" user="TanyaLevshina" version="1"}%
%META:FILEATTACHMENT{name="Screen_shot_2012-10-26_at_10.18.05_AM.png" attachment="Screen_shot_2012-10-26_at_10.18.05_AM.png" attr="h" comment="" date="1351264727" path="Screen shot 2012-10-26 at 10.18.05 AM.png" size="76014" stream="Screen shot 2012-10-26 at 10.18.05 AM.png" tmpFilename="/usr/tmp/CGItemp14091" user="TanyaLevshina" version="1"}%
