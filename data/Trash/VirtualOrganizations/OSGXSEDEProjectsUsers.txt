%META:TOPICINFO{author="MatsRynge" date="1387228769" format="1.1" reprev="1.3" version="1.3"}%
%META:TOPICPARENT{name="OSGasXsedeSp"}%
---+ Managing projects and user accounts on the OSG-XSEDE system

Projects and users are maintained in the [[XSEDEAccountingOverview][Gold allocation/accounting database]]. In order to manipulate the database, you have to use the "gold" user account. Use sudo from you regular user account to switch to "gold":

<verbatim>
$ sudo su - gold
</verbatim>

Once logged in as the "gold" user, the Gold commands are you your path. The full manual can be found [[http://docs.adaptivecomputing.com/gold/][here]]. Note that changes to the Gold database are *not* reflected immediately. The system uses cron jobs at different intervals to pull information from the Gold database and add users/projects and update login messages with the correct account statements.

---++ Adding a user

Use the "gmkuser" command to create a new user. The -A means to activate the user. The name has to be given both in full (-n) and as separate first and last names (-X).

<verbatim>
gmkuser -A -u dweitzel -n "Derek Weitzel" -E "dweitzel@cse.unl.edu" -X Org="University of Nebraska - Lincoln" -X FirstName="Derek" -X LastName="Weitzel"
</verbatim>

Once the user has been added, it will take 30 minutes before the system account has been created. Once there, you have to set up at least one of two possible authentication methods for the user to be able to login: gsissh or public key ssh. For gsissh, add a DN to the *local* gridmap file:

<verbatim>
sudo vim /etc/grid-security/grid-mapfile.local
</verbatim>

If the user prefers ssh public key authentication, add a ~/.ssh/authorized_keys to the account. First switch to the new user:
 
<verbatim>
sudo su - [newuser]
</verbatim>

Then:

<verbatim>
mkdir ~/.ssh
chmod 755 ~/.ssh
vim  ~/.ssh/authorized_keys
chmod 644 ~/.ssh/authorized_keys
</verbatim>

---++ Adding a project

First, create the new project and make it active:

<verbatim>
gmkproject -A [PROJNAME]
</verbatim>

Deposit an appropriate amount of core hours. 1M seems like a good default:

<verbatim>
gdeposit -p [PROJNAME] -h 10000000
</verbatim>

When the project is created, an allocation is created automatically. The problem is that the allocation is not time limited, which we need it to be for the OSG-XSEDE system. So, first find the allocation number by running ~/bin/active-allocations, then set start end end dates for the project:

<verbatim>
~/bin/active-allocations | grep [PROJNAME]
gchalloc -s '2013-12-01' -e '2015-12-31' [ALLOCNUM]
</verbatim>

The last step is to add users to the project:

<verbatim>
gchproject --addUsers [USERNAME] [PROJNAME]
</verbatim>

Note: it can take up to 3 hours for the project to show up in group lists and  login account statements.

-- Main.MatsRynge - 16 Dec 2013
