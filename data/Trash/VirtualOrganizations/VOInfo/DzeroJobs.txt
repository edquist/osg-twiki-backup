%META:TOPICINFO{author="KyleGross" date="1229445840" format="1.1" version="1.4"}%
%META:TOPICPARENT{name="DZERO"}%
%TOC%

---++ Requirements to run Dzero Jobs

For Dzero jobs forwarded through the Samgrid-OSG forwarding mechanism, we require:

1. Worker nodes need to have outgoing network access. This is an absolute must since we contact DZero data management services (SAM) at FNAL, SAM-stations, SAM disks and durable storages which will be outside the OSG site, as well as calibration servers at FNAL, etc.

2. Worker nodes should have atleast 6GB of local scratch storage space per job slot on the worker node. This scratch space should be published as $OSG_WN_TMP variable in job's environment

---++Running Dzero Jobs on OSG clusters
This section describes how to run Dzero jobs on OSG clusters through Samgrid and additional procedures to follow to gain access to some sites.

---+++General Instructions To Obtain Access To OSG Sites

Dzero users should be registered with the Dzero VOMS in order to run jobs at OSG sites that support Dzero VO. In most cases, being registered with Dzero VOMS is sufficient to use most of the OSG sites. However, different sites could enforce additional policies to give access to the users.  Please follow the instructions below in order to gain access to some of the sites mentioned.

---+++Instructions To Obtain Access To Certain Specific OSG Sites

---++++National Energy Research Scientific Computing Center (NERSC)
In order to gain access to NERSC site -
<ol>
  <li>
    <b>Request an account:</b> <br>
    Take following steps to request an account.<br><br>
    <u>Complete the registration form</u><br>
    http://www.nersc.gov/nusers/resources/PDSF/starting/newuser_form.php<br>
    Select "OSG" in the Project list<br>
    In the "Description of Work", mention that you will be running jobs as a member of Dzero VO<br><br>
    <u>Complete NERSC Computer Use Policies Form</u><br>
    http://www.nersc.gov/nusers/accounts/usage.php<br>
    Complete the form with your personal information. Use "Miron Livny" and "Doug Olson" as Principal Investigators. Follow the instructions to return the completed form to NERSC.
  </li>
  <li>
    <b>Obtain your username and password</b><br>
    Once you have submitted the above forms, call the <br>
    NERSC Account Support:<br>
    Email: support@nersc.gov<br>
    Phone: 1-800-66-NERSC menu 2  or  1-510-486-8612<br>
   It should not take long after you send the FAX. They do not send another email after the FAX, just expect you to call. Wait for 24 hours before checking with them.
  </li>
  <li>
    <b>Register your Grid subject:</b><br>
    When you get your password you need to - <br>
    - login to https://nim.nersc.gov/<br>
    - click on the Grid Certificates tab in the lower half of the window <br>
    - and then click on "Add existing Grid Certificate to NIM", and then enter your cert DN and the CA DN. <br>
This is propagated to the grid-mapfiles within a day.
  </li>
</ol>

---+++ Submitting Dzero Jobs Through Samgrid

In general, you should always use operational tools to submit jobs to OSG sites through Samgrid. 

---++++ Submitting Job To An OSG site using Resource Selection Service (!ReSS)

Following JDF demonstrates how to use OSG !ReSS to match your job to an OSG site support Dzero VO. JDF is similar to the JDF shown above except that the parameter <i>grid_resource_requirement_string</i> is used to specify an requirement expression for Condor using Glue Schema. 

<pre>
job_type = dzero_reconstruction
sam_experiment = d0
sam_universe = prd
group = d0production
station_name = osg-ouhep
check_consistency = true
test_run = true
instances = 1
store_zerobias_file = true
input_dataset = dayset-2005-11-15-all_2-211915-0
d0_release_version = p17.05.01
jobfiles_dataset = d0repro_jobfiles_p17.05.01_samgridV7-2
grid_resource_requirement_string = (stringlistimember("VO:dzero", TARGET.GlueCEAccessControlBaseRule, ",") && stringlistimember("OSG-0.4.1", TARGET.GlueHostApplicationSoftwareRunTimeEnvironment, ","))
</pre>

Above example shows how to submit a job to an OSG 0.4.1 site that supports Dzero VO. In principle a similar <i>grid_resource_requirement_string</i> could be formed to identify sites that have been certified to run Monte Carlo or Reprocessing jobs.

Another example of <i>grid_resource_requirement_string</i> to select one of the sites from a list.

<pre>
grid_resource_requirement_string = (GlueCEInfoContactString == "red.unl.edu:2119/jobmanager-pbs") || (GlueCEInfoContactString == "cmsosgce.fnal.gov:2119/jobmanager-condor") || (GlueCEInfoContactString == "grid1.oscer.ou.edu:2119/jobmanager-lsf") || (GlueCEInfoContactString == "osg-gw-2.t2.ucsd.edu:2119/jobmanager-condor")
</pre>

---++++ Submitting Job To A Specific OSG site

Following JDF demonstrates how to target a specific OSG site to run your job. The example below submits your job to USCMS site at Fermilab. JDF is similar to one mentioned above. Use the JDF above and replace <i>grid_resource_requirement_string</i> as shown below.
<pre>
grid_resource_requirement_string = cmsosgce.fnal.gov:2119/jobmanager-condor
</pre>

You can also target a specific OSG cluster using !ReSS. Example below targets the Stitch OSG cluster at OU
<pre>
grid_resource_requirement_string = (TARGET.GlueCEInfoHostName =?= "stitch.oscer.ou.edu")
</pre>


-- Main.ParagMhashilkar - 15 Mar 2007