%META:TOPICINFO{author="MarcoMambelli" date="1281712719" format="1.1" version="1.4"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! *<nop>%SPACEOUT{%TOPIC%}%*
%DOC_STATUS_TABLE%
%TOC{depth="2"}%

---++ About This Document
This document is about the installation and setup of the CA certificates using =vdt-ca-manage=. 
It applies to OSG version 1.2 and VDT version 2.0.
The CA certificates are always installed to complete the setup of some other package including =vdt-ca-manage=, like the CE, OSG client, the WN client or one SE. Further consideration are in the Install section below.

---+++!!Help!
If a problem occurs during installation or verification of the service, see [[#DebugInfo][Debugging Information]].
%BR%
If you cannot resolve the problem, the best way to get help is by following this ReleaseDocumentation.HelpProcedure.

---++ Introduction
The OSG distributes a number of certificates of [[Documentation/GlossaryC#DefsCA][Certificate Authorities]] that issue certificates to their members. By installing these certificates you establish a chain of trust with each of the certificate authorities and trust the servers and services certified by those authorities. The %LINK_GLOSSARY_CRL% is used to inform you about individual certificates that have been revoked.

We will use the =vdt-ca-manage= command to download the CA Certificates and the Certificate Revocation List. The command line option =--location local= copies the CA certificates into the subdirectory =%INSTALL_DIR%/globus/share/certificates=. 

---++ Checklist
Be aware of the following:
   1. Which CA package you want to install
   1. If you are installing as _root_ or as _non-root_ user
   1. who is maintaining and updating the CA/CRL installation

%STARTINCLUDE%
<!--
   * Set DOC_LTSL=%IF{"defined 'DOC_TitleSubLevel'" then="%DOC_TitleSubLevel%" else=""}%
-->

---++%DOC_LTSL% CA Certificates Installation Procedure

The program =vdt-ca-manage= provides convenient options to configure which [[Documentation/GlossaryC#DefsCA][Certificate Authority]] to trust and how to install the CA Certificates on your resource.

---+++%DOC_LTSL% System-wide Installation
The location =/etc/grid-security/certificates= is one of the directories in the default search path for CA Certificates and it 
should preferably be used to make the certificates system-wide available when there are multiple VDT or Globus installations sharing the same certificates. This requires _root_ privileges: 

<pre class="screen">
[root@%INSTALL_HOST% %INSTALL_DIR%]# vdt-ca-manage setupca %RED%--location root%ENDCOLOR% --url osg
Setting CA Certificates for VDT installation at '%INSTALL_DIR%'

Setup completed successfully.
</pre>

---+++%DOC_LTSL% Use an existing CA Installation

It is often practical to reuse an existing %LINK_GLOSSARY_CA% Installation instead of creating a new installation using =vdt-ca-manage=:

<pre class="screen">
[%INSTALL_LOGIN%@%INSTALL_HOST% %INSTALL_DIR%]# source setup.sh
[%INSTALL_LOGIN%@%INSTALL_HOST% %INSTALL_DIR%]# vdt-ca-manage setupca %RED%--location /etc/grid-security/certificates%ENDCOLOR% --no-update
Setting CA Certificates for VDT installation at '%INSTALL_DIR%'

Setup completed successfully.
</pre>

%ICON{hand}% The command line option =--location= points to the existing installation. The command creates a softlink from =%INSTALL_DIR%/globus/TRUSTED_CA= to =/etc/grid-security/certificates=.

---+++%DOC_LTSL% Provide and Install a custom CA Package

If a custom %LINK_GLOSSARY_CA% certificates package was made available on a web server, it can be used to be installed instead of the OSG specific CA package using the =--url= option on the command line to =vdt-ca-manage=:

<pre class="screen">
[%INSTALL_LOGIN%@%INSTALL_HOST% %INSTALL_DIR%]# source setup.sh
[%INSTALL_LOGIN%@%INSTALL_HOST% %INSTALL_DIR%]# vdt-ca-manage setupca --location /full/path/to/CAinstallation --url http://your.web.server/path/to/CA_distribution
</pre>

By default this enables the periodic update of the CA Certificates and the CRL.

---+++%DOC_LTSL%

%STOPINCLUDE%

---++ Service Configuration/Startup/Shutdown
There are two services related to CAs: one to update the CA certificates, one to update the CRLs.

In the CE configuration they are enabled with the following lines in the configuration file: <pre class="file">
[Misc Services]
use_cert_updater = %(enable)s
</pre>

Alternatively you can enable and start the service manually:<pre class="rootscreen">
vdt-control --enable vdt-update-certs
vdt-control --on vdt-update-certs
</pre>
For the fetch_crl service (this will activate the service and the last command will retrieve an initial set of CRLs):<pre class="rootscreen">
vdt-control --enable fetch-crl
vdt-control --on fetch-crl
$VDT_LOCATION/vdt/bin/vdt-ca-manage fetchCRL
</pre>

---++ Validation of Service Operation

#DebugInfo
---++ Debugging Information
---+++!!File Locations
The certificate directory you specify will contain CA certificates and CRLs

---+++!!Debugging Procedure
If a certificate/CRL download is failing, check if you can connect to the server.

---+++!!Caveats/Known Issues
If a certificate has been downloaded partially you have to remove it. The utilities will not overwrite it.


---++ *Comments*
%COMMENT{type="tableappend"}%

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = DougOlson

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = General

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Installation
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %NO%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %NO%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = RobertEngel
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %IN_PROGRESS%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = IwonaSakrejda
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %IN_PROGRESS%
############################################################################################################
-->
-- Main.JamesWeichel - 03 Feb 2010