%META:TOPICINFO{author="TedHesselroth" date="1270500803" format="1.1" version="1.5"}%
%META:TOPICPARENT{name="OpportunisticStorage"}%
%DOC_STATUS_TABLE%
https://twiki.grid.iu.edu/twiki/pub/Storage/WebHome/images.jpg

---+!! *<noop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

---++++ Cache Scripts

---+++++ load_bdii_cache

Loads the cache with information needed by the discovery tools. Removes all previous cache info.

*Script Name*

load_bdii_cache

*Parameters*
%TABLE{ headerbg="#eeeeee" headercolor="#000000" databg="#ffffff" tableborder="1" columnwidths="120," cellpadding="2" cellspacing="1" dataalign="left" valign="top" sort="off"}%
| *name* | *definition* | *required* |
| verbose | Print search strings | no |

*Usage*

<verbatim>
load_bdii_cache [ --verbose ]
</verbatim>


*Example Output*
<verbatim>
[xquery]$ bin/load_bdii_cache --verbose
//GlueSE/GlueSA/GlueVOInfo[@GlueVOInfoAccessControlBaseRule]
//GlueSE/GlueSEControlProtocol[@GlueSEControlProtocolVersion='2.2.0']
//GlueCESEBind/@GlueCESEBindMountInfo
//GlueSE/GlueSA/@GlueSAFreeOnlineSize
//GlueSE/GlueSEAccessProtocol[@GlueSEAccessProtocolType='file']
//GlueSE/GlueSEControlProtocol/@GlueSEControlProtocolEndpoint
//GlueSE/GlueSA/GlueVOInfo/@GlueVOInfoPath
//GlueCESEBind/@dn
//GlueSE/@GlueSEUniqueID
SEARCH //GlueSE/GlueSA/GlueVOInfo/@GlueVOInfoAccessControlBaseRule
SEARCH //GlueSE/GlueSEControlProtocol/@GlueSEControlProtocolVersion='2.2.0'
SEARCH //GlueCESEBind/@GlueCESEBindMountInfo
SEARCH //GlueSE/GlueSA/@GlueSAFreeOnlineSize
SEARCH //GlueSE/GlueSEAccessProtocol/@GlueSEAccessProtocolType='file'
SEARCH //GlueSE/GlueSEControlProtocol/@GlueSEControlProtocolEndpoint
SEARCH //GlueSE/GlueSA/GlueVOInfo/@GlueVOInfoPath
SEARCH //GlueCESEBind/@dn
SEARCH //GlueSE/@GlueSEUniqueID
(&(objectclass=GlueVOInfo)(GlueVOInfoAccessControlBaseRule)) GlueVOInfoAccessControlBaseRule objectclass 
objectclass=GlueVOInfo GlueVOInfoPath objectclass 
(&(objectclass=GlueSEControlProtocol)(GlueSEControlProtocolVersion=2.2.0)) GlueSEControlProtocolVersion objectclass 
objectclass=GlueSEControlProtocol GlueSEControlProtocolEndpoint objectclass 
objectclass=GlueCESEBind GlueCESEBindMountInfo objectclass 
objectclass=GlueCESEBind dn objectclass 
objectclass=GlueSA GlueSAFreeOnlineSize objectclass 
(&(objectclass=GlueSEAccessProtocol)(GlueSEAccessProtocolType=file)) GlueSEAccessProtocolType objectclass 
objectclass=GlueSE GlueSEUniqueID objectclass 
Cache location is /home/tdh/testing/osg-discovery-0.8/cache/bdii.xml
Done.
</verbatim>

---+++++ update_bdii_cache

Updates the cache with information needed by the discovery tools. Merges with previous cache info.

*Script Name*

update_bdii_cache

*Parameters*
%TABLE{ headerbg="#eeeeee" headercolor="#000000" databg="#ffffff" tableborder="1" columnwidths="120," cellpadding="2" cellspacing="1" dataalign="left" valign="top" sort="off"}%
| *name* | *definition* | *required* |
| verbose | Print search strings | no |

*Usage*

<verbatim>
update_bdii_cache  [ --verbose ]
</verbatim>


*Example Output*
<verbatim>
[xquery]$ bin/update_bdii_cache
//GlueSE/GlueSEControlProtocol[@GlueSEControlProtocolVersion='2.2.0']
//GlueCESEBind/@GlueCESEBindMountInfo
//GlueSE/GlueSA/@GlueSAFreeOnlineSize
//GlueSE/GlueSA/GlueVOInfo[@GlueVOInfoAccessControlBaseRule]
//GlueSE/GlueSEAccessProtocol[@GlueSEAccessProtocolType='file']
//GlueSE/GlueSEControlProtocol/@GlueSEControlProtocolEndpoint
//GlueSE/GlueSA/GlueVOInfo/@GlueVOInfoPath
//GlueCESEBind/@dn
//GlueSE/@GlueSEUniqueID
SEARCH //GlueSE/GlueSEControlProtocol/@GlueSEControlProtocolVersion='2.2.0'
SEARCH //GlueCESEBind/@GlueCESEBindMountInfo
SEARCH //GlueSE/GlueSA/@GlueSAFreeOnlineSize
SEARCH //GlueSE/GlueSA/GlueVOInfo/@GlueVOInfoAccessControlBaseRule
SEARCH //GlueSE/GlueSEAccessProtocol/@GlueSEAccessProtocolType='file'
SEARCH //GlueSE/GlueSEControlProtocol/@GlueSEControlProtocolEndpoint
SEARCH //GlueSE/GlueSA/GlueVOInfo/@GlueVOInfoPath
SEARCH //GlueCESEBind/@dn
SEARCH //GlueSE/@GlueSEUniqueID
(&(objectclass=GlueSEControlProtocol)(GlueSEControlProtocolVersion=2.2.0)) GlueSEControlProtocolVersion objectclass 
objectclass=GlueSEControlProtocol GlueSEControlProtocolEndpoint objectclass 
objectclass=GlueCESEBind GlueCESEBindMountInfo objectclass 
objectclass=GlueCESEBind dn objectclass 
objectclass=GlueSA GlueSAFreeOnlineSize objectclass 
(&(objectclass=GlueVOInfo)(GlueVOInfoAccessControlBaseRule)) GlueVOInfoAccessControlBaseRule objectclass 
objectclass=GlueVOInfo GlueVOInfoPath objectclass 
(&(objectclass=GlueSEAccessProtocol)(GlueSEAccessProtocolType=file)) GlueSEAccessProtocolType objectclass 
objectclass=GlueSE GlueSEUniqueID objectclass 
Cache location is /home/tdh/testing/osg-discovery-0.8/cache/bdii.xml
Done.
</verbatim>

---++++ Search Scripts

These tools compose command lines for SRM operations based on searches in the OSG BDII.

This is the command line component of the OSG Storage Discovery tool. Links to the project development pages can be found at [[http://cd-97177.fnal.gov:8088/wiki/xpathsearch][XPathSearch Development Site]].

Usage and examples of the tools is as follows.

---+++++ get_srm_reserve_space_cmd

For a given VO, prints a space reservation command line for each supporting site. The space reservation client is the FNAL implmentation.

*Script Name*

get_srm_reserve_space_cmd

*Parameters*
%TABLE{ headerbg="#eeeeee" headercolor="#000000" databg="#ffffff" tableborder="1" columnwidths="120," cellpadding="2" cellspacing="1" dataalign="left" valign="top" sort="off"}%
| *name* | *definition* | *required* |
|  vo | VO Name | yes |
| description | user-supplied description | no |
| requested_size | Size of reservation in bytes | yes |
| guaranteed_size | Size to be guaranteed in bytes | no |
| retention_policy | Quality of file retention | no |
| lifetime | Time to expiration | no |
| storage_element_id | <nop>GlueSEUniqueID | no |

*Usage*

<verbatim>
get_srm_reserve_space_cmd --vo <VO name> [--storage_element_id <GlueSEUniqueID>] --requested_size <Size requested> [--retention_policy <REPLICA|CUSTODIAL|OUTPUT>] [--guaranteed_size <Size to be guaranteed>] [--lifetime <Time to expiration>] [--description <Space token description>]
</verbatim>

*Example Output*
<verbatim>
[xquery]$ get_srm_reserve_space_cmd vo=engage description=mydesc requested_size=3000 guaranteed_size=2000 lifetime=1000
srm-reserve-space -space_description=mydesc -desired_size=3000 -guaranteed_size=2000 -lifetime=1000 srm://abitibi.sbgrid.org:8443/srm/managerv2
srm-reserve-space -space_description=mydesc -desired_size=3000 -guaranteed_size=2000 -lifetime=1000 srm://sigmorgh.hpcc.ttu.edu:49443/srm/v2/server.
srm-reserve-space -space_description=mydesc -desired_size=3000 -guaranteed_size=2000 -lifetime=1000 srm://se01.cmsaf.mit.edu:8443/srm/managerv2
srm-reserve-space -space_description=mydesc -desired_size=3000 -guaranteed_size=2000 -lifetime=1000 srm://cit-se.ultralight.org:8443/srm/managerv2
srm-reserve-space -space_description=mydesc -desired_size=3000 -guaranteed_size=2000 -lifetime=1000 srm://cit-se.ultralight.org:8443/srm/managerv2
srm-reserve-space -space_description=mydesc -desired_size=3000 -guaranteed_size=2000 -lifetime=1000 srm://cit-se2.ultralight.org:8443/srm/v2/server
srm-reserve-space -space_description=mydesc -desired_size=3000 -guaranteed_size=2000 -lifetime=1000 srm://ff-se.unl.edu:8443/srm/v2/server
srm-reserve-space -space_description=mydesc -desired_size=3000 -guaranteed_size=2000 -lifetime=1000 srm://fndca1.fnal.gov:8443/srm/managerv2
srm-reserve-space -space_description=mydesc -desired_size=3000 -guaranteed_size=2000 -lifetime=1000 srm://srm.unl.edu:8443/srm/managerv2
srm-reserve-space -space_description=mydesc -desired_size=3000 -guaranteed_size=2000 -lifetime=1000 srm://srm.ihepa.ufl.edu:8443/srm/managerv2
srm-reserve-space -space_description=mydesc -desired_size=3000 -guaranteed_size=2000 -lifetime=1000 srm://osg-east.hms.harvard.edu:10443/srm/v2/server
srm-reserve-space -space_description=mydesc -desired_size=3000 -guaranteed_size=2000 -lifetime=1000 srm://osg.hpcc.nd.edu:8443/srm/managerv2
srm-reserve-space -space_description=mydesc -desired_size=3000 -guaranteed_size=2000 -lifetime=1000 srm://dcache07.unl.edu:8443/srm/v2/server
</verbatim>

---+++++ get_srm_sp_reserve_cmd

For a given VO, prints a space reservation command line for each supporting site. The space reservation client is the LBL implmentation.

*Script Name*

get_srm_sp_reserve_cmd

*Parameters*
%TABLE{ headerbg="#eeeeee" headercolor="#000000" databg="#ffffff" tableborder="1" columnwidths="120," cellpadding="2" cellspacing="1" dataalign="left" valign="top" sort="off"}%
| *name* | *definition* | *required* |
|  vo | VO Name | yes |
| description | user-supplied description | no |
| requested_size | Size of reservation in bytes | yes |
| guaranteed_size | Size to be guaranteed in bytes | no |
| lifetime | Time to expiration | no |
| storage_element_id | <nop>GlueSEUniqueID | no |

*Usage*

<verbatim>
get_srm_sp_reserve_cmd --vo <VO name> [--storage_element_id <GlueSEUniqueID>] --requested_size <Size requested> [--guaranteed_size <Size to be guaranteed>] [--lifetime <Time to expiration>] [--description <Space token description>]
</verbatim>

*Example Output*
<verbatim>
[xquery]$ get_srm_sp_reserve_cmd vo=engage description=mydesc requested_size=3000 guaranteed_size=2000 lifetime=1000
srm-sp-reserve -serviceurl srm://abitibi.sbgrid.org:8443/srm/managerv2 -size 3000 -gsize 2000 -lifetime 1000 -userdesc mydesc
srm-sp-reserve -serviceurl srm://sigmorgh.hpcc.ttu.edu:49443/srm/v2/server. -size 3000 -gsize 2000 -lifetime 1000 -userdesc mydesc
srm-sp-reserve -serviceurl srm://se01.cmsaf.mit.edu:8443/srm/managerv2 -size 3000 -gsize 2000 -lifetime 1000 -userdesc mydesc
srm-sp-reserve -serviceurl srm://cit-se.ultralight.org:8443/srm/managerv2 -size 3000 -gsize 2000 -lifetime 1000 -userdesc mydesc
srm-sp-reserve -serviceurl srm://cit-se.ultralight.org:8443/srm/managerv2 -size 3000 -gsize 2000 -lifetime 1000 -userdesc mydesc
srm-sp-reserve -serviceurl srm://cit-se2.ultralight.org:8443/srm/v2/server -size 3000 -gsize 2000 -lifetime 1000 -userdesc mydesc
srm-sp-reserve -serviceurl srm://ff-se.unl.edu:8443/srm/v2/server -size 3000 -gsize 2000 -lifetime 1000 -userdesc mydesc
srm-sp-reserve -serviceurl srm://fndca1.fnal.gov:8443/srm/managerv2 -size 3000 -gsize 2000 -lifetime 1000 -userdesc mydesc
srm-sp-reserve -serviceurl srm://srm.unl.edu:8443/srm/managerv2 -size 3000 -gsize 2000 -lifetime 1000 -userdesc mydesc
srm-sp-reserve -serviceurl srm://srm.ihepa.ufl.edu:8443/srm/managerv2 -size 3000 -gsize 2000 -lifetime 1000 -userdesc mydesc
srm-sp-reserve -serviceurl srm://osg.hpcc.nd.edu:8443/srm/managerv2 -size 3000 -gsize 2000 -lifetime 1000 -userdesc mydesc
srm-sp-reserve -serviceurl srm://dcache07.unl.edu:8443/srm/v2/server -size 3000 -gsize 2000 -lifetime 1000 -userdesc mydesc
</verbatim>

---+++++ get_surl

For a given VO, constructs a SURL for each supporting site.

*Script Name*

get_surl

*Parameters*
%TABLE{ headerbg="#eeeeee" headercolor="#000000" databg="#ffffff" tableborder="1" columnwidths="120," cellpadding="2" cellspacing="1" dataalign="left" valign="top" sort="off"}%
| *name* | *definition* | *required* |
| vo | VO name | yes |
| storage_element_id | Unique ID of the Storage Element | no |

*Usage*

<verbatim>
get_surl --vo <VO Name> [--storage_element_id <GlueSEUniqueID>]
</verbatim>

*Example Output*
<verbatim>
[xquery]$ get_surl --vo engage
srm://abitibi.sbgrid.org:8443/srm/managerv2?SFN=/opt/osg-shared/se/data/vo/vo/engage/TESTFILE
srm://sigmorgh.hpcc.ttu.edu:49443/srm/v2/server.?SFN=/mnt/hep/TESTFILE
srm://cit-se2.ultralight.org:8443/srm/v2/server?SFN=/mnt/hadoop/osg/TESTFILE
srm://ff-se.unl.edu:8443/srm/v2/server?SFN=/panfs/panasas/CMS/data/engage/TESTFILE
srm://fndca1.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/usr/fermigrid/volatile/engage/TESTFILE
srm://osg-east.hms.harvard.edu:10443/srm/v2/server?SFN=/osg/storage/data/engage/TESTFILE
srm://dcache07.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/engage/TESTFILE
</verbatim>

---+++++ get_srmcp_cmd

For a given VO, prints a ssrm copy command line for each supporting site. The copy command client is the FNAL implmentation.

*Script Name*

get_srmcp_cmd

*Parameters*
%TABLE{ headerbg="#eeeeee" headercolor="#000000" databg="#ffffff" tableborder="1" columnwidths="120," cellpadding="2" cellspacing="1" dataalign="left" valign="top" sort="off"}%
| *name* | *definition* | *required* |
| vo | VO name | yes |
| space_token | Token from space reservation | no |

*Usage*

<verbatim>
get_srmcp_cmd --vo <VO name> [--space_token <Token from space reservation>]
</verbatim>

*Example Output*
<verbatim>
[xquery]$  get_srmcp_cmd --vo engage --space_token 12345
srmcp -srm_protocol_version=2 -space_token=12345 file:////path/to/file srm://abitibi.sbgrid.org:8443/srm/managerv2?SFN=/opt/osg-shared/se/data/vo/vo/engage/TESTFILE
srmcp -srm_protocol_version=2 -space_token=12345 file:////path/to/file srm://sigmorgh.hpcc.ttu.edu:49443/srm/v2/server.?SFN=/mnt/hep/TESTFILE
srmcp -srm_protocol_version=2 -space_token=12345 file:////path/to/file srm://cit-se2.ultralight.org:8443/srm/v2/server?SFN=/mnt/hadoop/osg/TESTFILE
srmcp -srm_protocol_version=2 -space_token=12345 file:////path/to/file srm://ff-se.unl.edu:8443/srm/v2/server?SFN=/panfs/panasas/CMS/data/engage/TESTFILE
srmcp -srm_protocol_version=2 -space_token=12345 file:////path/to/file srm://fndca1.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/usr/fermigrid/volatile/engage/TESTFILE
srmcp -srm_protocol_version=2 -space_token=12345 file:////path/to/file srm://osg-east.hms.harvard.edu:10443/srm/v2/server?SFN=/osg/storage/data/engage/TESTFILE
srmcp -srm_protocol_version=2 -space_token=12345 file:////path/to/file srm://dcache07.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/engage/TESTFILE
</verbatim>

---+++++ get_srm_copy_cmd

For a given VO, prints a ssrm copy command line for each supporting site. The copy command client is the LBL implmentation.

*Script Name*

get_srm_copy_cmd

*Parameters*
%TABLE{ headerbg="#eeeeee" headercolor="#000000" databg="#ffffff" tableborder="1" columnwidths="120," cellpadding="2" cellspacing="1" dataalign="left" valign="top" sort="off"}%
| *name* | *definition* | *required* |
| vo | VO name | yes |
| space_token | Token from space reservation | no |

*Usage*

<verbatim>
get_srm_copy_cmd --vo <VO name> [--space_token <Token from space reservation>]
</verbatim>


*Example Output*
<verbatim>
[xquery]$ get_srm_copy_cmd --vo engage --space_token 12345
srm-copy file:////path/to/file srm://abitibi.sbgrid.org:8443/srm/managerv2?SFN=/opt/osg-shared/se/data/vo/vo/engage/TESTFILE -spacetoken 12345
srm-copy file:////path/to/file srm://sigmorgh.hpcc.ttu.edu:49443/srm/v2/server.?SFN=/mnt/hep/TESTFILE -spacetoken 12345
srm-copy file:////path/to/file srm://cit-se2.ultralight.org:8443/srm/v2/server?SFN=/mnt/hadoop/osg/TESTFILE -spacetoken 12345
srm-copy file:////path/to/file srm://ff-se.unl.edu:8443/srm/v2/server?SFN=/panfs/panasas/CMS/data/engage/TESTFILE -spacetoken 12345
srm-copy file:////path/to/file srm://fndca1.fnal.gov:8443/srm/managerv2?SFN=/pnfs/fnal.gov/usr/fermigrid/volatile/engage/TESTFILE -spacetoken 12345
srm-copy file:////path/to/file srm://dcache07.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/engage/TESTFILE -spacetoken 12345
</verbatim>

---+++++ get_site_name

Returns a list of sites by name. The --vo option lists names of sites that authorize a Storage Element access for the specified VO. The --storage_element_id option lists the site name for a storage element with the given id.

*Script Name*

get_site_name

*Parameters*
%TABLE{ headerbg="#eeeeee" headercolor="#000000" databg="#ffffff" tableborder="1" columnwidths="120," cellpadding="2" cellspacing="1" dataalign="left" valign="top" sort="off"}%
| *name* | *definition* | *required* |
| vo | VO name | no* |
| storage_element_id  | Unique ID of Storage Element | no* |

*One of the two options must be specified.

*Usage*

<verbatim>
get_site_name --vo <VO name> | --storage_element_id <GlueSEUniqueID>
</verbatim>


*Example Output*
<verbatim>
[xquery]$ get_site_name --storage_element_id abitibi.sbgrid.org
SBGrid-Harvard-Exp
</verbatim>


---+++++ get_storage_element_id

Returns a list of IDs for Storage Elements on which the specified VO is authorized.

*Script Name*

get_storage_element_id

*Parameters*
%TABLE{ headerbg="#eeeeee" headercolor="#000000" databg="#ffffff" tableborder="1" columnwidths="120," cellpadding="2" cellspacing="1" dataalign="left" valign="top" sort="off"}%
| *name* | *definition* | *required* |
| vo | VO name | yes |


*Usage*

<verbatim>
get_storage_element_id --vo <VO name>
</verbatim>


*Example Output*
<verbatim>
[xquery]$ get_storage_element_id --vo ligo
abitibi.sbgrid.org
dcache07.unl.edu
osg-east.hms.harvard.edu
</verbatim>


---+++++ get_mount_info

Returns a Compute Element mount point for a Storage Element indicated by the Storage Element ID or by the site name.

*Script Name*

get_mount_info

*Parameters*
%TABLE{ headerbg="#eeeeee" headercolor="#000000" databg="#ffffff" tableborder="1" columnwidths="120," cellpadding="2" cellspacing="1" dataalign="left" valign="top" sort="off"}%
| *name* | *definition* | *required* |
| site_name | Name of site as specified in the Mds-Vo-name field of the GlueSE element "dn" attribute | no* |
| site_name | Unique ID of the Storage Element | no* |

*One of the two options must be specified.

*Usage*

<verbatim>
get_mount_info --site_name <Mds-Vo-name> | --storage_element_id <GlueSEUniqueID>

</verbatim>


*Example Output*
<verbatim>
[xquery]$ get_mount_info --storage_element_id abitibi.sbgrid.org
none
</verbatim>

The "none" output is the value from BDII. The value has not been set to a mount point.



-- Main.TedHesselroth - 08 Dec 2009

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = TedHesselroth 

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = Storage

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = EndUser

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = HowTo
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %NO%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %NO%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = TanyaLevshina
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %NO%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = FirstLast
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %NO%
############################################################################################################
-->