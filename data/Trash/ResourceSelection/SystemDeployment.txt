%META:TOPICINFO{author="KyleGross" date="1225985963" format="1.1" version="1.7"}%
%META:TOPICPARENT{name="WebHome"}%
---+ System Deployment and Integration

---+++ Quick links
ServiceReadiness for the OSG Integration Test Bed

---+++ General considerations
As of April 2006, the system is ready for deployment<br>
Our target is deploying the CEMon infrastructure to the sites on OSG v0.6.0<br>
<p>
We are collaborating with 
   * the VDT team to package CEMon and provide automatic configuration scripts
   * the ITB team to set up a pre-production system test bed
   * the TG-MIG to reuse components of the monitoring infrastructure e.g. the Generic Information Providers (GIP)
   * the OSG Executive Team to facilitate communication with the OSG community 
   * the Fermilab Administrators to set up the central !ReSS services (Information Gatherer and Match Making Service)
<p>
If the integration tests do not expose any major problems AND the OSG v0.6.0 release proceeds accroding to the original plans, the !ReSS infrastructure should become available in July 2006.

---+++ How to connect your Condor-G installation with ReSS

Typically, Condor-G is configured to run only the scheduling server (condor_schedd). In order for the scheduler to contact the resource selection service, one needs to change 3 parameters in the condor_schedd configuration.

After setting up the condor environment, the configuration file is generally available from the environment variable $CONDOR_CONFIG. Edit this file and add the fully qualified domain name of the central resource selection machine to the following parameters: 

<pre>
COLLECTOR_HOST  = central.resource.selection.machine
HOSTALLOW_NEGOTIATOR = central.resource.selection.machine
HOSTALLOW_NEGOTIATOR_SCHEDD = original_value, central.resource.selection.machine
</pre>

As of July 2006, the fully qualified domain name of the central resource selection machine is <b>osg-ress-1.fnal.gov</b>

Restart or issue a condor_reconfig command, in order for the changes to take place.

Jobs submitted to this condor_schedd should contact the resource selection service if their job description file (JDF) specifies

<pre>
universe = globus
globusscheduler = $$(GlueCEInfoContactString) 
</pre>

In order for the job to select a set of requirements on the cluster, one can write an expression for the "requirements" attribute of the JDF. 

<pre>
requirements = requirement_expression
</pre>

The syntax of the resource attributes is the same as the the LDIF representation of the GLUE Schema. An example of a valid requirement is

<pre>
requirements = TARGET.GlueHostNetworkAdapterInboundIP == TRUE
</pre>

To select resources based on the presence of a value from a list attribute (comma separated strings of values), one can use the function match_string. For example

<pre>
requirements = 
StringlistIMember("DZero-Application_v1_2";TARGET.GlueHostApplicationSoftwareRunTimeEnvironment) == TRUE 
</pre>

Also see this [[TestBedPrototype][report]] (WARNING: contains some obsolete information).


The following is a real resource ClassAd (created on Mar 28, 2007). Any attribute can be in principle used for Resource Selection.

<pre>
MyType = "Machine"
TargetType = "Job"
Name = "fermigrid1.fnal.gov:2119/jobmanager-condor-cms.-106083108"
GlueCEInfoContactString = "fermigrid1.fnal.gov:2119/jobmanager-condor"
CurMatches = 0
Requirements = (CurMatches < 10)
WantAdRevaluate = TRUE
ReSSVersion = "1.0.6"
GlueCEInfoApplicationDir = "/grid/app"
GlueHostProcessorModel = "Intel(R) Xeon(TM) CPU 3.60GHz"
GlueCEName = "cms"
GlueCEHostingCluster = "fermigrid1.fnal.gov"
GlueCEPolicyPriority = 0
GlueHostProcessorVendor = "GenuineIntel"
GlueHostProcessorClockSpeed = 1000
GlueSiteUniqueID = "fermigrid1.fnal.gov"
GlueCEStateFreeJobSlots = 8
GlueCESEBindWeight = 0
GlueSubClusterPhysicalCPUs = 1
GlueCEStateEstimatedResponseTime = 0
GlueHostNetworkAdapterInboundIP = FALSE
GlueCEInfoDefaultSE = "FNAL_FERMIGRID_SE"
GlueSubClusterWNTmpDir = "/local/stage1"
GlueSchemaVersionMinor = 2
GlueCEStateStatus = "Production"
GlueCEInfoHostName = "fermigrid1.fnal.gov"
GlueCEStateTotalJobs = 0
GlueInformationServiceURL = "ldap://is.grid.iu.edu:2170/mds-vo-name=FNAL_FERMIGRID,mds-vo-name=OSG,o=grid,ldap://is.grid.iu.edu:2170/mds-vo-name=FNAL_FERMIGRID,mds-vo-name=OSG,o=grid,ldap://is.grid.iu.edu:2170/mds-vo-name=FNAL_FERMIGRID,mds-vo-name=OSG,o=grid"
GlueCESEBindMountInfo = "none"
GlueCEAccessControlBaseRule = "VO:cms"
GlueHostOperatingSystemVersion = "Wilson"
GlueSchemaVersionMajor = 1
GlueCEStateWaitingJobs = 0
GlueClusterService = "fermigrid1.fnal.gov"
GlueCEPolicyMaxRunningJobs = 0
GlueCEInfoGatekeeperPort = 2119
GlueCEPolicyMaxTotalJobs = 0
GlueCEInfoLRMSVersion = "6.8.4"
GlueClusterUniqueID = "fermigrid1.fnal.gov"
GlueCEInfoTotalCPUs = 8
GlueSiteLongitude = "-88.2546"
GlueClusterName = "fermigrid1.fnal.gov"
GlueHostBenchmarkSI00 = 400
GlueCEInfoLRMSType = "condor"
GlueCEStateFreeCPUs = 0
GlueCEStateWorstResponseTime = 0
GlueHostNetworkAdapterOutboundIP = TRUE
GlueCEPolicyMaxWallClockTime = 6000
GlueSubClusterName = "fermigrid1.fnal.gov"
GlueHostMainMemoryVirtualSize = 1024
GlueHostArchitectureSMPSize = 2
GlueHostApplicationSoftwareRunTimeEnvironment = "MountPoints,SAMPLE_LOCATION,SAMPLE_SCRATCH,VO-cms-CMSSW_1_2_3"
GlueHostMainMemoryRAMSize = 512
GlueSiteLatitude = "41.8412"
GlueSubClusterLogicalCPUs = 2
GlueCEInfoJobManager = "condor"
GlueSiteName = "FNAL_FERMIGRID"
GlueHostBenchmarkSF00 = 380
GlueHostOperatingSystemRelease = "4.4"
GlueCEUniqueID = "fermigrid1.fnal.gov:2119/jobmanager-condor-cms"
GlueCEPolicyAssignedJobSlots = 8
GlueCEInfoDataDir = "/grid/data"
GlueCEPolicyMaxCPUTime = 6000
GlueHostOperatingSystemName = "ScientificFermiLTS"
GlueCEStateRunningJobs = 0
GlueSubClusterTmpDir = "/grid/data"
GlueSubClusterUniqueID = "fermigrid1.fnal.gov"
TTLCEinfo = 300
StartdIpAddr = "<131.225.110.152:0>"
MyAddress = "<131.225.110.152:0>"
LastHeardFrom = 1175099079
UpdatesTotal = 1381
UpdatesSequenced = 0
UpdatesLost = 0
UpdatesHistory = "0x00000000000000000000000000000000"
</pre>


Note that a few sites still use this old format (created on Aug 15, 2006), without Site information.
<pre>
MyType = "Machine"
TargetType = "Job"
Name = "cmssrv09.fnal.gov:2119/jobmanager-condor-atlas.cmssrv09.fnal.gov.cmssrv09.fnal.gov"
GlueCEInfoContactString = "cmssrv09.fnal.gov:2119/jobmanager-condor"
GlueCEInfoApplicationDir = "/storage/local/data1/osg-ce/OSG.DIRS/app"
GlueHostProcessorModel = "Intel(R) Xeon(TM) CPU 2.80GHz"
GlueCEName = "atlas"
GlueCEHostingCluster = "cmssrv09.fnal.gov"
GlueCEPolicyPriority = 0
GlueHostProcessorVendor = "GenuineIntel"
GlueHostProcessorClockSpeed = 1000
GlueCEStateFreeJobSlots = 0
GlueCESEBindWeight = 0
GlueSubClusterPhysicalCPUs = 1
GlueCEStateEstimatedResponseTime = 0
GlueHostNetworkAdapterInboundIP = FALSE
GlueCEInfoDefaultSE = "cmssrv09.fnal.gov"
GlueSubClusterWNTmpDir = "/storage/local/data1/osg-ce/OSG.DIRS/wn_tmp"
GlueSchemaVersionMinor = 2
GlueCEStateStatus = "Production"
GlueCEInfoHostName = "cmssrv09.fnal.gov"
GlueCEStateTotalJobs = 0
GlueInformationServiceURL = "ldap://cmssrv09.fnal.gov:2135/mds-vo-name=local,o=grid,ldap://cmssrv09.fnal.gov:2135/mds-vo-name=local,o=grid,ldap://cmssrv09.fnal.gov:2135/mds-vo-name=local,o=grid"
GlueCESEBindMountInfo = "none"
GlueCEAccessControlBaseRule = "VO:atlas"
GlueHostOperatingSystemVersion = "4.0"
GlueSchemaVersionMajor = 1
GlueCEStateWaitingJobs = 0
GlueClusterService = "cmssrv09.fnal.gov"
GlueCEPolicyMaxRunningJobs = 0
GlueCEInfoGatekeeperPort = 2119
GlueCEPolicyMaxTotalJobs = 0
GlueCEInfoLRMSVersion = "6.7.20"
GlueClusterUniqueID = "cmssrv09.fnal.gov"
GlueCEInfoTotalCPUs = 4
GlueClusterName = "cmssrv09.fnal.gov"
GlueHostBenchmarkSI00 = 400
GlueCEInfoLRMSType = "condor"
GlueCEStateFreeCPUs = 0
GlueCEStateWorstResponseTime = 0
GlueHostNetworkAdapterOutboundIP = TRUE
GlueCEPolicyMaxWallClockTime = 6000
GlueSubClusterName = "cmssrv09.fnal.gov"
GlueHostMainMemoryVirtualSize = 1024
GlueHostArchitectureSMPSize = 2
GlueHostApplicationSoftwareRunTimeEnvironment = "OSG-0.5.0,MountPoints,SAMPLE_LOCATION,SAMPLE_SCRATCH"
GlueHostMainMemoryRAMSize = 512
GlueSubClusterLogicalCPUs = 2
GlueCEInfoJobManager = "condor"
GlueHostBenchmarkSF00 = 380
GlueHostOperatingSystemRelease = "Rocks Linux"
GlueCEUniqueID = "cmssrv09.fnal.gov:2119/jobmanager-condor-atlas"
GlueCEPolicyAssignedJobSlots = 4
GlueCEInfoDataDir = "/storage/local/data1/osg-ce/OSG.DIRS/data"
GlueCEPolicyMaxCPUTime = 6000
GlueHostOperatingSystemName = "linux-rocks-4.0"
GlueCEStateRunningJobs = 0
GlueSubClusterTmpDir = "/storage/local/data1/osg-ce/OSG.DIRS/data"
GlueSubClusterUniqueID = "cmssrv09.fnal.gov"
TTLCEinfo = 300
StartdIpAddr = "<131.225.110.152:0>"
MyAddress = "<131.225.110.152:0>"
LastHeardFrom = 1155673644
UpdatesTotal = 98
UpdatesSequenced = 0
UpdatesLost = 0
UpdatesHistory = "0x00000000000000000000000000000000"
</pre>

-- Main.GabrieleGarzoglio - 03 Apr 2006