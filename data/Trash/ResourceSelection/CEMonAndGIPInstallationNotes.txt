%META:TOPICINFO{author="ForrestChristian" date="1166039507" format="1.1" version="1.15"}%
%META:TOPICPARENT{name="WebHome"}%
%TOC%
---++ Instructions to install CEMon on an OSG v0.4.1 and v0.5.0 installation
---+++ Introduction
This document is intended for administrators responsible for supporting ITB Compute Element (CE) version 0.4.1 onto OSG Integration Resources. We assume that an administrator is already familiar with the installation and configuration procedure described in [[http://osg.ivdgl.org/twiki/bin/view/Integration/OSGCEInstallGuide][OSG Installation Guide]]. 

Our goal is to describe some additional steps that need to be performed in order to install and configure the newest [[http://grid.pd.infn.it/cemon/field.php][CEMonitor  service]]  from VDT 1.4.0 on top of existing OSG CE 0.4.1 installation.  

This service is capable of collecting the CE resource information by using [[http://lfield.home.cern.ch/lfield/cgi-bin/wiki.cgi?area=gip&page=documentation][Generic Information Provider]] (GIP).
A properly installed and configured CEMonitor service pushes collected information in classad format to central [[http://osg.ivdgl.org/bin/view/ResourceSelection/WebHome][Information Gatherer]] (IG) running on designated host (osg-ress-1.fnal.gov). IG advertises these classads to [[http://www.cs.wisc.edu/condor][Condor Match Maker]] service.  

---+++  Initial assumptions
We assume that OSG CE 0.4.1 software has been installed on the node and the following products are installed and properly configured:
   * Job Management software (condor, pbs or lsf)
   * GIP
We also assume that apache and tomcat are ==not== installed on the CE node.
(If they are, just stop them before you do the steps below and the new apache/tomcat that come with this package will replace them.)


---+++  Installation method
The installation method is based on Pacman. You will need to install the latest pacman version somewhere on your machine (make sure that the version is equal or greater 3.18.5).

<b><i>wget http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-latest.tar.gz</i></b>
<pre>
&gt; tar zxf  pacman-latest.tar.gz
<i><b>cd to the untared directory </i></b>
&gt; source setup.sh
</pre>
These are our internal documentation of how to install CEMon and GIP for an OSG environment.

---+++  Pre-install steps
Make sure that you have host and http service certificates on the server you are planning to install cemon: 
   *  The host certificate should be installed in /etc/grid-security with ownership and permissions as: <br>
              -rw-r--r--  root   root     hostcert.pem<br> 
              -r--------    root   root    hostkey.pem 
   * http certificate: Used by apache and tomcat. The http certificate for your system should be installed in /etc/grid-security/http with ownership and permission as: <br>
              -rw-r--r--  daemon daemon  httpcert.pem <br>
              -r--------    daemon daemon httpkey.pem



---+++  Installation 
These instructions are for installing CEMon in your existing OSG CE 0.4.1 VDT_LOCATION:
<OL type="a">

<LI>Install CEMon  from VDT 1.4.0
<pre>
&gt; cd $VDT_LOCATION
&gt; pacman -get http://vdt.cs.wisc.edu/vdt_140_cache:CEMon
<b><i>.... questions ....</b></i>
Do you want to add [http://vdt.cs.wisc.edu/vdt_140_cache] to [trusted.caches]? (y or n): <b><i>y</b></i>   .... may or may not be asked
Do you agree to the licenses? [y/n] <b><i>y</b></i>... may or may not be asked
  :
Where would you like to install CA files? <b><i>n</b></i>... may or may not be asked
  :
Would you like to setup daily rotation of VDT log files? <b><i>y</b></i>... may or may not be asked
  :
Would you like to enable the CEMon server to run automatically? <b><i>y</b></i>
  :
If you would like, we can configure the Globus GRIS (MDS) to start automatically at boot time? <b><i>s</b></i>... may or may not be asked
  :
Would you like CRL to be updated automatically ? <b><i>n</b></i>... may or may not be asked
  :
<b><i>.... the following should be the last lines of the installation....</b></i>
Downloading [cemon-client-1.7.2-x86_rhas_3.tar.gz] from [http://vdt.cs.wisc.edu/software//glite-ce-monitor/1.7.2]...
Reading database...
   0    10   20   30   40   50   60   70   80   90   100
   +----+----+----+----+----+----+----+----+----+----+  
   ###################################################    
Reading database...
   0    10   20   30   40   50   60   70   80   90   100
   +----+----+----+----+----+----+----+----+----+----+  
   ###################################################    
</pre>

<LI>Apache and tomcat have been configured and should have been started automatically at this time. 

<LI>In order to properly configure CEMon consumer (IG)  subscription execute the following command:
<pre>
&gt; cd $VDT_LOCATION
&gt; source setup.sh
&gt; $VDT_LOCATION/vdt/setup/configure_cemon \
              --consumer https://osg-ress-1.fnal.gov:8443/ig/services/CEInfoCollector  \
              --dialect OLD_CLASSAD   \
              --topic OSG_CE
</pre>

<LI>Modify the GIP wrapper script to execute collector.<br>
Open file  $VDT_LOCATION/glite/etc/glite-ce-ce-plugin/glite-ce-info in your favorite editor and modify to look like the following:
<pre> 
#!/bin/sh
export LANG=C
VDT_LOCATION/lcg/bin/lcg-info-generic  VDT_LOCATION/lcg/etc/osg-info-generic.conf

<b><i>.... Where VDT_LOCATION is a root directory of your CE.0.4.1 installation.  
Expand out the value of VDT_LOCATION to the path that it is.</b></i>
</pre>
</OL>


---+++ Installation Verification
At this time apache, tomcat and CEMon  should be up and running. You can check cemon log file that is located $VDT_LOCATION/tomcat/v5/logs/glite-ce-monitor.log. You can also verify that cemon is started by accessing it via your browser (your certificate should be imported into your browser).  
   * Use the following url:<br>
       https://&lt;host&gt;:8443/ce-monitor/services/CEMonitor?method=GetInfo<br> 
        If your DN is not in the /etc/grid-security/grid-mapfile you will see the following [[%ATTACHURL%/exception.GIF][information on the page]]
   * If you upload your certificate into to your browser and add certificate subject (DN) to a /etc/security/grid-mapfile, you could get back [[%ATTACHURL%/cemon-topic.GIF][meaningful information about topics and dialects]] that CEMonitor supports.
   * You can verify that CEMonitor started reporting to IG by checking  $VDT_LOCATION/tomcat/v5/log/glite-ce-monitor.log. You should see:
        <br><i>%ORANGE%&#8230;.org.glite.security.trustmanager.CRLFileTrustManager - Client CN=osg-ress-1.fnal.gov, OU=Services, DC=doegrids, DC=org accepted%ENDCOLOR%</i><br>
         each time CEMonitor pushes  information to Information Gatherer.
   * You can also run<br>
           __condor_status -pool osg-ress-1.fnal.gov -l -constraint "GlueCEInfoHostName == \"YOUR_HOST_NAME\""__ <br>
           to check what information your CE is advertising.

---------------------------------------------
---++ Instructions for ITB v0.5.1
The instructions for installing in ITB 0.5.n can be found in the [[Integration.CEInstallGuide050#CEmon][OSG 0.5.n CE Installation Guide]].

---------------------------------------------

---++ Old Documentation
      * Feb 07, 2006: [[%ATTACHURL%/CEMonAndGIPInstallation.pdf][CEMonAndGIPInstallation.pdf]]: 
      * Jun 28, 2006: [[%ATTACHURL%/CEMONinstallationandconfigurationprocedure_1.7.21.pdf][CEMONinstallationandconfigurationprocedure_1.7.21.pdf]]. Same in TWiki format: Integration.ITB_0_5.CEMonInstallationConfigurationGuide
-- Main.GabrieleGarzoglio - 07 Feb 2006

 

  

%META:FILEATTACHMENT{name="exception.GIF" attr="" autoattached="1" comment="" date="1157485912" path="exception.GIF" size="22304" user="Main.TanyaLevshina" version="2"}%
%META:FILEATTACHMENT{name="cemon-0.5.0.pdf" attr="" autoattached="1" comment="" date="1157055336" path="cemon-0.5.0.pdf" size="118188" user="Main.GabrieleGarzoglio" version="1"}%
%META:FILEATTACHMENT{name="cemon-topic.GIF" attr="" autoattached="1" comment="" date="1157486296" path="cemon-topic.GIF" size="41377" user="Main.TanyaLevshina" version="1"}%
%META:FILEATTACHMENT{name="CEMonAndGIPInstallation.pdf" attr="" autoattached="1" comment="" date="1139355300" path="CEMonAndGIPInstallation.pdf" size="22543" user="GabrieleGarzoglio" version="1.1"}%
%META:FILEATTACHMENT{name="CEMONinstallationandconfigurationprocedure_1.7.21.pdf" attr="" autoattached="1" comment="" date="1151509155" path="CEMONinstallationandconfigurationprocedure_1.7.21.pdf" size="90761" user="GabrieleGarzoglio" version="1.1"}%
%META:FILEATTACHMENT{name="cemon-0.4.1.pdf" attr="" autoattached="1" comment="" date="1157055315" path="cemon-0.4.1.pdf" size="188303" user="Main.GabrieleGarzoglio" version="1"}%
