%META:TOPICINFO{author="KyleGross" date="1225985945" format="1.1" version="1.13"}%
%META:TOPICPARENT{name="WebHome"}%
%LINKCSS%
---+!! Using the srmcp SRM Client 
%TOC%
%STARTINCLUDE%

---++ Introduction
  
     The SRM client tools are an optional module in the OSG Cache.
     The SRM Shell-tool client provides a command line interface to the SRM V1.1  standard. 
     The package is supported for the standard interfaces to the dCache, DRM and Castor implementations of SRM.

---++ Latest Version
See the [[https://srm.fnal.gov/twiki/bin/view/SrmProject/SrmcpClient][srmcp SRM Client page]].

---++ Installation Instructions
     Assuming the installation directory is $VDT_LOCATION- follow the steps below: 

<pre class="screen">
> <b>cd $VDT_LOCATION</b>
> <b>pacman -get iVDGL:srm-cp</b>
   Do you want to add [http://hep.uchicago.edu/ivdgl/] to [trusted.caches]? (y or n): <b>y</b>
   Package [srm-cp] found in [http://hep.uchicago.edu/ivdgl/]...
   Downloading [srmclient.tar.gz] from [hep.uchicago.edu]...
   6/6 MB downloaded...
   Untarring [srmclient.tar.gz]...
> <b>ls</b>
   cert-scripts  gpt        MIS-CI                   perl          trusted.caches     vdt-questions.sh
   condor        gums       MonaLisa                 post-install  vds                verify
   edg           jdk1.4     monitoring               prima         vdt                voms
   expat         lcg        o..pacman..o             setup.csh     vdt-app-data
   ftsh          licenses   OSGv0.1.6-release.notes  setup.sh      vdt-install.log
   globus        logrotate  osg-version              srmclient     vdt-questions.csh
</pre>
<pre class="screen">
tam01.fnal.gov> <b>source setup.sh </b>
tam01.fnal.gov> <b>which srmcp</b>
   /gfs0/osg/osg-software/srmclient/bin/srmcp
</pre>

%NOTE% The install creates a directory _srmclient_ under the $VDT_LOCATION. It also adds few lines in the =$VDT_LOCATION/setup.sh= and =$VDT_LOCATION/setup.csh= scripts to include srmclient binaries in $PATH.

---++ [[http://www.dcache.org/manuals/Book/cmd-srmstage.shtml][srmstage]] Command
    This command provides an option to the user to stage files from enstore to dcache and not transfer them right away. 
    This case will be useful if files are not needed right away at user end, but its good to stage them to dcache for faster access later. 

---+++ Usage:
<pre>srmstage srm-url [[srm-url] ... ]</pre>

---++ Command Line Options
     The following command line options are available
   * gss_expected_name
   * globus_tcp_port_range
   * streams_num
   * server_mode</pre>

%NOTE% Run =srmcp --help= for listing other available options.

---+++ globus_tcp_port_range
     To specify a range of ports open for tcp connections as a pair of positive integers separated by ",", not set by default
     This takes care of compute nodes that are behind firewall.

---+++ gss_expected_name
     To specify the gss expected name in the srm server DN, default value is host. 
     eg: If the CN of host where srm server is running is _CN=srm/tam01.fnal.gov_, then it should be _"srm"_

---+++ streams_num
     To specify the number of streams to be used for data transfer. 
     If set to 1, then _stream mode_ is used, otherwise _extended block mode_ is used. 

---+++ server_mode
     To set the (gridftp) server mode for data transfer. Can be _active_ or _passive_, _passive_ by default. 
     This option will have effect only if transfer is performed in a stream mode (see _streams_num_)

---++ Examples
<pre>
  srmcp -debug file://localhost//home/s1/neha/test/aaa srm://t2data2.sdsc.edu:8443/data/osgtest/1/file1
  
  srmcp -debug file:////home/s1/neha/rf-changelog.xml-ori srm://fledgling06.fnal.gov:8443//srm/managerv1?SFN=/pnfs/fnal.gov/litvinse/NULL/neha/test
  
  srmcp -debug srm://fledgling06.fnal.gov:8443//srm/managerv1?SFN=/pnfs/fnal.gov/litvinse/NULL/neha/test file:////home/s1/neha/test2
  
  srmcp -debug srm://fledgling06.fnal.gov:8443//srm/managerv1?SFN=/pnfs/fnal.gov/litvinse/NULL/neha/test srm://fledgling05.fnal.gov:8443//srm/managerv1?SFN=/pnfs/fnal.gov/data/neha/test3
  
  srmcp --streams_num=1 --server_mode=active source-url destination-url 
</pre>

---++ Recent Improvements and Fixes in srmcp

   * *More robust 'srm' script*. In previous versions, srm script assumes that 'java' exists and is in the user $PATH. In this current version, script looks for java in various standard locations and under $JAVA_HOME if defined. In case of multiple java versions found, the most recent version is selected.
   * *Reliable srmcp return codes*. The return code is "0" only if all individual file transfers are successful. In case of any failure, the return code is "1". 

---++Certificate access 
    The worker node on which srmcp is run must be able to access the certificates directory. Thus, service certificates will need to be installed previously and maintained, or you must copy them to the worker node together with the other job-specific files.

    You may install certificates into =$VDT_LOCATION/globus/share/certificates=. However, this forces you to maintain the certificate revocation list (CRL) by hand, as  the edg-crl-upgrade scripts (which are part of VDT) are hardcoded to point to =/etc/grid-security/certificates=.

---++ Frequently Asked Questions
   
__How does user know which gss_expected_name is to be used?__
The way srmclient works now,the user has to know in advance.This is not a time consuming job.
Its very easy to find out whether the DN is of form =host/...= or =srm/...= or =blah/...=

_Yes, the user has to know in advance, but how does user find out from where?I don't think the DN itself of SRM is published, but only the service handles._

The way that I know is for user to issue one test srmcp command. _For example:_ If I run command like:
<verbatim>
srmcp -debug --gss_expected_name=srm srm://fledgling06.fnal.gov:8443//srm/managerv1?SFN=/pnfs/fnal.gov/litvinse/NULL/neha/test 
file:////home/s1/neha/test2
</verbatim>

__I get following error message__ 
<verbatim>
SRMClientV1 : org.globus.common.ChainedIOException: Authentication failed [Caused by: Operation unauthorized (Mechanism level: Authorization failed. 
  Expected "/CN=srm/fledgling06.fnal.gov" target but received "/DC=org/DC=doegrids/OU=Services/CN=host/fledgling06.fnal.gov")]
</verbatim>

which tells me that I need to use 'host' as the 'gss_expected_name'. So the correct command would be: 

<verbatim>
srmcp -debug srm://fledgling06.fnal.gov:8443//srm/managerv1?SFN=/pnfs/fnal.gov/litvinse/NULL/neha/test file:////home/s1/neha/test2
</verbatim>

because by default - gss_expected_name is 'host'.

---++ See Also 
Further information on srmcp SRM Client tools can be found in the following:
   * "[[http://www.fnal.gov/docs/products/enstore/usingdcache.html#56262][Using dCache]]" from the Enstore manual
   * [[http://srm.fnal.gov/][Fermilab SRM Project]]
   * [[https://srm.fnal.gov/twiki/bin/view/SrmProject/SrmcpClient][Latest srmcp SRM client downloads]]
   * [[http://sdm.lbl.gov/srm-wg/index.html][SRM interface definition]]

---++ Support

    This is supported by the SRM-dCACHE team. For the short term requests for information and support should go to osg-int@opensciencegrid.org

    Support for such a component needs a triage structure, since the SRM support group does not have the resources to support 
    diagnosis of the end to end problems that occur in the use of an SRM client<->SRM server<->storage service (SE). 
    Our proposal, for discussion, is the following:

   * VirtualOrganizations/VOInfo support is the first level contact
   * SE resource provider is the second level contact
   * SRM client package provider is the third level contact &mdash; at the moment this is osg-int@opensciencegrid.org

%STOPINCLUDE%
---++!! Backlinks
%WHU%

---++!! Major Updates
<!-- For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

<!--Future editors should add their signatures beneath yours!-->
-- Main.RuthPordes - 07 Apr 2005 %BR%
-- Main.NehaSharma - 01 Feb 2006 %BR%
-- Main.ForrestChristian - 14 Nov 2006: reformatting %BR%