%META:TOPICINFO{author="KyleGross" date="1225985945" format="1.1" version="1.7"}%
%META:TOPICPARENT{name="ValidationPageRel01"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>%TOPIC%
%TOC%
%STARTINCLUDE%


---++Introduction
This is record of full chain of authentication with
voms-proxy-init and extended proxies.

---++Test by Steve Timm

PRIMA new version as released this morning
GUMS existing version as installed by J. Weigand on cmssrv08
voms-proxy-init as installed from vdt1.3.5
voms-proxy-init -voms uscms:/uscms/hipt
(Using my grid cert which is member of uscms vo with
privilege in all groups).
site_verify.pl --host fnpcg.fnal.gov
(This tests gridftp, jobmanager-fork, jobmanager-condor)
It worked, mapped me to user uscms35 as it should,
passed site_verify.pl)

---++Test by Xin Zhao

Here are the tests I do with the BNL VirtualOrganizations/VOInfoMS/GUMS/PRIMA setup:

1) I make a file ~/.edg/vomses, which looks like:


# "nickname" "host" "port" "hostcert's dn" "vo" "globus version (of the server to contact)"
#"wpsix" "gppvom06.gridpp.rl.ac.uk" "50001" "gppvom06.gridpp.rl.ac.uk" "wpsix" "22"
"atlas" "cmssrv08.fnal.gov" "15051" "/DC=org/DC=doegrids/OU=Services/CN=cmssrv08.fnal.gov" "atlas" "22"
"cern1" "tbed0152.cern.ch" "15001" "/C=CH/O=CERN/OU=GRID/CN=host/tbed0152.cern.ch" "atlas" "22"
"cern2" "lxb2094.cern.ch" "15001" "/C=CH/O=CERN/OU=GRID/CN=host/voms.cern.ch" "atlas" "22"
"bnl" "vo.racf.bnl.gov" "15003" "/DC=org/DC=doegrids/OU=Services/CN=vo.racf.bnl.gov" "atlas" "22"
"dteam" "voms.cern.ch" "15004" "/C=CH/O=CERN/OU=GRID/CN=host/voms.cern.ch" "dteam" "22"
"VDT" "vdt-rhas3-ia32.cs.wisc.edu" "15000" "/DC=org/DC=doegrids/OU=Services/CN=vdt-rhas3-ia32.cs.wisc.edu" "VDT"

2) get VDT-Client

   pacman -get http://www.cs.wisc.edu/vdt/vdt_135_cache:VDT-Client

3) source the setup file in VDT-Client dir

4) Try to create proxy with different attributes/role and authenticate
   to the BNL_OSG_test1 gatekeeper, which uses prima module and BNL GUMS:


[xzhao@atlasprod3 ~]$ voms-proxy-init -voms bnl:/atlas/Role=production

Your identity: /DC=org/DC=doegrids/OU=People/CN=Xin Zhao 102397

Enter GRID pass phrase:

Creating temporary proxy .................................... Done

Contacting  vo.racf.bnl.gov:15003 [/DC=org/DC=doegrids/OU=Services/CN=vo.racf.bnl.gov] "atlas" Done

Creating proxy ................................................. Done

Your proxy is valid until Fri Apr 22 00:17:34 2005

 
[xzhao@atlasprod3 ~]$ globus-job-run atestgk01.usatlas.bnl.gov /bin/pwd

/direct/usatlas+grid/u/usatlas1

[xzhao@atlasprod3 ~]$ voms-proxy-init

Your identity: /DC=org/DC=doegrids/OU=People/CN=Xin Zhao 102397

Enter GRID pass phrase:

Creating proxy ......................................... Done

Your proxy is valid until Fri Apr 22 00:17:59 2005
 
[xzhao@atlasprod3 ~]$ globus-job-run atestgk01.usatlas.bnl.gov /bin/pwd

/direct/usatlas+grid/grid0124

5) Use the role based proxy to anthenticate to a Grid3 style (no GUMS) gatekeeper:

[xzhao@atlasprod3 ~]$ globus-job-run agridgk01.usatlas.bnl.gov /bin/pwd

/direct/usatlas+grid/u/usatlas1

This simple test shows it works. 

---++Test by Greg Cross

This outlines what I did for GUMS configuration (without local VirtualOrganizations/VOInfoMS):

1. Followed the "Install GUMS" and "OSG-ITB gums.config groupmappings" guidelines which are now outlined in GumsAdmin.  (I.e., the VirtualOrganizations/VOInfoMS servers for each group is according to the example gums.config.)

2. Changed wildcard='*.*.uchicago.edu' for hostGroup.

3. Started up tomcat-5 and apache through /etc/init.d.

4. Tested forward and reverse mapping through the GUMS web administration interface.  

5. Once GUMS was validated as functional, the next step was to install the PRIMA module according to [https://plone3.fnal.gov/opensciencegrid/techgroups/tg-policy/vo-privilege/prima-authz-module-setup-in-vdt].  In /etc/grid-security/prima-autz.conf, imsContact was set to https://grid03.uchicago.edu:8443/gums/services/GUMSAuthorizationServicePort .

6. Manually tested the gums-host cron job to manually pull the maps from the defined VirtualOrganizations/VOInfoMS.  There were a couple of changes that needed to be made:

   * defined VDT_LOCATION before MAPFILE
   * changed GUMSDIR to $VDT_LOCATIOn/gums
   * sourced the setup.sh file before the "if ["$VDT_LOCATION" ... ]" line, as java was not found otherwise

7. Checked timestamp on /etc/grid-security/grid-mapfile to verify the cron job.

8. Successfully executed a standard globus-job-run with my usatlas-mapped DN.
<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.StevenTimm - 15 Apr 2005

-- Main.GregCross - 21 Apr 2005

%STOPINCLUDE%