%META:TOPICINFO{author="AnneHeavey" date="1187829124" format="1.1" reprev="1.26" version="1.26"}%
%META:TOPICPARENT{name="CEInstallGuide"}%
%LINKCSS%

---+!!<nop>OSG CE Authorization
%TOC%
%STARTINCLUDE%

---+ Authorization on your CE
%EDITTHIS%

In the CE install guide, the initial test case only authorizes yourself as a local user.  You should now authorize other users before performing the *OSG Registration* of your service (otherwise no one but you will be able to access it!). Do this before doing the rest of the monitoring configuration steps in the CE install guide, otherwise you may  have to repeat the steps later, particularly if your site is using GUMS.

The Authorization mode determines who can access your resources and how. OSG supports three of the [[[[http://grid.racf.bnl.gov/GUMS/guide_architecture.html#GUMS_in_the_grid_architecture][available GUMS authorization scenarios]]: _Grid3/Local_, _Compatibility_, and _Full Privilege_. All three use VOMS. 

The flowchart below will help you decide what kind of configuration you should set up.
<pre class="programlisting">
            
  ---------------------------------                    
  | Is your site going to support |    YES  
  |  role-based authorization?    |------------> <a href="#Full_Privilege_Configuration">Full privilege configuration</a>
  ---------------------------------                   
                 |                                           
              NO |
                 |
  ---------------------------------               
  | Do you want to use account    |     YES    
  |    pools at your site?        |------------> <a href="#Compatibility_Mode_Configuration">Compatibility configuration</a>
  ---------------------------------  
                 |                                           
              NO |
                 |
  ---------------------------------   
  |   Would you like to use one   |     YES 
  |    gridmap file to control    |------------> <a href="#Compatibility_Mode_Configuration">Compatibility configuration</a>
  |      all your gatekeepers?    |               
  ---------------------------------               
                 |
              NO |
                 |
                 V
     <a href="#Grid3_or_Local_configuration">Grid3/Local configuration</a>

</pre>

We'll present the "how to" information in order of simplest (Grid3) to most sophisticated (full privilege) so that you can implement step-by-step and test as you go, if you like.

---++ Brief explanation of each
%NOTE% In order to run in Compatibility or Full Privilege mode, a GUMS server must be installed at your site. Installation and configuration instructions are available from [[http://vdt.cs.wisc.edu/releases/1.8.0/gums.html][VDT]] and the [[https://www.racf.bnl.gov/Facility/GUMS/1.2/][GUMS web site]].  %RED%What about our gums install guide in the rel doc?%ENDCOLOR%

For some background information, see [[Documentation/UserAuthAndPrivilege][An Introduction to User Authorization and Privilege in OSG]].

---+++ <nop>Grid3 or local <nop>GridMap file
Authorization is performed only via the <i>grid-mapfile</i> on the Compute Element (CE) node. 

The grid-mapfile is either created manually on each CE node, or created using the <i>edg-mkgridmap</i> root cron entry based upon the =edg-mkgridmap.conf= configuration file in =$VDT_LOCATION/edg/etc=. This file is installed by the VO package which can be updated to add or update VO information. The OSG Operations sends update announcements to each support center.  VOMS is used; GUMS is not used. 

Synchronizing all the <i>grid-mapfiles</i> for multiple CE nodes needs to be done manually in this case.  You may prefer this configuration if:
   * You are a small site (one gatekeeper) and,
   * You deal with a small set of fairly static VOs
   * You are <b>not</b> supporting <i>role-based</i> authorizations (voms proxies with extended attributes)

---+++ Compatibility
Authorization is performed via the grid-mapfile on the gatekeeper, and the file is created by GUMS.  

GUMS polls VOMS Admin periodically and creates/updates the grid-mapfile. If the site has only one GUMS server (one communication point to VOMS), centralized mapping is enabled. Given the GUMS configuration options, account pools (many accounts, one-to-one DN-to-account mapping) can be implemented as well as group accounts (many-to-one DN-to-account mapping).  You should consider this configuration if:
   * Your gatekeeper(s) or service must be configured using a grid-mapfile (i.e., you have tools or services that manipulate this file directly, without passing through globus)
   * You'd rather approach with caution than jump right into running GUMS 24/7.

<a name="FullPrivilegeMode"/a>
---+++ Full Privilege (role-enabled) 
This scenario implements the PRIMA authorization module with GUMS and does not use the grid-mapfile.  The gatekeeper uses a callout to PRIMA upon receipt of each request, PRIMA forwards the request to the GUMS web service which performs the dynamic mapping. PRIMA can process <span class="firstterm">Fully Qualified Attribute Names (FQAN)</span>, thus enabling mapping based on VO groups and roles as defined in VOMS. 

<a name="GUMSInstallation"/a>
---++ Changes effective with this release
%RED%Don't we want to cluster "changes" into the "CE changes for this release" doc? and link from here?%ENDCOLOR%

---+++ edg-mkgridmap
Prior to this release, the =edg-mkgridmap= script ran as a system service and installed in =/etc/init.d=. With this release, it is being installed as a <i>root</i> crontab entry.  If you are upgrading from a prior release, you must <i>stop</i> the <i>edg-mkgridmap</i> daemon and delete that entry from system services.

%NOTE% =edg-mkgridmap= is not installed/configured by default.

---++ Identify the OSG VOs your CE node supports and any undefined UNIX accounts
Beginning with OSG 0.6.0, you can verify that your authorization service supports all the intended VOs and that all the necessary UNIX accounts exist on your CE node.  See [[OsgSupportedVos][Supported VOs and Undefined UNIX Accounts]].

---++ Implement the Authorization of your choice
We point you off to a separate page for each option:
   * [[OsgCEAuthGrid3][Grid3/Local]]
   * [[OsgCEAuthCompatibility][Compatibility]]
   * [[OsgCEAuthFullPriv][Full Privilege]]


%STOPINCLUDE%


%WHU%

<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

---++!! Major updates
<!--Future editors should add their signatures beneath yours!-->
-- Main.DaneSkow - 11 May 2005<br>
-- Main.AnneHeavey - 24 May 2005<br>
-- Main.BurtHolzman - 04 Jan 2006<br>
-- Main.JohnWeigand - 06 Jan 2006<br>
-- Main.JohnWeigand - 13 Jan 2006<br>
-- Main.StevenTimm - 09 Mar 2006  %BR%
-- Main.ForrestChristian - 30 Jan 2007: (copyedits) %BR%
-- Main.Gabriele Garzoglio - 15 Aug 2007: (updated GUMS commands to v1.2) %BR%



%META:TOPICMOVED{by="ForrestChristian" date="1166055724" from="Integration.OsgCEAuthorization050" to="Integration/ITB_0_5.OsgCEAuthorization"}%
