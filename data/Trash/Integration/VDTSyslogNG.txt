%META:TOPICINFO{author="SuchandraThapa" date="1180647454" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="SysLogNg"}%
---+  <noop>Syslog-ng Install
%TOC%

---++ Overview
The following describes configuration and installation of syslog-ng on a server providing a source of logging data to a central logging server.  Configuration of the central server is not described here since it will need to be done only once.  Here is what should be done to setup a logging source.
   * Install syslog-ng on host
   * Launch services on each host by executing the boot scripts.
   * Validate by writing a test message into the service host (into its socket), look for it on the central logging host.
 
---++ Installing Syslog-ng software
Instructions for an independent syslog-ng instance on any host.  Here we focus on installations which do not override or replace the systems native syslog program.  We will be using syslog-ng as distributed by the VDT team in the 1.7.0 release.  In order to use this, pacman will need to be installed on the system. 
   * Run:
<pre  class="screen">
mkdir /opt/syslog-ng
cd /opt/syslog-ng
pacman -get VTB:Syslog-ng-170
</pre>
   * Answer y to the questions that pacman will ask


---++ Configuration of the sourceservice host
After installing the syslog-ng software, you will need to configure syslog-ng to obtain the correct logs and send them to the correct host.  Here =$VDT_LOCATION= will refer to the directory that syslog-ng is installed in, =/opt/syslog-ng= if the instructions above where used. %RED%You need to replace $VDT_LOCATION with the correct directory in the following instructions! %ENDCOLOR%
   * source =$VDT_LOCATION/setup.sh=
   * go to =$VDT_LOCATION/vdt/setup=
   * run =./configure_syslog_ng --server y=
   * run =./configure_syslog_ng --central-host host:port= with the correct host and port
   * for each log file that will be monitored run:
      * =./configure_syslog_ng --add-source "label log-file-location"=, e.g. =./configure_syslog_ng --add-source "condor /opt/condor/local.t2dev-01/log/SchedLog"=
   * edit =$VDT_LOCATION/syslog-ng/etc/syslog-ng.conf= and do the following
      * for each source, find the source entry (should start with =source label_src=) and change the unix-stream entry from ="label.socket"= to ="$VDT_LOCATION/syslog-ng/etc/label.socket"= 
   * edit =$VDT_LOCATION/syslog-ng/etc/log_settings.ini=
      * change =log_socket_directory= to =$VDT_LOCATION/syslog-ng/etc/=
      * change =pid_file_location= to a directory where the daemon user has read and write privileges.  (e.g. =/opt/vtb-1.7.0/syslog-ng/etc/injectors.pid=)
   * A cron job needs to be added to insure that the tail processes remain running.  Something like:
<pre class="screen">
*/10 * * * * $VDT_LOCATION/syslog-ng/bin/syslog_injector.py -c $VDT_LOCATION/syslog_ng/etc/log_settings.ini -t 
</pre>
   * Finally, running vdt-control --on should start the syslog-ng process and start sending log information to the central server.  This is install the init.d scripts and start the syslog-ng service.  Running vdt-control --off will remove the init.d scripts.  Once vdt-control --on is run you can use the standard service or chkconfig commands with the syslog-ng service.

---++ Validation
Write a message into the log sockets on the source host :
<pre>
[root@uct2-grid1 syslog-ng]# /usr/bin/logger -t test -u $VDT_LOCATION/syslog-ng/etc/gatekeeper.socket "this is a test message"
</pre>

On the destination side (the central logging host), check to see that the message arrived.  This directory  =/working/syslog-ng/dq2/logfiles/2007.03= was created.  Then =[root@uct3-edge6 2007.03]$grep test dq2.uct2-grid1.uchicago.edu.log= yields:
<pre>
2007-03-27T08:39:24-05:00 uct2-grid1.uchicago.edu test: this is a test message
</pre>
Message arrived. %Y%

---++ References
   * http://vdt.cs.wisc.edu/
   * http://www.balabit.com/products/syslog-ng/  (note- website is unstable)
   * http://www.cedps.net/wiki/index.php/Syslog-ng
   * http://www.balabit.com/products/syslog_ng/reference-2.0/syslog-ng.html/index.html
   * http://sial.org/howto/logging/syslog-ng/
   * http://www.campin.net/syslog-ng/faq.html

-- Main.SuchandraThapa - 30 May 2007