%META:TOPICINFO{author="AnneHeavey" date="1117121750" format="1.0" version="1.12"}%
%META:TOPICPARENT{name="OSGCEInstallGuide"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>Shutdown Procedure
%TOC%
%STARTINCLUDE%


---++Stopping the currently running daemons

The OSG starts up several daemons.  If you try to re-install/upgrade the OSG without shutting them down it will fail.  Run the following commands to turn off the OSG services before upgrading:

<ul>
  <li>/etc/init.d/edg-crl-upgraded stop
  <li>/etc/init.d/edg-gridmapfile-upgraded stop
  <li>/etc/init.d/gris stop
  <li>$VDT_LOCATION/MonaLisa/Service/CMD/ML_SER stop  
  # (has to be done as either monalisa or daemon user depending on how MonALISA was configured by the VDT)
  <li> if running personal condor from the default VDT install, stop that too.
</ul>

With respect to MonALISA, here is how to find out whether it is running and if so, under what user:
<pre>
ps -efwww | grep -i monalisa
</pre>
and for the mysql daemon associated with MonALISA, check using:
<pre>
ps -efwww | grep -i mysql
</pre>
Note to avoid corruption in the MonALISA monitoring, the script as below should be used to shut down the associated mysqld and related services.

Example session from doing this shutdown:
<pre>
[root@mysite root]# /etc/init.d/edg-crl-upgraded stop
Stopping edg-crl-upgrade
[root@mysite root]# /etc/init.d/edg-gridmapfile-upgraded stop
Stopping edg-gridmapfile-upgrade: 
[root@mysite root]# /etc/init.d/gris stop
[root@mysite root]# su -s /bin/sh - monalisa
[monalisa@mysite monalisa]$ . /usr/local/grid/setup.sh
[monalisa@mysite monalisa]$ $VDT_LOCATION/MonaLisa/Service/CMD/ML_SER stop
Trying to stop MonaLisa ....STOPPED
Trying to stop emysqldb...OK
</pre>
Replace "monalisa" with "daemon" above in the su command if you have no monalisa user.

Check also to see whether there are any stray OSG-related processes, such as run-mis-ci.sh and so forth still running, and kill them manually if necessary.  You may also want to log in to the account running your MIS-CI accounting and remove its crontab by typing "crontab -r" to prevent monitoring updates while you are doing the installation.
---++If VOMS or GUMS Running on Machine
If you have a VOMS and/or GUMS installation on the same machine, see the Shutdown instructions on VomsWhatToDo and/or GumsAdmins.


<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.NateMueller - 14 Apr 2005
-- Main.AlanSill - 14 Apr 2005

%STOPINCLUDE%

