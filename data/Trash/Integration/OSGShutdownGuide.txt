%META:TOPICINFO{author="RobQ" date="1140817523" format="1.0" version="1.21"}%
%META:TOPICPARENT{name="OSGCEInstallGuide"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>OSG Shutdown Guide
%TOC%
%STARTINCLUDE%


---++What processes need to be stopped?

The OSG starts up several daemons.  If you try to re-install/upgrade the OSG without shutting them down, it may fail.  Run the following commands to turn off the OSG services before upgrading (see sample shutdown session below):

<verbatim>
/etc/init.d/edg-crl-upgraded stop
/etc/init.d/edg-gridmapfile-upgraded stop
/etc/init.d/gris stop
source $VDT_LOCATION/setup.sh
$VDT_LOCATION/MIS-CI/uninstall-misci.sh
$VDT_LOCATION/MonaLisa/Service/CMD/ML_SER stop
</verbatim>

This has to be done as either the monalisa or daemon user, depending on how MonALISA was configured by the VDT. Here is how to find out whether MonALISA is running, and if so, under what user:

=ps -efwww | grep -i monalisa=

and for the mysql or postgres daemons associated with MonALISA, check using:

=ps -efwww | grep -i mysql=

or

=ps -efwww  | grep -i post[master,gres]=

If you are shutting down in order to prepare for a new OSG install *in a different directory*, you should
remove the =/etc/init.d/MLD= link if it exists, as this will link to the =ML_SER= in your old =$VDT_LOCATION=.

If you're running a personal condor from the default VDT install:

=/etc/init.d/condor stop=

---++Sample Shutdown Session
Here is a sample session for doing the shutdown. 
Notes:
	* In the *su* line, replace "monalisa" with "daemon" if you have no monalisa user.
	* In the setup.sh line, the path =/usr/local/grid= represents =$VDT_LOCATION=.
<pre>
 # /etc/init.d/edg-crl-upgraded stop
Stopping edg-crl-upgrade
 # /etc/init.d/edg-gridmapfile-upgraded stop
Stopping edg-gridmapfile-upgrade: 
 # /etc/init.d/gris stop
 # . /usr/local/grid/setup.sh
 # $VDT_LOCATION/MIS-CI/uninstall-misci.sh
		There is(are)		 1 crontab(s): 
		/usr/local/grid/MIS-CI/tmp/misci/crontab_ivdgl
00 * * * * /usr/local/grid/MIS-CI/sbin/run-mis-ci.sh >& /dev/null 
10 * * * * /usr/local/grid/MIS-CI/sbin/run-mis-ci.sh >& /dev/null 
20 * * * * /usr/local/grid/MIS-CI/sbin/run-mis-ci.sh >& /dev/null 
30 * * * * /usr/local/grid/MIS-CI/sbin/run-mis-ci.sh >& /dev/null 
40 * * * * /usr/local/grid/MIS-CI/sbin/run-mis-ci.sh >& /dev/null 
50 * * * * /usr/local/grid/MIS-CI/sbin/run-mis-ci.sh >& /dev/null 
		Uninstalling crontab entry for MISCI run by user ivdgl
		Removing crontab
 # su -s /bin/sh - monalisa
 $ . /usr/local/grid/setup.sh
 $ $VDT_LOCATION/MonaLisa/Service/CMD/ML_SER stop
Trying to stop MonaLisa ....STOPPED
Trying to stop emysqldb...OK
</pre>

Also check to see whether there are any stray OSG-related processes, such as run-mis-ci.sh and so forth still running, and kill them manually if necessary.  

---++If VOMS and/or GUMS is Running on Machine

Consult the VOMS and GUMS documentation for shutdown procedures.


<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.NateMueller - 14 Apr 2005<br>
-- Main.AlanSill - 14 Apr 2005<br>
-- Main.JohnWeigand - 18 Jul 2005 - added gsiftp2 to procedures<br>
-- Main.AlanSill - 12 Dec 2005 - added web services shutdown and check<br>

%STOPINCLUDE%

-- Main.BurtHolzman - 30 Dec 2005

