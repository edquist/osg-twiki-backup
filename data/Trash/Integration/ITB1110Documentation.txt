%META:TOPICINFO{author="SuchandraThapa" date="1262715525" format="1.1" version="1.3"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! %SPACEOUT{ "%TOPIC%" }%
%TOC%

---+++ Introduction
This page has the update and testing instructions for the osg 1.2.4 update.


---+++ Installation 
Admins will need to install from the ITB cache.   Unfortunately, due to cache changes, you'll need to do a new install

---+++ Testing and Validation

---++++ Testing configure-osg changes
The changes to configure-osg consist of supporting optional =CEMon= and =Gratia= sections to support overriding the default cemon or gratia servers.  In addition support for configuring storage elements has been added.

---+++++ Testing !CEMon changes
If you are using the default cemon servers, you can test the cemon changes by just running =configure-osg -c= without adding the =CEMon= section.  Your CE should be configured to report to the ITB cemon servers automatically.  You can verify this by checking your site on myosg and verifying that bdii and/or gip information is being propagated.

If you want to test the overriding the default servers, you'll need to add the following to your config.ini file.

<pre class="screen">

[Cemon]

; Default servers for production and itb OSG ress/bdii servers, please don't touch

; The current production osg servers
; Production ReSS server
osg-ress-servers = https://osg-ress-1.fnal.gov:8443/ig/services/CEInfoCollector[OLD_CLASSAD]
; Production BDII server
osg-bdii-servers = http://is1.grid.iu.edu:14001[RAW], http://is2.grid.iu.edu:14001[RAW]

; The current itb osg servers
; ITB ReSS server
itb-ress-servers = https://osg-ress-4.fnal.gov:8443/ig/services/CEInfoCollector[OLD_CLASSAD]
; ITB BDII server
itb-bdii-servers = http://is-itb1.grid.iu.edu:14001[RAW], http://is-itb2.grid.iu.edu:14001[RAW]
 

; The enable option indicates whether cemon should be enabled or 
; disabled.  It should be set to True or False
;
; You generally want Cemon enabled for any CE installation
enabled = %(disable)s

; This setting indicates which servers ress information should
; be sent to.  Most sites should use the %(osg-ress-servers)s 
; setting so that the predefined variable giving the default
; osg production servers will be used, ITB admins can use 
; %(itb-ress-servers)s for default itb servers
;
; The server list should be formated as follows:
; server_uri[format],server_uri[format]
; see the variables at the top of this section for examples of this 
ress_servers = %(default)s

; This setting indicates which servers bdii information should
; be sent to.  Most sites should use the %(osg-bdii-servers)s 
; setting so that the predefined variable giving the default
; osg production servers will be used, ITB admins can use 
; %(itb-bdii-servers)s for default itb servers
; 
; The formatting for this are the same as the ress_servers setting 
bdii_servers = %(default)s

</pre>

You will need to change the setting for =ress_servers= or =bdii_servers=.   In addition, you'll need to turn off your CE, run =configure-osg -c=, and then turn your CE back on to make the changes.

---+++++ Testing Gratia changes
If you are using the default cemon servers, you can test the cemon changes by just running =configure-osg -c= without adding the =Gratia= section.  Your CE should be configured to report to the ITB gratia servers automatically.  You can verify this by checking your site on myosg and verifying that bdii and/or gip information is being propagated.

If you want to test the overriding the default servers, you'll need to add the following to your config.ini file.

<pre class="screen">
[Gratia]

; Default gratia servers
; 
; Please don't change these unless you have good reason to do so

; Variables for osg itb probes, CE installations should use the 
; jobmanager and metric probes 
itb-jobmanager-gratia = jobmanager:gratia-osg-itb.opensciencegrid.org:80
itb-gridftp-gratia = gridftp:gratia-osg-itb.opensciencegrid.org:80
itb-metric-gratia = metric:rsv-itb.grid.iu.edu:8880

; Variables for osg production probes, CE installations should use the 
; jobmanager and metric probes 
osg-jobmanager-gratia = jobmanager:gratia-osg-prod.opensciencegrid.org:80
osg-gridftp-gratia = gridftp:gratia-osg-transfer.opensciencegrid.org:80
osg-metric-gratia = metric:rsv.grid.iu.edu:8880
    

; The enable option indicates whether gratia should be enabled or 
; disabled.  It should be set to True or False
;
; You generally want Gratia enabled for any CE installation, in 
; addition SE installations may want to enable gratia to use 
; the gratia gridftp reporting
enabled = %(disable)s


; This setting specifies the label that gratia will use to report
; accounting information, on a CE if you leave this blank, gratia will
; be set to use the site_name from the Site Information section
resource = %(unavailable)s

; This setting indicates which probes should be enabled for gratia
; The list should be given as probe_name1:host1:port1, probe_name2:host2:port2 
; where probe_name is either default, metric, or gridftp
; host is a fully qualified domain name
; port is the port
; CEs should have entries for jobmanger and metric probes
; SEs should use gridftp if they would like to enable gridftp transfer
; accounting 
; for convience admins can use %(osg-jobmanager-gratia)s,
; %(osg-gridftp-gratia)s, %(osg-metric-gratia)s for production sites
; and %(itb-jobmanager-gratia)s, %(itb-gridftp-gratia)s, 
; and %(itb-metric-gratia)s for ITB sites
probes = %(default)s
</pre>

The probes will need to be changed.  In addition, you'll need to turn off your CE, run =configure-osg -c=, and then turn your CE back on to make the changes.

---+++++ Standalone storage configuration
In order to test, the standalone configurations, you'll need to install the =Xrootd=, =Bestman=, =Xrootdfs=, =Xrootd-GridFTP=, or =GridFTP= packages.  Then copy =$VDT_LOCATION/osg/etc/storage.ini= to =$VDT_LOCATION/osg/etc/config.ini=, set the appropriate options for your setup and run =configure-osg -c=.  Running =vdt-control --on= should automatically bring up your system.

---++++ RSV probe configuration / testing

In order to use the rsv gratia probes, you'll need to add a =gratia_probes= setting to the RSV section.  You'll then need to list every gratia probe that rsv should monitor.  Note: sites using managed fork should specify condor rather than managed fork.  All admins are strongly encouraged to specify the metric probe as well when monitoring a CE.  As an example, to monitor all gratia probes on a CE using pbs and managed fork, you should use =gratia_probes = metric,condor,pbs= .
   
After adding the =gratia_probes= setting, you will need to run 
   * =vdt-control --off=
   * =configure-osg -c= to configure rsv.   
   * =vdt-control --on=

---+++ Updating from previous releases
---++++ Preliminaries
Go to the directory where you installed your software (root directory of the Pacman installation, <tt>[software location]</tt>) and source the setup script so that the following steps will work correctly.
<pre class="screen">
cd [software location]
source setup.sh
</pre>


---++++ Stop VDT Services
Some packages (e.g. =client= or =wn-client=) may not be running any services, however, doing this step will not cause problems.  

<pre class="screen">
vdt-control --off
</pre>

---++++ Backup your software
<pre class="screen">
cp -a $VDT_LOCATION [BACKUP_LOCATION]
</pre>

---++++ Update the VDT updater script itself
There are some updates to the VDT updater script in this release, so it needs to be updated before using it to update your software.  If you do not yet have the updater script, then fetch it:

<pre class="screen">
pacman -get http://vdt.cs.wisc.edu/vdt_200_cache:VDT-Updater
</pre>

If you already have the updater, update it:
<pre class="screen">
pacman -update VDT-Updater
</pre>

Note: If you are not sure if you have the updater, look for =$VDT_LOCATION/vdt/update/vdt-updater= 

---++++ Backup

Backup again since the vdt-updater script will request the location of your backup and verify that the backup is identical to the current contents of the install directory before updating your installation.
<pre class="screen">
cp -a $VDT_LOCATION BACKUP-LOCATION
</pre> 

---++++ Get VDT Updates
This will update VDT packages specifically.
<pre class="screen">
vdt/update/vdt-updater
</pre>

---++++ Get OSG Updates
On a CE, you'll just need to update the following two packages
<pre class="screen">
pacman -update osg-version</verbatim>
pacman -update osg-config</verbatim>
</pre>
For SE, setups you may need to update one or more of the following:
<pre class="screen">
pacman -update Xrootd</verbatim>
pacman -update XrootdFS</verbatim>
pacman -update Xrootd-GridFTP</verbatim>
pacman -update Bestman</verbatim>
pacman -update GridFTP</verbatim>
</pre>

---++++ Post Install Configuration

<pre class="screen">
vdt-post-install
</pre>

On a CE, you will also need to reconfigure your system
<pre class="screen">
configure-osg -c
</pre>


---++++ Restart VDT Services
This step can be omitted if you are not running any services.  If you are not certain, you can run it since services are disabled by default so the only services that will be started are ones that you have explicitly enabled.
<pre class="screen">
vdt-control --on
</pre>

---+++ Open bugs and workarounds
   * The vdt-updater doesn't work properly on systems using SGE
   * CEMon/Gratia are disabled by default changing the behavior from SGE 
   * GIP information needs to be checked against ITB BDII servers

---+++ How to report a bug?
Bug reports for the installation and documentation should be filed with GOC at [[https://ticket.grid.iu.edu/itb/open]].  *Please don't use the vdt support center or any other support center as the receipient since that will cause a email loop*

-- Main.SuchandraThapa - 16 Oct 2009