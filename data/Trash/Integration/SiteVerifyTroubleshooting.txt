%META:TOPICINFO{author="KyleGross" date="1329927413" format="1.1" version="1.8"}%
%META:TOPICPARENT{name="OSGCEInstallGuide"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>Troubleshooting Site Verify
%TOC%
%STARTINCLUDE%


---++Introduction
This section provides some hints on troubleshooting problems identified in the site verification process using the <b>site_verify.pl</b> script.

---++Authentication (running a job on the gatekeeper fork queue)
The authentication verification is checking  to see if you can run a job on your gatekeeper by executing on the fork queue.  

Prequisites:
   * You need a grid proxy as a prerequisite and therefore your certificate credentials..
   * You need the subject (DN) of your credentials in the /etc/grid-security/grid-mapfile showing the assignment to an established Unix account on your gatekeeper.
       <verbatim>
        "Your_DN"  unix_account
       </verbatim>

The script will execute:
<verbatim>
     globus-job-run {your-gate-keeper:port}/jobmanager-fork  /bin/hostname
</verbatim>
<b>PASS:</b> the exit status will be zero and the host name of the gatekeeper node will be displayed..

<b>FAIL:</b>
   * <b>Case 1:</b> User not in /etc/grid-security/grid-mapfile. 
   <verbatim>
   globus-job-run [YOUR_CE_HOST]:2119/jobmanager-fork /bin/hostname
   GRAM Job submission failed because authentication with the remote server failed (error code 7)
   </verbatim>
   <b>Globus gatekeeper log entries</b>: ($VDT_LOCATION/globus/var/globus-gatekeeper.log)
   <verbatim>
   PID: 2354 -- Notice: 5: Authenticated globus user: /DC=org/DC=doegrids/OU=People/CN=John Weigand 458491
   Failure: globus_gss_assist_gridmap() failed authorization. gridmap.c:globus_l_gss_assist_gridmap_lookup:1621:
   Gridmap lookup failure: Could not map /DC=org/DC=doegrids/OU=People/CN=John Weigand 458491
   </verbatim>
    

   * <b>Case 2:</b> CE host certificate errors.
   <verbatim>
   globus-job-run cd-94372.dhcp.fnal.gov:2119/jobmanager-fork /bin/hostname
   GRAM Job submission failed because the connection to the server failed (check host and port) (error code 12)
   </verbatim>
  <b>Globus gatekeeper log entries</b>: ($VDT_LOCATION/globus/var/globus-gatekeeper.log)
  <verbatim>
   globus_gsi_system_config.c:globus_i_gsi_sysconfig_check_keyfile_unix:4711:
   File has bad permissions: Permissions on /etc/grid-security/hostkey.pem are too permissive. 
          Maximum allowable permissions are 600
or
   globus_gsi_system_config.c:globus_i_gsi_sysconfig_check_keyfile_unix:4711:
   File has bad permissions: Permissions on /etc/grid-security/hostkey.pem are too permissive. 
          Maximum allowable permissions are 600
or
   globus_gsi_system_config.c:globus_i_gsi_sysconfig_check_certfile_unix:4840:
   File has bad permissions: Permissions on /etc/grid-security/hostcert.pem are too permissive. 
           Maximum allowable permissions are 644
or
   globus_gsi_system_config.c:globus_i_gsi_sysconfig_check_certfile_unix:4788:
   File does not exist: /etc/grid-security/hostcert.pem is not a valid file
  </verbatim>

   * <b>Case 3:</b> Invalid permissions on the $[USER_HOME}/.globus directory of the CE or CE cluster nodes.
   <verbatim>
   globus-job-run cd-94372.dhcp.fnal.gov:2119/jobmanager-fork /bin/hostname 
   GRAM Job submission failed because the job manager detected an invalid script status (error code 25)
   </verbatim>
   <b>Globus gatekeeper log entries</b>: ($VDT_LOCATION/globus/var/globus-gatekeeper.log)
   <verbatim>
   TIME: Fri May 13 10:30:33 2005
     PID: 6066 -- Notice: 6: Got connection 131.225.82.73 at Fri May 13 10:30:33 2005
   TIME: Fri May 13 10:30:33 2005
    PID: 6066 -- Notice: 5: Authenticated globus user: /DC=org/DC=doegrids/OU=People/CN=John Weigand 458491
   TIME: Fri May 13 10:30:33 2005
    PID: 6066 -- Notice: 0: GRID_SECURITY_HTTP_BODY_FD=7
   TIME: Fri May 13 10:30:33 2005
    PID: 6066 -- Notice: 5: Requested service: jobmanager-fork 
   TIME: Fri May 13 10:30:33 2005
    PID: 6066 -- Notice: 5: Authorized as local user: weigand
   TIME: Fri May 13 10:30:33 2005
    PID: 6066 -- Notice: 5: Authorized as local uid: 9789
   TIME: Fri May 13 10:30:33 2005
    PID: 6066 -- Notice: 5:           and local gid: 502
   TIME: Fri May 13 10:30:33 2005
    PID: 6066 -- Notice: 0: executing /data/osg-itb-015/globus/libexec/globus-job-manager
   TIME: Fri May 13 10:30:33 2005
    PID: 6066 -- Notice: 0: GATEKEEPER_JM_ID 2005-05-13.10:30:33.0000006066.0000000000 for 
             /DC=org/DC=doegrids/OU=People/CN=John Weigand 458491 on 131.225.82.73
   TIME: Fri May 13 10:30:33 2005
    PID: 6066 -- Notice: 0: GRID_SECURITY_CONTEXT_FD=10
   TIME: Fri May 13 10:30:33 2005
    PID: 6066 -- Notice: 0: Child 6097 started
   No root path(s) specified
      at /data/osg-itb-015/globus/lib/perl/Globus/GRAM/JobManager.pm line 755
   </verbatim>
    In this case, the real error is found in the [USER_HOME]/gram_job_mgr_6097.log file.  Note the child PID specified in the gatekeeper log file correlates to the GRAM log file in the authorized user's $HOME directory.   Imbeded in that log file is the following message:
   <verbatim>
   Fri May 13 10:30:34 2005 JM_SCRIPT: cache cleanup failed with ERROR: 
        Could not open GASS cache because the GASS cache directory or status file could not be created
   </verbatim>


<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.JohnWeigand - 04 May 2005

%STOPINCLUDE%