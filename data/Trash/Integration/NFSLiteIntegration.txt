%META:TOPICINFO{author="TerrenceMartin" date="1161379798" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="NewOSGServices"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>NFS Lite OSG Integration
%TOC%
%STARTINCLUDE%


---++Introduction

This document outlines the integration of the NFS Lite modification to the standard OSG CE deployment as a new service in the OSG.

---++Description

NFS Lite is modification to the exiting OSG CE deployment whose goal is to reduce or eliminate the dependency of having a shared network file system between worker nodes and the OSG Compute Element (CE). 

At its simplest NFS lite is a modification to CE globus jobmanager to replace the implicit sharing of grid job critical files via a shared file system to an explicit sharing that is managed by the sites batch system. 

Currently only Condor and the Condor jobmanager are supported for NFS Lite however in principal once the 3 key requirements for elimination of the shared file system are met any batch system could support an NFS Lite deployment of an OSG CE. 

The 3 core requirements for NFS Lite are;

   * That the job proxy be copied to the initial working directory of the job on the worker node and that the environment variable for the proxy be set accordingly. 
   * That any files that are delivered to the CE by the GRAM be copied to the initial working directory of the job on the worker node
   * That any standard IO created by the job be copied back to the CE from the worker node and be placed in a location that allows the GRAM to pass that standard IO back to the submitter. 

---++Required Resources

Currently NFS Lite requires the use of condor versions 6.7.18 or newer as the sites batch system. Newer versions of condor are required to ensure that the grid proxy is correctly handled. 

---++Server Requirements

There are no server requirements other than those otherwise required for an OSG CE. NFS Lite is a modification of the existing OSG CE jobmanager that takes advantage of existing features in the batch system. 

---++Packaging

Since NFS Lite is a modification to the existing condor jobmanager it does not itself require its own package but will be integrated into all condor.pm jobmanagers inline. Use of NFS Lite will then be controlled by a configuration parameter that will be inline to the existing OSG Jobmanager configuration system. 

In other words NFS Lite is fully integrated into an existing OSG package and does not require its own packaging. 

---++ Installation and Configuration

NFS Lite requires modification how the condor jobmanager interacts with the condor batch system. This change effects the contents of the job script sent to the condor system for each job.

In order to support both NFS Lite and non NFS Lite OSG CE installs enabling NFS Lite will be controlled via a single configuration flag. This NFS Lite flag if turned on will instruct the condor jobmanager to have condor take care of the required file transfers to support running grid jobs on a condor batch slot. Site administrators wil then be required to select this configuration either at CE installation, or as a possible option after deployment. 

---++ Test Harness

Since NFS Lite is meant as an inline change to the existing job submission flow and is intended to act nearly identically to a non NFS Lite site from a submission perspective testing should be done via existing OSG CE job submission and execution testing mechanisms. That is any test that is used to validate a non NFS Lite condo based OSG CE is also appropriate to use with an NFS Lite install. 

_Note: An exception to this is that currently NFS Lite does not support explicitly the Remote_InitialDir paramenter in condor-g. It is not clear at this time that this parameter should be supported in all cases or that it is necessary or desirable for VOs to specify the exact directory on the remote cluster they should execute in._ 

---++ Validation

---+++ Functionality

NFS Lite should be a near drop in replacement for a non NFS Lite or traditional OSG CE Install. The goal with NFS Lite is to make use of existing capabilities within batch systems to explicitly support grid requirements that are currently implicitly supported by using an NFS or similar shared file system between the OSG CE and the worker node. Validation of NFS Lite involves ensuring that the core functionality expected by jobs from a standard OSG CE is also present on NFS Lite configured CE. 

---+++ Scalability

NFS Lite is meant to help solve the scalability issue that is inherent in sharing a single networked file system to dozens or hundreds of worker nodes.  NFS Lite reduces or eliminates this performance bottleneck by removing the file share between the worker nodes and the CE and confining what little IO is required to occur between the worker and the CE to the beginning and end of the job. By reducing the absolute amount of IO between the worker node during job execution by explicitly moving job IO to the node, as well as confining the remaining IO to job pre-initialization and job completion it is much easier and cheaper to architect a CE IO subsystem capable of handling large numbers of worker nodes. 

The benefit is a large gain in scalability for the CE at hopefully a minimal loss in CE functionality. 

---+++ Known Issues

NFS Lite current does not support the condor-g parameter Remote_InitialDir. The documented purpose of this paramater is to allow the submitter to specify the initial working directory on the worker node before the job is submitted. However Remote_InitialDir has a dependency on the condor parameter InitialDir. InitialDir is not supported when a condor cluster is run in a non-shared disk mode. NFS Lite uses condor in a non-shared disk mode and therefore also does not support InitialDir and therefore does not support Remote_InitialDir. 

Some work has been done on possibly supporting Remote_InitialDir at the request of one of the OSG VOs that currently uses this parameter. However it is not clear that the solution will be deployed with NFS Lite at this time. Controlling where a job initially executes to ensure optimal performance and stability is a job that is probably best left to the site admin. In fact implicit in NFS Lite is increasing the control by the site in where OSG user jobs initial start execution. It is not clear that supporting Remote_InitialDir is in the best interest of the site, or the remote users in terms of efficient and reliable grid job execution. 


---++ Contact Information

Terrence Martin 
tmartin at ucsd.edu

---++ Additional Documentation

[[http://hepuser.ucsd.edu/twiki/bin/view/UCSDTier2/NFSLiteOSG][NFS Lite Documentation at UCSD]]

[[http://hepuser.ucsd.edu/twiki/bin/view/UCSDTier2/NFSLiteLigoCompat][Supporting Remote_InitialDir under NFS Lite]]

<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.TerrenceMartin - 20 Oct 2006

%STOPINCLUDE%
