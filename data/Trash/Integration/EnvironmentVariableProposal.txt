%META:TOPICINFO{author="KyleGross" date="1225985940" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="IntegrationTestbed"}%

-- Main.AlainRoy - 08 Feb 2007

Alan Sill brought up a problem: OSG 0.5.2 broke PBS job submissions. It took me a while to track down the problem and come up with a solution. The solution might affect many people, so I hope that people can read this through and comment. 

---+ Background
In OSG 0.5.2, the job environment for a user's job comes from osg-attributes.conf (and will also soon come from osg-local-attributes.conf). The jobmanager reads the file and passes the environment variables to the batch system. 

With OSG 0.5.2, we have a bigger environment than we had in the past. This is partly because we have more variables, and partly because we have variables named with GRID3* for backwards-compatibility. 

---+ Problem
For OpenPBS and PBSPro (but not Torque), if the environment directive is more than 2048 characters total, it breaks the job submission. Depending on where the 2048th character fails, the failure manifests in different ways. In many cases, it will simply fail. 

Ending the line with a continuation character will not help. You cannot specify the environment directive multiple times, so that doesn't help either. 

---+ Possible Solutions

1) I talked to Altair Engineering, and they will consider increasing the limit in a future version of PBSPro. I have no idea if or when they might change it. 

2) PBSPro users can switch to Torque. This isn't likely to make most PBSPro users happy. 

3) We can publish fewer OSG environment variables. This isn't too hard: many of the variables are not needed by jobs. To be specific, osg-attributes.conf will stay as it is, and we'll create a new file called osg-job-environment.conf which will be a subset of osg-attributes.conf. 

---+ Proposed Solution

I think we should go with option #3. Unfortunately, doing so means that we need to decide which variables should be in a job's environment, and which shouldn't. To jumpstart the discussion, I propose a breakdown below, and people can tell me where I've made mistakes. 

Suggested changes:

1) osg-job-environment.conf is created with a subset of osg-attributes.conf
   The subset is below. This file is labelled with a warning "Do NOT 
   modify this file..."

2) If people want to extend the environment, they do so in 
   osg-local-job-environment.conf (instead of the previously suggested 
   osg-local-attributes.conf.)

And note, we'll do all of this for OSG 0.6.0.

---+ Variables in a Job's environment

OSG_LOCATION     Where OSG/VDT is installed<br>
GLOBUS_LOCATION  Where Globus is installed<br>
<br>
OSG_SITE_NAME    (Name of site)<br>
GRID3_SITE_NAME  (Name of site)<br>
OSG_HOSTNAME        (Hostname of gatekeeper)<br>
<br>
OSG_GRID         (Where worker node client is installed)<br>
GRID3_BASE_DIR   (Where VDT is installed)<br>
OSG_APP          (Where applications are stored)<br>
GRID3_APP_DIR    (Where applications are stored)<br>
OSG_DATA         (Where data is stored)<br>
GRID3_DATA_DIR   (Where data is stored)<br>
GRID3_TMP_DIR    (Where data is stored)<br>
OSG_WN_TMP       (Where worker node tmp is)<br>
GRID3_TMP_WN_DIR (Where worker node tmp is)<br>

OSG_STORAGE_ELEMENT (Is there an SE?)<br>
OSG_DEFAULT_SE      (Hostname of SE)<br>
OSG_SITE_READ       (input directory of SE)<br>
OSG_SITE_WRITE      (output directory ofz SE)<br>
<br>
OSG_SQUID_LOCATION (hostname of Squid, needed for proxying)<br>

---+ Variables NOT in a Job's environment
GRID3_TRANSFER_CONTACT (Unused?)<br>
<br>
GRID3_SPONSOR  (VOs sponsoring a site) <br>
OSG_SPONSOR    (VOs sponsoring a site)<br>
<br>
OSG_PBS_LOCATION    (Where PBS is installed)<br>
OSG_FBS_LOCATION    (Where FBS is installed)<br>
OSG_SGE_LOCATION    (Where SGE is installed)<br>
OSG_SGE_ROOT        (Where SGE is installed)<br>
OSG_LSF_LOCATION    (Where LSF is installed)<br>
OSG_CONDOR_LOCATION (Where Condor is installed)<br>
OSG_CONDOR_CONFIG   (Where Condor's configuration file is)<br>
OSG_JOB_MANAGER     (Which batch system is being used)<br>
OSG_JOB_MANAGER_HOME ?<br>

GRID3_UTIL_CONTACT (URL of fork jobmanager)<br>
OSG_JOB_CONTACT    (URL of fork jobmanager)<br>
GRID3_JOB_CONTACT  (URL of batch jobmanager)<br>
OSG_UTIL_CONTACT   (URL of batch jobmanager)<br>

OSG_SITE_INFO      (URL to learn more about site policy)<br>
GRID3_SITE_INFO    (URL to learn more about site policy)<br>
OSG_CONTACT_NAME   (Name of person responsible for site)<br>
OSG_CONTACT_EMAIL  (Email of person responsible for site)<br>
OSG_SITE_CITY      (City that site is in)<br>
OSG_SITE_COUNTRY   (Country that site is in)<br>
OSG_SITE_LONGITUDE (Location of site)<br>
OSG_SITE_LATITUDE  (Location of site)<br>

OSG_GROUP            (Like ITB)<br>

OSG_MONALISA_SERVICE (Using MonaLisa?)<br>
OSG_VO_MODULES       (Using MonaLisa's VirtualOrganizations/VOInfo Modules?)<br>

OSG_GANGLIA_SUPPORT  (Is Ganglia being used?)<br>
OSG_GANGLIA_HOST     (Hostname of Ganglia service)<br>
OSG_GANGLIA_PORT     (Port of Ganglia service)<br>

OSG_USER_VO_MAP      (location of user-vo-map)<br>
GRID3_USER_VO_MAP    (location of user-vo-map)<br>
OSG_GRIDFTP_LOG      (location of GridFTP log file)<br>
GRID3_GRIDFTP_LOG    (location of GridFTP log file)<br>

OSG_SQUID_POLICY     (How Squid caches files)<br>
OSG_SQUID_CACHE_SIZE (How big Squid's disk cache is)<br>
OSG_SQUID_MEM_CACHE  (How big Squid's memory cache is)<br>