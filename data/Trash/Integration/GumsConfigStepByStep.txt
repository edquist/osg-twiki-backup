%META:TOPICINFO{author="AnneHeavey" date="1116610383" format="1.0" version="1.1"}%
%META:TOPICPARENT{name="GumsAdmins"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!Configure GUMS Step by Step
%TOC%
%STARTINCLUDE%


---++Introduction
The gums.config file is written in XML and has three parts: 

*persistenceFactories* - defines where the local data can be stored. For example, GUMS will keep a local copy of the VO listings; you can decide where to keep them. In OSG, it's always mysql. Each component that needs persistence information will retrieve it from mysql.  

*groupMappings* - defines groups of users and sets how they are to get mapped. A groupMapping is defined by two things: a set of users (userGroup) and a policy for account mapping (accountMapping). Optionally, the policy can be composed of multiple policies (compositeAccountMapping) 

*hostGroups* - defines which groupMappings are used for the different hosts. 
---++File Structure
The XML file has this structure:
<verbatim>
<gums>
  <persistenceFactories>
	 <persistenceFactory/>
  </persistenceFactories>
  <adminUserGroup/>
  <groupMappings>
	 <groupMapping>
		<userGroup/>
		<accountMapping/>
	 </groupMapping>
	 <groupMapping>
		<userGroup/>
		<compositeAccountMapping>
		  <accountMapping/>
		  <accountMapping/>
		  <accountMapping/>
		</compositeAccountMapping>
	 </groupMapping>
	 ...
  </groupMappings>

  <hostGroups>
	 <hostGroup/>
  </hostGroups>
</gums>
</verbatim>

---++The Minimum
---+++persistenceFactories
The default file includes one persistenceFactory element; leave it as is (even the password?).
<verbatim>
<persistenceFactory 
name='mysql'
className='gov.bnl.gums.MySQLPersistenceFactory'
jdbcDriver='com.mysql.jdbc.Driver'
jdbcUrl='jdbc:mysql://cd-94372.dhcp.fnal.gov/GUMS_1_0' 
user='gums' 
password='VDTXLKRBKIM' 
autoReconnect='true' />
</verbatim>

---+++groupMappings
This element contains groupMapping elements. The only essential attribute is "name". This is the name for the mapping defined within this element. Each groupMapping element in the file must have a unique name.  
<verbatim>
<groupMapping name='osg1'>
</verbatim>
(I don't see where it shows up in the inverse mappings file -- maybe it doesn't...)

---++++userGroup
The userGroup element is a subelement of groupMapping. It has two attributes which are always needed and should never be changed from the default values: className and persistenceFactory.  
<verbatim>
className='gov.bnl.gums.VOMSGroup'
persistenceFactory='mysql' 
</verbatim>
It has others which are required, but that you need to set for your own installation: url, name, voGroup, sslCertfile, ss1key. The default values for these last two should be good, but check.

Values:%BR%
name: your VO name%BR%
url: URL for your VOMS admin server%BR%
sslCertfile: path to the httpcert.pem file on your GUMS host %BR%
sslKey path to the httpkey.pem file on your GUMS host %BR%
E.g.,
<verbatim>
name='myvo' 
voGroup="/myvo/group1"
url='https://my-voms-server:8443/edg-voms-admin/vos/services/VOMSAdmin'
sslCertfile='/etc/grid-security/http/httpcert.pem'
sslKey='/etc/grid-security/http/httpkey.pem' 
</verbatim>

There are two optional attributes: voRole and ingoreFQAN.  We'll describe these later (remember to link!), but we recommend that you always include ignoreFQAN with its value, either true or false. That way you don't have to remember the default value (which is "false").
<verbatim>
voRole="role1"
ignoreFQAN="true"
</verbatim>
---++++accountMapping
An accountMapping element defines the logic with which the user credentials are mapped to the local account. You can choose whether you want to implement mapping to a group account or to a pool of accounts.  
---+++++Group Account Mapping
For group mapping, you just have to specify the implementing class (as shown here) and the name of the group account, e.g.,
<verbatim>
<accountMapping 
className='gov.bnl.gums.GroupAccountMapper' 
groupName='groupaccount1' />
</verbatim>
---+++++Pool Account Mapping
To use a pool of accounts, you  need to specify the implementing class (as shown here), the place to look up the pool of accounts (the persistenceFactory, always "mysql" in OSG) and the name for the pool (there may be multiple pools defined), e.g.,:
<verbatim>
<accountMapping 
className='gov.bnl.gums.AccountPoolMapper'
persistenceFactory='mysql' 
name='Pool_1' />
</verbatim>
---+++++Both (Composite)
You may include both types of mapping within one groupMapping element. A typical use for this would be to map the incoming user to a pool account if available, and if not, then fallback to a group account.  Use the <tt>compositeAccountMapping</tt> element as shown to accomplish this:
<verbatim>
<compositeAccountMapping>
	<accountMapping className='gov.bnl.gums.AccountPoolMapper'
		persistenceFactory='mysql' 
		name='Pool_1' />
	<accountMapping 
		className='gov.bnl.gums.GroupAccountMapper'
		groupName='groupaccount1' />
</compositeAccountMapping>
</verbatim>
---+++hostGroup

---++Add Some Extras

---+++groupMappings
If you want <nop>MonALISA to be able to retrieve information, you'll need to set two other attributes: accountingVo and accountingDesc.  They will appear in the $VDT_LOCATION/monitoring/grid3-user-vo-map.txt file (the inverse map file) when you run Generate Inverse Map on the GUMS web UI. The accountingVO should be similar or identical to the name and must be completely lowercase, and accountingDesc must be the same string but in uppercase, e.g.,:
<verbatim>
accountingVo='osg1' accountingDesc='OSG1'>
</verbatim>


<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.AnneHeavey - 20 May 2005

%STOPINCLUDE%

