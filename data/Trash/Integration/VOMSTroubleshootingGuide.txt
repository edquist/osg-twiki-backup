%META:TOPICINFO{author="KyleGross" date="1476285006" format="1.1" version="1.12"}%
<!-- This is the default OSG Trash/Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->

---+!!<nop>VOMS Troubleshooting Guide
%TOC%
%STARTINCLUDE%


---++Introduction
This document is intended to provide some assistance in troubleshooting  problems which may or may be related to VOMS: the server, voms-proxy-init and the web admin portions.

An important point to note is that the VOMS error messages are not always indicative of the real problem.  The VOMS team is aware of this and intends to address this in the near future.  In the interim, however, it is a challenge.

---++/etc/init.d/voms server script 
---+++prompts for password
     Main.JohnWeigand - 2 June  2005<br>
 <b>Command:</b>
   <verbatim>
   [root@fermigrid2 init.d]# cd /etc/init.d
   [root@fermigrid2 init.d]# voms
   password: 
   Initialization error: wrong database version
   </verbatim>
   <b>Explanation:</b>
When this occurs you are likely attempting ot execute the wrong <b>voms</b> script due to a PATH variable problem.
VOMS has 2 files named <b>voms</b>:  
   * EDG_LOCATION/etc/init.d (copied to /etc/init.d at installation time, normally)
   * EDG_LOCATION/sbin - This one is a  soft link to the edg-voms executable in the same directory.

The ./sbin copy is actually being executed.  It normally is run with a --conf argument specifying the database and  password configuration files for the database.  Without it, it evidently attempts to open the database without a password and , hence, the password prompt.

<b>Resolution:</b> Fix your PATH to look in the current directory or fully qualify the pathname when executing it.  

If you  supply the password, who knows what will happen then.  The best thing to do is put a garbage password in to get the prompt back.

---++voms-proxy-init 
---+++VOMS Server for XXXX not known!
   Main.JohnWeigand - 06 Jun 2005<br>
 <b>Command:</b>
<verbatim>
[weigand@gyoza7 vdt-1.3.6-client]$ voms-proxy-init --voms badNickName:/uscms
VOMS Server for badNickName not known!
</verbatim>
   
   <b>Problem:</b> 
   The voms-proxy-init cannot find a _vomses_ file containing the 'badNickName' you have
    specified on the command line.

   <b>Resolution:</b>
   1 Verify that you have a _vomses_ file in one of the following locations (shown in the order they are searched):
      * _$VDT_LOCATION/voms/etc/vomses_ (this can either be a directory containing individdual files or a file itself)
      * _$HOME/.edg/vomses_  (must be owned by  you  with 644 permissions)
   1 If your _vomses_ file is in a non-standard location, then use the '-conf  VOMS_FILE_LOCATION' argument on the _voms-proxy-init_ to specify it.
   1 Verify that your _vomses_  file contains the 'badNickName' as the 1st token.

---+++Error: VERR_COMM
     Main.JohnWeigand - 18 May 2005<br>
 <b>Command:</b>
   <verbatim>
   $VDT_LOCATION/voms/bin/voms-proxy-init  --debug --voms fermilab:/fermilab 
        :
   Your identity: /DC=org/DC=doegrids/OU=People/CN=John Weigand 458491
   Creating temporary proxy to /tmp/tmp_x509up_u1343_7169 .++++++++++++
   ..................++++++++++++
   Done
   Contacting  fermigrid2.fnal.gov:15001 [/DC=org/DC=doegrids/OU=Services/CN=host/fermigrid2.fnal.gov] "fermilab"
                  gss_assist_get_unwrap    failure:
   GSS Major Status: Communications Error
   GSS Minor Status Error Chain:
   unwrap.c:gss_unwrap:220:
   Error with GSS token
   globus_i_gsi_gss_utils.c:globus_i_gsi_gss_put_token:671:
   Error with GSS token: The input token has an invalid length of: 0
       :
   Failed. Error: VERR_COMM
   Failed to contact servers for fermilab.
   </verbatim>

<b>VOMS server log:</b>

 $VDT_LOCATION/voms/var/log/voms.{VO_NAME}

  <verbatim>
   Wed May 18 09:36:33 2005:fermigrid2.fnal.gov:vomsd(31032):ERROR:REQUEST:Execute (vomsd.cc:502):
                Unable to interpret command: 43200G/fermilab
   Wed May 18 09:37:34 2005:fermigrid2.fnal.gov:vomsd(31036):ERROR:REQUEST:Execute (vomsd.cc:631):
                Can't get Serial Number!
   </verbatim>

<b>Real Problem:</b>
Apparently, the voms-proxy-init did contact the server despite the client error message, as the server log shows the contact.

The failure was due to the server's failure to open the !MySql database:
   * The OS permisssions on the mysql database were set to root.root.  The mysql process runs as daemon and therefore the permissions should have been daemon.root on most files and directories.

This 'generic' error messages generated by most VOMS commands do not point to the real problem.  

<b>Resolution:</b>
The non-user friendly error message problem has been an outstanding issue for some time and has been reported as 
<a href="https://savannah.cern.ch/bugs/?func=detailitem&item_id=5856">Bug 5856</a>.  Friendlier error  messages are promised with VOMS version 1.6.


<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

*Major updates*:%BR%
<!--Future editors should add their signatures beneath yours!-->
-- Main.JohnWeigand - 18 May 2005

%STOPINCLUDE%

%META:TOPICMOVED{by="JohnWeigand" date="1117817628" from="Integration.VomsTroubleshootingGuide" to="Integration.VOMSTroubleshootingGuide"}%
