%META:TOPICINFO{author="TanyaLevshina" date="1235518917" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

%STARTINCLUDE%
%BR%
---+ _%INCLUDEHEADING%  %SPACEOUT{ "%TOPIC%" }%_
The !BeStMan server is using !GridFTP server to transfer files to/from  any Posix compliant file system. Gratia !GridFTP  transfer probe generates accounting  information about the transfers  based upon the Globus !GridFTP server logs. 
This document covers the Gratia !GridFTP transfer probe configuration. It must be repeated once for every !GridFTP server in the SE.

%EDITTHIS%
%BR%

---++ Configuring Gratia transfer probe
!GridFTP  transfer probe is installed simultaneously with !BeStMan or standalone !GridFTP server. It is installed disabled. In order to see execute the following commands:

<pre class="screen">
cd &lt;VDT_LOCATION&gt;
. setup.sh
vdt-control --list
[root@fg0x1 itb_bestman]# vdt-control --list
Service            | Type   | Desired State
-------------------+--------+--------------
fetch-crl          | cron   | enable
vdt-rotate-logs    | cron   | enable
vdt-update-certs   | cron   | enable
gsiftp             | inetd  | enable
gratia-gridftp-tran| cron   | do not enable
bestman            | init   | enable
edg-mkgridmap      | cron   | do not enable
gums-host-cron     | cron   | do not enable
</pre>  

To configure !GridFTP transfer probe do the following:
<pre class="screen">
cd &lt;VDT_LOCATION&gt;
. setup.sh
$VDT_LOCATION/vdt/setup/configure_gratia  \
 --probe gridftp-transfer \
 --report-to &lt;gratia_host:gratia_port&gt; \
 --probe-cron --site-name &lt;SiteName&gt;
</pre>

Where _gratia_host_ is FQDN of Gratia collector, _gratia_port_ is Gratia Collector port and  _SiteName_ is your site name.

If you want to do additional changes in configuration, eg change location of gridftp logs or name of the Grid (default is OSG) you can edit _ProbConfig_file  located in
_$VDT_LOCATION/gratia/probe/gridftp-transfer_ directory.

---+++  Creating osg-user-vo-map

Please read  [[https://twiki.grid.iu.edu/bin/view/Integration/ITB092/OsgSupportedVos][this page]] about files that are required to accurately collect grid resource usage and metrics by VO for transfer submitted using grid proxies or where voms proxy information is not available. In order to enable this do the following:
<pre class="screen">
cd &lt;VDT_LOCATION&gt;
. setup.sh
vdt-control -enable gums-host-cron
vdt-control -on gums-host-cron
touch $VDT_LOCATION/monitoring/osg-attributes.conf
$VDT_LOCATION/gums/scripts/gums-host-cron
</pre>

__+++ Enable Gratia Transfer probe

<pre class="screen">
cd &lt;VDT_LOCATION&gt;
. setup.sh
vdt-control -enable gratia-transfer-probe
</pre>

----++ Starting/Stopping Gratia transfer probe

----++ Log files

---++ Sanity Check

---++ Known issues

---++ More information


%STOPINCLUDE%
%BR%
%COMPLETE1% %BR%
%RESPONSIBLE% Main.TanyaLevshina - 18 Feb 2009 %BR%
%REVIEW%
