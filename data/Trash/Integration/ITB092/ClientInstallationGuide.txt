%META:TOPICINFO{author="RobGardner" date="1192749712" format="1.1" version="1.23"}%
%META:TOPICPARENT{name="DocumentationTable"}%
---+!! *<noop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%


This process assumes that you have already [[Documentation/CertificateGet][obtained a grid certificate]] from an OSG-recognized Certificate Authority and joined an OSG Virtual Organization. If you have not, you will not be able to complete this process.

---+ System Requirements
See [[http://vdt.cs.wisc.edu/releases/1.8.0/requirements.html][VDT System Requirements]]. 

%NOTE% The OSG Client 0.6.x %RED%and 0.8.0?%ENDCOLOR% is only supported on Linux. It does not currently support Mac OS X or other *nixes.

If you do a non-root install, make sure that you own your =$HOME/.globus= directory and its permissions are 755.

%INCLUDE{"PacmanInstall"}%

<!--Pacman must be installed and setup. See [[PacmanInstall][installation instructions]]. If already installed, just set it up:
<pre class="screen">
> cd pacman-3.20
> source setup.sh <i>or</i> source setup.csh
> cd $HOME
</pre>
-->

The python-devel rpm must be installed on the machine.

---+ Install the OSG Client
You will need to create a directory for the client and then install it using pacman.

<pre class="screen">
[~]$ <userinput>mkdir osg-client</userinput>
[~]$ <userinput>cd osg-client/</userinput>
</pre>

%NOTE% In the next step, installing the OSG client software through pacman, we have found that it may sometimes not recognize a supported platform such as Scientific Linux and fail.  If this happens, see [[PacmanBestPractices#Troubleshooting_pacman][Troubleshooting Pacman]].

<!--  this info should be in PacmanBestPractices; not repeated here.
If that occurs, see if your platform is in the supported list by executing =pacman -platforms=. You can then force pacman to use a particular platform by running it with the =-pretend-platform= switch: %BR% =pacman -pretend-platform:linux-sl-fermi-5.5=
-->

%RED% How do I know what version of the client I want?%ENDCOLOR%

<pre class="screen">
[~/osg-client]$ <userinput>pacman -get %CACHE%:client</userinput>
Do you want to add [http://software.grid.iu.edu/pacman/] to [trusted.caches]? (y or n): <userinput>y</userinput>
Package [client] found in [OSG]...
Package [OSG:vo-client-0.6] found in [OSG]...
Package [vo-client-0.6] found in [OSG]...
Do you want to add [http://vdt.cs.wisc.edu/vdt_161_cache] to [trusted.caches]? (y or n): <userinput>y</userinput>
Package [VDT-Client] found in [http://vdt.cs.wisc.edu/vdt_161_cache]...
Package [http://vdt.cs.wisc.edu/vdt_161_cache:VDT-Common] found in [http://vdt.cs.wisc.edu/vdt_161_cache]...

<replaceable>&lt; - - SNIP! - - ></replaceable>
</pre>

There are many lines of output. Eventually it continues with:

<!-- After the installation has completed, you will also be able to... -->

<pre class="screen">
VDT 1.6.1 installs a variety of software, each with its own license.
In order to continue, you must agree to the licenses.
You can view the licenses online at:

     http://vdt.cs.wisc.edu/licenses/1.6.1

After the installation has completed, you will also be able to
view the licenses in the "licenses" directory.

Do you agree to the licenses? [y/n] <userinput>y</userinput>

</pre>

Answer =y= to continue the installation.

<pre class="screen">
If you would like, we can configure the Condor batch system to
start automatically at boot time.

Configuring the Condor daemon requires changes to
- /etc/init.d (or /etc/rc.d/init.d)

Would you like to enable the Condor batch system to run automatically?

Possible Answers:
     y: Yes. Please remove any old instances of the service and run
        this one..
     n: No. Please remove any old instances of the service, but don't
        run this one.
</pre>

Answer =y= to start up the Condor.  This is a personal condor that is only for submitting jobs to remote sites. It is not the server Condor for receiving jobs. If you are submitting jobs from a machine that is also receiving jobs with Condor, answering "yes" to this will *not* overwrite the server Condor. Only your condor-g will be affected.

<pre class="screen">
Several services provided by the VDT create unbounded log files.  If you wish, w
e can rotate those file on a daily basis.

Would you like to setup daily rotation of VDT log files?

Possible Answers:
     y: Yes. Please remove any old instances of the service and run
        this one..
     n: No. Please remove any old instances of the service, but don't
        run this one.

<userinput>y</userinpu>
</pre>

You will probably want to answer "yes" and have your VDT log files rotated. They can get rather large if you are running many jobs.


<pre class="screen">
Do you want to run a cron job that will update the CA certificate
revocation lists automatically? This will use the fetch-crl program
that comes with the VDT. The cron job will run at a random time
between midnight and 6:00am. We select a random time to avoid having
all VDT installations fetching CRLs at the same time.

Do you want to update the CA certification revocation lists (CRLs) automatically
? [y/n] <userinput>y</userinput>
</pre>

Most of the time answering "yes" to updating your CRLs automatically is preferred.

<pre class="screen">
The VDT typically installs public certificates and signing policy files
for the well-known public CA's. This is necessary in order for you to
perform GSI authentication with any remote Grid services (that have
service/host certificates signed by these CA's).

For more information please refer to the VDT documentation:
Where would you like to install CA files?

Choices:
        r (root)  - install into /etc/grid-security/certificates
                   (existing CA files will be preserved)
        l (local) - install into $VDT_LOCATION/globus/share/certificates
        n (no)    - do not install
</pre>

Answer =l= (lowercase "L") so that the CA files will be installed inside of your installation directory.

At this point you are almost done. The client will complete with the following output:

<pre class="screen">
The VDT version 1.6.1 has been installed.


The OSG Client package ITB version 0.5.2 has been installed.
</pre>


---+ Setup your grid user certificate

Log back on as yourself. Now that the OSG Client has been installed, you will have to configure it with your grid user certificate in order to start submitting jobs.  See [[Documentation/CertificateGet][How do I get or renew a !DOEGrids Digital PKI X509 Personal Certificate?]] to get one, and [[UserCertificate][Getting a PKI user certificate and preparing it for use with OSG]] to set it up for use with OSG, and to test it.

---+ Run a test
First, get a proxy certificate:
<pre class="screen">
> voms-proxy-init <i>or</i> 
> grid-proxy-init
</pre>
You will be prompted to enter your password.

Just to make sure your proxy is working, pick a known node and run =globusrun=. The node shown is just an example:
<pre class="screen">
> globusrun -a -r testwulf.hpcc.ttu.edu
</pre>
If successful, this returns:
<pre class="screen">
GRAM Authentication test successful
</pre>

---+ Start services
Logon as root. In the install directory, source the setup script:
<pre class="screen">
# source setup.[c]sh
</pre>
First register the services you'll need for condor-g submissions: =fetch-crl= and =condor=.
<pre class="screen">
# vdt-register-service --name fetch-crl --enable
# vdt-register-service --name condor --enable
</pre>
Then turn on the services:
<pre class="screen">
# vdt-control --on
</pre>
To see if a particular service got turned on, run
<pre class="screen">
# chkconfig --list | grep <service name>
</pre>
For example, using condor:
<pre class="screen">
# chkconfig --list | grep condor
</pre>
There's no reason to enable =vdt-rotate-logs= or =globus-ws=; the latter is an artifact of the VDT packaging.

---+ %RED%How to test condor-g? %ENDCOLOR%
%RED%
The test here doesn't work, and it's unclear what I'm testing.  I think what the user needs is to submit a condor-g job.
%ENDCOLOR%

Here's an example, shown for a fermigrid node (substitute the appropriate node):%BR%
%RED% AH got auth failure 9/5/07. %ENDCOLOR%
<pre class="screen">
> <userinput>globus-job-run fermigrid1.fnal.gov/jobmanager-condor /usr/bin/printenv</userinput>
HOME=/grid/home/fnalgrid
OSG_WN_TMP=/local/stage1
OSG_DATA=/grid/data

<replaceable>SNIP!</replaceable>

_CONDOR_ANCESTOR_3168=19619:1179931237:3100815932
_CONDOR_ANCESTOR_19619=19620:1179931237:3450294528
> 
</pre>
This is a handy diagnostic test to know for any job.

---+  Firewall Considerations
%RED% AH couldn't test this part %ENDCOLOR%

Some GRAM job initiation and management operations require call backs to the client machine. If your client is running a firewall blocking ephemeral ports, an ephemeral port range should be intentified for use and opened for incoming connections.  Opening the port range may depend on your firewall implementation.  Indentifying the port range in the client tools is done in two ways:

   * specifiy the GLOBUS_TCP_PORT_RANGE variable in the $VDT_LOCATION/setup.sh script:

 <pre class="screen">
GLOBUS_TCP_PORT_RANGE=20000,20200
export GLOBUS_TCP_PORT_RANGE
</pre>

   * specify range in for use by Condor-g in the $CONDOR_CONFIG file ( *Note:* condor must be restarted):

<pre class="screen">
HIGHPORT = 20200 
LOWPORT  = 20000
</pre>

%BR%
%COMPLETE3% %BR%
%RESPONSIBLE% Main.RobGardner - 17 Oct 2007 %BR%
%REVIEW% Main.RobGardner - 17 Oct 2007

%META:TOPICMOVED{by="ForrestChristian" date="1166046231" from="Integration.ClientInstallationGuide050" to="Integration/ITB_0_5.ClientInstallationGuide"}%
