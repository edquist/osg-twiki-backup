%META:TOPICINFO{author="SuchandraThapa" date="1261424488" format="1.1" reprev="1.6" version="1.6"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! %SPACEOUT{ "%TOPIC%" }%
%TOC%

---+++ Introduction
This page has the update and testing instructions for the osg 1.2.5 (osg-itb 1.1.16) update.


---+++ Installation 
Admins will need to install from the ITB cache.   If you have a previous installation, you can 

---+++ Updating from previous ITB release 
%NOTE% This only applies to upgrades from ITB 1.1.10 or more recent.

---++++ Preliminaries
Go to the directory where you installed your software (root directory of the Pacman installation, =VDT_LOCATION=) and source the setup script so that the following steps will work correctly.
<pre class="screen">
cd VDT_LOCATION
source setup.sh
</pre>

Make sure that your batch system binaries are in your PATH, especially if you are running SGE.

---++++ Stop VDT Services
Some packages (e.g. =client= or =wn-client=) may not be running any services, however, doing this step will not cause problems.  

<pre class="screen">
vdt-control --off
</pre>

---++++ Backup your software
<pre class="screen">
cp -a $VDT_LOCATION [BACKUP_LOCATION]
</pre>

---++++ Update the VDT updater script itself

Get the latest version of the vdt-updater script:
<pre class="screen">
pacman -update VDT-Updater
</pre>

Note: If you do not yet have the updater script (look for $VDT_LOCATION/vdt/sbin/vdt-updater), then fetch it with this command:
<pre class="screen">pacman -get %VDT_CACHE_URL%:VDT-Updater</pre>


---++++ Backup

Backup again since the vdt-updater script will request the location of your backup and verify that the backup is identical to the current contents of the install directory before updating your installation.
<pre class="screen">
cp -a $VDT_LOCATION BACKUP-LOCATION
</pre> 

---++++ Get VDT Updates
This will update VDT packages specifically.
<pre class="screen">
vdt/update/vdt-updater
</pre>

After updating, re-source the setup.sh file to load any changes in the environment:
<pre class="screen">
source setup.sh
</pre>

---++++ Get OSG Updates
The =osg-version= and =osg-config= packages must be updated on all OSG installations:
<pre class="screen">
pacman -update osg-version</verbatim>
cp $VDT_LOCATION/osg/etc/config.ini /tmp/config.ini-backup
pacman -update osg-config</verbatim>
cp /tmp/config.ini-backup $VDT_LOCATION/osg/etc/config.ini
</pre>


---++++ Post Install Configuration

<pre class="screen">
vdt-post-install
</pre>

On a CE, you will also need to reconfigure your system
<pre class="screen">
configure-osg -v
configure-osg -c
</pre>


---++++ Restart VDT Services
This step can be omitted if you are not running any services.  If you are not certain, you can run it since services are disabled by default so the only services that will be started are ones that you have explicitly enabled.
<pre class="screen">
vdt-control --on
</pre>



---+++ Testing and Validation

---++++ Testing configure-osg changes
The configure-osg code has been moved to the VDT cache and has been reorganized a bit.  You can test the changes by using configure-osg to configure your system and verifying that it ran without errors and that it has correctly configured your system.

If you'd like to change the =config.ini= changes, replace the =sitename= parameter in your =config.ini= with settings for =resource= and =resource_group=.  You should use the same values for these settings that you used in your OIM registration.


---+++++ Standalone storage configuration
In order to test, the standalone configurations, you'll need to install the =Xrootd=, =Bestman=, =Xrootdfs=, =Xrootd-GridFTP=, or =GridFTP= packages.  Then copy =$VDT_LOCATION/osg/etc/storage.ini= to =$VDT_LOCATION/osg/etc/config.ini=, set the appropriate options for your setup and run =configure-osg -c=.  Running =vdt-control --on= should automatically bring up your system.

---++++ RSV probe configuration / testing
The RSV changes in this release consist of moving the rsv probes into the VDT cache.  Testing the change consists of configuring your system using configure-osg and then verifying that your rsv probes are running correctly.


---+++ Open bugs and workarounds

---+++ How to report a bug?
Bug reports for the installation and documentation should be filed with GOC at [[https://ticket.grid.iu.edu/itb/open]].  *Please don't use the vdt support center or any other support center as the receipient since that will cause a email loop*


-- Main.SuchandraThapa - 15 Dec 2009
