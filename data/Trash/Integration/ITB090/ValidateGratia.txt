%META:TOPICINFO{author="KyleGross" date="1225985949" format="1.1" version="1.12"}%
%META:TOPICPARENT{name="SiteValidationTable"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

%STARTINCLUDE%
%BR%
---+ _%INCLUDEHEADING%  %SPACEOUT{ "%TOPIC%" }%_
%EDITTHIS%
%BR%

<!--

   * Set GratiaCollectorPort = %IF{"%CACHE% = OSG" then="8880" else="8881"}%

-->

---++ Gratia Probe

   * Ensure the batch system for which you have installed a probe has completed jobs and at least 10 minutes has elapsed.
   * Then, visit <noautolink><tt>http://gratia.opensciencegrid.org:%GratiaCollectorPort%/gratia-administration/monitor-status.html?sitename=my-site</tt></noautolink> to check that your probe is reporting (eg working example link: http://gratia.opensciencegrid.org:%GratiaCollectorPort%/gratia-administration/monitor-status.html?sitename=FNAL_FERMIGRID_ITB).
   * Note that this status page may show multiple probes, some of which may be obsolete. One way this can arise is that old installations may identify a probe as =pbs-lsf:myhost.mydomain=, whereas new installations identify a probe as =pbs:myhost.mydomain= or =pbs-lsf:myhost.mydomain= as appropriate. Please [[mailto:gratia-operation@opensciencegrid.org?subject=Please%20Mark%20Obsolete%20Probe%20Inactive][notify the Gratia team]] and we will correct the record.
   * If you get no entry at all, double-check by using the probe name (=MeterName= in the =ProbeConfig= file: usually "probe-type:dns-name"), viz:%BR%<noautolink><tt>http://gratia.opensciencegrid.org:%GratiaCollectorPort%/gratia-administration/monitor-status.html?probename=probe-type:myhost.mydomain</tt></noautolink>.%BR%  The reason for the fallback is: if Gratia has seen a probe by this name before (previous installation, for instance) it will use the old site name for accounting purposes until [[mailto:gratia-operation@opensciencegrid.org?subject=Changed%20Site%20Name][we are notified]] otherwise. Working example link: http://gratia.opensciencegrid.org:%GratiaCollectorPort%/gratia-administration/monitor-status.html?probename=condor:fngp-osg.fnal.gov.
   * As a last resort, peruse the [[http://gratia.opensciencegrid.org:%GratiaCollectorPort%/gratia-administration/monitor-status.html?allsites=1][whole list]] of reporting probes.
   * If you are still unable to find evidence that your probe has contacted the collector, download [[https://twiki.grid.iu.edu/twiki/bin/viewfile/Accounting/TroubleShootingInstructions?filename=gratia-site-diag][<tt>gratia-site-diag</tt>]] and run it to diagnose possible problems. Report same immediately; see [[Accounting.TroubleShootingInstructions][Gratia troubleshooting instructions]] for more details.
   * Assuming you find evidence of recent contact using one of the methods above, you may wish to further verify the receipt of real records by obtaining a report from the [[http://gratia.opensciencegrid.org:%GratiaCollectorPort%/gratia-reporting/][Gratia reporting site]], for example [[http://gratia.opensciencegrid.org:%GratiaCollectorPort%/gratia-reporting/index.jsp?link=GratiaParameterInput.jsp?report=/data/tomcat-gratia/webapps/gratia-reports/reports/DailyUsageByVOForSite.rptdesign,DisplayMetric=wallclock,reportTitle=Daily%20Usage%20by%20VO%20for%20Site][Daily jobs by VirtualOrganizations/VOInfo for site]] from the main Gratia reporting service. Also, Run the special SQL query "Probe / Local UID combinations corresponding to Unknown VirtualOrganizations/VOInfo in the last week" and check for a large number of OSG-like user names that are being mapped to the Unknown VO. This indicates a problem either with the !ProbeConfig knowing the location of the osg-user-vo-map.txt or with the reverse map file itself. Please investigate and [[mailto:gratia-operation@opensciencegrid.org?subject=Unknown%VirtualOrganizations/VOInfo%Reporting%Problem][report to the the Gratia team]].

---++ Gratia Collector

   * Check that the reporting is operational: <noautolink><tt>http://mygratiahost.example.com:port/gratia-reporting/</tt></noautolink>.
   * Check that the administration page is operational: <noautolink><tt>http://mygratiahost.example.com:port/gratia-administration/</tt></noautolink>.
   * Configure a probe to send to the collector (set =SOAPHost= appropriately) and check the above pages for entries.
   * If there is no evidence of received data, check <noautolink><tt>$VDT_LOCATION/tomcat/v55/logs/gratia-0.log</tt></noautolink> and <noautolink><tt>$VDT_LOCATION/tomcat/v55/logs/catalina.out</tt></noautolink>. An "empty data set" exception and/or blank report page is OK; everything else should be reported to [[mailto:gratia-operation@opensciencegrid.org?subject=Problems%20with%20VDT%20install%20of%20collector][the Gratia team]].

%STOPINCLUDE%
%BR%
%COMPLETE3% %BR%
%RESPONSIBLE% Main.ChrisGreen - 08 Nov 2007 %BR%
%REVIEW%

%META:TOPICMOVED{by="AnneHeavey" date="1192748528" from="Integration/ITB_0_7.ValGratia" to="Integration/ITB_0_7.ValidateGratia"}%
