%META:TOPICINFO{author="KyleGross" date="1225985949" format="1.1" version="1.15"}%
%META:TOPICPARENT{name="VomsInstallGuide"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

%STARTINCLUDE%
%BR%
---+ _%INCLUDEHEADING%  %SPACEOUT{ "%TOPIC%" }%_
%EDITTHIS%
%BR%
Several things have to be done to actually enable your VirtualOrganizations/VOInfo to begin accepting membership, process voms proxy requests, and used to retrieve membership lists for the various [[ComputeElementAuthorization][authorization modes]] used on the compute (CE) and storage (SE) element  nodes.

The following sub-sections will reference the default =VDT= in the text and examples.  When enabling your 'real' VO, the same steps are required and, where different, it will be noted.

*Note:* If you are using VirtualOrganizations/VOInfoMRS to manage your VirtualOrganizations/VOInfo membership, there is no need for a VirtualOrganizations/VOInfoMS administrator.  The only item that must be performed is to enable read-only access to your VirtualOrganizations/VOInfo for the GUMS service and/or =edg-mkgridmap= services.  For more information on VirtualOrganizations/VOInfoMRS, refer to the [[IntroducingVOMRS][Introducing VirtualOrganizations/VOInfoMRS]] topic.


---++ Enabling read-only access to your VO
An  ACL needs to be created with ="CONTAINER_READ,MEMBERSHIP_READ"= capabilities for anyone that presents a certificate issued by a known VO.  The purpose for this is two-fold:
   * Those sites using [[InstallConfigureAndManageGUMS][GUMS servers]] will be able to access your VirtualOrganizations/VOInfo without the VirtualOrganizations/VOInfo-Admin having to individually provide this  =ACL= capability on a case by case basis.  
   * It allows VirtualOrganizations/VOInfo members or (those that think they are VirtualOrganizations/VOInfo members) to query the VirtualOrganizations/VOInfoMS to troubleshoot problems in getting voms proxies and verify their membership in various groups and role assignments.

*Note:* - this *is required* even if you are using VirtualOrganizations/VOInfoMRS. 

To enable read-only access, execute the following command:
<pre class="screen">
&gt; source $VDT_LOCATION/setup.sh
&gt; voms-admin --nousercert --vo <b><i>VDT</b></i> add-ACL-entry \
    /<b><i>VDT</b></i> \
   ANYONE VOMS_CA \
   "CONTAINER_READ,MEMBERSHIP_READ" \
   true
</pre>
The =ANYONE= and =VOMS_CA= arguments are keywords used in VirtualOrganizations/VOInfoMS to denote " =anyone with a valid certificate= ".

*Note:* - If you are *NOT* using VirtualOrganizations/VOInfoMRS , then you must continue with the remaining configuration steps.

---++ Establishing a VirtualOrganizations/VOInfo-Admin
A person (or persons) can be designated as the VirtualOrganizations/VOInfo-Admin for the VirtualOrganizations/VOInfoMS VirtualOrganizations/VOInfo created.  This person(s) has administrative capability within VirtualOrganizations/VOInfoMS that the normal VirtualOrganizations/VOInfo member will not have.  

*Note:* - this is *not* required if you are using VirtualOrganizations/VOInfoMRS.

If you are doing this for the first time as the =root= user, you may have to set a couple variables.  Try it without setting them, but if you get an =access denied=  message, this should resolve the problem.
<pre class="screen">
&gt; export X509_USER_CERT=/etc/grid-security/http/httpcert.pem
&gt; export X509_USER_KEY=/etc/grid-security/http/httpkey.pem
</pre>

There are 2 options for adding this capability to an individual:
<ol>
  <li>The individual *is not* a member of the VO.%BR%
    An ACL for that individual with _full rights_ permissions allows a person to administer the VirtualOrganizations/VOInfo's VirtualOrganizations/VOInfoMS from the command line and WEB UI.
    <ul>
      <li>If the individual's certificate file is available:
<pre class="screen">
&gt; source $VDT_LOCATION/setup.sh
&gt;  voms-admin --usercert  <b><i>usercert.pem</i></b> --vo <b><i>VDT</i></b> add-ACL-entry /<b><i>VDT</i></b> ALL true
</pre>
      </li>
      <li>Individual's certificate file is *not* available:
<pre class="screen">
&gt;  voms-admin --nousercert --vo <b><i>VDT</i></b> add-ACL-entry /<b><i>VDT</i></b>  "<b><i>USER DN</b></i>"  "<b><i>USER CA</b></i>"  ALL true
</pre>
      </li>
    </ul>
  </li>
  <li>The individual <u>is</u> a member of the VO.  This can be accomplished by giving the individual the =ACL= capability above or by first adding them to the VirtualOrganizations/VOInfo as a member (described in the next section) and then assigning them the =VirtualOrganizations/VOInfo-Admin= role with the following command:
    <ul>
      <li>Individual's certificate file is available:     
<pre class="screen">
&gt; voms-admin --usercert <b><i>usercert.pem</b></i> --vo <b><i>VDT</b></i> assign-role /<b><i>VDT</b></i> VO-Admin 
</pre>
	  </li>
      <li>Individual's certificate file is <u>not</u> available:
<pre class="screen">
&gt; voms-admin --nousercert --vo <b><i>VDT</b></i> assign-role  /<b><i>VDT</b></i> VO-Admin "<b><i>USER DN</b></i>" "<b><i>USER CA</b></i>"
</pre>
	  </li>
    </ul>
  </li>
</ol>

---++ Adding  a user to the VO
Individuals with the =VirtualOrganizations/VOInfo-Admin= role or the  =ALL= ACL are referred to as VirtualOrganizations/VOInfo Managers in VirtualOrganizations/VOInfoMS and are the only ones who can add new members via the web UI.

*Note:* - this is *not* required if you are using VirtualOrganizations/VOInfoMRS.

In normal practice, users will request VirtualOrganizations/VOInfo membership by accessing the =New user registration= menu item on the main VirtualOrganizations/VOInfoMS web page.  This document will not go into the details of that process here, nor will it address the basic usage and navigation of the VirtualOrganizations/VOInfoMS web ui.

The purpose of this section is to show you how to add a user for the purposes of assigning the =VirtualOrganizations/VOInfo-Admin= role as a part of the initial setup.   

Four data items are required for each user:
   * DN
   * CA
   * Common Name (CN part of the DN or just 1st and last name so you can be easily identified)
   * email address 


If you have the user's certificate file available, then these 4 items are derived from that.
<ul>
  <li>Individual's certificate file is available:     
<pre class="screen">
&gt; voms-admin --vo <b><i>VDT</b></i> create-user <b><i>usercert.pem</b></i>
</pre>
  </li>
  <li>Individual's certificate file is *not* available:
<pre class="screen">
&gt; voms-admin --nousercert --vo <b><i>VDT</b></i> create-user "<b><i>USER DN</b></i>" "<b><i>USER CA</b></i>" "<b><i>USER CN</b></i>" "<b><i>USER EMAIL</b></i>"
</pre>
  </li>
</ul>
This adds the individual to the top level group or VO, e.g. =VDT= in this case.

If you have added the user for the purpose of assigning the =VirtualOrganizations/VOInfo-Admin= role, you will want to re-visit [[VomsInstallGuide#Establishing_a_VO_Admin][Establishing a VirtualOrganizations/VOInfo-Admin]] to assign the role.


---++ Verifying you are a VirtualOrganizations/VOInfo-Admin
If you've established yourself with the =VirtualOrganizations/VOInfo-Admin= role or with the =ALL= ACL, you can now go back the VirtualOrganizations/VOInfoMS WEB UI in a browser with your certificate:
   1. You will be on a =Welcome to ...= page showing your VirtualOrganizations/VOInfo membership information.
   1. Select =VirtualOrganizations/VOInfo management= in the top menu
   1. Then under the =Manage= menu, select =Groups=
   1. Then, select the =root= group which is your the VirtualOrganizations/VOInfo name ( =VDT= in this example)
   1. You should then see the =Access control list (ACL)= that the above steps have defined.

The VirtualOrganizations/VOInfoMS Admin User's Guide can be accessed at https://twiki.cnaf.infn.it/cgi-bin/twiki/view/VirtualOrganizations/VOInfoMS/WebDocumentation .

*Note:* - this is *not* required if you are using VirtualOrganizations/VOInfoMRS.

<!--
Main.JohnWeigand - 27 Feb 2007
-->


%STOPINCLUDE%
%BR%
%COMPLETE3% %BR%
%RESPONSIBLE% Main.JohnWeigand - 23 Oct 2007 %BR%
%REVIEW% Main.RobGardner - 08 Nov 2007 %BR%
%REVCOM% Added references to VirtualOrganizations/VOInfoMRS. Needs re-review.

<!--
 Main.JohnWeigand - 12 Nov 2007
-->