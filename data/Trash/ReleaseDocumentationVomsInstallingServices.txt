%META:TOPICINFO{author="TerrenceMartin" date="1290198971" format="1.1" version="1.37"}%
%META:TOPICPARENT{name="VomsInstallGuide"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%DOC_STATUS_TABLE%
%TOC%


%STARTINCLUDE%
%BR%

%EDITTHIS%
%BR%


---++ Installation user
Must be done as root.

---++ Installation package
After installing pacman:

<pre class="screen">
# <b>cd <i>PACMAN_DIR</i></b>
# <b>source setup.sh</b>
</pre>

---++ Installation location
Wherever you like.  Shown below as a directory under =/usr/local/osg=.  Here we'll call it =voms=. Then set the VDT_LOCATION variable to that directory.

<pre class="screen">
# <b>VDT_LOCATION=/usr/local/osg</b>
# <b>mkdir voms</b>
# <b>export VDT_LOCATION=/usr/local/osg/voms</b>
</pre>

---++ Installation Cache
<pre class="screen">
# cd $VDT_LOCATION
# pacman -get  %CACHE%:voms
# source setup.sh
# vdt-post-install
</pre>



---++ Installation output/questions
In this release, the only questions that may appear are related to 'trusted caches' and 'unrecognized platforms' depending on your host. 

The _pacman_ variables that were used to pre-answer questions are now ignored. 

<pre class="screen">
Do you want to add [http://software.grid.iu.edu/pacman/] to [trusted.caches]? (y or n): <b> y </b>
Package [voms] found in [OSG]...
Do you want to add [http://vdt.cs.wisc.edu/vdt_1101_cache] to [trusted.caches]? (y or n): <b>y</b>
Package [VOMS] found in [http://vdt.cs.wisc.edu/vdt_1101_cache]...
...
Downloading [VOMS-1.10.1.tar.gz] from [http://vdt.cs.wisc.edu/software/questions/1.10.1]...

VDT 1.10.1 installs a variety of software, each with its own license.
In order to continue, you must agree to the licenses.
You can view the licenses online at:

     http://vdt.cs.wisc.edu/licenses/1.10.1

After the installation has completed, you will also be able to
view the licenses in the "licenses" directory.

Do you agree to the licenses? [y/n]  <b>y</b>

---------  1  ------------

Do you want to run a cron job that will update the CA certificate
revocation lists automatically? This will use the fetch-crl program
that comes with the VDT. The cron job will run at a random time
between midnight and 6:00am. We select a random time to avoid having
all VDT installations fetching CRLs at the same time.

Do you want to update the CA certification revocation lists (CRLs) automatically? <b>y</b>

--------  2 -------------

Several services provided by the VDT create unbounded log files.  If you wish, we can rotate those file on a daily basis.

Would you like to setup daily rotation of VDT log files?

Possible answers:
    y: Yes, I want the service to run automatically (once enabled)
    n: No, I do NOT want the service to run automatically
Note: Services are enabled with vdt-control; see 'post-install/README'.
<b>y</b>

---------  3  ------------
If you would like, we can configure VOMS to start automatically
at boot time.

Configuring the VOMS daemon requires
  - changes to /etc/init.d (or /etc/rc.d/init.d)
  - starting up a MySQL server
  - starting up an Apache and Tomcat server

Would you like to enable the VOMS server to run automatically?

Possible answers:
    y: Yes, I want the service to run automatically (once enabled)
    n: No, I do NOT want the service to run automatically
Note: Services are enabled with vdt-control; see 'post-install/README'.
<b>y</b>

---------  4  ------------

Do you want to automatically update your CA certificates? If so,
we will check for updates once a day via cron.

Do you want to automatically update your CA Certificates? [y/n]  <b>y</b>

---------  5  ------------

The VDT typically installs public certificates and signing policy files
for the well-known public CA's. This is necessary in order for you to
perform GSI authentication with any remote Grid services (that have
service/host certificates signed by these CA's).

For more information please refer to the VDT documentation:
http://vdt.cs.wisc.edu/releases/1.10.0/setup_ca.html

Where would you like to install CA files?

Choices:
        r (root)  - install into /etc/grid-security/certificates
                   (existing CA files will be preserved)
        l (local) - install into $VDT_LOCATION/globus/share/certificates
        n (no)    - do not install
<b>l</b>

---------------------

...
Downloading [voms-client-1.8.3-x86_rhas_3.tar.gz] from [http://vdt.cs.wisc.edu/software//voms/1.8.3-2]...
Downloading [configure_voms-1-465.tar.gz] from [http://vdt.cs.wisc.edu/software//configure_voms/1]...
Downloading [voms-server-1.8.3-x86_rhas_3.tar.gz] from [http://vdt.cs.wisc.edu/s
</pre>

The above line should be the last line of output you see.  The version number of the tarball may be different than that shown above.  Do not be concerned with this.

%INCLUDE{"CaCertificatesInstall" section="InstallACertificateAuthorityPackage"}%

---++ Verify the  installation completed successfully
To verify  the VOMS installation was successful, there should be a setup.(c)sh in the VDT_LOCATION.  Source it.

<pre class="screen">
# <b>cd $VDT_LOCATION</b>
# <b>source setup.sh</b>
</pre>

%IMPORTANT% This does not necessarily indicate that everything was installed and configured successfully.  It just verifies that the pacman installation of VOMS completed successfully.  There is a lot of other "magic" that occurs during the process that should be validated. We'll take you through that process.

---++ Starting VOMS
With this release all services are initially disabled so you will have to enable them manually as follows:
<pre class="screen">
# cd $VDT_LOCATION
# source setup.sh
# vdt-control --enable fetch-crl
# vdt-control --enable vdt-update-certs
# vdt-control --enable vdt-rotate-logs
# vdt-control --enable mysql5
# vdt-control --enable apache
# vdt-control --enable tomcat-55
# vdt-control --enable voms 
</pre>
%NOTE% The voms service will not exist until you have created the VO.

In order to turn the VOMS services on, you have to perform the following action:
<pre class="screen">
# <b>cd $VDT_LOCATION</b>
# <b>source setup.sh</b>
# <b>vdt-control --on</b>
enabling cron service fetch-crl... ok
enabling cron service vdt-rotate-logs... ok
enabling cron service vdt-update-certs... ok
enabling init service mysql5... ok
enabling init service apache... ok
enabling init service tomcat-55... ok
enabling init service voms... ok
</pre>


%STOPINCLUDE%

---++ *Comments*
%COMMENT{type="tableappend"}%

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = StevenTimm

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = VO

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Installation
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%


 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = TerrenceMartin
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %IN_PROGRESS%


DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = MarcoMambelli
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %IN_PROGRESS%

############################################################################################################
-->