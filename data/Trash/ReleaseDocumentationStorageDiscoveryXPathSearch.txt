%META:TOPICINFO{author="DouglasStrain" date="1284059490" format="1.1" version="1.9"}%
%META:TOPICPARENT{name="ReleaseDocumentation.OSGStorageDiscoveryTool"}%
%DOC_STATUS_TABLE%
https://twiki.grid.iu.edu/twiki/pub/Storage/WebHome/images.jpg
---+!! *<noop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

This utility performs a search on the Open Science Grid BDII using XPath expressions. The command line format of the utility is as follows.

<verbatim>
xpathsearch [-H <PROTOCOL://HOST:PORT>] [-b <BASE>] [options] "xpathexpression"
</verbatim>

Available options:


%TWISTY{%TWISTY_OPTS_REVIEW%}%
The formatting below is a bit strange.  In particular, I would change the spacing of -action so that each option is on a different line, so it is easier to read and see what the options are.  Same formatting comments go for the -output flag.  The way it is set up, it is tough to tell what the possible values are.
This looks like it was just cut and pasted from the usage statement.
%ENDTWISTY%

<verbatim>
 -a,--output_all_ldap_attributes   Output all queried attributes of each
                                   LDAP objectclass
 -action <ACTION>                  action to perform. Choose from-action
                                   evaluate (Evaluate xpath expression.
                                   Default.)-action not_evaluate (Do not
                                   evaluate xpath expression)-action
                                   search (Perform a search over element
                                   and attribute names)
-b <BASE>                          base for LDAP search, e.g.  -b o=grid 
                                   Optional if the environment variable  
                                   LDAP_BASE is set.                     
 -d,--output_ldap_dn               Output the dn of each LDAP objectclass
-H <PROTOCOL://HOST:PORT>          host_uri for search. Example: -H      
                                   ldap://iu.grid.ui.edu:2710            
                                   Optional if the environment variable  
                                   LDAP_URI is set.                      
 -h,--help
 -i,--interactive                  Process the expressions interactively
 -output <OUTPUT>                  output format. Choose from-output list
                                   (Write search results as a line-feed
                                   separated list. Default.)-output xml
                                   (Write search results in xml
                                   format)-output source_xml (Write
                                   intermediate xml from datasource)
 -t,--test                         Run the unit tests
 -u,--use_ldap_aux                 Use auxilary LDAP classes
 -v,--version
</verbatim>

For example

<verbatim>
[xquery]$ xpathsearch -H ldap://is.grid.iu.edu -b o=grid -output_ldap_dn "//GlueSE[@GlueSEUniqueID='se1.accre.vanderbilt.edu']/GlueSA/GlueVOInfo[@GlueVOInfoAccessControlBaseRule='engage']/@GlueVOInfoPath"
GlueVOInfoLocalID=engage:default,GlueSALocalID=default,GlueSEUniqueID=cit-se2.ultralight.org,Mds-Vo-name=CIT_CMS_T2,Mds-Vo-name=local,o=grid
/mnt/hadoop/osg
</verbatim>

%TWISTY{%TWISTY_OPTS_REVIEW%}%
I am not too familiar with XQuery or Xpath and only have a basic idea about the GLUE schema, but the above command is pretty cryptic for me.  I think it could use some explanation as well as some supporting links (maybe to glue schema or to Xpath information).

It also fails when I try to run it (is it supposed to be all on one line?):
<pre>
[dstrain@gw014k0 discovery]$ xpathsearch -H ldap://is.grid.iu.edu -b o=grid -output_ldap_dn "//GlueSE[@GlueSEUniqueID=\'se1.accre.vanderbilt.edu\']/GlueSA/GlueVOInfo[@GlueVOInfoAccessControlBaseRule=\'engage\']/@GlueVOInfoPath" GlueVOInfoLocalID=engage:default,GlueSALocalID=default,GlueSEUniqueID=cit-se2.ultralight.org,Mds-Vo-name=CIT_CMS_T2,Mds-Vo-name=local,o=grid /mnt/hadoop/osg  
</pre>

I get:
<pre>
SEARCH /mnt/hadoop/osg
java.lang.NullPointerException
        at gov.fnal.xpath2ldap.DSMLTransform.xformDSMLToStructuredXML(DSMLTransform.java:104)
        at gov.fnal.xpath2ldap.XPathLDAPEvaluator.search(XPathLDAPEvaluator.java:93)
        at gov.fnal.xpath2ldap.XPathSearch.processXPathExpression(XPathSearch.java:91)
        at gov.fnal.xpath2ldap.XPathSearch.processXPathExpression(XPathSearch.java:76)
        at gov.fnal.xpath2ldap.XPathSearch.main(XPathSearch.java:66)
0

-1
-1
0
</pre>

Since there was no explanation, I have no idea why this failed or what it was trying to do.  Why is there an LDAP expression and directory after the quoted xpathexpression in the command?  According to the above documentation, there 

%ENDTWISTY%

%TWISTY{%TWISTY_OPTS_REVIEW%}%
I feel like there should be some explanation of the output of this command.  It spits out tons of information in an illegible format and its tough to figure out what all this is.  It looks like it is printing the LDAP search commands (ie. "SEARCH //GlueSE/@GlueSEUniqueID='se1.accre.vanderbilt.edu'") interspersed with LDAP output with no helpful column headers. 

I think an annotated example output with explanation (like how you do for other discovery tools pages) could really help here.
%ENDTWISTY%


Note that for the bash shell, single quote marks must be escaped and the whole xpath expression must be in quotes. In this case the "output_ldap_dn" option is used, so that the dn of the parent structural element is printed along with the specified attribute value.

%TWISTY{%TWISTY_OPTS_REVIEW%}%
Maybe a quick example of each of the above examples would be helpful?  

Also, the sentence "In this case the "output_ldap_dn" option is used, so that the dn of the parent structural element is printed along with the specified attribute value." is confusing.  In what case are you talking about?  The above command?
%ENDTWISTY%


-- Main.TedHesselroth - 30 Jul 2009

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = TedHesselroth 

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Integration|Operations|Tier3)
   * Local DOC_AREA       = Storage

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = EndUser

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = HowTo
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %YES%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %NO%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = TanyaLevshina
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %IN_PROGRESS%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = DouglasStrain
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %IN_PROGRESS%
############################################################################################################
-->

%META:TOPICMOVED{by="TedHesselroth" date="1271192598" from="Storage.StorageDiscoveryXPathSearch" to="ReleaseDocumentation.StorageDiscoveryXPathSearch"}%
