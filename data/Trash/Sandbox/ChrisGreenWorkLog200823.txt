%META:TOPICINFO{author="ChrisGreen" date="1214240823" format="1.1" reprev="1.14" version="1.14"}%
%META:TOPICPARENT{name="ChrisGreenWorkLog"}%
%LINKCSS%

<!-- Hidden Settings
   * Set USERSTYLEURL = %PUBURL%/%WEB%/ChrisGreenWorkLog/worklog-style.css
   * Set LinksTable = <table width="60%"><tr><td>[[#%TOPIC%_Fermigrid_Operations][Fermigrid Operations]]</td><td>[[#%TOPIC%_Gratia][Gratia]]</td><td>[[#%TOPIC%_Other][Other]]</td></tr><tr><td>[[#Top][Top of work log]]</td><td>[[#Bottom][Bottom of work log]]</td></tr></table>
-->

---+!! Chris Green's personal work log for 2008/06/09 - 2008/06/20

<!-- Day's skeleton
  <dt></dt>
  <dd>
    <ul>
      <li></li>
      <li></li>
    </ul>
  </dd>
-->

%STARTINCLUDE%
%EDITTHIS%

%LinksTable%

---+++!! <a name="%TOPIC%_Fermigrid_Operations">Fermigrid Operations</a>
<dl>
  <dt>2008/06/20</dt>
  <dd>
    <ul>
      <li>Answer Neha's question about source RPM location for Gratia probes.</li>
    </ul>
  </dd>
  <dt>2008/06/18</dt>
  <dd>
    <ul>
      <li>Long discussion with Keith and Dan about Gratia and splunk -- continued in meeting. Resolved to talk to Neha about a cron script on the collector to dump files collected in the last hour from the history-* directory into a single file which is then tailed by splunk. Log rotation is left as an exercise for the implementer.</li>
      <li>Long discussion with Dan about !Gratia ops and related setup.</li>
    </ul>
  </dd>
  <dt>2008/06/17</dt>
  <dd>
    <ul>
      <li>Alleviate load on gratia06 DB:
      <ul><li>Brian B. switched over to gratia07.</li>
          <li>Investigate possibility of truncating backups today. Can't, because we don't have backups saved due to combination of broken (until yesterday) failure of scp to gratia07 and over-zealous clean-up of older backups on gratia06.</li></ul></li>
      </li>
      <li>Follow-up chat with Neha about syslog-ng and Gratia.</li>
      <li>Investigate higher than usual rate of input of records to Gratia production over the last few hours -- following queries show that it was clearing a backlog caused by earlier backup and upgrade activities.%BR%<verbatim>select date_format(`Time (m)`, '%Y-%m-%d %H:00:00') as `Time (h)`,
       sum(`No. Records`) as `No. Records`,
       avg(`Rate (/h)`) as `Avg Rate (/h)`
from (select date_format(ServerDate, '%Y-%m-%d %H:%i') as `Time (m)`,
             count(*) as `No. Records`,
             count(*) * 60 as `Rate (/h)`
from JobUsageRecord_Meta M
where ServerDate > '2008-06-16 00:00:00'
group by `Time (m)`) time_table
group by `Time (h)`
order by `Time (h)` desc;</verbatim><verbatim>select date_format(`Time (m)`, '%Y-%m-%d %H:00:00') as `Time (h)`,
       sum(`No. Records`) as `No. Records`,
       avg(`Rate (/h)`) as `Avg Rate (/h)`
from (select date_format(CreateTime, '%Y-%m-%d %H:%i') as `Time (m)`,
             count(*) as `No. Records`,
             count(*) * 60 as `Rate (/h)`
from JobUsageRecord_Meta M
where ServerDate > '2008-06-16 00:00:00'
group by `Time (m)`) time_table
group by `Time (h)`
order by `Time (h)` desc;</verbatim></li>
    </ul>
  </dd>
  <dt>2008/06/16</dt>
  <dd>
    <ul>
      <li>Responded to request from Neha for location of Gratia files on gratia09 for security audit. See IM logs <a class="private" href="http://127.0.0.1:4664/redir?url=http%3A%2F%2F127%2E0%2E0%2E1%3A4664%2Fcache%3Fevent%5Fid%3D829197%26schema%5Fid%3D3%26q%3Dneha%26s%3D%2Du%2Dzyxve8SVMv%5FjjkQrgNGpuyGI&src=1&schema=3&s=ftvkdL4DYcR-odB8udi-X2GqFp8">1</a> & <a class="private" href="http://127.0.0.1:4664/redir?url=http%3A%2F%2F127%2E0%2E0%2E1%3A4664%2Fcache%3Fevent%5Fid%3D829240%26schema%5Fid%3D3%26q%3Dneha%26s%3DFGpxjoNUG7EnnDQhSxxSkjEc9r8&src=1&schema=3&s=1rS-yFzqeuljVILM3HpMaghz8-I">2</a></li>
      <li>Diagnostics on state of fermi_osg -- John was worried because of lack of summary table records. This is due to glexec records being ignored, and no non-glexec records being sent to fermi_osg. Older records have a !RecordType of Batch even though they're glexec, so they ended up in the summary table.</li>
      <li>Gratia07 DB is now in a state that we can replicate records to it from gratia06 as part of the upgrade. This is now happening. Use following query to track progress:%BR%<verbatim>select date_format(`Time (m)`, '%Y-%m-%d %H:00:00') as `Time (h)`,
       sum(`No. Records`) as `No. Records`,
       avg(`Rate (/h)`) as `Avg Rate (/h)`
from (select date_format(ServerDate, '%Y-%m-%d %H:%i') as `Time (m)`,
             count(*) as `No. Records`,
             count(*) * 60 as `Rate (/h)`
from JobUsageRecord_Meta M
where ServerDate > '2008-06-16 00:00:00'
group by `Time (m)`) time_table
group by `Time (h)`
order by `Time (h)` desc;</verbatim></li>
      <li>Philippe reported seeing duplicates on gratia07, which was not expected. Turns out this is reasonable, since if gratia06 gets a "better" description of a given job than it already has, it will delete the old one, save the new one and that new one will be replicated to gratia07 where the same process takes place. As it happens, certain types of record (where !CommonName starts with "Generic") may have an identical duplicate identified as, "better" thus triggering an unnecessary replacement; however this is a small inefficiency and shall be corrected in a future release.</li>
      <li>Sent a mail to Arvind about !SBGrid's reporting of metric records to our collector instead of IUs. Nothing since Friday, which could be good.</li>
    </ul>
  </dd>
  <dt>2008/06/12</dt>
  <dd>
    <ul>
      <li>Meeting with Keith and Mine to discuss splunk-offload of incoming XML files from gratia09. Warned Mine about susceptibility of Condor records to malicious attack by the user.</li>
    </ul>
  </dd>
  <dt>2008/06/11</dt>
  <dd>
    <ul>
      <li>Checked in configuration script changes for tomcat init script upgrade.</li>
    </ul>
  </dd>
  <dt>2008/06/10</dt>
  <dd>
    <ul>
      <li>Helped Dan and Steve with regex for killing glexec starters on CDF nodes.</li>
      <li>Updated tomcat init script to optionally start tomcat as a non-root user (still to check in).</li>
    </ul>
  </dd>
  <dt>2008/06/09</dt>
  <dd>
    <ul>
      <li>Talked to Keith about splunk, Gratia and Condor.</li>
    </ul>
  </dd>
</dl>

%LinksTable%

---+++!! <a name="%TOPIC%_Gratia">Gratia</a>
<dl>
  <dt>2008/06/20</dt>
  <dd>
    <ul>
      <li>Investigate problems with 0.34.10 (BIRT upgrade). Replace with latest stable release; debug with Penelope; implement workaround; eventually abort release due to problems with BIRT pass-through of !JavaScript from report design to !JavaScript interpreter.</li>
      <li>Discussions with Philippe on implementation details and work division for job level record purging in 0.36.</li>
      <li>Agree on properties names for purging lifetimes.</li>
      <li>Remove references to summary table rebuilding. Not yet checked in.</li>
    </ul>
  </dd>
  <dt>2008/06/19</dt>
  <dd>
    <ul>
      <li>Discussions with Philippe and Gabriele on objectives and scope of feature implementation for 0.36.</li>
      <li>Following discussion with Jason Ormes, implement "not ready" response in servlet for safe mode start. Complete work and initial testing./li>
    </ul>
  </dd>
  <dt>2008/06/18</dt>
  <dd>
    <ul>
      <li>Work on query for Vicky with Keith.</li>
      <li>Attend Gratia meeting.</li>
      <li>Update BIRT reporting engine to 2.3.0-S20080618 to resolve incompatibility with Firefox 3.0</li>
      <li>Update duplicate resolution in !ChecksumUpgrader to match improvements to !ListenerThread. Also improve log level of various messages.</li>
    </ul>
  </dd>
  <dt>2008/06/17</dt>
  <dd>
    <ul>
      <li>Discussion with Philippe regarding state of upgrades.</li>
      <li>Discussion with Philippe regarding summary table upgrades. Need four new columns for housekeeping: "Immutable" (0/1); "{min,max}RecordServerDate" and "SummaryServerDate."</li>
      <li>Brief chat with Marc Mengel about tomcat -- not able to help.</li>
      <li>Finish and test improvements to duplicate resolution and !DupRecord entries. Checked in.</li>
      <li>Safe mode now complete except for web interface -- use simple flag passed by !CollectorService and return error to probe until we're enabled.</li>
    </ul>
  </dd>
  <dt>2008/06/16</dt>
  <dd>
    <ul>
      <li>Diasgnostics on state of tomcat-conversion for John. Upgrade had failed due to connection timeout after summary table rebuild. Corrected relevant entry in !SystemProplist and restarted collector. Now up after completing upgrade and accepting replication records from gratia06 -- transferred to [[#%TOPIC%_Fermigrid_Operations][Ops]] log entries.</li>
      <li>Continued working on safe start mode. Talked to Jason Ormes about possibilities: settled on falling back to flag operation with manual "error -- not ready" response to incoming posts.</li>
      <li>Coded up a scheme to enable !DupRecord entries for older records replaced by better new ones to have the correct dbid entry. Needs testing. Not yet checked in.</li>
      <li>Coded up a better check for better versions of an existing record to avoid unnecessary replacements. Needs testing. Not yet checked in.</li>
      <li>Email and IM correspondence with Philippe and Merina over new Rocks install with ps-accounting RPMs. Sent email about possibly needing glexec; no reply yet.</li>
    </ul>
  </dd>
  <dt>2008/06/13</dt>
  <dd>
    <ul>
      <li>Discussion with Philippe on summary table replication and related issues. See <a class="private" href="http://127.0.0.1:4664/cache?event_id=815885&schema_id=3&q=replication&s=NX0DiRBU6YXLse045YNd6VzXETg">IM log</a> for details.</li>
      <li>More work on safe start.</li>
    </ul>
  </dd>
  <dt>2008/06/12</dt>
  <dd>
    <ul>
      <li>Check status on gratia07 upgrade: still adding first of 2 columns.</li>
      <li>Discussion with Philippe on RMI service control and master switch.</li>
      <li>Work on safe mode start.</li>
    </ul>
  </dd>
  <dt>2008/06/11</dt>
  <dd>
    <ul>
      <li>Weekly status report for Philippe.</li>
      <li>Review and update collector upgrade documents.</li>
      <li>Attend Gratia meeting.</li>
      <li>Step in and stop unintended upgrade of gratia06 by mis-configured =tomcat-conversion= collector. Main =gratia09= collector restarted. No ill effects.</li>
      <li>Start implementing "safe start" and admin GUI replication service control for less error-prone upgrades.</li>
      <li>Reply to mail from Alain asking whether we want a new version of services in VDT -- won't make it into OSG 1.0 anyway, so not critical; probably in a week or so.</li>
    </ul>
  </dd>
  <dt>2008/06/10</dt>
  <dd>
    <ul>
      <li>Discussions with John W. and Philippe about fixes to replication. John is going ahead with tag and test, and updating the upgrade procedure.</li>
      <li>Found further difference in checksums. Explained as (legitimate) difference due to differences in !ExtraXml fields for primary record upload and replication. However, !ListenerThread updated to overwrite no longer the server-produced !ExtraXml field with that recedived via an external source such as replication or history.</li>
    </ul>
  </dd>
  <dt>2008/06/09</dt>
  <dd>
    <ul>
      <li>Diagnosed problems at UCLA (GOC ticket #5025) -- resolved.</li>
      <li>Diagnosed and fixed problems with replication -- checksum differences were due to !GridDescription attribute not being dealt with properly, and extra !JobIdentity clauses in some replicated records were due to !ExtraXML from earlier versions of the Grid attribute. These extra clauses were in fact being ignored correctly so no action required there.</li>
    </ul>
  </dd>
</dl>

%LinksTable%

---+++!! <a name="%TOPIC%_Other">Other</a>
<dl>
  <dt>2008/06/18</dt>
  <dd>
    <ul>
      <li>Meeting with Ruth and Gabriele re: workload, OSG User Support and Gratia issues.</li>
    </ul>
  </dd>
  <dt>2008/06/17</dt>
  <dd>
    <ul>
      <li>Timesheet for Gabriele. Will need to check possible over-deduction of furlough when pay advice comes for this month.</li>
    </ul>
  </dd>
  <dt>2008/06/16</dt>
  <dd>
    <ul>
      <li>Bring work log up to date.</li>
    </ul>
  </dd>
  <dt>2008/06/13</dt>
  <dd>
    <ul>
      <li>Half day vacation.</li>
    </ul>
  </dd>
  <dt>2008/06/12</dt>
  <dd>
    <ul>
      <li>Monitor returned in working order. Returned loaner to Keith.</li>
    </ul>
  </dd>
  <dt>2008/06/09</dt>
  <dd>
    <ul>
      <li>Status report for Gabriele.</li>
      <li>Group meeting.</li>
    </ul>
  </dd>
</dl>

%STOPINCLUDE%

---++ Topic access settings

   * Set ALLOWTOPICVIEW = Main.ChrisGreen, Main.ChrisGreenWorkLogViewersGroup

<!-- Hidden Settings
   * Set ALLOWTOPICCHANGE = Main.ChrisGreen
   * Set ALLOWTOPICRENAME = Main.ChrisGreen
-->

%META:TOPICMOVED{by="ChrisGreen" date="1213040916" from="Sandbox.ChrisGreenWorkLog2008123" to="Sandbox.ChrisGreenWorkLog200823"}%
