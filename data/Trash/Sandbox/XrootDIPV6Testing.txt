%META:TOPICINFO{author="EdgarMauricioFajardoHernandez2" date="1423167808" format="1.1" reprev="1.3" version="1.3"}%
---+ IPv6 Testing Log: !XRootD

This testing log is part of [[Sandbox.OperationsServicesIPv6CompatibilityTable][OSG IPv6 tests]]. This page captures the specific IPv6 compatibility testing process used for one software component, !XRootD. The more general IPv6 template for testing is [[https://twiki.grid.iu.edu/bin/view/SoftwareTeam/IPV6Testing][here]].


---++ Initial Setup

This test used two hosts:

| *Host* | *OS* | *OSG Release* |
| cabinet-10-10-1.t2.ucsd.edu | !CentOS release 6.5 (Final) | 3.2 |
| ipv6vm004.fnal.gov | Scientific Linux Fermi release 6.4 (Ramsey) | 3.2 |

---+++ Testing connectivity

The first step was to ensure that each host could ping the other using IPv4 and IPv6. From FNAL to UCSD and viceversa.

<pre class="screen">
root@cabinet-10-10-1 ~# ping6 ipv6vm004.fnal.gov
PING ipv6vm004.fnal.gov(ipv6vm004.fnal.gov) 56 data bytes
64 bytes from ipv6vm004.fnal.gov: icmp_seq=1 ttl=51 time=62.0 ms
</pre>

and

<pre class="screen">
 root@cabinet-10-10-1 ~# ping ipv6vm004.fnal.gov
PING ipv6vm004.fnal.gov (131.225.41.185) 56(84) bytes of data.
64 bytes from ipv6vm004.fnal.gov (131.225.41.185): icmp_seq=1 ttl=51 time=57.6 ms
</pre>

%RED%EDGAR: Did you test ping and ping6 in the other direction?%ENDCOLOR%
%GREEN%TIM: Yes I did%ENDCOLOR%

---+++ Installing software

Next, OSG software was installed on each system. The UCSD host was the client and the FNAL host was the server.

| *Host* | *Package* | *Version* |
| cabinet-10-10-1.t2.ucsd.edu | xrootd-client.x86_64 | 4.0.4 |
| ipv6vm004.fnal.gov | xrootd.x86_64 | 4.0.4 |

%RED%EDGAR: Any particular reason that you forced x86-64 only? Did you get 32-bit packages also if you did not?%ENDCOLOR%
%GREEN% TIM: No particular reason, no in el6 u don't get the 32-bit packages%ENDCOLOR%

---+++ Starting !XRootD services

<pre class="screen">
[root@ipv6vm004 ~]# service xrootd setup  
[root@ipv6vm004 ~]# service xrootd start
Starting xrootd (xrootd, default):                         [  OK  ]
[root@ipv6vm004 ~]# service cmsd start
Starting xrootd (cmsd, default):                           [  OK  ]
</pre>

%RED%EDGAR: Is “cmsd” part of a normal OSG(-only) installation? I have never really used !XRootD, so I do not know. And in any case, was there really no configuration to do before starting the services?%ENDCOLOR%

%GREEN% TIM: yes it is, it is in the [[https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallXrootd][Xrootd install twik]]. No more configuration was needed for standard installation.%ENDCOLOR%


---++ Testing

---+++ Testing the dual-dual configuration: OK

<pre class="screen">
[1355] root@cabinet-10-10-1 ~# xrdcp /bin/sh root://ipv6vm004.fnal.gov:1094//tmp/first_test
[917.3kB/917.3kB][100%][==================================================][917.3kB/s]  
xrdcp root://ipv6vm004.fnal.gov:1094//tmp/first_test /tmp/second_test
[917.3kB/917.3kB][100%][==================================================][917.3kB/s]
</pre>

%RED%EDGAR: Was this really the only testing that you performed? It seems… a little light. Then again, I do not know !XRootD, so maybe this is the one and only real use case. Do we have a testing script for !XRootD? Are there other significant use cases for it?%ENDCOLOR%

%RED% TIM:  Well this is  the straightforward test. It tests the client, the libraries and the server. I thing this the way automated tests test it, so if it is light then we should as well consider light the automated tests we have been performing. We could tests the Fuse mount, but that is a different plugin, should we also cover all xrootd plugins?%ENDCOLOR%

---+++ Testing that dual-dual communication defaults to IPv6: Yes

<pre class="screen">
xrdcp root://ipv6vm004.fnal.gov:1094//tmp/sample2.txt /tmp/1_test
[10MB/10MB][100%][==================================================][5MB/s]   
(reverse-i-search)`dd': a^Cuser hhutchison
</pre>

<img src="%ATTACHURLPATH%/Screen_Shot_2015-02-02_at_1.35.21_PM.png" alt="Screen_Shot_2015-02-02_at_1.35.21_PM.png" width='1084' height='176' />  

%RED%EDGAR: Is using a separate GUI tool the best way to test for IPv6 usage? Are there other good tools, maybe command-line only? Why was this particular method chosen?%ENDCOLOR%

%GREEN%Tim: Well I am using ntop, which is the kidna standard tool for looking at the network traffic. You could also run ntop from the command line, it just seems silly to do it with the conveniance of the web UI%ENDCOLOR%

---+++ Testing the dual server / IPv4 client configuration: OK

---++++Disabled IPv6 for the client:
   1. Modified file /etc/sysconfig/network-scripts/ifcfg-eth0 and comment out =IPV6*= entries:\
      <pre class="file">
#IPV6INIT=yes                                                                                                                                                 
#IPV6ADDR="2607:f720:1700:1b30::a4"                                                                                                                           
#IPV6_DEFAULTGW="2607:F720:1700:1B30::1"  
</pre>
   1. Restarted network:
      <pre class="screen">
root@cabinet-10-10-1 ~# service network restart
Shutting down interface eth0:                              [  OK  ]
Shutting down loopback interface:                          [  OK  ]
Bringing up loopback interface:                            [  OK  ]
Bringing up interface eth0:  Determining if ip address 169.228.130.164 is already in use for device eth0...
                                                           [  OK  ]
</pre>

%RED%EDGAR: It might be best to re-check for communication to/from the client here, right? Or at least, run =ip addr list= and verify that IPv6 is off (I think that works).%ENDCOLOR%

%GREEN% Tim: Yes, another kind of ping6 and ifconfig -a should do the trick%ENDCOLOR%

---++++Actual testing:

<pre class="screen">
xrdcp root://ipv6vm004.fnal.gov:1094//tmp/sample2.txt /tmp/1_test_noipv6
[10MB/10MB][100%][==================================================][10MB/s]  
</pre>

%RED%EDGAR: Same comments about coverage as before.%ENDCOLOR%
%GREEN%TIM: Same answer as above %ENDCOLOR%

---+++ Updating results table

Update results in the table at [[https://twiki.opensciencegrid.org/bin/view/Sandbox/OperationsServicesIPv6CompatibilityTable]].

%META:FILEATTACHMENT{name="Screen_Shot_2015-02-02_at_1.35.21_PM.png" attachment="Screen_Shot_2015-02-02_at_1.35.21_PM.png" attr="h" comment="OverIpv6" date="1422912966" path="Screen Shot 2015-02-02 at 1.35.21 PM.png" size="38795" stream="Screen Shot 2015-02-02 at 1.35.21 PM.png" tmpFilename="/usr/tmp/CGItemp21110" user="EdgarMauricioFajardoHernandez2" version="1"}%
