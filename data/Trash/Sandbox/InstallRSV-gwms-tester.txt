%META:TOPICINFO{author="BrianBockelman" date="1486496058" format="1.1" version="1.2"}%
---+!! Install RSV-gwms-tester
%TOC{depth="2"}%
%STARTINCLUDE%
---+ About this Document

This document provides instructions on setting up a host to use rsv-gwms-tester. RSV-gwms-tester is a tool designed to do end-to-end testing of different sites with GlideInWMs.

---+ How to get Help?

To get assistance about the OSG software please use [[HelpProcedure][this page]]. 


---++ Requirements

   1 Have a [[https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallGlideinWMSFrontend][GWMS Fronted installed]]
   1 Frontend to have a group matching on *DESIRED_SITES* and *is_itb* flag
   1 _Root_ access is required to do installations with yum
 
---+++ Certificates/Proxies configuration example

| *Certificate* | *User that owns certificate* | *Path to certificate* |
| Host certificate | =root= | =/etc/grid-security/hostcert.pem= <br> =/etc/grid-security/hostkey.pem= |

[[Trash.ReleaseDocumentationGetHostServiceCertificates][Here]] are instructions to request a host certificate.

---++ Networking
Both ports 9615 and 80 must be open.

---++ Networking
%STARTSECTION{"Firewalls"}%
%INCLUDE{"FirewallInformation" section="FirewallTable" lines="condorscheddshared,rsvin,rsvout"}%

%ENDSECTION{"Firewalls"}%

---+ Installation Procedure

%INCLUDE{"YumRepositories" section="OSGRepoBrief" TOC_SHIFT="+"}%

%INCLUDE{"InstallCertAuth" section="OSGBriefCaCerts" TOC_SHIFT="+"}%


%STARTSECTION{"InstallRSVGWMSTester"}%
---++ Install the rsv-gwms-tester packages

The RPM is available in the OSG repository:

Install the RPM and dependencies (be prepared for a lot of dependencies).

   <pre class="rootscreen">%UCL_PROMPT_ROOT% yum install rsv-gwms-tester</pre>
  <pre class="rootscreen">%UCL_PROMPT_ROOT% yum install glideinwms-userschedd</pre>

This will install the current production release verified and tested by OSG with default condor configuration.

If you wish to install a different version of !GlideinWMS, add the "--enablerepo" argument to the command as follows:

   * =yum install --enablerepo=osg-testing rsv-gwms-tester=: The most recent production release, still in testing phase.  This will usually match the current tarball version on the !GlideinWMS home page.  (The osg-release production version may lag behind the tarball release by a few weeks as it is verified and packaged by OSG).  Note that this will also take the osg-testing versions of all dependencies as well.

%ENDSECTION{"InstallRSVGWMSTester"}%

---++ Configuration

   1 Modify the file <verbatim>/etc/rsv/metrics/org.osg.local-gfactory-site-querying-local.conf</verbatim> to adjust the constraints for the entries that you are interested in testing
   1 Add your central manager DN to the authorization list. <pre class="rootscreen">%UCL_PROMPT_ROOT%glidecondor_addDN -allow-others -daemon 'Central Manager DN' '/the/central/manager/DN' condor </pre>
   1 Copy the schedd config files to the condor-cron dir  <pre class="rootscreen">%UCL_PROMPT_ROOT% cp /etc/condor/config.d/* /etc/condor-cron/config.d/</pre>
   1 Add file  <verbatim>/etc/condor-cron/config.d/98_public_interface.config</verbatim> with the following contents: <verbatim>NETWORK_INTERFACE = REPLACE_ME_WITH_HOST_IP</verbatim>
   1 Start <verbatim>httpd, condor-cron, rsv</verbatim> services. 
   1 Run <verbatim> rsv-control --enable  org.osg.local-gfactory-site-querying-local --host fermicloud053.fnal.gov </verbatim> where host can be localhost or the actual name of the node where rsv-vo-gwms is installed.
   1 Run <verbatim>rsv-control --on  org.osg.local-gfactory-site-querying-local  --host fermicloud053.fnal.gov </verbatim> where host can be localhost or the actual name of the node where rsv-gwms-tester is installed
%STOPINCLUDE%

-- Main.EdgarMauricioFajardoHernandez - 29 Aug 2016
