%META:TOPICINFO{author="MatyasSelmeci" date="1349479815" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="MatyasSelmeciSandbox"}%
---+ Notes for testing VOMS 2.0.8

%TOC%

Main ticket: [[https://jira.opensciencegrid.org/browse/SOFTWARE-800][SOFTWARE-800]]

---++ 10/05

Going through Documentation.Release3.InstallVoms

   * =yum install osg-voms=
   * start mysql
   * =mysql_secure_installation=
   * fix =/etc/grid-security/http/http{key,cert}.pem= and =/etc/grid-security/voms/voms{key,cert}.pem= (both are just copied from the host key/cert)
   * =/var/lib/trustmanager-tomcat/configure.sh=


Ran =voms-admin-configure=:
<verbatim>
: fermicloud099 \# ;\
voms-admin-configure install\
--dbtype mysql\
--vo matyasvo\
--createdb\
--deploy-database\
--dbauser root\
--dbapwd zlfrperg\
--dbusername admin-matyasvo\
--dbpassword mysecret\
--dbport 3306\
--port 15001\
--mail-from matyas@cs.wisc.edu\
--smtp-host smtp.cs.wisc.edu\
--sqlloc /usr/lib64/voms/libvomsmysql.so\
--cert /etc/grid-security/voms/vomscert.pem\
--key /etc/grid-security/voms/vomskey.pem\
--read-access-for-authenticated-clients
</verbatim>
Made the VO for me. Printed a bunch of sql statements and then the following:
<verbatim>
Deploying voms database...
Database deployed correctly!
Adding read access for authenticated clients...
Checking that the database is writable...
Database is writable.
Granting read-only access to any authenticated user on group '/matyasvo'
Granting read-only access to any authenticated user on role '/matyasvo/Role=VO-Admin'



VO matyasvo installation finished.

You can start the voms services using the following commands:
    //etc/init.d/voms start matyasvo
    //etc/init.d/voms-admin start matyasvo
</verbatim>
At one point I accidentally omitted ="--key"= and it gave me =KeyError: key= and I had to source dive to figure out what that meant.
*NOTE* There has _got_ to be a better way of doing initial configuration than that.
Perhaps even a shell script with variables you can fill in that calls =voms-admin-configure= -- even that would be better than this.

Here's one. =voms-admin-initial-install.sh=
<verbatim>
#!/bin/sh
# TODO Add comments explaining what these variables all mean.
DATABASE_TYPE="mysql"
VO_NAME="matyasvo"
DATABASE_ADMIN_USER="root"
DATABASE_ADMIN_PASSWORD="zlfrperg"
DATABASE_PASSWORD="mysecret"
DATABASE_PORT=3306
VOMS_PORT=15001
MAIL_FROM="matyas@cs.wisc.edu"
SMTP_HOST="smtp.cs.wisc.edu"
SQL_LOCATION="/usr/lib64/voms/libvomsmysql.so"
VOMS_CERTIFICATE="/etc/grid-security/voms/vomscert.pem"
VOMS_PRIVATE_KEY="/etc/grid-security/voms/vomskey.pem"

voms-admin-configure install \
    --dbtype            $DATABASE_TYPE \
    --vo                $VO_NAME \
    --createdb --deploy-database \
    --dbauser           $DATABASE_ADMIN_USER \
    --dbapwd            $DATABASE_ADMIN_PASSWORD \
    --dbusername        admin-$VO_NAME \
    --dbpassword        $DATABASE_PASSWORD \
    --dbport            $DATABASE_PORT \
    --port              $VOMS_PORT \
    --mail-from         $MAIL_FROM \
    --smtp-host         $SMTP_HOST \
    --sqlloc            $SQL_LOCATION \
    --cert              $VOMS_CERTIFICATE \
    --key               $VOMS_PRIVATE_KEY \
    --read-access-for-authenticated-clients
</verbatim>

-- Main.MatyasSelmeci - 05 Oct 2012
<!-- vim: ft=twiki
-->
