%META:TOPICINFO{author="MatyasSelmeci" date="1354145355" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="MatyasSelmeciSandbox"}%
---+ Sandbox.MatyasSelmeciFetchCrl3Notes (WIP)

---++ Package changes

Packages in our SVN that have =fetch-crl= as an explicit dependency:
   * =cms-rootd=
   * =dcache-gratia-probe=
   * =glite-ce-cream=
   * =osg-gridftp=
   * =osg-gridftp-hdfs=
   * =osg-gridftp-xrootd=
   * =osg-se-bestman=
   * =osg-se-bestman-xrootd=
   * =osg-se-hadoop= ( =-gridftp=, =-srm= )
   * =osg-wn-client=
   * =rsv-metrics= (?)
   * =voms-admin-server=

=rsv-metrics= says it requires =fetch-crl= but does not run it anywhere, so that dep can be removed.
Looks like it was for an old probe?

RPMs _outside_ of our SVN that have =fetch-crl= as an explicit dependency:
   * =nordugrid-arc-ca-utils= (epel) (we don't use it)

RPMs that have =/usr/sbin/fetch-crl= as a dependency: none

---++ Software changes

Stuff that can invoke or use (parts of) =fetch-crl= that should be changed to use =fetch-crl3= instead (if that exists):
   * =osg-configure= (=osg_configure.modules.utilities.fetch_crl()=)
   * =osg-test= (=test_06_fetch_crl.py=)
   * =osg-ca-manage= (checks if it's enabled and when it was last run)
   * =osg-ca-certs-status= (checks if it's installed and when it was last run)

---++ Docs changes
Twiki pages to update:
   * Documentation.Release3.InstallBestPractices
   * Documentation.Release3.InstallCertAuth
   * Documentation.Release3.InstallBestmanXrootdSE (install transcript only)
   * Documentation.Release3.InstallGratiaService (install transcript only)
   * Documentation.Release3.InstallGridFtpXrootd (install transcript only)
   * Documentation.Release3.InstallGums
   * Documentation.Release3.InstallHadoopSE
   * Documentation.Release3.InstallOSGBestmanSE (install transcript only)
   * Documentation.Release3.InstallOSGClient
   * Documentation.Release3.InstallRSV
   * Documentation.Release3.InstallVoms
   * Documentation.Release3.InstallWNClient
   * Documentation.Release3.InstallXrootd
   * [[Documentation.Release3.OSGServices]]
   * Documentation.Release3.OsgCaManage
   * Documentation.Release3.RsvPigeonTools (note: looks like it's only for osg 1.2 ?)
   * Documentation.Release3.SrmTester
   * Documentation.Release3.UnderstandingComputeElement (note: looks a lot like [[Documentation.Release3.OSGServices]], what's up with those two pages?)

Pages marked 'install transcript only' have transcripts ("screen dumps") of the output of a full installation procedure.


---++ Upgrade procedure

   1. Either =yum install fetch-crl3= or =yum upgrade= any package that used to require =fetch-crl= (see above lists)
   1. =service disable fetch-crl-{boot,cron}=
   1. =service enable fetch-crl3-{boot,cron}=
   1. Edit =/etc/cron.d/fetch-crl3= to change parameters if desired
   1. Edit =/etc/fetch-crl3.conf= as desired, see table

*Translation table from fetch-crl.conf to fetch-crl3.conf:*

| *fetch-crl.conf* | *fetch-crl3.conf* |
|<code>ALLWARNINGS=yes</code> | can't be set, but see =nowarnings= and =verbosity= |
|<code>CACHEDIR=/var/cache/fetch-crl</code> |<code>statedir = /var/cache/fetch-crl3</code> (I think?) |
|<code>CACHEDIR=</code> (disables cache) |<code>nocache</code> or <code>stateless</code> (those aren't synonyms but I don't know what the difference is) |
|<code>CRLDIR=/etc/grid-security-certificates</code> |<code>infodir = /etc/grid-security/certificates</code> |
|<code>CRL_AGING_THRESHOLD=24</code> |<code>agingtolerance = 24</code> |
|<code>FETCH_CRL_OPENSSL=/usr/bin/openssl</code> |<code>openssl = /usr/bin/openssl</code> |
|<code>FORCE_OVERWRITE=yes</code> | always 'yes' |
|<code>HTTP_PROXY=...</code> |<code>http_proxy = ...</code> or set in <code>/etc/sysconfig/fetch-crl3</code> and use <code>http_proxy = ENV</code> |
|<code>QUIET=yes</code> |<code>verbosity = -1</code> |
|<code>RESETPATHMODE=yes</code> |<code>path = /bin:/usr/bin</code> |
|<code>RESETPATHMODE=searchopenssl</code> | ? |
|<code>SERVERCERTCHECK=no</code> | always 'no'; install =perl-Crypt-SSLeay= and set =HTTPS_CA_FILE= in =/etc/sysconfig/fetch-crl3= if you want to check server cert, but the docs suggest that since the crls are signed, checking server cert is unnecessary and may give false positives for security warnings |
|<code>SLOPPYCRLHASHES=yes</code> | can't be set |
|<code>SYSLOGFACILITY=daemon</code> |<code>syslogfacility = daemon |
|<code>WGET_OPTS=...</code> | can't be set |
|<code>WGET_RETRIES=2</code> | can't be set |
|<code>WGET_TIMEOUT=120</code> |<code>httptimeout = 120</code> (I think?) |

See also =/usr/share/doc/fetch-crl3-*/fetch-crl.conf.example=

-- Main.MatyasSelmeci - 28 Nov 2012
