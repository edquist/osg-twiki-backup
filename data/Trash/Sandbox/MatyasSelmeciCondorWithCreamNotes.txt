%META:TOPICINFO{author="MatyasSelmeci" date="1340248176" format="1.1" reprev="1.11" version="1.11"}%
%META:TOPICPARENT{name="Main.MatyasSelmeci"}%
%TOC%

---+ Top
Source website:

http://emisoft.web.cern.ch/emisoft/dist/EMI/2/sl5/SRPMS/base/
http://emisoft.web.cern.ch/emisoft/dist/EMI/2/sl6/SRPMS/base/

This is all in the =condor-with-cream= branch.
voms stuff is in the =voms208= branch.

Common problems:

   * <pre>BuildArch: %{_arch}</pre> line prevents the package from building on all architectures.
   * Complaints about not being able to run =config.sub= on el6 are due to libtool differences between the two platforms; that's usually when I download the el6 SRPM as well
   * configure can't find CLASSAD -- there's no pkgconfig file for it so have to set CLASSAD_CFLAGS and CLASSAD_LIBS manually


---+ The List

Key:
 I - imported
 F - failed
 x - built
 X - built, see note

| *Status* | *Filename* | *Notes* |
| *Client* |||
| x | glite-jobid-api-c-2.1.2-2.src.rpm | pass-through |
| x | glite-jobid-api-cpp-1.2.0-5.src.rpm | pass-through, needs glite-jobid-api-c |
| *X* | glite-wms-utils-classad-3.3.0-2.sl{5,6}.src.rpm | |
| *X* | glite-wms-utils-exception-3.3.0-2.sl{5,6}.src.rpm | |
| *X* | glite-jdl-api-cpp-3.3.0-3.sl{5,6}.src.rpm | needs glite-jobid-api-c-devel, glite-jobid-api-cpp-devel, glite-wms-utils-classad-devel, glite-wms-utils-exception-devel |
| x | glite-lbjp-common-gss-3.1.3-2.src.rpm | pass-through |
| x | glite-lbjp-common-gsoap-plugin-3.1.2-2.src.rpm | pass-through; needs glite-lbjp-common-gss-devel |
| x | glite-ce-wsdl-1.14.0-4.sl5.src.rpm | |
| F | glite-ce-cream-client-api-c-1.14.0-4.sl{5,6}.src.rpm | needs glite-ce-wsdl, glite-lbjp-common-gsoap-plugin-devel |
| I | glite-ce-cream-cli-1.14.0-4.sl5.src.rpm | needs glite-jdl-api-cpp, glite-ce-cream-client-devel (from glite-ce-cream-client-api-c), glite-jobid-api-c-devel, glite-lbjp-common-gsoap-plugin-devel |
|   | glite-ce-cream-utils-1.2.0-4.sl5.src.rpm | |
| *Service* |||
| x | glite-ce-common-java-1.14.0-4.sl5.src.rpm | |
| *X* | argus-parent-1.5.0-3.sl5.src.rpm | |
| *X* | argus-pep-common-2.2.0-1.sl5.src.rpm | needs argus-parent |
| x | argus-pep-api-java-2.1.0-1.sl5.src.rpm | needs argus-pep-common |
| x | emi-delegation-interface-2.0.3-1.sl5.src.rpm | |
| *X* | emi-delegation-java-2.2.0-2.sl5.src.rpm | needs emi-delegation-interface, voms-api-java |
| x | glite-jdl-api-java-3.2.0-3.sl5.src.rpm | |
| F | glite-ce-cream-api-java-1.14.0-4.sl5.src.rpm | needs glite-jdl-api-java, emi-delegation-java, glite-ce-common-java, glite-ce-wsdl, argus-pep-api-java |
| F | glite-ce-cream-1.14.0-4.sl5.src.rpm | needs glite-ce-cream-api-java |
| *VOMS* |||
| x | voms-2.0.8-1.src.rpm | pass-through |
| *I* | voms-api-java-2.0.8-1.src.rpm | use maven22 |
| x | voms-clients-2.0.8-1.src.rpm | disable parallel make |
| x | voms-devel-2.0.8-1.src.rpm | disable parallel make |
| | voms-mysql-plugin-3.1.6-1.src.rpm | |
| x | voms-server-2.0.8-1.src.rpm | added our logrotate file, had to do 'make -j1' to disable parallel make, change requirement on "voms = version-release" to "voms = version" instead |

---+ Notes

---++ argus-parent

Needed to conditionalize the maven builddep. On el6, I use =maven=, on el5 I use =maven2=

---++ argus-pep-common

Still need our fixed maven-surefire-plugin files from the older version of this build.

---++ glite-ce-cream

*TODO* I don't like the way it starts tomcat on install. Fix that.

---++ emi-delegation-java

Needs =voms-api-java=. This is the same thing as =vomsjapi=.

=voms-api-java= was split out from voms after 2.0.6.


---++ glite-ce-cream-api-java

I was getting =java.lang.NoClassDefFoundError: javax/wsdl/WSDLException= in several places.
Turned out to be having classpath problems. I wrote a patch for the =build.xml= file.

Many errors caused by having outdated versions of =glite-ce-wsdl= and =glite-ce-common-java= so I versioned the dependencies in the spec file.

Right now I'm also having problems with "org.glite.ce.creamapi.ws.es.adl.Target_type0" possibly being outdated.
Target_type0 appears to be a product of the build so I'm not sure what's going on here.

Looks like it builds just fine if I have the EMI third-party repo enabled.
This repo contains a newer version of ant (1.7.1 vs 1.8.2) and axis2 (1.4.1 vs 1.6.1).
Looks like it's axis that's causing it.
We don't get axis from EPEL, we get it from jpackage.


---++ glite-wms-utils-classad

This failed on el6 because of autoconf/libtool differences.
EMI actually has a different SRPM for el6 so I'm taking both, using the spec file from one and using macros to pick which tarball to use.
This only works if =%rhel= is actually defined when rpmbuild is run, both to make the srpm, and to do the build.
osg-build does it right for scratch builds and our buildsys-macros are correct too.
Also had to remove <pre>BuildArch: %{_arch}</pre> since it was making the rpm only build for one arch.

---++ glite-wms-utils-exception

See glite-wms-utils-classad above.

---++ glite-jdl-api-cpp

This one also needs 2 SRPMs, also have to remove =BuildArch=.
Also had to set a few environment variables for configure to succeed because classads and glite-jobid don't have pkgconfig files.
The error for this was:<pre>
checking for CLASSAD... no
configure: error: "CLASSADS not found"</pre>
We can't just make a pkgconfig for classads, because it's looking for some emi-specific package.

---++ glite-ce-cream-client-api-c

See glite-jdl-api-cpp above.
Don't need env vars for glite-jobid, but do need them for GRIDSITE_OPENSSL.

Failed with a whole bunch of errors starting with missing =glite/ce/es-client-api-c/es_client_soapStub.h= and a bunch of symbols all starting with =ES= because of that.

... yum whatprovides implies that the header file comes from =glite-ce-cream-client-devel=, so it's either needed to build itself or is some autogenerated file.
BTW, using the EMI repos for dependencies didn't help.

Aha. It's made by copying =autogen/ES_CLIENTStub.h= to =$(top_srcdir)/interface/glite/ce/es-client-api-c/es_client_soapStub.h= (in =src/ES/Makefile=)
Except that file doesn't exist.
Ah. Need to run =make -j1= .
Also need to specify =-I/usr/include/lixml2= in =CPPFLAGS= because otherwise libxml2 doesn't find its own header files. (Fail)

There's also <pre>/usr/include/voms/voms_api.h:36: error: conflicting declaration 'typedef void* gss_cred_id_t'</pre> which is a difference between the voms header files in =voms-2.0.6= vs. =voms-2.0.8=.
I could backport the change but it's probably better to just upgrade to the new voms anyway.

---++ voms-api-java

Looks like this requires maven22.
Should modify this to build in offline mode.

<!-- vim:ft=twiki:tw=0
-->
