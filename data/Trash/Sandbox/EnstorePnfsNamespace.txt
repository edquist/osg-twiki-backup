%META:TOPICINFO{author="ForrestChristian" date="1159303268" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="EnstoreIntro"}%
PNFS is a virtual file system package that implements the Enstore namespace. Refer to section 1.2 PNFS Namespace for introductory information on PNFS. 

---+ UNIX Commands Available in PNFS Space 

Data files do not actually reside in the /pnfs namespace. Errors occur on attempts to read or write the content of the files, or to manipulate the content. Therefore, UNIX commands such as cat, more, less, grep, head, tail, wc, od, file, cp, and so on, fail if you run them on files listed under /pnfs. 

However, virtually any non-I/O UNIX command can be used in the /pnfs namespace. For help with these commands, consult a UNIX manual or the man pages. Read and write access is governed by standard UNIX file permissions. Commands that you may find useful include: 

| ls | pwd | mv | mvdir<sup> [[#FootnoteMvdir][note]]</sup> | 
| find | rm | rmdir | cd |
| chmod | ln<sup> [[#FootnoteLn][note]]</sup> | stat<sup> [[#FootnoteStat][note]]</sup> | chown |

#FootnoteMvdir
   $ %X% *%RED%WARNING%ENDCOLOR%*: On <code>mvdir</code> &emdash; Files and directories must not be moved across PNFS database areas. Doing so will destroy Enstore metadata. 

#FootnoteLn
   $ %H% *%BLUE%NOTE%ENDCOLOR%*: For <code>ln</code>, hard links must be used to ensure that all the metadata information is linked. Symbolic links do not work properly. 

#FootnoteStat
   $ %H% *%BLUE%NOTE%ENDCOLOR%*: <code>stat</code> is not available in all operating systems.

a66 1
   $ %X% *%RED%WARNING!%ENDCOLOR%*: The number of files in a single PNFS directory should not exceed 2000.

---+ PNFS Tags 
Before files can be written to tape, Enstore needs to know where and how to write them. Pnfs uses tag files (usually just called tags) in the /pnfs namespace to specify this type of configuration information, and encp transfers this information to Enstore. Tags are associated with directories in the /pnfs namespace, not with any specific file, and thus apply to all files within a given directory (with the exception noted below). When a new directory in the /pnfs namespace is created, it inherits references to the tags of its parent directory. It is a feature of PNFS that a change to a parent directory will also affect its existing subdirectorys&#8217; tag references. 

Manually setting a directory&#8217;s tags will destroy references to its parent directory&#8217;s tags. This may be what you want to do, but be aware.

A file gets the tag references of its directory as they exist when the file is written to Enstore, and these are what encp uses to access it. Subsequent changes to a directory&#8217;s tag references do not affect pre-existing files, therefore it&#8217;s possible to have files in a directory to which the current directory tags do not apply. 

Allowable characters within tags are: alphanumeric characters, underscore ( _ ), dash ( - ), and slash ( / ). 

---++ Tag Listing 
The tags include: 

| file_family | This tag determines the file family associated with all files in this directory. See section 2.2.1 File Family for information on file families. |
| file_family_width | This tag determines the file family width associated with all files in this directory. See section 2.2.2 File Family Width for information on file family width. |
| file_family_wrapper | This tag determines the file family wrapper associated with all files in this directory. See section 2.2.3 File Family Wrapper for information on file family wrappers. The default is cpio_odc. |
| library | This tag determines the virtual library (and thus the library manager) associated with all files in this directory. See section 8.3 Library Manager for information about the library. |
| storage_group | This tag determines the storage group associated with all files in this directory, and shows up as your experiment&#8217;s top level directory under /pnfs. Typically, one storage group is associated with an entire experiment. A storage group is assigned to each experiment by the Enstore administrators. Users never change this tag. | 

---++ Viewing Tags On-Site

On-site users can view the values of the tags for a given directory:

   1. Setup encp, with qualifier. See [[EnstoreCopyingFilesWithEncp#SetupEncp][Setup encp]]. 
   1. cd to the /pnfs subdirectory of interest, or enter the directory as an argument to <code>--tags</code>
   1. Type <code>enstore pnfs --tags</code> and press Enter.

The following is sample output. 

<verbatim>
	.(tag)(file_family) = dcache
	.(tag)(file_family_width) = 1
	.(tag)(file_family_wrapper) = cpio_odc
	.(tag)(library) = eagle
	.(tag)(storage_group) = test
	-rw-rw-r-- 11 xyz sys 6 Jul 26 10:22 .(tag)(file_family)
	-rw-rw-r-- 11 xyz sys 1 May 5 2000 .(tag)(file_family_width)
	-rw-rw-r-- 11 xyz sys 8 May 5 2000 .(tag)(file_family_wrapper)
	-rw-rw-r-- 11 xyz sys 5 May 5 2000 .(tag)(library)
	-rw-r--r-- 11 xyz sys 4 Jul 26 10:20 .(tag)(storage_group)
</verbatim>

The output first lists the tags and their values, then the tags again in long format to show the owners and protection modes. 

   $ %H% *%BLUE%NOTE%ENDCOLOR%*: Off-site users cannot mount pnfs, and therefore cannot see tags. 