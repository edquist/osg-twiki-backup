%META:TOPICINFO{author="MarcoMambelli" date="1273607958" format="1.1" reprev="1.17" version="1.17"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! <nop>%SPACEOUT{%TOPIC%}%
%TOC%

   * These are temporary pre-release instructions for a non-root based Xrootd installation.
   * Production release instructions are located [[XrootdInstall][here]].


---++ Introduction
Xrootd is a high performance network storage system widely used in high energy physics experiments such as ATLAS and ALICE. The underlying Xroot data transfer protocol provides highly efficient access to ROOT based data files.  This page provides instructions for creating a simple Xrootd storage system consisting of:
   * One redirector node
   * One or more data server node(s)
Most of this installation can be performed as non-privileged user.  Some steps in the Getting started section need to be performed as root. Features of this installation:
   * Cluster administrator functions (requiring root privileges) separate from Xrootd administrative functions (non-privileged account)
   * Enables the *unix* security module in Xrootd
   * Does not enable the CNS service
   * Configuration from the Xrootd administration account
   * Control (start/stop) from the Xrootd administration account



---++ Getting Started
To prepare the installation:
   * Identify hosts and roles
   * Check firewall rules
   * Create the Xrootd administration account
   * Install Pacman (optionally this can be done by the Xrootd administration account)
   * Prepare the storage storage directories on Xrootd redirector and data server hosts

---+++ Identify hosts and roles (Cluster Administrator)
   * Identify the redirector node
   * Identify the data server(s)

---+++ Check firewall rules (Cluster Administrator)
It is important to make sure your firewall (if any) isn't blocking the ports that Xrootd uses for communication.  Otherwise, it becomes difficult to diagnose errors and failures may occur.  Xrootd uses the following ports:

| *Host* | *Port Number* | *Protocol* |
|!Xrootd data server| random ports selected by the OS |tcp|
|!Xrootd redirector|1094|tcp|
||2094|tcp|
||1213|tcp|

Check the firewall rules with =/etc/init.d/iptables status=.   See below for more information on firewall configuration settings for Xrootd.

---+++ Create the xrootd user account (Cluster Administrator)
You need a non privileged Xrootd user account on the redirector and all data servers, and that user *must have a login shell*.    If you manage your accounts by hand (rather than using a service such as LDAP) you would, on your management node:
<pre class="screen">
/usr/sbin/groupadd xdradmin 
/usr/sbin/useradd --gid xrdadmin xrdadmin
</pre>
and copy =/etc/passwd, /etc/shadow, /etc/group,= and =/etc/gshadow= to each of the xrootd nodes.

---+++ Install Pacman
Pacman is a package management program used to install OSG software.
ReleaseDocumentation.PacmanInstall describes how to install Pacman.
You may select  =/opt/pacman= as the installation directory.<br>
%TWISTY{
mode="div"
showlink="Show an example of how to install Pacman..."
hidelink="Hide"
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
<pre class="screen">
cd /opt
wget http://atlas.bu.edu/~youssef/pacman/sample_cache/tarballs/pacman-3.29.tar.gz
tar --no-same-owner -xzvf pacman-3.29.tar.gz
cd pacman-3.29
source setup.sh
cd ..
ln -s pacman-3.29 pacman
</pre>
%ENDTWISTY%
Once Pacman is installed do: =source /opt/pacman/setup.sh=.  You are ready to install Xrootd.

---+++ Choose the storage directories
Choose the same pathnames for the redirector and data servers
   * /storage/cache
      * redirector: unused
      * data servers: stores the files
   * /storage/path 
      * redirector: is a directory containing internal Xrootd references to files in the system.  Xrootd clients access files using storage_path.
      * data servers: s a directory containing internal Xrootd references to files in the system. 

---+++ Prepare the storage directories on the data server
Prepare the directories:
<pre class="screen">
mkdir -p /storage/path
mkdir -p /storage/cache
chown xrdadmin:xrdadmin /storage/cache
chown xrdadmin:xrdadmin /storage/path
</pre>


---++ Installing and configuring the redirector
Create and change to an installation directory. The xrootd user has to have write permission in the parent directory or the installation directory has to be created by root<pre class="screen">mkdir -p ~xrootd/redirector
cd ~xrootd/redirector
</pre>

Install the !Xrootd package from the VTB cache.  Pacman will ask whether you want to trust the cache (answer =yall=) and if you agree with the licenses (answer =y=).
<pre class="screen">
pacman -get http://vdt.cs.wisc.edu/vdt_2089_cache:Xrootd  
</pre>

Update the environment and run the post installation script:
<pre class="screen">
source setup.sh
vdt-post-install
</pre>

You can verify that the version installed is the version you expected by invoking =vdt-version= : <pre class="screen">
vdt-version
</pre>

This completes the installation part of the Xrootd redirector. The next step is to configure the Xrootd redirector.
   * $VDT_LOCATION is the installation directory of the Xrootd redirector (=/opt/xrootd=)
   * =/storage/cache= and =/storage/path= are the directories discussed above
   * =--enable-security= is a configuration option necessary to enable security (user ownership on directories)
<pre class="screen">
cd ~xrootd/redirector
source setup.sh
$VDT_LOCATION/vdt/setup/configure_xrootd --server y --this-is-xrdr  --storage-path /storage/redirector/path --storage-cache /storage/redirector/cache  --enable-security 
</pre>

The configuration file is =$VDT_LOCATION/xrootd/etc/xrootd.cfg=

---++ Installing and configuring the data server
Create and change to an installation directory. The xrootd user has to have write permission in the parent directory or the installation directory has to be created by root<pre class="screen">mkdir -p ~xrootd/server
cd ~xrootd/server
</pre>

Install the !Xrootd package from the VTB cache.  Pacman will ask whether you want to trust the cache (answer =yall=) and if you agree with the licenses (answer =y=).
<pre class="screen">
pacman -get http://vdt.cs.wisc.edu/vdt_2089_cache:Xrootd  
</pre>

Update the environment and run the post installation script:
<pre class="screen">
source setup.sh
vdt-post-install
</pre>

You can verify that the version installed is the version you expected by invoking =vdt-version= : <pre class="screen">
vdt-version
</pre>

This completes the installation part of the Xrootd data server. The next step is to configure the Xrootd data server.
   * $VDT_LOCATION is the installation directory of the Xrootd redirector (=/opt/xrootd=)
   * =/storage/cache= and =/storage/path= are the directories discussed above
   * FQDN of the redirector host, e.g.  =redirector.yourdomain.org= 
   * =--enable-security= is a configuration option necessary to enable security (user ownership on directories)

<pre class="screen">
cd ~xrootd/server
source setup.sh
$VDT_LOCATION/vdt/setup/configure_xrootd --server y --xrdr-host redirector.yourdomain.org --storage-path  /storage/path --storage-cache /storage/cache --enable-security 
</pre>


---++ Start/Stop !Xrootd
On each node where  !Xrootd is installed (redirector or data server) to start/stop Xrtood use the following. 

To start: <pre class="screen">
cd /opt/xrootd
source setup.sh
vdt-control --non-root --on
</pre>

To stop: <pre class="screen">
cd /opt/xrootd
source setup.sh
vdt-control --non-root --off
</pre>

A separate pages collects nots about feature requests and open issues: XrootdInstallNotes



%BR%
-- Main.RobGardner - 05 Apr 2010
