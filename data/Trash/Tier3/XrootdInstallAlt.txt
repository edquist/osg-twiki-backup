%META:TOPICINFO{author="MarcoMambelli" date="1273538680" format="1.1" version="1.12"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! <nop>%SPACEOUT{%TOPIC%}%
%RED%Please see [[XrootdInstall][this]] document instead.%ENDCOLOR% 


Brief instructions for new installation

---++ Introduction
Most of this installation can be performed as non privileges user. Some steps in the Getting started section need to be performed as root

This installation will be:
   * as non root (as much as possible)
   * without CNS
   * with security enabled

---++ Getting Started
To prepare the installation you must
   * Identify hosts and roles
   * Check firewall rules (as root)
   * Create the xrootd user account (as root)
   * Install Pacman
   * Choose the storage directories
   * Prepare the storage directories on the data server (as root)

For the actual instructions see [[XrootdInstall#Getting_Started][the Xrootd install document]] for the first 4 steps.

---+++ Choose the storage directories
To be coherent and clear choose the same paths for the whole cluster.
   * /storage/cache (only on data server)
      * data servers: stores tha actual files
   * /storage/path 
      * redirector: is a directory containing internal Xrootd references to files in the system. Xrootd clients access files using storage_path.
      * data servers: s a directory containing internal Xrootd references to files in the system. Xrootd clients access files using storage_path.

---+++ Prepare the storage directories on the data server
Prepare the directories:
<pre class="screen">
mkdir -p /storage/path
mkdir -p /storage/cache
chown xrootd:xrootd /storage/cache
chown xrootd:xrootd /storage/path
</pre>


---++ Installing and configuring the redirector
Create and change to an installation directory. The xrootd user has to have write permission in the parent directory or the installation directory has to be created by root<pre class="screen">mkdir -p ~xrootd/redirector
cd ~xrootd/redirector
</pre>

Install the !Xrootd package from the VTB cache.  Pacman will ask whether you want to trust the cache (answer =yall=) and if you agree with the licenses (answer =y=).
<pre class="screen">
pacman -get http://vdt.cs.wisc.edu/vdt_2089_cache:Xrootd  
</pre>

Update the environment and run the post installation script:
<pre class="screen">
source setup.sh
vdt-post-install
</pre>

You can verify that the version installed is the version you expected by invoking =vdt-version= : <pre class="screen">
vdt-version
</pre>

This completes the installation part of the Xrootd redirector. The next step is to configure the Xrootd redirector.
   * $VDT_LOCATION is the installation directory of the Xrootd redirector (=/opt/xrootd=)
   * =/storage/cache= and =/storage/path= are the directories discussed above
   * =--enable-security= is a configuration option necessary to enable security (user ownership on directories)
<pre class="screen">
cd ~xrootd/redirector
source setup.sh
$VDT_LOCATION/vdt/setup/configure_xrootd --server y --this-is-xrdr  --storage-path /storage/redirector/path --storage-cache /storage/redirector/cache  --enable-security 
</pre>

The configuration file is =$VDT_LOCATION/xrootd/etc/xrootd.cfg=

---++ Installing and configuring the redirector
Create and change to an installation directory. The xrootd user has to have write permission in the parent directory or the installation directory has to be created by root<pre class="screen">mkdir -p ~xrootd/redirector
cd ~xrootd/redirector
</pre>

Install the !Xrootd package from the VTB cache.  Pacman will ask whether you want to trust the cache (answer =yall=) and if you agree with the licenses (answer =y=).
<pre class="screen">
pacman -get http://vdt.cs.wisc.edu/vdt_2089_cache:Xrootd  
</pre>

Update the environment and run the post installation script:
<pre class="screen">
source setup.sh
vdt-post-install
</pre>

You can verify that the version installed is the version you expected by invoking =vdt-version= : <pre class="screen">
vdt-version
</pre>

This completes the installation part of the Xrootd redirector. The next step is to configure the Xrootd redirector.
   * $VDT_LOCATION is the installation directory of the Xrootd redirector (=/opt/xrootd=)
   * =/storage/cache= and =/storage/path= are the directories discussed above
   * FQDN of the redirector host, e.g.  =redirector.yourdomain.org= 
   * =--enable-security= is a configuration option necessary to enable security (user ownership on directories)

<pre class="screen">
cd ~xrootd/redirector
source setup.sh
$VDT_LOCATION/vdt/setup/configure_xrootd --server y --xrdr-host redirector.yourdomain.org --storage-path  /storage/path --storage-cache /storage/cache --enable-security 
</pre>


---++ Start/Stop !Xrootd
On each node where  !Xrootd is installed (redirector or data server) to start/stop Xrtood use the following. 

To start: <pre class="screen">
cd /opt/xrootd
source setup.sh
vdt-control --non-root --on
</pre>

To stop: <pre class="screen">
cd /opt/xrootd
source setup.sh
vdt-control --non-root --off
</pre>



%BR%
-- Main.RobGardner - 05 Apr 2010