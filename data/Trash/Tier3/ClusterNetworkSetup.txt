%META:TOPICINFO{author="MarcoMambelli" date="1263238335" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="WebHome"}%
---+!! *<nop>%SPACEOUT{ "%TOPIC%" }%*
%TOC%

---++ Introduction
In this module we discuss a few details regarding the configuration of the Tier 3 network.  Possible topologies have been presented in ClusterNetwork. These instructions describe a static network configuration. A similar result can be obtained in a more scalable way using dynamic network addresses and configuring appropriately DNS and DHCP services. 


*NOTE - DISCLAIMER:*
   * The configuration described here is meant only to be suggestive for a *small* environment.   Network configurations for clusters vary greatly depending on the local environment, the scale of the facility, and conventions used by and preferences of systems administrators.   You should get into contact with your local network administrator to find out more information about your campus' network infrastructure and services.  For larger installations DNS and DHCP servers should probably be used.

---++ Static network configuration
The following steps describe all the files that have to be modified to configure statically the networking on a host. Each title indicates the subject and the file described in that subsection.

---+++ Network map: /etc/hosts
If you are using static IP addresses, any of the layout described in ClusterNetwork (both when the machines are in a public network and also when they are isolated on a private intranet) can be described using the =/etc/hosts= file.

   * The  =/etc/hosts=  contains a "map" of the cluster, resolving the =localhost= and all the hosts both as FQDN and short name.  The file should be the same on all machines in the cluster. 
   * Create =/etc/hosts= on the main head node (which is serving as a management node here):  =gc1=.
   * Copy the file to each of the hosts in the cluster.  Make sure that any updates on the master copy on the management node get propagated.


---+++ DNS servers: /etc/resolv.conf

   * The =/etc/resolv.conf= must contain the correct DNS IPs appropriate for the local environment.  If DHCP is used, this file is written automatically by the client.


---+++ Hostname and gateway: /etc/sysconfig/network

   * The =/etc/sysconfig/network= contains the FQDN of the host and the gateway used. Here is an example:<pre>
NETWORKING=yes
HOSTNAME=gc1-ce.yourdomain.org
GATEWAY=192.168.255.254
</pre>


---+++ NIC configuration: /etc/sysconfig/network-scripts/
   * The  =/etc/sysconfig/network-scripts/ifcfg-eth0= file (if using =eth0=) can be configured to use a static IP or DHCP.  The IPADDR value must be consistent with the IP assigned in the =/etc/hosts= file.  Some of the lines for a static configuration are: <pre>
BOOTPROTO=static
TYPE=Ethernet
IPADDR=192.168.192.51
</pre>


---+++ Name resolution: /etc/nsswitch.conf

   * The =/etc/nsswitch.conf= instructs the host to look first in the =/etc/hosts= file using this line:<pre>
#hosts:     db files ldap nis dns
hosts:      files dns
</pre>



---++ Protecting /etc/resolv.conf

The following applies only if you have multiple network interfaces (e.g. dual homed hosts), one configured statically and others run a DHCP client.
The static interface in order to work properly requires to preserve =/etc/resolv.conf= as modified above, running the DHCP client to configure the other interfaces replaces the file.

Quick solution to the problem: the  =/etc/resolv.conf= file can be write protected with =chattr= command under the Linux ext3 file system: <pre>chattr +i /etc/resolv.conf</pre>

More elegant solutions involve the setting of PEERDNS in the interface configuration or modification of the dhcp-client script or of the DHCP server configuration:
   * Interfaces running the DHCP client can control changes to  =/etc/resolv.conf= via the parameter =PEERDNS= in the network configuration script of each interface using DHCP (=/etc/sysconfig/network-scripts/ifcfg-ethX=, where =X= is the interface), which can be assigned either =yes= or =no=. 
      * If  = PEERDNS=yes= modify =/etc/resolv.conf= with information from the server. If using DHCP, then yes is the default.
      * If = PEERDNS=no=  do not modify =/etc/resolv.conf= 
      * NOTE: this may not work on some Linux releases 
   * For the solutions based on the dhcp-client script or of the DHCP server configuration or for more discussion on this topic, see: http://www.cyberciti.biz/faq/dhclient-etcresolvconf-hooks/.

%BR%
%COMPLETE2% %BR%
%RESPONSIBLE% Main.MarcoMambelli - 6 Jan 2010 %BR%
%REVIEW%

---++ *Comments*
%COMMENT{type="tableappend"}%
