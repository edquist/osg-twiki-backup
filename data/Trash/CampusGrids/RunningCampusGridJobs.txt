%META:TOPICINFO{author="DerekWeitzel" date="1308933840" format="1.1" version="1.10"}%
%META:TOPICPARENT{name="CampusGrids.WebHome"}%
%DOC_STATUS_TABLE%

<!--
   * Local UCL_HOST = submit

-->

---+!! Running jobs using the Campus Grid
%TOC%


---++ About This Document
This document is intended for Campus Grid users.  This includes campuses that are using the [[Documentation.CampusFactoryInstall][Campus Factory]] installed on a PBS system, as well as those that are using all Condor infrastructures.  We are able to generalize because in both cases, jobs are flocked from a generic Condor installation to the remote resources.

Configuration of the submission host and remote managers is described in the [[CampusGrids.ConfiguringRemoteSubmissionHost][Configuring Submit Host]] document.


---++ Requirements
This document assumes that:
   1 either you or your administrator has installed [[http://www.cs.wisc.edu/condor/][Condor]] on the submission host and configured it to be a "central manager", i.e. to run the the =condor_schedd= daemon (see =etc/examples= in the condor installation). The [[ReleaseDocumentation.ClientInstallationGuide][osg-client]] provides a personal Condor installation that suits this task.
   1 either you or your administrator configured such Condor installation to submit jobs to the Campus Grid as described in the [[CampusGrids.ConfiguringRemoteSubmissionHost][Configuring Submit Host]] document.

You can test to see if you have Condor running by logging into the submission host and running the command:
<pre class="screen">
%UCL_PROMPT% condor_q </pre>

The output should be very similar to:
<pre class="screen">
%UCL_PROMPT% condor_q


-- Submitter: prairiefire.unl.edu : <129.93.229.141:37303> : prairiefire.unl.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               

0 jobs; 0 idle, 0 running, 0 held
</pre>

---++ Procedure for submitting jobs

#JobSubmission
---+++ Job Submission
To submit a job, you must first create a job description file.  This process is identical to using a local Condor resource.  Full documentation on Condor job files can be found in the [[http://www.cs.wisc.edu/condor/manual/v7.6/2_5Submitting_Job.html][Condor Documentation]].  Submission is done on a node running the =condor_schedd=

For example, you can create the file condor.submit.  In this file, enter (or copy/paste) the following:
<pre class="file">
universe = vanilla
executable = /bin/hostname
output = test.out
error = test.err
log = test.log
ShouldTransferFiles = YES
when_to_transfer_output = ON_EXIT
queue
</pre>

Submission of the job is done with the =condor_submit= tool:
<pre class="screen">
%UCL_PROMPT% condor_submit condor.submit
</pre>

If the job is run successfully, you should see information in the =test.log= regarding where the job ran, what it's exit code was, and how long the job ran.  Additionally, test.out will have the hostname of the computer that ran the job.

You can check the status of the job with
<pre class="screen">
%UCL_PROMPT% condor_q </pre>

It may take a few minutes for Condor to start asking remote resources to run.  You can check if Condor has talked to other resources, if you know the other central manager's %RED%hostname%ENDCOLOR%, with the command:
<pre class="screen">
%UCL_PROMPT% condor_status -pool %RED%manager_hostname%ENDCOLOR% -schedd  </pre>
You should see the hostname of the submission machine.

---++ Validation of Success
The [[#JobSubmission][Job submission]] above is an excellent test if the submission is working correctly.  

---++ Problem Resolution and Help
---+++ Where to look for information
If any of these steps have failed, errors will be written by Condor to the Condor log files.  Log files can be found by querying Condor:
<pre class="screen">
%UCL_PROMPT% condor_config_val LOG </pre> 

On the submit host, the relevant log files are the =SchedLog=.  On the remote central manager, the =CollectorLog= and =NegotiatorLog= are relevant.  

On the remote central manager, Condor should have a record of the submission host when there are idle jobs on the submission host (with a few minute delay).  To query Condor for this information, run the command:
<pre class="screen">
%UCL_PROMPT% condor_status -schedd </pre>
You should see the hostname of the submission host.

---+++ All my jobs run locally
You should submit jobs like you'd do to run them locally but they should run on all available resources including the Campus Grid.
If all your jobs run locally, on your submit host, probably you or your system administrator have not configured correctly your Condor instance. 
Please check the instructions and the tests described in the [[CampusGrids.ConfiguringRemoteSubmissionHost][Configuring Submit Host]] document.

---++ References
   * [[http://www.cs.wisc.edu/condor/manual/v7.6/2_Users_Manual.html][Condor User Documentation]]
   * [[http://www.cs.wisc.edu/condor/manual/v7.6/2_5Submitting_Job.html][Condor Job Submission Documentation]]



---++ *Comments*
%COMMENT{type="tableappend"}%

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = DerekWeitzel

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|General|Integration|Monitoring|Operations|Security|Storage|Tier3|User|VO)
   * Local DOC_AREA       = User

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (Developer|Documenter|Scientist|Student|SysAdmin|VOManager)
   * Local DOC_ROLE       = Scientist

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (HowTo|Installation|Knowledge|Navigation|Planning|Training|Troubleshooting)
   * Local DOC_TYPE       = HowTo
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %YES%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %YES%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = MarcoMambelli 
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %YES%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = MarcoMambelli 
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %YES%
############################################################################################################
-->

%META:TOPICMOVED{by="DerekWeitzel" date="1308854963" from="Documentation.RunningCampusGridJobs" to="CampusGrids.RunningCampusGridJobs"}%
