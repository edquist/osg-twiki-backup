%META:TOPICINFO{author="DerekWeitzel" date="1308854976" format="1.1" reprev="1.6" version="1.6"}%
%META:TOPICPARENT{name="CampusGrids.WebHome"}%

%DOC_STATUS_TABLE%

<!--
   * Local UCL_HOST = submit

-->

---+!! Running jobs using the Campus Grid
%TOC%


---++ About This Document
This document is intended for Campus Grid users.  This includes campuses that are using the [[Documentation.CampusFactoryInstall][Campus Factory]], and those that are using all Condor infrastructures.  We are able to generalize because in both cases, jobs are flocked from a generic Condor installation to the remote resources.


---++ Requirements
This document assumes that you have installed the following on the submission host:
   1. [[http://www.cs.wisc.edu/condor/][Condor]]: Configured to be a central manager (see =etc/examples= in the condor installation). [[ReleaseDocumentation.ClientInstallationGuide][osg-client]] provides a personal Condor installation that could suit the task.

You can test to see if you have Condor running with the command:
<pre class="screen">
%UCL_PROMPT% condor_q </pre>

The output should be very similar to:
<pre class="screen">
%UCL_PROMPT% condor_q


-- Submitter: prairiefire.unl.edu : <129.93.229.141:37303> : prairiefire.unl.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               

0 jobs; 0 idle, 0 running, 0 held
</pre>

---++ Procedure
For remote submission, submissions that could run on remote resources including the Campus Factory, you must configure Condor to connect to the remote resource. For [[Documentation.CampusFactoryInstall][Campus Grids]], the remote resource to connect to, running the Condor Collector, is normally the login node where you installed the Campus Factory. See the [[Documentation.CampusFactoryInstall][install document]] for special cases involving CCB or external collectors.

---+++ Configuring Remote Submission
The submit host has to have specific configuration in order to work with remote resources. Find the local Condor configuration file using =condor_config_val LOCAL_CONFIG_FILE=. Add or edit the following values in it (you can check the previous value using =condor_config_val= for each of them):
   $ FLOCK_TO: This must be set to include the hostnames of the remote resources.  Each remote resource has to be added. Specifically, this needs to be the central manager of the remote resources, running the =condor_collector=.
   $ SEC_DEFAULT_AUTHENTICATION_METHODS: It must include `CLAIMTOBE`.  A typical value is `FS,CLAIMTOBE`.
   $ SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION: Must be set to TRUE.

You can test the configuration by running the command
<pre class="screen">
%UCL_PROMPT% condor_status -any -pool remote_host</pre>
Replacing `remote_host` with the hostname of the remote manager.  It should report no errors.

---
The remote manager needs to be configured to accept jobs from the submission host.  It must have the submission host in the =FLOCK_FROM= condor variable.

To test the configuration, run the command
<pre class="screen">
%UCL_PROMPT% condor_status -pool submit_host </pre>
Replacing `submit_host` with the hostname of the submission host.

#JobSubmission
---+++ Job Submission
To submit a job, you must first create a job description file.  Full documentation on Condor job files can be found in the [[http://www.cs.wisc.edu/condor/manual/v7.6/2_5Submitting_Job.html][Condor Documentation]].  Submission is done on a node running the =condor_schedd=

For example, you can create the file condor.submit.  In this file, enter (or copy/paste) the following:
<pre class="file">
universe = vanilla
executable = /bin/hostname
output = test.out
error = test.err
log = test.log
ShouldTransferFiles = YES
when_to_transfer_output = ON_EXIT
queue
</pre>

Submission of the job is done with the =condor_submit= tool:
<pre class="screen">
%UCL_PROMPT% condor_submit condor.submit
</pre>

If the job is run succesfully, you should see information in the =test.log= regarding where the job ran, what it's exit code was, and how long the job ran.  Additionally, test.out will have the hostname of the computer that ran the job.

---++ Validation of Success
The [[#JobSubmission][Job submission]] is an excellent test if the submission is working correctly.  

---++ Problem Resolution and Help
---+++!!Where to look for information
If any of these steps have failed, errors will be written by Condor to the Condor log files.  Log files can be found by querying Condor:
<pre class="screen">
%UCL_PROMPT% condor_config_val LOG </pre> 

On the submit host, the relevant log files are the =SchedLog=.  On the remote central manager, the =CollectorLog= and =NegotiatorLog= are relevant.  

On the remote central manager, Condor should have a record of the submission host when there are idle jobs on the submission host (with a few minute delay).  To query Condor for this information, run the command:
<pre class="screen">
%UCL_PROMPT% condor_status -schedd </pre>
You should see the hostname of the submission host.



---+++!!References
   * [[http://www.cs.wisc.edu/condor/manual/v7.6/2_Users_Manual.html][Condor User Documentation]]
   * [[http://www.cs.wisc.edu/condor/manual/v7.6/2_5Submitting_Job.html][Condor Job Submission Documentation]]



---++ *Comments*
%COMMENT{type="tableappend"}%

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = DerekWeitzel

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|General|Integration|Monitoring|Operations|Security|Storage|Tier3|User|VO)
   * Local DOC_AREA       = User

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (Developer|Documenter|Scientist|Student|SysAdmin|VOManager)
   * Local DOC_ROLE       = Scientist

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (HowTo|Installation|Knowledge|Navigation|Planning|Training|Troubleshooting)
   * Local DOC_TYPE       = HowTo
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %YES%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %YES%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = MarcoMambelli 
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %YES%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = MarcoMambelli 
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %YES%
############################################################################################################
-->

%META:TOPICMOVED{by="DerekWeitzel" date="1308854963" from="Documentation.RunningCampusGridJobs" to="CampusGrids.RunningCampusGridJobs"}%
