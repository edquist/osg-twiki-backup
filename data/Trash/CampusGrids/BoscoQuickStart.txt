%META:TOPICINFO{author="MarcoMambelli" date="1369626534" format="1.1" reprev="1.6" version="1.6"}%
%META:TOPICPARENT{name="BoSCO"}%
<!-- conventions used in this document
   * Local UCL_HOST = %URLPARAM{"INPUT_HOST" encode="quote" default="bosco"}%
   * Local UCL_USER = %URLPARAM{"INPUT_USER" encode="quote" default="user"}%
   * Local UCL_DOMAIN = %URLPARAM{"INPUT_DOMAIN" encode="quote" default="opensciencegrid.org"}%
   * Set TWISTY_OPTS_DETAILED = mode="div" showlink="Show Detailed Output" hidelink="Hide" showimgleft="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" hideimgleft="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" remember="on" start="hide" 
   * Set TOC2 =<div style="float:right; margin-right:-1.015em; padding:0.5em; background-color:white;">%TOC%<p class="twikiClear" /></div>

   * Set DOC_BANNERMESSAGE = This document requires BOSCO 1.2
-->

---+!! Bosco Quick Start Guide
%DOC_STATUS_TABLE%
%TOC{depth="3"}%


---# Introduction
This is a quick introduction to your personal BOSCO installation. Check the [[BoSCO][main document]] to find out more about what BOSCO is and how it works. Check the [[BoscoInstall][Install document]] for detailed installation requirements and all the install options. 

=bosco_quickstart= is a script that will guide through the installation and setup of BOSCO.
The script will take care of:
   1. Installing BOSCO in =~/bosco= if it is not already installed
   1. Connect one cluster (submit host) with BOSCO
   1. Send a test job to verify the cluster
And =bosco_quickstart= will also suggest you what to use to submit jobs

BOSCO is a tool to connect resources you already have access to. BOSCO connects to a *submit host*. The submit host has to be a machine where you can already login, e.g. with ==ssh !username@submit.mycluster.mydomain==, and then you can submit jobs to a local PBS, HTCondor, LSF or SGE queue manager. e.g. using commands like ==qsub==, ==condor_submit==, ...
In this document and in BOSCO we use the term *cluster*, because the submit host normally gives access to a set of worker nodes in a queue (a [[http://en.wikipedia.org/wiki/Computer_cluster][traditional cluster]]), but sometime it may give access to multiple resources where jobs can be queued. This could even be a gateway to Cloud and Grid resources (see OSG-XSEDE in the Support section below). 

---# Install, setup BOSCO and connect to one cluster 

With a single command you will install, setup BOSCO and connect to one cluster. 

<!-- [[%ATTACHURL%/bosco_quickstart][quickstart script]] 
%UCL_PROMPT% wget --no-check-certificate https://twiki.grid.iu.edu/twiki/pub/CampusGrids/BoscoQuickStart_draft/bosco_quickstart
-->
Download the [[ftp://ftp.cs.wisc.edu/condor/bosco/1.2/bosco_quickstart][quickstart script from this link]], or from the [[http://bosco.opensciencegrid.org/][BOSCO website]], or using curl:
<pre class=screen>
%UCL_PROMPT% curl -o bosco_quickstart ftp://ftp.cs.wisc.edu/condor/bosco/1.2/bosco_quickstart
</pre>

Invoke the quickstart script from a terminal:
<pre class=screen>
%UCL_PROMPT% sh ./bosco_quickstart
</pre>

If BOSCO was not installed, when asked "Do you want to install Bosco? Select y/n and press [ENTER])", answer "y" and press ENTER to confirm that you'd like to continue installing BOSCO. The quickstart script will print some information while downloading and installing BOSCO.

Then the quickstart script will ask you three questions about the cluster you want to connect to BOSCO. Follow each answer by pressing ENTER:
   * "Type the cluster name and press [ENTER]:" This is the full name of the cluster login node, e.g. =submit.mycluster.mydomain=
   * "Type your name at CLUSTER_NAME (default CURRENT_NAME) and press [ENTER]:" This is the =username= that you use to login in the cluster you want to connect. If you leave this empty BOSCO will assume that it is the same as your current username on the BOSCO host
   * "Type the queue manager for CLUSTER_NAME (pbs, condor, lsf, sge, slurm) and press [ENTER]" This is the program that is used to manage the jobs in the cluster you want to connect. E.g. of such programs are PBS, HTCondor, LSF, SGE. If you don't know what is installed, ask the sysadmin of the cluster.
   * Last but not least you'll be prompted for the password that you use when logging in in the cluster that you are connecting to BOSCO. If you are using ssh keys to connect to that cluster please see the NOTE (1) below.

%TWISTY{%TWISTY_OPTS_OUTPUT% showlink="Click to see an example of a quickstart execution:"}%
<pre class=screen>
%UCL_PROMPT% ./bosco_quickstart
Bosco Quickstart
detailed logging is in ./bosco_quickstart.log

Bosco is not installed. You need Bosco to run this quickstart.
Do you want to install Bosco? Select y/n and press [ENTER]): y
************** Downloading and Installing Bosco ***********
Installing BOSCO.......
BOSCO Installed
************** Starting Bosco: ***********
BOSCO Started
************** Connecting one cluster (resource) to BOSCO: ***********
At any time hit [CTRL+C] to interrupt.

Type the submit host name for the BOSCO resource and press [ENTER]: uc3-sub.uchicago.edu
Type your username on uc3-sub.uchicago.edu (default mmb) and press [ENTER]:
Type the queue manager for uc3-sub.uchicago.edu (pbs, condor, lsf, sge, slurm) and press [ENTER]: condor
Adding uc3-sub.uchicago.edu, user: mmb, queue manager: condor
mmb@uc3-sub.uchicago.edu's password:
...............................................................
uc3-sub.uchicago.edu added
************** Testing the cluster (resource): ***********
This may take up to 2 minutes... please wait..........................................................................
BOSCO on uc3-sub.uchicago.edu Tested
************** Congratulations, Bosco is now setup to work with uc3-sub.uchicago.edu! ***********
You are ready to submit jobs with the "condor_submit" command.
Remember to setup the environment all the time you want to use Bosco:
source ~/bosco/bosco_setenv

Here is a quickstart guide about BOSCO:
https://twiki.grid.iu.edu/bin/view/CampusGrids/BoscoQuickStart

To remove Bosco you can run:
source ~/bosco/bosco_setenv; bosco_uninstall --all

Here is a submit file example (supposing you want to run "myjob.sh"):
universe = grid
Executable = myjob.sh
arguments =
output = myjob.output.txt
error = myjob.error.txt
log = myjob.log
transfer_output_files =
should_transfer_files = YES
when_to_transfer_output = ON_EXIT
queue 1
</pre>
%ENDTWISTY%

%NOTE% (1) You must be able to login to the remote cluster. If password authentication is OK, the script will ask you for your password. If key only login is allowed, then you must load your key in the =ssh-agent=. Here is an example adding the key and testing the login: %TWISTY{%TWISTY_OPTS_DETAILED% }%   <pre class="screen">
%UCL_PROMPT% eval `ssh-agent`
Agent pid 17103;
%UCL_PROMPT% ssh-add id_rsa_bosco 
Enter passphrase for id_rsa_bosco: 
Identity added: id_rsa_bosco (id_rsa_bosco)
%UCL_PROMPT% ssh  uc3@itbv-ce-pbs
Last login: Thu Sep 13 13:49:33 2012 from uc3-bosco.mwt2.org
$ logout
</pre>
%ENDTWISTY%
 

%NOTE% (2) Some clusters have multiple login nodes behind a round robin DNS server. You can recognize them because when you login to the node (e,g: ==ssh login.mydomain.org==), it will show a name different form the one used to connect (e.g.: ==hostname -f== will return ==login2.mydomain.org==). If this happens you must connect the BOSCO resources by using a name of the host, not the DNS alias (e.g. ==bosco_cluster --add login2.mydomain.org==). This is because sometime these multiple login nodes do not share all the directories and BOSCO may be unable to find its files if different connections land on different hosts : %TWISTY{%TWISTY_OPTS_DETAILED% }%  Note how =midway-login2.rcc.uchicago.edu= must be used instead of =midway.rcc.uchicago.edu=: <pre class="screen">
%UCL_PROMPT% ssh  mm@%RED%midway.rcc.uchicago.edu%ENDCOLOR%
mm@midway.rcc.uchicago.edu's password: 
===============================================================================
                               Welcome to Midway
                           Research Computing Center
                             University of Chicago
...
===============================================================================

[mm@midway-login2 ~]$ hostname -f
%RED%midway-login2.rcc.uchicago.edu%ENDCOLOR%
[mm@midway-login2 ~]$ logout
Connection to midway.rcc.uchicago.edu closed.
%UCL_PROMPT% marco$ bosco_cluster --add mm@%RED%midway-login2.rcc.uchicago.edu%ENDCOLOR%
Warning: No batch system specified, defaulting to PBS
If this is incorrect, rerun the command with the batch system specified

Enter the password to copy the ssh keys to mm@midway-login2.rcc.uchicago.edu:
mm@midway-login2.rcc.uchicago.edu's password: 
Detecting PBS cluster configuration...bash: cannot set terminal process group (-1): Invalid argument
bash: no job control in this shell
bash: qmgr: command not found
Done!
Downloading for mm@midway-login2.rcc.uchicago.edu....
Unpacking.........
Sending libraries to mm@midway-login2.rcc.uchicago.edu...
Creating BOSCO for the WN's....................................................................
Installation complete
The cluster mm@midway-login2.rcc.uchicago.edu has been added to BOSCO
It is available to run jobs submitted with the following values:
> universe = grid
> grid_resource = batch pbs mm@midway-login2.rcc.uchicago.edu
%UCL_PROMPT%
</pre>
%ENDTWISTY%


Once the quickstart script completes successfully you can remove both the script and the log file:
<pre class=screen>
%UCL_PROMPT% rm ./bosco_quickstart ./bosco_quickstart.log
</pre>



---## How to use BOSCO
#SetupEnvironment
Since BOSCO is not installed in the system path. An environment file must be sourced all the times you use BOSCO (start/stop/job submission or query, anything):
<pre class="screen">
%UCL_PROMPT% source ~/bosco/bosco_setenv
</pre>


---# How to submit a job
Here is a simple example to submit your first Bosco job.
For more examples and options check the [[BoSCO][main Bosco document]].

In order to send a job with Bosco you must:
   1. Have an executable
   1. Prepare a submit file
   1. Submit the job
 
---## The Executable
This is a simple bash script, called =myjob.sh=: <pre class="file">
#!/bin/bash

# Prepare for the execution

# Run the actual applications
hostname 
date 
id 
whoami 


# Final steps

</pre>

Make sure that the file is executable: <pre class="screen">%UCL_PROMPT%  chmod +x myjob.sh</pre>

You can run it locally to test it and see the output: <pre class="screen">%UCL_PROMPT%  ./myjob.sh</pre>


---## The Submission File
This submission file will submit your job directly to the remote cluster, using the HTCondor "Grid" universe.  Copy it to a file, =example.sub=
<pre class="file">
universe = grid
Executable     = myjob.sh
arguments = 
output = output
error = error
log = myjob.log
transfer_output_files = 
should_transfer_files = YES
when_to_transfer_output = ON_EXIT
queue 1
</pre>

The type of cluster that you are submitting to, pbs, lsf, sge, or condor, must be supplied on the grid_resource line.

---## Job Submission
Submit the job in the file =example.condor= with the =condor_submit= command: <pre class="screen">
%UCL_PROMPT% condor_submit example.sub
</pre>

---## Job Monitoring
Monitor the job with =condor_q=.  For example, the job when idle is: <pre class="screen">
%UCL_PROMPT% condor_q

-- Submitter: uc3-c001.mwt2.org : <10.1.3.101:45876> : uc3-c001.mwt2.org
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               
  12.0   marco           7/6  13:45   0+00:00:00 I  0   0.0  short2.sh 10      

1 jobs; 0 completed, 0 removed, 1 idle, 0 running, 0 held, 0 suspended
</pre>


The job could be idle if it is currently idle at the remote cluster.  When the job is being executed on the remote cluster, the =ST= (State) will change to =R=, and the =RUN_TIME= will grow.

Another method of monitoring a job is to check the job's =log=, a human readable (for the most part) time line of actions relating to the job.  The =logfile= was specified in the submission script, for example =logfile= in the example above.  You can view the log file by using =cat=: <pre class="screen">
%UCL_PROMPT% cat *.log*
</pre>

---## Job output
Once the job completes BOSCO will transfer back standard output, standard error and the output files (if specified in the submit file), e.g. the job above will create stdout and stderr files (unique for each submission) and a file named starting with =myout-file= (e.g. =myout-file-12-0=) in the directory where the =condor_submit= command was executed.


---# What's next
You can submit your job by modifying the example above.

If you have more complex jobs, here are some pages that describe more in detail how to submit HTCondor jobs. Bosco jobs are the same as HTCondor jobs:
   * Tutorial: http://research.cs.wisc.edu/htcondor/tutorials/alliance98/submit/submit.html
   * Condor manual: http://research.cs.wisc.edu/htcondor/manual/v7.6/2_5Submitting_Job.html

To learn more about Bosco check the following pages:
   * [[http://bosco.opensciencegrid.org/][BoSCO Web site]]
   * [[BoSCO][Using Bosco (v1.1)]]
   * [[BoscoInstall][Installing BoSCO]]
   * [[BoscoMultiUser][Installing BoSCO Multi User]]
   * [[TestBoSCO][BOSCO tests for developers and testers]]


---# Get Help/Support
To get assistance you can send an email to bosco-discuss@opensciencegrid.org

[[http://www.opensciencegrid.org/][Open Science Grid]] is a collaboration that can provide access to opportunistic computing cycles. To access OSG via the [[https://www.opensciencegrid.org/bin/view/VirtualOrganizations/OSGasXsedeSp][OSG-XSEDE gateway]] you can write a request to osg-xsede-support@opensciencegrid.org . Once you have access to osg-xsede you can connect to it using BOSCO.

---+ Comments
%COMMENT{type="tableappend"}%

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
   * Local OWNER = MarcoMambelli

 DOC_AREA = (ComputeElement|General|Integration|Monitoring|Operations|Security|Storage|Tier3|User|VO)
   * Local DOC_AREA       = General
 DOC_ROLE = (Developer|Documenter|Scientist|Student|SysAdmin|VOManager)
   * Local DOC_ROLE       = SysAdmin
 DOC_TYPE = (HowTo|Installation|Knowledge|Navigation|Planning|Training|Troubleshooting)
   * Local DOC_TYPE       = Installation
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%
   * Local INCLUDE_TEST   = %YES%
   * Local REVIEW_READY   = %YES%
   * Local TEST_READY     = %YES%
   * Local RELEASE_READY  = %YES%

status for this document: in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )

   * Local REVIEWER       = 
   * Local REVIEW_PASSED  = %YES%

   * Local TESTER         = 
   * Local TEST_PASSED    = %YES%
############################################################################################################
-->
