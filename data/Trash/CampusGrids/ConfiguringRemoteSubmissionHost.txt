%META:TOPICINFO{author="KyleGross" date="1476804105" format="1.1" version="1.6"}%
%META:TOPICPARENT{name="WebHome"}%
%DOC_STATUS_TABLE%

<!--
   * Local UCL_HOST = submit

-->

---+!! *Configuring Remote Submission Host for a Campus Grid*
%TOC%

---++ About This Document
This document shows how to setup a remote submission host for submission into a Campus Grid.  The %RED%submission host%ENDCOLOR% can submit to clusters managed by %BLUE%Condor%ENDCOLOR%, and clusters that are running the %BLUE%[[Documentation.CampusFactoryInstall][Campus Factory]]%ENDCOLOR% (PBS clusters).

%ATTACHURL%/RemoteSubmissionDiagram.png

After completing this configuration, users will be able to submit jobs using the [[Trash/CampusGrids.RunningCampusGridJobs][Campus Grid Submission]] guide.
---++ Requirements
This document assumes that you have installed the following on the submission host:
   * Condor 7.4+: Configured to be a central manager (see etc/examples in the condor installation). osg-client provides a personal Condor installation that could suit the task. 

---++ Procedure
For remote submission, submissions that could run on remote resources including the Campus Factory, you must configure Condor to connect to the remote resource. For [[Documentation.CampusFactoryInstall][Campus Grids]], the remote resource to connect to, running the Condor Collector, is normally the login node where you installed the Campus Factory. See the [[Documentation.CampusFactoryInstall][install document]] for special cases involving CCB or external collectors.

---+++ Configuring Remote Submission
The submit host has to have specific configuration in order to work with remote resources. Find the local Condor configuration file using =condor_config_val LOCAL_CONFIG_FILE=. Add or edit the following values in it (you can check the previous value using =condor_config_val= for each of them):
   $ FLOCK_TO: This must be set to include the hostnames of the remote resources.  Each remote resource has to be added. Specifically, this needs to be the central manager of the remote resources, running the =condor_collector=.
   $ SEC_DEFAULT_AUTHENTICATION_METHODS: It must include `CLAIMTOBE`.  A typical value is `FS,CLAIMTOBE`.
   $ SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION: Must be set to TRUE.

You can test the configuration by running the command
<pre class="screen">
%UCL_PROMPT% condor_status -any -pool remote_host</pre>
Replacing `remote_host` with the hostname of the remote manager.  It should report no errors.


---+++ Configuring Remote Manager (Condor cluster or Campus Factory)
The remote manager needs to be configured to accept jobs from the submission host.  It must have the submission host in the =FLOCK_FROM= condor variable.

To test the configuration, run the command
<pre class="screen">
%UCL_PROMPT% condor_status -pool submit_host </pre>
Replacing `submit_host` with the hostname of the submission host.



---++ Validation of Success
The [[Trash/CampusGrids.RunningCampusGridJobs#JobSubmission][Job submission]] is an excellent test if the submission is working correctly.  

---++ Problem Resolution and Help
---+++!!Where to look for information
If any of these steps have failed, errors will be written by Condor to the Condor log files.  Log files can be found by querying Condor:
<pre class="screen">
%UCL_PROMPT% condor_config_val LOG </pre> 

On the submit host, the relevant log files are the =SchedLog=.  On the remote central manager, the =CollectorLog= and =NegotiatorLog= are relevant.  

On the remote central manager, Condor should have a record of the submission host when there are idle jobs on the submission host (with a few minute delay).  To query Condor for this information, run the command:
<pre class="screen">
%UCL_PROMPT% condor_status -schedd </pre>
You should see the hostname of the submission host.

---+++!!What to look for in the Log Files
If there is a problem, it is likely a security issue.  Look in the logs for =DENIED=.  For example, on the remote manager:
<pre class="screen">
[user@manager ~]$ grep DENIED /path/to/logs/CollectorLog </pre>

Or on the submission host.
<pre class="screen">
%UCL_PROMPT% grep DENIED /path/to/logs/SchedLog </pre>



---++ *Comments*
%COMMENT{type="tableappend"}%

<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = DerekWeitzel

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|General|Trash/Integration|Monitoring|Operations|Security|Storage|Trash/Tier3|User|VO)
   * Local DOC_AREA       = User

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (Developer|Documenter|Scientist|Student|SysAdmin|VOManager)
   * Local DOC_ROLE       = Scientist

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (HowTo|Installation|Knowledge|Navigation|Planning|Training|Troubleshooting)
   * Local DOC_TYPE       = HowTo
  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %YES%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %YES%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %YES%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = MarcoMambelli 
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %YES%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = MarcoMambelli 
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %YES%
############################################################################################################
-->




-- Main.DerekWeitzel - 23 Jun 2011

%META:FILEATTACHMENT{name="RemoteSubmissionDiagram.png" attachment="RemoteSubmissionDiagram.png" attr="" comment="" date="1308859916" path="RemoteSubmissionDiagram.png" size="33709" stream="RemoteSubmissionDiagram.png" tmpFilename="/usr/tmp/CGItemp148" user="DerekWeitzel" version="2"}%
