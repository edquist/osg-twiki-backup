%META:TOPICINFO{author="BrianLin" date="1437626500" format="1.1" version="1.7"}%
%META:TOPICPARENT{name="UserSchool15Materials"}%
---+ Wednesday Exercise 1.1: Refresher - Making a simple DAG

The goal of this exercise is to map the physical locations of some worker nodes in our local cluster. To do this, you will write another wide DAG that will submit many jobs into the cluster and summarizes the results into a single file.

---++ Where in the World Are My Jobs?

To find the physical location of the computers your jobs our running on, you will be utilizing a method called geolocation. Geolocation uses a registry to match computer's public IP address to an approximate location. The following is a Python script that geolocates the machine that it is running on, returning latitude and longitude coordinates:

<pre class="file">
#!/bin/env python

import socket
import urllib2
import json

hostname = socket.getfqdn()
ipaddr = socket.gethostbyname(hostname)
try:
    response = urllib2.urlopen('http://www.freegeoip.net/json/' + ipaddr).read()
    json_response = json.loads(response)
    print "%s,%s" % (json_response['latitude'], json_response['longitude'])
except urllib2.HTTPError:
    pass
</pre>

   1. In a new folder on =osg-ss-submit=, save the above Python script as a file named =location.py=
   1. Create a submit file that runs =location.py= 
   1. Create nine copies of your submit file, these 'location' submit files will be the wide part of your DAG
   1. Edit each of the submit files so that they output to different =output=, =error=, and =log= files
   1. For the 'summary' part of your DAG, create a submit file that runs =/bin/cat= and uses each of the output files of the 'location' jobs as its arguments
   1. Write a DAG with the 'summary' job as the child of all the 'location' jobs
   1. Submit your DAG and wait for the results

*Note:* It is also possible to set up the wide part of the DAG using VARS and a single submit file. If you would like the extra challenge, do this version instead of or in addition to the one above! 

---++ Mapping Your Jobs

To visualize the locations of the machines that your jobs ran on, we will be using http://www.mapcustomizer.com/. Copy and paste the results from your DAG into the bulk creation text box at the bottom of the screen. Are the results what you expected? 

%META:TOPICMOVED{by="BrianLin" date="1437598620" from="Education.UserSchool15Wed11Glideins" to="Education.UserSchool15Wed11DagRefresher"}%
