%META:TOPICINFO{author="DerekWeitzel" date="1499360083" format="1.1" version="1.1"}%
%META:TOPICPARENT{name="UserSchool17Materials"}%
---+ Thursday Exercise 1.3: Try an OSG Connect Software Module
%TOC% 

In this exercise, you'll repeat a previous job using the Gromacs software, but using the OSG Connect software module for Gromacs instead of bringing a pre-packaged installation along with the job.

---++ Setup

   * Make sure you are logged into =login.osgconnect.net=
   * Navigate to your =stash= directory within the home directory, and create a directory for this exercise named =thur-gromacs-module=.
   * Copy the contents of your directory for Exercise 1.3 from yesterday into the directory. These need to include the submit file, run_gromacs.sh wrapper script, and gromacs input files. (You won't actually need the =gromacs.tar.gz= file, since you'll rely on the OSG Connect module for the Gromacs software.)

---++ Practice Loading the Gromacs Module on OSG Connect

Before proceeding, make sure to read over the OSG Connect helpdesk guide on [[https://support.opensciencegrid.org/support/solutions/articles/5000634394-accessing-software-using-distributed-environment-modules][Accessing Software using Distributed Environment Modules]].

1. Run the =module avail= command to see available modules and determine which =gromacs= version will be the default (designated by a =(D)=). Is this the same version of Gromacs used in yesterday's Exercise 3.1?

2. Before loading the =gromacs= module, check your "PATH" variable with:

<pre class="screen">
%UCL_PROMPT_SHORT% <strong>echo $PATH</strong>
</pre>

3. Now load the =gromacs= module, which will give you the default version, and check your list of modules:

<pre class="screen">
%UCL_PROMPT_SHORT% <strong>module load gromacs</strong>
%UCL_PROMPT_SHORT% <strong>module list</strong>
</pre>

4. Recheck your "PATH" variable. What has changed? Is the default version of =gromacs= visible?

5. When you're done, unload the module and check that you no longer have the module loaded:

<pre class="screen">
%UCL_PROMPT_SHORT% <strong>module unload gromacs</strong>
%UCL_PROMPT_SHORT% <strong>module list</strong>
%UCL_PROMPT_SHORT% <strong>echo $PATH</strong>
</pre>

---++ Modify the Submit and Wrapper Files

Now, you'll prepare the job files to rely on the =gromacs= module.

1. In the submit file, remove the =gromacs.tar.gz= file from the list of =transfer_input_files=, add your project name, and add the line necessary for using the OSG Connect modules:

<pre class="file">
+ProjectName = "UserSchool2016"
requirements = (HAS_MODULES =?= true)
</pre>

2. In the =run_gromacs.sh= file, replace the =tar= and =export= commands with the below, since you'll be relying on the OSG Connect module to set up the =gromacs= software and environment variables. The first command will engage the module capabilities so that the second command can load the appropriate =gromacs= module. In the job, you'll generally want to be specific about which =gromacs= module version you want, so that even if the default changes, you'll always know for sure which version was used!

<pre class="file">
. /cvmfs/oasis.opensciencegrid.org/osg/modules/lmod/current/init/bash
module load gromacs/5.0.0
</pre>

---++ Submit the Job

After you've made the above changes, submit the job and monitor it so you can later check the output against the output from yesterday's Exercise 1.3. The job may take a while, so once you've confirmed that it's been running a few minutes (in which case, it should be running correctly!), you can move on with the next step.

---++ Software Modules from Anywhere!

Now copy the entire =thur-gromacs-module= directory to =osg-learn.chtc.wisc.edu= and resubmit the job, again, after removing the "+ProjectName" line from the submit file. (You don't _have_ to submit from =login.osgconnect.net= in order to use OSG Connect modules!)

---++ Compare Results
Were the results of this new Gromacs job (regardless of where you submitted) the same as for yesterday's Exercise 1.3? If they're different, why might they be?


-- Main.DerekWeitzel - 06 Jul 2017