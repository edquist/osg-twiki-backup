%META:TOPICINFO{author="ForrestChristian" date="1170108241" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="LectureTwoTutorial"}%
<link rel="stylesheet" type="text/css" href="%PUBURL%/%WEB%/WorkshopTutorialModules/exercises.css">

---+!! Using <nop>MyProxy

%TOC%

%STARTINCLUDE%
%EDITTHIS%

A <nop>MyProxy server is running on your local machine and we will use that to see how we can manage your credentials using the <nop>MyProxy Server.

---+++ Loading proxy into <nop>MyProxy Server
This steps creates a proxy on the <nop>MyProxy Server. For this exercise we will use the credentials that was pre-configured for you, so unset environment variable. Also, there is no need for a local proxy at this point, so we remove it.


<pre class="screen">
[train31@gridlab1 ~]$ <userinput>unset X509_USER_PROXY</userinput>
[train31@gridlab1 ~]$ <userinput>grid-proxy-destroy</userinput>
[train31@gridlab1 ~]$ <userinput>grid-proxy-info</userinput>
ERROR: Couldn't find a valid proxy.
Use -debug for further information.
[train31@gridlab1 ~]$ 
[train31@gridlab1 ~]$ <userinput>myproxy-init -s gridlab1</userinput>
Your identity: /C=US/O=SDSC/OU=SDSC/CN=Account Train31/UID=train31
Enter GRID pass phrase for this identity:
Creating proxy ............................... Done
Proxy Verify OK
Your proxy is valid until: Fri Jun 30 10:34:27 2006
Enter <nop>MyProxy pass phrase:
Verifying - Enter <nop>MyProxy pass phrase:
Verify failure
Error entering passphrase.
[train31@gridlab1 ~]$ <nop>myproxy-init -s gridlab1
Your identity: /C=US/O=SDSC/OU=SDSC/CN=Account Train31/UID=train31
Enter GRID pass phrase for this identity:
Creating proxy .......................................................... Done
Proxy Verify OK
Your proxy is valid until: Fri Jun 30 10:34:42 2006
Enter <nop>MyProxy pass phrase:
Verifying - Enter <nop>MyProxy pass phrase:
A proxy valid for 168 hours (7.0 days) for user train31 now exists on gridlab1.
[train31@gridlab1 ~]$ 
</pre>

The first pass phrase is to decrypt your private key.

The second pass phrase is one to protect your login on the <nop>MyProxy server.

A credential exists for you on the server now, but there are no local credentials.

<pre class="screen">
[train31@gridlab1 ~]$ <userinput>grid-proxy-info</userinput>
ERROR: Couldn't find a valid proxy.
Use -debug for further information.
[train31@gridlab1 ~]$ 
</pre>

---+++ Accessing credentials from <nop>MyProxy Server

<pre class="screen">
[train31@gridlab1 ~]$ <userinput>myproxy-logon -s gridlab1</userinput>
Enter <nop>MyProxy pass phrase:
A credential has been received for user train31 in /tmp/x509up_u539.
[train31@gridlab1 ~]$ 
</pre>

The pass phrase here is the <nop>MyProxy pass phrase, rather than your credential.

A local copy of proxy certificate with lifetime of 12 hours  exists now.

<pre class="screen">
[train31@gridlab1 ~]$ <userinput>grid-proxy-info </userinput>
subject  : /C=US/O=SDSC/OU=SDSC/CN=Account Train31/UID=train31/CN=1046308089/CN=398902167/CN=947386583
issuer   : /C=US/O=SDSC/OU=SDSC/CN=Account Train31/UID=train31/CN=1046308089/CN=398902167
identity : /C=US/O=SDSC/OU=SDSC/CN=Account Train31/UID=train31
type     : Proxy draft (pre-RFC) compliant impersonation proxy
strength : 1024 bits
path     : /tmp/x509up_u539
timeleft : 11:59:42
[train31@gridlab1 ~]$ 
</pre>

---+++ Using credentials from <nop>MyProxy Server for globus-url-copy

<pre class="screen">
[train31@gridlab1 ~]$ <userinput>\rm <nop>myProxyTest </userinput>
[train31@gridlab1 ~]$ <userinput>ls -lt <nop>myProxyTest</userinput>
ls: <nop>myProxyTest: No such file or directory
[train31@gridlab1 ~]$ <userinput>globus-url-copy gsiftp://localhost:2811/home/train31/tempFile gsiftp://localhost:2811/home/train31/myProxyTest</userinput>
[train31@gridlab1 ~]$ <userinput>ls -lt <nop>myProxyTest</userinput>
-rw-r--r--  1 train31 train31 43 Jun 23 10:37 <nop>myProxyTest
[train31@gridlab1 ~]$ <userinput>more <nop>myProxyTest</userinput> 
Temporary file for testing globus-url-copy
[train31@gridlab1 ~]$ 
</pre>



---+++ Using credentials from <nop>MyProxy Server for globusrun-ws

<pre class="screen">
[train31@gridlab1 ~]$ <userinput>globusrun-ws -submit -s -c /usr/bin/whoami</userinput>
Delegating user credentials...Done.
Submitting job...Done.
Job ID: uuid:7915c350-02ce-11db-97df-000feae0c5a8
Termination time: 06/24/2006 15:39 GMT
Current job state: Active
Current job state: CleanUp-Hold
train31
Current job state: CleanUp
Current job state: Done
Destroying job...Done.
Cleaning up any delegated credentials...Done.
[train31@gridlab1 ~]$ 
</pre>


The job sumitted returns your login name. 

Since the output of the job needs to be streamed back to the client using GridFTP, user credentials have to be delegated.


d107 1
---+++ Running globusrun-ws from a different machine
Swap machines with your friend. Attempt to run the job from previous step. You should see the login of your friend:
Swap machines with your friend. Attempt to run the job from previous step. You should see the login of your friend, in this case _ranantha_:

<pre class="screen">
[ranantha@gridlab2 ~]$ <userinput>globusrun-ws -submit -s -c /usr/bin/whoami</userinput>
Delegating user credentials...Done.
Submitting job...Done.
Job ID: uuid:e1b9ef26-02ce-11db-a207-000feae0c5a8
Termination time: 06/24/2006 15:42 GMT
Current job state: Active
Current job state: CleanUp-Hold
ranantha
Current job state: CleanUp
Current job state: Done
Destroying job...Done.
Cleaning up any delegated credentials...Done.
[ranantha@gridlab1 ~]$ 
</pre>

Now download credentials from your <nop>MyProxy Server and attempt to run the job again. Your username on the <nop>MyProxy server is your login name, since we did not override it on command line when you did =<nop>MyProxy-init=.
d112 1
<pre class="screen">
[ranantha ~]$ <userinput>myproxy-logon -s %LOGINHOST% -l train31</userinput>
[ranantha@gridlab1 ~]$ <userinput>myproxy-logon -s gridlab1 -l train31</userinput>
Enter <nop>MyProxy pass phrase:
A credential has been received for user train31 in /tmp/x509up_u502.
[ranantha@gridlab1 ~]$
</pre>

The above overwrites your friend's credntial with yours from <nop>MyProxy server. Attempt running the job now, you should see your own login name, since the credentials are yours.

<pre class="screen">
[ranantha@gridlab2 ~]$ <userinput>globusrun-ws -submit -s -c /usr/bin/whoami</userinput>
elegating user credentials...Done.
Submitting job...Done.
Job ID: uuid:12e40e7e-02cf-11db-87ab-000feae0c5a8
Termination time: 06/24/2006 15:43 GMT
Current job state: Active
Current job state: CleanUp-Hold
train31
Current job state: CleanUp
Current job state: Done
Destroying job...Done.
Cleaning up any delegated credentials...Done.
[ranantha@gridlab1 ~]$ 
</pre>

d133 1
Remember to destroy your proxy from your friend's machine!

<pre class="screen">
[ranantha@gridlab1 ~]$ <userinput>grid-proxy-destroy </userinput>
[ranantha@gridlab1 ~]$ 
</pre>


---+++ Deleting your credentials from <nop>MyProxy Server

Use =myproxy-destroy= to remove your credentials from the server. You should have valid credentials to do that.

<pre class="screen">
[train31@gridlab1 ~]$ <userinput>myproxy-destroy  -s %LOGINHOST%</userinput>
[train31@gridlab1 ~]$ <userinput>myproxy-destroy  -s gridlab1</userinput>
Default <nop>MyProxy credential for user train31 was successfully removed.
[train31@gridlab1 ~]$
</pre>


%STOPINCLUDE%
a146 1
%BOTTOMMATTER%
-- Main.ForrestChristian - 2007 Jan 29: pulled from original %BR% 