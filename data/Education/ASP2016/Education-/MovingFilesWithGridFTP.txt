%META:TOPICINFO{author="ForrestChristian" date="1178199228" format="1.1" reprev="1.7" version="1.7"}%
%META:TOPICPARENT{name="LectureFourTutorial"}%
<link rel="stylesheet" type="text/css" href="%PUBURL%/%WEB%/WorkshopTutorialModules/exercises.css">

---+!! Moving files with !GridFTP


%TOC%

%STARTINCLUDE%
%EDITTHIS%

Use =globus-url-copy= to move your small file from your home directory on %LOGINHOST% to your home directory on %OTHERHOST%.

<pre class="screen">
$ <userinput>globus-url-copy file:///home/%LOGINNAME%/dataex/smallfile-%LOGINNAME% gsiftp://%OTHERHOST%/home/%LOGINNAME%/ex1</userinput>
echo $?
0
</pre>

The =echo $?= checks to see what the return value was for the previous command. If you see a zero (0), then =globus-url-copy= succeeded. A different number indicates a problem. In that case you should also see an error message.

---+++ Measuring transfer speed
See how fast the file transfer is happening by using the -vb flag when copying the large file. Since this is a transfer over a local network that should probably not be too busy it should be fairly quick:

<pre class="screen">
$ <userinput>globus-url-copy -vb file:///home/%LOGINNAME%/dataex/largefile-%LOGINNAME% gsiftp://%OTHERHOST%/home/%LOGINNAME%/ex1</userinput>
Source: file:///home/%LOGINNAME%/dataex/
Dest:   gsiftp://%OTHERHOST%/home/%LOGINNAME%/
  largefile-%LOGINNAME%  ->  ex1
    207618048 bytes         8.81 MB/sec avg         9.09 MB/sec inst
</pre>

---+++ Transfers to a remote site
Now try transferring a file to a remote site. This example uses %GRIDHOST% as the remote site. However, there are various other sites that you could use - the instructors can tell you.

First you will need some scratch space on the remote system. You could use your home directory, but in this case we will use the official scratch space. Use globusrun-ws to make a scratch directory:

<pre class="screen">
%LOGINHOST%$ <userinput>globus-job-run %GRIDHOST% /bin/mkdir /scratch/%LOGINNAME%</userinput>
</pre>

Now copy the file over to this directory:

<pre class="screen">
%LOGINHOST%$ <userinput>globus-url-copy -vb file:///home/%LOGINNAME%/dataex/smallfile-%LOGINNAME% gsiftp://%GRIDHOST%/scratch/%LOGINNAME%/ex1</userinput>
Source: file:///home/%LOGINNAME%/dataex/smallfile
Dest:   gsiftp://%GRIDHOST%/scratch/%LOGINNAME%/
  largefile-%LOGINNAME%  ->  ex1
    208666624 bytes         1.41 MB/sec avg         1.43 MB/sec inst
</pre>

You will probably find that the transfer rate is much lower than when copying to local machines.

You can try copying to other sites in addition to %GRIDHOST%. Remember that you might need to make a scratch directory on each one, and that the place for this will be different for each site.

---+++ URL formats

A quick reminder on URL formats: We've seen two kind of URLs so far.

   * =file:///home/%LOGINNAME%/dataex/largefile= - a file called =largefile= on the local file system, in directory =/home/%LOGINNAME%/dataex/=.

   * =gsiftp://%GRIDHOST%/scratch/%LOGINNAME%/= - a directory accessible via gsiftp on the host called =%GRIDHOST%= in directory =/scratch/%LOGINNAME%=.


---+++ Parallel streams

Trying using 4 parallel data streams by adding the -p flag with an argument of 4:

Now that you're %GRIDHOST%, use the =dd= commands you issued earlier in the exercise to create the small, medium, and large files to create those files in your home directory on the Teragrid site.

Use the following =globus-url-copy= command to transfer the file from your location on the Teragrid to the site at ISI:

<pre class="screen">
$ <userinput>globus-url-copy -p 4 -vb file:///home/%LOGINNAME%/dataex/smallfile-%LOGINNAME% gsiftp://workshop3.lac.uic.edu/home/%LOGINNAME%/ex1</userinput>
</pre>

Experiment with transferring different file sizes and numbers of parallel streams, to both local and remote sites and see how the speed varies.

---+++Third party transfers
Next try a <span class="firstterm">third-party transfer</span>. You do this by specifying two gsiftp URLs, instead of one gsiftp URL and one file URL.

=globus-url-copy= will control the transfers but data will *not* pass through. Instead, it will go directly between the source and destination machines.

Transfer a file between two remote sites, and see if it is faster than if you had transferred it to %LOGINHOST% and then back out again.

Try to make up a command line for this yourself &mdash; you should use two gsiftp URLs, instead of a file url and a gsiftp URL.

<!-- ***  Comments plugin to create comments table for section   ***    -->

<span class="educationWebAddComment">ADD A COMMENT</span>
%STARTMore%

%TABLE{ }%
|  *COMMENT*  |  *NAME*  |  *DATE*  |
| This is test comment 1. | Main.MichaelWilde | 18 Apr 2007 - 12:34 |
| To start, practice cutting text from your this page in your web browser to run a command or set of commands: cut the pwd command from the box above and paste it into your terminal window to execute it. This is a good way to avoid making typos while entering commands from the examples. | Main.MichaelWilde | 18 Apr 2007 - 12:34 |
%COMMENT{ type="tableappend" }%

%ENDMore%
<!-- ***  End Comment                                            ***    -->



%STOPINCLUDE%

<!--                                                                            
      * Set LOGINHOST = workshop1.lac.uic.edu
      * Set LOGINIP = 131.193.181.56
      * Set GRIDHOST = tg-login.sdsc.teragrid.org
      * Set OTHERHOST = workshop2.lac.uic.edu
      * Set CERTSUBJECT = /O=Grid/OU=OSG/CN=Training User 99
      * Set LOGINNAME = train99
      * Set HOMEDIR = /home/%LOGINNAME%
--> 

%BOTTOMMATTER%
--Main.ForrestChristian - 2007 Jan 29: pulled from Lecture 4 %BR% 
-- Main.ForrestChristian - 24 Mar 2007 - Added VARIABLES  %BR%
