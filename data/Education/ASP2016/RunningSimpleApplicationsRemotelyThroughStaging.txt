%META:TOPICINFO{author="BenClifford" date="1173666337" format="1.1" version="1.5"}%
%META:TOPICPARENT{name="LectureOneTutorial"}%
<link rel="stylesheet" type="text/css" href="%PUBURL%/%WEB%/WorkshopTutorialModules/exercises.css">

---+ Running a simple application remotely, through "staging"

%STARTINCLUDE%
%EDITTHIS%

Now we'll create a simple application - in this case a shell script - and send the application itself to remote Grid sites. We'll call this application =genr=  - a simple script to generate fixed-width pseudo-random numbers.

<pre class="programlisting">
#! /bin/sh
NLINES=$1
NDIGITS=$2
awk "BEGIN {
  for (i = 0 ; i < $NLINES; i++ ) {
    print int(rand() * 10^$NDIGITS )
  }
}"
</pre>

<ol></li>
   <li>Using copy/paste, copy the script above into a new file named =genr=. </li>
   <li>Save the file in your home directory on %LOGINHOST%.</li>
   <li>Make the =genr= script executable: 
<pre class="screen">
$ <userinput>chmod +x genr</userinput>
</pre></li>
   <li>Test the script locally.
<pre class="screen">
$ <userinput>./genr nlines ndigits </userinput>
</pre> 
        <p>Your genr script should behave like this:
<pre class="screen">
$ <userinput>./genr 5 8</userinput> # 5 lines of 8 digits
23778751
29106573
84581385
15220829
58553734
$ 
</pre></p></li>
   <li>Test =genr= under =globus-job-run= to make sure it runs locally through the Globus GRAM interface:
<pre class="screen">
$ <userinput>globus-job-run %LOGINHOST%/jobmanager-fork /home/train35/genr 5 4 </userinput>
2377
2910
8458
1522
5855
$
</pre></li>
   <li>Execute =genr= on %OTHERHOST% from %LOGINHOST%:
    <pre class="screen">gridlab1$ <userinput>globus-job-run %OTHERHOST%/jobmanager-fork /home/train35/genr 5 4</userinput></pre>
    <p>What happens? Why?</p></li>
   <li>Add the =-s= or =stage= option to the request. This will automatically copy this mini-application to the remote Grid site (gridlab3) so that it can be executed there:
<pre class="screen">$ <userinput>globus-job-run %LOGINHOST%/jobmanager-fork -s /home/train35/genr 5 4</userinput></pre></li>
</ol>

---+++ Exercise: 
Can you run the same application on <em>%GRIDHOST%</em>?  Did it really stage, or did the application already exist out there?  How can you be sure?


%STOPINCLUDE%

<!--                                                                            
      * Set LOGINHOST = gridlab1
      * Set GRIDHOST = tg-login.ncsa.teragrid.org
      * Set OTHERHOST = gridlab2
-->  
d75 12
%BOTTOMMATTER%
-- Main.ForrestChristian - 29 Jan 2007: edited from original

<!--                                                                            
      * Set LOGINHOST = workshop2.lac.uic.edu
      * Set LOGINHOSTSHORT = workshop1
      * Set LOGINIP = 131.193.181.56
      * Set GRIDHOST = tg-login.sdsc.teragrid.org
      * Set OTHERHOST = workshop2.lac.uic.edu
      * Set OTHERHOSTSHORT = workshop2
      * Set CERTSUBJECT = /O=Grid/OU=OSG/CN=Training User 99
      * Set LOGINNAME = train99
      * Set HOMEDIR = /home/%LOGINNAME%
--> 