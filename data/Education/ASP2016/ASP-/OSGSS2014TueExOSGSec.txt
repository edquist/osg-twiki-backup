%META:TOPICINFO{author="IgorSfiligoi" date="1404794375" format="1.1" reprev="1.2" version="1.2"}%
%META:TOPICPARENT{name="UserSchool14Materials"}%
---+ 2014 OSG User School - Understanding your certificate

Time to spend on this: 10 minutes<br>
Node to use: Preferentially osg-ss-submit.chtc.wisc.edu, but 10g-5.t2.ucsd.edu will work just as well.

Assumption: You should have [[UserSchool14Certificate][obtained your certificate]] by now.

Please copy your .p12 file into the ~/.globus directory (and create the directory first, if needed), if you have not done it yet.<br>
Make sure it is not readable by anyone else but you
<pre class="screen">
sfiligoi@osg ~$ ls -l .globus/
-rw------- 1 sfiligoi osgeduadm 5098 May  2  2014 cert.p12
</pre>

---+++ Looking into your certificate

The standard tool to look into a x.509 certificate is *openssl*.
It provides a (relatively) easy way to do this. Try all these:
<pre class="screen">
openssl pkcs12 -in ~/.globus/cert.p12 -nokeys -clcerts |openssl x509 -noout -subject
openssl pkcs12 -in ~/.globus/cert.p12 -nokeys -clcerts |openssl x509 -noout -enddate
openssl pkcs12 -in ~/.globus/cert.p12 -nokeys -clcerts |openssl x509 -noout -text
</pre>

The complication stems from the fact that the certificate is in .p12, but openssl works best on .pem formated files.<br>
So, and easy way around it is to first save the certificate information into .pem format, and only then run *openssl* on it.
<pre class="screen">
openssl pkcs12 -in ~/.globus/cert.p12 -nokeys -clcerts > ~/.globus/cert_pub.pem

openssl x509 -noout -subject -in  ~/.globus/cert_pub.pem
openssl x509 -noout -enddate -in  ~/.globus/cert_pub.pem
openssl x509 -noout -text    -in  ~/.globus/cert_pub.pem
</pre>

*Note:* The cert_pub.pem file does not contain the full certificate, only the information part of it. Enough for this exercise, but cannot be used for authentication purposes.

---++ Extending the certificate with VOMS attributes

As mentioned in the security lecture, you will often want to extend your certificate with a VOMS attribute.<br>
The resulting new certificate is often referred to as *a proxy*.

To create the VOMS-extended proxy, use can use <b>voms-proxy-init</b>
<pre class="screen">
voms-proxy-init -cert ~/.globus/cert.p12 -key ~/.globus/cert.p12 -out ~/.globus/proxy.pem -voms osgedu -valid 12:0 -hours 12
</pre>

Unlike the original certificate, which is in the p12 format, the proxy will already be in the PEM format.
Using *openssl* to look at it is thus slightly easier
<pre class="screen">
openssl x509 -in ~/.globus/proxy.pem -noout -subject
openssl x509 -in ~/.globus/proxy.pem -noout -enddate
openssl x509 -in ~/.globus/proxy.pem -noout -text
</pre>

You probably did not see the VOMS attribute in the output.
This is due to the fact that openssl does not know how to interpret the VOMS attribute.

The OSG software comes with an tool knows how to parse the VOMS attributes. It is called <b>voms-proxy-info</b>.<br>
You can use it both for the original certificate and for the proxy:
<pre class="screen">
voms-proxy-info -file ~/.globus/proxy.pem -all
voms-proxy-info -file ~/.globus/proxy.pem -all -chain
voms-proxy-info -file ~/.globus/cert_pub.pem -all
voms-proxy-info -file ~/.globus/cert_pub.pem -all -chain
</pre>

-- Main.IgorSfiligoi - 27 Jun 2014
