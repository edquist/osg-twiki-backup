%META:TOPICINFO{author="ForrestChristian" date="1174762225" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="LectureSevenTutorial"}%
<link rel="stylesheet" type="text/css" href="%PUBURL%/%WEB%/WorkshopTutorialModules/exercises.css">

---+!! Packaging Your Grid Application

%TOC%

%STARTINCLUDE%
%EDITTHIS%

We will use [[http://physics.bu.edu/pacman/][pacman]] (Package Manager) for this part of the exercise. It's a handy packaging tool that has many useful features including fetching, installing and updating software packages with simple commands.


<a name="download" />
---+++ Download and Install Pacman
<pre class="screen">
[%LOGINNAME%@%LOGINHOST% ~]$ <userinput>wget http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-latest.tar.gz</userinput>
--13:51:27--  http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-latest.tar.gz
           =&gt; `pacman-latest.tar.gz'
Resolving physics.bu.edu... done.
Connecting to physics.bu.edu[128.197.41.42]:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 77,154 [application/x-gzip]
                                                                                
100%[====================================&gt;] 77,154       159.97K/s    ETA 00:00
                                                                                
13:51:28 (159.97 KB/s) - `pacman-latest.tar.gz' saved [77154/77154]

[%LOGINNAME%@%LOGINHOST% ~]$ <userinput>tar zxvf pacman-latest.tar.gz</userinput>
pacman-3.18.4/
pacman-3.18.4/caches_starter
pacman-3.18.4/CVS/
pacman-3.18.4/CVS/Entries
pacman-3.18.4/CVS/Repository
pacman-3.18.4/CVS/Root
pacman-3.18.4/doc/
.
.
.

[%LOGINNAME%@%LOGINHOST% pacman-3.18.4]$ <userinput>cd pacman-3.18.4/</userinput>
[%LOGINNAME%@%LOGINHOST% pacman-3.18.4]$ <userinput>source setup.sh</userinput>
[%LOGINNAME%@%LOGINHOST% ~]$ <userinput>pacman -version</userinput>
Pacman version:  3.18.4
Python version:  2.2.2 (#1, Feb 24 2003, 19:13:11) 
[GCC 3.2.2 20030222 (Red Hat Linux 3.2.2-4)]
Your platform [RedHat-9] satisfies { *, linux, Linux, linux-redhat-8, linux-redhat-9, redhat, Redhat, RedHat, RedHat-6, Redhat-6, RedHat-7, Redhat-7, RedHat-8, Redhat-8, RedHat-9, Redhat-9, unix, Unix }
</pre>

After these steps, pacman is ready to use. You can download the whole VDT package with a single command:

%WARNING% Do not start the installation now. Installing the VDT require a great deal of time. 
   
<pre class="screen">
[%LOGINNAME%@%LOGINHOST% ~]$ <userinput>pacman -get VDT:VDT</userinput>
</pre>

<a name="caches" />
---+++ Pacman caches
From pacman documentation:

<blockquote>

A Pacman cache is a just a URL or location in a local file system containing  files with the .pacman extension. Each such file defines how a package is  fetched, installed and set up.

</blockquote>

---+++ Example pacman file

<pre class="programlisting">
description = 'Text Editor'
url = 'http://www.nedit.org/'
download = {'*': 'nedit-5.1.1-linux-glibc.tar.gz' }
paths = [['PATH','']]
</pre> 

---+++ Exercise
In this part of the exercise, we will create a localcache and package our application with pacman. Then, we will install the application in a seperate directory using this cache.

Create a directory for the cache and temporary directory for installing your dprime application.

<pre class="screen">
[%LOGINNAME%@%LOGINHOST% ~]$ <userinput>mkdir localcache</userinput>
[%LOGINNAME%@%LOGINHOST% ~]$ <userinput>mkdir installs</userinput>
</pre>

Create a directory for your application and copy =prime.c= to the directory:

<pre class="screen">
[%LOGINNAME%@%LOGINHOST% ~] <userinput>mkdir dprime</userinput>
[%LOGINNAME%@%LOGINHOST% ~] <userinput>cp prime.c dprime</userinput>
</pre>

Create a Makefile in the application directory to compile your application. You can use the following Makefile. Copy it to the =dprime= directory.

<pre class="programlisting">
CC=gcc
EXES=prime
all: $(EXES)

prime: prime.c
   gcc -w -o $@ $&lt;

clean:
   rm -f $(EXES)
</pre>

%NOTE% Make sure that the spaces before =gcc= and =rm= in the above file are actually tabs!

Tar and gzip the files.

Copy the zipped file to =localcache= directory:

<pre class="screen">
[%LOGINNAME%@%LOGINHOST% ~]$ <userinput>tar zcvf dprime.tar.gz dprime/prime.c dprime/Makefile</userinput>

[%LOGINNAME%@%LOGINHOST% ~]$ <userinput>mv dprime.tar.gz localcache/</userinput>
[%LOGINNAME%@%LOGINHOST% ~]$ <userinput>cd localcache</userinput>
[%LOGINNAME%@%LOGINHOST% localcache]$ 
</pre>

Create a file named =dprime.pacman= in the localcache directory. The file should contain:

<pre class="programlisting">
# Descprtion of the package
description = 'Prime Number Finder'
# What to download?
download    = {'unix' : 'dprime.tar.gz'}
# How to install
install     = {'*':['make']}
</pre>

Go to =installs= directory and run pacman:

<pre class="screen">
[%LOGINNAME%@%LOGINHOST% localcache]$ <userinput>cd ../installs</userinput>
[%LOGINNAME%@%LOGINHOST% installs]$ <userinput>pacman -get ../localcache:dprime</userinput>

Do you want to add [../localcache] to [trusted.caches]? (y or n): y
Package [dprime] found in [../localcache]...
Downloading [dprime.tar.gz] from [localcache]...
Untarring [dprime.tar.gz]...
gcc -o prime prime.c 
</pre>

<!--
You can look the information about the packages using the following command
<pre class="screen">
<b>[%LOGINNAME%@%LOGINHOST% installs]$ pacman -info</b>
</pre>
<img src="pacman-info.png" />
<p>
-->

You can make changes to the =dprime.pacman= file, maybe simply changing the description. Update the software with =pacman -update-check=.

<pre class="screen">
[%LOGINNAME%@%LOGINHOST% installs]$ <userinput>pacman -update-check</userinput>
Package [dprime] found in [../localcache]...
Update of [../localcache:dprime] found...

[%LOGINNAME%@%LOGINHOST% installs]$ <userinput>pacman -l</userinput>
[*] dprime, in cache [/home/%LOGINNAME%/test-lab6/installs] ==> UPDATE AVAILABLE 

[%LOGINNAME%@%LOGINHOST% installs]$ <userinput>pacman -d src ups 0 -l</userinput>
.
.
[%LOGINNAME%@%LOGINHOST% installs]$ <userinput>pacman -update</userinput>
</pre>
%STOPINCLUDE%
<!--                                                                            
      * Set LOGINHOST = workshop1.lac.uic.edu
      * Set LOGINIP = 131.193.181.56
      * Set GRIDHOST = tg-login.sdsc.teragrid.org
      * Set OTHERHOST = workshop2.lac.uic.edu
      * Set CERTSUBJECT = /O=Grid/OU=OSG/CN=Training User 99
      * Set LOGINNAME = train99
      * Set HOMEDIR = /home/%LOGINNAME%
--> 


%BOTTOMMATTER% 

-- Main.ForrestChrisitan - 2007 Jan 28: pulled from original %BR% 
-- Main.ForrestChristian - 24 Mar 2007 - Added VARIABLES   %BR%