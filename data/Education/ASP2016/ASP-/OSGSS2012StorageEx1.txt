%META:TOPICINFO{author="DerekWeitzel" date="1340315553" format="1.1" version="1.4"}%
%META:TOPICPARENT{name="UserSchool12Materials"}%
---+ Determining Storage Requirements

---++ About this exercise
This exercise's goal is to learn to think critically about an application's data needs.  In this exercise we will attempt to understand the input and output of the bioinformatics application [[http://blast.ncbi.nlm.nih.gov/][BLAST]].

---++ Customize this Document

<!-- OSG Summer School 2011 Defaults
   * Local VO= %URLPARAM{"INPUT_VO" encode="quote" default="osgedu"}%
   * Local UCL_HOST = %URLPARAM{"INPUT_HOST" encode="quote" default="osg-ss-glidein"}%
   * Local UCL_USER = %URLPARAM{"INPUT_USER" encode="quote" default="user"}%
   * Local UCL_DOMAIN = %URLPARAM{"INPUT_DOMAIN" encode="quote" default="chtc.wisc.edu"}%
   * Local GATEKEEPER = %URLPARAM{"INPUT_GATEKEEPER" encode="quote" default="red.unl.edu"}%
   * Local UCL_CWD= %URLPARAM{"INPUT_CWD" encode="quote" default="~/osg_school/dm_part_2"}%
   * Local BATCH_SYSTEM = %URLPARAM{"BATCH_SYSTEM" encode="quote" default="condor"}%
   * Local REMOTE_ROOT = %URLPARAM{"INPUT_REMOTE_ROOT" encode="quote" default="/mnt/hadoop/user"}%
   * Local REMOTE_SRM = %URLPARAM{"INPUT_SRM" encode="quote" default="red-srm1.unl.edu:8443"}%
   * Local REMOTE_GRIDFTP= %URLPARAM{"INPUT_GRIDFTP" encode="quote" default="red-gridftp12.unl.edu"}%
   * Local SURL = srm://%REMOTE_SRM%/srm/v2/server?SFN=%REMOTE_ROOT%
   * Local TURL= gsiftp://%REMOTE_GRIDFTP%/%REMOTE_ROOT%
   * Local OSG_DATA=%URLPARAM{"INPUT_OSG_DATA" encode="quote" default="/osg/data"}%
   * Local BLAST_DB_SUBMIT=%URLPARAM{"INPUT_BLAST_DB_SUBMIT" encode="quote" default="/opt/workshop/dm_exercises/part2"}%
   * Local VDT_LOCATION=/opt/osg-client
-->

%ICON{"warning"}% %RED% Please change your user name and click on the Customize button!%ENDCOLOR%
<form action="%SCRIPTURLPATH{"view"}%/%WEB%/%TOPIC%">
<table>
  <tr>
    <td>
      VO
    </td>
    <td>
      <input size=100 type="text" name="INPUT_VO" value="%VO%"/>
    </td>
  <tr>
    <td>
      Host Name
    </td>
    <td>
      <input size=100 type="text" name="INPUT_HOST" value="%UCL_HOST%"/>
    </td>
  </tr>
  <tr>
    <td>
      Domain Name
    </td>
    <td>
      <input size=100 type="text" name="INPUT_DOMAIN" value="%UCL_DOMAIN%"/>
    </td>
  </tr>
  <tr>
    <td>
      Login Name
    </td>
    <td>
      <input size=100 type="text" name="INPUT_USER" value="%UCL_USER%"/>
    </td>
  </tr>
    <td>
      Exercise Path
    </td>
    <td>
      <input size=100 type="text" name="INPUT_CWD" value="%UCL_CWD%"/>
    </td>
  </tr>
  <tr>
    <td>
      Remote SE root directory
    </td>
    <td>
      <input size=100 type="text" name="INPUT_REMOTE_ROOT" value="%REMOTE_ROOT%"/>
    </td>
  </tr>
  <tr>
    <td>
      SRM host endpoint
    </td>
    <td>
      <input size=100 type="text" name="INPUT_SRM" value="%REMOTE_SRM%"/>
    </td>
  </tr>
  <tr>
    <td>
      !GridFTP host endpoint
    </td>
    <td>
      <input size=100 type="text" name="INPUT_GRIDFTP" value="%REMOTE_GRIDFTP%"/>
    </td>
  </tr>
  <tr>
    <td>
     &nbsp;
     <input type="submit" class="twikiSubmit" value="Customize" />
    </td>
  </tr>
</table>
</form>


---++ Understanding blastp
The executable used for blast is ==blastp==.  It is located at ==%BLAST_DB_SUBMIT%==.  The goal of this exercise is to understand ==blastp== enough to be able to copy all files necessary for a single blast search into a directory.  ==blastp== is executed with: <pre class="screen">
%UCL_PROMPT% blastp -db %RED%database_file%ENDCOLOR% -query %RED%query_file%ENDCOLOR%
</pre>

I have provided an input query file in ==%BLAST_DB_SUBMIT%/query.fasta==.  Create a shell script that will copy the files for a yeast search into a directory.  

%TWISTY{
showlink="Show hint"
hidelink="Hide hint"
mode="div"
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
Here's the command line that you should end up with to start ==blastp==:
<pre class="screen">
%UCL_PROMPT% ./blastp -db ./yeast.aa -query ./query.fasta
</pre>
%ENDTWISTY%

This may require copying files into a directory, running ==blastp==, ==blastp== failing, then copying more files into a directory.  Repeat until blastp successfully completes.  Make a note of the files in the directory and create a shell script that will copy those files into a directory and run ==blastp==.

---+++ Input requirements
The input to blast is a database (file).  In the ==%BLAST_DB_SUBMIT%== directory, there is a few different databases.  For this exercise, attempt to only run the yeast db.

Make a note of the files required for a run of ==blastp==.  This will be important in future exercises.  

---+++ Output requirements
The output that we care about is sent to stdout.

---++ Replicating setup
Now that you have made an execution for yeast, can you do the same for drosoph.aa ?

---++ Possible storage possibilities
Once you have completed the script, you will have a list of files that are required for running ==blastp==.  This will help in finding what files need to be stored.  Can you answer some of the questions:

   * How much space is required for the yeast run?  drosoph.aa?
   * How many files are needed for the runs?
   * Assuming the each file is read completely by BLAST, and since you know how long blastp runs:
      * At what rate are files read in?  
      * How many MB/s?


---++ Extra Credit: Running the script as a condor job

Since you now know the files necessary for blast to run, you can use ==transfer_input_files== in the condor submit file to send them in a condor job.  Make a condor job that runs a yeast query.

