%META:TOPICINFO{author="KyleGross" date="1465570410" format="1.1" version="1.3"}%
%META:TOPICPARENT{name="AfricaGridSchoolMaterials"}%
---++ Customize this Document

<!-- OSG Summer School 2011 Defaults
   * Local UCL_USER = %URLPARAM{"INPUT_USER" encode="quote" default="YOUR-LOGIN-NAME"}%
-->

%ICON{"warning"}% %RED% Please change your Login Name and click on the Customize button!%ENDCOLOR%
<form action="%SCRIPTURLPATH{"view"}%/%WEB%/%TOPIC%">
<table>
  <tr>
    <td>
      %RED%Login Name%ENDCOLOR%
    </td>
    <td>
      <input size=100 type="text" name="INPUT_USER" value="%UCL_USER%"/>
    </td>
  </tr>
  <tr>
    <td>
     &nbsp;
     <input type="submit" class="twikiSubmit" value="Customize" />
    </td>
  </tr>
</table>
</form>

---+ A few tips and tricks

<div style="margin-left: 1em; margin-right: 1em; border: 1px solid black; padding: 0.5em;">
---+++ Objective of this exercise
This exercise will teach you a few nifty commands to help you use Condor more easily.
</div>

---++ Tips for condor_q

You're been using =condor_q=, but it shows the jobs of everyone who submitted from the computer you are running the command on. If you want to see just your jobs, try this: 

<pre style="margin-left:4em" class="screen">
% condor_q %UCL_USER%
</pre>

Curious where your jobs are running? Use the =-run= option to see where jobs are running. (Idle jobs are not shown.) 
<pre style="margin-left:4em" class="screen">
% condor_q -run

-- Submitter: frontal.cci.ucad.sn : <10.0.0.252:9645> : frontal.cci.ucad.sn
 ID      OWNER          . SUBMITTED     RUN_TIME HOST(S)
  28.44  kagross         8/18 14:51   0+00:00:42 slot1@node2.cci.ucad.sn
  28.45  kagross         8/18 14:51   0+00:00:37 slot2@node2.cci.ucad.sn
  28.46  kagross         8/18 14:51   0+00:00:32 slot3@node2.cci.ucad.sn
  28.47  kagross         8/18 14:51   0+00:00:27 slot4@node2.cci.ucad.sn
  28.48  kagross         8/18 14:51   0+00:00:20 slot1@frontal.cci.ucad.sn
  28.49  kagross         8/18 14:51   0+00:00:14 slot2@frontal.cci.ucad.sn
</pre>

=condor_q= can also show you your job !ClassAd. Recall back to the lecture and the discussion of !ClassAds. For instance, you can look at the !ClassAd for a single job:

<pre style="margin-left:4em" class="screen">
% condor_q -l 23.0

MaxHosts = 1
User = "kagross@frontal.cci.ucad.sn"
OnExitHold = false
CoreSize = 0
MachineAttrCpus0 = 1
WantRemoteSyscalls = false
MyType = "Job"
Rank = 0.0
CumulativeSuspensionTime = 0
MinHosts = 1
PeriodicHold = false
PeriodicRemove = false
Err = "simple.49.error"
ProcId = 49
EnteredCurrentStatus = 1408374244
UserLog = "/home/kagross/condor-test/s
... output trimmed ... 
</pre>

There are some interesting parts you can check out. For instance, where is the job running? 

<pre style="margin-left:4em" class="screen">
% condor_q -l 24.0 | grep RemoteHost
RemoteHost = "slot2@frontal.cci.ucad.sn"
</pre>

How many times has this job run? (It might be more than one if there were recoverable errors.)

<pre style="margin-left:4em" class="screen">
% condor_q -l 24.0 | grep JobRunCount
JobRunCount = 1
</pre>

Where is the user log for this job? This is helpful when you assist someone else in debugging and they're not sure.

<pre style="margin-left:4em" class="screen">
% condor_q -l 24.0 | grep UserLog
UserLog = "/home/kagross/condor-test/simple.47.log"
</pre>

What the job's requirements? Condor automatically fills some in for you, to make sure your job runs on a reasonable computer in our cluster, but you can override any of these. I've broken the output into multiple lines to explain it to you.

<pre style="margin-left:4em" class="screen">
% condor_q -l 23.0 | grep Requirements
Requirements =( TARGET.Arch == "X86_64" ) # %RED% Run on a 64-bit computer %ENDCOLOR%
    && ( TARGET.OpSys == "LINUX" )  # %RED% Make sure you run on Linux %ENDCOLOR%
    && ( TARGET.Disk >= RequestDisk ) # %RED% Make sure the default disk Condor is on has enough disk space. %ENDCOLOR%
    && ( TARGET.Memory >= RequestMemory ) # %RED% Make sure the computer has enough memory %ENDCOLOR%
    && ( TARGET.HasFileTransfer )# %RED% Only run on a computer that can accept your files. %ENDCOLOR%
</pre>
---++ Tips for condor_status
%RED% Again, I was unable to get any of this to return things %ENDCOLOR%
Curious about what jobs are being run right now? 

<pre style="margin-left:4em" class="screen">
% condor_status -claimed

Name            OpSys       Arch   LoadAv RemoteUser           ClientMachine   

slot1@frontal.c LINUX       X86_64  0.000 kagross@frontal.cci. frontal.cci.ucad
slot2@frontal.c LINUX       X86_64  0.000 kagross@frontal.cci. frontal.cci.ucad
slot3@frontal.c LINUX       X86_64  0.000 kagross@frontal.cci. frontal.cci.ucad
slot4@frontal.c LINUX       X86_64  0.220 kagross@frontal.cci. frontal.cci.ucad
slot1@node2.cci LINUX       X86_64  0.000 kagross@frontal.cci. frontal.cci.ucad
slot2@node2.cci LINUX       X86_64  0.000 kagross@frontal.cci. frontal.cci.ucad
slot3@node2.cci LINUX       X86_64  0.000 kagross@frontal.cci. frontal.cci.ucad
slot4@node2.cci LINUX       X86_64  0.000 kagross@frontal.cci. frontal.cci.ucad
                     Machines         MIPS       KFLOPS   AvgLoadAvg

        X86_64/LINUX        8        85248      9454816   0.027

               Total        8        85248      9454816   0.027
</pre>

Curious about who has submitted jobs? 

<pre style="margin-left:4em" class="screen">
% condor_status -submitters

Name                 Machine      Running IdleJobs HeldJobs

DedicatedScheduler@c chtcsubmit         0        0        0
nickwu@chtcsubmit.an chtcsubmit         0        0        0
soaruser@chtcsubmit. chtcsubmit         0        0        0
group_cmsprod.osg_cm cmsgrid01.         0      225        1
osg_cmsuser1003@hep. cmsgrid01.         0       23        1
osg_cmsuser101@hep.w cmsgrid01.         0        4        1
...
    yli@hep.wisc.edu                79                 37                  0
 zliu57@hep.wisc.edu                 0                 12                  3

               Total              1456              48485               1071
</pre>

Or perhaps you want to know all the machines from which you can submit jobs: (assuming you had permission, which you don't)

<pre style="margin-left:4em" class="screen">
% condor_status -schedd

Name                 Machine    TotalRunningJobs TotalIdleJobs TotalHeldJobs 

amundsen.cs.wisc.edu amundsen.c                0             0              0
c145.chtc.wisc.edu   c145.chtc.                0             0              0
chtcsubmit.ansci.wis chtcsubmit                0             0              0
cmsgrid01.hep.wisc.e cmsgrid01.             1955          2654            133
cmsgrid02.hep.wisc.e cmsgrid02.              775          4885             50
...
submit.chtc.wisc.edu submit.cht                9             5            895
tg-condor.rcac.purdu tg-condor.              902          7364              4
vm-crane.chtc.wisc.e vm-crane.c                0             0              0
                      TotalRunningJobs      TotalIdleJobs      TotalHeldJobs

                    
               Total              9917              49509               2287
</pre>

Just like we could look at the !ClassAd for a job, we can also look at them for computers. 

<pre style="margin-left:4em" class="screen">
% condor_status -l slot1@e026.chtc.wisc.edu
TotalCondorLoadAvg = 0.0
JavaSpecificationVersion = "1.7"
IsValidCheckpointPlatform = ( TARGET.JobUniverse =!= 1 || ( ( MY.CheckpointPlatform =!= undefined ) && ( ( TARGET.LastCheckpointPlatform =?= MY.CheckpointPlatform ) || ( TARGET.NumCkpts == 0 ) ) ) )
JavaVendor = "Oracle Corporation"
MonitorSelfTime = 1408374697
OpSys = "LINUX"
DetectedCpus = 4
Mips = 15968
LastFetchWorkSpawned = 0
AuthenticatedIdentity = "condor_pool@frontal.cci.ucad.sn"
HibernationState = "NONE"
TotalLoadAvg = 0.020000
HasMPI = true

... output trimmed ...
</pre>

Some features of interest:

<pre style="margin-left:4em" class="screen">
%RED%# The computer's name %ENDCOLOR%
% condor_status -l slot1@e026.chtc.wisc.edu  | grep "^Name"
Name = "slot1@frontal.cci.ucad.sn"

%RED%# The computer's other name. %ENDCOLOR%
% condor_status -l slot1@e026.chtc.wisc.edu  | grep "^Machine "
MachineResources = "cpus memory disk swap"
Machine = "frontal.cci.ucad.sn"
MachineMaxVacateTime = 10 * 60

%RED%# The state of the computer? %ENDCOLOR%
 condor_status -l slot1@e026.chtc.wisc.edu  | grep "^State"
State = "Unclaimed"

%RED%# The version of Condor this computer is running. %ENDCOLOR%
% condor_status -l slot1@e026.chtc.wisc.edu  | grep "CondorVersion"
CondorVersion = "$CondorVersion: 8.0.7 Jun 19 2014 $"

%RED%# When this computer will start jobs. %ENDCOLOR%
% condor_status -l slot1@e026.chtc.wisc.edu  | grep -E "(^Start |Requirements)"
Requirements = ( START ) && ( IsValidCheckpointPlatform )
StartdIpAddr = "<172.16.200.1:9250>"
StarterAbilityList = "HasTDP,HasFileTransferPluginMethods,HasJobDeferral,HasJICLocalConfig,HasJICLocalStdin,HasPerFileEncryption,HasFileTransfer,HasVM,HasReconnect,HasMPI,HasJava"
Start = true

%RED%# How many CPUs this computer has %ENDCOLOR%
% condor_status -l slot1@e026.chtc.wisc.edu  | grep TotalCpus
TotalCpus = 4
</pre>

What else can you find that's interesting in the !ClassAd?

---++ Removing jobs

If you submit a job that you realize has a problem, you can remove it with =condor_rm=. For example: 

<pre style="margin-left:4em" class="screen">
% condor_q

-- Submitter: osg-ss-submit.chtc.wisc.edu : <128.104.100.55:9618?sock=28867_10e4_2> : osg-ss-submit.chtc.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               
  29.0   roy             6/21 15:23   0+00:00:00 I  0   0.7  simple 60 10      

1 jobs; 0 completed, 0 removed, 2 idle, 0 running, 0 held, 0 suspended

% condor_rm 29.0
Job 29.0 marked for removal

% condor_q

-- Submitter: osg-ss-submit.chtc.wisc.edu : <128.104.100.55:9618?sock=28867_10e4_2> : osg-ss-submit.chtc.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               

0 jobs; 0 completed, 0 removed, 1 idle, 0 running, 0 held, 0 suspended
</pre>

A few tips:

   * You can remove all of your jobs with the -all option.
   * You can't remove other users jobs.
   * There are [[http://www.cs.wisc.edu/condor/manual/v8.0/condor_rm.html][fancy options to condor_rm]].  

---++ Historical information
You can see information about jobs that completed and are no longer in the queue with the =condor_history_ command. It's rare that you want to see *all* the jobs, so try looking at jobs for just you:

<pre style="margin-left:4em" class="screen">
condor_history %UCL_USER%
</pre>

For example:
<pre style="margin-left:4em" class="screen">
% condor_history kagross
   9.9   kagross         7/31 12:44   0+00:00:03 C   7/31 12:44 /home/kagross/simple 9 9
   9.8   kagross         7/31 12:44   0+00:00:03 C   7/31 12:44 /home/kagross/simple 8 9
   9.11  kagross         7/31 12:44   0+00:00:03 C   7/31 12:44 /home/kagross/simple 11 9
   9.7   kagross         7/31 12:44   0+00:00:03 C   7/31 12:44 /home/kagross/simple 7 9
   9.5   kagross         7/31 12:44   0+00:00:02 C   7/31 12:44 /home/kagross/simple 5 9
   9.6   kagross         7/31 12:44   0+00:00:02 C   7/31 12:44 /home/kagross/simple 6 9
   9.3   kagross         7/31 12:44   0+00:00:02 C   7/31 12:44 /home/kagross/simple 3 9
   9.2   kagross         7/31 12:44   0+00:00:02 C   7/31 12:44 /home/kagross/simple 2 9
   9.1   kagross         7/31 12:44   0+00:00:03 C   7/31 12:44 /home/kagross/simple 1 9
   9.0   kagross         7/31 12:44   0+00:00:03 C   7/31 12:44 /home/kagross/simple 
   9.4   kagross         7/31 12:44   0+00:00:01 C   7/31 12:44 /home/kagross/simple 4 9
   8.0   kagross         7/31 12:42   0+00:00:07 C   7/31 12:42 /home/kagross/simple 4 10
...
</pre>



-- Main.KyleGross - 05 Aug 2014