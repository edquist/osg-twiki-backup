%META:TOPICINFO{author="IgorSfiligoi" date="1372195787" format="1.1" version="1.4"}%
%META:TOPICPARENT{name="UserSchool13Materials"}%
---+ 2013 OSG User School - Using directly the Grid

Time to spend on this: about 1 hour (i.e. until 5pm)

We will use [[OSGSS2013TueGlideinSetup][the DHTC submit node]] for this exercise, too.

---+++ Motivation

You may wonder why this exercise is needed at all.
After all, Igor told you that DHTC is normally used through an overlay system.

However, there may be times when you get access to a Grid site that your overlay infrastructure does (yet) not support.
In those cases, it might be convenient to start using the Grid resources through direct submission.
It is likely be a little work to get it to work, but the payout may just be big enough to be worth the pain.

---+++ Simulating a Dynamical billiard

In this exercise session, we will try to find the best way to shot a billiard ball in a [[http://en.wikipedia.org/wiki/Dynamical_billiards][Dynamical Billiard]].
This problem is particularly interesting since it is by definition a chaotic system;
i.e. a very small change in the ball's initial condition will result in a completely different result.

We will be working with a billiard table that has 16 round obstacles on it. The system is idealized, with the ball being point-like.
We will start from a fixed starting point (25,200) and will try to find the best angle that results in the ball ending in the upper right corner.<br />
     <img src="%ATTACHURLPATH%/billiard.gif" alt="billiard.gif" width='1001' height='401' />

We will approach the problem as a parameter sweep; i.e. we will try out all the possible angles and see how the ball behaves. 
In order to finish in a reasonable amount of time, we will discretize the sweep in 10^-4 of a degree. 

The library that calculates the number of bounces a ball performs before reaching the target is located in:
<pre class="screen">
/share/sim1/exe/sim.py
</pre>

A tool that will run a parameter sweep is in 
<pre class="screen">
/share/sim1/exe/sweepsim.py
</pre>
with the syntax being
<pre class="screen">
sweepsim.py x y minangle maxangle steps
</pre>

You can also try your luck by hand by running
<pre class="screen">
/share/sim1/exe/sweepsim.py
</pre>

This later tool will also create a picture of the process, named "out.png"
<pre class="screen">
runsim.py -graph x y angle
</pre>

For fun, try out angles 70.254, 70.2545 and 70.255 (with x=25 y=200).<br>
(possibly while waiting for the results of the complete sweep... see below)

PS: It takes close to nothing to run a single test, but it takes about a minute to try out 10k different angles.

---+++ Condor-G jobs

We will use Condor-G to submit jobs to the School's CE.<br>
(the DHTC overlay you were using in the morning is not going there)

Condor-G jobs are very similar to regular HTCondor jobs, but instead of being <b>vanilla</b> they are <b>grid</b> jobs.
You will also have to explicitly specify which CE you want to go.

For this exercise, we will use:
<pre class="screen">
universe = grid
grid_resource=gt5 osg-ss-ce.chtc.wisc.edu/jobmanager-condor
</pre>

<b>Note:</b> Unlike vanilla jobs, gird jobs will not automatically return the created files; 
you would need to explicitly [[http://research.cs.wisc.edu/htcondor/manual/v8.0/condor_submit.html#man-condor-submit-transfer-output-files][provide a list]] to HTCondor.
This will however not be a problem for us, since we will return all output in the stdout.

You should also have a valid proxy pointed by
<pre class="screen">
X509_USER_PROXY
</pre>

If you want to just cut-and-paste, create a new directory, copy in
<pre class="screen">
/share/sim1/condor/grid.condor
</pre>
and submit it. You should get your results back in about 15 minutes.<br>
(I would however recommend you try to understand what it is doing first)

Once submitted, monitor you job as you have done in the past two days. Look also in the log file.<br>
How is monitoring different?

PS: Don't forget to create a picture of the angle with the least bounces!

-- Main.IgorSfiligoi 

%META:FILEATTACHMENT{name="billiard.gif" attachment="billiard.gif" attr="" comment="Billiard example image - animated" date="1371790593" path="billiard.gif" size="65882" stream="billiard.gif" tmpFilename="/usr/tmp/CGItemp16793" user="IgorSfiligoi" version="1"}%
%META:FILEATTACHMENT{name="sim.py.txt" attachment="sim.py.txt" attr="" comment="Billiard simulating library - sim.py" date="1371793939" path="sim.py" size="4114" stream="sim.py" tmpFilename="/usr/tmp/CGItemp16755" user="IgorSfiligoi" version="1"}%
%META:FILEATTACHMENT{name="sweepsim.py.txt" attachment="sweepsim.py.txt" attr="" comment="Wrapper to run the simulation sweep - sweepsim.py" date="1371794031" path="sweepsim.py" size="1265" stream="sweepsim.py" tmpFilename="/usr/tmp/CGItemp16715" user="IgorSfiligoi" version="1"}%
%META:FILEATTACHMENT{name="runsim.py.txt" attachment="runsim.py.txt" attr="" comment="Graphing wrapper to check a single angle - runsim.py" date="1371794207" path="runsim.py" size="1149" stream="runsim.py" tmpFilename="/usr/tmp/CGItemp16593" user="IgorSfiligoi" version="1"}%
%META:FILEATTACHMENT{name="sim10.sh" attachment="sim10.sh" attr="" comment="Wrapper for the Condor-G job" date="1371794452" path="sim10.sh" size="108" stream="sim10.sh" tmpFilename="/usr/tmp/CGItemp16491" user="IgorSfiligoi" version="1"}%
%META:FILEATTACHMENT{name="grid.condor" attachment="grid.condor" attr="" comment="COndor-G submit file" date="1371794473" path="grid.condor" size="382" stream="grid.condor" tmpFilename="/usr/tmp/CGItemp16417" user="IgorSfiligoi" version="1"}%
