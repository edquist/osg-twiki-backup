%META:TOPICINFO{author="BalamuruganDesinghu" date="1438201995" format="1.1" reprev="1.8" version="1.8"}%
%META:TOPICPARENT{name="UserSchool15Materials"}%
<style type="text/css">
pre em { font-style: normal; background-color: yellow; }
pre strong { font-style: normal; font-weight: bold; color: #008; }
</style>

----+ Accelerating transfers with HTTP caching

Some of your computing works  require transferring  the same set of files over and over again. In such cases, it is better to cache the data for quick access.  As we discussed in the lecture, the squid proxy has been installed on many sites that caches the data for frequent usage. 

---++ Setup

You can get started using the template below:
<pre class="file">
universe = vanilla
executable = namd_run.sh
output =
error = 
log = 
requirements = (HAS_CVMFS_oasis_opensciencegrid_org =?= TRUE)
queue
</pre>
Remember that the =requirements= line is needed to tell HTCondor to only match against job slots that have the OASIS software library available (you may refer [[https://support.opensciencegrid.org/support/solutions/articles/5000634394-accessing-software-using-distributed-environment-modules][here]]). 
Don't forget to specify the =output=, =error=, and =log=!

We take care of the input file transfer in the wrapper script. First, copy the NAMD files to your =~/public/namd-input-files = directory.
<pre class="screen">
%UCL_PROMPT_SHORT% mkdir -p ~/public/namd-input-files
%UCL_PROMPT_SHORT% cp -a /stash/public/userschool2015/namd ~/public/namd-input-files/.
</pre>

Our wrapper script is:
<pre class="file">
#!/bin/bash

# Set up the proxy to take advantage of cache
export http_proxy=$OSG_SQUID_LOCATION

# Transfer input files using wget command
wget http://stash.osgconnect.net/+username/namd-input-files/ubq.pdb
wget http://stash.osgconnect.net/+username/namd-input-files/ubq.psf 
wget http://stash.osgconnect.net/+username/namd-input-files/ubq_gbis_eq.conf
wget http://stash.osgconnect.net/+username/namd-input-files/par_all27_prot_lipid.inp

# Use the NAMD module from OASIS 
source /cvmfs/oasis.opensciencegrid.org/osg/modules/lmod/current/init/bash
module load namd/2.9

# Execute NAMD
namd2 ubq_gbis_eq.conf > ubq_gbis_eq.log
</pre> 
Save the wrapper as =namd_run.sh= and remember to make it executable with =chmod +x namd_run.sh=. Note that =username= need to be changed to your username on l=ogin.osgconnect.net=.

Once done, submit the job. 
<pre class="screen">
%UCL_PROMPT_SHORT% condor_submit namd_run.submit
</pre>

Again, the job should run 5 minutes or so. If the job was successful, you should see a bunch of output files in the directory you submitted from. You can verify that the input files were downloaded by looking at the =output= file you created in your job.
 
-- Main.BalamuruganDesinghu - 23 Jul 2015

%META:FILEATTACHMENT{name="data_tranfer_stash.jpg" attachment="data_tranfer_stash.jpg" attr="" comment="Data transfer from stash-public" date="1437761849" path="data_tranfer_stash.jpg" size="40123" stream="data_tranfer_stash.jpg" tmpFilename="/usr/tmp/CGItemp10057" user="BalamuruganDesinghu" version="1"}%
