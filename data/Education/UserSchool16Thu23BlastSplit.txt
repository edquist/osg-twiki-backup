%META:TOPICINFO{author="LaurenMichael" date="1468871999" format="1.1" version="1.1"}%
%META:TOPICPARENT{name="UserSchool16Materials"}%
<style type="text/css">
pre em { font-style: normal; background-color: yellow; }
pre strong { font-style: normal; font-weight: bold; color: #008; }
</style>

---+ Thursday Exercise 2.3: Splitting Large Input for Better Throughput

In this exercise, we will run a job using a downloaded, pre-compiled binary.  This exercise should take 20-25 minutes.  

---++ Background

Versus the previous exercise, let's say now that you want to run some real, larger data through a program like 'blast'. In this case, we want to blast the RNA sequence data from a mouse sample agains the pdbaa reference database. However,   

---++ Blah - EVERYTHING BELOW NEEDS TO BE CHANGED.



---++ Obtain the Input Files

To run BLAST, we need an input file and reference database.  For 
this example, we'll use the "pdbaa" database, which contains sequences 
for the protein structure from the Protein Data Bank.  For our input file, we'll use an abbreviated 
fasta file with mouse genome information.  These files are located on the 
OSG submit node at =/home/ckoch5/OSGdata=.  

   1. Copy them to your current directory: \
<pre class="screen">
%UCL_PROMPT_SHORT% <strong>cp -r /home/ckoch5/OSGdata/mouse.fa /home/ckoch5/OSGdata/pdbaa ./</strong>
</pre>

---++ Submitting the Job

We now have our program (the pre-compiled =blastx= binary) and our input files, so all that 
remains is to create the submit file.  A typical =blastx= command looks something like this: 

<pre class="screen">
%UCL_PROMPT_SHORT% <strong> blastx -db database -query input_file -out results.txt</strong>
</pre>

   1.  Copy the submit file from the last exercise into your current directory.  
   2. Think about which lines you will need to change or add to your submit file in order to submit \
the job successfully. In particular: 
      * What is the executable?
      * How can you indicate the entire command line sequence above?  
      * Which files need to be transferred in addition to the executable?  
      * Does this job require a certain type of operating system?  
\
   3. Try to answer these questions and modify your submit file appropriately.  
   4. Once you have done all you can, check your submit file against the lines below, which contain the necessary changes \
to run this particular job.  
      * The executable is =blastx=, which is located in the =bin= directory of our downloaded BLAST \
directory.  We need to use the =arguments= line in the submit file to express the rest of the \
command. \
\
<pre class="file">
executable = ncbi-blast-2.4.0+/bin/blastx
arguments = "-db pdbaa -query mouse.fa -out results.txt"
</pre>\

      * The BLAST program requires our input file and database, so they must be transferred with =transfer_input_files=. \
\
<pre class="file">
transfer_input_files = pdbaa/, mouse.fa
</pre>\
*Note* : It is important to include the =/= after =pdbaa=.  Including the =/= means that Condor will transfer the database files inside the =pdbaa/= directory into the job's working directory, which is what we want for this example. The =pdbaa= directory, itself, will not be transferred.
      * Because we downloaded a Linux-specific binary, we need to request machines that are running Linux.  \
\
<pre class="file">
requirements = (OpSys == "LINUX")
</pre>\
   5. Submit the blast job using =condor_submit=.  Once the job starts, it should run in just a few minutes and produce a file called =results.txt=. 




-- Main.LaurenMichael - 18 Jul 2016