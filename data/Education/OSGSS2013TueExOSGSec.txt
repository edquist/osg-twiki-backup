%META:TOPICINFO{author="IgorSfiligoi" date="1371858719" format="1.1" reprev="1.1" version="1.1"}%
%META:TOPICPARENT{name="UserSchool13Materials"}%
---+ 2013 OSG User School - Using OSG Security Tools

Time to spend on this: 10 minutes

The exercises should be carried out on [[OSGSS2013TueGlideinSetup][the glidein submit node]],
although [[UserSchool13Mon01LogIn][osg-ss-submit]] should work just as well. 

Assumption: You should have [[UserSchool13Certificate][obtained your certificate]] by now.

Please copy your .p12 file into the $HOME/.globus directory (and create the directory first, if needed), if you have not done it yet.<br>
Make sure it is not readable by anyone else but you
<pre class="screen">
sfiligoi@osg ~$ ls -l .globus/
-rw------- 1 sfiligoi osgeduadm 5098 May  2  2013 cert.p12
</pre>

---+++ Looking into your certificate

You will likely never need to look at the details of the certificate itself; you will usually always deal with proxies instead.

Nevertheless, it may come handy to know what it is inside the certificate. <b>openssl</b> provides a (relatively) easy way to do this. Try all these:
<pre class="screen">
openssl pkcs12 -in ~/.globus/cert.p12 -nokeys -clcerts |openssl x509 -noout -subject
openssl pkcs12 -in ~/.globus/cert.p12 -nokeys -clcerts |openssl x509 -noout -enddate
openssl pkcs12 -in ~/.globus/cert.p12 -nokeys -clcerts |openssl x509 -noout -text
</pre>

---++ Proxy handling

As mentioned in the security lecture, you will often need a proxy.

To create a basic proxy, use can use <b>grid-proxy-ini</b>
<pre class="screen">
voms-proxy-init -cert ~/.globus/cert.p12 -key ~/.globus/cert.p12 -out ~/.globus/proxy.pem -valid 12:0
</pre>

Unlike the certificate, which is in the p12 format, the proxy will be in the PEM format.
Using <b>openssl</b> to look at it is thus slightly easier
<pre class="screen">
openssl x509 -in ~/.globus/proxy.pem -noout -subject
openssl x509 -in ~/.globus/proxy.pem -noout -enddate
openssl x509 -in ~/.globus/proxy.pem -noout -text
</pre>

However, you can also use <b>voms-proxy-info</b> for this purpose. You will likely find it more useful:
<pre class="screen">
voms-proxy-info -file ~/.globus/proxy.pem -all
</pre>

BTW: You probably want to set
<pre class="screen">
export X509_USER_PROXY=~/.globus/proxy.pem
</pre>

so you don't need to keep pointing the Grid tools to it. Not his will do the trick
<pre class="screen">
voms-proxy-info -all
</pre>

Now, as also mentioned in the security lesson, you will need a VOMS attribute for authentication at sites. <b>voms-proxy-init</b> can do that, if you specify the right option<br>
(here I assume you defined X509_USER_PROXY)
<pre class="screen">
voms-proxy-init -cert ~/.globus/cert.p12 -key ~/.globus/cert.p12 -voms osgedu -valid 12:0 -hours 12
</pre>

Look at the content of the proxy now.

-- Main.IgorSfiligoi
