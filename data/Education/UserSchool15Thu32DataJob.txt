%META:TOPICINFO{author="LincolnBryant" date="1438018119" format="1.1" reprev="1.11" version="1.11"}%
%META:TOPICPARENT{name="UserSchool15Materials"}%
<style type="text/css">
pre em { font-style: normal; background-color: yellow; }
pre strong { font-style: normal; font-weight: bold; color: #008; }
</style>

---+ Transferring data via HTTP
The goal of this exercise is to use the HTCondor HTTP plugin to download data from a remote webserver. This exercise builds off of the NAMD example from [[UserSchool15Thu31DataJob][Exercise 2.1]], but uses a new method to retrieve the job data. We will first download the files from a remote server, and then from OSG Connect's Stash service.

---++ Downloading data from a public cloud

---+++ Background

Amazon Web Services (AWS) is a "public cloud infrastructure", which is a collection of paid computing services. For this tutorial, we have uploaded the NAMD files to the Amazon's Simple Storage Service (S3) for you. Your task will be to write a job to download the input files and run NAMD.

---+++ Files

<center>
<img src="%ATTACHURLPATH%/data_tranfer_aws.jpg" alt="data_tranfer_aws.jpg" width='400' height='300'/>
</center>



First, =cd= to our working directory for this exercise and list the directory contents.
<pre class="screen">
%UCL_PROMPT_SHORT% <strong>cd namd/namd-ct-web </strong>
%UCL_PROMPT_SHORT% <strong>ls </strong>
namd_run.sh    # Job wrapper script to execute namd job
</pre>

As you can see, we only have the NAMD wrapper here. We'll want to create a submit file and transfer the input data from AWS. 

The input files you need for this exercise are located here:
| http://s3-us-west-2.amazonaws.com/osg-user-school/namd/par_all27_prot_lipid.inp |
| http://s3-us-west-2.amazonaws.com/osg-user-school/namd/ubq_gbis_eq.conf |
| http://s3-us-west-2.amazonaws.com/osg-user-school/namd/ubq.pdb |
| http://s3-us-west-2.amazonaws.com/osg-user-school/namd/ubq.psf |

As in the previous exercise, we need to tell HTCondor where to find the input files. HTCondor makes this very simple to do. Simply paste the HTTP links after =transfer_input_files= in the submit file. You can get started using the template below:

<pre class="file">
universe = vanilla
executable = namd_run.sh

transfer_input_files = 

output =
error = 
log = 

requirements = (HAS_CVMFS_oasis_opensciencegrid_org =?= TRUE)

queue
</pre>

Remember that the =requirements= line is needed to tell HTCondor to only match against job slots that have the OASIS software library available. Don't forget to specify the =output=,=error=, and =log=!

Once done, submit the job:
<pre class="screen">
%UCL_PROMPT_SHORT% <strong>condor_submit namd_run.submit </strong>
</pre>

The job should run 5 minutes or so. If the job was successful, you should see a bunch of output files in the directory you submitted from. You can verify that the files were downloaded by looking at the =output= file you created in your job. 

For example, if the =output= was =namd_job.out=, you should see the following lines:

FILL ME OUT ...

---++ Copying data from Stash

Stash is OSG Connect's data service. Copying data from Stash (stash.osgconnect.net) is much the same as copying data from any other HTTP server. For this example, we'd like you to copy data to a worker node from your public directory on OSG Connect.

<center>
<img src="%ATTACHURLPATH%/data_tranfer_stash.jpg" alt="data_tranfer_stash.jpg" width='400' height='300'/>
</center>

The example files are located under the directory ==namd-ct-stash==.

<pre class="screen">
%UCL_PROMPT_SHORT% <strong>cd ~/namd/namd-ct-stash </strong>
%UCL_PROMPT_SHORT% <strong>ls </strong>
namd_run.sh    # Job wrapper script to execute namd job
</pre>

As before, we have our namd_run.sh and our input files. For this exercise, first copy the input data files to =~/public=. (Recall that =~= is an alias for =/home/your_username=), and create a job submit script that transfers the files from =http://stash.osgconnect.net/+your_username/path/to/files=



-- Main.BalamuruganDesinghu - 23 Jul 2015

%META:FILEATTACHMENT{name="data_tranfer_aws.jpg" attachment="data_tranfer_aws.jpg" attr="" comment="Data transfer from AWS server" date="1437761750" path="data_tranfer_aws.jpg" size="38912" stream="data_tranfer_aws.jpg" tmpFilename="/usr/tmp/CGItemp9882" user="BalamuruganDesinghu" version="1"}%
%META:FILEATTACHMENT{name="data_tranfer_stash.jpg" attachment="data_tranfer_stash.jpg" attr="" comment="" date="1437768432" path="data_tranfer_stash.jpg" size="40123" stream="data_tranfer_stash.jpg" tmpFilename="/usr/tmp/CGItemp6502" user="LincolnBryant" version="1"}%
