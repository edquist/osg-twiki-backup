%META:TOPICINFO{author="BrianLin" date="1467832344" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="UserSchool16Materials"}%
<style type="text/css">
pre em { font-style: normal; background-color: yellow; }
pre strong { font-style: normal; font-weight: bold; color: #008; }
</style>

---+ Thursday Exercise 1.2: Getting data onto and out of your laptop



   * The material so far has covered ways to do computation on various resources. This section covers how to get data and results to and from the servers where you are submitting jobs.   
   * Although there are a variety of ways to do this, we'll cover three methods (=scp=, =rsync=, and Globus) that should cover most of the situations that'll you'll encounter. 

---++ Compressing files


Sometimes when you have a lot of input files it makes more sense to compress them before sending them with a job. For this exercise, we want to compress our blast input files and send them to the remote worker node. 

For this part of the exercise, you will need to:

   1. Compress the input files using the =tar= command
   1. Modify =transfer_input_files= in the file =blast_run.submit= to transfer your compressed file
   1. Create a wrapper script which will decompress the input files, then run blast

*HINT*: Here's a pattern for the =tar= command:
<pre class="screen">
%UCL_PROMPT_SHORT% tar -cvzf [compressed filename] [list of files]
</pre>

Replace =-c= with =-x= to decompress.

---++ Transferring files (on steroids)

You've now transferred files and directories using =scp=.  However there are a few drawbacks to using =scp=.  First, you need to specify each directory and/or file that you want to transfer.  This can get tedious if you have a lot of files or directories to transfer.  Second, scp will copy every file even if it's present resulting in more time and bandwidth being used than necessary.  =rsync= is a program that avoids this by checking on the files between the source and destination and then only copying the directories and files that have changed.    We'll use rsync to sync a directory as follows:

   1. Log in to the CHTC submit node (=learn.chtc.wisc.edu=).  
   2. Remove the =scp_transfer= directory. \
   
\
<pre class="screen">
%UCL_PROMPT_SHORT%  <strong>rm -fr scp_transfer</strong>
</pre>
   3. Now, we'll use =rsync= to transfer the directory from the OSG Connect login node. \
\
<pre class="screen">
%UCL_PROMPT_SHORT%  <strong>rsync -r -t -v -e ssh username@login.osgconnect.net:~/scp_transfer/ .</strong>
</pre>
   4. Now try running the rsync again.  You'll notice that it doesn't copy any files this time. \
\
<pre class="screen">
%UCL_PROMPT_SHORT%  <strong>rsync -r -t -v -e ssh username@login.osgconnect.net:~/scp_transfer/ .</strong>
</pre>


---++ Globus (optional)
The final transfer method uses a cloud-based service called Globus (http://www.globus.org).  Globus allows users to schedule "third-party" data transfers between storage endpoints using a web interface.  After launching a transfer request, Globus manages the transfers and verifies the copied files, re-transferring any files that have been copied incorrectly.  Using [[https://www.globus.org/globus-connect-personal][Globus Connect Personal]], you can set your desktop or laptop hard drive as a storage endpoint, allowing you to transfer data to and from your computer.  Quite a few university campuses and OSG resources have storage endpoints, as do most national-scale HPC centers, making Globus a convenient way of getting data between places.

This part of the exercise go through setting up a Globus Connect personal endpoint on your laptop and transferring some files from OSG Connect to your laptop.

   1. First go to the [[Globus download][https://www.globus.org/globus-connect-personal]] page
   2. Click on the appropriate download link and install the application
   3. The download link will have instructions on setting up your endpoint
   4. Once installed and running, go to globus connect application icon (in your system tray or on toolbar at the top of the screen) and select 'Web: Transfer Files'
   5. Globus Connect will open a web page like this: \
<img src="%ATTACHURLPATH%/Screen_Shot_2015-07-23_at_2.11.59_PM.png" alt="Screen_Shot_2015-07-23_at_2.11.59_PM.png" width='1049' height='794' />    
   6. Select a file from the osgconnect#stash side and copy it to your using the arrow button.  \
<img src="%ATTACHURLPATH%/Screen_Shot_2015-07-23_at_2.58.33_PM.png" alt="Screen_Shot_2015-07-23_at_2.58.33_PM.png" width='1049' height='794' />    
   7. Click on the Activity link near the top of the page to track your transfer