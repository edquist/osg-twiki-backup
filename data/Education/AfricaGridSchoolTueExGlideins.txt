%META:TOPICINFO{author="RobQ" date="1343921305" format="1.1" version="1.2"}%
%META:TOPICPARENT{name="AfricaGridSchool12Materials"}%
---+ Tue Morning Exercise - Using the glideinWMS

<!-- ASP 2012 Defaults
   * Local UCL_HOST = %URLPARAM{"INPUT_HOST" encode="quote" default="osg-ss-glidein"}%
   * Local UCL_USER = %URLPARAM{"INPUT_USER" encode="quote" default="user"}%
   * Local UCL_DOMAIN = %URLPARAM{"INPUT_DOMAIN" encode="quote" default="chtc.wisc.edu"}%
   * Local UCL_CWD= %URLPARAM{"INPUT_CWD" encode="quote" default="~/osg_school/glidein1"}%
   * Local UCL_JOB= %URLPARAM{"INPUT_JOB" encode="quote" default="555.0"}%
-->

---++ Introduction
In this session you will try to run some compute jobs with glideinWMS.

---++ Prerequisite 

Learn how to use our [[https://twiki.grid.iu.edu/bin/view/Education/AfricaGridSchoolTueGlideinSetup?INPUT_USER=%UCL_USER%][glideinWMS installation]].

---++ Run a simple job

Create a simple test script and submit it as you have done yesterday.

Feel free to create your own test scripts, just make sure they run for at least a minutes (but not more than 5).<br>
If you feel lazy:
%TWISTY{
mode="div"
showlink="click here to show an example script."
hidelink="Hide test script."
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
<pre style="margin-left:4em" class="screen">
#!/bin/bash

uname -a
id
date
echo '=============='
env
echo '=============='
let a=$RANDOM%60+45
sleep $a
</pre>
%ENDTWISTY%

<br>
Write a vanilla Condor submit file, like you did yesterday, and submit a cluster of 5 jobs.<br>
Again, if you feel lazy:
%TWISTY{
mode="div"
showlink="click here to show an example script."
hidelink="Hide test script."
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
<pre style="margin-left:4em" class="screen">
Universe   = vanilla
Executable = myscript.sh
Log        = mytest.log
Output     = mytest.out.$(Cluster).$(Process)
Error      = mytest.error.$(Cluster).$(Process)
should_transfer_files   = YES
when_to_transfer_output = ON_EXIT
Queue 5
</pre>

<pre class="screen">
condor_submit mytest.condor
</pre>

%ENDTWISTY%
<br>
Now monitor your jobs using the usual Condor commands:
<pre class="screen">
condor_q %UCL_USER%
</pre>

Also check what resources are available:
<pre class="screen">
condor_status
</pre>

For a glidein-friendly view, try out:
<pre class="screen">
/opt/glideinWMS/tools/glidein_status.py
</pre>

%TWISTY{
mode="div"
showlink="Advanced"
hidelink="Hide Advanced."
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
A similar result can be obtained with:
<pre class="screen">
condor_status -format '%-49s ' Name -format '%-10s ' GLIDEIN_Site -format '%-10s ' State -format '%s\n' Activity -constraint 'IS_MONITOR_VM=!=True'
</pre>
%ENDTWISTY%

<br>

---++ Inspect the results

Once the jobs are done, can you tell me where they ran?

%TWISTY{
mode="div"
showlink="Show hint 1."
hidelink="Hide hint 1."
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
Look in your output file(s).<br>
If you used the example script, it contains the environment of the node your job executed.

<pre class="screen">
less mytest.out.%UCL_JOB%
</pre>
%ENDTWISTY%

<br>

%TWISTY{
mode="div"
showlink="Show hint 2."
hidelink="Hide hint 2."
showimgleft="%ICONURLPATH{toggleopen-small}%"
hideimgleft="%ICONURLPATH{toggleclose-small}%"
}%
Look in the classad of your terminated job.<br>
There are attributes which tell you where the job ran.

<pre class="screen">
condor_history -l %UCL_JOB% |grep MATCH_EXP_JOB
</pre>

Extra credit: Format nicely the relevant output using <pre class="screen">
condor_history -format ...
</pre>
%ENDTWISTY%
<br>

---++ Run a BLAST example

Try re-running one of your BLAST jobs, possibly on the yeast database,
as [[https://twiki.grid.iu.edu/bin/view/Education/AfricaGridSchool12CondorBLAST][explained yesterday by Scot]].<br>
*Reminder:* Submit from osg-ss-glidein !

Check and discuss the results.

---++ Customize this Document

%ICON{"warning"}% %RED% Please change your user name and click on the Customize button!%ENDCOLOR%
<form action="%SCRIPTURLPATH{"view"}%/%WEB%/%TOPIC%">
<table>
  <tr>
    <td>
      Login Name
    </td>
    <td>
      <input size=100 type="text" name="INPUT_USER" value="%UCL_USER%"/>
    </td>
  </tr>
  <tr>
    <td>
      Job number
    </td>
    <td>
      <input size=100 type="text" name="INPUT_JOB" value="%UCL_JOB%"/>
    </td>
  </tr>
  <tr>
    <td>
     &nbsp;
     <input type="submit" class="twikiSubmit" value="Customize" />
    </td>
  </tr>
</table>
</form>




-- Main.IgorSfiligoi - 20 Jun 2012



-- Main.RobQ - 27 Jul 2012