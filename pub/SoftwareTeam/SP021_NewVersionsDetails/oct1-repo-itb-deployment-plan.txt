
# back up existing scripts
cd /usr/local
mkdir old-mashscripts
mv /etc/cron.d/repo old-mashscripts/
mv update_mirror.py update_repo.sh old-mashscripts/

# install new scripts
cd /
tar vxf root/osg-next-mash-scripts.tgz  # or whatever we name it

# setup new .mash files / repos
cd /usr/local
mv /etc/cron.d/repo ./new-repo-cron  # we don't want these to run quite yet
./update_mashfiles.sh --remove-old
./update_all_repos.sh

# at this point mash will have created and populate the /usr/local/repo/osg/
# directory structure.  Brian runs his script to verify it has been set up
# correctly

# BrianL has some scripts to set up symlinks, maybe slightly different from
# the following, but should have the same effect

# make 1-time compat symlinks

cd /usr/local/repo
ln -sfbS.orig osg/3.1/osg-3.1-el5-release-latest.rpm osg-el5-release-latest.rpm
ln -sfbS.orig osg/3.1/osg-3.1-el6-release-latest.rpm osg-el6-release-latest.rpm

# can remove osg-el{5,6}-release-latest.rpm.orig whenever everything looks good
# (in any case, they should have the same contents)


# move /usr/local/repo/3.0/ off to some backup location, and repopulate with
# compat symlinks
mkdir /usr/local/repo.bak
mv /usr/local/repo/3.0/ /usr/local/repo.bak
cd /usr/local/repo
mkdir -p 3.0/el{5,6}

ln -s  ../../osg/3.1/el5/contrib           3.0/el5/osg-contrib               
ln -s  ../../osg/3.1/el5/development       3.0/el5/osg-development           
ln -s  ../../osg/3.1/el5/release           3.0/el5/osg-release               
ln -s  ../../osg/3.1/el5/testing           3.0/el5/osg-testing               
ln -s  ../../osg/upcoming/el5/development  3.0/el5/osg-upcoming-development  
ln -s  ../../osg/upcoming/el5/release      3.0/el5/osg-upcoming-release      
ln -s  ../../osg/upcoming/el5/testing      3.0/el5/osg-upcoming-testing      

ln -s  ../../osg/3.1/el6/contrib           3.0/el6/osg-contrib               
ln -s  ../../osg/3.1/el6/development       3.0/el6/osg-development           
ln -s  ../../osg/3.1/el6/release           3.0/el6/osg-release               
ln -s  ../../osg/3.1/el6/testing           3.0/el6/osg-testing               
ln -s  ../../osg/upcoming/el6/development  3.0/el6/osg-upcoming-development  
ln -s  ../../osg/upcoming/el6/release      3.0/el6/osg-upcoming-release      
ln -s  ../../osg/upcoming/el6/testing      3.0/el6/osg-upcoming-testing      


# run update_mirror script -- for now will only point to repo-itb since
# other sites won't be mirroring yet
/usr/local/update_mirror.py

# when we are ready, move the crontab back into place
# if still waiting on mirror sites, possibly comment out that line
mv /usr/local/new-repo-cron /etc/cron.d/repo

# on fermi vms (el5/el6) install osg-release-itb, verify installing packages
# works

