digraph KojiInfOverview {
    rankdir=LR;
    subgraph cluster2 {
        label="GOC (Indiana)";
        node [shape=record];
        repo [label="{ <n> repo*.grid.iu.edu | <s> mash }"];
    }
    subgraph cluster3 {
        rank=same;
        label="UW-Madison";
        node [shape=record];
        edge [fontsize=8];
        subgraph cluster00 {
            label="koji-hub.batlab.org\n(WID)";
            kojihub [label="koji-hub"];
            kojiweb [label="koji-web"];
            kojid [label="kojid"];
            kojira
            rsyncd
            puppetd
            mntkoji [label="/mnt/koji"];
        }
        subgraph cluster01 {
            fontsize=10;
            label="host-2.batlab.org\n(VM host, WID)"
            node [fontsize=10];
            kojibuilder1 [label="{<n>kojibuilder1.batlab.org|<kojid>kojid|<puppetd>puppetd}"];
        }
        db01 [fontsize=10,label="{<n>db-01.batlab.org\n(WID)|<postgres>postgres|<rsyncd>rsyncd|<puppetd>puppetd}"];
        subgraph cluster10 {
            node [shape=record,fontsize=10];
            fontsize=10;
            label="osghost.chtc.wisc.edu\n(VM host, CS 3370A)"
            kojibuilder2 [label="{<n>kojibuilder2.chtc.wisc.edu|<kojid>kojid}|<puppetd>puppetd}"];
            kojibuilder3 [label="{<n>kojibuilder3.chtc.wisc.edu|<kojid>kojid}|<puppetd>puppetd}"];
        }
        host3 [label="{<n>host-3.chtc.wisc.edu|<rsync>rsync|<puppetd>puppetd}"];
        widservice1 [label="{<n>wid-service-1.chtc.wisc.edu|<puppetmaster>puppetmaster}"]

        kojihub -> db01:postgres [label="queries,\nwrites to"];
        kojihub -> mntkoji [label="stores RPMs"];
        kojiweb -> kojihub [label="web interface to"];
        kojira -> kojihub [label="regen repos",fontsize=8];
    }

    subgraph kojids {
        edge [label="submit jobs,\nreturn RPMs",fontsize=8,dir=both];
        kojihub -> kojid
        kojihub -> kojibuilder1:kojid
        kojihub -> kojibuilder2:kojid
        kojihub -> kojibuilder3:kojid
    }
    subgraph rsyncs {
        edge [label="pulls backups from",fontsize=8];
        host3:rsync -> rsyncd
        host3:rsync -> db01:rsyncd
    }
    subgraph puppets {
        edge [label="pulls configs from",fontsize=8];
        puppetd -> widservice1:puppetmaster
        host3:puppetd -> widservice1:puppetmaster
        db01:puppetd -> widservice1:puppetmaster
        kojibuilder1:puppetd -> widservice1:puppetmaster
        kojibuilder2:puppetd -> widservice1:puppetmaster
        kojibuilder3:puppetd -> widservice1:puppetmaster
    }
    repo -> mntkoji [label="pulls RPMs",fontsize=8];
}
