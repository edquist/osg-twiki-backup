<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta name="GENERATOR" content="Microsoft FrontPage 6.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link rel="stylesheet" type="text/css" href="lab.css" />
<title>Lab</title>
</head>

<body>

<p><font size="5">Lab Exercise: Security</font></p>
<h3>Purpose:</h3>
<h3><font size="3"><span style="font-weight: 400">This lab will show you how to:</span></font></h3>
<ol>
  <li><a href="#Display_Certificate_Information">Display Certificate Information</a></li>
  <li><a href="#Proxy_Certificates">Proxy Certificates</a></li>
  <li><a href="#SSHing_without_a_password!">SSHing without a password!</a></li>
	<li><a href="#Updating_your_.bash_profile_on_the_server">Updating your<kbd> .bash_profile </kbd>on the server</a></li>
</ol>

<p>&nbsp;</p>

<p><h3><a name="Display_Certificate_Information">Display Certificate Information</a></h3></p>

<ol>
	<li>Finding out information about your real 
certificate is easy.&nbsp; Use the command: 
<font face="Courier New" size="2">grid-cert-info</font>.&nbsp; 
This utility has several options.&nbsp; The two we will use are
<font face="Courier New" size="2">-subject</font>
and
<font face="Courier New" size="2">-enddate</font>.&nbsp;
	</li>
</ol>
<blockquote>
	<blockquote>
		<p><kbd>-subject</kbd>:&nbsp; shows your distinguished name (DN)<br>
		<kbd>-enddate</kbd>:&nbsp; shows when your certificate expires</p>
	</blockquote>
</blockquote>
<ol>
	<li value="2">Issue these commands:</li>
</ol>
<blockquote>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="90%" id="AutoNumber3" bgcolor="#E8FFFF">
		<tr>
			<td><font face="Courier New" size="2">$ <b>grid-cert-info -subject</b><br>/C=US/O=National Center for Supercomputing Applications/CN=Mike Freemon</font><p>
			<font face="Courier New" size="2">$ <b>grid-cert-info -enddate</b><br>Nov 5 07:20:17 2006 GMT</font></p>
			</td>
		</tr>
	</table>
	<p>The<kbd> grid-cert-info </kbd>command without any arguments will display all 
available information.&nbsp; Try it!</p>
</blockquote>

<p>&nbsp;</p>
<p><h3><a name="Proxy_Certificates">Proxy Certificates</a></h3></p>
<ol>
	<li value="3">There are two commands that are used when 
working with proxy certificates: <font face="Courier New" size="2">grid-proxy-init</font> and 
	<font face="Courier New" size="2">grid-proxy-info.</font></li>
</ol>
<blockquote>
	<p>By entering the following command you will see a 
list of options that can be used with <font face="Courier New" size="2">grid-proxy-init</font>.</p>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="90%" id="AutoNumber6" bgcolor="#E8FFFF">
		<tr>
			<td>
			<p><font face="Courier New" size="2">$ <b>grid-proxy-init -help</b></font></p>
			</td>
		</tr>
	</table>
</blockquote>
<ol>
  <li value="4">In order to generate a new proxy enter the 
following grid-proxy-init command.&nbsp; You will be asked to enter your certificate's 
pass phrase.&nbsp; Do so and you should see output similar to:&nbsp; </li>
</ol>
<blockquote>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="90%" id="AutoNumber8" bgcolor="#E8FFFF">
		<tr>
			<td><kbd>$ <b>grid-proxy-init</b><br><br>Your identity: /C=US/O=National Center for Supercomputing Applications/CN=Mike 
	Freemon<br>Enter GRID pass phrase for this identity:<br>Creating proxy ............................................. Done<br>Your proxy is valid until: Wed Feb 23 00:47:13 2005</kbd></td>
		</tr>
	</table>
	<p>Your proxy certificate is now ready to use.</p>
</blockquote>
<ol>
  <li value="5">If you're having problems and need to 
	see additional information, or if you would like the grid-proxy-init command 
	to verify the certificate against the CA certificate to make sure it's 
	valid, the &quot;<kbd>-debug</kbd>&quot; and &quot;<kbd>-verify</kbd>&quot; arguments can be used as follows:</li>
</ol>
<blockquote>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="90%" id="table2" bgcolor="#E8FFFF">
		<tr>
			<td><font face="Courier New" size="2">$ <b>grid-proxy-init -debug -verify</b><br>
			<br>User Cert File: /home/mfreemon/.globus/usercert.pem<br>User Key File: /home/mfreemon/.globus/userkey.pem<br>
			<br>Trusted CA Cert Dir: /home/mfreemon/ldg-3.0//globus/TRUSTED_CA<br>
			<br>Output File: /tmp/x509up_u500<br>Your identity: /C=US/O=National Center for Supercomputing Applications/CN=Mike 
	Freemon<br>Enter GRID pass phrase for this identity:<br>Creating proxy ......................++++++++++++<br>....++++++++++++<br>Done<br>Proxy Verify OK<br>Your proxy is valid until: Wed Feb 23 00:53:13 2005</font></td>
		</tr>
	</table>
	<p>This output tells you where your certificate was retrieved from and what 
directory was used to for the CA certificate.&nbsp; Your certificate was 
verified against this CA certificate and then the proxy was created. </p>
</blockquote>
<ol>
  <li value="6">The <kbd>grid-proxy-info</kbd>
	command is used to display information about an existing proxy certificate.&nbsp; Enter the following:</li>
</ol>
<blockquote>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" id="table3" bgcolor="#E8FFFF" width="90%">
		<tr>
			<td><font face="Courier New" size="2">$ <b>grid-proxy-info -help</b></font></td>
		</tr>
	</table>
	<p>You should see a listing of the various 
	options for this command.&nbsp; </p>
</blockquote>
<ol>
  <li value="7">Now enter:</li>
</ol>
<blockquote>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="90%" id="table4" bgcolor="#E8FFFF">
		<tr>
			<td><font face="Courier New" size="2">$ <b>grid-proxy-info -timeleft</b></font></td>
		</tr>
	</table>
	<p>This command will tell you how much time is left 
on your current proxy certificate.&nbsp; If you see a negative number, this 
means there is no time left on your certificate.&nbsp; If there is time left you 
will be shown the number of seconds left on the proxy.&nbsp; Now, while knowing 
the number of seconds left is useful, it is not always the best way to have 
information displayed.&nbsp; </p>
</blockquote>
<ol>
  <li value="8">Now enter the same command without 
	any arguments:</li>
</ol>
<blockquote>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="90%" id="AutoNumber10" bgcolor="#E8FFFF">
		<tr>
			<td><font face="Courier New" size="2">$ <b>grid-proxy-info</b><br>
			<br>subject : /C=US/O=National Center for Supercomputing Applications/CN=Mike 
	Freemon/CN=proxy<br>issuer : /C=US/O=National Center for Supercomputing Applications/CN=Mike 
	Freemon<br>identity : /C=US/O=National Center for Supercomputing Applications/CN=Mike 
	Freemon<br>type : full legacy globus proxy<br>strength : 512 bits<br>path : /tmp/x509up_u500<br>timeleft : 11:59:59<br>&nbsp;</font></td>
		</tr>
	</table>
	<p>This command gives you all of your user 
certificate information. </p>
	<p>Note the  
<font face="Courier New" size="2">timeleft</font> 
on the proxy.&nbsp; If there is no time left you will need to obtain a new proxy certificate using 
	<font face="Courier New" size="2">grid-proxy-init</font><b>.</b></p>
	<p>The other information displayed is defined as follows:</p>
	<ul>
		<li>subject&nbsp;&nbsp;&nbsp; Distinguished name (DN) of subject</li>
		<li>issuer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DN of issuer (certificate signer)</li>
		<li>identity&nbsp;&nbsp;&nbsp; DN of the identity represented by the proxy</li>
		<li>type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Type of proxy (full or 
  limited)</li>
		<li>strength&nbsp;&nbsp; Key size (in bits)</li>
		<li>path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Pathname of proxy file</li>
		<li>timeleft&nbsp;&nbsp;&nbsp; Time until proxy expires</li>
	</ul>
</blockquote>
<ol>
  <li value="9">By default, <font face="Courier New" size="2">
grid-proxy-init</font> sets the expiration time to 
12 hours.&nbsp; You can change this by using  the command line option 
<font face="Courier New" size="2">-hours</font>.&nbsp; </li>
</ol>
<blockquote>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="90%" id="AutoNumber11" bgcolor="#E8FFFF">
		<tr>
			<td><font face="Courier New" size="2">$ <b>grid-proxy-init -hours 8</b><br>
			<br>Your identity: /C=US/O=National Center for Supercomputing Applications/CN=Mike 
	Freemon<br>Enter GRID pass phrase for this identity:<br>Creating proxy ................................ Done<br>Your proxy is valid until: Tue Feb 22 21:19:19 2005<br>
			<br>$ <b>grid-proxy-info</b><br><br>subject : /C=US/O=National Center for Supercomputing Applications/CN=Mike 
	Freemon/CN=proxy<br>issuer : /C=US/O=National Center for Supercomputing Applications/CN=Mike 
	Freemon<br>identity : /C=US/O=National Center for Supercomputing Applications/CN=Mike 
	Freemon<br>type : full legacy globus proxy<br>strength : 512 bits<br>path : /tmp/x509up_u500<br>timeleft : 7:59:51</font></td>
		</tr>
	</table>
	<p>Note the new&nbsp;  <kbd>timeleft</kbd>.</p>
</blockquote>
<ol>
  <li value="10">Another useful command is 
<font face="Courier New" size="2">grid-proxy-destroy</font>.&nbsp; 
	As the name indicates, this command removes the current proxy certificate 
	you are working with.&nbsp; </li>
</ol>
<blockquote>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="90%" id="AutoNumber14" height="108" bgcolor="#E8FFFF">
		<tr>
			<td height="108"><font face="Courier New" size="2">$ <b>grid-proxy-destroy</b></font><p>
			<font face="Courier New" size="2">$ <b>grid-proxy-info</b><br><br>ERROR: Couldn't find a valid proxy.<br>Use -debug for further information.</font></p>
			</td>
		</tr>
	</table>
	<p>As you can see, the proxy certificate has been removed from the system.&nbsp; 
	</p>
</blockquote>
<ol>
  <li value="11">Of course, you will need to create 
	a new proxy before continuing with this lab exercise.</li>
</ol>
<blockquote>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="90%" id="AutoNumber15" bgcolor="#E8FFFF">
		<tr>
			<td><font face="Courier New" size="2">$ <b>grid-proxy-init</b><br><br>
			Your identity: /C=US/O=National Center for Supercomputing 
			Applications/CN=Mike Freemon<br>
			Enter GRID pass phrase for this identity:<br>
			Creating proxy ............................... Done<br>
			Your proxy is valid until: Wed Feb 23 01:25:46 2005</font></td>
		</tr>
	</table>
</blockquote>
<h3>&nbsp;</h3>
<h3><a name="SSHing_without_a_password!">SSHing without a password!</a></h3>
<ol>
	<li value="12">With a valid proxy certificate, you will be 
able to <font face="Courier New" size="2">
	ssh</font> 
	to any LSC DataGrid server without having to enter a 
password!</li>
</ol>
<blockquote>
	<p>First, verify that the right  
	<font face="Courier New" size="2">ssh</font> is in your 
path.</p>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="90%" id="AutoNumber17" bgcolor="#E8FFFF">
		<tr>
			<td><font face="Courier New" size="2">$ <b>which ssh</b><br><br>~/ldg-3.0/globus/bin/ssh</font></td>
		</tr>
	</table>
	<p>The <kbd>ssh</kbd> that is found should be in the globus directory under your client 
toolkit software installation directory.&nbsp; If this is not the case, verify that you have run the 
setup program found in the LSC DataGrid client installation directory (<kbd>i.e. 
	~/ldg-3.0/setup.sh</kbd>).&nbsp; This script 
	updates the environment variables (including PATH) that are needed by the LSC software.</p>
</blockquote>
<ol>
  <li value="13">With the correct <font face="Courier New" size="2">ssh</font> and a valid proxy you should 
  be able to ssh to a valid server.</li>
</ol>
<blockquote>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="90%" id="AutoNumber18" bgcolor="#E8FFFF">
		<tr>
			<td><font face="Courier New" size="2">$ <b>ssh ldas-grid.ligo-la.caltech.edu</b><br>
			<br>Posted January 12, 2004:<br><br>* The operating system on the cluster has been upgraded to Fedora Core 3.<br>
			<br>* Condor has been upgraded to version 6.7.3.<br><br>* We have installed the LSC DataGrid Server package on the head node<br>ldas-grid.ligo.caltech.edu. This package is built on top of the Virtual<br>Data Toolkit (VDT) server package. It is installed in /ldcg/ldg.<br>
			<br>The data grid server contains a number of useful Grid tools like the<br>Grid-OpenSSH client, the Grid-enabled FTP client, and LSCdataFind.<br>
			<br>To setup your environment to use these tools: if you are a bash used add the<br>following to your .bash_profile:<br>
			<br>if [ -f &quot;${LSC_DATAGRID_SERVER_LOCATION}/setup.sh&quot; ]; then<br>source ${LSC_DATAGRID_SERVER_LOCATION}/setup.sh<br>fi<br>
			<br>or if you are a C shell user, add the following to your .login<br>
			<br>if ( -r &quot;${LSC_DATAGRID_SERVER_LOCATION}/setup.sh&quot; ) then<br>source ${LSC_DATAGRID_SERVER_LOCATION}/setup.csh<br>endif<br>
			<br>You should remove any older environment variables that you may have set up<br>to access the LSC data grid server.<br>
			<br>* Please report any problems to ldas_admin_llo@ligo.caltech.edu<br>_______________________________________<br>
			<br>[mfreemon@ldas-grid ~]$ <br>&nbsp;</font></td>
		</tr>
	</table>
	<p>You are now logged onto the <font face="Courier New" size="2">ligo-server</font> site and didn't have to enter your 
password.</p>
</blockquote>
<ol>
  <li value="14">What would happen if you didn't have a valid proxy?</li>
</ol>
<blockquote>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="90%" id="AutoNumber20" bgcolor="#E8FFFF">
		<tr>
			<td><font face="Courier New" size="2">$ <b>grid-proxy-destroy</b></font><p>
			<font face="Courier New" size="2">$ <b>ssh ldas-grid.ligo-la.caltech.edu</b><br>
			<br>mfreemon@ldas-grid.ligo-la.caltech.edu's password: <br>&nbsp;</font></p>
			</td>
		</tr>
	</table>
	<p>You should now see a request for entering you password. </p>
	<p>Without a valid proxy certificate, the <kbd>ssh</kbd> client reverts back 
	to it's normal authentication mechanisms.&nbsp; Enter your password and you 
	should be logged onto the server site (if you have one).</p>
	<p>In fact, this <kbd>ssh</kbd> client is just a normal, standard <kbd>ssh</kbd> 
	client with an additional authentication method built-in for grid 
	environments.&nbsp; As a result, it can be used for any SSH connections to 
	any SSH daemons -- not just grid servers. </p>
	<p>&nbsp;</p>
</blockquote>
<h3><a name="Updating_your_.bash_profile_on_the_server">Updating your <kbd>.bash_profile</kbd> on the server</a></h3>
<ol>
	<li value="15">Did you notice the messages displayed when you connected to the LLO cluster?&nbsp; 
There 
is one in particular that talks about adding a<kbd> setup.sh </kbd>script to your 
	<kbd>.bash_profile </kbd>(on the server).&nbsp; This is a useful and 
	recommended thing to do, so edit your <kbd>~/.bash_profile</kbd> script on 
	the ldas-grid server and append the following lines:</li>
</ol>
<blockquote>
	<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" id="table5">
		<tr>
			<td><font face="Courier New" size="2"><br>if [ -f &quot;${LSC_DATAGRID_SERVER_LOCATION}/setup.sh&quot; ]; then&nbsp;&nbsp;<br>&nbsp; source ${LSC_DATAGRID_SERVER_LOCATION}/setup.sh<br>fi<br>&nbsp;</font></td>
		</tr>
	</table>
</blockquote>
<p>&nbsp;</p>

</body>

</html>