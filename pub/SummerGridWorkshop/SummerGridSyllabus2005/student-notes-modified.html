<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Build a Service Using GT4: Student Exercises</title>
  <link rel="stylesheet" type="text/css" href="notes.css">
</head>
<body>
<h1>Student Exercises: Build a Service Using GT4</h1>
<p>This is the Unix version of the student notes. If you are using
Windows, you should use the Windows version of the notes.</p>
<!--
<p>This is the Windows version of the student notes. If you are using
   unix, you should use the Unix version of the notes.</p>
-->
<h3>Document Style Conventions</h3>
<ul>
  <li>For the first several exercises two command windows will be
needed:</li>
  <blockquote>
    <p class="command">One window will be used to run Globus Toolkit
software and will be referred to as the <i>GT window</i> in these
notes. Commands typed in the GT window will be bounded by a box of this
color.
    </p>
    <p class="ex1-command">
The second window will be used to modify and execute student code and
will be referred to as the <i>Exercise window</i>. Exercise commands
will be bounded by a box of this color.
    </p>
    <p class="ex2-command">
Later in the tutorial a third command window will be required.
    </p>
  </blockquote>
  <p>If you can, you might want to just color the backgrounds of
your Terminal/Command/Xterm windows to match the colors that will be
used in the
tutorial.
  </p>
  <li><font color="red">Text in red can be cut and pasted into a
command window</font></li>
  <li>Text in black indicates intelligent replacement is required</li>
</ul>
<h2>Tutorial TOC</h2>
<ul>
  <li><a href="#chapter1">Chapter 1: Deploy a Service</a></li>
  <li><a href="#chapter2">Chapter 2: Create Resources</a></li>
  <li><a href="#chapter3">Chapter 3: Destroy Resources</a></li>
  <li><a href="#chapter4">Chapter 4: Add a Resource Property</a></li>
  <li><a href="#chapter5">Chapter 5: Discover a Resource</a></li>
  <li><a href="#chapter6">Chapter 6: Register with a Community Index</a></li>
  <li><a href="#chapter7">Chapter 7: Lease-based Lifetime</a></li>
  <li><a href="#chapter8">Chapter 8: Resource as Notification Producer</a></li>
  <li><a href="#chapter9">Chapter 9: Service-Level Security</a></li>
  <li><a href="#chapter10">Chapter 10 (Optional): Resource-Level
Security</a></li>
</ul>
<a name="chapter1">
<h2>Chapter 1: Deploy a Service</h2>
</a>
<p>File modified:</p>
<ul>
  <li>None.</li>
</ul>
<h3>1.1 Untar the gt install tarball in the GT window:</h3>
<p class="command">
$ <font color="red">mkdir /tmp/tutorial</font><br>
$ <font color="red">cd /tmp/tutorial</font><br>
$ <font color="red">tar xzf gt-install.tar.gz</font><br>
</p>
<!--
<p class="command">
$ <font color="red">mkdir C:\tutorial</font><br>
$ <font color="red">cd C:\tutorial</font><br>
</p>
<p> Unzip gt-install.zip into C:\tutorial</p>
-->
<h3>1.2 Set environment variables in the GT window:</h3>
<p class="command">
$ <font color="red">cd gt-install</font><br>
$ <font color="red">export GLOBUS_LOCATION=$PWD</font><br>
$ <font color="red">echo $GLOBUS_LOCATION</font><br>
/tmp/tutorial/gt-install<br>
</p>
<!--
<p class="command">
$ <font color="red">cd gt-install</font><br>
$ <font color="red">set GLOBUS_LOCATION=C:\tutorial\gt-install</font><br>
$ <font color="red">echo %GLOBUS_LOCATION%</font><br>
C:\tutorial\gt-install
</p>
-->
<h3>1.3 Untar the tutorial tarball in the Exercise window:</h3>
<p>This installer contains demonstration code that has been written for
today's tutorial.</p>
<p class="ex1-command">
$ <font color="red">cd /tmp/tutorial</font><br>
$ <font color="red">tar xzf exercise-install.tar.gz</font><br>
$ <font color="red">cd exercise-install/stickynote/source</font><br>
</p>
<!--
<p class="ex1-command">
$ <font color="red">cd C:\tutorial</font><br>
</p>

<p> Unzip exercise-install.zip into C:\tutorial</p>

<!--
<p class="ex1-command">
$ <font color="red">cd C:\tutorial\exercise-install\stickynote\source</font><br>
</p>
-->
<h3>1.4 Set environment variables in the Exercise window:</h3>
<p class="ex1-command">
$ <font color="red">export GLOBUS_LOCATION=</font><i>[use the value
that was echoed earlier in the GT window, not $PWD]</i><br>
</p>
<!--
$ <font color="red">set GLOBUS_LOCATION=</font><i>[use the value that was echoed earlier in the GT window]</i><br>
</p>
-->
<h3>1.5 Build and deploy the tutorial code in the Exercise window:</h3>
<p class="ex1-command">
$ <font color="red">ant deploy</font><br>
Buildfile: build.xml<br>
<br>
init:<br>
<br>
bindings:<br>
<br>
[... many more build messages...]<br>
<br>
BUILD SUCCESSFUL<br>
Total time: 27 seconds<br>
</p>
<h3>1.6 Verify that the show-note client built successfully by checking
that it exists:</h3>
<p class="ex1-command">
$ <font color="red">ls $GLOBUS_LOCATION/bin/show-note</font><br>
/tmp/tutorial/gt-install/bin/show-note<br>
</p>
<!--
<p class="ex1-command">
$ <font color="red">dir %GLOBUS_LOCATION%\bin\show-note.bat</font><br>
C:\tutorial\gt-install\bin\show-note.bat<br>
</p>
-->
<p>If you get an error, see the Chapter 1 <a href="#ch1trouble">
troubleshooting</a> section.</p>
<h3>1.7 Start a web service container without security in the GT window:</h3>
<p class="command">
$ <font color="red">bin/globus-start-container -nosec</font><br>
<!--
<p class="command">
$ <font color="red">bin\globus-start-container -nosec</font><br>
-->
Starting SOAP server at: http://192.168.123.100:8080/wsrf/services/ <br>
With the following services:<br>
<br>
[1]: http://192.168.123.100:8080/wsrf/services/InMemoryServiceGroupEntry<br>
[2]: http://192.168.123.100:8080/wsrf/services/TriggerFactoryService<br>
[3]: http://192.168.123.100:8080/wsrf/services/IndexFactoryService<br>
[4]: http://192.168.123.100:8080/wsrf/services/Version<br>
[5]: http://192.168.123.100:8080/wsrf/services/IndexService<br>
[6]:
http://192.168.123.100:8080/wsrf/services/NotificationConsumerService<br>
[7]:
http://192.168.123.100:8080/wsrf/services/DefaultTriggerServiceEntry<br>
[8]: http://192.168.123.100:8080/wsrf/services/TriggerServiceEntry<br>
[9]: http://192.168.123.100:8080/wsrf/services/IndexServiceEntry<br>
[10]: http://192.168.123.100:8080/wsrf/services/StickyNoteService<br>
[11]: http://192.168.123.100:8080/wsrf/services/AdminService<br>
[12]: http://192.168.123.100:8080/wsrf/services/DefaultIndexService<br>
[13]: http://192.168.123.100:8080/wsrf/services/DefaultIndexServiceEntry<br>
[14]: http://192.168.123.100:8080/wsrf/services/DefaultTriggerService<br>
[15]: http://192.168.123.100:8080/wsrf/services/ShutdownService<br>
[16]: http://192.168.123.100:8080/wsrf/services/ContainerRegistryService<br>
[17]: http://192.168.123.100:8080/wsrf/services/TriggerService<br>
[18]:
http://192.168.123.100:8080/wsrf/services/gsi/AuthenticationService<br>
[19]:
http://192.168.123.100:8080/wsrf/services/InMemoryServiceGroupFactory<br>
[20]: http://192.168.123.100:8080/wsrf/services/InMemoryServiceGroup<br>
[21]:
http://192.168.123.100:8080/wsrf/services/ContainerRegistryEntryService<br>
[22]:
http://192.168.123.100:8080/wsrf/services/SubscriptionManagerService<br>
</p>
<p>Control will not return to the prompt. This container will stay
running
until you exit it with Control-C.</p>
<!--
<p class="ex1-command">
$ <font color="red">%GLOBUS_LOCATION%\bin\write-note -s http://localhost:8080/wsrf/services/StickyNoteService cheese</font><br>
Message written.<br>
<br>
$ <font color="red">%GLOBUS_LOCATION%\bin\show-note -s http://localhost:8080/wsrf/services/StickyNoteService</font><br>
 &lt;ns1:noteContent xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;cheese&lt;/ns1:noteContent&gt;<br>
</p>
-->
<h3><a name="ch1trouble">Troubleshooting for exercise 1:</a></h3>
<ul>
  <h4>ant deploy failures</h4>
  <li>If you get an error during ant deploy like:
    <p class="ex1-command">BUILD FAILED<br>
file:/home/bacon/tmp/playground/java/stickynote/source/build.xml:62:
/home/bacon/tmp/install/share/schema not found.<br>
    </p>
    <p>Check to make sure that <code>GLOBUS_LOCATION</code> is set
correctly,
and that <code>$GLOBUS_LOCATION/share/schema</code> exists.
    </p>
  </li>
  <li>If you get an error during ant deploy like:
    <p class="ex1-command">Error: JAVA_HOME is not defined correctly.<br>
We cannot execute java<br>
    </p>
    <p>Make sure you have Java installed, that the javac command is on
your PATH, and that JAVA_HOME is set to the directory where Java is
installed.</p>
  </li>
  <li>If you get an error during ant deploy like:
    <p class="ex1-command">Warning: JAVA_HOME environment variable is
not set (or not exported).<br>
If build fails because sun.* classes could not be found<br>
you will need to set the JAVA_HOME environment variable<br>
to the installation directory of java.<br>
    </p>
    <p>Make sure you have JAVA_HOME set to the directory where JAVA is
installed on your machine.</p>
  </li>
  <h4>globus-start-container failures</h4>
  <li>If you get an error during globus-start-container like the
following:
    <p class="command">Error: GLOBUS_LOCATION invalid or not set: <br>
    </p>
    <p>Your GLOBUS_LOCATION is either not set, or set to an incorrect
directory.
Run <code>echo $GLOBUS_LOCATION</code> to see what the value is set
to.
If necessary, correct it to the same location you had set when you ran
    <code>ant deploy</code>. Remember, you have to have this value set
in both windows you're using.
    </p>
  </li>
  <li>If you get an error during globus-start-container like the
following:
    <p class="command">Failed to start container: Container failed to
initialize [Caused by: Secure container requires valid credentials]<br>
    </p>
    <p>Remember to include the "-nosec" option when starting the
container.</p>
  </li>
  <li>If you get an error during globus-start-container like the
following:
    <p class="command">Failed to start container: Container failed to
initialize [Caused by: Address in use]
    </p>
    <p>You already have a server running on the same port as the
container is trying to use. Make sure to either stop that server or
start the container on some other port using the <i>-p</i> option.
    </p>
  </li>
  <li>If you get an error during globus-start-container like the
following:
    <p class="command">Failed to obtain a list of services from
'http://140.221.57.104:8080/wsrf/services/ContainerRegistryService'
service: ; nested exception is: <br>
java.net.ConnectException: Connection timed out<br>
    </p>
    <p>Then your machine probably has a name assigned to it that does
not correspond
to the IP address you have during this tutorial. Find out your current
IP address, and add a line to <code>$GLOBUS_LOCATION/etc/globus_wsrf_core/server-config.wsdd</code>
under
the <code>&lt;globalConfiguration&gt;</code> section:
    </p>
    <p class="command">&lt;parameter name="logicalHost"
value="xxx.xxx.xxx.xxx"/&gt;
    </p>
    <p>Here's an example of the file with that parameter set:</p>
    <p class="command">
&lt;globalConfiguration&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter name="sendXsiTypes"
value="true"/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter name="logicalHost"
value="192.168.123.104"/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- @CONTAINER_SECURITY_DESCRIPTOR@ --&gt;<br>
    </p>
  </li>
</ul>
<img src="stop.jpg">
<a name="chapter2">
<h2>Chapter 2: Create Resources </h2>
</a>
<h3>2.1 Modify files:</h3>
<p>Take care not to edit the files in the build/ subdirectory, as files
in the build/ tree are overwritten by the "ant deploy" command. You
should run
<font color="red"><code>ant clean</code></font> first to make sure the
temporary build files are cleaned up. Also, make sure you are editing
the files in the TUTORIAL location, not in the GLOBUS_LOCATION.</p>
<p>If you are not familiar with commenting out XML or WSDL, the comment
characters are &lt;!-- and --&gt;. For instance:</p>
<p class="ex1-command">
This is not commented out<br>
&lt;!-- This line is commented out --&gt;<br>
&lt;!-- <br>
These lines<br>
are both commented out <br>
--&gt;<br>
</p>
<br>
<br>
<span style="font-weight: bold;">During the course of tutorial you need
to modify files in order to successfully complete the exercise. All
modifications you need to make to source files today begin with a
comment tag of "EXERCISE n: &lt;type of modification needed&gt;" and
end with "END OF EXERCISE n &lt;type of modification&gt;". Some files
contain more than one set of changes to be made for a given file. </span>
<h3>2.2 Create a new note from the exercise window using the new <i>create-note</i>
client:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/create-note -s
http://localhost:8080/wsrf/services/StickyNoteService</font><br>
new note created...<br>
EPR written to file: note-1947556620.epr<br>
$ <font color="red">$GLOBUS_LOCATION/bin/show-note -e </font>
note-1947556620.epr<br>
<!--
<p class="ex1-command">
$ <font color="red">%GLOBUS_LOCATION%\bin\create-note -s http://localhost:8080/wsrf/services/StickyNoteService</font><br>
new note created...<br>
EPR written to file:  note-1947556620.epr<br>
$ <font color="red">%GLOBUS_LOCATION%\bin\show-note -e </font> note-1947556620.epr<br>
-->
&lt;ns1:noteContent
xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;hello.&lt;/ns1:noteContent&gt;<br>
</p>
<p>Note that your filename will be different than the one shown. Also
notice that the message displayed by the container has changed from
a SingleNoteHome to the ManyNoteHome:</p>
<p class="command">
2005-01-24 13:31:02,139 INFO stickynote.ManyNoteHome
[Thread-2,create:52] Creating a new StickyNote.<br>
</p>
<h3>2.3 Create multiple notes:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/create-note -s
http://localhost:8080/wsrf/services/StickyNoteService</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\create-note -s http://localhost:8080/wsrf/services/StickyNoteService</font><br>
-->
new note created...<br>
EPR written to file: note-18887662.epr<br>
</p>
<p>Write different messages on each note, verifying that
they keep independent messages:</p>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/write-note -e</font>
note-18887662.epr <font color="red">haggis</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\write-note -e</font> note-18887662.epr <font color="red">haggis</font><br>
-->
Message written.<br>
$ <font color="red">$GLOBUS_LOCATION/bin/write-note -e</font>
note-1947556620.epr <font color="red">lutefisk</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\write-note -e</font> note-1947556620.epr <font color="red">lutefisk</font><br>
-->
Message written.<br>
$ <font color="red">$GLOBUS_LOCATION/bin/show-note -e </font>
note-1947556620.epr<br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\show-note -e </font> note-1947556620.epr<br>
-->
&lt;ns1:noteContent
xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;lutefisk&lt;/ns1:noteContent&gt;<br>
$ <font color="red">$GLOBUS_LOCATION/bin/show-note -e </font>
note-18887662.epr <br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\show-note -e </font> note-18887662.epr <br>
-->
&lt;ns1:noteContent
xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;haggis&lt;/ns1:noteContent&gt;<br>
</p>
<!-- 
<h3><font color="green">Further work (optional): </font></h3>
<p>[idea needed --lcc]</p>
-->
<h3><a name="ch2trouble">Troubleshooting for exercise 2:</a></h3>
<ul>
  <h4>create-note troubles</h4>
  <li>If you have an error during create-note like:
    <p class="ex1-command">Error: java.lang.Exception: [CORE] Operation
'Create' defined in wsdl but it's not implemented in the
'StickyNoteService' service.<br>
    </p>
    <p>Make sure you have stopped and restarted your container after
modifying
the code. In other words, stop the container by pressing Control-C, and
restart it. Your service changes should then take effect.</p>
  </li>
  <h4>show-note troubles</h4>
  <li>If you have an error during show-note like:
    <p class="ex1-command">Error: note-1947556620.epr (No such file or
directory)<br>
    </p>
    <p>Make sure you used the filename returned by your create-note
command. You cannot copy and paste the filenames in these instructions,
as the filenames are randomly generated.</p>
  </li>
  <li>If you have an error during show-note like:
    <p class="ex1-command">Error: No scheme found in URI.<br>
    </p>
    <p>Make sure you used the "-e" option with show-note and the EPR
filename,
not the "-s" option from the last exercise.</p>
  </li>
  <li>If you have an error during show-note like:
    <p class="ex1-command">Error:
org.oasis.wsrf.properties.ResourceUnknownFaultType
    </p>
    <p>Your resources exist only as long as the container is still
running.
If you stop and restart your container, your old EPR files are no
longer
valid. Make sure you show-note on notes that were created while your
current container was running.</p>
  </li>
</ul>
<img src="stop.jpg">
<a name="chapter3">
<h2>Chapter 3: Destroy Resources</h2>
</a>
<h3>3.1 Modify files:</h3>
<p class="ex1-command">
<b>schema/tutorial/stickynote_port_type.wsdl:</b><br>
Add a Destroy operation<br>
<br>
<b>deploy-server.wsdd:</b><br>
Add the DestroyProvider operation provider<br>
</p>
<h3>3.2 Clean, rebuild and redeploy the StickyNote code:</h3>
<p>Execute these commands from the /tmp/tutorial/stickynote/source/
directory of the Exercise window.</p>
<!--
<p>Execute these commands from the C:\tutorial\stickynote\source\ directory of the Exercise window.</p>
-->
<p class="ex1-command">$ <font color="red">ant clean</font><br>
$ <font color="red">ant deploy</font><br>
</p>
<h3>3.3 Kill and restart the web service container in the GT window:</h3>
<p class="command">
$ <i>[ctrl-c]</i><br>
$ <font color="red">bin/globus-start-container -nosec</font><br>
<!--
$ <font color="red">bin\globus-start-container -nosec</font><br>
-->
</p>
<h3>3.4 From the Exercise window, create a new note:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/create-note -s
http://localhost:8080/wsrf/services/StickyNoteService</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\create-note -s http://localhost:8080/wsrf/services/StickyNoteService</font><br>
-->
new note created...<br>
EPR written to file: note-1107777.epr<br>
</p>
<h3>3.5 Inspect the EPR to see what it looks like:</h3>
<p class="ex1-command">
$ <font color="red">cat</font> note-1107777.epr<br>
<!--
$ <font color="red">more</font> note-1107777.epr<br>
-->
&lt;StickyNoteEndpoint xsi:type="ns1:EndpointReferenceType"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:ns1="http://schemas.xmlsoap.org/ws/2004/03/addressing"&gt;<br>
&lt;ns1:Address
xsi:type="ns1:AttributedURI"&gt;http://192.168.123.106:8080/wsrf/services/StickyNoteService&lt;/ns1:Address&gt;<br>
&lt;ns1:ReferenceProperties xsi:type="ns1:ReferencePropertiesType"&gt;<br>
&lt;ns1:NoteKey
xmlns:ns1="http://sticky.com"&gt;233427&lt;/ns1:NoteKey&gt;<br>
&lt;/ns1:ReferenceProperties&gt;<br>
&lt;ns1:ReferenceParameters xsi:type="ns1:ReferenceParametersType"/&gt;<br>
&lt;StickyNoteEndpoint/&gt;
</p>
<h3>3.6 Now destroy the note Resource using its EPR:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/wsrf-destroy -e</font>
note-1107777.epr<br>
<!--
<p class="ex1-command">
$ <font color="red">%GLOBUS_LOCATION%\bin\wsrf-destroy -e</font> note-1107777.epr<br>
-->
Destroy operation was successful<br>
</p>
<p>Note that <i>wsrf-destroy</i> is a command-line client tool
distributed with the Globus Toolkit -- it is not demonstration code.</p>
<h3>3.7 Attempt to show the destroyed note:</h3>
<p>Execute this command from the Exercise window.</p>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/show-note -e</font>
note-1107777.epr<br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\show-note -e</font> note-1107777.epr</br>
-->
Error: org.oasis.wsrf.properties.ResourceUnknownFaultType<br>
</p>
<p>An "unknown resource" fault will be triggered if you've completed
this exercise correctly. </p>
<p>WSRF and WSN provide a set of standard faults (WS-BaseFaults) that
are derived from a well-defined structure for expressing error
conditions. The faults returned by the StickyNote service are from the
set of standard faults. We recommend that service developers who wish
to define custom faults for their services derive from the BaseFault
structure.</p>
<h3><a name="ch3trouble">Troubleshooting for exercise 3:</a></h3>
<ul>
  <h4>create-note troubles</h4>
  <li>If you have trouble with create-note like:
    <p class="ex1-command">Error: java.lang.Exception: [CORE] Operation
'Destroy' defined in wsdl but it's not implemented in the
'StickyNoteService' service.<br>
    </p>
    <p>Remember to stop and restart your container after deploying the
updated
code. Stop the container with Control-C and restart it for your changes
to take effect.</p>
  </li>
  <li>If you have trouble with create-note like:
    <p class="ex1-command">Error: java.lang.Exception: [CORE] Operation
'GetResourceProperty' defined in wsdl but it's not implemented in the
'StickyNoteService' service.<br>
    </p>
    <p>Remember to uncomment the section containing the
operationProviders
in your WSDD.</p>
  </li>
</ul>
<!--
<h3><font color="green">Further work (optional): </font></h3>
<p>[idea needed --lcc]</p>
-->
<img src="stop.jpg"><a name="chapter4">
<h2>Chapter 4: Add a Resource Property</h2>
</a>
<h3>4.1 Modify files: Some of these files are already uncommented. This
will be, hopefully, fixed in later version of tutorial.<br>
</h3>
<p class="ex1-command">
<b>schema/tutorial/stickynote_port_type.wsdl:</b><br>
Add the definition of the lastModified RP type and add
QueryResourceProperties operation<br>
<br>
<b>src/org/globus/tutorial/stickynote/client/ShowNote.java:</b><br>
Have the show-note client report the lastModified time<br>
<br>
<b>src/org/globus/tutorial/stickynote/StickyNote.java:</b><br>
Implement the lastModified behavior<br>
<br>
<b>src/org/globus/tutorial/stickynote/StickyNoteConstants.java:</b><br>
Uncomment the definition of the constant<br>
</p>
<h3>4.2 Clean, rebuild and redeploy the StickyNote code:</h3>
<p>Execute these commands from the /tmp/tutorial/stickynote/source/
directory of the Exercise window.</p>
<!--
<p>Execute these commands from the C:\tutorial\stickynote\source\ directory of the Exercise window.</p>
-->
<p class="ex1-command">$ <font color="red">ant clean</font><br>
$ <font color="red">ant deploy</font><br>
</p>
<h3>4.3 Kill and restart the web service container in the GT window:</h3>
<p class="command">
$ <i>[ctrl-c]</i><br>
$ <font color="red">bin/globus-start-container -nosec</font><br>
<!--
$ <font color="red">bin\globus-start-container -nosec</font><br>
-->
</p>
<h3>4.4 From the Exercise window, create a new sticky note and inspect
its timestamp:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/create-note -s
http://localhost:8080/wsrf/services/StickyNoteService</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\create-note -s http://localhost:8080/wsrf/services/StickyNoteService</font><br>
-->
new note created...<br>
EPR written to file: note-1947456611.epr<br>
$ <font color="red">$GLOBUS_LOCATION/bin/show-note -e</font>
note-1947456611.epr<br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\show-note -e</font> note-1947456611.epr<br>
-->
&lt;ns1:StickyNoteResourceProperties
xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;<br>
&lt;ns1:lastModified&gt;2005-01-06T18:14:29.153Z&lt;/ns1:lastModified&gt;<br>
&lt;ns1:noteContent&gt;hello.&lt;/ns1:noteContent&gt;<br>
&lt;/ns1:StickyNoteResourceProperties&gt;<br>
</p>
<h3>4.5 Modify the value of the sticky note, then verify that the
timestamp was updated:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/write-note -e</font>
note-1947456611.epr <font color="red">spider</font><br>
Message written.
<br>
$ <font color="red">$GLOBUS_LOCATION/bin/show-note -e</font>
note-1947456611.epr<br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\write-note -e</font> note-1947456611.epr <font color="red">spider</font><br>
Message written.
<br>
$ <font color="red">%GLOBUS_LOCATION%\bin\show-note  -e</font> note-1947456611.epr<br>
-->
&lt;ns1:StickyNoteResourceProperties
xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;<br>
&lt;ns1:lastModified&gt;2005-01-06T18:24:39.153Z&lt;/ns1:lastModified&gt;<br>
&lt;ns1:noteContent&gt;spider&lt;/ns1:noteContent&gt;<br>
&lt;/ns1:StickyNoteResourceProperties&gt;<br>
</p>
<p>You should see that the timestamp has updated since the note was
created.</p>
<!-- 
<h3><font color="green">Further work (optional): </font></h3>
<p>Cause StickyNotes to be retained between container restarts: persist resources to a file</p>
-->
<h3><a name="ch4trouble">Troubleshooting for exercise 4:</a></h3>
<ul>
  <h4>show-note troubles</h4>
  <li>If you have trouble with show-note like this:
    <p></p>
    <p class="ex1-command">
Error: Tried to invoke method public
org.oasis.wsrf.properties.QueryResourcePropertiesResponse
org.globus.wsrf.impl.properties.QueryResourcePropertiesProvider.queryResourceProperties(org.oasis.wsrf.properties.QueryResourceProperties_Element)
throws
java.rmi.RemoteException,org.oasis.wsrf.properties.InvalidResourcePropertyQNameFaultType,org.oasis.wsrf.properties.ResourceUnknownFaultType,org.oasis.wsrf.properties.InvalidQueryExpressionFaultType,org.oasis.wsrf.properties.QueryEvaluationErrorFaultType,org.oasis.wsrf.properties.UnknownQueryExpressionDialectFaultType
with arguments
org.oasis.wsrf.properties.QueryResourceProperties_Element. The
arguments do not match the signature.; nested exception is: <br>
java.lang.IllegalArgumentException: object is not an instance of
declaring class<br>
    </p>
    <p>Remember to stop and restart your container after deploying the
updated
code. Stop the container with Control-C and restart it for your changes
to take effect. <br>
Also, this error might appear when the operation provider for this
operation is deployed but the operation itself is not defined in WSDL.
Ensure WSDL has the <i>QueryResourceProperties</i> operation
uncommented.</p>
  </li>
</ul>
<img src="stop.jpg">
<a name="chapter5">
<h2>Chapter 5: Discover a Resource</h2>
</a>
<h3>5.1 Modify files:</h3>
<p class="ex1-command">
<b>src/org/globus/tutorial/stickynote/ManyNoteHome.java:</b><br>
Override the add/remove methods to perform registration with the local
index<br>
<b>src/org/globus/tutorial/stickynote/StickyNote.java:<br>
<span style="font-weight: bold;"></span>Uncomment.<br>
</b><b>etc/post-deploy.xml:</b><br>
Uncomment search-note launch script generation<br>
<br>
<b>etc/registration.xml:</b><br>
Specify aggregation parameters<br>
</p>
<h3>5.2 Clean, rebuild and redeploy the StickyNote code:</h3>
<p>Execute these commands from the /tmp/tutorial/stickynote/source/
directory of the Exercise window.</p>
<p class="ex1-command">
$ <font color="red">ant clean</font><br>
$ <font color="red">ant deploy</font><br>
</p>
<h3>5.3 Kill and restart the web service container in the GT window:</h3>
<p class="command">
$ <i>[ctrl-c]</i><br>
$ <font color="red">bin/globus-start-container -nosec</font><br>
<!--
$ <font color="red">bin\globus-start-container -nosec</font><br>
-->
</p>
<h3>5.4 From the Exercise window, create a sticky note and write your
name on it:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/create-note -s
http://localhost:8080/wsrf/services/StickyNoteService</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\create-note -s http://localhost:8080/wsrf/services/StickyNoteService</font><br>
-->
new note created...<br>
EPR written to file: note-8469523889.epr<br>
$ <font color="red">$GLOBUS_LOCATION/bin/write-note -e
note-8469523889.epr VelvetCapezzuto</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\write-note -e note-8469523889.epr VelvetCapezzuto</font><br
>-->
Message written.
</p>
<h3>5.5 Query the local index to view its entire contents:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/wsrf-query -s
http://localhost:8080/wsrf/services/DefaultIndexService '/*'</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\wsrf-query -s http://localhost:8080/wsrf/services/DefaultIndexService "/*"</font><br>
-->
[... lots of output ...]<br>
&lt;ns1:MemberServiceEPR&gt;<br>
&lt;ns8:Address
xmlns:ns8="http://schemas.xmlsoap.org/ws/2004/03/addressing"&gt;http://192.168.123.106:8080/wsrf/services/StickyNoteService&lt;/ns8:Address&gt;<br>
&lt;ns9:ReferenceProperties
xmlns:ns9="http://schemas.xmlsoap.org/ws/2004/03/addressing"&gt;<br>
&lt;ns1:NoteKey
xmlns:ns1="http://sticky.com"&gt;5550702&lt;/ns1:NoteKey&gt;<br>
&lt;/ns9:ReferenceProperties&gt;<br>
&lt;ns10:ReferenceParameters
xmlns:ns10="http://schemas.xmlsoap.org/ws/2004/03/addressing"/&gt;<br>
&lt;/ns1:MemberServiceEPR&gt;<br>
[... more output ...]<br>
</p>
<p>Note that <i>wsrf-query</i> is a standard command-line client tool
distributed with the Globus Toolkit.</p>
<h3>5.6 Verify that the NoteKey value in the above output matches the
NoteKey value in your EPR:</h3>
<p class="ex1-command">
$ <font color="red">grep NoteKey note-8469523889.epr</font><br>
&lt;ns1:NoteKey
xmlns:ns1="http://sticky.com"&gt;5550702&lt;/ns1:NoteKey&gt;<br>
</p>
<!--
<p> For example, open note-8469523889.epr in some text editor and search for "NoteKey"</p>
-->
<p>Notice that the value 5550702 matches the value in the index entry
above.</p>
<h3>5.7 Find a note from the local index based on content:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/search-note -s
http://localhost:8080/wsrf/services/DefaultIndexService VelvetCapezzuto</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\search-note -s http://localhost:8080/wsrf/services/DefaultIndexService VelvetCapezzuto</font><br>
-->
Note 0: &lt;ns1:noteContent
xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;VelvetCapezzuto&lt;/ns1:noteContent&gt;
</p>
<p>Note that you are finding the note without referring to a specific
location. There is no need for you to know the EPR!</p>
<!-- 
<h3><a name="ch5trouble">Troubleshooting for exercise 5:</a></h3>
<ul>
<h4> troubles</h4>
</ul>

<h3><font color="green">Further work (optional): </font></h3>
<p>[idea needed --lcc]</p>
-->
<img src="stop.jpg"><a name="chapter6">
<h2>Chapter 6: Register with a Community Index</h2>
</a>
<h3>6.1 Modify files:</h3>
<p class="ex1-command">
<b>$GLOBUS_LOCATION/etc/globus_wsrf_mds_index/hierarchy.xml:</b><br>
<!--
<b>%GLOBUS_LOCATION%\etc\globus_wsrf_mds_index\hierarchy.xml:</b><br>
-->
Uncomment the "&lt;upstream&gt;" parameter, making sure the value
corresponds to the URI of the community index. Do <i>not</i> uncomment
or otherwise touch the "&lt;downstream&gt;" parameter.<br>
<br>
<b>$GLOBUS_LOCATION/etc/globus_wsrf_mds_index/upstream.xml:</b><br>
<!--
<b>%GLOBUS_LOCATION%\etc\globus_wsrf_mds_index\upstream.xml:</b><br>
-->
Change the value of the <i>PollIntervalMillis</i> parameter from
600000 (10 minutes) to 150000 (2 minutes). Do not make this value
smaller than 150000 or the community index will become too busy. In a
real grid deployment this value would be much higher (20 minutes or
more).<br>
</p>
<h3>6.2 Kill and restart the web service container in the GT window
(rebuild not needed):</h3>
<p class="command">
$ <i>[ctrl-c]</i><br>
$ <font color="red">bin/globus-start-container -nosec</font><br>
<!--
$ <font color="red">bin\globus-start-container -nosec</font><br>
-->
</p>
<h3>6.3 From the Exercise window, create a sticky note:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/create-note -s
http://localhost:8080/wsrf/services/StickyNoteService</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\create-note -s http://localhost:8080/wsrf/services/StickyNoteService</font><br>
-->
new note created...<br>
EPR written to file: note-269523889.epr<br>
$ <font color="red">$GLOBUS_LOCATION/bin/write-note -e
note-269523889.epr BraveSirRobin</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\write-note -e note-269523889.epr BraveSirRobin</font><br
>-->
Message written.
</p>
<p>At this point, students should begin to see fish entering the
central tank. Each fish in the tank represents a student sticky
resource that has successfully registered with the community index. The
text on the side of the fish corresponds to the message in the sticky
note; the IP address on the side of the fish corresponds to the IP
address of the student's host.</p>
<h3>6.4 The community index, like the local index, can be inspected
manually:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/wsrf-query -s
http://129.215.30.251:8080/wsrf/services/DefaultIndexService '/*'</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\wsrf-query -s http://129.215.30.251:8080/wsrf/services/DefaultIndexService "/*"</font><br>
-->
[... lots of output ...]<br>
&lt;ns1:MemberServiceEPR&gt;<br>
&lt;ns8:Address
xmlns:ns8="http://schemas.xmlsoap.org/ws/2004/03/addressing"&gt;http://192.168.123.106:8080/wsrf/services/StickyNoteService&lt;/ns8:Address&gt;<br>
&lt;ns9:ReferenceProperties
xmlns:ns9="http://schemas.xmlsoap.org/ws/2004/03/addressing"&gt;<br>
&lt;ns1:NoteKey
xmlns:ns1="http://sticky.com"&gt;8640702&lt;/ns1:NoteKey&gt;<br>
&lt;/ns9:ReferenceProperties&gt;<br>
&lt;ns10:ReferenceParameters
xmlns:ns10="http://schemas.xmlsoap.org/ws/2004/03/addressing"/&gt;<br>
&lt;/ns1:MemberServiceEPR&gt;<br>
[... more output ...]<br>
</p>
<h3>6.5 Find a note from the community index based on content:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/search-note -s
http://129.215.30.251:8080/wsrf/services/DefaultIndexService
BraveSirRobin</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\search-note -s http://129.215.30.251:8080/wsrf/services/DefaultIndexService BraveSirRobin</font><br>
-->
Note 0: &lt;ns1:noteContent
xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;BraveSirRobin&lt;/ns1:noteContent&gt;<br>
Note 1: &lt;ns1:noteContent
xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;BraveSirRobin&lt;/ns1:noteContent&gt;<br>
Note 2: &lt;ns1:noteContent
xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;BraveSirRobin&lt;/ns1:noteContent&gt;<br>
</p>
<p>Note that the community index is caching the data from the entire
VO, and so you are now able to discover resources owned by other
participants!</p>
<h3>6.6 View the contents of the community index using WebMDS (optional)</h3>
<p class="ex2-command">
If the instructors are not too busy solving problems, a browser-based
viewer for the community index will be made available. If it is running
you will be able to view the contents of the tutorial index at a url to
be supplied by the instructors.
</p>
<p>WebMDS is a servlet distributed with GT4 that can be used to display
the content of GT4 indexes. The view of the data can be refreshed by
hitting the reload button on your browser.</p>
<h3>6.7 Note that when you destroy one of your sticky resources, its
entry will eventually be removed from the community index:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/wsrf-destroy -e
note-269523889.epr</font><br>
<!--
<p class="ex1-command">
$ <font color="red">%GLOBUS_LOCATION%\bin\wsrf-destroy -e note-269523889.epr</font><br>
-->
Destroy operation was successful<br>
</p>
<p>With the current tutorial configuration, the entry will expire
approximately 10 minutes after the resource is destroyed.</p>
<!-- 
<h3><a name="ch6trouble">Troubleshooting for exercise 6:</a></h3>
<ul>
<h4> troubles</h4>
</ul>

<h3><font color="green">Further work (optional): </font></h3>
<p>[idea needed --lcc]</p>
-->
<img src="stop.jpg"><a name="chapter7">
<h2>Chapter 7: Lease-based Lifetime</h2>
</a>
<h3>7.1 Modify files:</h3>
<p class="ex1-command">
<b>schema/tutorial/stickynote_port_type.wsdl:</b><br>
Add a SetTerminationTime operation<br>
<br>
<b>src/org/globus/tutorial/stickynote/StickyNote.java:</b><br>
Add the ResourceLifetime property to control termination time<br>
<br>
<b>deploy-server.wsdd:</b><br>
Add the SetTerminationTimeProvider<br>
</p>
<h3>7.2 Clean, rebuild and redeploy the StickyNote code:</h3>
<p>Execute these commands from the /tmp/tutorial/stickynote/source/
directory of the Exercise window.</p>
<!--
<p>Execute these commands from the C:\tutorial\stickynote\source\ directory of the Exercise window.</p>
-->
<p class="ex1-command">$ <font color="red">ant clean</font><br>
$ <font color="red">ant deploy</font><br>
</p>
<h3>7.3 Kill and restart the web service container in the GT window:</h3>
<p class="command">
$ <i>[ctrl-c]</i><br>
$ <font color="red">bin/globus-start-container -nosec</font><br>
<!--
$ <font color="red">bin\globus-start-container -nosec</font><br>
-->
</p>
<h3>7.4 From the Exercise window, create a sticky note:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/create-note -s
http://localhost:8080/wsrf/services/StickyNoteService</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\create-note -s http://localhost:8080/wsrf/services/StickyNoteService</font><br>
-->
new note created...<br>
EPR written to file: note-1234.epr<br>
</p>
<h3>7.5 Check the termination time of the sticky note:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/show-note -e</font>
note-1234.epr<br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\show-note -e</font> note-1234.epr<br>
-->
&lt;ns1:StickyNoteResourceProperties
xmlns:ns1="http://tutorial.globus.org/stickynote"
xmlns:ns2="http://docs.oasis-open.org/wsrf/2004/06/wsrf-WS-ResourceLifetime-1.2-draft-01.xsd"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;<br>
&lt;ns1:lastModified&gt;2005-01-24T22:45:33.053Z&lt;/ns1:lastModified&gt;<br>
&lt;ns1:CurrentTime
xmlns:ns1="http://docs.oasis-open.org/wsrf/2004/06/wsrf-WS-ResourceLifetime-1.2-draft-01.xsd"&gt;2005-01-24T22:46:10.503Z&lt;/ns1:CurrentTime&gt;<br>
&lt;ns1:TerminationTime xsi:nil="true"
xmlns:ns1="http://docs.oasis-open.org/wsrf/2004/06/wsrf-WS-ResourceLifetime-1.2-draft-01.xsd"/&gt;<br>
&lt;ns1:noteContent&gt;hello.&lt;/ns1:noteContent&gt;<br>
&lt;/ns1:StickyNoteResourceProperties&gt;<br>
</p>
<p>Observe that the terminationTime resource property is set to nil -
this means that the newly created note has no termination time (and so
will
not be automatically destroyed). This means that this note will behave
like the notes created in previous exercises.</p>
<h3>7.5 Set the termination time of the sticky note:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/wsrf-set-termination-time -e</font>
note-1234.epr <font color="red">100</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\wsrf-set-termination-time -e</font> note-1234.epr <font color="red">100</font><br>
-->
requested: Mon Jan 24 16:50:14 CST 2005<br>
scheduled: Mon Jan 24 16:50:14 CST 2005<br>
</p>
<p>This will set the termination time of the resource to 100 seconds in
the
future.</p>
<p>Now wait a few minutes, using 'show-note' every minute or so and
observe the current time approach and pass beyond the termination time.
Eventually, the resource will be destroyed automatically and you will
get the following error:</p>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/show-note -e</font>
note-1234.epr<br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\show-note -e</font> note-1234.epr<br>
-->
Error: org.oasis.wsrf.properties.ResourceUnknownFaultType
</p>
<p>This indicates that the Sticky Note resource no longer exists, and
has been destroyed automatically.</p>
<!-- 
<h3><font color="green">Further work (optional): </font></h3>
<p>[idea needed --lcc]</p>
-->
<img src="stop.jpg"><a name="chapter8">
<h2>Chapter 8: Resource as Notification Producer</h2>
</a>
<h3>8.1 Modify files:</h3>
<p class="ex1-command">
<b>schema/tutorial/stickynote_port_type.wsdl:</b><br>
Add Subscribe operation<br>
<br>
<b>src/org/globus/tutorial/stickynote/StickyNote.java:</b><br>
Add TopicList code<br>
<br>
<b>deploy-server.wsdd:</b><br>
Add the SubscribeProvider<br>
<br>
<b>etc/post-deploy.xml:</b><br>
Uncomment watch-note launch script generation<br>
</p>
<h3>8.2 Clean, rebuild and redeploy the StickyNote code:</h3>
<p>Execute these commands from the /tmp/tutorial/stickynote/source/
directory of the Exercise window.</p>
<!--
<p>Execute these commands from the C:\tutorial\stickynote\source\ directory of the Exercise window.</p>
-->
<p class="ex1-command">$ <font color="red">ant clean</font><br>
$ <font color="red">ant deploy</font><br>
</p>
<h3>8.3 Kill and restart the web service container in the GT window:</h3>
<p class="command">
$ <i>[ctrl-c]</i><br>
$ <font color="red">bin/globus-start-container -nosec</font><br>
<!--
$ <font color="red">bin\globus-start-container -nosec</font><br>
-->
</p>
<h3>8.4 From the Exercise window, create a sticky note:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/create-note -s
http://localhost:8080/wsrf/services/StickyNoteService</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\create-note -s http://localhost:8080/wsrf/services/StickyNoteService</font><br>
-->
new note created...<br>
EPR written to file: note-27772.epr<br>
</p>
<h3>8.5 Create a third window for watching the sticky note:</h3>
<!--
<p class="ex2-command">
$ <font color="red">cd C:\tutorial\exercise-install\stickynote\source</font><br>
$ <font color="red">set GLOBUS_LOCATION=</font><i>[your GL here]</i><br>
</p>
-->
<p class="ex2-command">$ <font color="red">cd
/tmp/tutorial/exercise-install/stickynote/source</font><br>
$ <font color="red">export GLOBUS_LOCATION=</font><i>[your GL here]</i><br>
</p>
<p>Ensure that JAVA_HOME and GLOBUS_LOCATION are correctly set in the
new window.</p>
<h3>8.5 Launch the sticky note watcher:</h3>
<p class="ex2-command">
$ <font color="red">$GLOBUS_LOCATION/bin/watch-note -e</font>
note-27772.epr<br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\watch-note -e</font> note-27772.epr<br>
-->
Waiting for notification. Ctrl-C to end.<br>
</p>
<p>Control will not return to the prompt. The container hosting the
watch
client will stay running until you exit with Control-C.</p>
<h3>8.6 Modify the value of the sticky note:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/write-note -e</font>
note-27772.epr <font color="red">coconut</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\write-note -e</font> note-27772.epr <font color="red">coconut</font><br>
-->
Message written.
</p>
<p>You have successfully completed this chapter when watch-note shows
the
new value of the note.</p>
<p>You can write to the note some more times, and watch-note will
display the updated value each time.</p>
<h3>8.7 Kill the watch-note container:</h3>
<p class="ex2-command">
$ <i>[ctrl-c]</i><br>
$
</p>
<p>We will not use the third command window again.</p>
<!-- 
<h3><font color="green">Further work (optional): </font></h3>
<p>[idea needed --lcc]</p>
-->
<h3>Troubleshooting for exercise 8</h3>
<ul>
  <li>If your watch-note client does not receive change notifications,
and you were previously compelled to set the <i>logicalHost</i>
parameter in server-config.wsdd:</li>
  <p>
Add the same parameter to
  <code>$GLOBUS_LOCATION/etc/globus_wsrf_core/client-server-config.wsdd</code>,
under
the <code>&lt;globalConfiguration&gt;</code> section:
  </p>
  <p class="command">&lt;parameter name="logicalHost"
value="xxx.xxx.xxx.xxx"/&gt;
  </p>
</ul>
<img src="stop.jpg">
<a name="chapter9">
<h2><br>
</h2>
<h2>Chapter 9:(Optional) Service-Level Security</h2>
</a>
<h3>9.1 Modify files:</h3>
<p class="ex1-command">
<b>deploy-server.wsdd:</b><br>
Add securityDescriptor parameter<br>
<br>
<b>etc/grid-mapfile:</b><br>
Add your certificate subject. Details later. Leave alone for now.<br>
<br>
<b>etc/security-config.xml:</b><br>
No modification needed<br>
<br>
<b>$HOME/.globus</b><br>
If you have a $HOME/.globus directory on your machine already, make
a backup. For instance, rename the directory to .globus-old. The
following exercises will overwrite your user certificate otherwise.
If the directory does not exist, you do not need to do anything.
The following exercises will create it for you.
<!--
<b>%HOME%\.globus</b><br>
If you have a %HOME%\.globus directory on your machine already, make
a backup.  For instance, rename the directory to .globus-old.  The
following exercises will overwrite your user certificate otherwise.
If the directory does not exist, you do not need to do anything.
The following exercises will create it for you.
--></p>
<h3>9.2 Clean, rebuild and redeploy the StickyNote code:</h3>
<p>Execute these commands from the /tmp/tutorial/stickynote/source/
directory of the Exercise window.</p>
<!--
<p>Execute these commands from the C:\tutorial\stickynote\source\ directory of the Exercise window.</p>
-->
<p class="ex1-command">$ <font color="red">ant clean</font><br>
$ <font color="red">ant deploy</font><br>
</p>
<h3>9.3 In the GT window, get a certificate and create a proxy.</h3>
<p class="command">
$ <font color="red">bin/grid-cert-request -caEmail false</font><br>
<!--
$ <font color="red">bin\grid-cert-request -caEmail false</font><br>
-->
A certificate request and private key will be created.<br>
You will be asked to enter a PEM pass phrase.<br>
This pass phrase is akin to your account password,<br>
and is used to protect your key file.<br>
If you forget your pass phrase, you will need to<br>
obtain a new certificate.<br>
<br>
Enter PEM pass phrase: asdf<br>
Verifying password - Enter PEM pass phrase: asdf<br>
Generating a 1024 bit RSA private key<br>
A private key and a certificate request has been generated with the
subject:<br>
<br>
/O=Grid/CN=bacon<br>
<br>
The private key is stored in /home/bacon/.globus/userkey.pem<br>
The request is stored in /home/bacon/.globus/usercert_request.pem<br>
<!--
The private key is stored in %HOME%\.globus\userkey.pem<br>
The request is stored in %HOME%\.globus\usercert_request.pem<br>
-->
</p>
<p>Upload the generated request file to <a
 href="http://gcs.globus.org:8080/gcs/usercert.html">http://gcs.globus.org:8080/gcs/usercert.html</a>.
Choose
to download the resulting file to the same directory where the
userkey.pem is saved. Now create a proxy from your new
certificate:</p>
<p class="command">
$ <font color="red">bin/grid-proxy-init -globus</font><br>
<!--
$ <font color="red">bin\grid-proxy-init -globus</font><br>
-->
Your identity: /C=US/O=Globus Alliance/OU=User/CN=101ca1dcd9b.8029cef5<br>
Enter GRID pass phrase for this identity:<br>
Creating proxy ................................. Done<br>
Proxy verify OK<br>
Your proxy is valid until Tue Feb 01 03:40:22 CST 2005<br>
</p>
<!--
<p> You might see this warning, but is harmless.
<p class="command">Warning: Please check file permissions for your proxy file.</p>
</p>
-->
<p>Copy the value following "Your identity:" into the file
stickynote/source/etc/grid-mapfile<br>
<!--
stickynote\source\etc\grid-mapfile<br>
-->
The identity should be in quotes and followed by your username.
For example:<br>
<br>
</p>
<p class="command">
"/C=US/O=Globus Alliance/OU=User/CN=101497d3dcd.3dcd5aef" ranantha<br>
"/C=US/O=Globus Alliance/OU=User/CN=10187397229.feeb1182" lcc<br>
"/C=US/O=Globus Alliance/OU=User/CN=101ca1dcd9b.8029cef5" bacon<br>
</p>
<p>After making the edits, run <code>ant deploy</code> again. The
copy of the grid-mapfile being stored with your source code will be
copied into <code>$GLOBUS_LOCATION</code> where it will be used by
your
service.</p>
<h3>9.4 Start a web service container with security in the GT window:</h3>
<p class="command">
$ <font color="red">bin/globus-start-container</font><br>
<!--
$ <font color="red">bin\globus-start-container</font><br>
-->
[... more container output ...]<br>
[21]:
https://192.168.123.100:8443/wsrf/services/ContainerRegistryEntryService<br>
[22]:
https://192.168.123.100:8443/wsrf/services/SubscriptionManagerService<br>
</p>
<h3>9.5 From the Exercise window, run the client:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/create-note -s
https://localhost:8443/wsrf/services/StickyNoteService -z none</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\create-note -s https://localhost:8443/wsrf/services/StickyNoteService -z none</font><br>
-->
new note created...<br>
EPR written to file: note-672627063.epr<br>
$ <font color="red">$GLOBUS_LOCATION/bin/create-note -s
https://localhost:8443/wsrf/services/StickyNoteService -z self</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\create-note -s https://localhost:8443/wsrf/services/StickyNoteService -z self</font><br>
-->
new note created...<br>
EPR written to file: note-807655197.epr<br>
</p>
<p>Notice two things. First of all, because we started the container
with security, the URLs start with "https://" instead of "http://".
Secondly, because our client derives from the base client, we have a
<code>-z</code> option that lets us specify what kind of authorization
the client will attempt to perform.</p>
<h3>9.6 Now that we have created a note, only those in the grid-mapfile
can
edit it:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/write-note -e
note-807655197.epr -z none cheese</font><br>
Message written.<br>
$ <font color="red">$GLOBUS_LOCATION/bin/show-note -e
note-807655197.epr -z none</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\write-note -e note-807655197.epr -z none cheese</font><br>
Message written.<br>
$ <font color="red">%GLOBUS_LOCATION%\bin\show-note -e note-807655197.epr -z none</font><br>
-->
&lt;ns1:StickyNoteResourceProperties
xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;&lt;ns1:lastModified&gt;2005-01-10T22:02:26.564Z&lt;/ns1:lastModified&gt;&lt;ns1:noteContent&gt;cheese&lt;/ns1:noteContent&gt;&lt;/ns1:StickyNoteResourceProperties&gt;</p>
<h3>9.7 Any user, including an anonymous user can read the note. </h3>
<p class="ex1-command"><font color="red">$GLOBUS_LOCATION/bin/show-note
-e note-807655197.epr -z none -a</font><br>
<!--
<p class="ex1-command"><font color="red">%GLOBUS_LOCATION%\bin\show-note.bat -e note-807655197.epr -z none -a</font><br>
-->
&lt;ns1:StickyNoteResourceProperties
xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;&lt;ns1:lastModified&gt;2005-01-10T22:02:36.564Z&lt;/ns1:lastModified&gt;&lt;ns1:noteContent&gt;cheese&lt;/ns1:noteContent&gt;&lt;/ns1:StickyNoteResourceProperties&gt;</p>
--&gt;
<p> The <code>-a</code> option sets up the client invocation to be
anonymous. Note that the anonymous user cannot create a new note,
because that requires gridmap authorization.</p>
<!--
<h3><font color="green"> Add a successful call on edit from some user in service's gridmap who did not create the note </font></h3>

<h3><font color="green">Further work (optional): </font></h3>
<p>[How easy would it be to compare/contrast message-level security here with transport-level?  This should only be an option if it is easy for us and well as the students  --lcc]</p>
-->
<h3>Troubleshooting for exercise 9</h3>
<ul>
  <li>If you see an error like the following:
    <p class="ex1-command">Error:
org.globus.wsrf.impl.security.authorization.exceptions.AuthorizationException:
"/C=US/O=Globus Alliance/OU=User/CN=1014e44b14c.fd334f58" is not
authorized to use operation:
{http://tutorial.globus.org/stickynote}create on this service<br>
    </p>
    <p>Then the identity of your client is not in the grid-mapfile for
the
service you are trying to access.</p>
  </li>
  <li>The following error:
    <p class="ex1-command">Error:
org.globus.wsrf.impl.security.authorization.exceptions.AuthorizationException:
"/C=US/O=Globus Alliance/OU=User/CN=101497d3dcd.3dcd5aef" is not
authorized to use operation:
{http://tutorial.globus.org/stickynote}write on this service<br>
    </p>
    <p>represents an attempt to invoke the write operation when the
client
is not present in the grid-mapfile</p>
  </li>
  <li>If you are getting strange "CA not found" errors even if you
think
certificates are in the correct directories, check to see if you have a
    <code>~/.globus/cog.properties</code> file which is overriding the
default
directory search order.</li>
  <br>
  <li>If the following error occurs:
    <p class="ex1-command">Error: GSI Transport authentication required
for "{http://tutorial.globus.org/stickynote}create" operation.<br>
    </p>
    <p>Remember to run a <i>secure</i> container, and to use port 8443
(and an https:// URI).</p>
  </li>
</ul>
<img src="stop.jpg">
<a name="chapter10">
<h2>Chapter 10 (Optional): Resource-Level Security</h2>
</a>
<p> Security configuration can be done at the resource level and it
takes precedence over service level settings. But unlike service
security setting, programmatic altering of a resource is required to
secure
a resource. The resource needs to implement the
<i>org.globus.wsrf.security.SecureResource</i> interface.</p>
<p>In the previous exercise every user in the service level gridmap
was able to write to all notes. In this exercise, resource security
is used to restrict write access to only the creator of the sticky
note. This is done by creating a resource level gridmap at the time of
resource creation and populating it with the identity of the
creator.</p>
<h3>10.1 Modify files:</h3>
<p class="ex1-command">
<b>src/org/globus/tutorial/stickynote/StickyNote.java:</b><br>
Add resource security descriptor that sets up a grid-map file with
only the identity of the client creating the note
</p>
<h3>10.2 Clean, rebuild and redeploy the StickyNote code:</h3>
<p>Execute these commands from the /tmp/tutorial/stickynote/source/
directory of the Exercise window.</p>
<!--
<p>Execute these commands from the C:\tutorial\stickynote\source\ directory of the Exercise window.</p>
-->
<p class="ex1-command">$ <font color="red">ant clean</font><br>
$ <font color="red">ant deploy</font><br>
</p>
<h3>10.3 Start a web service container with security in the GT window:</h3>
<p class="command">
$ <font color="red">bin/globus-start-container</font><br>
<!--
$ <font color="red">bin\globus-start-container</font><br>
-->
[... more container output ...]<br>
[21]:
https://192.168.123.100:8443/wsrf/services/ContainerRegistryEntryService<br>
[22]:
https://192.168.123.100:8443/wsrf/services/SubscriptionManagerService<br>
</p>
<h3>10.4 From the Exercise window, run the client:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/create-note -s
https://localhost:8443/wsrf/services/StickyNoteService -z none</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\create-note -s https://localhost:8443/wsrf/services/StickyNoteService -z none</font><br>
-->
new note created...<br>
EPR written to file: note-672627063.epr<br>
$ <font color="red">$GLOBUS_LOCATION/bin/create-note -s
https://localhost:8443/wsrf/services/StickyNoteService -z self</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\create-note -s https://localhost:8443/wsrf/services/StickyNoteService -z self</font><br>
-->
new note created...<br>
EPR written to file: note-807655197.epr<br>
</p>
<h3>10.5 Now only the creator of the note has permission to edit it:</h3>
<p class="ex1-command">
$ <font color="red">$GLOBUS_LOCATION/bin/write-note -e
note-807655197.epr -z none cheese</font><br>
Message written.<br>
$ <font color="red">$GLOBUS_LOCATION/bin/show-note -e
note-807655197.epr -z none</font><br>
<!--
$ <font color="red">%GLOBUS_LOCATION%\bin\write-note -e note-807655197.epr -z none cheese</font><br>
Message written.<br>
$ <font color="red">%GLOBUS_LOCATION%\bin\show-note -e note-807655197.epr -z none</font><br>
-->
&lt;ns1:StickyNoteResourceProperties
xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;&lt;ns1:lastModified&gt;2005-01-10T22:02:26.564Z&lt;/ns1:lastModified&gt;&lt;ns1:noteContent&gt;cheese&lt;/ns1:noteContent&gt;&lt;/ns1:StickyNoteResourceProperties&gt;</p>
<p></p>
<!--
<h3><font color="green"> Add a failed call on edit from some user in service's gridmap </font></h3>
-->
<h3>10.6 Any user, including an anonymous user can read the note:</h3>
<p class="ex1-command"><font color="red">$GLOBUS_LOCATION/bin/show-note
-e note-807655197.epr -z none -a</font><br>
<!--
<p class="ex1-command"><font color="red">%GLOBUS_LOCATION%\bin\show-note.bat -e note-807655197.epr -z none -a</font><br>
-->
&lt;ns1:StickyNoteResourceProperties
xmlns:ns1="http://tutorial.globus.org/stickynote"&gt;&lt;ns1:lastModified&gt;2005-01-10T22:02:36.564Z&lt;/ns1:lastModified&gt;&lt;ns1:noteContent&gt;cheese&lt;/ns1:noteContent&gt;&lt;/ns1:StickyNoteResourceProperties&gt;</p>
<p> The <code>-a</code> option sets up the client invocation to be
anonymous.</p>
<img src="stop.jpg">
<p>This concludes the hands-on portion of the Build a Service Tutorial
Using GT4.</p>
</body>
</html>
