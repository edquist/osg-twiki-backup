#!/usr/bin/env python

import math
import sys

if len(sys.argv)<4:
    print "Usage:"
    print " sim.py [-graph] x y angle"
    sys.exit(1)


if sys.argv[1]=='-graph':
    use_graph=True
    args=sys.argv[2:]
else:
    use_graph=False
    args=sys.argv[1:]

if len(args)!=3:
    print "Usage:"
    print " sim.py [-graph] x y angle"
    sys.exit(1)

startx=float(args[0])
starty=float(args[1])
startang=float(args[2])/180*math.pi

if startx>50.0:
    print "Initial x must be <= 50.0"
    sys.exit(1)

if startx<0.0 or starty<150.0 or starty>250.0:
    print "Initial x must be in the 0-50 range."
    print "Initial y must be in the 150-250 range."
    sys.exit(1)

import sim

max_bounce=20
if use_graph:
    nbounce=sim.check((startx,starty,startang),max_bounce,None)
    if not (nbounce is None):
        # this way the last pixel is properly colored
        max_bounce=nbounce+1
    nbounce=sim.check((startx,starty,startang),max_bounce,"out.png")
    sys.stderr.write("out.png created\n")
else:
    nbounce=sim.check((startx,starty,startang),max_bounce,None)

if not (nbounce is None):
    print nbounce
    sys.exit(0)
else:
    sys.exit(2)
