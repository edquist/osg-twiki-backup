%META:TOPICINFO{author="BurtHolzman" date="1163539430" format="1.1" version="1.7"}%
<!-- This is the default OSG Integration template. 
Please modify it in the sections indicated to create your topic!
If you have any comments/complaints about this template, then please email me:
rwg@hep.uchicago.edu.  (Adapted from Atlas wiki template, Ed Moyse)
--> 

<!-- By default the title is the WikiWord used to create this topic !-->
<!-- if you want to modify it to something more meaningful, just replace %TOPIC% below with i.e "My Topic"!-->
d11 1
---+!!<nop>OSG CE Shutdown Guide
%TOC%
%STARTINCLUDE%

---++CE Shutdown Guide
<div class="twikiSmall" style="text-align: left; font-style: italic;"><a href="%SCRIPTURLPATH%/edit%SCRIPTSUFFIX%/%WEB%/%TOPIC%?t=%SERVERTIME{ "$epoch" }%">Edit this section</a></div>

---+++/etc/xinetd.d services
Ensure that you've disabled the Globus Gatekeeper and <nop>GridFTP from inetd or xinetd.  If you are using xinetd, you can do
<pre>
&gt; chkconfig globus-gatekeeper off
&gt; chkconfig gsiftp off
</pre>
In VDT 1.6.1 and later, all services (<i>/etc/init.d, /etc/xinetd.d, cron</i>) should be turned on/off using the <i>$VDT_LOCATION/vdt/sbin/vdt-control</i> script.  This section will provide just a general overview. There is a <i>man</i> page available for the script, just type "man vdt-control". You can also [[http://vdt.cs.wisc.edu/releases/1.6.1/man/vdt-control.html read the man page online]]
If you do not have chkconfig, edit <i>/etc/xinetd.d/globus-gatekeeper</i> and <i>/etc/xinetd.d/gsiftp</i>, and set disable = yes.

If you are using inetd, then edit inetd.conf, and comment out the lines for globus-gatekeeper and gsiftp.  

Lastly, restart xinetd and inetd by:
To view all services controlled by <i>vdt-control</i>:
&gt; /etc/init.d/xinetd restart
            or
&gt; /etc/init.d/inetd restart
gratia-condor      | cron   | enable
</pre>

---+++/etc/init.d services
The OSG starts up several daemons.  If you try to re-install/upgrade the OSG without shutting them down, it may fail.  Run the following commands to turn off the OSG services before upgrading (see sample shutdown session below):
d45 2
To shutdown <b>all</b> services:
<pre>
&gt; source $VDT_LOCATION/setup.sh
&gt;   /etc/init.d/gris stop
&gt;   /etc/init.d/mysql  stop
&gt;   /etc/init.d/globus-ws stop
&gt;   /etc/init.d/MLD stop 

&gt;   /etc/init.d/apache stop     <b><i>(if CEMon has been activated)</i></b>
&gt;   /etc/init.d/tomcat-5stop   <b><i>(if CEMon has been activated)</i></b>

&gt;   /etc/init.d/condor stop   <b><i>(or other installed job manager)</i></b>
&gt; vdt-control --off
</pre>
For OSG 0.4.1 or prior, there is a CRL update service that needs to be stopped.  In OSG 0.5.0+ releases, this is a crontab and is addressed in that section.
To shutdown <b>individual</b> services:
&gt;   /etc/init.d/edg-crl-upgraded stop 
&gt; vdt-control --off  Service
</pre>
<pre>
For OSG 0.4.1 and prior releases, the <i>root</i> cron processes that should be commented out are:
</pre>
0 0 * * * YOUR_VDT_LOCATION/vdt/bin/vdt-rotate-logs
</verbatim>
<pre>
For OSG 0.5.0 and beyond, the <i>root</i> cron processes that should be commented out are:
<verbatim>
</pre>
0 0 * * * YOUR_VDT_LOCATION/vdt/bin/vdt-rotate-logs
</verbatim>
For <i>/etc/init.d</i> services, the script will be removed from the directory and the service will be stopped.
For OSG 0.5.0 and earlier releases, the <i>mis</i> cron entry for MIS-CI can be removed by executing the following:
<pre>
&gt;  source $VDT_LOCATION/setup.sh
&gt;  $VDT_LOCATION/MIS-CI/uninstall-misci.sh    <b><i>(for OSG 0.5.0 and earlier releases)</i></b>
       or
&gt; crontab -r -u mis
</pre>
---++++<nop>MySql / <nop>MonALISA / Globus web services
Bear in mind that <nop>MonALISA also uses a database backend.  Here is how to find out whether [[MonALISA050][MonALISA]] is running, and if so, under what user:
If you are using OSG 0.4.1 or higher, <nop>MonALISA is most likely using the postgres database.  
==/etc/xinetd.d== services can be disabled by either removing the service configuration from the ==/etc/xinetd.d== direcotry, or setting ==disable=yes== in the service's ==/etc/xinetd.d== configuration file and restarting xinetd.
---++++<nop>MySql / <nop>Integration.MonALISA / Globus web services
Bear in mind that <nop>Integration.MonALISA also uses a database backend.  Here is how to find out whether [[MonALISA][Integration.MonALISA]] is running, and if so, under what user: If you are using OSG 0.4.1 or higher, <nop>Integration.MonALISA is most likely using the postgres database.  

If you have installed/activated Globus web services (<i>/etc/init.d/globus-ws</i>), it will be using a <i>MySql</i> database as it's persistent storage for the current state of the services.
and for the mysql or postgres daemons associated with !MonALISA, check using:
&gt;  ps -efwww | grep -i monalisa
</pre>
and for the mysql or postgres daemons associated with !Integration.MonALISA, check using:
<pre>
&gt;  ps -efwww | grep -i mysql
       or
If you are running a Rocks cluster, be sure to kill only the OSG-related mysql processes and avoid inadvertently stopping any cluster-related ones.  In general, pay attention if you need to kill any database-related processes explicitly; for example, look to make sure they are related to !MonALISA or Globus web services,  and/or are running out of your VDT installation area before stopping them.
</pre>
If you are shutting down in order to prepare for a new OSG install *in a different directory*, you should
remove the <i>/etc/init.d/MLD</i> link if it exists, as this will link to the <i>ML_SER</i> in your old <i>$VDT_LOCATION</i>.
If you are running a Rocks cluster, be sure to kill only the OSG-related mysql processes and avoid inadvertently stopping any cluster-related ones.  In general, pay attention if you need to kill any database-related processes explicitly; for example, look to make sure they are related to !Integration.MonALISA or Globus web services,  and/or are running out of your VDT installation area before stopping them.
d114 1
If you are shutting down in order to prepare for a new OSG install *in a different directory*, you shouldremove the <i>/etc/init.d/MLD</i> link if it exists, as this will link to the <i>ML_SER</i> in your old <i>$VDT_LOCATION</i>.
If you are shutting down in order to prepare for a new OSG install *in a different directory*, you shouldr emove the <i>/etc/init.d/MLD</i> link if it exists, as this will link to the <i>ML_SER</i> in your old <i>$VDT_LOCATION</i>.

Also check to see whether there are any stray OSG-related processes, such as run-mis-ci.sh, globus-job-manager, and so forth still running, and kill them manually if necessary.  
---++++If VOMS and/or GUMS is Running on Machine
This is not recommended.<br>
The process involves bringing down the tomcat servlet container, the included apache distribution, and mysql server.


<pre>
 &gt;  /etc/init.d/tomcat-5 stop
 &gt;  /etc/init.d/apache stop
 &gt;  /etc/init.d/mysql stop
</pre>


%STOPINCLUDE%
<!-- MAJOR UPDATES
*Major updates*:%BR%
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->

---++!! Major updates
-- Main.BurtHolzman - 30 Dec 2005
<!--Future editors should add their signatures beneath yours!-->
-- Main.NateMueller - 14 Apr 2005<br>
-- Main.ChristopherBaumbauer - 08 Mar 2006 - Added steps to disable globus, shutdown globus-ws, web services running under tomcat, and redid the MonALISA shutdown instructions to go down cleaner<br>
-- Main.JohnWeigand - 18 Jul 2005 - added gsiftp2 to procedures<br>
-- Main.AlanSill - 12 Dec 2005 - added web services shutdown and check<br>
-- Main.JohnWeigand -  05 Oct 2006 - for OSG 0.5.1<br>
-- Main.AlanSill - 22 Mar 2006 - Slight tweaks to above.<br>
%INCLUDE{ "Integration.WhuReferences" }%

%META:TOPICMOVED{by="ForrestChristian" date="1166054759" from="Integration.OSGShutdownGuide050" to="Integration/ITB_0_5.OSGShutdownGuide"}%
