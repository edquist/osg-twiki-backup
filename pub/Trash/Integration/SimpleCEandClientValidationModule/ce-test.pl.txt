#!/usr/bin/env perl
#
#  script:  ce-test.pl 
#
#  simple site test of OSG directory definitions
#
#########################

my @dirnames=("OSG_DATA","OSG_APP","OSG_WN_TMP","OSG_GRID");

my $host=qq{/bin/hostname};
my $execution_host=`$host`;

print "Testing execution host = ",$execution_host,"\n";

for($i=0;$i<=$#dirnames;$i++){

    my $real_dir;
    if($real_dir = print_existance($dirnames[$i])){
	print_permissions($real_dir);
        if($dirnames[$i]=~m/OSG_GRID/){
	    check_guc($real_dir);
	}
    } else {
	print "exitance failed\n";
    }
}

#----------------------------
sub print_existance
{
    $real_name=$ENV{$_[0]};
    print "\$",$_[0]," = ",$real_name;
    if(-d $real_name){
       print " exists : PASS \n";
    } else {
       print " doesn't exist : FAIL\n";
       $real_name=0;
    }
    return $real_name;
}

#---------------------------
sub print_permissions
{

    my $check_dir=qq{ls -ld $_[0]/};
    my $result = `$check_dir`;
    print $result,"\n";
}

#---------------------------
sub check_guc
{
    my $test=qq{ . $_[0]/setup.sh ; which globus-url-copy };
    my $res=`$test`;
    if($res=~m/globus-url-copy/){
        $res=~s/\n//;
	print "globus-url-copy exists as ",$res," :  PASS\n";
    } else {
        print "globus-url-copy not in \$OSG_GRID\n";
    }
}
