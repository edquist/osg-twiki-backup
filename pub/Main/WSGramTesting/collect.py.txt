#!/usr/bin/python

import os, time, sys, warnings

warnings.simplefilter("ignore", RuntimeWarning)

for i in range(1, 3601):
  sys.stdout.write("Running iteration %d\n"  % i)
  pid = os.fork()
  if pid == 0:
    start_time = time.time()
    log = open("runs/data.%s" % start_time, "w")
    log.write("Job: %d\n" % i)
    log.write("Start: %s\n" % start_time)
    temp_name = os.tmpnam()
    return_code = os.system("globusrun-ws -submit -Ft Condor -F t2dev-01.uchicago.edu:9443 -s -c /usr/bin/whoami > %s 2>&1" % temp_name)    
    end_time = time.time()
    log.write("End: %s\n" % end_time)
    elapsed_time = end_time - start_time
    log.write("Elapsed: %s\n" % elapsed_time)
    log.write("Status: %d\n" % return_code)
    log.write("\n\n\n******************** Command Output **************\n\n\n")
    temp_file = open(temp_name, "r")
    for line in temp_file.readlines():
      log.write(line)
    temp_file.close()
    log.close()
    os.unlink(temp_name)
    sys.exit(0)
  else:
    time.sleep(1)
    
